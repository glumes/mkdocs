{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stemmer"]},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"android/","title":"Index","text":"<p>this is android</p>"},{"location":"android/android-av-beginner-resource/","title":"\u63a8\u8350\u51e0\u4e2a\u582a\u79f0\u6559\u79d1\u4e66\u7ea7\u522b\u7684 Android \u97f3\u89c6\u9891\u5165\u95e8\u9879\u76ee","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/Bb0fgFMgH5QOBqYhOj0uqA</p> <p>\u5728 \u76f4\u64ad \u4e2d\u6709\u63d0\u5230\u51e0\u4e2a\u4e0d\u9519\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u8fd9\u91cc\u518d\u91cd\u70b9\u63a8\u8350\u4e00\u4e0b\uff1a</p> <p>\u76ee\u524d\uff0c\u5e02\u9762\u4e0a\u5173\u4e8e\u97f3\u89c6\u9891\u5b66\u4e60\u7684\u76f8\u5173\u4e66\u7c4d\u5e76\u4e0d\u591a\uff0c\u800c\u4e14\u5373\u4f7f\u770b\u4e86\u4e66\u7c4d\u5b66\u4e86\u7406\u8bba\uff0c\u6700\u7ec8\u8fd8\u662f\u8981\u56de\u5f52\u5230\u4ee3\u7801\u4e0a\u6765\u3002</p> <p>\u6bd5\u7adf IT \u884c\u4e1a\u5b9e\u8df5\u6027\u8981\u6c42\u9ad8\uff0c\u5f3a\u8c03\u52a8\u624b\u80fd\u529b\uff0c\u97f3\u89c6\u9891\u8fd9\u65b9\u9762\u5c31\u66f4\u5f97\u591a\u64cd\u4f5c\u548c\u63a2\u7d22\u4e86\u3002</p> <p>\u63a8\u8350\u4e0b\u9762\u51e0\u4e2a\u9879\u76ee\u4f1a\u5404\u6709\u4fa7\u91cd\uff0c\u5206\u522b\u6db5\u76d6\u4e86 Android \u97f3\u89c6\u9891\u5f55\u5236 API \u3001OpenGL \u6e32\u67d3\u548c\u7efc\u5408\u8fd0\u7528\u7684\u4f8b\u5b50\u3002</p> <ul> <li>GPUImage</li> </ul> <p>Github \u5730\u5740\uff1a</p> <p>https://github.com/cats-oss/android-gpuimage</p> <p>GPUImage \u6beb\u65e0\u7591\u95ee\u662f\u97f3\u89c6\u9891\u9879\u76ee\u91cc\u9762\u5fc5\u8bfb\u5de5\u7a0b\u4e86\uff0c\u5b83\u7684\u4fa7\u91cd\u70b9\u5728\u4e8e\u6e32\u67d3\u65b9\u9762\u3002</p> <p>\u6709\u4e9b\u516c\u53f8\u7684\u62db\u8058\u8981\u6c42\u4e0a\u53ef\u80fd\u90fd\u4f1a\u5199\u660e\u719f\u6089GPUImage \uff0c\u91cd\u8981\u6027\u53ef\u89c1\u4e00\u6591\u3002</p> <p>\u901a\u8fc7\u9605\u8bfb GPUImage \u7684\u6e90\u7801\uff0c\u80fd\u591f\u8ba9\u4f60\u638c\u63e1 OpenGL \u7684\u6e32\u67d3\u4ee5\u53ca\u6e32\u67d3\u94fe\u7684\u642d\u5efa\uff0c\u540c\u65f6\u5de5\u7a0b\u91cc\u9762\u5f88\u591a\u7279\u6548 Shader \u4ee3\u7801\uff0c\u901a\u8fc7\u9605\u8bfb\u548c\u5b9e\u8df5\u8fd9\u4e9b Shader \u4ee3\u7801\uff0c\u80fd\u591f\u8ba9\u4f60\u638c\u63e1\u521d\u6b65\u7684 Shader \u7f16\u5199\u80fd\u529b\u3002</p> <p>\u6bd4\u5982\u5e38\u89c1\u7684\u6ee4\u955c\u6548\u679c\uff0c\u5728 GPUImage \u5c31\u6709\u73b0\u6210\u7684\u4ee3\u7801\u4f8b\u5b50\uff0c\u8fd9\u4e00\u70b9\u5728\u6211\u7684\u76f4\u64ad\u4e2d\u4e5f\u6709\u8bb2\u5230\u3002\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u7ffb\u9605\u89c6\u9891\uff0c\u638c\u63e1\u5e38\u89c1\u6ee4\u955c\u6548\u679c\u7684\u4ee3\u7801\u7f16\u5199\u3002</p> <p>\u5982\u679c\u9700\u8981 GPUImage \u76f8\u5173\u7684\u6e90\u7801\u5206\u6790\u6587\u6863\uff0c\u4e5f\u53ef\u4ee5\u53c2\u8003\u6211\u4e4b\u524d\u5199\u8fc7\u7684\u4e00\u7bc7\u6587\u7ae0\uff1a </p> <p>OpenGL \u4e4b GPUImage \u6e90\u7801\u5206\u6790</p> <ul> <li>AudioVideoRecordingSample</li> </ul> <p>Github \u5730\u5740</p> <p>https://github.com/saki4510t/AudioVideoRecordingSample</p> <p>\u6b64\u9879\u76ee\u7684\u4fa7\u91cd\u70b9\u5728\u4e8e Android \u97f3\u89c6\u9891\u76f8\u5173 API \u7684\u4f7f\u7528\uff0c\u5c24\u5176\u662f\u5728 \u5f55\u5236\u548c\u7f16\u7801\u65b9\u9762\u7684\u3002</p> <p>\u8be5\u9879\u76ee\u8fd0\u884c\u540e\u80fd\u591f\u5c06 Camera \u91c7\u96c6\u7684\u89c6\u9891\u548c\u97f3\u9891\u5185\u5bb9\u7f16\u7801\u6210\u4e00\u4e2a MP4 \u6587\u4ef6\u3002</p> <p>\u8fd9\u5176\u4e2d\u7528\u5230\u4e86 MediaCodec \u505a\u7f16\u7801\uff0c\u7528\u5230\u4e86 MediaMuxer \u5c06\u97f3\u9891\u548c\u89c6\u9891\u6df7\u5408\u3002</p> <p>\u8fd9\u6837\u7684\u4e00\u4e2a\u5b8c\u6574\u793a\u4f8b\u5bf9\u4e8e\u638c\u63e1 Android \u4e0a\u97f3\u89c6\u9891\u76f8\u5173 API \u5e2e\u5fd9\u975e\u5e38\u5927\uff0c\u56e0\u4e3a\u5b83\u80fd\u591f\u6210\u529f\u6b63\u786e\u8fd0\u884c\uff0c\u800c\u4e14\u53ef\u4ee5\u901a\u8fc7\u53bb\u4fee\u6539\u5176\u6e90\u7801\u6765\u505a\u81ea\u5df1\u7684\u5b9e\u9a8c\uff0c\u9a8c\u8bc1\u81ea\u5df1\u5bf9\u4e8e API \u7684\u7406\u89e3\u548c\u638c\u63e1\u3002</p> <p>\u5f53\u4f60\u80fd\u591f\u719f\u7ec3\u638c\u63e1\u5176\u5185\u5bb9\uff0c\u6216\u8005\u4f60\u5c31\u53ef\u4ee5\u8bd5\u7740\u66f4\u8fdb\u4e00\u6b65\uff0c\u5c1d\u8bd5\u7528 FFmpeg \u505a\u97f3\u89c6\u9891\u7684\u7f16\u7801\u548c\u6df7\u5408\uff0c\u5b9e\u73b0\u548c Android \u97f3\u89c6\u9891 API \u4e00\u6837\u7684\u529f\u80fd\u3002</p> <ul> <li>Grafika</li> </ul> <p>Github \u5730\u5740</p> <p>https://github.com/google/grafika</p> <p>\u6b64\u9879\u76ee\u662f Google \u63d0\u4f9b\u7684\u4e00\u4e2a\u975e\u5b98\u65b9\u7684\u9879\u76ee\uff0c\u5b83\u7684\u4fa7\u91cd\u70b9\u5728\u4e8e\u5c06 OpenGL \u4e0e Android \u97f3\u89c6\u9891 API \u7efc\u5408\u8fd0\u7528\u3002</p> <p>\u5b83\u5305\u542b\u4e86\u5f88\u591a\u4e2a\u5b8c\u6574\u5c0f\u793a\u4f8b\uff0c\u6bd4\u5982\u5982\u4f55\u4f7f\u7528 TextureView \u663e\u793a OpenGL \u5185\u5bb9\u3001\u4f7f\u7528\u4e09\u79cd\u65b9\u5f0f\u8fdb\u884c OpenGL \u5185\u5bb9\u7684\u5f55\u5236\u3001\u5982\u4f55\u8fdb\u884c\u786c\u7f16\u7801\u64cd\u4f5c\u7b49\u3002</p> <p>\u901a\u8fc7\u9605\u8bfb\u8fd9\u4e9b\u4f8b\u5b50\uff0c\u80fd\u591f\u8ba9\u4f60\u638c\u63e1\u66f4\u591a\u7684\u6280\u5de7\uff0c\u628a\u524d\u9762\u5b66\u4f1a\u7684 OpenGL \u548c Android \u97f3\u89c6\u9891 API \u66f4\u7075\u6d3b\u8fd0\u7528\u4e86\uff0c\u8fdb\u4e00\u6b65\u52a0\u6df1\u7406\u89e3\u3002</p> <p>\u751a\u81f3\u6709\u4e9b\u4f8b\u5b50\u90fd\u53ef\u4ee5\u7528\u5230\u9879\u76ee\u65e9\u671f\u9700\u6c42\u4e2d\u53bb\u7684\uff0c\u6bd4\u5982\u5982\u4f55\u8fdb\u884c EGL \u7684\u5c01\u88c5\u3001\u6e32\u67d3\u7ebf\u7a0b\u4e0e\u4e3b\u7ebf\u7a0b\u7684\u5206\u79bb\u3002</p> <p>\u53e6\u5916\uff0c\u4ee5\u4e0a\u4e09\u4e2a\u4f8b\u5b50\u90fd\u4f1a\u5305\u542b Camera \u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u5982\u4f55\u5c06 Camera \u5185\u5bb9\u5c55\u793a\u5230 SurfaceView \u3001TextureView \u4e0a\uff0c\u5982\u4f55\u8fdb\u884c Camera \u62cd\u6444\u7b49\u3002</p>","tags":[]},{"location":"android/android-av-beginner-resource/#_1","title":"\u6700\u540e","text":"<p>\u4e4b\u524d\u8fd9\u4e09\u4e2a\u9879\u76ee\u582a\u79f0\u6559\u79d1\u5b66\u4e66\u7ea7\u522b\u7684\uff0c\u4e0d\u662f\u6ca1\u6709\u7406\u7531\u7684\u3002\u81f3\u5c11\u6211\u90fd\u6e90\u7801\u9605\u8bfb\u4e86\u4e24\u8fb9\u4ee5\u4e0a\u3002</p> <p>\u7b2c\u4e00\u6b21\u9605\u8bfb\u7684\u65f6\u5019\u4f1a\u89c9\u5f97 \" \u55ef\uff0c\u660e\u767d\u600e\u4e48\u56de\u4e8b\u4e86 \"\uff0c\u7b49\u5230\u9879\u76ee\u5b9e\u8df5\u4e86\uff0c\u9700\u8981\u81ea\u5df1\u4ece\u5934\u641e\u4e00\u904d\uff0c\u8fd9\u65f6\u518d\u56de\u5934\u770b\uff0c\u4f1a\u6709\u65b0\u7684\u611f\u609f \"\u54e6\uff0c\u539f\u6765\u8981\u8fd9\u6837\u8bbe\u8ba1\u5440\" \uff0c\u7b49\u5230\u66f4\u719f\u7ec3\u7684\u65f6\u5019\uff0c\u5728\u6765\u770b\uff0c\u53ef\u80fd\u5c31\u4f1a\u89c9\u5f97 \"\u54a6\uff0c\u8fd9\u5757\u80fd\u4f18\u5316\u4e00\u6ce2\u4e86\"\u3002</p> <p>\u4ee5\u4e0a\uff0c\u5e0c\u671b\u5bf9\u4e8e\u60f3\u4ece\u4e8b\u97f3\u89c6\u9891\u5f00\u53d1\u7684\u4f60\uff0c\u4e5f\u80fd\u591f\u770b\u770b\u4e0a\u9762\u51e0\u4e2a\u9879\u76ee\u6e90\u7801\uff0c\u5b66\u4e60\u5230\u66f4\u591a\u6280\u5de7\uff0c\u5171\u540c\u8fdb\u6b65\u3002</p>","tags":[]},{"location":"android/android-camera-aspect-ratio--and-orientation/","title":"Android \u76f8\u673a\u5f00\u53d1\u4e2d\u7684\u5c3a\u5bf8\u548c\u65b9\u5411\u95ee\u9898","text":"<p>*\u672c\u7bc7\u6587\u7ae0\u5df2\u6388\u6743\u5fae\u4fe1\u516c\u4f17\u53f7 guolin_blog \uff08\u90ed\u9716\uff09\u72ec\u5bb6\u53d1\u5e03</p> <p>\u5728 Android Camera \u5f00\u53d1\u4e2d\uff0c\u4e24\u4e2a\u6bd4\u8f83\u95f9\u5fc3\u7684\u95ee\u9898\u5c31\u662f\u5c3a\u5bf8\u548c\u65b9\u5411\u4e86\u3002</p> <p>\u5176\u4e2d\u5c3a\u5bf8\u6307\u7684\u662f\uff1a</p> <ul> <li>\u76f8\u673a\u663e\u793a\u9884\u89c8\u5e27\u7684\u5c3a\u5bf8</li> <li>\u76f8\u673a\u62cd\u6444\u5e27\u7684\u5c3a\u5bf8</li> <li>Android \u663e\u793a\u76f8\u673a\u9884\u89c8\u5185\u5bb9\u7684\u63a7\u4ef6\u5c3a\u5bf8</li> </ul> <p>\u800c\u65b9\u5411\u6307\u7684\u662f</p> <ul> <li>\u76f8\u673a\u663e\u793a\u9884\u89c8\u5e27\u7684\u65b9\u5411</li> <li>\u76f8\u673a\u62cd\u6444\u5e27\u7684\u65b9\u5411</li> <li>Android \u624b\u673a\u81ea\u8eab\u7684\u65b9\u5411</li> </ul> <p>\u5728\u5f00\u53d1\u4e2d\u8981\u5904\u7406\u597d\u8fd9\u4e09\u4e2a\u65b9\u5411\u548c\u4e09\u4e2a\u5c3a\u5bf8\u5404\u81ea\u7684\u5173\u7cfb\u624d\u884c\uff0c\u8fd9\u91cc\u4ee5 Camera 1.0 \u7248\u672c\u7684 API \u4f5c\u4e3a\u793a\u4f8b\uff0c\u53c2\u8003\u4e86 Google \u7684\u5f00\u6e90\u9879\u76ee\uff1acameraview  \u548c android-Camera2Basic \u3002</p>","tags":["Camera"]},{"location":"android/android-camera-aspect-ratio--and-orientation/#_1","title":"\u5c3a\u5bf8","text":"<p>\u76f8\u673a\u4f5c\u4e3a\u786c\u4ef6\u8bbe\u5907\uff0c\u53ef\u4ee5\u63d0\u4f9b\u4e24\u7c7b\u5c3a\u5bf8\uff1a</p> <ul> <li>\u9884\u89c8\u5e27\u5c3a\u5bf8</li> <li>\u62cd\u6444\u5e27\u5c3a\u5bf8</li> </ul>","tags":["Camera"]},{"location":"android/android-camera-aspect-ratio--and-orientation/#_2","title":"\u9884\u89c8\u5e27\u5c3a\u5bf8","text":"<p>\u901a\u8fc7 <code>getSupportedPreviewSizes</code> \u65b9\u6cd5\u53ef\u4ee5\u5f97\u5230\u652f\u6301\u7684\u9884\u89c8\u5e27\u7684\u5c3a\u5bf8\u96c6\u5408\u3002</p> <pre><code>        private final SizeMap mPreviewSizes = new SizeMap();\n        mCamera = Camera.open(mCameraId);\n        mCameraParameters = mCamera.getParameters();\n        // Supported preview sizes\n        mPreviewSizes.clear();\n        for (Camera.Size size : mCameraParameters.getSupportedPreviewSizes()) {\n            mPreviewSizes.add(new Size(size.width, size.height));\n        }\n</code></pre> <p>\u800c <code>mPreviewSizes</code> \u662f <code>SizeMap</code> \u7c7b\u578b\uff0c\u67e5\u770b\u6e90\u7801\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5728\u6dfb\u52a0\u9884\u89c8\u5e27\u5c3a\u5bf8\u7684\u957f\u548c\u5bbd\u65f6\uff0c\u8fd8\u8ba1\u7b97\u4e86\u4ed6\u4eec\u7684\u957f\u5bbd\u6bd4\uff0c\u5e76\u4fdd\u5b58\u4e86\u8d77\u6765\uff0c\u5b58\u50a8\u957f\u5bbd\u6bd4\u7684\u7ed3\u6784\u53ef\u4ee5\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u957f\u5bbd\u6bd4\u76f8\u540c\uff0c\u957f\u548c\u5bbd\u7684\u5c3a\u5bf8\u53ef\u4ee5\u6709\u591a\u79cd\uff0c\u53ea\u8981\u4ed6\u4eec\u6700\u540e\u7ea6\u5206\u540e\u7684\u6bd4\u4f8b\u76f8\u540c\u3002</p> <pre><code>    // \u540c\u4e00\u4e2a\u957f\u5bbd\u6bd4\uff0c\u5bf9\u5e94\u591a\u4e2a\u5c3a\u5bf8\n    private final ArrayMap&lt;AspectRatio, SortedSet&lt;Size&gt;&gt; mRatios = new ArrayMap&lt;&gt;();\n</code></pre> <p>\u6bd4\u5982\uff0c\u5c3a\u5bf8\u662f 1920 * 1080 \u548c 1280 * 720 \u7684\u957f\u5bbd\u6bd4\u90fd\u662f 16 : 9\uff0c\u800c\u5c3a\u5bf8\u662f 800 * 600 \u548c 640 * 480 \u7684\u7684\u957f\u5bbd\u6bd4\u90fd\u662f 4 : 3\u3002</p> <p>\u5728\u8fd9\u91cc\u8bf4\u6cd5\u662f \u957f\u5bbd\u6bd4\uff0c\u4e5f\u6709\u8bf4\u8bdd\u662f \u5bbd\u9ad8\u6bd4 \u7684\u3002\u5b9e\u9645\u4e0a\u90fd\u662f\u76f8\u540c\u7684\uff0c\u90fd\u662f\u5c06\u624b\u673a\u6a2a\u653e\u65f6\u7684\uff0c\u8f83\u957f\u7684\u90a3\u4e00\u8fb9\u6bd4\u8f83\u77ed\u7684\u90a3\u4e00\u8fb9\u7684\u503c\u3002</p> <p>\u5728\u8ba1\u7b97\u957f\u5bbd\u6bd4\u65f6\uff0c\u9700\u8981\u6c42\u51fa\u5bbd\u548c\u9ad8\u6570\u503c\u7684\u6700\u5927\u516c\u7ea6\u6570\uff0c\u8fd9\u6837\u624d\u80fd\u8fdb\u884c\u7ea6\u5206\u8ba1\u7b97\uff0c\u6839\u636e\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5\uff0c\u53c8\u53eb\u505a<code>\u8f97\u8f6c\u76f8\u9664\u6cd5</code>\uff1a\u4e24\u4e2a\u6574\u6570\u7684\u6700\u5927\u516c\u7ea6\u6570\u7b49\u4e8e\u5176\u4e2d\u8f83\u5c0f\u7684\u90a3\u4e2a\u6570\u548c\u4e24\u4e2a\u6570\u76f8\u9664\u4f59\u6570\u7684\u6700\u5927\u516c\u7ea6\u6570\u3002\u8f6c\u6362\u6210\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>    // a &gt; b\n    private static int gcd(int a, int b) {\n        while (b != 0) {\n            int c = b;\n            b = a % b;\n            a = c;\n        }\n        return a;\n    }\n</code></pre>","tags":["Camera"]},{"location":"android/android-camera-aspect-ratio--and-orientation/#_3","title":"\u62cd\u6444\u5e27\u5c3a\u5bf8","text":"<p>\u901a\u8fc7 <code>getSupportedPictureSizes</code> \u65b9\u6cd5\u53ef\u4ee5\u5f97\u5230\u652f\u6301\u7684\u62cd\u6444\u5e27\u7684\u5c3a\u5bf8\u96c6\u5408\u3002</p> <pre><code>        // Supported picture sizes;\n        private final SizeMap mPictureSizes = new SizeMap();\n        mPictureSizes.clear();\n        for (Camera.Size size : mCameraParameters.getSupportedPictureSizes()) {\n            mPictureSizes.add(new Size(size.width, size.height));\n        }\n</code></pre> <p>\u5b58\u50a8\u7ed3\u6784\u548c\u9884\u89c8\u5e27\u76f8\u4f3c\uff0c\u5728\u5f97\u5230\u5c3a\u5bf8\u96c6\u5408\u65f6\uff0c\u4e5f\u8ba1\u7b97\u4e86\u5b83\u4eec\u5bf9\u5e94\u7684\u957f\u5bbd\u6bd4\u3002</p> <p>\u800c Android \u663e\u793a\u76f8\u673a\u9884\u89c8\u5185\u5bb9\u7684\u63a7\u4ef6\u5c3a\u5bf8\uff0c\u5728\u63a7\u4ef6\u5bf9\u5e94\u7684\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u62ff\u5230\u5b83\u7684 Width \u548c Height \u3002</p>","tags":["Camera"]},{"location":"android/android-camera-aspect-ratio--and-orientation/#_4","title":"\u8ba1\u7b97\u5bbd\u9ad8\u6bd4","text":"<p>\u6709\u4e86\u8fd9\u4e09\u7c7b\u5c3a\u5bf8\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u8981\u5982\u4f55\u5904\u7406\u4e86\u3002</p> <p>\u4e3a\u4e86\u5728\u9884\u89c8\u548c\u62cd\u6444\u65f6\uff0c\u56fe\u50cf\u4e0d\u4f1a\u51fa\u73b0\u62c9\u4f38\u73b0\u8c61\uff0c\u9884\u89c8\u5e27\u7684\u957f\u5bbd\u6bd4\u6700\u597d\u548c\u663e\u793a\u63a7\u4ef6\u7684\u957f\u5bbd\u6bd4\u4e00\u81f4\uff0c\u5e76\u4e14\u62cd\u6444\u5e27\u7684\u957f\u5bbd\u6bd4\u4e5f\u548c\u9884\u89c8\u5e27\u548c\u663e\u793a\u63a7\u4ef6\u7684\u957f\u5bbd\u6bd4\u4e00\u81f4\uff0c\u603b\u4e4b\u4e09\u8005\u7684\u957f\u5bbd\u6bd4\u6700\u597d\u662f\u4e00\u81f4\u7684\uff0c\u624d\u4f1a\u6709\u6700\u597d\u7684\u9884\u89c8\u548c\u62cd\u6444\u6548\u679c</p> <p>\u56e0\u4e3a\u624b\u673a\u9884\u89c8\u63a7\u4ef6\u7684\u56fe\u50cf \u662f\u7531 \u76f8\u673a\u9884\u89c8\u5e27 \u6839\u636e \u63a7\u4ef6\u5927\u5c0f **\u7f29\u653e**\u5f97\u6765\u7684\uff0c\u5f53\u957f\u5bbd\u6bd4\u4e0d\u4e00\u81f4\u65f6\u5fc5\u7136\u4f1a\u5bfc\u81f4\u9884\u89c8\u56fe\u50cf\u53d8\u5f62\u3002\u800c\u9884\u89c8\u5e27\u7684\u957f\u5bbd\u6bd4\u548c\u62cd\u6444\u5e27\u7684\u957f\u5bbd\u6bd4\u4e0d\u4e00\u81f4\u7684\u8bdd\uff0c\u53c8\u4f1a\u5bfc\u81f4\u62cd\u6444\u7684\u56fe\u7247\u53d8\u5f62\u62c9\u4f38\u3002</p> <p>\u5728 cameraview \u7684\u6e90\u7801\u4e2d\uff0c\u9996\u5148\u8bbe\u5b9a\u4e86\u9ed8\u8ba4\u7684\u5bbd\u9ad8\u6bd4\u4e3a 4 : 3 \u3002</p> <pre><code>AspectRatio DEFAULT_ASPECT_RATIO = AspectRatio.of(4, 3);\n</code></pre> <p>\u6839\u636e\u8fd9\u4e00\u957f\u5bbd\u6bd4\uff0c\u53ef\u4ee5\u4ece\u9884\u89c8\u5e27\u7684\u5c3a\u5bf8\u96c6\u5408\u4e2d\u5f97\u5230\u90a3\u4e9b\u7b26\u5408\u7684\u5c3a\u5bf8\u5217\u8868\uff0c\u518d\u4ece\u90a3\u4e9b\u5c3a\u5bf8\u5217\u8868\u4e2d\u627e\u5230\u5bbd\u548c\u9ad8\u90fd\u521a\u597d\u5927\u4e8e\u9884\u89c8\u63a7\u4ef6\u7684\u5bbd\u9ad8\u7684\u3002\u82e5\u662f\u5c0f\u4e8e\u9884\u89c8\u63a7\u4ef6\u7684\u5bbd\u9ad8\u5219\u4f1a\u5bfc\u81f4\u56fe\u50cf\u88ab\u62c9\u4f38\u4e86\u3002</p> <pre><code>        SortedSet&lt;Size&gt; sizes = mPreviewSizes.sizes(mAspectRatio);\n        if (sizes == null) { // Not supported\n            mAspectRatio = chooseAspectRatio();\n            // \u6839\u636e\u9009\u5b9a\u7684\u957f\u5bbd\u6bd4\u5f97\u5230\u5bf9\u5e94\u7684\u652f\u6301\u7684\u5c3a\u5bf8\u96c6\u5408\n            sizes = mPreviewSizes.sizes(mAspectRatio);\n        }\n        // \u548c\u9884\u89c8\u63a7\u4ef6\u7684\u5c3a\u5bf8\u76f8\u6bd4\u8f83\uff0c\u4ece\u5c3a\u5bf8\u96c6\u5408\u4e2d\u627e\u5230\u5408\u9002\u7684\u5c3a\u5bf8\n        Size size = chooseOptimalSize(sizes);\n        // \u628a\u627e\u5230\u7684\u5408\u9002\u5c3a\u5bf8\uff0c\u8bbe\u7f6e\u7ed9\u76f8\u673a\u7684\u9884\u89c8\u5e27\n        mCameraParameters.setPreviewSize(size.getWidth(), size.getHeight());\n</code></pre> <p>\u5177\u4f53\u627e\u5230\u5408\u9002\u7684\u9884\u89c8\u5e27\u5c3a\u5bf8\u5927\u5c0f\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>    private Size chooseOptimalSize(SortedSet&lt;Size&gt; sizes) {\n        if (!mPreview.isReady()) { // Not yet laid out\n            return sizes.first(); // Return the smallest size\n        }\n        int desiredWidth;\n        int desiredHeight;\n        // \u9884\u89c8\u754c\u9762\u7684\u5c3a\u5bf8\n        final int surfaceWidth = mPreview.getWidth();\n        final int surfaceHeight = mPreview.getHeight();\n        // \u662f\u5426\u662f\u6a2a\u5c4f,\u82e5\u662f\u6a2a\u5c4f\u7684\u8bdd\uff0c\u5bbd\u548c\u9ad8\u76f8\u4e92\u8c03\u6362\n        if (isLandscape(mDisplayOrientation)) {\n            desiredWidth = surfaceHeight;\n            desiredHeight = surfaceWidth;\n        } else {\n            desiredWidth = surfaceWidth;\n            desiredHeight = surfaceHeight;\n        }\n\n        // \u4ece\u9009\u5b9a\u7684\u957f\u5bbd\u6bd4\u652f\u6301\u7684\u5c3a\u5bf8\u4e2d\uff0c\u627e\u5230\u957f\u548c\u5bbd\u90fd\u5927\u4e8e\u6216\u7b49\u4e8e\u63a7\u4ef6\u5c3a\u5bf8\u7684\n        Size result = null;\n        for (Size size : sizes) { // Iterate from small to large\n            if (desiredWidth &lt;= size.getWidth() &amp;&amp; desiredHeight &lt;= size.getHeight()) {\n                return size;\n            }\n            result = size;\n        }\n        // \u5b9e\u5728\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\uff0c\u9009\u62e9\u652f\u6301\u5c3a\u5bf8\u4e2d\u6700\u5927\u7684\u8fd4\u56de\u3002\n        return result;\n    }\n</code></pre> <p>\u6ce8\u610f\u5230\uff0c\u5f53\u5c4f\u5e55\u5904\u4e8e\u6a2a\u5c4f\u6a21\u5f0f\u5f0f\uff0c\u9884\u89c8\u63a7\u4ef6\u7684\u5bbd\u548c\u9ad8\u5c31\u53d1\u751f\u53d8\u6362\u4e86\uff0c\u8981\u76f8\u4e92\u8c03\u6362\u3002</p> <p>\u627e\u5230\u5408\u9002\u7684\u9884\u89c8\u5e27\u7684\u5c3a\u5bf8\u540e\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u7ed9\u76f8\u673a\u4e86\u3002</p> <p>\u800c\u76f8\u673a\u62cd\u6444\u5e27\u7684\u5c3a\u5bf8\uff0c\u4e5f\u662f\u8981\u6839\u636e\u957f\u5bbd\u6bd4\u6765\u9009\u5b9a\u3002</p> <pre><code>        final Size pictureSize = mPictureSizes.sizes(mAspectRatio).last();\n</code></pre> <p>\u5728\u5bbd\u9ad8\u6bd4\u4e00\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c\u62cd\u6444\u5e27\u5f80\u5f80\u9009\u62e9\u5c3a\u5bf8\u6700\u5927\u7684\uff0c\u90a3\u6837\u62cd\u6444\u7684\u56fe\u7247\u66f4\u6e05\u695a\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u6700\u540e\u4f7f\u7528 <code>last</code> \u65b9\u6cd5\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5728\u786e\u5b9a\u597d\u4e86\u5bbd\u9ad8\u6bd4\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u5bf9\u5e94\u7684\u5c3a\u5bf8\u4e86\u3002</p> <p>\u5728 Google \u7684  android-Camera2Basic \u5de5\u7a0b\u4e2d\uff0c\u4e5f\u6709\u8fd9\u6837\u4e00\u6bb5\u8bbe\u7f6e\u5c3a\u5bf8\u7684\u4ee3\u7801\uff0c\u4e0d\u540c\u7684\u5b83\u662f\u6839\u636e\u62cd\u6444\u7684\u56fe\u7247\u7684\u6700\u5927\u5c3a\u5bf8\u786e\u5b9a\u597d\u4e86\u957f\u5bbd\u6bd4\uff0c\u800c\u4e0d\u662f\u9ed8\u8ba4\u9009\u62e9\u666e\u904d\u7684 4 : 3 \u7684\u6bd4\u4f8b\uff0c\u4e4b\u540e\u5728\u6b64\u57fa\u7840\u4e4b\u4e0a\u624d\u8fdb\u884c\u8bbe\u7f6e\u3002</p> <pre><code>       Size largest = Collections.max(Arrays.asList(map.getOutputSizes(ImageFormat.JPEG)),\n                        new CompareSizesByArea());\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u76f8\u673a\u4e2d\u8bbe\u7f6e\u5bbd\u9ad8\u6bd4\u8fd8\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u73af\u8282\u3002</p>","tags":["Camera"]},{"location":"android/android-camera-aspect-ratio--and-orientation/#_5","title":"\u65b9\u5411","text":"<p>\u641e\u5b9a\u4e86\u5c3a\u5bf8\u95ee\u9898\uff0c\u8fd8\u5269\u4e0b\u65b9\u5411\u4e86\u3002</p> <p>\u76f8\u673a\u6709\u4e24\u79cd\u65b9\u5411\u9700\u8981\u5904\u7406\uff1a</p> <ul> <li>\u9884\u89c8\u5e27\u65b9\u5411</li> <li>\u62cd\u6444\u5e27\u65b9\u5411</li> </ul> <p>\u4e3a\u4e86\u83b7\u5f97\u66f4\u597d\u7684\u76f8\u673a\u4f53\u9a8c\uff0c\u8981\u5904\u7406\u597d\u9884\u89c8\u5e27\u548c\u62cd\u6444\u5e27\u7684\u65b9\u5411\uff0c\u4fdd\u8bc1\u901a\u8fc7\u624b\u673a\u5c4f\u5e55\u770b\u5230\u7684\u5185\u5bb9\u90fd\u662f\u65b9\u5411\u6b63\u5e38\u7684\u3002</p> <p>\u9996\u5148\u8981\u660e\u786e\u624b\u673a\u7684\u81ea\u7136\u65b9\u5411\uff1a</p> <ul> <li>\u5f53\u624b\u673a\u5c4f\u5e55 <code>\u7ad6\u7acb\u65f6\u7684\u81ea\u7136\u65b9\u5411</code>\uff0c\u6b64\u65f6\uff0c\u5750\u6807\u539f\u70b9\u4f4d\u4e8e\u5de6\u4e0a\u89d2\uff0c\u5411\u53f3\u4e3a X \u8f74\u6b63\u65b9\u5411\uff0c\u5411\u4e0b\u4e3a Y \u8f74\u6b63\u65b9\u5411\uff0c\u5bbd\u6bd4\u9ad8\u77ed\u3002</li> <li>\u5f53\u624b\u673a\u5c4f\u5e55 <code>\u6a2a\u653e\u65f6\u7684\u81ea\u7136\u65b9\u5411</code>\uff0c\u6b64\u65f6\uff0c\u5750\u6807\u539f\u70b9\u4f4d\u4e8e\u5de6\u4e0a\u89d2\uff0c\u5411\u53f3\u4e3a X \u8f74\u6b63\u65b9\u5411\uff0c\u5411\u4e0b\u4e3a Y \u8f74\u6b63\u65b9\u5411\uff0c\u5bbd\u6bd4\u9ad8\u957f\u3002</li> </ul>","tags":["Camera"]},{"location":"android/android-camera-aspect-ratio--and-orientation/#_6","title":"\u9884\u89c8\u5e27\u65b9\u5411","text":"<p>\u800c\u76f8\u673a\u7684\u56fe\u50cf\u6570\u636e\u662f\u6765\u81ea\u76f8\u673a\u786c\u4ef6\u56fe\u50cf\u4f20\u611f\u5668\u7684\uff0c\u4f20\u611f\u5668\u88ab\u56fa\u5b9a\u5728\u624b\u673a\u4e0a\u540e\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684\u53d6\u666f\u65b9\u5411\uff1a\u5750\u6807\u539f\u70b9\u4f4d\u4e8e\u624b\u673a**\u9006\u65f6\u9488\u6a2a\u653e**\u65f6\u7684\u5de6\u4e0a\u89d2\uff0c\u5373\u4e0e\u6a2a\u5c4f\u5e94\u7528\u7684\u5c4f\u5e55 X \u65b9\u5411\u4e00\u81f4\u3002\u4e5f\u5c31\u662f\u4e0e\u7ad6\u5c4f\u5e94\u7528\u7684\u5c4f\u5e55 X \u65b9\u5411\u5448 90 \u5ea6\u89d2\u3002</p> <p>\u8fd9\u91cc\u76d7\u56fe\u51e0\u5f20\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u5bf9\u4e8e\u6a2a\u5c4f\u5e94\u7528\u6765\u8bf4\uff0c\u5c4f\u5e55\u7684\u81ea\u7136\u65b9\u5411\u548c\u76f8\u673a\u7684\u56fe\u50cf\u4f20\u611f\u5668\u65b9\u5411\u4e00\u81f4\uff0c\u56e0\u6b64\u770b\u5230\u7684\u56fe\u50cf\u662f\u6b63\u7684\u3002\u800c\u5bf9\u4e8e\u7ad6\u5c4f\u5e94\u7528\u6765\u8bf4\uff0c\u9884\u89c8\u56fe\u50cf\u5c31\u4fa7\u8fc7\u6765\u4e86\u3002\u9700\u8981\u5c06\u9884\u89c8\u56fe\u50cf\u987a\u65f6\u9488\u65cb\u8f6c 90 \u5ea6\u89d2\u624d\u53ef\u4ee5\u6b63\u5e38\u9884\u89c8\u56fe\u50cf\u3002</p> <p>\u6a2a\u5c4f\u62cd\u6444\u7ed3\u679c\uff1a</p> <p></p> <p>\u7ad6\u5c4f\u62cd\u6444\u7ed3\u679c\uff1a</p> <p></p> <p>\u5173\u4e8e\u76f8\u673a\u7684\u9884\u89c8\u65b9\u5411\u548c\u5c4f\u5e55\u81ea\u7136\u65b9\u5411\u5b58\u5728 90 \u5ea6\u89d2\u7684\u504f\u5dee\uff0c\u5728 Camera \u7684 <code>orientation</code>\u5c5e\u6027\u4e2d\u4e5f\u6709\u8bf4\u660e\uff1a</p> <p></p> <p>orientation \u8868\u793a\u76f8\u673a\u56fe\u50cf\u7684\u65b9\u5411\u3002\u5b83\u7684\u503c\u662f\u76f8\u673a\u56fe\u50cf\u987a\u65f6\u9488\u65cb\u8f6c\u5230\u8bbe\u5907\u81ea\u7136\u65b9\u5411\u4e00\u81f4\u65f6\u7684\u56fe\u50cf\uff0c\u5b83\u53ef\u80fd\u662f 0\u300190\u3001180\u3001270 \u56db\u79cd\u3002</p> <p>\u5bf9\u4e8e\u7ad6\u5c4f\u5e94\u7528\u6765\u8bf4\uff0c\u540e\u7f6e\u76f8\u673a\u4f20\u611f\u5668\u662f\u6a2a\u5c4f\u5b89\u88c5\u7684\uff0c\u5f53\u4f60\u9762\u5411\u5c4f\u5e55\u65f6\uff0c\u5982\u679c\u540e\u7f6e\u76f8\u673a\u4f20\u611f\u5668\u9876\u8fb9\u548c\u8bbe\u5907\u81ea\u7136\u65b9\u5411\u7684\u53f3\u8fb9\u662f\u5e73\u884c\u7684\uff0c\u90a3\u4e48\u540e\u7f6e\u76f8\u673a\u7684 orientation \u662f 90\u3002\u5982\u679c\u662f\u524d\u7f6e\u76f8\u673a\u4f20\u611f\u5668\u9876\u8fb9\u548c\u8bbe\u5907\u81ea\u7136\u65b9\u5411\u7684\u53f3\u8fb9\u662f\u5e73\u884c\u7684\uff0c\u5219\u524d\u7f6e\u76f8\u673a\u7684 orientation \u662f 270 \u3002</p> <p>\u5bf9\u4e8e\u524d\u7f6e\u548c\u540e\u7f6e\u76f8\u673a\u4f20\u611f\u5668 orientation \u662f\u4e0d\u540c\u7684\uff0c\u5728\u4e0d\u540c\u7684\u8bbe\u5907\u4e0a\u4e5f\u53ef\u80fd\u4f1a\u6709\u4e0d\u540c\u7684\u503c\u3002</p> <p>\u5728\u6ca1\u6709\u9650\u5b9a Activity \u65b9\u5411\u65f6\uff0c\u91c7\u7528\u5b98\u65b9\u63a8\u8350\u7684\u4ee3\u7801\u6765\u8bbe\u7f6e\u65b9\u5411\uff1a</p> <p><pre><code>  public static void setCameraDisplayOrientation(Activity activity, int cameraId, android.hardware.Camera camera) {\n        android.hardware.Camera.CameraInfo info =\n                new android.hardware.Camera.CameraInfo();\n        android.hardware.Camera.getCameraInfo(cameraId, info);\n        int rotation = activity.getWindowManager().getDefaultDisplay()\n                .getRotation();\n        int degrees = 0;\n        switch (rotation) {\n            case Surface.ROTATION_0:\n                degrees = 0;\n                break;\n            case Surface.ROTATION_90:\n                degrees = 90;\n                break;\n            case Surface.ROTATION_180:\n                degrees = 180;\n                break;\n            case Surface.ROTATION_270:\n                degrees = 270;\n                break;\n        }\n\n        int result;\n        if (info.facing == Camera.CameraInfo.CAMERA_FACING_FRONT) {\n            result = (info.orientation + degrees) % 360;\n            result = (360 - result) % 360;  // compensate the mirror\n        } else {  // back-facing\n            result = (info.orientation - degrees + 360) % 360;\n        }\n        camera.setDisplayOrientation(result);\n    }\n</code></pre> \u9996\u5148\u8ba1\u7b97\u5f97\u5230\u8bbe\u5907\u9006\u65f6\u9488\u65cb\u8f6c\u7684\u89d2\u5ea6\uff0c\u5bf9\u4e8e\u540e\u7f6e\u6444\u50cf\u5934\u4f20\u611f\u5668\u7684\u8ba1\u7b97\uff1a(info.orientation - degrees + 360) % 360 \u3002</p> <p>\u56e0\u4e3a\u6444\u50cf\u5934\u56fe\u50cf\u65b9\u5411\u8981\u6062\u590d\u5230\u81ea\u7136\u65b9\u5411\u9700\u8981\u987a\u65f6\u9488\u65cb\u8f6c\uff0c\u800c\u5c4f\u5e55\u9006\u65f6\u9488\u65cb\u8f6c\u6b63\u597d\u62b5\u6389\u4e86\u6444\u50cf\u5934\u7684\u65cb\u8f6c\uff0c\u6240\u4ee5\u4e24\u8005\u76f8\u51cf\uff0c\u7136\u540e\u518d\u52a0\u4e0a 360 \u53d6\u6a21\u8fd0\u7b97\u3002</p> <p>\u5bf9\u4e8e\u524d\u7f6e\u6444\u50cf\u5934\u4f20\u611f\u5668\uff0c\u56e0\u4e3a\u5728\u4f7f\u7528\u524d\u7f6e\u6444\u50cf\u5934\u65f6\uff0c\u4ece\u5c4f\u5e55\u7ad6\u76f4\u65b9\u5411\u770b\u5230\u7684\u5f80\u5f80\u662f\u4e00\u4e2a\u955c\u50cf\uff0c\u8fd9\u662f\u56e0\u4e3a\u6444\u50cf\u5934\u786c\u4ef6\u5bf9\u56fe\u50cf\u505a\u4e86\u6c34\u5e73\u7ffb\u8f6c\uff0c\u4e5f\u5c31\u662f\u5c06\u56fe\u50cf\u5185\u5bb9\u5bf9\u7740\u7ad6\u76f4\u65b9\u5411\u5bf9\u8c03\u4e86\uff0c\u76f8\u5f53\u4e8e\u9884\u5148\u65cb\u8f6c\u4e86 180 \u5ea6\u3002\u4e4b\u540e\u518d\u53ea\u9700\u8981\u65cb\u8f6c 90 \u5ea6\u5c31\u53ef\u4ee5\u5230\u81ea\u7136\u65b9\u5411\u4e86\uff0c\u53ea\u4e0d\u8fc7\u662f\u4e2a\u955c\u50cf\uff0c\u5373\u5de6\u53f3\u7ffb\u8f6c\u4e86\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u5728 API 14 \u4e4b\u524d\uff0c\u8c03\u7528 setDisplayOrientation \u65b9\u6cd5\u65f6\u8981\u5148\u5173\u95ed\u9884\u89c8\u3002</p> <p>\u6700\u540e\u76d7\u56fe\u66f4\u6e05\u6670\u660e\u4e86\u4e00\u4e0b\uff1a</p> <p></p>","tags":["Camera"]},{"location":"android/android-camera-aspect-ratio--and-orientation/#_7","title":"\u62cd\u6444\u5e27\u65b9\u5411","text":"<p>\u786e\u5b9a\u4e86\u9884\u89c8\u65f6\u7684\u65b9\u5411\uff0c\u8fd8\u9700\u8981\u786e\u5b9a\u62cd\u6444\u65f6\u7684\u65b9\u5411\u3002</p> <p>\u901a\u8fc7 Camera.Parameters.setRotation \u51fd\u6570\u53ef\u4ee5\u8bbe\u7f6e\u76f8\u673a\u6700\u7ec8\u62cd\u51fa\u7684\u56fe\u7247\u65b9\u5411\u3002</p> <p>\u5b98\u65b9\u7684\u63a8\u8350\u4ee3\u7801\uff1a</p> <pre><code>    public void onOrientationChanged(int orientation) {\n        if (orientation == ORIENTATION_UNKNOWN) {\n            return;\n        }\n        android.hardware.Camera.CameraInfo info = new android.hardware.Camera.CameraInfo();\n        android.hardware.Camera.getCameraInfo(cameraId, info);\n\n        orientation = (orientation + 45) / 90 * 90;\n        int rotation = 0;\n\n        if (info.facing == CameraInfo.CAMERA_FACING_FRONT) {\n            rotation = (info.orientation - orientation + 360) % 360;\n        } else {  // back-facing camera\n            rotation = (info.orientation + orientation) % 360;\n        }\n        mParameters.setRotation(rotation);\n    }\n</code></pre> <p>\u8ba1\u7b97\u65cb\u8f6c\u7684\u65b9\u5411\uff0c\u9700\u8981\u8003\u8651\u5230\u5f53\u524d\u5c4f\u5e55\u7684\u65b9\u5411\u548c\u76f8\u673a\u7684\u65b9\u5411\u3002</p> <p>OrientationEventListener \u548c Camera.orientation \u4e00\u8d77\u914d\u5408\u4f7f\u7528\u3002\u5f53\u5c4f\u5e55\u65b9\u5411\u6539\u53d8\u65f6\uff0cOrientationEventListener \u4f1a\u6536\u5230\u76f8\u5e94\u7684\u901a\u77e5\uff0c\u5728 onOrientationChanged \u7684\u56de\u8c03\u65b9\u6cd5\u4e2d\u53bb\u6539\u53d8\u76f8\u673a\u7684\u62cd\u6444\u65b9\u5411\uff0c\u5b9e\u9645\u4e0a\u5728\u76f8\u673a\u9884\u89c8\u65b9\u5411\u7684\u6539\u53d8\u4e5f\u662f\u5728\u8be5\u56de\u8c03\u65b9\u6cd5\u4e2d\u8fdb\u884c\u7684\u3002</p> <p>onOrientationChanged \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u662f\u4ece 0 ~ 359\u3002\u800c setRotation \u7684\u503c\u53ea\u80fd\u662f 0\u300190\u3001180\u3001270\u3002\u6240\u4ee5\u9700\u8981\u5bf9\u5c4f\u5e55\u65b9\u5411\u7684 orientation \u505a\u4e00\u4e2a\u7c7b\u4f3c\u56db\u820d\u4e94\u5165\u7684\u64cd\u4f5c\u3002</p> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u6b64\u56de\u8c03\u4e2d\u6839\u636e Display \u7c7b\u7684 getRotation \u65b9\u6cd5\u5f97\u5230\u65b9\u5411\u5c31\u884c\uff0c\u603b\u4e4b\u5c31\u662f\u6709\u4e00\u4e2a\u56de\u8c03\u7684\u901a\u77e5\uff0c\u7136\u540e\u5728\u6b64\u6539\u53d8\u5c4f\u5e55\u62cd\u6444\u548c\u9884\u89c8\u7684\u65b9\u5411\u3002</p> <p>\u5bf9\u4e8e\u524d\u7f6e\u6444\u50cf\u5934\uff0c\u6444\u50cf\u5934\u7684 orientation \u548c\u5c4f\u5e55\u65b9\u5411\u7684 orientation \u4e24\u4e2a\u4e4b\u5dee\u5373\u4e3a\u8981\u65cb\u8f6c\u7684\u89d2\u5ea6\uff1b\u5bf9\u4e8e\u540e\u7f6e\u6444\u50cf\u5934\uff0c\u4e24\u8005\u4e4b\u548c\u5373\u4e3a\u8981\u65cb\u8f6c\u7684\u89d2\u5ea6\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u5c31\u5bf9\u6444\u50cf\u5934\u5f00\u53d1\u4e2d\u7684\u5c3a\u5bf8\u548c\u65b9\u5411\u8bbe\u7f6e\u6709\u4e2a\u66f4\u6e05\u6670\u7684\u8ba4\u8bc6\u4e86\u3002</p>","tags":["Camera"]},{"location":"android/android-camera-aspect-ratio--and-orientation/#_8","title":"\u53c2\u8003","text":"<ol> <li>https://blog.csdn.net/Tencent_Bugly/article/details/53375311</li> <li>https://blog.csdn.net/daiqiquan/article/details/40650055</li> <li>https://zhuanlan.zhihu.com/p/20559606</li> <li>http://javayhu.me/blog/2017/09/25/camera-development-experience-on-android/</li> </ol>","tags":["Camera"]},{"location":"android/android-change-skin-by-plugin/","title":"Android \u63d2\u4ef6\u6362\u80a4\u539f\u7406\u53ca\u6e90\u7801\u5206\u6790","text":"<p>\u5728\u5b66\u4e60\u5b89\u5353\u63d2\u4ef6\u5316\u5f00\u53d1\u7684\u8def\u4e0a\uff0c\u6709\u4e00\u5904\u98ce\u666f\u662f\u80af\u5b9a\u8981\u89c2\u8d4f\u7684\uff0c\u90a3\u5c31\u662f\u57fa\u4e8e\u63d2\u4ef6\u7684\u5e94\u7528\u6362\u80a4\u4e86\u3002</p>","tags":["Android"]},{"location":"android/android-change-skin-by-plugin/#_1","title":"\u63d2\u4ef6\u6362\u80a4\u539f\u7406\u6982\u8ff0","text":"<p>\u57fa\u4e8e \u63d2\u4ef6\u8fdb\u884c\u5e94\u7528\u6362\u80a4 \u7684\u6280\u672f\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u65b9\u9762\uff1a</p> <ul> <li>\u5982\u4f55\u52a0\u8f7d\u63d2\u4ef6\u5305\u4e2d\u5404\u5f0f\u5404\u6837\u7684\u8d44\u6e90\uff0c\u5982 drawable\u3001color \u7b49\u3002</li> <li>\u5982\u4f55\u5b9a\u4f4d\u5230\u9700\u8981\u6362\u80a4\u7684\u63a7\u4ef6\uff0c\u5e76\u4f18\u96c5\u5730\u66f4\u6539\u6837\u5f0f\uff0c\u5982 \u65e0\u987b\u91cd\u542f\u6362\u80a4 \u7b49\u3002</li> </ul> <p>\u9488\u5bf9\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u76f8\u5173\u7684\u7814\u7a76\u5df2\u7ecf\u6bd4\u8f83\u591a\u4e86\uff0c\u901a\u8fc7\u7814\u7a76 <code>Resource</code>\u7c7b \u7684\u6e90\u7801\uff0c\u5728\u5176\u6784\u9020\u51fd\u6570\u4e2d\u6709\u4e2a<code>AssetManager</code>\u7c7b\u53c2\u6570\uff0c\u800c\u6700\u7ec8\u83b7\u53d6\u8d44\u6e90\u90fd\u662f\u901a\u8fc7<code>AssetManager</code>\u6765\u83b7\u53d6\u7684\u3002</p> <p>\u4e8e\u662f\uff0c\u901a\u8fc7\u6784\u9020<code>AssetManager</code>\u5e76\u751f\u6210\u63d2\u4ef6\u7684<code>Resource</code>\u7c7b\uff0c\u5c31\u53ef\u4ee5\u52a0\u8f7d\u63d2\u4ef6\u5305\u4e2d\u7684\u8d44\u6e90\u3002</p> <p>\u9488\u5bf9\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff0c\u9996\u5148\u662f\u5b9a\u4f4d\u9700\u8981\u6362\u80a4\u7684\u63a7\u4ef6\uff0c\u5927\u591a\u6570\u662f\u901a\u8fc7\u5728\u63a7\u4ef6\u7684 XML \u5e03\u5c40\u4e2d\u6dfb\u52a0 \u6807\u8bc6\uff0c\u6807\u8bc6\u90a3\u4e9b\u9700\u8981\u6362\u80a4\u7684\u63a7\u4ef6\u53ca\u9700\u8981\u6539\u53d8\u7684\u5c5e\u6027\u3002\u7136\u540e\u518d\u901a\u8fc7\u63a7\u4ef6\u7684<code>set</code>\u65b9\u6cd5\u6539\u53d8\u5c5e\u6027\u5373\u53ef\u3002</p> <p>\u5728\u6539\u53d8\u63a7\u4ef6\u7684\u5c5e\u6027\u65f6\uff0c\u82e5\u6bcf\u6b21\u90fd\u901a\u8fc7\u904d\u5386\u9875\u9762\u6240\u6709 View \u6765\u6362\u80a4\u5219\u6027\u80fd\u5f00\u9500\u592a\u5927\uff0c\u901a\u8fc7 <code>LayoutInflater.Factory</code> \u63a5\u53e3\u5728\u52a0\u8f7d\u5e03\u5c40\u6587\u4ef6\u65f6\u4fbf\u5148\u5904\u7406\u6240\u6709 View \u7684\u5c5e\u6027\uff0c\u53ea\u4fdd\u5b58\u90a3\u4e9b\u9700\u8981\u6362\u80a4\u7684\u63a7\u4ef6\uff0c\u5219\u4f1a\u4f18\u5316\u6027\u80fd\u3002</p> <p>\u5f53\u7136\u8fd8\u662f\u6709\u5176\u4ed6\u95ee\u9898\u5f85\u89e3\u51b3\u7684\uff0c\u4f8b\u5982\uff1a<code>Resource</code>\u7c7b\u52a0\u8f7d\u7684\u8d44\u6e90 ID \u51b2\u7a81\uff0c \u63d2\u4ef6<code>Resource</code>\u4e0d\u540c\u5b89\u5353\u7248\u672c\u7684\u517c\u5bb9\u6027\uff0c\u4f7f\u7528<code>LayoutInflater.Factory</code>\u662f\u4e00\u79cd\u4fb5\u5165\u5f0f\u7f16\u7a0b\uff0c\u4f1a\u5e72\u6d89\u7cfb\u7edf\u6784\u9020 View \u7684\u8fc7\u7a0b\uff0c\u5982\u4f55\u65e0\u4fb5\u5165\u7684\u6362\u80a4\uff0c\u52a8\u6001\u52a0\u8f7d\u7684\u63a7\u4ef6\u5982\u4f55\u8fdb\u884c\u6362\u80a4 \u7b49\u7b49\u95ee\u9898......</p> <p>\u770b\u5230\u5f88\u591a\u6362\u80a4\u7684\u6846\u67b6\u90fd\u53c2\u8003\u4e86\u8be5\u5de5\u7a0b\uff0c\u4e5f\u6765\u5206\u6790\u4e00\u4e0b\u5176\u539f\u7406\u3002</p> <p>\u518d\u4e86\u89e3\u63d2\u4ef6\u6362\u80a4\u7684\u5927\u81f4\u539f\u7406\u540e\uff0c\u518d\u53bb\u5206\u6790\u6362\u80a4\u6846\u67b6\u7684\u6e90\u7801\u5c31\u53d8\u5f97\u7b80\u5355\u591a\u4e86\uff0c\u65e0\u975e\u5c31\u662f\u8981\u89e3\u51b3\u4e0a\u8ff0\u7684\u95ee\u9898\uff0c\u4e0b\u9762\u5c31\u5bf9 Android-Skin-Loader \u6e90\u7801\u8fdb\u884c\u5206\u6790\u3002</p>","tags":["Android"]},{"location":"android/android-change-skin-by-plugin/#_2","title":"\u52a8\u6001\u52a0\u8f7d\u63d2\u4ef6\u8d44\u6e90","text":"<p>\u5728 <code>SkinManager</code>\u7684<code>load</code>\u65b9\u6cd5\u4e2d\uff0c\u52a0\u8f7d\u4e86\u63d2\u4ef6\u5305\uff0c\u5e76\u4e14\u5f97\u5230\u4e86\u63d2\u4ef6\u7684\u8d44\u6e90<code>Resource</code>\u3002 <pre><code>                        PackageManager mPm = context.getPackageManager();\n                        PackageInfo mInfo = mPm.getPackageArchiveInfo(skinPkgPath, PackageManager.GET_ACTIVITIES);\n                        // \u5f97\u5230\u63d2\u4ef6\u5305\u540d\uff0c\u6839\u636e\u5305\u540d\u548c\u8d44\u6e90 ID \u5f97\u5230\u8d44\u6e90\n                        skinPackageName = mInfo.packageName;\n\n                        // \u901a\u8fc7\u53cd\u5c04\u6784\u9020 AssetManager \u7c7b\n                        AssetManager assetManager = AssetManager.class.newInstance();\n                        Method addAssetPath = assetManager.getClass().getMethod(\"addAssetPath\", String.class);\n                        // \u53cd\u5c04\u8c03\u7528 addAssetPath \u65b9\u6cd5\n                        addAssetPath.invoke(assetManager, skinPkgPath);\n                        // \u5f97\u5230\u76ae\u80a4\u63d2\u4ef6\u7684 Resource\n                        Resources superRes = context.getResources();\n                        Resources skinResource = new Resources(assetManager,superRes.getDisplayMetrics(),superRes.getConfiguration());\n\n                        // \u4fdd\u5b58\u76ae\u80a4\u5305\u8def\u5f84\n                        SkinConfig.saveSkinPath(context, skinPkgPath);\n</code></pre></p> <p>\u6709\u4e86\u63d2\u4ef6\u8d44\u6e90<code>Resource</code>\uff0c\u5c31\u53ef\u4ee5\u53bb\u5f97\u5230\u60f3\u8981\u7684\u8d44\u6e90\u4e86\u3002</p>","tags":["Android"]},{"location":"android/android-change-skin-by-plugin/#_3","title":"\u6362\u80a4\u63a7\u4ef6\u53ca\u5c5e\u6027\u7684\u6807\u8bc6","text":"<p>Android-Skin-Loader \u6846\u67b6\u81ea\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>enable</code>\u7684\u5c5e\u6027\uff0c\u7528\u5728 XML \u6587\u4ef6\u4e2d\u6765\u6807\u8bc6\u54ea\u4e9b\u63a7\u4ef6\u9700\u8981\u8fdb\u884c\u6362\u80a4\u3002</p> <p>\u5e76\u4e14 Android-Skin-Loader \u5728\u9700\u8981\u7ee7\u627f\u7684\u57fa\u7c7b <code>BaseActivity</code>\u3001<code>BaseFragment</code>\u3001<code>BaseFragmentActivity</code>\u4e2d\u90fd\u8bbe\u7f6e\u4e86<code>LayoutInflater.Factory</code>\uff0c\u4ee5\u4fbf\u5728\u5e03\u5c40\u52a0\u8f7d\u4e4b\u524d\u8fdb\u884c\u9884\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u4fdd\u5b58\u90a3\u4e9b \u9700\u8981\u6362\u80a4\u7684\u63a7\u4ef6 \u548c\u8bc6\u522b \u9700\u8981\u6362\u80a4\u7684\u5c5e\u6027\uff0c\u8fd9\u91cc \u6362\u80a4\u63a7\u4ef6 \u548c \u6362\u80a4\u5c5e\u6027 \u4e24\u4e2a\u4e1c\u897f\u8981\u533a\u522b\u5f00\uff0c\u5b83\u4eec\u6240\u8981\u8fdb\u884c\u7684\u64cd\u4f5c\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u8981\u5148\u627e\u5230 \u6362\u80a4\u63a7\u4ef6\uff0c\u7136\u540e\u518d\u53bb\u627e\u5b83\u7684 \u6362\u80a4\u5c5e\u6027 \u3002</p> <p><pre><code>@Override\n    public View onCreateView(String name, Context context, AttributeSet attrs) {\n        // \u4ece AttributeSet \u4e2d\u5f97\u5230\u6362\u80a4\u5c5e\u6027\uff0c\u5224\u65ad\u662f\u5426\u9700\u8981\u8fdb\u884c\u6362\u80a4\n        boolean isSkinEnable = attrs.getAttributeBooleanValue(SkinConfig.NAMESPACE, SkinConfig.ATTR_SKIN_ENABLE, false);\n        if (!isSkinEnable){\n                return null; // \u4e0d\u9700\u8981\u6362\u80a4\u7684\uff0c\u5219\u8fd4\u56de null\uff0c\u7531\u7cfb\u7edf\u6784\u9020\n        }\n        // \u6784\u9020\u9700\u8981\u6362\u80a4\u7684 View\n        View view = createView(context, name, attrs);\n        if (view == null){\n            return null;\n        }\n        // \u89e3\u6790\u9700\u8981\u6362\u80a4 View \u7684\u5c5e\u6027\n        parseSkinAttr(context, attrs, view);\n        return view;\n    }\n</code></pre> \u4ee5\u4e0a\u4ee3\u7801\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684\u4fb5\u5165\u5f0f\u7f16\u7a0b\uff0c\u5e72\u6270\u4e86\u7cfb\u7edf\u6784\u9020 View \u7684\u8fc7\u7a0b\uff0c\u6240\u505a\u7684\u5de5\u4f5c\u5c31\u662f\u627e\u51fa\u9700\u8981\u6362\u80a4\u7684 View \u5e76\u4ea4\u7531\u4e0b\u4e00\u6b65\u8fdb\u884c\u89e3\u6790\u3002</p> <p><pre><code>private void parseSkinAttr(Context context, AttributeSet attrs, View view) {\n        List&lt;SkinAttr&gt; viewAttrs = new ArrayList&lt;SkinAttr&gt;();\n\n        for (int i = 0; i &lt; attrs.getAttributeCount(); i++){\n            String attrName = attrs.getAttributeName(i);\n            String attrValue = attrs.getAttributeValue(i);\n\n            if(!AttrFactory.isSupportedAttr(attrName)){\n                continue; // AttrFactory \u5b9a\u4e49\u4e86\u54ea\u4e9b\u5c5e\u6027\u652f\u6301\u6362\u80a4\uff0c\u82e5\u8be5\u5c5e\u6027\u4e0d\u652f\u6301\u6362\u80a4\u5c31\u8df3\u8fc7\u7ee7\u7eed\n            }\n            if(attrValue.startsWith(\"@\")){ // \u8868\u660e\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u4f8b\u5982 @color/red\n                    int id = Integer.parseInt(attrValue.substring(1));\n                    String typeName = context.getResources().getResourceTypeName(id); // \u7c7b\u578b\u540d\n                    String entryName = context.getResources().getResourceEntryName(id); // \u5165\u53e3\u540d\n                    SkinAttr mSkinAttr = AttrFactory.get(attrName, id, entryName, typeName);\n                    if (mSkinAttr != null) {\n                        viewAttrs.add(mSkinAttr);\n                    }\n            }\n            }\n        if(!ListUtils.isEmpty(viewAttrs)){\n            SkinItem skinItem = new SkinItem();\n            skinItem.view = view;\n            skinItem.attrs = viewAttrs;\n            // \u5c06\u9700\u8981 \u6362\u80a4\u7684\u63a7\u4ef6 \u548c \u6362\u80a4\u7684\u5c5e\u6027 \u8fd9\u4e24\u4e2a\u4e1c\u897f\u8fdb\u884c\u4fdd\u5b58\n            mSkinItems.add(skinItem);\n            if(SkinManager.getInstance().isExternalSkin()){\n                skinItem.apply(); // \u5982\u679c\u662f\u5916\u90e8\u7684\u76ae\u80a4\uff0c\u5219\u8981 apply \u4e00\u4e0b\uff0c\u9632\u6b62\u6362\u80a4\u4e0d\u53ca\u65f6\n            }\n        }\n    }\n</code></pre> \u4e0a\u8ff0\u4ee3\u7801\u7684\u4f5c\u7528\u5c31\u662f\u4ece\u9700\u8981\u6362\u80a4\u7684\u63a7\u4ef6\u4e2d\uff0c\u627e\u5230\u90a3\u4e9b\u9700\u8981\u66f4\u6539\u7684\u5c5e\u6027\uff0c\u5e76\u5c06\u5b83\u4fdd\u5b58\u5728<code>mSkinItems</code>\u5168\u5c40\u53d8\u91cf\u4e2d\u3002</p> <p>Android-Skin-Loader \u6846\u67b6\u4e2d\u6709\u4e00\u4e2a\u62bd\u8c61\u57fa\u7c7b<code>SkinAttr</code>\u8868\u793a\u9700\u8981\u66f4\u6539\u7684\u5c5e\u6027\uff0c\u800c\u5177\u4f53\u9700\u8981\u66f4\u6539\u7684\u5c5e\u6027\u90fd\u662f\u7ee7\u627f\u81ea<code>SkinAttr</code>\uff0c\u6240\u4ee5\u5982\u679c\u60f3\u8981\u66f4\u6539\u66f4\u591a\u7684\u5c5e\u6027\uff0c\u5c31\u5fc5\u987b\u81ea\u5df1\u6dfb\u52a0\u5bf9\u5e94\u7684<code>SkinAttr</code>\u7c7b\u4e86\u3002</p> <p>\u89e3\u6790\u5b8c\u5c5e\u6027\u540e\uff0c\u6362\u80a4\u63a7\u4ef6\u53ca\u5c5e\u6027\u90fd\u88ab\u4fdd\u5b58\u5728\u4e86<code>mSkinItems</code>\u5168\u5c40\u53d8\u91cf\u4e2d\uff0c\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u52a0\u8f7d\u5e03\u5c40\u754c\u9762\u7684\u9884\u64cd\u4f5c\u3002</p> <p>\u663e\u7136\uff0cAndroid-Skin-Loader \u6846\u67b6\u5bf9\u4e8e\u89e3\u51b3\u627e\u51fa\u5f85\u66f4\u6539\u7684\u5c5e\u6027\u8fd9\u4e00\u95ee\u9898\uff0c\u5e76\u4e0d\u662f\u90a3\u4e48\u7684\u65b9\u4fbf\uff0c\u5e76\u4e14\u5e72\u9884\u4e86\u7cfb\u7edf\u6784\u9020 View \u7684\u8fc7\u7a0b\u3002</p> <p>\u4e0b\u9762\u7814\u7a76 hongyang \u5927\u795e\u7684\u89e3\u51b3\u601d\u8def\uff1aAndroidChangeSkin \u4ee3\u7801\u3002</p> <p>AndroidChangeSkin \u6846\u67b6\u5e76\u6ca1\u6709\u4f7f\u7528 <code>LayoutInflater.Factory</code>\u65b9\u6848\u4e86\uff0c\u91c7\u7528\u4e86\u4e00\u79cd\u65e0\u4fb5\u5165\u7684\u65b9\u6848\u3002</p> <p>\u5bf9\u4e8e\u6807\u8bc6\u9700\u8981\u6362\u80a4\u7684\u63a7\u4ef6\u8fd9\u4e00\u95ee\u9898\uff0cAndroidChangeSkin \u5e76\u6ca1\u6709\u518d\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5c5e\u6027\uff0c\u800c\u662f\u4f7f\u7528 View \u81ea\u5e26\u7684 <code>tag</code>\u5c5e\u6027\u3002\u5e76\u5728\u5728<code>tag</code>\u5c5e\u6027\u7684\u5b57\u7b26\u4e32\u503c\u4e2d\uff0c\u4f20\u9012\u4e86\u8981\u6362\u80a4\u7684\u6807\u8bc6\u3001\u8981\u6362\u80a4\u7684\u5c5e\u6027\u3001\u8981\u6362\u80a4\u7684\u5c5e\u6027\u540d\u3002\u901a\u8fc7\u89e3\u6790\u8fd9\u4e09\u8005\u6765\u5b8c\u6210\u6807\u8bc6\u7684\u4efb\u52a1\u3002\u8fd9\u6837\u5c31\u4e0d\u5fc5\u8981\u5bf9\u6bcf\u4e2a\u5c5e\u6027\u90fd\u8fdb\u884c\u64cd\u4f5c\u4e86\u3002</p> <p><pre><code>    //\u4f20\u5165activity\uff0c\u627e\u5230content\u5143\u7d20\uff0c\u9012\u5f52\u904d\u5386\u6240\u6709\u7684\u5b50View\uff0c\u6839\u636etag\u547d\u540d\uff0c\u8bb0\u5f55\u9700\u8981\u6362\u80a4\u7684View\n    public static List&lt;SkinView&gt; getSkinViews(Activity activity)\n    {\n        List&lt;SkinView&gt; skinViews = new ArrayList&lt;SkinView&gt;();\n        ViewGroup content = (ViewGroup) activity.findViewById(android.R.id.content);\n        addSkinViews(content, skinViews); // \u627e\u5230\u9700\u8981\u6362\u80a4\u7684 View \u653e\u5230 skinViews \u91cc\u9762\n        return skinViews;\n    }\n\n     /**\n     * \u5f97\u5230\u6362\u80a4\u7684 View \uff0c\u5982\u679c tag \u4e3a null \u6216\u8005 tag \u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u5219\u8fd4\u56de null\n     * \u89e3\u6790\u9700\u8981\u6362\u80a4\u7684 View \uff0c\u5f97\u5230\u6240\u6709\u9700\u8981\u66f4\u6539\u7684\u5c5e\u6027 SkinAttr\n     */\n    public static SkinView getSkinView(View view)\n    {\n        Object tag = view.getTag(R.id.skin_tag_id);\n        if (tag == null)\n        {\n            tag = view.getTag();\n        }\n        if (tag == null) return null;\n        if (!(tag instanceof String)) return null;\n        String tagStr = (String) tag;\n\n        List&lt;SkinAttr&gt; skinAttrs = parseTag(tagStr);\n        if (!skinAttrs.isEmpty())\n        {\n            changeViewTag(view);\n            return new SkinView(view, skinAttrs);\n        }\n        return null;\n    }\n</code></pre> AndroidChangeSkin \u5b8c\u6210\u67e5\u627e*\u6362\u80a4\u63a7\u4ef6*\u548c*\u6362\u80a4\u5c5e\u6027*\u4e24\u5927\u4efb\u52a1\uff0c\u4e4b\u6240\u4ee5\u8bf4\u662f\u65e0\u4fb5\u5165\u6027\uff0c\u5c31\u662f\u56e0\u4e3a\u5b83\u662f\u4ece Activity \u5e03\u5c40\u7684\u9876\u5c42\u5f00\u59cb\u904d\u5386\u7684\uff0c\u662f\u5728\u5e03\u5c40\u6587\u4ef6\u52a0\u8f7d\u5b8c\u6210\u4e4b\u540e\u3002</p>","tags":["Android"]},{"location":"android/android-change-skin-by-plugin/#_4","title":"\u6362\u80a4\u64cd\u4f5c\u53ca\u54cd\u5e94\u56de\u8c03","text":"<p>\u5b8c\u6210\u4e86 View \u7684\u6807\u8bc6\u53ca\u67e5\u627e\u4efb\u52a1\u4e4b\u540e\uff0c\u5269\u4e0b\u5c31\u662f\u6700\u7ec8\u7684\u6362\u80a4\u64cd\u4f5c\u4e86\u3002</p> <p>\u8981\u505a\u5230\u65e0\u987b\u91cd\u542f\u5e94\u7528\u548c Activity \u5b8c\u6210\u6362\u80a4\uff0cAndroid-Skin-Loader \u548c AndroidChangeSkin \u90fd\u662f\u57fa\u4e8e*\u89c2\u5bdf\u8005\u6a21\u5f0f*\u6765\u5904\u7406\u7684\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u56de\u8c03\u65b9\u6cd5\u3002</p> <p>\u6536\u5230\u8fdb\u884c\u6362\u80a4\u7684\u6307\u4ee4\u65f6\uff0c\u5728\u9875\u9762\u4e2d\u54cd\u5e94\u56de\u8c03\u65b9\u6cd5\uff0c\u901a\u8fc7\u76ae\u80a4\u63d2\u4ef6\u7684<code>Resource</code>\u52a0\u8f7d\u5bf9\u5e94\u7684\u8d44\u6e90\u5b8c\u6210\u66ff\u6362\u3002</p> <p>\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u627e\u5230\u4e86\u9700\u8981\u6362\u80a4\u7684 View \u548c\u9700\u8981\u66f4\u6539\u7684\u5c5e\u6027\uff0c\u90a3\u4e48\u6700\u7ec8\u7684\u6362\u80a4\u64cd\u4f5c\u4e5f\u5c31\u662f\u7531\u8fd9\u4e9b View \u6765\u8bbe\u7f6e\u5b83\u7684\u65b0\u5c5e\u6027\uff0c\u63d2\u4ef6\u8d44\u6e90\u7684\u52a0\u8f7d\u4e5f\u5c31\u662f\u53d1\u751f\u5728\u8fd9\u91cc\u4e86\u3002\u4e5f\u53ea\u6709\u5728\u8fd9\u4e2a\u65f6\u5019\uff0c\u624d\u4f1a\u53bb\u52a0\u8f7d\u76ae\u80a4\u63d2\u4ef6\u4e2d\u7684\u8d44\u6e90\uff0c\u800c\u4e4b\u524d\u7684\u7b2c\u4e00\u6b65\u53ea\u662f\u6784\u9020\u63d2\u4ef6\u7684<code>Resource</code>\u5e76\u6ca1\u6709\u52a0\u8f7d\u8d44\u6e90\u3002</p> <p>Android-Skin-Loader \u662f\u4e3a\u6bcf\u4e00\u4e2a\u9700\u8981\u66f4\u6539\u7684\u5c5e\u6027\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7c7b\uff0c\u5e76\u5728\u6b64\u7c7b\u4e2d\u53bb\u52a0\u8f7d\u8d44\u6e90\u3002 <pre><code>public class TextColorAttr extends SkinAttr {\n\n    @Override\n    public void apply(View view) {\n        if(view instanceof TextView){\n            TextView tv = (TextView)view;\n            if(RES_TYPE_NAME_COLOR.equals(attrValueTypeName)){\n         tv.setTextColor(SkinManager.getInstance().convertToColorStateList(attrValueRefId));\n</code></pre></p> <p>\u800c androidChangeSkin \u5219\u6ca1\u6709\u7f16\u5199\u90a3\u4e48\u591a\u7c7b\uff0c\u91c7\u7528\u4e86\u679a\u4e3e\u7c7b\u578b\u6765\u66f4\u6539\u5c5e\u6027\uff0c\u540c\u6837\u4e5f\u662f\u5728\u5c5e\u6027\u4e2d\u52a0\u8f7d\u8d44\u6e90\u3002 <pre><code>public enum SkinAttrType\n{\n    BACKGROUND(\"background\"){\n                @Override\n                public void apply(View view, String resName)\n                {\n                    Drawable drawable = getResourceManager().getDrawableByName(resName);\n                    if (drawable != null)\n                    {\n                        view.setBackgroundDrawable(drawable);\n                    } else{\n                    try{\n                         int color = getResourceManager().getColor(resName);\n                         view.setBackgroundColor(color);\n                    },\n</code></pre></p> <p>\u81f3\u4e8e\uff0c\u57fa\u4e8e\u89c2\u5bdf\u8005\u6a21\u5f0f\u6765\u54cd\u5e94\u6362\u80a4\u64cd\u4f5c\u5c31\u6bd4\u8f83\u7b80\u5355\u4e86\uff0c\u770b\u8fc7\u4ee3\u7801\u5f88\u5bb9\u6613\u77e5\u9053\u662f\u600e\u4e48\u4e00\u4e2a\u7f16\u7a0b\u65b9\u5f0f\u4e86\u3002</p>","tags":["Android"]},{"location":"android/android-change-skin-by-plugin/#view","title":"\u52a8\u6001\u6dfb\u52a0 View \u7684\u6362\u80a4","text":"<p>\u4ee5\u4e0a\u53ea\u662f\u5206\u6790\u4e86\u4ece\u5e03\u5c40\u6587\u4ef6\u4e2d\u52a0\u8f7d\u7684\u6362\u80a4\uff0c\u5bf9\u4e8e\u8fd0\u884c\u65f6\u52a8\u6001\u6dfb\u52a0\u7684 View \u540c\u6837\u53ef\u4ee5\u6362\u80a4\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u80fd\u518d XML \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5c5e\u6027\u4e86\u3002</p> <p>\u6bd5\u7adf\u5373\u4f7f\u662f\u5728\u8fd0\u884c\u65f6\u6dfb\u52a0\u7684 View \u4e5f\u662f\u8981\u5148\u786e\u5b9a\u597d\u9700\u6c42\uff0c\u7f16\u5199\u5bf9\u5e94\u4ee3\u7801\u7684\u3002\u53ea\u4e0d\u8fc7\u5c11\u4e86\u6807\u8bc6\u8be5 View \u662f\u5426\u9700\u8981\u6362\u80a4\u8fd9\u4e00\u6b65\uff0c\u76f4\u63a5\u627e\u5230\u9700\u8981\u6362\u80a4\u7684\u5c5e\u6027\u5c31\u597d\u4e86\uff0c\u5728\u6536\u5230\u6362\u80a4\u6307\u4ee4\u65f6\uff0c\u4e5f\u662f\u52a0\u8f7d\u63d2\u4ef6\u8d44\u6e90\uff0c\u76f4\u63a5\u66f4\u6539\u5c5e\u6027\u5373\u53ef\u3002</p>","tags":["Android"]},{"location":"android/android-change-skin-by-plugin/#_5","title":"\u603b\u7ed3","text":"<p>\u5728\u603b\u7ed3\u4e86\u57fa\u4e8e\u63d2\u4ef6\u6362\u80a4\u7684\u539f\u7406\u548c\u76f8\u5173\u4ee3\u7801\u4e4b\u540e\uff0c\u53d1\u73b0\u5176\u5b9e\u5e94\u7528\u6362\u80a4\u4e5f\u4e0d\u662f\u90a3\u4e48\u96be\u561b....</p>","tags":["Android"]},{"location":"android/android-change-skin-by-plugin/#_6","title":"\u53c2\u8003","text":"<ol> <li>http://blog.zhaiyifan.cn/2015/09/10/Android%E6%8D%A2%E8%82%A4%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/</li> <li>http://blog.csdn.net/zhi184816/article/details/53436761</li> <li>http://www.jianshu.com/p/af7c0585dd5b</li> </ol>","tags":["Android"]},{"location":"android/android-layout-inflater/","title":"Android \u5e03\u5c40\u52a0\u8f7d\u4e4b LayoutInflater","text":"<p>Activity \u5728\u754c\u9762\u521b\u5efa\u65f6\u9700\u8981\u5c06 XML \u5e03\u5c40\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u52a0\u8f7d\u8fdb\u6765\uff0c\u6b63\u5982\u6211\u4eec\u5728 ListView \u6216\u8005 RecyclerView \u4e2d\u9700\u8981\u5c06 Item \u7684\u5e03\u5c40\u52a0\u8f7d\u8fdb\u6765\u4e00\u6837\uff0c\u90fd\u662f\u4f7f\u7528 LayoutInflater \u6765\u8fdb\u884c\u64cd\u4f5c\u7684\u3002</p> <p>LayoutInflater \u5b9e\u4f8b\u7684\u83b7\u53d6\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u4f46\u6700\u7ec8\u662f\u901a\u8fc7<code>(LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE)</code>\u6765\u5f97\u5230\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u52a0\u8f7d\u5e03\u5c40\u7684 <code>LayoutInflater</code> \u662f\u6765\u81ea\u4e8e\u7cfb\u7edf\u670d\u52a1\u7684\u3002</p> <p>\u7531\u4e8e Android \u7cfb\u7edf\u6e90\u7801\u4e2d\u5173\u4e8e Content \u90e8\u5206\u91c7\u7528\u7684\u662f\u88c5\u9970\u6a21\u5f0f\uff0cContext \u7684\u5177\u4f53\u529f\u80fd\u90fd\u662f\u7531 <code>ContextImpl</code> \u6765\u5b9e\u73b0\u7684\u3002\u901a\u8fc7\u5728 ContextImpl \u4e2d\u627e\u5230<code>getSystemService</code>\u7684\u4ee3\u7801\uff0c\u4e00\u8def\u8ddf\u8fdb\uff0c\u5f97\u77e5\u6700\u540e\u8fd4\u56de\u7684\u5b9e\u4f8b\u662f<code>PhoneLayoutInflater</code>\u3002</p> <p><pre><code>        registerService(Context.LAYOUT_INFLATER_SERVICE, LayoutInflater.class,\n                new CachedServiceFetcher&lt;LayoutInflater&gt;() {\n            @Override\n            public LayoutInflater createService(ContextImpl ctx) {\n                return new PhoneLayoutInflater(ctx.getOuterContext());\n            }});\n</code></pre> LayoutInflater \u53ea\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u800c PhoneLayoutInflater \u624d\u662f\u5177\u4f53\u7684\u5b9e\u73b0\u7c7b\u3002</p>","tags":["Android","Inflater"]},{"location":"android/android-layout-inflater/#inflate-view","title":"inflate \u65b9\u6cd5\u52a0\u8f7d View","text":"<p>\u4f7f\u7528 LayoutInflater \u65f6\u5e38\u7528\u65b9\u6cd5\u5c31\u662f<code>inflate</code>\u65b9\u6cd5\u4e86\uff0c\u5c06\u4e00\u4e2a\u5e03\u5c40\u6587\u4ef6 ID \u4f20\u5165\u5e76\u6700\u540e\u89e3\u6790\u6210\u4e00\u4e2a View \u3002</p> <p>LayoutInflater \u52a0\u8f7d\u5e03\u5c40\u7684 inflate \u65b9\u6cd5\u4e5f\u6709\u591a\u79cd\u91cd\u8f7d\u5f62\u5f0f\uff1a <pre><code>View inflate(@LayoutRes int resource, @Nullable ViewGroup root)\nView inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot)\n</code></pre></p> <p>\u800c\u8fd9\u4e24\u8005\u7684\u5dee\u522b\u5c31\u5728\u4e8e\u662f\u5426\u8981\u5c06 <code>resource</code> \u5e03\u5c40\u6587\u4ef6\u52a0\u8f7d\u5230 <code>root</code>\u5e03\u5c40\u4e2d\u53bb\u3002</p> <p>\u4e0d\u8fc7\u6709\u70b9\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff0c\u82e5 <code>root</code>\u4e3a null\uff0c\u5219\u5728 xml \u5e03\u5c40\u4e2d\u4e3a <code>resource</code>\u8bbe\u7f6e\u7684\u5c5e\u6027\u4f1a\u5931\u6548\uff0c\u53ea\u662f\u5355\u7eaf\u7684\u52a0\u8f7d\u5e03\u5c40\u3002 <pre><code>                  // temp \u662f xml \u5e03\u5c40\u4e2d\u7684\u9876\u5c42 View\n                    final View temp = createViewFromTag(root, name, inflaterContext, attrs);\n                    ViewGroup.LayoutParams params = null;\n                    if (root != null) { // root \n                        // root \u4e0d\u4e3a null \u624d\u4f1a\u751f\u6210 layoutParams\n                        params = root.generateLayoutParams(attrs);\n                        if (!attachToRoot) {\n                            //  \u5982\u679c\u4e0d\u6dfb\u52a0\u5230 root \u4e2d\uff0c\u5219\u76f4\u63a5\u628a\u5e03\u5c40\u53c2\u6570\u8bbe\u7f6e\u7ed9 temp\n                            temp.setLayoutParams(params);\n                        }\n                    }\n                    // \u52a0\u8f7d\u5b50 View \n                    rInflateChildren(parser, temp, attrs, true);\n                    if (root != null &amp;&amp; attachToRoot) {\n                        root.addView(temp, params);//\u6dfb\u52a0\u5230\u5e03\u5c40\u4e2d\uff0c\u5219\u5e03\u5c40\u53c2\u6570\u7528\u5230 addView \u4e2d\u53bb\n                    }\n                    if (root == null || !attachToRoot) {\n                        result = temp;\n                    }\n</code></pre></p> <p>\u8ddf\u8fdb<code>createViewFromTag</code>\u65b9\u6cd5\u67e5\u770b View \u662f\u5982\u4f55\u521b\u5efa\u51fa\u6765\u7684\u3002 <pre><code>            View view; // \u6700\u540e\u8981\u8fd4\u56de\u7684 View\n            if (mFactory2 != null) {\n                view = mFactory2.onCreateView(parent, name, context, attrs); // \u662f\u5426\u8bbe\u7f6e\u4e86 Factory2 \n            } else if (mFactory != null) {\n                view = mFactory.onCreateView(name, context, attrs); // \u662f\u5426\u8bbe\u7f6e\u4e86 Factory\n            } else {\n                view = null;\n            }\n            if (view == null &amp;&amp; mPrivateFactory != null) { // \u662f\u5426\u8bbe\u7f6e\u4e86 PrivateFactory\n                view = mPrivateFactory.onCreateView(parent, name, context, attrs);\n            }\n\n            if (view == null) {  // \u5982\u679c\u7684 Factory \u90fd\u6ca1\u6709\u8bbe\u7f6e\u8fc7\uff0c\u6700\u540e\u5728\u751f\u6210 View\n                final Object lastContext = mConstructorArgs[0];\n                mConstructorArgs[0] = context;\n                try {\n                    if (-1 == name.indexOf('.')) { // \u7cfb\u7edf\u63a7\u4ef6 \n                        view = onCreateView(parent, name, attrs);\n                    } else { // \u975e\u7cfb\u7edf\u63a7\u4ef6\uff0c\u81ea\u5b9a\u4e49\u7684 View \n                        view = createView(name, null, attrs);\n                    }\n                } finally {\n                    mConstructorArgs[0] = lastContext;\n                }\n            }\n</code></pre></p> <p>\u5982\u679c\u8bbe\u7f6e\u8fc7 Factory \u63a5\u53e3\uff0c\u90a3\u4e48\u5c06\u7531 Factory \u4e2d\u7684 onCreateView \u65b9\u6cd5\u6765\u751f\u6210 View \u3002</p> <p>\u5173\u4e8e <code>LayoutInflater.Factory</code> \u7684\u4f5c\u7528\uff0c\u5c31\u662f\u7528\u6765\u5728\u52a0\u8f7d\u5e03\u5c40\u65f6\u53ef\u4ee5\u81ea\u884c\u53bb\u521b\u5efa View\uff0c\u62a2\u5728\u7cfb\u7edf\u521b\u5efa View \u4e4b\u524d\u53bb\u521b\u5efa\u3002</p> <p>\u5173\u4e8e <code>LayoutInflater.Factory</code> \u7684\u4f7f\u7528\u573a\u666f\uff0c\u73b0\u5728\u6bd4\u8f83\u591a\u7684\u5c31\u662f\u5e94\u7528\u7684\u6362\u80a4\u4e86\u3002</p> <p>\u82e5\u6ca1\u6709\u8bbe\u7f6e\u8fc7 Factory \u63a5\u53e3\uff0c\u5219\u662f\u5224\u65ad\u662f\u5426\u4e3a\u81ea\u5b9a\u4e49\u63a7\u4ef6\u6216\u8005\u7cfb\u7edf\u63a7\u4ef6\uff0c\u4e0d\u7ba1\u662f onCreateView \u65b9\u6cd5\u8fd8\u662f createView \u65b9\u6cd5\uff0c\u5185\u90e8\u6700\u7ec8\u90fd\u662f\u8c03\u7528\u5230\u4e86 createView \u65b9\u6cd5\uff0c\u901a\u8fc7\u5b83\u6765\u751f\u6210 View \u3002</p> <pre><code>// \u901a\u8fc7\u53cd\u5c04\u751f\u6210 View \u7684\u53c2\u6570\uff0c\u5206\u522b\u662f Context \u548c AttributeSet \u7c7b\nstatic final Class&lt;?&gt;[] mConstructorSignature = new Class[] {\n            Context.class, AttributeSet.class};\n\npublic final View createView(String name, String prefix, AttributeSet attrs)\n            throws ClassNotFoundException, InflateException {\n        Constructor&lt;? extends View&gt; constructor = sConstructorMap.get(name);\n        Class&lt;? extends View&gt; clazz = null;\n\n        if (constructor == null) { // \u4ece\u7f13\u5b58\u4e2d\u5f97\u5230 View \u7684\u6784\u9020\u5668\uff0c\u6ca1\u6709\u5219\u8c03\u7528 getConstructor\n                clazz = mContext.getClassLoader().loadClass(\n                        prefix != null ? (prefix + name) : name).asSubclass(View.class);\n                if (mFilter != null &amp;&amp; clazz != null) {\n                    boolean allowed = mFilter.onLoadClass(clazz);\n                    if (!allowed) {\n                        failNotAllowed(name, prefix, attrs);\n                    }\n                }\n                constructor = clazz.getConstructor(mConstructorSignature);\n                constructor.setAccessible(true);\n                sConstructorMap.put(name, constructor);\n            } else {\n                // If we have a filter, apply it to cached constructor\n                if (mFilter != null) {  // \u8fc7\u6ee4\uff0c\u662f\u5426\u5141\u8bb8\u751f\u6210\u8be5 View\n                    // Have we seen this name before?\n                    Boolean allowedState = mFilterMap.get(name);\n                    if (allowedState == null) {\n                        // New class -- remember whether it is allowed\n                        clazz = mContext.getClassLoader().loadClass(\n                                prefix != null ? (prefix + name) :                  name).asSubclass(View.class);\n                        boolean allowed = clazz != null &amp;&amp; mFilter.onLoadClass(clazz);\n                        mFilterMap.put(name, allowed);\n                        if (!allowed) {\n                            failNotAllowed(name, prefix, attrs);\n                        }\n                    } else if (allowedState.equals(Boolean.FALSE)) {\n                        failNotAllowed(name, prefix, attrs); // \u4e0d\u5141\u8bb8\u751f\u6210\u8be5 View\n                    }\n                }\n            }\n        Object[] args = mConstructorArgs;\n        args[1] = attrs;\n        final View view = constructor.newInstance(args); // \u901a\u8fc7\u53cd\u5c04\u751f\u6210 View\n        return view;\n</code></pre> <p>\u5728 createView \u65b9\u6cd5\u5185\u90e8\uff0c\u9996\u5148\u4ece View \u7684\u6784\u9020\u5668\u7f13\u5b58\u4e2d\u67e5\u627e\u662f\u5426\u6709\u5bf9\u5e94\u7684\u7f13\u5b58\uff0c\u82e5\u6ca1\u6709\u5219\u751f\u6210\u6784\u9020\u5668\u5e76\u4e14\u653e\u5230\u7f13\u5b58\u4e2d\u53bb\uff0c\u82e5\u6709\u6784\u9020\u5668\u5219\u770b\u80fd\u5426\u901a\u8fc7\u8fc7\u6ee4\uff0c\u662f\u5426\u5141\u8bb8\u8be5 View \u751f\u6210\u3002</p> <p>\u6700\u540e\u90fd\u6ee1\u8db3\u6761\u4ef6\u7684\u5219\u662f\u901a\u8fc7 View \u7684\u6784\u9020\u5668\u53cd\u5c04\u751f\u6210\u4e86 View \u3002</p> <p>\u5728\u751f\u6210 View \u65f6\u91c7\u7528 <code>Constructor.newInstance</code>\u8c03\u7528\u6784\u9020\u51fd\u6570\uff0c\u800c\u53c2\u6570\u6240\u9700\u8981\u7684\u53d8\u91cf\u5c31\u662f<code>mConstructorSignature</code>\u53d8\u91cf\u6240\u5b9a\u4e49\u7684\uff0c\u5206\u522b\u662f <code>Context</code> \u548c <code>AttributeSet</code>\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6700\u540e\u751f\u6210 View \u65f6\u4e5f\u4f20\u5165\u4e86\u5bf9\u5e94\u7684\u53c2\u6570\u3002</p> <p>\u91c7\u7528 <code>Constructor.newInstance</code>\u7684\u5f62\u5f0f\u53cd\u5c04\u751f\u6210 View \uff0c\u662f\u4e3a\u4e86\u89e3\u8026\uff0c\u53ea\u9700\u8981\u6709\u4e86\u7c7b\u540d\uff0c\u5c31\u53ef\u4ee5\u52a0\u8f7d\u51fa\u6765\u3002</p> <p>\u7531\u6b64\u53ef\u89c1\uff0cLayoutInflater \u52a0\u8f7d\u5e03\u5c40\u4ecd\u7136\u662f\u9700\u8981\u4f20\u9012 <code>Context</code>\u7684\uff0c\u4e0d\u5149\u662f\u4e3a\u4e86\u5f97\u5230 LayoutInflater \uff0c\u5728\u53cd\u5c04\u751f\u6210 View \u65f6\u540c\u6837\u4f1a\u7528\u5230\u3002</p>","tags":["Android","Inflater"]},{"location":"android/android-layout-inflater/#_1","title":"\u6df1\u5ea6\u904d\u5386\u52a0\u8f7d\u5e03\u5c40","text":"<p>\u5982\u679c\u9700\u8981\u52a0\u8f7d\u7684\u5e03\u5c40\u53ea\u6709\u4e00\u4e2a\u63a7\u4ef6\uff0c\u90a3\u4e48 LayoutInflater \u8fd4\u56de\u90a3\u4e2a View \u5de5\u4f5c\u4e5f\u5c31\u7ed3\u675f\u4e86\u3002</p> <p>\u82e5\u5e03\u5c40\u6587\u4ef6\u4e2d\u6709\u591a\u4e2a\u9700\u8981\u52a0\u8f7d\u7684 View \uff0c\u5219\u901a\u8fc7<code>rInflateChildren</code>\u65b9\u6cd5\u7ee7\u7eed\u52a0\u8f7d\u9876\u5c42 View \u4e0b\u7684 View \uff0c\u6700\u540e\u901a\u8fc7<code>rInflate</code>\u65b9\u6cd5\u6765\u52a0\u8f7d\u3002</p> <p><pre><code>void rInflate(XmlPullParser parser, View parent, Context context,\n            AttributeSet attrs, boolean finishInflate) throws XmlPullParserException, IOException {\n        final int depth = parser.getDepth();\n        int type;\n        // \u82e5 while \u6761\u4ef6\u4e0d\u6210\u7acb\uff0c\u5219\u52a0\u8f7d\u7ed3\u675f\u4e86\n        while (((type = parser.next()) != XmlPullParser.END_TAG ||\n                parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) {\n\n            if (type != XmlPullParser.START_TAG) {\n                continue;\n            }\n            final String name = parser.getName(); // \u4ece XmlPullParser \u4e2d\u5f97\u5230 name \u51fa\u6765\u89e3\u6790\n\n            if (TAG_REQUEST_FOCUS.equals(name)) { // name \u5404\u79cd\u60c5\u51b5\u4e0b\u7684\u89e3\u6790\n                parseRequestFocus(parser, parent);\n            } else if (TAG_TAG.equals(name)) {\n                parseViewTag(parser, parent, attrs);\n            } else if (TAG_INCLUDE.equals(name)) {\n                if (parser.getDepth() == 0) {\n                    throw new InflateException(\"&lt;include /&gt; cannot be the root element\");\n                }\n                parseInclude(parser, context, parent, attrs);\n            } else if (TAG_MERGE.equals(name)) {\n                throw new InflateException(\"&lt;merge /&gt; must be the root element\");\n            } else {\n                final View view = createViewFromTag(parent, name, context, attrs);\n                final ViewGroup viewGroup = (ViewGroup) parent;\n                final ViewGroup.LayoutParams params = viewGroup.generateLayoutParams(attrs);\n                rInflateChildren(parser, view, attrs, true); // \u7ee7\u7eed\u904d\u5386\n                viewGroup.addView(view, params); // \u9876\u5c42 View \u6dfb\u52a0 \u5b50 View\n            }\n        }\n\n        if (finishInflate) { // \u904d\u5386\u89e3\u6790\n            parent.onFinishInflate();\n        }\n    }\n</code></pre> <code>rInflate</code>\u65b9\u6cd5\u9996\u5148\u5224\u65ad\u662f\u5426\u89e3\u6790\u7ed3\u675f\u4e86\uff0c\u82e5\u6ca1\u6709\uff0c\u5219\u4ece XmlPullParser \u4e2d\u52a0\u8f7d\u51fa\u4e0b\u4e00\u4e2a View \u8fdb\u884c\u5904\u7406\uff0c\u4e2d\u95f4\u8fd8\u4f1a\u5bf9\u4e0d\u540c\u7684\u7c7b\u578b\u8fdb\u884c\u5904\u7406\uff0c\u6bd4\u5982<code>TAG_REQUEST_FOCUS</code>\u3001<code>TAG_TAG</code>\u3001<code>TAG_INCLUDE</code>\u3001<code>TAG_MERGE</code>\u7b49\u7b49\u3002</p> <p>\u6700\u540e\u4ecd\u7136\u8fd8\u662f\u901a\u8fc7<code>createViewFromTag</code>\u6765\u751f\u6210 View \uff0c\u5e76\u4ee5\u8fd9\u4e2a\u751f\u6210\u7684 View \u4e3a\u7236\u8282\u70b9\uff0c\u5f00\u59cb\u6df1\u5ea6\u904d\u5386\uff0c\u7ee7\u7eed\u8c03\u7528<code>rInflateChildren</code>\u65b9\u6cd5\u52a0\u8f7d\u5e03\u5c40\uff0c\u5e76\u628a\u8fd9\u4e2a View \u52a0\u5165\u5230\u5b83\u7684\u7236 View \u4e2d\u53bb\u3002</p> <p>\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u751f\u6210 View \u7684\u65b9\u6cd5\u540d\u5b57<code>createViewFromTag</code>\u4ece\u5b57\u9762\u4e0a\u6765\u770b\u662f\u6765\u81ea\u4e8e <code>Tag</code>\u6807\u7b7e\uff0c\u60f3\u5fc5\u662f\u548c <code>XmlPullParser</code>\u89e3\u6790\u5e03\u5c40\u751f\u6210\u7684\u5185\u5bb9\u6709\u5173\u3002</p>","tags":["Android","Inflater"]},{"location":"android/android-layout-inflater/#_2","title":"\u53c2\u8003","text":"<ol> <li>http://www.sunnyang.com/661.html?utm_source=tuicool&amp;utm_medium=referral</li> <li>http://blog.csdn.net/lmj623565791/article/details/51503977</li> <li>https://segmentfault.com/a/1190000003813755</li> <li>http://blog.csdn.net/panda1234lee/article/details/9009719</li> </ol>","tags":["Android","Inflater"]},{"location":"android/android-lrucache/","title":"Android LruCache\u5b9e\u73b0\u5206\u6790","text":"<p>LruCache \u662f\u5b89\u5353\u5f00\u53d1\u4e2d\u5e38\u7528\u5230\u7684\u7f13\u5b58\u6280\u672f\uff0cLRU \u7684\u5168\u540d\u662f Least Recently Used\uff0c\u8868\u793a\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u5185\u5b58\u5feb\u5230\u8fbe\u9608\u503c\u65f6\uff0c\u82e5\u67d0\u4e2a\u5bf9\u8c61\u6700\u8fd1\u5f88\u5c11\u4f7f\u7528\u7684\uff0c\u90a3\u4e48\u5b83\u5c31\u4f1a\u88ab\u56de\u6536\u6389\u4ee5\u91ca\u653e\u5185\u5b58\u3002</p>","tags":["Android"]},{"location":"android/android-lrucache/#_1","title":"\u4f7f\u7528","text":"<p>LruCache \u7684\u4f7f\u7528\u65b9\u6cd5\u5927\u81f4\u5982\u4e0b \uff1a <pre><code>// LruCache \u7684\u58f0\u660e\u521d\u59cb\u5316\n        int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);\n        // \u6307\u5b9a\u7f13\u5b58\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u4e00\u822c\u4e3a\u5f53\u524d\u8fdb\u7a0b\u53ef\u7528\u5185\u5b58\u7684 1/8 \u5373\u53ef\n        int cacheSize = maxMemory / 8 ;\n        LruCache&lt;String,Bitmap&gt; cache = new LruCache&lt;String,Bitmap&gt;(cacheSize){\n\n            // \u5982\u4f55\u8ba1\u7b97\u7f13\u5b58\u7684\u8d44\u6e90\u7684\u5185\u5b58\u5927\u5c0f\n            @Override\n            protected int sizeOf(String key, Bitmap value) {\n                return value.getRowBytes() * value.getHeight() / 1024 ;\n            }\n            // \u5f53\u7f13\u5b58\u5bf9\u8c61\u88ab\u56de\u6536\u65f6\u6267\u884c\u7684\u56de\u8c03\u65b9\u6cd5\uff0c\u4ee5\u4fbf\u91ca\u653e\u4e00\u4e9b\u8d44\u6e90\u4e4b\u7c7b\u7684\uff0c\u9ed8\u8ba4\u4e3a\u7a7a\n            @Override\n            protected void entryRemoved(boolean evicted, String key, Bitmap oldValue, Bitmap newValue) {\n                super.entryRemoved(evicted, key, oldValue, newValue);\n            }\n        };\n        // LruCache \u6dfb\u52a0\u7f13\u5b58\u5bf9\u8c61\n        cache.put(key,bitmap) ;\n        // LruCache \u83b7\u53d6\u7f13\u5b58\u5bf9\u8c61\n        cache.get(key);\n</code></pre></p> <p>LruCache \u7684\u58f0\u660e\u548c\u4f7f\u7528\u90fd\u6bd4\u8f83\u7b80\u5355\uff0c\u5728\u5b83\u7684\u5185\u90e8\u5c31\u5df2\u7ecf\u5e2e\u6211\u4eec\u5b8c\u6210\u4e86\u7f13\u5b58\u5bf9\u8c61\u7684\u79fb\u9664\u548c\u6dfb\u52a0\uff0c\u800c\u6211\u4eec\u65e0\u9700\u8fc7\u591a\u7684\u8003\u8651\u5bf9\u8c61\u7684\u91ca\u653e\u95ee\u9898\u3002</p>","tags":["Android"]},{"location":"android/android-lrucache/#_2","title":"\u539f\u7406\u5206\u6790","text":"<p>\u65e2\u7136\u8981\u7f13\u5b58\u5bf9\u8c61\uff0c\u5fc5\u7136\u8981\u6709\u4e2a\u5bb9\u5668\uff0cLruCache \u4f7f\u7528\u7684\u662f <code>LinkedHashMap</code>\uff0c\u4ee5\u5f3a\u5f15\u7528\u65b9\u5f0f\u5b58\u50a8\u5916\u754c\u7684\u7f13\u5b58\u5bf9\u8c61\u3002</p> <p><code>LinkedHashMap</code>\u662f\u4e00\u4e2a\u53cc\u5411\u7684\u73af\u5f62\u94fe\u8868\uff0c\u94fe\u8868\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u6709\u6307\u5411\u524d\u4e00\u4e2a\u5143\u7d20\u548c\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u5f15\u7528\u3002\u4f7f\u7528\u94fe\u8868\u7684\u597d\u5904\u5c31\u5728\u4e8e\u5b83\u7684\u5220\u9664\u548c\u6dfb\u52a0\u64cd\u4f5c\u66f4\u52a0\u7684\u65b9\u4fbf\u5feb\u6377\u3002</p> <p>\u800c LRU \u7684\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\u601d\u60f3\u5c31\u4f53\u73b0\u5728<code>LinkedHashMap</code>\u7684\u5143\u7d20\u987a\u5e8f\u4e2d\u4e86\u3002</p> <p><code>LinkedHashMap</code>\u4e2d\u7684\u987a\u5e8f\u5f53\u7136\u662f\u4ece\u5934\u5230\u5c3e\u7684\uff0c\u800c\u4e00\u4e2a\u5143\u7d20\u6700\u8fd1\u7684\u4f7f\u7528\u60c5\u51b5\u5f53\u7136\u4e5f\u662f\u4ece\u5934\u5230\u5c3e\u7684\u4e00\u4e2a\u6e10\u53d8\u4e86\u3002\u5728 LruCache \u4e2d\uff0c\u9ed8\u8ba4\u662f\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u5143\u7d20\u4f4d\u4e8e\u94fe\u8868\u7684\u5934\u90e8\uff0c\u800c\u6700\u8fd1\u4f7f\u7528\u6700\u591a\u7684\u5143\u7d20\u5219\u662f\u4f4d\u4e8e\u94fe\u8868\u7684\u5c3e\u90e8\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4ece\u5934\u5230\u5c3e\u7684\u4e00\u4e2a\u6e10\u53d8\u8fc7\u7a0b\u4e5f\u5c31\u662f\u4e00\u4e2a\u5143\u7d20\u4f7f\u7528\u6700\u5c11\u5230\u591a\u7684\u8fc7\u7a0b\u4e86\u3002</p> <p>\u5f53\u6211\u4eec\u5728\u8fdb\u884c\u6bcf\u4e2a<code>get</code>\u548c<code>put</code>\u64cd\u4f5c\u65f6\uff0c<code>LinkedHashMap</code>\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u4f7f\u7528\u60c5\u51b5\u5c31\u8981\u53d1\u751f\u53d8\u5316\u4e86\uff0c\u6bd5\u7adf\u7f13\u5b58\u5bb9\u91cf\u662f\u6709\u9650\u7684\uff0c\u4e00\u4e9b\u4e0d\u5e78\u7684\u5143\u7d20\u53ef\u80fd\u5c31\u56e0\u6b64\u800c\u88ab\u5783\u573e\u56de\u6536\u4e86\uff0c\u4ee5\u6b64\u6765\u4f53\u73b0 LRU \u7684\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7b97\u6cd5\u3002</p> <p>\u4e0b\u9762\u5c31\u5206\u522b\u4ecb\u7ecd\u5176<code>get</code>\u548c<code>put</code>\u64cd\u4f5c\u3002</p>","tags":["Android"]},{"location":"android/android-lrucache/#lrucache-get","title":"LruCache \u7684 get \u64cd\u4f5c","text":"<p>\u4ece LruCache \u4e2d\u53d6\u51fa\u4e00\u4e2a\u5143\u7d20\uff0c\u663e\u7136\uff0c\u8fd9\u4e2a\u7ed3\u679c\u662f\u53ef\u80fd\u4e3a null \u7684\u3002</p> <p>LruCache \u4f7f\u7528<code>get</code>\u64cd\u4f5c\u5f88\u7b80\u5355\uff0c\u6709\u5c31\u53d6\u51fa\u6765\uff0c\u6ca1\u6709\u5c31\u8fd4\u56de\u4e2a null \u3002 <pre><code>        V mapValue;\n        synchronized (this) {\n            mapValue = map.get(key);\n            if (mapValue != null) {\n                hitCount++;\n                return mapValue;\n            }\n            missCount++;\n        }\n</code></pre> \u800c\u91cd\u70b9\u5c31\u5728\u4e8e<code>LinkedHashMap</code>\u7684<code>get</code>\u65b9\u6cd5\u4e86\u3002</p> <p><pre><code>    int hash = Collections.secondaryHash(key); // \u8ba1\u7b97 key \u7684 hash \u503c\n        HashMapEntry&lt;K, V&gt;[] tab = table;\n        for (HashMapEntry&lt;K, V&gt; e = tab[hash &amp; (tab.length - 1)]; e != null; e = e.next) {\n            K eKey = e.key;\n            if (eKey == key || (e.hash == hash &amp;&amp; key.equals(eKey))) {\n                if (accessOrder)\n                    makeTail((LinkedEntry&lt;K, V&gt;) e);\n                return e.value;\n            }\n        }\n</code></pre> <code>LinkedHashMap</code>\u7684\u8282\u70b9\u7c7b\u662f<code>LinkedEntry</code>\uff0c\u5b83\u7ee7\u627f\u81ea<code>HashMapEntry</code>\uff0c\u5728\u5176\u7ee7\u627f\u4e4b\u4e0a\u591a\u4e86\u6307\u5411\u524d\u540e\u5143\u7d20\u7684\u5f15\u7528\u3002</p> <p>\u6240\u4ee5\uff0c\u4ece\u4e0a\u8ff0\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u65e0\u975e\u5c31\u662f\u4e00\u4e2a\u904d\u5386\uff0c\u627e\u5230 <code>key</code>\u5bf9\u5e94\u7684\u5143\u7d20\u5c31\u53d6\u51fa\u6765\uff0c\u5e76\u4e14\u591a\u4e86\u4e00\u4e2a\u64cd\u4f5c<code>makeTail</code>\u3002</p> <p><code>makeTail</code>\u7684\u64cd\u4f5c\u53c8\u662f\u5e72\u4ec0\u4e48\u7684\u5462\uff1f\u5b83\u53ef\u8c13\u662f\u5b9e\u73b0\u6700\u8fd1\u6700\u5c11\u7b97\u6cd5\u7684\u7cbe\u9ad3\u4e86\u3002</p> <pre><code> private void makeTail(LinkedEntry&lt;K, V&gt; e) {\n        // Unlink e \u5c06\u8282\u70b9 e \u7684\u524d\u8282\u70b9\u548c\u540e\u8282\u70b9\u8fdb\u884c\u8fde\u63a5\uff0c\u800c\u5c06\u5b83\u81ea\u5df1\u7ed9\u91ca\u653e\u51fa\u6765\n        e.prv.nxt = e.nxt;\n        e.nxt.prv = e.prv;\n\n        // Relink e as tail \u5c06\u8282\u70b9 e \u8fde\u63a5\u5230\u94fe\u8868\u7684\u5c3e\u90e8\n        LinkedEntry&lt;K, V&gt; header = this.header;\n        LinkedEntry&lt;K, V&gt; oldTail = header.prv;\n        e.nxt = header;\n        e.prv = oldTail;\n        oldTail.nxt = header.prv = e;\n        modCount++;\n    }\n</code></pre> <p><code>makeTail</code>\u64cd\u4f5c\uff0c\u5c06\u4e00\u4e2a<code>get</code>\u7684\u8282\u70b9\uff0c\u4ece\u539f\u672c\u5b83\u5728\u94fe\u8868\u4e2d\u7684\u4f4d\u7f6e\u79fb\u5230\u4e86\u6574\u4e2a\u94fe\u8868\u4e2d\u7684\u5c3e\u90e8\uff0c\u4f7f\u5b83\u7684\u524d\u8282\u70b9\u662f\u4e0a\u4e00\u4efb\u7684\u5c3e\u8282\u70b9\uff0c\u800c\u540e\u8282\u70b9\u5219\u662f\u5934\u7ed3\u70b9\u3002</p> <p>\u800c\u5728\u4e0a\u9762\u63d0\u5230\u8fc7\uff0c<code>LinkedHashMap</code>\u94fe\u8868\u4e2d\u5143\u7d20\u7684\u987a\u5e8f\u6b63\u662f\u5b8c\u7f8e\u7684\u4f53\u73b0\u4e86\u6700\u5c11\u6700\u8fd1\u7b97\u6cd5\u7684\u601d\u60f3\u3002</p> <p><code>get</code>\u5f97\u5230\u7684\u5143\u7d20\u5fc5\u7136\u662f\u6700\u8fd1\u4f7f\u7528\u6700\u591a\u7684\u4e86\uff0c\u6bcf\u6b21 <code>get</code>\u4e4b\u540e\u90fd\u5c06\u5b83\u79fb\u52a8\u5230\u94fe\u8868\u7684\u5c3e\u90e8\uff0c\u4e5f\u6b63\u662f\u6700\u8fd1\u6700\u5c11\u7b97\u6cd5\u7684\u4f53\u73b0\u4e86\u3002</p>","tags":["Android"]},{"location":"android/android-lrucache/#lrucache-put","title":"LruCache \u7684 put \u64cd\u4f5c","text":"<p><code>put</code>\u64cd\u4f5c\u5219\u662f\u5411<code>LinkedHashMap</code>\u4e2d\u653e\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u800c\u7f13\u5b58\u7684\u5bb9\u91cf\u53c8\u662f\u6709\u9650\u7684\uff0c\u8fd9\u4e48\u4e00\u6765\uff0c\u5728\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u4f1a\u6709\u5143\u7d20\u88ab\u5783\u573e\u56de\u6536\u4e86\u3002</p> <pre><code>      V previous;\n        synchronized (this) {\n            putCount++;\n            size += safeSizeOf(key, value);\n            previous = map.put(key, value); // \u82e5\u5b58\u5728 key \u76f8\u540c\u7684\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u4e4b\u524d\u7684\uff0c\u5426\u5219\u8fd4\u56de null\n            if (previous != null) {    // \u5b58\u5728 key \u76f8\u540c\u7684\u5143\u7d20\n                size -= safeSizeOf(key, previous);\n            }\n        }\n        // \u79fb\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u5143\u7d20\n        trimToSize(maxSize);\n</code></pre> <p>\u5f53\u8fdb\u884c<code>put</code>\u64cd\u4f5c\u65f6\uff0c\u82e5\u653e\u5165\u4e00\u4e2a key \u5b58\u5728\u7684\u5143\u7d20\uff0c\u5219\u8fd4\u56de\u5df2\u7ecf\u5b58\u5728\u7684\u5bf9\u5e94\u7684\u503c\u3002</p> <p>\u540c\u65f6\uff0c\u5728\u6bcf\u6b21<code>put</code>\u64cd\u4f5c\u4e4b\u540e\uff0c\u90fd\u8981\u8fdb\u884c\u5bb9\u91cf\u7684\u6e05\u9664\u5de5\u4f5c\u3002</p> <pre><code>public void trimToSize(int maxSize) {\n        while (true) { // \u6b7b\u5faa\u73af\n            K key;\n            V value;\n            synchronized (this) {\n                if (size &lt;= maxSize) {\n                    break;\n                }\n                Map.Entry&lt;K, V&gt; toEvict = map.eldest(); // \u53d6\u51fa\u6700\u8001\u7684\u5143\u7d20\n                if (toEvict == null) {\n                    break;\n                }\n                key = toEvict.getKey();\n                value = toEvict.getValue();\n                map.remove(key);\n                size -= safeSizeOf(key, value);\n                evictionCount++;\n            }\n            entryRemoved(true, key, value, null);\n        }\n    }\n</code></pre> <p><code>trimToSize</code>\u7684\u64cd\u4f5c\u662f\u4e00\u4e2a\u6b7b\u5faa\u73af\u7684\u64cd\u4f5c\uff0c\u5f53<code>size</code>\u5c0f\u4e8e<code>maxSize</code>\u65f6\uff0c\u76f4\u63a5\u8fd4\u56de\uff0c\u5426\u5219\u4ece<code>LinkedHashMap</code>\u4e2d\u79fb\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u5143\u7d20\uff0c\u4e5f\u5c31\u662f\u5934\u8282\u70b9\u540e\u7684\u5143\u7d20\u3002</p> <p>\u4ee5\u4e0a\u5c31\u5927\u81f4\u5b9e\u73b0\u4e86 LRU \u7684\u6700\u5c11\u6700\u8fd1\u7b97\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/android-lrucache/#_3","title":"\u540c\u6b65\u9501\u76f8\u5173\u64cd\u4f5c","text":"<p>\u5728 LruCache \u7684<code>get</code>\u548c<code>put</code>\u64cd\u4f5c\u4e2d\uff0c\u90fd\u6709\u7528\u5230\u7684<code>synchronized</code>\u9501\u64cd\u4f5c\u3002</p> <p>\u8fd9\u662f\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u56e0\u4e3a\u5728<code>get</code>\u548c<code>put</code>\u65b9\u6cd5\u4e2d\u8fdb\u884c\u7684\u90fd\u662f\u590d\u5408\u64cd\u4f5c\uff0c\u5728\u5e76\u53d1\u6761\u4ef6\u4e0b\u4f7f\u7528\u7f13\u5b58\u65f6\u5f88\u5bb9\u6613\u51fa\u73b0\u810f\u6570\u636e\uff0c\u52a0\u4e0a<code>synchronized</code>\u6807\u8bc6\uff0c\u5219\u4fdd\u8bc1\u4e86\u64cd\u4f5c\u7684\u539f\u5b50\u6027\uff0c\u4f7f\u5f97\u6210\u4e3a\u7ebf\u7a0b\u5b89\u5168\u7684\u64cd\u4f5c\u3002</p>","tags":["Android"]},{"location":"android/android-lrucache/#_4","title":"\u53c2\u8003","text":"<p>1\u3001https://github.com/LittleFriendsGroup/AndroidSdkSourceAnalysis/blob/master/article/LruCache%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md</p>","tags":["Android"]},{"location":"android/android-rxjava/","title":"\u5b89\u5353\u5f02\u6b65\u4e4bRxJava","text":"<p>\u4e0d\u5b66\u4e60 RxJava \u7b80\u76f4\u592a\u843d\u540e\u4e86\uff0c\u53c2\u7167\u7f51\u4e0a\u7684\u535a\u5ba2\u4ee5\u53ca\u82f1\u6587\u4e66\u7c4d\u300aRxJavaEssentials\u300b\uff0c\u5f00\u59cb\u4e86 RxJava \u4e4b\u65c5 \u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#rxjava","title":"\u6dfb\u52a0 RxJava","text":"<p>RxJava \u7684 Github \u5730\u5740\u662f \uff1a https://github.com/ReactiveX/RxJava</p> <p>\u6839\u636e Github \u4e0a\u9762\u7684 README \u63d0\u793a\uff0c\u9700\u8981\u5728 http://search.maven.org \u7f51\u7ad9\u4e0a\u67e5\u627e\u9700\u8981\u7684 RxJava \u7684\u7248\u672c\u4fe1\u606f\uff0c\u7136\u540e\u6dfb\u52a0\u5230 Android Studio \u7684 App Module \u7684 gradle \u811a\u672c\u4e2d\u53bb\u3002</p> <p>\u5f53\u524d\u7684\u6700\u65b0\u7684\u7248\u672c\u662f 1.1.9 \uff0c\u6240\u4ee5\u6dfb\u52a0\uff1a</p> <pre><code>compile 'io.reactivex:rxjava:1.1.9'\n</code></pre>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#_1","title":"\u89c2\u5bdf\u8005\u6a21\u5f0f","text":"<p>\u89c2\u5bdf\u8005\u6a21\u5f0f\u662f\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u6a21\u5f0f\u4e86\uff0c\u800c RxJava \u4e5f\u662f\u57fa\u4e8e\u6b64\u62d3\u5c55\u800c\u6765\u7684\u3002</p> <p>Observable \u5c31\u662f\u6211\u4eec\u89c2\u5bdf\u8005\u6a21\u5f0f\u4e2d\u7684\u88ab\u89c2\u5bdf\u8005\uff0c\u800c Observe \u5c31\u662f\u89c2\u5bdf\u8005\u6a21\u5f0f\u4e2d\u7684\u89c2\u5bdf\u8005\u3002\u4e00\u4e2a\u88ab\u89c2\u5bdf\u8005\u53ef\u4ee5\u6301\u6709\u597d\u51e0\u4e2a\u89c2\u5bdf\u8005\u7684\u5f15\u7528\uff0c\u4e00\u65e6\u88ab\u89c2\u5bdf\u8005\u7684\u72b6\u6001\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u5c31\u53ef\u4ee5\u901a\u77e5\u89c2\u5bdf\u8005\u6267\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\u3002</p> <p></p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#_2","title":"\u57fa\u7840\u8bb2\u89e3","text":"<p>\u5728 RxJava \u4e2d\uff0c\u4e3b\u8981\u6709\u56db\u4e2a\u89d2\u8272\uff1a</p> <ul> <li>Observable</li> <li>Observer</li> <li>Subscriber</li> <li>Subjects</li> </ul> <p>\u5176\u4e2d\uff0cObservable \u548c Subject \u662f\u4e8b\u4ef6\u7684\u751f\u4ea7\u8005\uff0c\u800c Observe \u548c Subscriber \u662f\u4e8b\u4ef6\u7684\u6d88\u8d39\u8005\u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#_3","title":"\u70ed\u542f\u52a8\u548c\u51b7\u542f\u52a8","text":"<p>\u4ece\u53d1\u9001\u6d88\u606f\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u6709\u4e24\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u88ab\u89c2\u5bdf\u8005\uff0c\u5206\u522b\u662f\u70ed\u542f\u52a8\u89c2\u5bdf\u8005\u548c\u51b7\u542f\u52a8\u88ab\u89c2\u5bdf\u8005\u3002</p> <ul> <li>Hot Observable </li> </ul> <p>\u70ed\u542f\u52a8\u88ab\u89c2\u5bdf\u8005 \u5728\u5b83\u88ab\u521b\u5efa\u65f6\u5c31\u5f00\u59cb\u53d1\u9001\u6d88\u606f\u4e86\uff0c\u6240\u4ee5\uff0c\u4efb\u4f55\u8ba2\u9605\u4e86\u8be5\u6d88\u606f\u7684\u89c2\u5bdf\u8005\u4f1a\u5728\u6d88\u606f\u5e8f\u5217\u7684\u4e2d\u95f4\u67d0\u4e2a\u5730\u65b9\u5f00\u59cb\u89c2\u5bdf\uff0c\u800c\u4e0d\u662f\u4ece\u8d77\u59cb\u4f4d\u7f6e\u5f00\u59cb\u3002</p> <ul> <li>Cold Observable</li> </ul> <p>\u51b7\u542f\u52a8\u88ab\u89c2\u5bdf\u8005 \u5728\u81f3\u5c11\u6709\u4e00\u4e2a\u89c2\u5bdf\u8005\u8ba2\u9605\u4e86\u5b83\u4e4b\u540e\u624d\u4f1a\u53d1\u9001\u6d88\u606f\uff0c\u6240\u4ee5\uff0c\u89c2\u5bdf\u8005\u53ef\u4ee5\u4fdd\u8bc1\u4f1a\u4ece\u6d88\u606f\u5e8f\u5217\u7684\u8d77\u59cb\u4f4d\u7f6e\u5904\u5f00\u59cb\u89c2\u5bdf\u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#observable","title":"\u521b\u5efa\u88ab\u89c2\u5bdf\u8005\u5bf9\u8c61 Observable","text":"<p>Observable \u7c7b\u63d0\u4f9b\u4e86\u65b9\u6cd5\u6765\u521b\u5efa Observable \u5bf9\u8c61\u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#observablecreate","title":"Observable.create()","text":"<p>\u4f7f\u7528 Observable.create() \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a Observable \u5bf9\u8c61\uff1a</p> <p><pre><code>/**\n * Observable.create() \u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u88ab\u89c2\u5bdf\u8005\n */\nObservable&lt;Integer&gt; observable = Observable.create(new Observable.OnSubscribe&lt;Integer&gt;() {\n    @Override\n    public void call(Subscriber&lt;? super Integer&gt; subscriber) {\n        for (int i = 0; i &lt; 5; i++) {\n            subscriber.onNext(i);\n        }\n        subscriber.onCompleted();\n    }\n});\n</code></pre> \u5176\u4e2d\uff0ccreate() \u65b9\u6cd5\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u533f\u540d\u5185\u90e8\u7c7b\uff0c\u4e5f\u5c31\u662f\u521b\u5efa\u4e86 <code>OnSubscirbe \u63a5\u53e3</code> \u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u800c OnSubsribe \u63a5\u53e3\u53c8\u662f\u7ee7\u627f <code>Action1</code> \u63a5\u53e3\u7684\uff0c\u5176\u4e2d\u7684 <code>call()</code> \u65b9\u6cd5\u4e5f\u662f\u5728 Action1 \u63a5\u53e3\u4e2d\u7684\uff0c\u67e5\u770b\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <p>Action1 \u63a5\u53e3\uff1a <pre><code>/**\n * A one-argument action.\n * @param &lt;T&gt; the first argument type\n */\npublic interface Action1&lt;T&gt; extends Action {\n    void call(T t);\n}\n</code></pre></p> <p>OnSubscribe \u63a5\u53e3 <pre><code>/**\n * Invoked when Observable.subscribe is called.\n * @param &lt;T&gt; the output value type\n */\npublic interface OnSubscribe&lt;T&gt; extends Action1&lt;Subscriber&lt;? super T&gt;&gt; {\n    // cover for generics insanity\n}\n</code></pre></p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#observer-subscriber","title":"\u521b\u5efa\u89c2\u5bdf\u8005\u5bf9\u8c61 Observer / Subscriber","text":"<p>\u521b\u5efa\u4e86\u88ab\u89c2\u5bdf\u8005\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u89c2\u5bdf\u8005\uff0c\u7528\u6765\u6d88\u8d39\u88ab\u89c2\u5bdf\u8005\u4ea7\u751f\u7684\u4e8b\u4ef6\u3002 <pre><code>/**\n * \u521b\u5efa\u4e00\u4e2a\u89c2\u5bdf\u8005,Observer \u63a5\u53e3\u7c7b\u578b\u5b9e\u73b0\u7c7b\u7684\u5bf9\u8c61\n */\nObserver&lt;Integer&gt; observer = new Observer&lt;Integer&gt;() {\n    @Override\n    public void onCompleted() {\n\n    }\n\n    @Override\n    public void onError(Throwable e) {\n\n    }\n\n    @Override\n    public void onNext(Integer integer) {\n        Logger.v(String.valueOf(integer));\n    }\n};\n</code></pre></p> <p><code>Observer</code> \u4e5f\u662f\u4e00\u4e2a\u63a5\u53e3\u7c7b\u578b\uff0c\u58f0\u660e\u4e86\u5982\u4e0a\u7684\u4e09\u4e2a\u65b9\u6cd5\uff1a *    onNext()\uff1aObservable \u6bcf\u53d1\u9001\u4e00\u6b21\u4e8b\u4ef6\u90fd\u4f1a\u8c03\u7528\u4e00\u6b21\u8be5\u65b9\u6cd5\u6d88\u8d39\u4e8b\u4ef6\u3002 *    onCompleted()\uff1a\u5f53 Observabel \u7684\u4e8b\u4ef6\u53d1\u9001\u5b8c\u6bd5\u540e\uff0c\u5c31\u4f1a\u8c03\u7528\u8be5\u65b9\u6cd5\u3002 *    onError()\uff1a\u5982\u679c Observable \u53d1\u9001\u4e8b\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u9519\u8bef\uff0c\u5219\u4f1a\u8c03\u7528\u8be5\u65b9\u6cd5\u3002</p> <p>\u6709\u4e86\u88ab\u89c2\u5bdf\u8005 Observable \u548c\u89c2\u5bdf\u8005 Observer \u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e8b\u4ef6\u7684\u8ba2\u9605\u4e86\u3002 <pre><code>/**\n * Observable \u8ba2\u9605 Observer\n */\nobservable.subscribe(observer);\n</code></pre> \u8c03\u7528 Observable \u5bf9\u8c61\u7684 subscribe \u65b9\u6cd5\u5373\u53ef\u5b9e\u73b0\u8ba2\u9605\u3002</p> <p>\u5c31\u8fd9\u6837\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u5e76\u6ca1\u6709\u4ec0\u4e48\u5375\u7528\u7684\u88ab\u89c2\u5bdf\u8005\u3001\u89c2\u5bdf\u8005\u4ee5\u53ca\u5b83\u4eec\u4e4b\u95f4\u7684\u8ba2\u9605\u5173\u7cfb\u5c31\u5df2\u7ecf\u5b9e\u73b0\u4e86\u3002</p> <p>\u5728 OnSubscribe \u63a5\u53e3\u7684\u6ce8\u91ca\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u8c03\u7528\u4e86 Observable.subscribe \u65b9\u6cd5\u65f6\uff0cOnSubscribe \u7684\u63a5\u53e3\u65b9\u6cd5\u5c06\u4f1a\u88ab\u8c03\u7528\uff0c\u4e5f\u5c31\u662f\u7ee7\u627f\u7684 Action1 \u7684 call \u65b9\u6cd5\u3002\u800c call \u5219\u56de\u8c03\u6267\u884c\u4e86\u89c2\u5bdf\u8005\u7684 onNext\u3001onCompleted\u3001onError \u65b9\u6cd5\u3002</p> <p>\u901a\u8fc7\u67e5\u770b subscribe \u6267\u884c\u7684\u6e90\u4ee3\u7801\u4e5f\u53ef\u4ee5\u5f97\u77e5\uff0c\u90e8\u5206\u6e90\u7801\uff1a <pre><code>static &lt;T&gt; Subscription subscribe(Subscriber&lt;? super T&gt; subscriber, Observable&lt;T&gt; observable) {\n    // new Subscriber so onStart it\n    subscriber.onStart();\ntry {\n    // allow the hook to intercept and/or decorate\n    RxJavaHooks.onObservableStart(observable, observable.onSubscribe).call(subscriber);\n    return RxJavaHooks.onObservableReturn(subscriber);\n}\n}\n</code></pre> subscribe \u65b9\u6cd5\u63a5\u6536\u7684\u53c2\u6570\u662f Subscriber \u7c7b\u578b\u7684\uff0c\u800c\u4e14\u8fd8\u8fd4\u56de\u4e86\u4e00\u4e2a Subscription \u7c7b\u578b\u7684\u7ed3\u679c\u3002</p> <p>\u5728 subscribe \u65b9\u6cd5\u4e2d\uff0c\u8c03\u7528\u4e86 OnSubscribe \u7684 call \u65b9\u6cd5\uff0c\u800c call \u65b9\u6cd5\u53c8\u5c06 subscriber/observer \u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\uff0c\u5728\u521b\u5efa Observable \u5bf9\u8c61\u7684 call \u65b9\u6cd5\u5b9e\u73b0\u4e2d\uff0c\u8c03\u7528\u4e86 subscriber/observer \u7684 onNext\u3001onCompleted\u3001onError \u65b9\u6cd5\uff0c\u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u56de\u8c03\uff0c\u56de\u8c03\u4e86 subscriber/observer \u7684\u65b9\u6cd5\u3002</p> <p>\u800c\u5728\u6267\u884c\u5230\u6700\u7ec8\u7684 subscribe \u65b9\u6cd5\u4e4b\u524d\uff0c\u8fd8\u6709\u4e00\u7cfb\u5217\u7684\u8f6c\u6362\u8fc7\u7a0b\uff0c\u7528\u4e8e**\u5c06 Observer \u5bf9\u8c61\u8f6c\u6362\u6210 Subscriber \u5bf9\u8c61**\u3002 <pre><code>public final Subscription subscribe(final Observer&lt;? super T&gt; observer) {\n    if (observer instanceof Subscriber) {  // \u5982\u679c\u662f Subscriber \u5b9e\u4f8b\u5219\u76f4\u63a5\u8c03\u7528\u4e86\n        return subscribe((Subscriber&lt;? super T&gt;)observer);\n    }\n    if (observer == null) {\n        throw new NullPointerException(\"observer is null\");\n    }\n    // \u8f6c\u6362\u6210\u4e00\u4e2a\u5305\u88c5\u7c7b\n    return subscribe(new ObserverSubscriber&lt;T&gt;(observer)); \n}\n</code></pre> ObserverSubscriber \u662f\u4e00\u4e2a Observer \u7684\u5305\u88c5\u7c7b\uff0c\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>/**\n * Wraps an Observer and forwards the onXXX method calls to it.\n * @param &lt;T&gt; the value type\n */\npublic final class ObserverSubscriber&lt;T&gt; extends Subscriber&lt;T&gt; {\n    final Observer&lt;? super T&gt; observer;\n\n    public ObserverSubscriber(Observer&lt;? super T&gt; observer) {\n        this.observer = observer;\n    }\n}\n</code></pre> \u6240\u4ee5\uff0c\u5728\u80fd\u4f7f\u7528 Subscriber \u7684\u5730\u65b9\u8fd8\u662f\u5c3d\u91cf\u4f7f\u7528 Subscriber \u3002\u5e76\u4e14\uff0c\u76f8\u6bd4 Observer \u5bf9\u8c61\uff0cSubscriber \u8fd8\u591a\u4e86 onStart \u65b9\u6cd5\u548c unsubscribe \u65b9\u6cd5\uff0c\u5206\u522b\u7528\u6765\u5728 subscribe \u65b9\u6cd5\u8c03\u7528\u4e4b\u524d\u505a\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\u548c\u53d6\u6d88\u8ba2\u9605\u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#_4","title":"\u5176\u4ed6\u521b\u5efa\u88ab\u89c2\u5bdf\u8005\u7684\u65b9\u6cd5","text":"","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#observablefrom-observable","title":"Observable.from() \u65b9\u6cd5\u521b\u5efa Observable","text":"<p>\u5f53\u6211\u4eec\u9700\u8981\u76d1\u542c\u7684\u5bf9\u8c61\u662f\u4e00\u4e2a\u5217\u8868 List  \u6216\u8005 \u6570\u7ec4 Array \u65f6\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528 Observable.from() \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a\u88ab\u89c2\u5bdf\u8005\u3002</p> <pre><code>/**\n * Observable.from() \u65b9\u6cd5\u521b\u5efa Observable\n */\nList&lt;Integer&gt; items = new ArrayList&lt;Integer&gt;();\nitems.add(1);\nitems.add(10);\nitems.add(100);\nitems.add(1000);\nObservable&lt;Integer&gt; integerObservable = Observable.from(items);\n</code></pre> <p>\u67e5\u770b from() \u65b9\u6cd5\u7684\u6e90\u7801\u53d1\u73b0\uff0c\u5728\u5185\u90e8\u8fd8\u662f\u8c03\u7528\u7684 create() \u65b9\u6cd5\u6765\u521b\u5efa\u7684\u88ab\u89c2\u5bdf\u8005\u3002</p> <p>\u6240\u4ee5\uff0c\u5f53\u6211\u4eec\u901a\u8fc7 from() \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a Observable \u65f6\uff0c\u5c31\u4e0d\u9700\u8981\u50cf create() \u65b9\u6cd5\u8003\u8651\u8ba2\u9605\u89c2\u5bdf\u8005\u65f6\u7684\u56de\u8c03\u4e86\uff0c\u76f4\u63a5 subscribe \u8ba2\u9605\u89c2\u5bdf\u8005\u5373\u53ef\u3002</p> <pre><code>public static &lt;T&gt; Observable&lt;T&gt; from(Iterable&lt;? extends T&gt; iterable) {\n    return create(new OnSubscribeFromIterable&lt;T&gt;(iterable));\n}\n</code></pre>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#observablejust-observable","title":"Observable.just() \u65b9\u6cd5\u521b\u5efa Observable","text":"<p>\u5f53\u6211\u4eec\u9700\u8981\u76d1\u542c\u7684\u662f\u4e00\u4e2a Java \u65b9\u6cd5\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 just() \u65b9\u6cd5\u6765\u5c06\u5176\u8f6c\u5316\u6210\u4e00\u4e2a\u88ab\u89c2\u5bdf\u8005\u3002 <pre><code>/**\n * Observable.just() \u65b9\u6cd5\u5c06\u4e00\u4e2a\u51fd\u6570\u8f6c\u5316\u6210 Observable\n */\nObservable&lt;String&gt; stringObservable = Observable.just(helloWorld());\nprivate String helloWorld(){\n    return \"Hello World\" ;\n}\n</code></pre> \u5f53\u6211\u4eec\u521b\u5efa Observable \u5bf9\u8c61\u65f6\uff0c just() \u5c31\u4f1a\u6267\u884c\u9700\u8981\u8f6c\u5316\u7684\u65b9\u6cd5\uff1b\u5f53\u8ba2\u9605\u89c2\u5bdf\u8005\u65f6\uff0c\u5c31\u4f1a\u5c06\u65b9\u6cd5\u8fd4\u56de\u7684\u503c\u53d1\u9001\u51fa\u53bb\u3002</p> <p>just \u65b9\u6cd5\u80fd\u591f\u63a5\u6536 1~9 \u4e2a\u53c2\u6570\uff0c\u5e76\u4e14\u4f1a\u6309\u7167\u5b83\u4eec\u7684\u53c2\u6570\u987a\u5e8f\u53d1\u9001\u5b83\u4eec\u3002\u540c\u65f6\uff0cjust() \u8fd8\u80fd\u63a5\u6536\u5217\u8868 List \u548c\u6570\u7ec4 Array \uff0c\u4f46\u662f just() \u65b9\u6cd5\u5e76\u4e0d\u4f1a\u8fed\u4ee3\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u503c\uff0c\u800c\u662f\u5c06\u5b83\u4eec\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u53d1\u9001\u51fa\u6765\u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#observable-empty-never-thorw","title":"Observable \u5bf9\u8c61\u7684 empty() \u65b9\u6cd5\u3001never() \u65b9\u6cd5\u548c thorw() \u65b9\u6cd5","text":"<p>\u5982\u679c\u6211\u4eec\u60f3\u8981 Observable \u5bf9\u8c61\u4e0d\u53d1\u9001\u4efb\u4f55\u4e1c\u897f\uff0c\u4f46\u662f\u6b63\u5e38\u7684\u7ed3\u675f\uff0c\u53ef\u4ee5\u4f7f\u7528 empty() \u65b9\u6cd5\u6765\u521b\u5efa\u88ab\u89c2\u5bdf\u8005\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 never() \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a Observable \u5bf9\u8c61\uff0c\u5b83\u4e0d\u4f1a\u53d1\u9001\u4efb\u4f55\u4e1c\u897f\uff0c\u4e5f\u4e0d\u4f1a\u7ec8\u6b62\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 throw() \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a Observable \u5bf9\u8c61\uff0c\u5b83\u4e0d\u4f1a\u53d1\u9001\u4efb\u4f55\u4e1c\u897f\uff0c\u4f46\u662f\u4f1a\u629b\u51fa\u5f02\u5e38\u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#subject","title":"Subject \u5bf9\u8c61","text":"<p>Subject \u5bf9\u8c61\u4e5f\u662f RxJava \u4e2d\u56db\u5927\u91cd\u8981\u5bf9\u8c61\u4e4b\u4e00\u3002</p> <p>\u5728\u540c\u4e00\u65f6\u523b\uff0cSubject \u65e2\u80fd\u662f Observable \u5bf9\u8c61\u4e5f\u80fd\u662f Observer \u5bf9\u8c61\uff0c\u5b83\u5c31\u50cf\u4e00\u4e2a\u6865\u6881\uff0c\u8054\u7cfb\u7740\u4e24\u8005\u3002\u4e00\u4e2a Subject \u5bf9\u8c61\u80fd\u50cf Observer \u5bf9\u8c61\u90a3\u6837\u8ba2\u9605\u88ab\u89c2\u5bdf\u8005\uff0c\u4e5f\u80fd\u50cf Observable \u90a3\u6837\u53bb\u53d1\u9001\u6d88\u606f\u3002</p> <p>RxJava \u63d0\u4f9b\u4e86\u56db\u79cd\u7c7b\u578b\u7684 subject \uff1a</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#publishsubject","title":"PublishSubject","text":"<p>PublishSubject \u662f\u6700\u57fa\u672c\u7684 Subject \u5bf9\u8c61\u3002</p> <p><pre><code>/**\n * \u521b\u5efa\u4e00\u4e2a PublishSubject,\u4ece\u8ba2\u9605\u540e\u7684\u5730\u65b9\u5f00\u59cb\u63a5\u6536\n */\nPublishSubject&lt;String&gt; stringPublishSubject = PublishSubject.create();\n/**\n * \u50cf Observable \u4e00\u6837\u7684\u8ba2\u9605\n */\nSubscription subscriptionPrint = stringPublishSubject.subscribe(new Observer&lt;String&gt;() {\n    @Override\n    public void onCompleted() {\n        Logger.e(\"PublishSubject Observable completed\");\n    }\n\n    @Override\n    public void onError(Throwable e) {\n\n    }\n\n    @Override\n    public void onNext(String s) {\n        Logger.e(s);\n    }\n});\n\n/**\n * \u50cf Observer \u4e00\u6837\u7684\u6267\u884c\u65b9\u6cd5,\u4ece\u6b64\u5904\u5f00\u59cb\u63a5\u6536\u8ba2\u9605\n */\nstringPublishSubject.onNext(\"this is PublishSubject\");\n</code></pre> \u901a\u8fc7 create() \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a PublishSubject \uff0c\u5b83\u4f1a\u53d1\u9001\u4e00\u4e2a String \u7c7b\u578b\u7684\u503c\uff0c\u7136\u540e\u8ba2\u9605\u4e86\u8be5 PublishSubject \u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u8fd8\u6ca1\u6709\u4efb\u4f55\u5143\u7d20\u88ab\u53d1\u9001\u51fa\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u89c2\u5bdf\u8005\u4e5f\u4f1a\u4e00\u76f4\u5728\u7b49\u5f85\uff0c\u4f46\u662f\u8fd9\u4e2a\u7b49\u5f85\u662f\u65e0\u9700\u6211\u4eec\u62c5\u5fc3\u7684\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u54cd\u5e94\u7684\uff0c\u6211\u4eec\u53ea\u9700\u5173\u6ce8\u54cd\u5e94\u65f6\u6267\u884c\u54ea\u4e9b\u64cd\u4f5c\u5c31\u597d\u4e86\u3002</p> <p>\u6700\u540e\u4e00\u884c\u4ee3\u7801\uff0c\u5219\u662f\u624b\u52a8\u89e6\u53d1\u4e86 Observer \u7684 onNext() \uff0c\u7136\u540e\u6253\u5370\u5b57\u7b26\u4e32\uff0c\u800c\u5728 subscribe() \u65b9\u6cd5\u4e4b\u524d\u6267\u884c\u7684 onNext() \u5219\u4e0d\u4f1a\u6253\u5370\u5b57\u7b26\u4e32\u3002</p> <p>PublishSubject \u53ea\u6709\u5728\u8ba2\u9605\u4e86\u4e4b\u540e\uff0c\u624d\u4f1a\u53d1\u9001\u6570\u636e\u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#behaivorsubject","title":"BehaivorSubject","text":"<pre><code>/**\n * BehaivorSubject \u4f1a\u53d1\u9001\u79bb\u8ba2\u9605\u6700\u8fd1\u7684\u4e0a\u4e00\u503c,\u5982\u679c\u6ca1\u6709\u5219\u53d1\u9001\u9ed8\u8ba4\u503c\n */\nBehaviorSubject&lt;String&gt; behaviorSubject = BehaviorSubject.create(\"init item\");\n\nbehaviorSubject.onNext(\"1\");\n\n/**\n * \u8ba2\u9605\u524d\u7684\u4e0a\u4e00\u4e2a\u503c,\u5c06\u4f1a\u88ab\u6253\u5370\u51fa\u6765\n */\nbehaviorSubject.onNext(\"2\");\n\nbehaviorSubject.subscribe(new Action1&lt;String&gt;() {\n    @Override\n    public void call(String s) {\n        Logger.e(s);\n    }\n});\n\n/**\n * \u5728\u6b64\u65b9\u6cd5\u4e4b\u524d\u8ba2\u9605,\u5219\u4f1a\u53d1\u9001\u8ba2\u9605\u524d\u7684\u4e0a\u4e00\u4e2a\u503c,\u4ee5\u53ca\u8fd9\u6b21\u8ba2\u9605\u7684\u503c\n */\nbehaviorSubject.onNext(\"3\");\n\nbehaviorSubject.onCompleted();\n</code></pre> <p>BehaviorSubject \u4f1a\u53d1\u9001\u79bb\u8ba2\u9605\u6700\u8fd1\u662f\u4e0a\u4e00\u4e2a\u503c\uff0c\u5982\u679c\u6ca1\u6709\u5219\u53d1\u9001\u9ed8\u8ba4\u503c\u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#replaysubject","title":"ReplaySubject","text":"<pre><code>/**\n * ReplaySubject \u4f1a\u5c06\u6240\u6709\u7684\u8ba2\u9605\u90fd\u7f13\u5b58\u8d77\u6765,\u5e76\u5c06\u5b83\u4eec\u4e00\u5e76\u53d1\u9001\u7ed9 Observer .\n */\nReplaySubject&lt;String&gt; replaySubject = ReplaySubject.create();\n/**\n * \u5728\u8ba2\u9605\u4e4b\u524d\u53d1\u9001\u7684\u5143\u7d20,\u4e5f\u4f1a\u53d1\u9001\u7ed9\u89c2\u5bdf\u8005\n */\nreplaySubject.onNext(\"1\");\nreplaySubject.onNext(\"2\");\n/**\n * \u6267\u884c\u8ba2\u9605\u64cd\u4f5c\n */\nreplaySubject.subscribe(new Action1&lt;String&gt;() {\n    @Override\n    public void call(String s) {\n        Logger.e(s);\n    }\n});\n/**\n * \u5728\u8ba2\u9605\u4e4b\u540e\u53d1\u9001\u7684\u5143\u7d20,\u4e5f\u4f1a\u53d1\u9001\u7ed9\u89c2\u5bdf\u8005\n */\nreplaySubject.onNext(\"3\");\nreplaySubject.onNext(\"4\");\n</code></pre> <p>ReplaySubject \u4f1a\u5c06\u8ba2\u9605\u524d\u540e\u53d1\u9001\u7684\u5143\u7d20\u7f13\u5b58\u8d77\u6765\uff0c\u5e76\u4e14\u4e00\u5e76\u53d1\u9001\u7ed9 Observer \u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#asyncsubject","title":"AsyncSubject","text":"<pre><code>/**\n * AsyncSubject \u5f53 Observable \u5b8c\u6210\u4e4b\u540e,\u53ea\u4f1a\u5411 Observer \u53d1\u9001\u8ba2\u9605\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\n */\n\nAsyncSubject&lt;String&gt; asyncSubject = AsyncSubject.create();\n\n\nasyncSubject.subscribe(new Action1&lt;String&gt;() {\n    @Override\n    public void call(String s) {\n        Logger.e(s);\n    }\n});\n\n/**\n * 1 \u548c 2 \u5c06\u4e0d\u4f1a\u88ab\u6253\u5370\u51fa\u6765\n */\nasyncSubject.onNext(\"1\");\nasyncSubject.onNext(\"2\");\n/**\n * \u6700\u540e\u4e00\u4e2a\u53d1\u9001\u7684\u5c06\u4f1a\u88ab\u6253\u5370\u51fa\u6765\n */\nasyncSubject.onNext(\"this is last item\");\n/**\n * \u6b64\u65b9\u6cd5\u5fc5\u987b\u5f97\u6709,\u8868\u660e\u53d1\u9001\u5b8c\u6210\n */\nasyncSubject.onCompleted();\n</code></pre> <p>AsyncSubject \u5c06\u4f1a\u53d1\u9001\u8ba2\u9605\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20 \u3002</p>","tags":["Android","RxJava"]},{"location":"android/android-rxjava/#_5","title":"\u53c2\u8003","text":"<ol> <li>https://gank.io/post/560e15be2dca930e00da1083</li> <li>http://www.jianshu.com/p/1257c8ba7c0c</li> </ol>","tags":["Android","RxJava"]},{"location":"android/android-start-service/","title":"Android 6.0 Service \u542f\u52a8\u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e00\uff09","text":"<p>Service \u7ec4\u4ef6\u4e5f\u662f Android \u56db\u5927\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u5b83\u7684\u542f\u52a8\u8fc7\u7a0b\u5206\u4e3a\u663e\u793a\u548c\u9690\u5f0f\u4e24\u79cd\u3002\u5bf9\u4e8e\u9690\u5f0f\u542f\u52a8\u7684 Service \u7ec4\u4ef6\u6765\u8bf4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5b83\u7684\u7ec4\u4ef6\u540d\u79f0\uff1b\u5bf9\u4e8e\u663e\u793a\u542f\u52a8\u7684 Service \u7ec4\u4ef6\u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u5b83\u7684\u7c7b\u540d\u79f0\u3002</p> <p>Service \u7ec4\u4ef6\u53ef\u4ee5\u88ab Activity \u7ec4\u4ef6\u542f\u52a8\uff0c\u4e5f\u53ef\u4ee5\u88ab\u5176\u4ed6\u7684 Service \u7ec4\u4ef6\u542f\u52a8\u3002\u540c\u65f6\uff0c\u5b83\u65e2\u53ef\u4ee5\u5728\u542f\u52a8\u5b83\u7684 Activity \u7ec4\u4ef6\u6216\u8005 Service \u7ec4\u4ef6\u6240\u5728\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u542f\u52a8\uff0c\u4e5f\u53ef\u4ee5\u5728\u4e00\u4e2a\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u4e2d\u542f\u52a8\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#service","title":"Service \u7ec4\u4ef6\u5728\u65b0\u8fdb\u7a0b\u4e2d\u7684\u542f\u52a8\u8fc7\u7a0b","text":"<p>\u4e0d\u7ba1 Service \u7ec4\u4ef6\u662f\u5728 Activity \u7ec4\u4ef6\u4e2d\u542f\u52a8\u7684\u8fd8\u662f\u5728 Service \u7ec4\u4ef6\u4e2d\u542f\u52a8\u7684\uff0c\u5b83\u4eec\u90fd\u662f\u7ee7\u627f\u81ea<code>ContextWrapper</code>\u7c7b\u7684\uff0c\u6700\u540e\u8c03\u7528\u7684\u8fd8\u662f<code>ContextImpl</code>\u7684<code>startService</code>\u65b9\u6cd5\u3002</p> <p>\u6240\u4ee5\u76f4\u63a5\u4ece<code>ContextImpl</code>\u65b9\u6cd5\u5f00\u59cb\u5206\u6790\u5373\u53ef\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#contextimpl-startservice","title":"ContextImpl \u7c7b\u7684 startService() \u65b9\u6cd5","text":"<pre><code>@Override\n    public ComponentName startService(Intent service) {\n        warnIfCallingFromSystemProcess();\n        return startServiceCommon(service, mUser);\n    }\n</code></pre> <p>\u663e\u7136\u6700\u540e\u8fd8\u662f\u8c03\u7528\u7684<code>startServiceCommon</code>\u65b9\u6cd5\u4e86\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#contextimpl-startservicecommon","title":"ContextImpl \u7c7b\u7684 startServiceCommon() \u65b9\u6cd5","text":"<p><pre><code>private ComponentName startServiceCommon(Intent service, UserHandle user) {\n        try {\n            validateServiceIntent(service);\n            service.prepareToLeaveProcess();\n            // \u5411 ActivityManagerService \u53d1\u9001\u8bf7\u6c42\u542f\u52a8 Service \u7ec4\u4ef6\n            ComponentName cn = ActivityManagerNative.getDefault().startService(\n                mMainThread.getApplicationThread(), service, service.resolveTypeIfNeeded(\n                            getContentResolver()), getOpPackageName(), user.getIdentifier());\n            if (cn != null) {\n                if (cn.getPackageName().equals(\"!\")) {\n                    throw new SecurityException( \"Not allowed to start service \" + service\n                            + \" without permission \" + cn.getClassName());\n                } else if (cn.getPackageName().equals(\"!!\")) {\n                    throw new SecurityException( \"Unable to start service \" + service\n                            + \": \" + cn.getClassName());\n                }\n            }\n            return cn;\n        } catch (RemoteException e) {\n            throw new RuntimeException(\"Failure from system\", e);\n        }\n    }\n</code></pre> \u5728<code>startServiceCommon</code>\u65b9\u6cd5\u5185\u53c8\u662f IPC \u8fdb\u7a0b\u95f4\u901a\u4fe1\u4e86\uff0c\u901a\u8fc7<code>ActivityManagerProxy</code>\u5411 Binder \u9a71\u52a8\u53d1\u9001\u7c7b\u578b\u4e3a<code>START_SERVICE_TRANSACTION</code>\u7684\u6d88\u606f\uff0c\u5728<code>ActivityManagerService</code>\u54cd\u5e94\u5bf9\u5e94\u6d88\u606f\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#activitymanagerservice-startservice","title":"ActivityManagerService \u7c7b\u7684 startService() \u65b9\u6cd5","text":"<pre><code>public ComponentName startService(IApplicationThread caller, Intent service,\n            String resolvedType, String callingPackage, int userId)\n            throws TransactionTooLargeException {\n        enforceNotIsolatedCaller(\"startService\");\n        // Refuse possible leaked file descriptors\n        if (service != null &amp;&amp; service.hasFileDescriptors() == true) {\n            throw new IllegalArgumentException(\"File descriptors passed in Intent\");\n        }\n\n        if (callingPackage == null) {\n            throw new IllegalArgumentException(\"callingPackage cannot be null\");\n        }\n        synchronized(this) {\n            final int callingPid = Binder.getCallingPid();\n            final int callingUid = Binder.getCallingUid();\n            final long origId = Binder.clearCallingIdentity();\n            ComponentName res = mServices.startServiceLocked(caller, service,\n                    resolvedType, callingPid, callingUid, callingPackage, userId);\n            Binder.restoreCallingIdentity(origId);\n            return res;\n        }\n    }\n</code></pre> <p>\u5728 ActivityManagerService \u5185\u53c8\u662f\u8c03\u7528 ActivityServices \u7c7b\u7684 <code>startServiceLocked()</code> \u65b9\u6cd5\uff0c\u5c06\u8c03\u7528\u8005\u7684<code>pid</code>\u548c<code>uid</code>\u4f20\u5165\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#activeservices-startservicelocked","title":"ActiveServices \u7c7b\u7684 startServiceLocked() \u65b9\u6cd5","text":"<pre><code>    ComponentName startServiceLocked(IApplicationThread caller, Intent service, String resolvedType,\n            int callingPid, int callingUid, String callingPackage, int userId)\n            throws TransactionTooLargeException {\n        final boolean callerFg;\n        if (caller != null) {\n            final ProcessRecord callerApp = mAm.getRecordForAppLocked(caller);\n            if (callerApp == null) {\n                throw new SecurityException(\"\");// \u7701\u7565\u5b57\u7b26\u4e32\u5185\u5bb9\n            }\n            callerFg = callerApp.setSchedGroup != Process.THREAD_GROUP_BG_NONINTERACTIVE;\n        } else {\n            callerFg = true;\n        }\n        // \u67e5\u627e\u662f\u5426\u5b58\u5728\u4e8e service \u5bf9\u5e94\u7684 ServiceRecord \u5bf9\u8c61\uff0c\u6ca1\u6709\u5219\u5c01\u88c5\u4e00\u4e2a\n        ServiceLookupResult res =\n            retrieveServiceLocked(service, resolvedType, callingPackage,\n                    callingPid, callingUid, userId, true, callerFg);\n        if (res == null) {\n            return null;\n        }\n        if (res.record == null) {\n            return new ComponentName(\"!\", res.permission != null\n                    ? res.permission : \"private to package\");\n        }\n        ServiceRecord r = res.record;\n        if (!mAm.getUserManagerLocked().exists(r.userId)) { // \u7528\u6237\u662f\u5426\u5b58\u5728\u68c0\u67e5\n            Slog.d(TAG, \"Trying to start service with non-existent user! \" + r.userId);\n            return null;\n        }\n\n        NeededUriGrants neededGrants = mAm.checkGrantUriPermissionFromIntentLocked(\n                callingUid, r.packageName, service, service.getFlags(), null, r.userId);\n        if (unscheduleServiceRestartLocked(r, callingUid, false)) {\n            if (DEBUG_SERVICE) Slog.v(TAG_SERVICE, \"START SERVICE WHILE RESTART PENDING: \" + r);\n        }\n        r.lastActivity = SystemClock.uptimeMillis();\n        r.startRequested = true;\n        r.delayedStop = false;\n        r.pendingStarts.add(new ServiceRecord.StartItem(r, false, r.makeNextStartId(),\n                service, neededGrants));\n\n        final ServiceMap smap = getServiceMap(r.userId);\n        boolean addToStarting = false;\n        if (!callerFg &amp;&amp; r.app == null &amp;&amp; mAm.mStartedUsers.get(r.userId) != null) {\n            ProcessRecord proc = mAm.getProcessRecordLocked(r.processName, r.appInfo.uid, false);\n            if (proc == null || proc.curProcState &gt; ActivityManager.PROCESS_STATE_RECEIVER) {\n                if (r.delayed) {\n                    // This service is already scheduled for a delayed start; just leave\n                    // it still waiting.\n                    return r.name;\n                }\n                if (smap.mStartingBackground.size() &gt;= mMaxStartingBackground) {\n                    // Something else is starting, delay!\n                    smap.mDelayedStartList.add(r);\n                    r.delayed = true;\n                    return r.name;\n                }\n                addToStarting = true;\n            } else if (proc.curProcState &gt;= ActivityManager.PROCESS_STATE_SERVICE) {\n                addToStarting = true;\n            } \n        } \n\n        return startServiceInnerLocked(smap, service, r, callerFg, addToStarting);\n    }\n</code></pre> <p>\u5728 <code>startServiceLocked</code> \u65b9\u6cd5\u5185\u7684\u8c03\u7528 <code>retrieveServiceLocked</code>\u65b9\u6cd5\u5728 ActivityManagerService \u68c0\u67e5\u662f\u5426\u5b58\u5728\u4e0e\u53c2\u6570 <code>service</code>\u5bf9\u5e94\u7684\u4e00\u4e2a<code>ServiceRecord</code>\u5bf9\u8c61\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48 ActivityManagerService \u5c31\u4f1a\u5230 PackageManagerService \u4e2d\u53bb\u83b7\u53d6\u4e0e\u53c2\u6570<code>service</code>\u5bf9\u5e94\u7684\u4e00\u4e2a Service \u7ec4\u4ef6\u7684\u4fe1\u606f\uff0c\u7136\u540e\u5c06\u8fd9\u4e9b\u4fe1\u606f\u5c01\u88c5\u6210\u4e00\u4e2a<code>ServiceRecord</code>\u5bf9\u8c61\uff0c\u6700\u540e\u5c06\u8fd9\u4e2a<code>ServiceRecord</code>\u5bf9\u8c61\u5c01\u88c5\u6210\u4e00\u4e2a<code>ServiceLookupResult</code>\u5bf9\u8c61\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002</p> <p>\u63a5\u7740\u5c31\u662f\u5bf9\u7528\u6237\u662f\u5426\u5b58\u5728\u8fdb\u884c\u68c0\u67e5\uff0c\u6700\u540e\u8c03\u7528<code>startServiceInnerLocked</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#activeservices-startserviceinnerlocked","title":"ActiveServices \u7c7b\u7684 startServiceInnerLocked() \u65b9\u6cd5","text":"<p><pre><code> ComponentName startServiceInnerLocked(ServiceMap smap, Intent service, ServiceRecord r,\n            boolean callerFg, boolean addToStarting) throws TransactionTooLargeException {\n        ProcessStats.ServiceState stracker = r.getTracker();\n        if (stracker != null) {\n            stracker.setStarted(true, mAm.mProcessStats.getMemFactorLocked(), r.lastActivity);\n        }\n        r.callStart = false;\n        synchronized (r.stats.getBatteryStats()) {\n            r.stats.startRunningLocked();\n        }\n        String error = bringUpServiceLocked(r, service.getFlags(), callerFg, false);\n        if (error != null) {\n            return new ComponentName(\"!!\", error);\n        }\n\n        if (r.startRequested &amp;&amp; addToStarting) {\n            boolean first = smap.mStartingBackground.size() == 0;\n            smap.mStartingBackground.add(r);\n            r.startingBgTimeout = SystemClock.uptimeMillis() + BG_START_TIMEOUT;\n            if (first) {\n                smap.rescheduleDelayedStarts();\n            }\n        } else if (callerFg) {\n            smap.ensureNotStartingBackground(r);\n        }\n        return r.name;\n    }\n</code></pre> \u8be5\u65b9\u6cd5\u5185\u8c03\u7528<code>bringUpServiceLocked</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#activeservices-bringupservicelocked","title":"ActiveServices \u7c7b\u7684 bringUpServiceLocked() \u65b9\u6cd5","text":"<pre><code>private final String bringUpServiceLocked(ServiceRecord r, int intentFlags, boolean execInFg,\n            boolean whileRestarting) throws TransactionTooLargeException {\n\n        if (r.app != null &amp;&amp; r.app.thread != null) {// \u6ee1\u8db3\u6761\u4ef6\uff0c\u6267\u884c service \u7684 onStartCommand \u65b9\u6cd5\n            sendServiceArgsLocked(r, execInFg, false);\n            return null;\n        }\n\n        if (!whileRestarting &amp;&amp; r.restartDelay &gt; 0) {\n            // If waiting for a restart, then do nothing.\n            return null;\n        }\n        // We are now bringing the service up, so no longer in the\n        // restarting state.\n        if (mRestartingServices.remove(r)) {\n            r.resetRestartCounter();\n            clearRestartingIfNeededLocked(r);\n        }\n\n        // Make sure this service is no longer considered delayed, we are starting it now.\n        if (r.delayed) {\n            getServiceMap(r.userId).mDelayedStartList.remove(r);\n            r.delayed = false;\n        }\n\n        // Make sure that the user who owns this service is started.  If not,\n        // we don't want to allow it to run.\n        if (mAm.mStartedUsers.get(r.userId) == null) {\n            bringDownServiceLocked(r);\n            return msg;\n        }\n\n        // Service is now being launched, its package can't be stopped.\n        try {\n            AppGlobals.getPackageManager().setPackageStoppedState(\n                    r.packageName, false, r.userId);\n        } catch (RemoteException e) {\n        } catch (IllegalArgumentException e) {\n        }\n\n        final boolean isolated = (r.serviceInfo.flags&amp;ServiceInfo.FLAG_ISOLATED_PROCESS) != 0;\n        final String procName = r.processName;\n        ProcessRecord app;\n\n        if (!isolated) {\n            app = mAm.getProcessRecordLocked(procName, r.appInfo.uid, false);\n            if (app != null &amp;&amp; app.thread != null) {\n                try {\n                    app.addPackage(r.appInfo.packageName, r.appInfo.versionCode, mAm.mProcessStats);\n                    realStartServiceLocked(r, app, execInFg);\n                    return null;\n                } catch (TransactionTooLargeException e) {\n                    throw e;\n                } catch (RemoteException e) {\n                    Slog.w(TAG, \"Exception when starting service \" + r.shortName, e);\n                }\n            }\n        } else {\n            app = r.isolatedProc;\n        }\n\n        // Not running -- get it started, and enqueue this service record\n        // to be executed when the app comes up.\n        if (app == null) {\n            if ((app=mAm.startProcessLocked(procName, r.appInfo, true, intentFlags,\n                    \"service\", r.name, false, isolated, false)) == null) {\n                bringDownServiceLocked(r);\n                return msg;\n            }\n            if (isolated) {\n                r.isolatedProc = app;\n            }\n        }\n\n        if (!mPendingServices.contains(r)) {\n            mPendingServices.add(r);\n        }\n\n        if (r.delayedStop) {\n            // Oh and hey we've already been asked to stop!\n            r.delayedStop = false;\n            if (r.startRequested) {\n                stopServiceLocked(r);\n            }\n        }\n\n        return null;\n    }\n</code></pre> <p>\u5728<code>bringUpServiceLocked</code>\u65b9\u6cd5\u5185\u5148\u5224\u65ad<code>ServiceRecord</code>\u7684\u53d8\u91cf<code>app</code>\u548c<code>thread</code>\u53d8\u91cf\u662f\u5426\u4e3a<code>null</code>\uff0c\u4e5f\u5c31\u662f\u68c0\u67e5<code>service</code>\u5bf9\u5e94\u7684\u8fdb\u7a0b<code>ProcessRecord</code>\u548c<code>ApplicationThread</code>\u5bf9\u8c61\u662f\u5426\u5b58\u5728\uff0c\u82e5\u5b58\u5728\uff0c\u5219\u76f4\u63a5\u6267\u884c<code>service</code>\u7684<code>onStartCommand</code>\u65b9\u6cd5\u3002</p> <p>\u82e5\u4e0d\u5b58\u5728\uff0c\u5219\u5c06<code>service</code>\u4ece\u91cd\u542f\u548c\u5ef6\u65f6\u542f\u52a8\u961f\u5217\u4e2d\u79fb\u5f00\uff0c\u56e0\u4e3a\u5b83\u6b63\u5728\u542f\u52a8\u4e2d\u4e86\uff0c\u6700\u540e\u518d\u786e\u4fdd\u62e5\u6709\u8be5<code>service</code>\u7684\u7528\u6237\u5df2\u7ecf\u542f\u52a8\u4e86\u3002</p> <p>\u63a5\u7740 ActivityManagerService \u6839\u636e\u8fdb\u7a0b\u540d<code>procName</code>\u548c<code>uid</code>\u8c03\u7528<code>getProcessRecordLocked</code>\u65b9\u6cd5\u67e5\u770b\u5bf9\u5e94\u7684\u8fdb\u7a0b<code>ProcessRecord</code>\u662f\u5426\u5b58\u5728\u3002</p> <ul> <li>\u82e5\u5b58\u5728\uff0c\u5219\u8c03\u7528<code>realStartServiceLocked</code>\u65b9\u6cd5\u3002</li> <li>\u82e5\u4e0d\u5b58\u5728\uff0c\u5219\u8c03\u7528<code>startProcessLocked</code>\u65b9\u6cd5\uff0c\u5148\u542f\u52a8\u8fdb\u7a0b\u3002</li> </ul> <p>ActivityManagerService \u901a\u8fc7<code>startProcessLocked</code>\u65b9\u6cd5\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u5728\u5206\u6790<code>Launcher</code>\u542f\u52a8 Activity \u7ec4\u4ef6\u65f6\u5df2\u7ecf\u4e86\u89e3\u8fc7\u4e86\u3002</p> <p>ActivityManagerService \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u800c\u4e00\u4e2a\u65b0\u8fdb\u7a0b\u7684\u5165\u53e3\u5c31\u662f<code>ActivityThread</code>\u7c7b\u7684<code>main</code>\u65b9\u6cd5\u3002\u5728<code>ActivityThread</code>\u5185\u4f1a\u521b\u5efa\u4e00\u4e2a<code>ActivityThread</code>\u5bf9\u8c61\u548c\u4e00\u4e2a<code>ApplicationThread</code>\u5bf9\u8c61\uff0c\u800c\u5728<code>main</code>\u65b9\u6cd5\u5185\u53c8\u4f1a\u8c03\u7528<code>ActivityThread</code>\u7684<code>attach</code>\u65b9\u6cd5\uff0c\u7528\u6765\u5411 ActivityManagerService \u53d1\u9001\u4e00\u4e2a \u7c7b\u578b\u4e3a <code>ATTACH_APPLICATION_TRANSACTION</code>\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u628a<code>ApplicationThread</code>\u5bf9\u8c61\u4f20\u9012\u7ed9 ActivityManagerService\uff0c\u4ee5\u4fbf\u80fd\u591f ActivityManagerService \u53ef\u4ee5\u548c\u65b0\u8fdb\u7a0b\u8fdb\u884c Binder \u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002</p> <p>ActivityManagerService \u54cd\u5e94\u7c7b\u578b\u4e3a<code>ATTACH_APPLICATION_TRANSACTION</code>\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u6267\u884c<code>attachApplication</code>\u65b9\u6cd5\uff0c\u8fdb\u800c\u6267\u884c<code>attachApplicationLocked</code>\u65b9\u6cd5\u3002</p> <p>\u5728<code>attachApplicationLocked</code>\u65b9\u6cd5\u5185\uff0c\u9996\u5148\u4f1a\u8fdb\u884c Binder \u8de8\u8fdb\u7a0b\u8c03\u7528\uff0c\u6267\u884c <code>ApplicationThread</code>\u7684<code>bindApplication</code>\u65b9\u6cd5\uff0c\u7136\u540e\u518d\u4f9d\u6b21\u8c03\u5ea6\u5e94\u7528\u7684<code>Activity</code>\u3001<code>Service</code>\u3001<code>Broadcast</code>\u7ec4\u4ef6\u3002</p> <p>\u5176\u4e2d\uff0c\u8c03\u5ea6<code>Service</code>\u7ec4\u4ef6\u7684\u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>    // Find any services that should be running in this process...\n        if (!badApp) {\n            try {\n                // mServices \u7684\u7c7b\u578b\u4e3a ActivityServices\n                didSomething |= mServices.attachApplicationLocked(app, processName);\n            } catch (Exception e) {\n                Slog.wtf(TAG, \"Exception thrown starting services in \" + app, e);\n                badApp = true;\n            }\n        }\n</code></pre></p>","tags":["Android"]},{"location":"android/android-start-service/#activityservices-attachapplicationlocked","title":"ActivityServices \u7c7b\u7684 attachApplicationLocked() \u65b9\u6cd5","text":"<pre><code>    boolean attachApplicationLocked(ProcessRecord proc, String processName)\n            throws RemoteException {\n        boolean didSomething = false;\n        // Collect any services that are waiting for this process to come up.\n        if (mPendingServices.size() &gt; 0) {\n            ServiceRecord sr = null;\n            try {\n                for (int i=0; i&lt;mPendingServices.size(); i++) {\n                    sr = mPendingServices.get(i);\n                    if (proc != sr.isolatedProc &amp;&amp; (proc.uid != sr.appInfo.uid\n                            || !processName.equals(sr.processName))) {\n                        continue;\n                    }\n                    mPendingServices.remove(i);\n                    i--;\n                    proc.addPackage(sr.appInfo.packageName, sr.appInfo.versionCode,\n                            mAm.mProcessStats);\n                    realStartServiceLocked(sr, proc, sr.createdFromFg);\n                    didSomething = true;\n                    if (!isServiceNeeded(sr, false, false)) {// \u4e0d\u9700\u8981\u7684\u670d\u52a1\u5c31\u4e22\u5f03\n                        bringDownServiceLocked(sr);\n                    }\n                }\n            } catch (RemoteException e) {\n                throw e;\n            }\n        }\n        // Also, if there are any services that are waiting to restart and\n        // would run in this process, now is a good time to start them.  It would\n        // be weird to bring up the process but arbitrarily not let the services\n        // run at this point just because their restart time hasn't come up.\n        if (mRestartingServices.size() &gt; 0) {\n            ServiceRecord sr;\n            for (int i=0; i&lt;mRestartingServices.size(); i++) {\n                sr = mRestartingServices.get(i);\n                if (proc != sr.isolatedProc &amp;&amp; (proc.uid != sr.appInfo.uid\n                        || !processName.equals(sr.processName))) {\n                    continue;\n                }\n                mAm.mHandler.removeCallbacks(sr.restarter);\n                mAm.mHandler.post(sr.restarter);\n            }\n        }\n        return didSomething;\n    }\n</code></pre> <p><code>attachApplicationLocked</code>\u65b9\u6cd5\u5185\u542f\u52a8<code>mPendingServices</code>\u961f\u5217\u4e2d\u7684\u670d\u52a1\u548c<code>mRestartingServices</code>\u4e2d\u7684\u670d\u52a1\u3002</p> <p>\u771f\u6b63\u542f\u52a8\u670d\u52a1\u7684\u65b9\u6cd5\u5c31\u662f<code>realStartServiceLocked</code>\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#activityservices-realstartservicelocked","title":"ActivityServices \u7c7b\u7684 realStartServiceLocked() \u65b9\u6cd5","text":"<pre><code>    private final void realStartServiceLocked(ServiceRecord r,\n            ProcessRecord app, boolean execInFg) throws RemoteException {\n        if (app.thread == null) {\n            throw new RemoteException();\n        }\n        r.app = app;\n        r.restartTime = r.lastActivity = SystemClock.uptimeMillis();\n\n        final boolean newService = app.services.add(r);\n        // \u53d1\u9001\u4e00\u4e2a\u5ef6\u65f6\u6d88\u606f SERVICE_TIMEOUT_MSG\uff0cService \u82e5\u6ca1\u6709\u542f\u52a8\u8d85\u65f6\uff0c\u5219\u56de\u544a\u8bc9 AMS \u53d6\u6d88\u8be5\u6d88\u606f\n        bumpServiceExecutingLocked(r, execInFg, \"create\");\n        mAm.updateLruProcessLocked(app, false, null);\n        mAm.updateOomAdjLocked();\n\n        boolean created = false;\n        try {\n            if (LOG_SERVICE_START_STOP) {\n                String nameTerm;\n                int lastPeriod = r.shortName.lastIndexOf('.');\n                nameTerm = lastPeriod &gt;= 0 ? r.shortName.substring(lastPeriod) : r.shortName;\n                EventLogTags.writeAmCreateService(\n                        r.userId, System.identityHashCode(r), nameTerm, r.app.uid, r.app.pid);\n            }\n            synchronized (r.stats.getBatteryStats()) {\n                r.stats.startLaunchedLocked();\n            }\n            mAm.ensurePackageDexOpt(r.serviceInfo.packageName);\n            app.forceProcessStateUpTo(ActivityManager.PROCESS_STATE_SERVICE);\n            // \u8fdb\u5165 Service \u7684 onCreate \n            app.thread.scheduleCreateService(r, r.serviceInfo,\n                    mAm.compatibilityInfoForPackageLocked(r.serviceInfo.applicationInfo),\n                    app.repProcState);\n            r.postNotification();\n            created = true;\n        } catch (DeadObjectException e) {\n            Slog.w(TAG, \"Application dead when creating service \" + r);\n            mAm.appDiedLocked(app); // \u521b\u5efa\u670d\u52a1\u65f6\uff0c\u5e94\u7528\u6302\u4e86\n            throw e;\n        } finally {\n            if (!created) {\n                // Keep the executeNesting count accurate.\n                final boolean inDestroying = mDestroyingServices.contains(r);\n                serviceDoneExecutingLocked(r, inDestroying, inDestroying);\n\n                // Cleanup.\n                if (newService) {\n                    app.services.remove(r);\n                    r.app = null;\n                }\n\n                // Retry.\n                if (!inDestroying) {\n                    scheduleServiceRestartLocked(r, false);\n                }\n            }\n        }\n\n        requestServiceBindingsLocked(r, execInFg);\n        updateServiceClientActivitiesLocked(app, null, true);\n\n        // If the service is in the started state, and there are no\n        // pending arguments, then fake up one so its onStartCommand() will\n        // be called.\n        if (r.startRequested &amp;&amp; r.callStart &amp;&amp; r.pendingStarts.size() == 0) {\n            r.pendingStarts.add(new ServiceRecord.StartItem(r, false, r.makeNextStartId(),\n                    null, null));\n        }\n        // \u8fdb\u5165 Service \u7684 onStartCommand \n        sendServiceArgsLocked(r, execInFg, true);\n\n        if (r.delayed) {\n            getServiceMap(r.userId).mDelayedStartList.remove(r);\n            r.delayed = false;\n        }\n\n        if (r.delayedStop) {\n            // Oh and hey we've already been asked to stop!\n            r.delayedStop = false;\n            if (r.startRequested) {\n                stopServiceLocked(r);\n            }\n        }\n    }\n</code></pre> <p>\u5728<code>realStartServiceLocked</code>\u65b9\u6cd5\u5185\uff0c\u9996\u5148\u4f1a\u901a\u8fc7<code>bumpServiceExecutingLocked</code>\u65b9\u6cd5\uff0c\u7136\u540e\u518d\u8c03\u7528<code>scheduleServiceTimeoutLocked</code>\u65b9\u6cd5\uff0c\u5411 ActivityManagerService \u7684 <code>MainHandler</code>\u7c7b\u578b\u7684 <code>mHandler</code> \u53d1\u9001\u4e00\u4e2a\u6d88\u606f <code>SERVICE_TIMEOUT_MSG</code>\u3002\u82e5 Service \u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u53ca\u65f6\u5411 ActivityManagerService \u8fd4\u56de\u6d88\u606f\uff0c\u628a<code>SERVICE_TIMEOUT_MSG</code>\u6d88\u606f\u7ed9\u53d6\u6d88\u6389\uff0c\u90a3\u4e48\u5219\u8ba4\u4e3a Service \u542f\u52a8\u8d85\u65f6\u4e86\u3002</p> <p>\u6807\u8bb0\u5b8c\u4e86\u65f6\u95f4\u540e\uff0c\u5c31\u901a\u8fc7<code>scheduleCreateService</code>\u65b9\u6cd5\u6765\u542f\u52a8 Service \uff0c\u8ba9 Service \u8fdb\u53bb<code>onCreate</code>\u72b6\u6001\u3002</p> <p>\u65b0\u521b\u5efa\u7684\u8fdb\u7a0b\u628a\u81ea\u5df1\u7684 Binder \u672c\u5730\u5bf9\u8c61 ApplicationThread \u4f20\u9012\u7ed9\u4e86 ActivityManagerService \uff0cActivityManagerService \u5c31\u901a\u8fc7\u5b83\u6765\u4e0e\u65b0\u8fdb\u7a0b\u901a\u4fe1\u4e86\uff0c<code>scheduleCreateService</code>\u65b9\u6cd5\u5411 Binder \u9a71\u52a8\u53d1\u9001\u4e86\u4e00\u4e2a\u7c7b\u578b\u4e3a <code>SCHEDULE_CREATE_SERVICE_TRANSACTION</code>\u7684\u6d88\u606f\uff0c\u800c\u5728 <code>ApplicationThread</code>\u54cd\u5e94\u4e86\u8be5\u6d88\u606f\u3002</p> <p><pre><code>public final void scheduleCreateService(IBinder token,\n                ServiceInfo info, CompatibilityInfo compatInfo, int processState) {\n            updateProcessState(processState, false);\n            CreateServiceData s = new CreateServiceData();\n            s.token = token;\n            s.info = info;\n            s.compatInfo = compatInfo;\n\n            sendMessage(H.CREATE_SERVICE, s);\n        }\n</code></pre> ApplicationThread \u7684 <code>scheduleCreateService</code>\u65b9\u6cd5\u5411 ActivityThread \u7684\u4e3b\u7ebf\u7a0b <code>mH</code>\u53d1\u9001\u4e86\u6d88\u606f<code>CREATE_SERVICE</code>\u3002ActivityThread \u6700\u7ec8\u54cd\u5e94\u8be5\u6d88\u606f\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#activitythread-handlecreateservice","title":"ActivityThread \u7c7b\u7684 handleCreateService() \u65b9\u6cd5","text":"<pre><code> private void handleCreateService(CreateServiceData data) {\n        // If we are getting ready to gc after going to the background, well\n        // we are back active so skip it.\n        unscheduleGcIdler();\n\n        LoadedApk packageInfo = getPackageInfoNoCheck(\n                data.info.applicationInfo, data.compatInfo);\n        Service service = null;\n        try {\n            java.lang.ClassLoader cl = packageInfo.getClassLoader();\n            // \u901a\u8fc7\u53cd\u5c04\u521b\u5efa\u76ee\u6807\u670d\u52a1\u5bf9\u8c61\n            service = (Service) cl.loadClass(data.info.name).newInstance();\n        } catch (Exception e) {\n        }\n\n        try {\n            // \u521b\u5efa ContextImpl\n            ContextImpl context = ContextImpl.createAppContext(this, packageInfo);\n            context.setOuterContext(service);\n            // \u521b\u5efa Application \u5bf9\u8c61\n            Application app = packageInfo.makeApplication(false, mInstrumentation);\n            service.attach(context, this, data.info.name, data.token, app,\n                    ActivityManagerNative.getDefault());\n            // Service \u8fdb\u5165 onCreate \u72b6\u6001\n            service.onCreate();\n            mServices.put(data.token, service);\n            try {\n                // \u5411 ActivityManagerService \u53d1\u9001\u6d88\u606f\u53d6\u6d88 Service \u542f\u52a8\u5ef6\u65f6\u6d88\u606f\n                ActivityManagerNative.getDefault().serviceDoneExecuting(\n                        data.token, SERVICE_DONE_EXECUTING_ANON, 0, 0);\n            } catch (RemoteException e) {\n                // nothing to do.\n            }\n        } catch (Exception e) {\n        }\n    }\n</code></pre> <p>ActivityThread \u7c7b\u7684<code>handleCreateService</code>\u4e3b\u8981\u662f\u521b\u5efa\u4e86 Service \u5bf9\u8c61\uff0c\u5e76\u4e14\u521b\u5efa\u4e86<code>ContextImpl</code>\u5bf9\u8c61\u548c<code>Application</code>\u5bf9\u8c61\u3002\u540c\u65f6\u8c03\u7528\u4e86 Service \u7684<code>onCreate</code>\u65b9\u6cd5\u3002\u6211\u4eec\u7ee7\u627f\u7684 Service \u7684<code>onCreate</code>\u65b9\u6cd5\u4e5f\u662f\u5728\u8fd9\u91cc\u88ab\u7cfb\u7edf\u56de\u8c03\u7684\u3002</p> <p>\u968f\u540e\u5411 ActivityManagerService \u53d1\u9001\u6d88\u606f\uff0c\u53d6\u6d88 Service \u5ef6\u65f6\u542f\u52a8\u7684\u6d88\u606f\u3002</p> <p>Service \u8fdb\u5165 <code>onCreate</code>\u72b6\u6001\u540e\uff0c\u63a5\u4e0b\u6765\u8be5\u8fdb\u5165<code>onStartCommand</code>\u72b6\u6001\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#activityservices-sendserviceargslocked","title":"ActivityServices \u7c7b\u7684 sendServiceArgsLocked() \u65b9\u6cd5","text":"<pre><code>    private final void sendServiceArgsLocked(ServiceRecord r, boolean execInFg,\n            boolean oomAdjusted) throws TransactionTooLargeException {\n        final int N = r.pendingStarts.size();\n        if (N == 0) {\n            return;\n        }\n\n        while (r.pendingStarts.size() &gt; 0) {\n            Exception caughtException = null;\n            ServiceRecord.StartItem si;\n            try {\n                si = r.pendingStarts.remove(0);\n                if (si.intent == null &amp;&amp; N &gt; 1) {\n                    // If somehow we got a dummy null intent in the middle,\n                    // then skip it.  DO NOT skip a null intent when it is\n                    // the only one in the list -- this is to support the\n                    // onStartCommand(null) case.\n                    continue;\n                }\n                si.deliveredTime = SystemClock.uptimeMillis();\n                r.deliveredStarts.add(si);\n                si.deliveryCount++;\n                if (si.neededGrants != null) {\n                    mAm.grantUriPermissionUncheckedFromIntentLocked(si.neededGrants,\n                            si.getUriPermissionsLocked());\n                }\n                // \u6dfb\u52a0\u5ef6\u65f6\u5904\u7406\uff0c\u7c7b\u4f3c\u4e8e onCreate \n                bumpServiceExecutingLocked(r, execInFg, \"start\");\n                if (!oomAdjusted) {\n                    oomAdjusted = true;\n                    mAm.updateOomAdjLocked(r.app);\n                }\n                int flags = 0;\n                if (si.deliveryCount &gt; 1) {\n                    flags |= Service.START_FLAG_RETRY;\n                }\n                if (si.doneExecutingCount &gt; 0) {\n                    flags |= Service.START_FLAG_REDELIVERY;\n                }\n                // \u8de8\u8fdb\u7a0b Service \u8fdb\u5165 onStartCommand \u72b6\u6001\n                r.app.thread.scheduleServiceArgs(r, si.taskRemoved, si.id, flags, si.intent);\n            } catch (TransactionTooLargeException e) {\n            } catch (RemoteException e) {\n            } catch (Exception e) {\n            }\n        }\n    }\n</code></pre> <p>\u5728<code>sendServiceArgsLocked</code>\u65b9\u6cd5\u5185\u901a\u8fc7\u8de8\u8fdb\u7a0b<code>scheduleServiceArgs</code>\u65b9\u6cd5\uff0c\u5411 ActivityThread \u53d1\u9001\u6d88\u606f\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#activitythread-handleserviceargs","title":"ActivityThread \u7c7b\u7684 handleServiceArgs() \u65b9\u6cd5","text":"<p><pre><code>    private void handleServiceArgs(ServiceArgsData data) {\n        Service s = mServices.get(data.token);\n        if (s != null) {\n            try {\n                if (data.args != null) {\n                    data.args.setExtrasClassLoader(s.getClassLoader());\n                    data.args.prepareToEnterProcess();\n                }\n                int res;\n                if (!data.taskRemoved) {\n                    // Service \u8fdb\u5165 onStartCommand \u72b6\u6001\n                    res = s.onStartCommand(data.args, data.flags, data.startId);\n                } else {\n                    s.onTaskRemoved(data.args);\n                    res = Service.START_TASK_REMOVED_COMPLETE;\n                }\n                QueuedWork.waitToFinish();\n                try {\n                // \u5411 ActivityManagerService \u53d1\u9001\u6d88\u606f\u53d6\u6d88\u5ef6\u65f6\n                    ActivityManagerNative.getDefault().serviceDoneExecuting(\n                            data.token, SERVICE_DONE_EXECUTING_START, data.startId, res);\n                } catch (RemoteException e) {\n                    // nothing to do.\n                }\n                ensureJitEnabled();\n            } catch (Exception e) {\n            }\n        }\n    }\n</code></pre> ActivityThread \u54cd\u5e94 Binder \u9a71\u52a8\u53d1\u9001\u6765\u7684\u6d88\u606f\uff0c\u4ecd\u7136\u901a\u8fc7\u7c7b\u578b\u4e3a<code>H</code>\u7684<code>mH</code>\u5904\u7406\u6d88\u606f\uff0c\u5904\u7406\u6d88\u606f\u7684\u65b9\u6cd5\u5c31\u662f<code>handleServiceArgs</code>\u3002\u5728\u65b9\u6cd5\u5185\uff0c\u56de\u8c03\u4e86 Service \u7684<code>onStartCommand</code>\u65b9\u6cd5\uff0c\u5e76\u4e14\u5411 ActivityManagerService \u53d1\u9001\u6d88\u606f\u53d6\u6d88\u4e86\u5ef6\u65f6\u64cd\u4f5c\u3002</p> <p>\u81f3\u6b64\uff0cService \u5728\u65b0\u8fdb\u7a0b\u4e2d\u7684\u542f\u52a8\u8fc7\u7a0b\u5c31\u5206\u6790\u7ed3\u675f\u4e86\uff0c\u4ece\u8c03\u7528\u8005\u7684<code>startService</code>\u65b9\u6cd5\uff0c\u518d\u5230 ActivityManagerService \u7684\u5904\u7406\uff0c\u518d\u5230 Service \u8fdb\u7a0b\u7684<code>onCreate</code>\u548c<code>onStartCommand</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/android-start-service/#_1","title":"\u53c2\u8003","text":"<ol> <li>Android 6.0 \u6e90\u7801</li> <li>\u300aAndroid \u7cfb\u7edf\u6e90\u4ee3\u7801\u60c5\u666f\u5206\u6790\u300b</li> <li>http://gityuan.com/2016/03/06/start-service/</li> </ol>","tags":["Android"]},{"location":"android/android-statemachine/","title":"Android StateMachine \u72b6\u6001\u673a\u5206\u6790","text":"<p>\u4e4b\u524d\u5c31\u6709\u5199\u8fc7\u4e00\u7bc7\u6587\u7ae0\u6765\u5b66\u4e60\u72b6\u6001\u673a\uff1a\u72b6\u6001\u673a\u5b66\u4e60\u3002</p> <p>\u5728\u4e4b\u540e\u7684\u5de5\u4f5c\u4e2d\u591a\u6b21\u7528\u5230\u4e86 StateMachine \u72b6\u6001\u673a\uff0c\u7b80\u5355\u8bb0\u5f55\u5176\u539f\u7406\u3002</p> <p>StateMachine \u7c7b\u4f4d\u4e8e Android \u6e90\u7801\u4e2d\u7684\uff0c\u8def\u5f84\u662f<code>frameworks/base/core/java/com/android/internal/util/StateMachine.java</code>\uff0c\u4ece\u8def\u5f84\u540d\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u662f\u4e00\u4e2a\u5de5\u5177\u7c7b\uff0c\u8be5\u7c7b\u5bf9\u72b6\u6001\u673a\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u65b9\u4fbf\u4f7f\u7528\u3002</p> <p>\u5728\u5b89\u5353\u6e90\u7801\u4e2d\u8fdb\u884c\u641c\u7d22\uff0c\u4f1a\u53d1\u73b0\u5f88\u591a\u7c7b\u7528\u5230\u4e86\u72b6\u6001\u673a\uff0c\u6bd4\u5982\uff1a<code>WifiStateMachine</code>\u3001<code>A2dpStateMachine</code>\u3001<code>NsdStateMachine</code>\u3001<code>P2dStateMachine</code>\u7b49\u7b49\uff0c\u5b83\u4eec\u90fd\u76f4\u63a5\u6216\u95f4\u63a5\u7684\u7ee7\u627f\u4e86 StateMachine \u7c7b\u3002\u53ef\u89c1\uff0c\u72b6\u6001\u673a\u7684\u601d\u60f3\u5728\u5b89\u5353\u6e90\u7801\u4e2d\u5f97\u5230\u4e86\u5e7f\u6cdb\u4f7f\u7528\u3002</p> <p>\u5728\u6211\u4eec\u7684\u5e94\u7528\u5f00\u53d1\u4e2d\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6e90\u7801\u4e2d\u7684<code>StateMachine</code>\u7c7b\uff0c\u53ea\u8981\u4ece\u6e90\u7801\u4e2d\u628a<code>StateMachine</code>\u548c<code>State</code>\u7c7b\u62f7\u8d1d\u5230\u6211\u4eec\u7684\u5de5\u7a0b\u76ee\u5f55\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86\uff0c\u5bf9\u4e8e\u5176 import \u7684\u4e00\u4e9b\u7c7b\uff0c\u5728\u6211\u4eec\u7684\u5f00\u53d1\u73af\u5883\u4e2d\u4e5f\u5168\u90fd\u6709\uff0c\u4e0d\u7528\u62c5\u5fc3\u3002</p> <p>\u5982\u679c\u4f60\u5bf9\u72b6\u6001\u673a\u6709\u90a3\u4e48\u4e00\u4e1d\u4e1d\u7684\u4e86\u89e3\uff0c\u90a3\u4e48\u5b66\u4e60 StateMachine \u7c7b\u6700\u597d\u7684\u8d44\u6599\u5c31\u662f\u5b83\u7684\u6ce8\u91ca\u4e86\uff0c\u89e3\u91ca\u7684\u4e00\u6e05\u4e8c\u695a\u3002</p>","tags":["Android"]},{"location":"android/android-statemachine/#_1","title":"\u7b80\u5355\u4f7f\u7528\u9610\u8ff0","text":"<p>Android \u4e2d\u7684\u72b6\u6001\u673a\u662f\u4e00\u4e2a\u5206\u5c42\u7684\u6d88\u606f\u5904\u7406\u673a\u5236\uff0c\u6bcf\u4e00\u5c42\u90fd\u4f1a\u6709\u4e00\u5230\u591a\u4e2a\u8282\u70b9\uff0c\u800c\u72b6\u6001\u673a\u7684\u6d88\u606f\u5c31\u662f\u5728\u8fd9\u4e9b\u8282\u70b9\u4e4b\u95f4\u6d41\u8f6c\u5904\u7406\uff0c\u5982\u4e0b\u7ed3\u6784\u6240\u793a\uff1a</p> <pre><code>    // \u72b6\u6001\u673a\u5206\u5c42\u7ed3\u6784\n          mP0\n         /   \\\n        mP1   mS0\n       /   \\\n      mS2   mS1\n     /  \\    \\\n    mS3  mS4  mS5  ---&gt; initial state \u521d\u59cb\u8282\u70b9\n</code></pre> <p>\u800c\u8282\u70b9\u5c31\u662f<code>State</code>\u7c7b\uff0c\u5b83\u5b9e\u73b0\u4e86<code>IState</code>\u63a5\u53e3\uff0c\u9664\u4e86<code>enter</code>\u3001<code>exit</code>\u65b9\u6cd5\u5916\uff0c\u8fd8\u6709<code>processMessage</code>\u65b9\u6cd5\uff0c\u8868\u793a\u7528\u6765\u5904\u7406\u8282\u70b9\u7684\u6d88\u606f\u3002\u82e5\u8fd4\u56de<code>HANDLED</code>\u5219\u8868\u793a\u6d88\u606f\u5904\u7406\u5b8c\u6210\uff0c\u82e5\u8fd4\u56de<code>NOT_HANDLED</code>\u5219\u8868\u793a\u6d88\u606f\u6ca1\u6709\u5904\u7406\u3002</p>","tags":["Android"]},{"location":"android/android-statemachine/#_2","title":"\u6784\u9020\u72b6\u6001\u673a","text":"<p>\u5728\u6211\u4eec\u4f7f\u7528 StateMachine \u4e4b\u524d\uff0c\u8981\u6784\u9020\u597d\u6240\u9700\u7684\u72b6\u6001\u5206\u5c42\u7ed3\u6784\u3002\u901a\u8fc7<code>addState</code>\u65b9\u6cd5\u6765\u5411\u72b6\u6001\u673a\u4e2d\u6dfb\u52a0\u8282\u70b9\uff0c\u4f8b\u5982\u5982\u4e0b\u7684\u72b6\u6001\u7ed3\u6784\uff0cmS1 \u548c mS2 \u8282\u70b9\u6709\u516c\u5171\u7684\u7236\u8282\u70b9 mP1\uff0c\u540c\u65f6\u8fd8\u6709\u4e00\u4e2a\u5b64\u7acb\u7684\u8282\u70b9 mP2\u3002 <pre><code>      // \u72b6\u6001\u5206\u5c42\u7ed3\u6784\u8bbe\u5b9a\n        mP1      mP2\n       /   \\\n      mS2   mS1\n      // \u6784\u9020\u72b6\u6001\u673a\u7ed3\u6784\u4ee3\u7801\n      addState(mP1);\n          addState(mS1, mP1);\n          addState(mS2, mP1);\n      addState(mP2);\n</code></pre></p> <p><code>addState</code>\u65b9\u6cd5\u6dfb\u52a0\u8282\u70b9\u65f6\uff0c\u8fd8\u80fd\u6307\u5b9a\u5176\u7236\u8282\u70b9\u6dfb\u52a0\u3002</p> <p>\u5f53\u6211\u4eec\u6784\u9020\u5b8c\u4e86\u72b6\u6001\u673a\u65f6\uff0c\u8fd8\u9700\u8981\u6307\u5b9a\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9\u4e3a\u542f\u52a8\u70b9\uff0c\u6d88\u606f\u4ece\u542f\u52a8\u70b9\u5f00\u59cb\u5904\u7406\uff0c\u901a\u8fc7<code>setInitialState</code>\u65b9\u6cd5\u6765\u6307\u5b9a\u542f\u52a8\u70b9\uff0c\u6700\u540e\u901a\u8fc7<code>start</code>\u65b9\u6cd5\u542f\u52a8\u72b6\u6001\u673a\u3002</p>","tags":["Android"]},{"location":"android/android-statemachine/#_3","title":"\u72b6\u6001\u673a\u6d88\u606f\u5904\u7406","text":"<p>\u5f53\u6784\u9020\u5b8c\u60f3\u8981\u7684\u72b6\u6001\u673a\u7ed3\u6784\u65f6\uff0c\u5c31\u662f\u5bf9\u72b6\u6001\u673a\u5185\u90e8\u6d88\u606f\u6d41\u8f6c\u7684\u5904\u7406\u4e86\u3002</p> <p>\u5f53<code>start</code>\u72b6\u6001\u673a\u65f6\uff0c\u72b6\u6001\u673a\u7684\u7b2c\u4e00\u4e2a\u52a8\u4f5c\u5c31\u662f\u8c03\u7528\u8282\u70b9\u7684<code>enter</code>\u65b9\u6cd5\uff0c\u4e0d\u8fc7\uff0c\u5b83\u8c03\u7528\u7684\u662f\u6307\u5b9a\u7684\u542f\u52a8\u70b9\u7684\u6700\u8fdc\u7684\u7236\u8282\u70b9\u7684<code>enter</code>\u65b9\u6cd5\uff0c\u7136\u540e\u518d\u662f\u6b21\u4e00\u7ea7\u7684\u7236\u8282\u70b9\u7684<code>enter</code>\u65b9\u6cd5\uff0c\u6700\u540e\u624d\u662f\u542f\u52a8\u70b9\u7684<code>enter</code>\u65b9\u6cd5\uff0c\u5c31\u5982\u540c\u4e0a\u9762\u7684\u7ed3\u6784\u6240\u793a\uff0c\u5148\u8c03\u7528 mP1 \u70b9\uff0c\u7136\u540e\u624d\u662f mS1 \u70b9\u7684\u65b9\u6cd5\uff0c\u6b64\u65f6 mS1 \u8282\u70b9\u5c31\u662f\u72b6\u6001\u673a\u7684\u5f53\u524d\u5bf9\u5916\u7684\u70b9\u3002\u7531\u6b64\u53ef\u89c1\uff0c\u5f53\u542f\u52a8\u70b9\u8fdb\u5165 <code>enter</code>\u72b6\u6001\u65f6\uff0c\u5b83\u7684\u7236\u8282\u70b9\uff0c\u76f4\u81f3\u6700\u9876\u5c42\u7684\u7236\u8282\u70b9\u90fd\u8fdb\u5165\u4e86<code>enter</code>\u72b6\u6001\u4e86\u3002</p> <p>\u72b6\u6001\u673a\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd 0 \u4e2a\u6216 1 \u4e2a\u7236\u8282\u70b9\uff0c\u5f53\u5b50\u8282\u70b9\u4e0d\u80fd\u5904\u7406\u5f53\u524d\u6d88\u606f\u65f6\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u8fd4\u56de<code>NOT_HANDLED</code>\u5c06\u5f53\u524d\u6d88\u606f\u4f20\u9012\u7ed9\u5176\u7236\u8282\u70b9\u6765\u5904\u7406\u3002\u5982\u679c\u4e00\u4e2a\u6d88\u606f\u4ece\u672a\u88ab\u5904\u7406\u8fc7\uff0c\u90a3\u4e48<code>unhandledMessage</code>\u65b9\u6cd5\u5c06\u4f1a\u88ab\u8c03\u7528\u7ed9\u6700\u540e\u4e00\u6b21\u673a\u4f1a\u6765\u5904\u7406\u8be5\u6d88\u606f\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8282\u70b9\u8fd8\u53ef\u4ee5\u901a\u8fc7<code>transitionTo</code>\u65b9\u6cd5\u5c06\u5f53\u524d\u8282\u70b9\u8f6c\u79fb\u81f3\u53e6\u5916\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\u3002</p> <pre><code>          mP0\n         /   \\\n        mP1   mS0\n       /   \\\n      mS2   mS1\n     /  \\    \\\n    mS3  mS4  mS5  ---&gt; initial state\n</code></pre> <p>\u4f8b\u5982\uff0c\u5f53 mS5 \u5904\u7406\u6d88\u606f\uff0c\u60f3\u8981\u5c06\u5f53\u524d\u8282\u70b9\u8f6c\u79fb\u81f3 mS4 \u65f6\uff0c\u90a3\u4e48\u5b83\u4f1a\u5148\u627e\u5230 mS5 \u548c mS4 \u6700\u8fd1\u7684\u516c\u6709\u7236\u8282\u70b9 mP1\u3002\u7136\u540e\uff0c\u9664\u4e86\u8fd9\u4e2a\u6700\u8fd1\u7684\u516c\u6709\u7236\u8282\u70b9 mP1 \u4ee5\u53ca\u5b83\u7684\u4e0a\u5c42\u8282\u70b9\u5916\uff0cmS5 \u8fdb\u5165<code>enter</code>\u72b6\u6001\u65f6\u542f\u52a8\u7684\u90a3\u4e9b\u7236\u8282\u70b9\u90fd\u4f1a\u9000\u51fa\u8c03\u7528<code>exit</code>\u65b9\u6cd5\u3002\u6700\u540e\u518d\u7531 mP1 \u8282\u70b9\u4e0b\u7684\u8282\u70b9\u8c03\u7528<code>enter</code>\u65b9\u6cd5\u76f4\u5230\u65b0\u8282\u70b9 mS4 \u8c03\u7528\u4e86<code>enter</code>\u65b9\u6cd5\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece mS5 \u5230 mS4 \u72b6\u6001\u7684\u8f6c\u53d8\uff0c\u5148\u662f mS5\u3001mS1 \u8c03\u7528\u4e86<code>exit</code>\u65b9\u6cd5\uff0c\u518d\u662f mS2\u3001mS4 \u8c03\u7528\u4e86<code>enter</code>\u65b9\u6cd5\uff0c\u8fd9\u5c31\u662f\u72b6\u6001\u673a\u4e2d\u8282\u70b9\u53d1\u751f\u72b6\u6001\u8f6c\u79fb\u65f6\u7684\u8c03\u7528\u8fc7\u7a0b\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8282\u70b9\u8fd8\u53ef\u4ee5\u8c03\u7528<code>deferMessage</code>\u548c<code>sendMessageAtFroneOfQueue</code>\u65b9\u6cd5\u3002<code>deferMessage</code>\u65b9\u6cd5\u4f7f\u5f97\u6d88\u606f\u5b58\u50a8\u5728\u6d88\u606f\u961f\u5217\u4e2d\uff0c\u5f53\u72b6\u6001\u8f6c\u79fb\u5230\u65b0\u8282\u70b9\u65f6\u624d\u4f1a\u5904\u7406\uff0c\u800c<code>sendMessageAtFrontOfQueue</code>\u65b9\u6cd5\u5219\u662f\u5c06\u6d88\u606f\u653e\u7f6e\u5230\u6d88\u606f\u961f\u5217\u7684\u5934\u90e8\u3002</p> <p>\u5f53\u72b6\u6001\u673a\u7684\u6240\u6709\u6d88\u606f\u90fd\u5b8c\u6210\u65f6\uff0c\u53ef\u4ee5\u8c03\u7528<code>transitionToHaltingState</code>\u65b9\u6cd5\u6765\u5c06\u72b6\u6001\u673a\u5904\u7406\u505c\u6b62\u72b6\u6001\u3002\u6b64\u65f6\uff0c\u72b6\u6001\u673a\u5c06\u8f6c\u79fb\u5230<code>HaltingState</code>\u505c\u6b62\u72b6\u6001\uff0c\u5e76\u8c03\u7528<code>halting</code>\u65b9\u6cd5\u3002\u968f\u540e\u6536\u5230\u7684\u6240\u6709\u6d88\u606f\u90fd\u53ea\u662f\u4f1a\u8c03\u7528<code>haltedProcessMessage</code>\u65b9\u6cd5\u6765\u5904\u7406\u4e86\u3002</p> <p>\u82e5\u60f3\u8981\u5b8c\u5168\u7684\u505c\u6b62\u72b6\u6001\u673a\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528<code>quit</code>\u6216\u8005<code>quitNow</code>\u65b9\u6cd5\u6765\u5904\u7406\u3002</p> <p>\u4ee5\u4e0a\u5c31\u662f\u72b6\u6001\u673a\u5bf9\u4e8e\u6d88\u606f\u5904\u7406\u7684\u8fc7\u7a0b\uff0c\u957f\u7bc7\u7684\u6587\u5b57\u8bf4\u660e\u8fd8\u662f\u4e0d\u5982\u4ee3\u7801\u6765\u7684\u76f4\u89c2\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d34\u5b8c\u6574\u7684\u4ee3\u7801\u4e86\uff0c\u53c2\u8003\u4ee3\u7801\u7684\u8fde\u63a5\u5982\u4e0b\uff1aGithubGist \u94fe\u63a5\u5730\u5740</p>","tags":["Android"]},{"location":"android/android-statemachine/#_4","title":"\u72b6\u6001\u673a\u5b9e\u73b0\u539f\u7406\u5206\u6790","text":"<p>\u5982\u679c\u6211\u4eec\u5728\u521d\u59cb\u5316\u72b6\u6001\u673a\u65f6\u53ea\u662f\u4f20\u9012\u4e86\u4e00\u4e2a\u540d\u5b57\uff0c\u800c\u6ca1\u6709\u4f20\u9012 Looper \u6216\u8005 Handler \u4e4b\u7c7b\u7684\u6d88\u606f\u5faa\u73af\uff0c\u90a3\u4e48\u72b6\u6001\u673a\u9ed8\u8ba4\u5c31\u662f\u542f\u7528\u5176\u5185\u90e8\u7684\u4e00\u4e2a\u7ebf\u7a0b<code>HandlerThread</code>\u3002 <pre><code>  protected StateMachine(String name) {\n        mSmThread = new HandlerThread(name); // \u521b\u5efa HandlerThread \u7ebf\u7a0b\n        mSmThread.start();\n        Looper looper = mSmThread.getLooper();\n        initStateMachine(name, looper);\n    }\n    // \u5c06\u6d88\u606f\u5faa\u73af Looper \u4e0e Handler \u8fdb\u884c\u7ed1\u5b9a\n  private void initStateMachine(String name, Looper looper) {\n        mName = name;\n        mSmHandler = new SmHandler(looper, this);\n    }\n</code></pre> \u6784\u9020\u72b6\u6001\u53ca\u65f6\uff0c\u5728\u5176\u5185\u90e8\u5f00\u542f\u4e86\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u5e76\u5c06\u5176\u6d88\u606f\u5faa\u73af Looer \u4f20\u9012\u7ed9\u4e86 <code>SmHandler</code> \u5bf9\u8c61\uff0c\u800c<code>SmHandler</code>\u5bf9\u8c61\u5c31\u662f\u72b6\u6001\u673a\u4e2d\u6700\u4e3b\u8981\u7684\u7528\u6765\u6d3e\u53d1\u6d88\u606f\u4e8b\u4ef6\u548c\u5207\u6362\u72b6\u6001\u7684\u4e86\uff0c\u5b83\u6d3e\u53d1\u7684\u6d88\u606f\u90fd\u662f\u5728 HandlerThread \u7ebf\u7a0b\u8fdb\u884c\u5904\u7406\u7684\u3002</p> <p>\u540c\u65f6\uff0cSmHandler \u5185\u90e8\u6709\u4e24\u4e2a\u6570\u7ec4\uff0c\u7528\u6765\u4fdd\u5b58\u72b6\u6001\u673a\u4e2d\u7684\u94fe\u5f0f\u72b6\u6001\u5173\u7cfb\uff0c\u5206\u522b\u662f<code>mStateStack</code>\u548c<code>mTempStateStack</code>\u53d8\u91cf\u3002\u5f53\u72b6\u6001\u673a\u5b8c\u6210\u542f\u52a8\u65f6\uff0c\u5c31\u4f1a\u901a\u8fc7\u4e0a\u9762\u6765\u4e2a\u53d8\u91cf\u6765\u4fdd\u5b58\u8282\u70b9\u4fe1\u606f\u3002</p> <p>\u800c\u72b6\u6001\u673a\u7684\u6d88\u606f\u5904\u7406\uff0c\u5185\u90e8\u4e5f\u662f\u901a\u8fc7 SmHandler \u6765\u5904\u7406\u8f6c\u53d1\u7684\u3002</p> <p>\u5177\u4f53\u7684\u5b9e\u73b0\uff0c\u5efa\u8bae\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1ahttp://blog.csdn.net/yangwen123/article/details/10591451 \u8bb2\u7684\u5b9e\u5728\u592a\u8be6\u7ec6\u4e86\uff0c\u62dc\u8bfb\u4e86\u591a\u904d\u4e5f\u4e0d\u6562\u8bf4\u5199\u7684\u80fd\u6bd4\u5b83\u66f4\u6e05\u695a\u3002</p>","tags":["Android"]},{"location":"android/android-statemachine/#_5","title":"\u53c2\u8003","text":"<p>1\u3001http://blog.csdn.net/yangwen123/article/details/10591451</p>","tags":["Android"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/","title":"Kotlin \u4e2d\u7684 run\u3001let\u3001with\u3001apply\u3001also\u3001takeIf\u3001takeUnless \u8bed\u6cd5\u7cd6\u4f7f\u7528\u548c\u539f\u7406\u5206\u6790","text":"<p>\u5728 Kotlin \u6709\u4e00\u4e9b\u53ef\u4ee5\u7b80\u5316\u4ee3\u7801\u7684\u8bed\u6cd5\u7cd6\uff0c\u6bd4\u5982 run\u3001let\u3001with\u3001apply\u3001also\u3001takeIf\u3001takeUnless  \u7b49\u3002</p> <p>\u518d\u4e0d\u660e\u767d\u8fd9\u4e9b\u8bed\u6cd5\u7cd6\u7684\u60c5\u51b5\u4e0b\u53bb\u770b Kotlin \u4ee3\u7801\u5c31\u4f1a\u4e00\u8138\u61f5\u903c\uff0c\u53ef\u5f53\u660e\u767d\u4e4b\u540e\u5c31\u4f1a\u89c9\u5f97\u539f\u6765\u53ef\u4ee5\u8fd9\u6837\u7b80\u5316\u3002</p>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#_1","title":"\u5e26\u63a5\u6536\u8005\u7684\u51fd\u6570\u5b57\u9762\u503c","text":"<p>\u4f7f\u7528\u8fd9\u4e9b\u8bed\u6cd5\u7cd6\u4e4b\u524d\u56de\u987e\u4e00\u4e0b Kotlin \u7684\u51fd\u6570\u5f0f\u7f16\u7a0b\uff0c\u5728\u5206\u6790 Kotlin \u4f7f\u7528 Anko \u6784\u5efa\u5e03\u5c40 \u6587\u7ae0\u4e2d\u6709\u63d0\u5230 \u5e26\u63a5\u6536\u8005\u7684\u51fd\u6570\u5b57\u9762\u503c\u3002</p> <p>\u5b83\u7684\u5f62\u5f0f\u662f\u8fd9\u6837\u7684\uff1a</p> <pre><code>// \u5b9a\u4e49\u4e00\u4e2a\u7c7b\nclass ReceiveObject \n// \u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\nfun exec(invoke: ReceiveObject.()-&gt; Int){}\n</code></pre> <p>\u5728 Kotlin \u4e2d\uff0c\u51fd\u6570\u4e5f\u53ef\u4ee5\u5f53\u505a\u53d8\u91cf\u4f20\u53c2\uff0c\u4f8b\u5982\uff1a</p> <pre><code>fun funAsArg(args:()-&gt;Int){}\n// \u8c03\u7528\nfunAsArg { 2 }\n</code></pre> <p>args \u662f\u53d8\u91cf\u540d\uff0c\u5b83\u7684\u7c7b\u578b\u5c31\u662f\u51fd\u6570\uff0c\u51fd\u6570\u5f62\u5f0f\u5728\u53d8\u91cf\u540d\u540e\u9762\u7ea6\u5b9a\uff1a<code>()-&gt;Int</code>\uff0c\u51fd\u6570\u6ca1\u6709\u53c2\u6570\uff0c\u4f46\u662f\u4f1a\u8fd4\u56de\u4e00\u4e2a Int \u7c7b\u578b\u7684\u503c\u3002</p> <p>\u800c\u5e26\u63a5\u6536\u8005\u7684\u51fd\u6570\u5b57\u9762\u503c\uff0c\u5c31\u662f\u5728\u4f5c\u4e3a\u4f20\u5165\u53c2\u6570\u7684\u51fd\u6570\u53d8\u91cf\u7684\u5177\u4f53\u51fd\u6570\u5f62\u5f0f\u7684\u53c2\u6570\u524d\u9762\u591a\u4e86\u63a5\u6536\u8005\u5bf9\u8c61\uff0c\u7b80\u5355\u8bf4\u5c31\u662f\u5728 <code>()</code>\u524d\u9762\u591a\u4e86\u4e00\u4e2a\u70b9\u548c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6210\u4e86\u5982\u4e0b\u7684\u5f62\u5f0f\uff1a</p> <pre><code>fun exec(invoke: ReceiveObject.()-&gt; Int){}\n</code></pre> <p>\u5c31\u662f\u8fd9\u591a\u4e86\u7684\u4e00\u4e2a\u70b9\u548c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u8ba9\u5b83\u6709\u4e86\u4e0d\u4e00\u6837\u7684\u529f\u80fd\u3002</p> <p>\u7b80\u5355\u7684\u8bf4\uff0cinvoke \u53d8\u91cf\u662f\u4e00\u4e2a\u51fd\u6570\u4f5c\u4e3a\u53d8\u91cf\uff0c\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u5177\u4f53\u51fd\u6570\u5b9e\u73b0\u4f5c\u4e3a\u5f62\u53c2\u7ed9 invoke\uff0c\u90a3\u4e48\u5728\u5177\u4f53\u51fd\u6570\u5b9e\u73b0\u91cc\u9762\u5c31\u53ef\u4ee5\u8c03\u7528\u63a5\u6536\u8005\u5bf9\u8c61 ReceiveObject \u7684\u76f8\u5173\u65b9\u6cd5\uff0c\u5982\u4e0b\uff1a</p> <pre><code>    // \u63a5\u6536\u8005\u5bf9\u8c61\uff0c\u6709\u4e2a show \u65b9\u6cd5\n    class ReceiveObject{\n        fun show(){\n            println(\"call\")\n        }\n    }\n    // \u5177\u4f53\u51fd\u6570\u5b9e\u73b0\n    val invoke: ReceiveObject.() -&gt; Int = {\n        this.show() // \u7528 this \u6307\u4ee3 \u63a5\u6536\u8005\u5bf9\u8c61 ReceiveObject\n        2\n    }\n    exec(invoke)\n</code></pre> <p>\u5982\u4e0a\uff0c\u5728 invoke \u65b9\u6cd5\u91cc\u9762\u4f7f\u7528 <code>this</code> \u6307\u4ee3 ReceiveObject \u5bf9\u8c61\uff0c\u53ef\u4ee5\u8c03\u7528\u5b83\u7684\u65b9\u6cd5\u3002</p> <p>\u800c invoke \u53d8\u91cf\u662f\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 exec \u51fd\u6570\u7684\uff0c\u5982\u679c exec \u51fd\u6570\u4e3a\u7a7a\uff0c\u90a3\u4e48 inkoke \u5177\u4f53\u5b9e\u73b0\u7684 show \u65b9\u6cd5\u4e5f\u4e0d\u4f1a\u88ab\u8c03\u7528\u7684\uff0c\u5728 exec \u4e2d\u8c03\u7528 invoke \u7684\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>fun exec(invoke: ReceiveObject.() -&gt; Int){\n    val receObj = ReceiveObject()\n    // \u4e24\u79cd\u8c03\u7528\u5f62\u5f0f\n    // \u7c7b\u4f3c\u4e8e ReceiceObject \u62d3\u5c55\u51fd\u6570\u4e00\u6837\u7684\u8c03\u7528\n    receObj.invoke() \n    // \u628a ReceiceObject \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 invoke \u8c03\u7528\n    invoke(receObj)\n}\n</code></pre> <p>\u5728 exec \u7684\u5177\u4f53\u8c03\u7528\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u6784\u9020\u4e00\u4e2a ReceiveObject \u5bf9\u8c61\u5b9e\u4f8b\uff0c\u4e0d\u7136\u600e\u4e48\u53bb\u8c03\u7528\u5b83\u7684 show \u65b9\u6cd5\u5462\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u8fd8\u9700\u8981\u6784\u9020\u4e00\u4e2a\u6307\u5b9a\u7684\u63a5\u6536\u8005\u5bf9\u8c61\u5b9e\u4f8b\u624d\u80fd\u5b8c\u6210 invoke \u7684\u8c03\u7528\uff0c\u800c Kotlin \u7684\u8bed\u6cd5\u7cd6\u4e2d\u8fd8\u6709\u4e00\u79cd\u53eb\u505a <code>\u62d3\u5c55\u51fd\u6570</code>\u3002</p>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#_2","title":"\u62d3\u5c55\u51fd\u6570","text":"<p>\u62d3\u5c55\u51fd\u6570\u76f8\u5f53\u4e8e\u7ed9\u67d0\u4e2a\u7c7b\u6dfb\u52a0\u51fd\u6570\uff0c\u4f46\u8fd9\u4e2a\u51fd\u6570\u5e76\u4e0d\u5c5e\u4e8e\u8fd9\u4e2a\u7c7b\u7684\u51fd\u6570\uff0c\u548c static \u65b9\u6cd5\u662f\u4e24\u7801\u4e8b\u3002</p> <pre><code>    fun Context.showToast(msg: String) {\n        Toast.makeText(this, msg, Toast.LENGTH_SHORT).show()\n    }\n</code></pre> <p>\u5728\u62d3\u5c55\u51fd\u6570\u4e2d\uff0c\u4f7f\u7528 this \u6307\u4ee3\u88ab\u62d3\u5c55\u7684\u7c7b\u5b9e\u4f8b\uff0c\u4e0a\u9762\u4ee3\u7801\u4e2d this \u6307\u4ee3\u5c31\u662f Context \u3002</p> <p>\u6709\u4e86 \u62d3\u5c55\u51fd\u6570\u548c\u5e26\u63a5\u6536\u8005\u7684\u51fd\u6570\u5b57\u9762\u503c\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u6587\u7ae0\u6807\u9898\u63d0\u5230\u7684\u90a3\u4e9b\u8bed\u6cd5\u7cd6\u4e86\u3002</p> <p>\u4f8b\u5982\uff0c\u9488\u5bf9 ReceiveObject \u5bf9\u8c61\u6dfb\u52a0\u5b83\u7684\u62d3\u5c55\u51fd\u6570\uff0c\u62d3\u5c55\u51fd\u6570\u7684\u53c2\u6570\u53c8\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u51fd\u6570\u662f\u5e26\u63a5\u6536\u8005\u7684\u51fd\u6570\u5b57\u9762\u503c\uff0c\u8fd9\u4e2a\u63a5\u6536\u8005\u5bf9\u8c61\u5c31\u662f ReceiveObject \u5bf9\u8c61\u5b83\u672c\u8eab\uff0c\u8fd9\u6837\u8c03\u7528 invoke \u65b9\u6cd5\u5c31\u4e0d\u7528\u518d\u6784\u9020 ReceiveObject \u5bf9\u8c61\u4e86\u3002</p> <pre><code>fun ReceiveObject.exec(invoke: ReceiveObject.() -&gt; Int){\n    invoke()\n}\n</code></pre>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#_3","title":"\u8bed\u6cd5\u7cd6","text":"<p>\u4e0b\u9762\u4ecb\u7ecd\u7684\u8bed\u6cd5\u7cd6\u90fd\u662f\u4f4d\u4e8e Kotlin Standard.kt \u6587\u4ef6\u4e2d\u7684\u3002</p>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#run","title":"run \u8bed\u6cd5\u7cd6","text":"<p>run \u7684\u8bed\u6cd5\u7cd6\u6709\u4e24\u79cd\uff1a</p> <pre><code>public inline fun &lt;R&gt; run(block: () -&gt; R): R {\n    contract {\n        callsInPlace(block, InvocationKind.EXACTLY_ONCE)\n    }\n    return block()\n}\n</code></pre> <p>\u8fd9\u79cd\u8bed\u6cd5\u7cd6\u4f20\u9012\u7684\u53c2\u6570\u5c31\u4ec5\u4ec5\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e0d\u662f\u5e26\u63a5\u6536\u8005\u5bf9\u8c61\u7684\u51fd\u6570\u5b57\u9762\u503c\uff0c\u5b83\u7684\u8fd4\u56de\u7ed3\u679c\u5c31\u662f block \u51fd\u6570\u8c03\u7528\u540e\u7684\u7ed3\u679c\u3002</p> <p>\u8c03\u7528\u793a\u4f8b\uff1a</p> <pre><code>    var result = kotlin.run { \n            \"value\"\n        }\n</code></pre> <p>\u76f8\u5bf9\u4e8e\u7ed9 arg \u53d8\u91cf\u8d4b\u503c\u4e3a value \u5b57\u7b26\u4e32\u3002</p> <p>run \u7684\u53e6\u4e00\u79cd\u8bed\u6cd5\u7cd6\uff1a</p> <pre><code>public inline fun &lt;T, R&gt; T.run(block: T.() -&gt; R): R {\n    contract {\n        callsInPlace(block, InvocationKind.EXACTLY_ONCE)\n    }\n    return block()\n}\n</code></pre> <p>\u9996\u5148\uff0c\u8fd9\u4e2a\u8bed\u6cd5\u7cd6\u662f\u4e00\u4e2a\u62d3\u5c55\u51fd\u6570\uff0c\u800c\u4e14\u7528\u5230\u4e86\u6cdb\u578b <code>&lt;T,R&gt;</code>\uff0cT \u7c7b\u578b\u7684\u62d3\u5c55\u51fd\u6570\uff0c\u8fd4\u56de\u7684\u662f R \u7c7b\u578b\uff0cT \u548c R \u53ef\u4ee5\u76f8\u540c\u3002</p> <p>\u5176\u6b21\uff0c\u4f20\u9012\u7684\u53c2\u6570\u662f\u5e26\u63a5\u6536\u8005\u5bf9\u8c61\u7684\u51fd\u6570\u5b57\u9762\u503c\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u5728 block \u51fd\u6570\u91cc\u9762\u8c03\u7528 T \u7684\u76f8\u5173\u65b9\u6cd5\uff0c\u901a\u8fc7 this \u6765\u6307\u4ee3 T \uff0c\u5728 run \u65b9\u6cd5\u5185\u90e8\u5c31\u662f\u8c03\u7528\u4e86 block \u65b9\u6cd5\uff0c\u8fd4\u56de block \u51fd\u6570\u8c03\u7528\u540e\u7684\u7ed3\u679c\u3002</p> <p>\u8c03\u7528\u793a\u4f8b\uff1a</p> <pre><code>            val result = \"a\".run {\n                this.plus(\"b\")\n            }\n</code></pre>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#contracts-dsl","title":"Contracts DSL","text":"<p>\u5728 run \u7684\u8bed\u6cd5\u7cd6\u91cc\u9762\u8fd8\u51fa\u73b0\u4e86\u5982\u4e0b\u4e00\u6bb5\u4ee3\u7801\uff1a</p> <pre><code> contract {\n      callsInPlace(block, InvocationKind.EXACTLY_ONCE)\n   }\n</code></pre> <p>Google \u4e86\u4e00\u756a\u4e4b\u540e</p> <ul> <li>https://discuss.kotlinlang.org/t/status-of-kotlin-internal-contracts/6392/2</li> <li>https://stackoverflow.com/questions/49729037/how-does-kotlin-internal-contracts-contractbuilderktcontract-work-in-kotlin</li> <li>https://aisia.moe/2018/03/25/kotlin-contracts-dsl/</li> </ul> <p>\u5f97\u51fa\u539f\u6765\u8fd9\u662f Kotlin 1.2.x \u7248\u672c\u4e2d\u51fa\u73b0\u7684\uff0c\u4f46\u5b9e\u9645\u5e76\u6ca1\u6709\u7528\uff0c\u662f Kotlin \u540e\u7eed\u53d1\u5c55\u7528\u6765\u89e3\u51b3\u5982\u4e0b\u4ee3\u7801\u95ee\u9898\u7684\uff1a</p> <pre><code>if (!x.isNullOrEmpty()) { \n  // we know that 'x != null' here \n  println(x.length)\n}\n</code></pre> <p>\u5047\u8bbe x \u662f\u53ef\u4ee5\u4e3a null \u7684\uff0c\u7ecf\u8fc7 isNullOrEmpty \u51fd\u6570\u5224\u65ad\u4e4b\u540e\uff0c\u518d\u6267\u884c println \u51fd\u6570\uff0c\u90a3\u4e48\u5b83\u80af\u5b9a\u5c31\u4e0d\u662f null \u4e86\uff0c\u5c31\u4e0d\u9700\u8981\u518d\u52a0\u4e24\u4e2a <code>!!</code> \u6765\u8868\u793a x \u4e0d\u4e3a null \u4e86\uff0c\u800c\u73b0\u5728\u7684\u60c5\u51b5\u662f\u8981\u6dfb\u52a0 <code>!!</code> \u3002</p> <p>\u4ece Google \u6765\u7684\u4fe1\u606f\u5f97\u77e5\uff0c contract \u8fd9\u6bb5\u4ee3\u7801\u5c31\u662f\u4e3a\u4e86\u8fd9\u6837\u7684\u95ee\u9898\u7684\u3002</p> <p>\u7531\u4e8e\u8bed\u6cd5\u7cd6\u90fd\u6709\u90a3\u6837\u4e00\u6bb5\u4ee3\u7801\uff0c\u6240\u4ee5\u5c31\u5148\u628a\u5b83\u4eec\u53bb\u6389\u4e86\u3002</p>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#let","title":"let \u8bed\u6cd5\u7cd6","text":"<pre><code>public inline fun &lt;T, R&gt; T.let(block: (T) -&gt; R): R {\n    return block(this)\n}\n</code></pre> <p>let \u8bed\u6cd5\u7cd6\u4f20\u9012\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e0d\u662f\u5e26\u63a5\u6536\u8005\u7684\u51fd\u6570\u5b57\u9762\u503c\uff0c\u4f46 block \u51fd\u6570\u7684\u53c2\u6570\u5c31\u662f T \u7c7b\u578b\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728 block \u91cc\u9762\u8c03\u7528 T \u7c7b\u578b\u7684\u65b9\u6cd5\uff0c\u4f46\u4e0d\u80fd\u901a\u8fc7 this \u6765\u6307\u4ee3 T \u4e86\uff0c\u901a\u8fc7 it \u6765\u6307\u4ee3 T \u7c7b\u578b\u3002</p> <p>\u8c03\u7528\u793a\u4f8b\uff1a</p> <pre><code>            val result = \"a\".let {\n                it.plus(\"b\")\n            }\n</code></pre>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#with","title":"with \u8bed\u6cd5\u7cd6","text":"<pre><code>public inline fun &lt;T, R&gt; with(receiver: T, block: T.() -&gt; R): R {\n    return receiver.block()\n}\n</code></pre> <p>with \u8bed\u6cd5\u7cd6\u4e0d\u518d\u662f\u4e00\u4e2a\u62d3\u5c55\u51fd\u6570\u4e86\uff0c\u800c\u662f\u9700\u8981\u5728\u8bed\u6cd5\u7cd6\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u91cc\u9762\u4f20\u5165\u63a5\u6536\u8005\u5bf9\u8c61\u7684\u5b9e\u4f8b\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f\u5e26\u63a5\u6536\u8005\u7684\u51fd\u6570\u5b57\u9762\u503c\u5b9e\u4f8b\uff0c\u8fd4\u56de\u7684\u4e5f\u662f block \u8c03\u7528\u7684\u7ed3\u679c\uff0c\u8fd9\u4e00\u70b9\u548c run \u8bed\u6cd5\u7cd6\u7c7b\u4f3c\u3002</p> <p>\u8c03\u7528\u793a\u4f8b\uff1a</p> <pre><code>            val result = with(\"a\") {\n                this.plus(\"b\")\n            }\n</code></pre>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#apply","title":"apply \u8bed\u6cd5\u7cd6","text":"<pre><code>public inline fun &lt;T&gt; T.apply(block: T.() -&gt; Unit): T {\n    block()\n    return this\n}\n</code></pre> <p>apply \u8bed\u6cd5\u7cd6\u548c run \u8bed\u6cd5\u7cd6\u90fd\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u5b83\u8fd4\u56de\u7684\u4e0d\u662f block \u51fd\u6570\u8c03\u7528\u7684\u7ed3\u679c\uff0c\u800c\u662f\u8fd4\u56de\u8c03\u7528\u8005\u672c\u8eab\uff0c\u8fd4\u56de T \u7c7b\u578b\u3002</p>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#also","title":"also \u8bed\u6cd5\u7cd6","text":"<pre><code>public inline fun &lt;T&gt; T.also(block: (T) -&gt; Unit): T {\n    block(this)\n    return this\n}\n</code></pre> <p>also \u8bed\u6cd5\u7cd6\u548c let \u8bed\u6cd5\u7cd6\u6709\u70b9\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u8fd4\u56de\u7684\u7ed3\u679c\u4e0d\u662f block \u8c03\u7528\u7ed3\u679c\uff0c\u800c\u662f\u8fd4\u56de\u5b83\u672c\u8eab\uff0c\u8fd4\u56de T \u7c7b\u578b\u3002</p> <p>\u8c03\u7528\u793a\u4f8b\uff1a</p> <pre><code>            var result = \"a\".also {\n                it.plus(\"b\")\n            }\n</code></pre>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#takeif","title":"takeIf \u8bed\u6cd5\u7cd6","text":"<pre><code>public inline fun &lt;T&gt; T.takeIf(predicate: (T) -&gt; Boolean): T? {\n    return if (predicate(this)) this else null\n}\n</code></pre> <p>takeIf \u8bed\u6cd5\u7cd6\u4f1a\u8c03\u7528 predicate \u51fd\u6570\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u4e3a true \u5c31\u8fd4\u56de\u5b83\u672c\u8eab\uff0c\u5426\u5219\u8fd4\u56de null \u3002</p>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#takeunless","title":"takeUnless \u8bed\u6cd5\u7cd6","text":"<pre><code>public inline fun &lt;T&gt; T.takeUnless(predicate: (T) -&gt; Boolean): T? {\n    return if (!predicate(this)) this else null\n}\n</code></pre> <p>takeUnless \u548c takeIf \u6b63\u597d\u76f8\u53cd\uff0c\u5982\u679c predicate \u8fd4\u56de false \u5c31\u8fd4\u56de\u5b83\u672c\u8eab\uff0c\u5426\u5219\u8fd4\u56de null \u3002</p>","tags":["Android","Kotlin"]},{"location":"android/kotlin-syntactic-sugar-usage-and-analysis/#_4","title":"\u603b\u7ed3","text":"<p>\u8fd9\u4e48\u591a\u7684\u8bed\u6cd5\u7cd6\uff0c\u5176\u5b9e\u4ed6\u4eec\u7684\u539f\u7406\u90fd\u662f\u7c7b\u4f3c\u7684\uff0c\u5171\u540c\u70b9\u5728\u4e8e\u90fd\u662f\u6709\u8fd4\u56de\u503c\u7684\uff0c\u800c\u533a\u522b\u5c31\u5728\u4e8e\u5bf9\u539f\u6709\u7684\u503c\u8fdb\u884c\u4e86\u54ea\u4e9b\u64cd\u4f5c\uff0c\u7136\u540e\u5982\u4f55\u8fd4\u56de\u6700\u7ec8\u7684\u503c\u3002</p> <p>\u6700\u540e\uff0c\u5149\u662f\u4e86\u89e3\u4ed6\u4eec\u7684\u539f\u7406\u548c\u8c03\u7528\u60c5\u51b5\u8fd8\u662f\u4e0d\u591f\u7684\uff0c\u518d\u4e0d\u5f71\u54cd\u4ee3\u7801\u9605\u8bfb\u7684\u60c5\u51b5\u4e0b\u8981\u628a\u5b83\u4eec\u5f15\u5165\u5230\u6211\u4eec\u7684\u4ee3\u7801\u4e2d\u53bb\uff0c\u7075\u6d3b\u5730\u4f7f\u7528\u5b83\u4eec\u3002</p>","tags":["Android","Kotlin"]},{"location":"android/okhttp-analysis/","title":"\u5f00\u6e90\u5e93\u4e4b OkHttp \u6e90\u7801\u5206\u6790","text":"<p>\u5206\u6790\u4e00\u6ce2 OkHttp \u7684\u6e90\u7801\u5b9e\u73b0\u3002</p>","tags":["OkHttp"]},{"location":"android/okhttp-analysis/#_1","title":"\u7b80\u5355\u4f7f\u7528","text":"<p>\u5b98\u65b9\u7ed9\u51fa\u4e86\u4f7f\u7528\u4f8b\u5b50\uff0c\u5177\u4f53\u8be6\u60c5\u53c2\u8003 \u5b98\u7f51\u3002</p> <pre><code>// \u521b\u5efa OkHttp \u8bf7\u6c42\u5ba2\u6237\u7aef\nOkHttpClient client = new OkHttpClient();\n// \u6784\u5efa\u4e00\u4e2a\u8bf7\u6c42\nRequest request = new Request.Builder()\n      .url(url)\n      .build();\n// \u6267\u884c\u7f51\u7edc\u8bf7\u6c42\u5e76\u8fd4\u56de\u7ed3\u679c      \nResponse response = client.newCall(request).execute();      \n// \u5f97\u5230\u7ed3\u679c\u5185\u5bb9\nresponse.body().string();\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u8fc7\u7a0b\u8fd8\u662f\u5f88\u5bb9\u6613\u7406\u89e3\u7684\uff1a</p> <p>\u9996\u5148\u521b\u5efa\u8bf7\u6c42\u5ba2\u6237\u7aef -&gt; \u63a5\u7740\u521b\u5efa\u7f51\u7edc\u8bf7\u6c42 -&gt; \u7136\u540e\u53d1\u51fa\u7f51\u7edc\u8bf7\u6c42 -&gt; \u6700\u540e\u5f97\u5230\u8bf7\u6c42\u7ed3\u679c\u3002</p> <p>\u628a\u7f51\u7edc\u8bf7\u6c42\u8fc7\u7a0b\u62bd\u8c61\u5316\u4e4b\u540e\u5c31\u662f\u4e0a\u9762\u7684\u6d41\u6c34\u7ebf\u6b65\u9aa4\u4e86\uff0c\u5176\u4e2d\u6700\u91cd\u8981\u7684\u6b65\u9aa4\u5c31\u662f\u53d1\u51fa\u7f51\u7edc\u8bf7\u6c42\u4e86\uff0c\u5728 OkHttp \u4e2d\u7528\u5230\u4e86\u8d23\u4efb\u94fe\u6a21\u5f0f\uff0c\u5bf9\u53d1\u51fa\u7684\u7f51\u7edc\u8bf7\u6c42\u4f1a\u6309\u7167\u8d23\u4efb\u94fe\u8868\u7684\u987a\u5e8f\u4f9d\u6b21\u8fdb\u884c\u5904\u7406\uff0c\u6bd4\u5982\u8bf7\u6c42\u91cd\u8bd5\u3001\u8fde\u63a5\u5904\u7406\u3001\u7f13\u5b58\u5904\u7406\u3001\u65e5\u5fd7\u5904\u7406\u7b49\uff0c\u8fd9\u4e2a\u5730\u65b9\u518d\u5199\u4e00\u7bc7\u6587\u7ae0\u8be6\u7ec6\u5206\u6790\u3002</p> <p>\u4e0b\u9762\u9488\u5bf9 OkHttp \u7684\u8c03\u7528\u6d41\u7a0b\u548c\u7ed3\u6784\u4f5c\u5206\u6790\u3002</p>","tags":["OkHttp"]},{"location":"android/okhttp-analysis/#_2","title":"\u521b\u5efa\u8bf7\u6c42","text":"<p>\u9996\u5148\u662f\u521b\u5efa\u8bf7\u6c42\u5ba2\u6237\u7aef OkHttpClient \u548c\u7f51\u7edc\u8bf7\u6c42 Request \u3002</p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u8981\u521b\u5efa\u67d0\u67d0\u5bf9\u8c61\u7684\uff0c\u4e0a\u6765\u5c31\u662f\u4e00\u4e2a\u5efa\u9020\u8005\u6a21\u5f0f\uff0c\u5efa\u9020\u8005\u6a21\u5f0f\u53ef\u4ee5\u8bf4\u662f\u5728\u5f00\u6e90\u9879\u76ee\u4e2d\u6700\u5e38\u89c1\u7684\u8bbe\u8ba1\u6a21\u5f0f\u4e86\u3002</p> <p>\u5728 OkHttpClient \u548c Request \u5185\u90e8\u90fd\u6709\u4e00\u4e2a <code>Builder</code> \u7684\u5185\u90e8\u7c7b\u7528\u6765\u6267\u884c\u5177\u4f53\u7684\u6784\u5efa\u64cd\u4f5c\uff0c\u4e00\u822c <code>Builder</code> \u7c7b\u6709\u5f88\u591a\u65b9\u6cd5\uff0c\u5b83\u4eec\u90fd\u662f\u7528\u6765\u8bbe\u7f6e\u5177\u4f53\u6784\u5efa\u53c2\u6570\u7684\uff0c\u987a\u7740\u54ea\u4e9b\u65b9\u6cd5\u5c31\u53ef\u4ee5\u627e\u5230\u90fd\u6709\u54ea\u4e9b\u914d\u7f6e\u9009\u9879\uff0c\u8fd9\u4e9b\u9009\u9879\u4e5f\u5c31\u662f\u5bf9\u5916\u66b4\u9732\u7684\u63a5\u53e3\uff0c\u8fd9\u7b97\u662f\u9605\u8bfb\u6e90\u7801\u7684\u4e00\u4e2a\u5c0f\u6280\u5de7\u4e86\u3002</p> <p>OkHttpClient \u7684 Builder \u5185\u90e8\u914d\u7f6e\u9009\u9879\uff1a</p> <pre><code>      dispatcher = new Dispatcher();\n      // \u4f7f\u7528\u9ed8\u8ba4\u7684\u9009\u9879\n      protocols = DEFAULT_PROTOCOLS;\n      connectionSpecs = DEFAULT_CONNECTION_SPECS;\n      eventListenerFactory = EventListener.factory(EventListener.NONE);\n      proxySelector = ProxySelector.getDefault();\n      cookieJar = CookieJar.NO_COOKIES;\n      socketFactory = SocketFactory.getDefault();\n      hostnameVerifier = OkHostnameVerifier.INSTANCE;\n      certificatePinner = CertificatePinner.DEFAULT;\n      proxyAuthenticator = Authenticator.NONE;\n      authenticator = Authenticator.NONE;\n      connectionPool = new ConnectionPool();\n      dns = Dns.SYSTEM;\n      followSslRedirects = true;\n      followRedirects = true;\n      retryOnConnectionFailure = true;\n      connectTimeout = 10_000;\n      readTimeout = 10_000;\n      writeTimeout = 10_000;\n      pingInterval = 0;\n</code></pre> <p>\u91cd\u70b9\u5206\u6790 <code>Dispatcher</code> \u7c7b\u7528\u6765\u7ba1\u7406\u548c\u5206\u53d1\u8bf7\u6c42\u7684\uff0c\u5176\u4ed6\u7684\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u7684\u8bdd\u90fd\u662f\u9ed8\u8ba4\u9009\u9879\uff0c\u7b49\u7528\u5230\u65f6\u518d\u5177\u4f53\u5206\u6790\u3002</p> <p>\u5728 Request \u5185\u90e8\u7684 Builder \u4e5f\u6709\u4e00\u4e9b\u914d\u7f6e\u9009\u9879\uff1a</p> <pre><code>    HttpUrl url;\n    String method;\n    Headers.Builder headers;\n    RequestBody body;\n    /** A mutable map of tags, or an immutable empty map if we don't have any. */\n    Map&lt;Class&lt;?&gt;, Object&gt; tags = Collections.emptyMap();\n</code></pre> <p>\u50cf <code>url</code>\u3001<code>body</code>\u3001<code>method</code> \u8fd9\u4e9b\u90fd\u662f HTTP \u8bf7\u6c42\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u7528\u4e00\u4e2a <code>Request</code> \u7c7b\u5c06\u5b83\u4eec\u8fdb\u884c\u5c01\u88c5\uff0c\u5230\u5177\u4f53\u6267\u884c\u8bf7\u6c42\u65f6\uff0c\u90fd\u4f1a\u5c06\u5b83\u4eec\u53d6\u51fa\u6765\u4f7f\u7528\u3002</p>","tags":["OkHttp"]},{"location":"android/okhttp-analysis/#_3","title":"\u540c\u6b65\u6267\u884c","text":"<pre><code>val response = client.newCall(request).execute()\n</code></pre> <p>\u540c\u6b65\u6267\u884c\u7684\u4ee3\u7801\u5982\u4e0a\uff0c\u9996\u5148\u662f <code>newCall</code> \u65b9\u6cd5\u5c06 request \u8f6c\u6362\u6210 <code>RealCall</code> \u5bf9\u8c61\uff0c\u5b83\u5b9e\u73b0\u4e86 <code>Call</code> \u7684\u63a5\u53e3\u3002</p> <p><code>Request</code> \u7c7b\u53ea\u662f\u5c01\u88c5\u4e86\u8bf7\u6c42\u7684\u4fe1\u606f\uff0c\u6bd4\u5982 <code>GET</code>\u3001<code>POST</code> \u65b9\u6cd5\u4e4b\u7c7b\u7684\uff0c\u4f46\u5177\u4f53\u7684\u6267\u884c\u901a\u8fc7 <code>Call</code> \u8fd9\u4e00\u5c42\u6765\u5b9e\u73b0\u4e86\u3002</p> <pre><code>  static RealCall newRealCall(OkHttpClient client, Request originalRequest, boolean forWebSocket) {\n    // Safely publish the Call instance to the EventListener.\n    RealCall call = new RealCall(client, originalRequest, forWebSocket);\n    call.eventListener = client.eventListenerFactory().create(call);\n    return call;\n  }\n</code></pre> <p>\u7136\u540e\u662f Call \u7684 <code>execute</code> \u65b9\u6cd5\u3002</p> <pre><code>  @Override public Response execute() throws IOException {\n    // \u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\n    synchronized (this) {\n      if (executed) throw new IllegalStateException(\"Already Executed\");\n      executed = true;\n    }\n    captureCallStackTrace();\n    eventListener.callStart(this);\n    try {\n      // \u628a\u8bf7\u6c42\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\n      client.dispatcher().executed(this);\n      // \u5177\u4f53\u6267\u884c\u7f51\u7edc\u8bf7\u6c42\n      Response result = getResponseWithInterceptorChain();\n      if (result == null) throw new IOException(\"Canceled\");\n      return result;\n    } catch (IOException e) {\n      // \u8bf7\u6c42\u5931\u8d25\u7684\u56de\u8c03\n      eventListener.callFailed(this, e);\n      throw e;\n    } finally {\n      // \u5c06\u8bf7\u6c42\u4ece\u961f\u5217\u4e2d\u79fb\u9664\n      client.dispatcher().finished(this);\n    }\n  }\n</code></pre> <p>\u9996\u5148\u662f <code>synchronized</code> \u52a0\u9501\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u7136\u540e\u662f\u901a\u8fc7 <code>Dispatcher</code> \u7c7b\u7684 <code>executed</code> \u65b9\u6cd5\u5c06\u8bf7\u6c42 <code>RealCall</code> \u6dfb\u52a0\u5230\u8bf7\u6c42\u7684\u540c\u6b65\u961f\u5217\u4e2d\u53bb\u3002</p> <pre><code>private final Deque&lt;RealCall&gt; runningSyncCalls = new ArrayDeque&lt;&gt;();\n\nsynchronized void executed(RealCall call) {\n  runningSyncCalls.add(call);\n}\n</code></pre> <p><code>runningSyncCalls</code> \u662f\u4e00\u4e2a <code>Deque</code> \u7c7b\u578b\u7684\u961f\u5217\u3002<code>Deque</code> \u662f\u4e00\u4e2a\u53cc\u7aef\u961f\u5217\uff0c\u5b83\u5177\u6709\u961f\u5217\u548c\u6808\u7684\u7279\u6027\uff0c\u961f\u5217\u4e2d\u7684\u5143\u7d20\u53ef\u4ee5\u4ece\u4e24\u7aef\u5f39\u51fa\uff0c\u800c\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u53ea\u80fd\u5728\u961f\u5217\u7684\u4e24\u7aef\u8fdb\u884c\u3002</p> <p><code>executed</code> \u65b9\u6cd5\u53ea\u662f\u5c06\u8bf7\u6c42\u6dfb\u52a0\u5230\u4e86\u961f\u5217\u4e2d\uff0c\u5177\u4f53\u7684\u6267\u884c\u5728 <code>getResponseWithInterceptorChain</code> \u65b9\u6cd5\u4e2d\uff0c\u5728\u8fd9\u91cc\u5c31\u4f1a\u5c06\u8bf7\u6c42\u901a\u8fc7OkHttp \u7684\u5404\u79cd\u62e6\u622a\u5668\uff0c\u6309\u7167\u8d23\u4efb\u94fe\u6a21\u5f0f\u8fdb\u884c\u8c03\u7528\uff0c\u5e76\u5f97\u5230\u8bf7\u6c42\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u7528 <code>Response</code> \u7c7b\u5c01\u88c5\u3002</p> <p>\u5f53\u8bf7\u6c42\u7ed3\u675f\u540e\uff0c\u4f1a\u8c03\u7528 <code>Dispatcher</code> \u7c7b\u7684 <code>finished</code> \u65b9\u6cd5\u3002</p> <pre><code>  void finished(RealCall call) {\n    finished(runningSyncCalls, call, false);\n  }\n\n  private &lt;T&gt; void finished(Deque&lt;T&gt; calls, T call, boolean promoteCalls) {\n    int runningCallsCount;\n    Runnable idleCallback;\n    synchronized (this) {\n      // \u5c06\u8bf7\u6c42\u4ece\u961f\u5217\u4e2d\u79fb\u9664\n      if (!calls.remove(call)) throw new AssertionError(\"Call wasn't in-flight!\");\n      if (promoteCalls) promoteCalls();\n      runningCallsCount = runningCallsCount();\n      idleCallback = this.idleCallback;\n    }\n\n    if (runningCallsCount == 0 &amp;&amp; idleCallback != null) {\n      idleCallback.run();\n    }\n  }  \n</code></pre> <p><code>finished</code> \u65b9\u6cd5\u4e3b\u8981\u662f\u5c06\u8bf7\u6c42 <code>RealCall</code> \u4ece\u961f\u5217\u4e2d <code>runningSyncCalls</code> \u79fb\u9664\u3002</p> <p>\u8fd9\u91cc\u8fd8\u6709\u4e2a\u5c0f\u77e5\u8bc6\u70b9\u5c31\u662f <code>try</code>\u3001<code>catch</code>\u3001<code>finally</code> \u4e09\u8005\u7684\u6267\u884c\u987a\u5e8f\uff0c\u5728 <code>try</code> \u8bed\u53e5\u91cc\u9762\u6267\u884c\u4e86 <code>return</code> \u8bed\u53e5\uff0c\u4f46\u662f\u8fd4\u56de\u7684\u7ed3\u679c\u4f1a\u4fdd\u5b58\u5728\u4e00\u4e2a\u4e34\u65f6\u533a\u57df\u91cc\u9762\uff0c\u7136\u540e\u6267\u884c <code>finally</code> \u8bed\u53e5\uff0c\u79fb\u9664\u961f\u5217\u8bf7\u6c42\u540e\u518d\u7ee7\u7eed\u8fd4\u56de\u3002</p>","tags":["OkHttp"]},{"location":"android/okhttp-analysis/#_4","title":"\u7f51\u7edc\u8bf7\u6c42","text":"<p>\u4e0b\u9762\u91cd\u70b9\u770b\u4e00\u4e0b <code>getResponseWithInterceptorChain</code> \u65b9\u6cd5\u3002</p> <pre><code>  Response getResponseWithInterceptorChain() throws IOException {\n    // Build a full stack of interceptors.\n    List&lt;Interceptor&gt; interceptors = new ArrayList&lt;&gt;();\n    interceptors.addAll(client.interceptors());\n    // OkHttpClient \u63d0\u4f9b\u7684\u9ed8\u8ba4\u62e6\u622a\u5668\n    interceptors.add(retryAndFollowUpInterceptor);\n    interceptors.add(new BridgeInterceptor(client.cookieJar()));\n    interceptors.add(new CacheInterceptor(client.internalCache()));\n    interceptors.add(new ConnectInterceptor(client));\n    if (!forWebSocket) {\n      interceptors.addAll(client.networkInterceptors());\n    }\n    interceptors.add(new CallServerInterceptor(forWebSocket));\n    // \u91cd\u70b9\u53c2\u6570\u662f 0 \uff0c\u8868\u793a\u8d23\u4efb\u94fe\u7684\u5f00\u59cb\n    Interceptor.Chain chain = new RealInterceptorChain(interceptors, null, null, null, 0,\n        originalRequest, this, eventListener, client.connectTimeoutMillis(),\n        client.readTimeoutMillis(), client.writeTimeoutMillis());\n\n    return chain.proceed(originalRequest);\n  }\n</code></pre> <p>\u6709\u4e00\u4e2a\u62e6\u622a\u5668 <code>Interceptor</code> \u7684\u96c6\u5408\uff0c\u5728\u521b\u5efa OkHttpClient \u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7 <code>Builder</code> \u53bb\u6dfb\u52a0\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u62e6\u622a\u5668\uff0c\u53e6\u5916 OkHttp \u4e5f\u63d0\u4f9b\u4e86\u51e0\u4e2a\u9ed8\u8ba4\u7684\u62e6\u622a\u5668\u3002</p> <p>\u628a\u62e6\u622a\u5668\u6dfb\u52a0\u5230\u96c6\u5408\u4e2d\uff0c\u4f5c\u4e3a <code>RealInterceptorChain</code> \u7c7b\u7684\u53c2\u6570\uff0c\u5b83\u5b9e\u73b0\u4e86 <code>Chain</code> \u63a5\u53e3\uff0c\u8868\u793a\u4e3a\u4e00\u6761<code>\u94fe</code>\u3002\u5728\u8fd9\u6761<code>\u94fe</code>\u4e0a\uff0c\u6bcf\u4e2a\u62e6\u622a\u5668\u90fd\u662f\u5b83\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u5e76\u4e14\u4ee5\u94fe\u4e0a\u4efb\u4f55\u4e00\u4e2a\u62e6\u622a\u5668\u4e3a\u8d77\u70b9\uff0c\u53c8\u53ef\u4ee5\u5f00\u59cb\u4e00\u6761\u65b0\u7684\u94fe\u3002</p> <p>\u5177\u4f53\u6765\u770b\u770b <code>proceed</code> \u65b9\u6cd5\uff1a</p> <pre><code>  @Override public Response proceed(Request request) throws IOException {\n    return proceed(request, streamAllocation, httpCodec, connection);\n  }\n\n  public Response proceed(Request request, StreamAllocation streamAllocation, HttpCodec httpCodec,\n      RealConnection connection) throws IOException {\n    if (index &gt;= interceptors.size()) throw new AssertionError();\n\n    calls++;\n    // \u5220\u9664\u4e00\u4e9b\u5224\u65ad\u548c\u629b\u51fa\u5f02\u5e38\u7684\u65b9\u6cd5\n\n    // Call the next interceptor in the chain.\n    // \u4ee5\u62e6\u622a\u5668\u961f\u5217\u4e2d\u7684\u4e0b\u4e00\u4e2a\u62e6\u622a\u5668\u4e3a\u8d77\u70b9\uff0c\u6784\u5efa\u65b0\u7684\u8bf7\u6c42\u94fe\n    RealInterceptorChain next = new RealInterceptorChain(interceptors, streamAllocation, httpCodec,\n        connection, index + 1, request, call, eventListener, connectTimeout, readTimeout,\n        writeTimeout);\n    // \u53d6\u51fa\u5f53\u524d\u8bf7\u6c42\u94fe\u4e2d\u7684\u7b2c\u4e00\u4e2a\n    Interceptor interceptor = interceptors.get(index);\n    // \u6267\u884c\u5f53\u524d\u62e6\u622a\u5668\u7684\u529f\u80fd\uff0c\u5e76\u4e14\u5f00\u59cb\u5b50\u94fe\u7684\u8bf7\u6c42\u6d41\u7a0b\n    Response response = interceptor.intercept(next);\n\n    // \u5220\u9664\u4e00\u4e9b\u5224\u65ad\u548c\u629b\u51fa\u5f02\u5e38\u7684\u65b9\u6cd5\n    return response;\n  }\n</code></pre> <p>\u6574\u4e2a\u62e6\u622a\u5668\u7684\u96c6\u5408 <code>interceptors</code> \u662f\u4e0d\u4f1a\u53d8\u7684\uff0c\u800c <code>index</code> \u5c31\u5bf9\u5e94\u4ece\u62e6\u622a\u5668\u96c6\u5408\u4e2d\u53d6\u51fa\u62e6\u622a\u5668\u7684\u7d22\u5f15\uff0c\u4e3a 0 \u8868\u793a\u53d6\u51fa\u7b2c\u4e00\u4e2a\u6765\u4f5c\u4e3a\u6574\u6761 <code>\u94fe</code> \u7684\u8d77\u70b9\uff0c\u4ece\u800c\u6784\u5efa\u4e00\u6761\u8bf7\u6c42\u94fe\u3002</p> <p>\u5f53\u4e00\u4e2a\u62e6\u622a\u5668\u6267\u884c\u5177\u4f53\u529f\u80fd\u65f6\uff0c\u4e5f\u5c31\u662f <code>intercept</code> \u65b9\u6cd5\uff0c\u4f1a\u628a\u4e0b\u4e00\u4e2a<code>\u94fe</code>\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u8fc7\u53bb\uff0c\u8fd9\u6837\u5c31\u53c8\u4f1a\u4ee5\u8fd9\u6761 <code>\u94fe</code> \u4e3a\u8d77\u59cb\u7ee7\u7eed\u4e0b\u4e00\u6b65\u7684\u6267\u884c\u3002</p> <p>\u6bd4\u5982\uff0c\u770b <code>HttpLoggingInterceptor</code> \u5185\u90e8\u7684\u5b9e\u73b0:</p> <pre><code>    Request request = chain.request();\n    if (level == Level.NONE) {\n      return chain.proceed(request);\n    }\n</code></pre> <p>\u5982\u679c\u8981\u6253\u5370\u7684\u65e5\u5fd7\u5373\u4e3a\u4e3a <code>NONE</code>\uff0c\u4e5f\u5c31\u662f\u4e0d\u6253\u5370\uff0c\u76f4\u63a5\u5c31\u5f00\u59cb <code>\u94fe</code> \u7684\u4e0b\u4e00\u4e2a\u6267\u884c\u4e86\u3002</p> <p>\u7b80\u5355\u5730\u770b\uff0c\u8fd9\u91cc\u5c31\u662f\u4e00\u4e2a\u9012\u5f52\u7684\u8c03\u7528\u6d41\u7a0b\u3002</p>","tags":["OkHttp"]},{"location":"android/okhttp-analysis/#_5","title":"\u5f02\u6b65\u6267\u884c","text":"<pre><code>client.newCall(request).enqueue(object : okhttp3.Callback {\n\n    override fun onFailure(call: okhttp3.Call?, e: IOException?) {\n    }\n\n    override fun onResponse(call: okhttp3.Call?, response: okhttp3.Response?) {\n    }\n})\n</code></pre> <p>\u5f02\u6b65\u8bf7\u6c42\u7684\u4ee3\u7801\u5982\u4e0a\uff0c\u548c\u540c\u6b65\u8bf7\u6c42\u7684\u533a\u522b\u5728\u4e8e\u540e\u9762\u662f <code>enqueue</code> \u65b9\u6cd5\u3002</p> <pre><code>  @Override public void enqueue(Callback responseCallback) {\n    synchronized (this) {\n      if (executed) throw new IllegalStateException(\"Already Executed\");\n      executed = true;\n    }\n    captureCallStackTrace();\n    eventListener.callStart(this);\n    // \u901a\u8fc7 Dispatcher \u7ba1\u7406\u8bf7\u6c42\n    // \n    client.dispatcher().enqueue(new AsyncCall(responseCallback));\n  }\n</code></pre> <p><code>enqueue</code> \u9700\u8981\u4f20\u5165\u4e00\u4e2a <code>Callback</code> \u7684\u56de\u8c03\u63a5\u53e3\uff0c\u7528\u6765\u5904\u7406\u8bf7\u6c42\u6210\u529f\u548c\u5931\u8d25\u3002\u53e6\u5916\uff0c\u5728 <code>enqueue</code> \u7684\u5185\u90e8\u8fd8\u662f\u901a\u8fc7 <code>Dispatcher</code> \u8fdb\u884c\u8bf7\u6c42\u7684\u7ba1\u7406\u3002</p> <p>\u8fd9\u91cc\u4f20\u5165\u7684\u53c2\u6570\u662f <code>AsyncCall</code> \u7c7b\uff0c\u4e0d\u518d\u662f <code>RealCall</code> \u7c7b\u4e86\uff0c<code>AsyncCall</code> \u7c7b\u7ee7\u627f\u81ea <code>NamedRunnable</code> \u7c7b\uff0c<code>NamedRunnable</code> \u5b9e\u73b0\u4e86 <code>Runnable</code> \u63a5\u53e3\u3002</p> <p><code>NamedRunnable</code> \u610f\u601d\u5c31\u662f\u6709\u540d\u5b57\u7684\u7ebf\u7a0b\uff0c\u4f1a\u5728\u7ebf\u7a0b\u6267\u884c\u65f6\u4e34\u65f6\u6539\u53d8\u7ebf\u7a0b\u7684\u540d\u5b57\uff0c\u6267\u884c\u7ed3\u675f\u540e\u518d\u6539\u56de\u6765\u3002</p> <pre><code>  @Override public final void run() {\n    // \u4fdd\u5b58\u5f53\u524d\u7ebf\u7a0b\u7684\u540d\u5b57\n    String oldName = Thread.currentThread().getName();\n    // \u8bbe\u7f6e\u65b0\u7684\u540d\u5b57\n    Thread.currentThread().setName(name);\n    try {\n      execute();\n    } finally {\n      // \u6267\u884c\u540e\u518d\u6539\u4e3a\u539f\u6765\u7684\u540d\u5b57\n      Thread.currentThread().setName(oldName);\n    }\n  }\n</code></pre> <p>\u53e6\u5916\uff0c<code>AsyncCall</code> \u5b9e\u73b0\u4e86 <code>NamedRunnable</code> \u7684\u62bd\u8c61\u65b9\u6cd5 <code>execute</code> \uff0c\u8be5\u65b9\u6cd5\u4e5f\u662f\u7f51\u7edc\u8bf7\u6c42\u7684\u5177\u4f53\u6267\u884c\u90e8\u5206\uff0c\u95ee\u9898\u5728\u4e8e\u8fd9\u4e9b\u5f02\u6b65\u8bf7\u6c42\u662f\u5982\u4f55\u5206\u53d1\u548c\u7ba1\u7406\u7684\uff0c\u8fd8\u662f\u56de\u5230 <code>Dispatcher</code> \u7c7b\u4e2d\u6765\u3002</p> <pre><code>  synchronized void enqueue(AsyncCall call) {\n    if (runningAsyncCalls.size() &lt; maxRequests &amp;&amp; runningCallsForHost(call) &lt; maxRequestsPerHost) {\n      runningAsyncCalls.add(call);\n      executorService().execute(call);\n    } else {\n      readyAsyncCalls.add(call);\n    }\n  }\n</code></pre> <p>\u9996\u5148\u662f\u5224\u65ad\u5f02\u6b65\u8bf7\u6c42\u961f\u5217 <code>runningAsyncCalls</code> \u7684\u4e2a\u6570\u662f\u5426\u8d85\u8fc7\u6700\u5927\u8bf7\u6c42\u6570\u4e86\uff0c\u53e6\u5916\u662f\u5224\u65ad\u540c\u4e00\u4e3b\u673a\u7684\u7f51\u7edc\u8bf7\u6c42\u4e2a\u6570\u662f\u5426\u8d85\u8fc7\u9650\u5236\u3002</p> <p>\u5982\u679c\u90fd\u4e0d\u8d85\u8fc7\uff0c\u5c31\u5c06\u8bf7\u6c42\u6dfb\u52a0\u5230\u5f02\u6b65\u8bf7\u6c42\u961f\u5217\u4e2d\uff0c\u5e76\u5728\u7ebf\u7a0b\u6c60\u4e2d\u53bb\u6267\u884c\u3002</p> <p>\u5982\u679c\u8d85\u8fc7\u4e86\uff0c\u5c31\u628a\u8bf7\u6c42\u6dfb\u52a0\u5230\u51c6\u5907\u5c31\u7eea\u7684\u961f\u5217 <code>readyAsyncCalls</code> \u4e2d\uff0c\u7b49\u5f85\u540e\u7eed\u518d\u53bb\u6267\u884c\u3002</p> <p><code>executorService()</code> \u65b9\u6cd5\u7684\u6267\u884c\u5c31\u662f\u521d\u59cb\u5316\u7ebf\u7a0b\u6c60\u7684\u3002</p> <pre><code>  public synchronized ExecutorService executorService() {\n    if (executorService == null) {\n      executorService = new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60, TimeUnit.SECONDS,\n          new SynchronousQueue&lt;Runnable&gt;(), Util.threadFactory(\"OkHttp Dispatcher\", false));\n    }\n    return executorService;\n  }\n</code></pre> <p><code>ThreadPoolExecutor</code> \u7528\u6765\u63d0\u4f9b\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff0c\u5b83\u7684\u65b9\u6cd5\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>    public ThreadPoolExecutor(int corePoolSize,             // \u6838\u5fc3\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f\n                              int maximumPoolSize,        // \u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u5927\u5c0f\n                              long keepAliveTime,         // \u7ebf\u7a0b\u6c60\u7a7a\u95f2\u65f6\uff0c\u7ebf\u7a0b\u7684\u5b58\u6d3b\u65f6\u95f4\n                              TimeUnit unit,             // \u5b58\u6d3b\u65f6\u95f4\u7684\u65f6\u95f4\u5355\u4f4d\n                              BlockingQueue&lt;Runnable&gt; workQueue, // \u5b58\u653e\u7ebf\u7a0b\u4efb\u52a1\u7684\u961f\u5217\n                              ThreadFactory threadFactory,      // \u521b\u5efa\u7ebf\u7a0b\u7684\u5de5\u5382\n                              RejectedExecutionHandler handler) {     // \u4efb\u52a1\u62d2\u7edd\u7b56\u7565\n            // \u7701\u7565\n    }\n</code></pre> <p>\u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\u597d\u5904\u662f\u663e\u800c\u6613\u89c1\u7684\uff0c\u7edf\u4e00\u7ba1\u7406\u7f51\u7edc\u8bf7\u6c42\uff0c\u51cf\u5c11\u7ebf\u7a0b\u9891\u7e41\u521b\u5efa\u3001\u9500\u6bc1\u5e26\u6765\u7684\u5f00\u9500\u3002</p> <p>\u901a\u8fc7\u7ebf\u7a0b\u6c60\u7684 <code>execute</code> \u65b9\u6cd5\u53bb\u6267\u884c\u8bf7\u6c42\uff0c\u5177\u4f53\u5c31\u662f <code>Runnable</code> \u63a5\u53e3\u4e2d\u7684 <code>run</code> \u65b9\u6cd5\u3002</p> <pre><code>    // \u5f02\u6b65\u8bf7\u6c42\u4e2d\u7684\u65b9\u6cd5\n    @Override protected void execute() {\n      boolean signalledCallback = false;\n      try {\n        // \u5177\u4f53\u6267\u884c\u7684\u8bf7\u6c42\u8fd8\u662f\u5728\u8fd9\u91cc\n        Response response = getResponseWithInterceptorChain();\n        if (retryAndFollowUpInterceptor.isCanceled()) {\n          signalledCallback = true;\n          responseCallback.onFailure(RealCall.this, new IOException(\"Canceled\"));\n        } else {\n          signalledCallback = true;\n          responseCallback.onResponse(RealCall.this, response);\n        }\n      } catch (IOException e) {\n        if (signalledCallback) {\n          // Do not signal the callback twice!\n          Platform.get().log(INFO, \"Callback failure for \" + toLoggableString(), e);\n        } else {\n          // \u8bf7\u6c42\u5931\u8d25\u7684\u56de\u8c03\n          eventListener.callFailed(RealCall.this, e);\n          responseCallback.onFailure(RealCall.this, e);\n        }\n      } finally {\n        client.dispatcher().finished(this);\n      }\n    }\n</code></pre> <p>\u5f02\u6b65\u8bf7\u6c42\u6267\u884c\u7684\u7ebf\u7a0b\u53d8\u4e86\uff0c\u80af\u5b9a\u5c31\u5f97\u6709\u76f8\u5e94\u7684\u56de\u8c03\u901a\u77e5\uff0c\u53e6\u5916\uff0c\u5177\u4f53\u662f\u7f51\u7edc\u8bf7\u6c42\u90e8\u5206\u8fd8\u662f\u5728 <code>getResponseWithInterceptorChain</code> \u65b9\u6cd5\u4e2d\u3002</p> <p>\u5728 <code>finally</code> \u4e2d\u8fd8\u662f\u4f1a\u5c06\u5f02\u6b65\u7684\u8bf7\u6c42\u4ece\u961f\u5217\u4e2d\u79fb\u9664\uff0c\u4e0d\u540c\u7684\u662f\u5185\u90e8\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u4e3a false \u3002</p> <pre><code>  void finished(AsyncCall call) {\n    // \u4e0e\u540c\u6b65\u8bf7\u6c42\u4e0d\u540c\u7684\u662f\uff0c\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u4e3a True, \u540c\u6b65\u8bf7\u6c42\u4e3a false\n    finished(runningAsyncCalls, call, true);\n  }\n</code></pre> <p>\u56e0\u4e3a <code>True</code>\uff0c\u6240\u4ee5 <code>promoteCalls</code> \u5c31\u4f1a\u6267\u884c\u3002</p> <pre><code>  // \u5f02\u6b65\u8bf7\u6c42\u624d\u4f1a\u6267\u884c\u8be5\u65b9\u6cd5\n  private void promoteCalls() {\n    // \u4f18\u5148\u628a readyAsyncCalls \u961f\u5217\u4e2d\u7684\u8bf7\u6c42\u6267\u884c\u5b8c\n    if (runningAsyncCalls.size() &gt;= maxRequests) return; // Already running max capacity.\n    if (readyAsyncCalls.isEmpty()) return; // No ready calls to promote.\n\n    for (Iterator&lt;AsyncCall&gt; i = readyAsyncCalls.iterator(); i.hasNext(); ) {\n      AsyncCall call = i.next();\n\n      if (runningCallsForHost(call) &lt; maxRequestsPerHost) {\n        i.remove();\n        runningAsyncCalls.add(call);\n        executorService().execute(call);\n      }\n\n      if (runningAsyncCalls.size() &gt;= maxRequests) return; // Reached max capacity.\n    }\n  }\n</code></pre> <p>\u4e4b\u524d\u63d0\u5230\uff0c\u5982\u679c\u5f02\u6b65\u8bf7\u6c42\u961f\u5217\u5df2\u7ecf\u6ee1\u4e86\uff0c\u5c31\u4f1a\u628a\u8bf7\u6c42\u653e\u5230\u51c6\u5907\u5c31\u7eea\u7684\u961f\u5217 <code>readyAsyncCalls</code> \u4e2d\u53bb\uff0c\u90a3\u4e48 <code>promoteCalls</code> \u65b9\u6cd5\u5c31\u662f\u6765\u5904\u7406 <code>readyAsyncCalls</code> \u961f\u5217\u4e2d\u7684\u8bf7\u6c42\u7684\u3002</p> <p>\u6bcf\u6b21\u4ece\u961f\u5217\u4e2d\u79fb\u9664\u5f02\u6b65\u8bf7\u6c42\u540e size \u90fd\u4f1a\u51cf\u4e00\uff0c\u7136\u540e\u518d\u5224\u65ad\u961f\u5217\u7684\u6570\u91cf\u662f\u5426\u8fd8\u662f\u8d85\u8fc7\u4e86\u6700\u5927\u8bf7\u6c42\u6570\u91cf\uff0c\u5982\u679c\u662f\u5c31\u8fd4\u56de\uff0c\u8868\u793a\u4f18\u5148\u628a\u5f02\u6b65\u961f\u5217\u4e2d\u7684\u8bf7\u6c42\u6d88\u8017\u5b8c\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u8868\u793a\u6709\u7a7a\u4f4d\uff0c\u90a3\u5c31\u4ece\u51c6\u5907\u5c31\u7eea\u7684\u961f\u5217\u4e2d\u53d6\u51fa\u8bf7\u6c42\u6765\u6267\u884c\u3002</p> <p>\u628a <code>readyAsyncCalls</code> \u961f\u5217\u4e2d\u7684\u8bf7\u6c42\u653e\u5230 <code>runningAsyncCalls</code> \u961f\u5217\u4e2d\u53bb\uff0c\u518d\u901a\u8fc7\u7ebf\u7a0b\u6c60\u53bb\u6267\u884c\uff0c\u5e76\u4e14\u8fd8\u662f\u4f1a\u5224\u65ad <code>runningAsyncCalls</code> \u7684\u6570\u91cf\u662f\u5426\u8d85\u8fc7\u4e86\u6700\u5927\u8bf7\u6c42\uff0c\u8d85\u8fc7\u4e86\u5c31\u8fd4\u56de\uff0c\u8868\u793a OkHttp \u4e2d\u6574\u4e2a\u5f02\u6b65\u8bf7\u6c42\u7684\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc7 <code>maxRequests</code> \u8868\u793a\u7684\u6570\u91cf\u3002</p> <p>\u5c31\u8fd9\u6837\u5b9e\u73b0\u4e86 OkHttp \u7684\u5f02\u6b65\u8bf7\u6c42\u7ba1\u7406\u6d41\u7a0b\uff0c\u5e76\u4e14\u8fd8\u6709\u4e00\u4e2a\u7c7b\u4f3c\u8bf7\u6c42\u6392\u961f\u7684\u673a\u5236\uff0c</p>","tags":["OkHttp"]},{"location":"android/okhttp-analysis/#_6","title":"\u5c0f\u7ed3","text":"<p>OkHttp \u662f\u7528\u6765\u6267\u884c\u7f51\u7edc\u8bf7\u6c42\uff0c\u5305\u62ec\u540c\u6b65\u548c\u5f02\u6b65\u7684\u8bf7\u6c42\u3002</p> <p>\u5bf9\u4e8e\u540c\u6b65\u8bf7\u6c42\uff0c\u76f4\u63a5\u5c31\u6267\u884c\u4e86\uff0c\u540c\u6b65\u963b\u585e\u76f4\u5230\u8fd4\u56de\u53d6\u5f97\u8bf7\u6c42\u7ed3\u679c\u3002</p> <p>\u5bf9\u4e8e\u5f02\u6b65\u8bf7\u6c42\uff0c\u5bf9\u8bf7\u6c42\u8fdb\u884c\u7ba1\u7406\uff0c\u9650\u5236\u8bf7\u6c42\u6700\u5927\u6570\u91cf\uff0c\u5982\u679c\u8d85\u51fa\u6570\u91cf\u5c31\u6392\u961f\u5019\u9009\uff0c\u6bcf\u6b21\u6267\u884c\u5b8c\u4e00\u6b21\u5f02\u6b65\u8bf7\u6c42\uff0c\u6709\u7a7a\u4f4d\u5c31\u53bb\u5904\u7406\u6392\u961f\u7684\u8bf7\u6c42\u3002</p> <p>\u5bf9\u4e8e\u5177\u4f53\u7684\u8bf7\u6c42\u8fc7\u7a0b\uff0c\u901a\u8fc7\u8d23\u4efb\u94fe\u7684\u6a21\u5f0f\uff0c\u628a\u8bf7\u6c42\u5206\u6210\u591a\u4e2a\u8fc7\u7a0b\uff0c\u9012\u5f52\u5730\u5bf9\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\u3002</p>","tags":["OkHttp"]},{"location":"android/retrofit-analysis/","title":"\u5f00\u6e90\u5e93\u4e4b Retrofit \u6e90\u7801\u5206\u6790","text":"<p>\u5206\u6790\u4e00\u6ce2 Retrofit \u7684\u6e90\u7801\u5b9e\u73b0\u3002</p>","tags":["Retrofit"]},{"location":"android/retrofit-analysis/#_1","title":"\u7b80\u5355\u4f7f\u7528","text":"<p>\u5b98\u65b9\u7ed9\u51fa\u4e86\u4f7f\u7528\u4f8b\u5b50\uff0c\u5177\u4f53\u8be6\u60c5\u53c2\u770b \u5b98\u7f51\u3002</p> <p>\u5982\u679c\u52a0\u5165 RxJava \u548c Gson ,\u5c31\u9700\u8981\u6dfb\u52a0\u5bf9\u5e94\u7684\u9002\u914d\u548c\u8f6c\u6362\u5de5\u5382\u7c7b\u3002</p> <pre><code>val retrofit = Retrofit.Builder()\n    .baseUrl(\"https://api.github.com/\")\n    .addCallAdapterFactory(RxJavaCallAdapterFactory.create())\n    .addConverterFactory(GsonConverterFactory.create())\n    .build()\n</code></pre> <p>\u56f4\u7ed5 Retrofit \u7684\u8c03\u7528\u6d41\u7a0b\u5206\u6790\u5b83\u7684\u5185\u90e8\u5b9e\u73b0\u3002</p>","tags":["Retrofit"]},{"location":"android/retrofit-analysis/#retrofit","title":"Retrofit \u7c7b\u7684\u6784\u5efa","text":"<p>\u9996\u5148\u662f Retrofit \u7c7b\u7684\u6784\u5efa\uff0c\u901a\u8fc7\u5efa\u9020\u8005\u6a21\u5f0f\u6765\u5b9e\u73b0\u3002</p> <p>\u5728 <code>Retrofit.Builder</code> \u7c7b\u7684\u8c03\u7528\u65b9\u6cd5\u4e2d\u6307\u5b9a\u4e00\u4e9b\u53c2\u6570\uff0c\u5c31\u6bd4\u5982\u4e0a\u9762\u7684 RxJava \u548c Gson \u5bf9\u5e94\u7684\u5de5\u5382\u7c7b\u3002</p> <p>\u5728 <code>build</code> \u65b9\u6cd5\u91cc\u9762\u53ef\u4ee5\u770b\u5230\u5168\u90e8\u7684\u6240\u9700\u8981\u7684\u5185\u5bb9\uff1a</p> <pre><code>    public Retrofit build() {\n      // HTTP \u8bf7\u6c42\u7684 host \u8def\u5f84\n      if (baseUrl == null) {\n        throw new IllegalStateException(\"Base URL required.\");\n      }\n      // \u7528\u6765\u6267\u884c\u8bf7\u6c42\u7684\u5de5\u5382\uff0c\u82e5\u6ca1\u6709\u8bbe\u7f6e\u5c31\u662f\u4f7f\u7528 OKHttpClient\n      okhttp3.Call.Factory callFactory = this.callFactory;\n      if (callFactory == null) {\n        callFactory = new OkHttpClient();\n      }\n      // \u5f02\u6b65\u8bf7\u6c42\u65f6\u56de\u8c03\u7ebf\u7a0b\u5207\u6362\u7684\u6267\u884c\u5668\n      Executor callbackExecutor = this.callbackExecutor;\n      if (callbackExecutor == null) {\n        callbackExecutor = platform.defaultCallbackExecutor();\n      }\n      // \u7f51\u7edc\u8bf7\u6c42\u9002\u914d\u5668\u7684\u5de5\u5382\u96c6\u5408\n      // Make a defensive copy of the adapters and add the default Call adapter.\n      List&lt;CallAdapter.Factory&gt; callAdapterFactories = new ArrayList&lt;&gt;(this.callAdapterFactories);\n      callAdapterFactories.add(platform.defaultCallAdapterFactory(callbackExecutor));\n      // \u6570\u636e\u8f6c\u6362\u5668\u7684\u5de5\u5382\n      // Make a defensive copy of the converters.\n      List&lt;Converter.Factory&gt; converterFactories =\n          new ArrayList&lt;&gt;(1 + this.converterFactories.size());\n      // Add the built-in converter factory first. This prevents overriding its behavior but also\n      // ensures correct behavior when using converters that consume all types.\n      converterFactories.add(new BuiltInConverters());\n      converterFactories.addAll(this.converterFactories);\n      // \u521b\u5efa Retrofit \u5b9e\u4f8b\n      return new Retrofit(callFactory, baseUrl, unmodifiableList(converterFactories),\n          unmodifiableList(callAdapterFactories), callbackExecutor, validateEagerly);\n    }\n</code></pre> <p>\u5728 Build \u521b\u5efa Retrofit \u65f6\u6709\u5982\u4e0b\u8981\u6ce8\u610f\u7684\u4e1c\u897f\uff1a</p> <ul> <li>callFactory : \u7f51\u7edc\u8bf7\u6c42\u5de5\u5382</li> <li>adapterFactories : \u7f51\u7edc\u8bf7\u6c42\u9002\u914d\u5668\u5de5\u5382\u7684\u96c6\u5408</li> <li>converterFactories : \u6570\u636e\u8f6c\u6362\u5668\u5de5\u5382\u7684\u96c6\u5408</li> <li>callbackExecutor : \u56de\u8c03\u65b9\u6cd5\u6267\u884c\u5668</li> </ul> <p>\u8fd9\u56db\u4e2a\u4e1c\u897f\u53ef\u4ee5\u8bf4\u662f Retrofit \u4e2d\u5f88\u91cd\u8981\u7684\u5185\u5bb9\u4e86\uff0c\u5b83\u4eec\u5728 Retrofit \u7c7b\u4e2d\u90fd\u662f\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\u7c7b\u578b\uff0c\u5c06\u5b9a\u4e49\u4e0e\u5b9e\u73b0\u8fdb\u884c\u5206\u79bb\uff0c\u53ef\u4ee5\u505a\u5230\u9762\u5411\u63a5\u53e3\u7f16\u7a0b\u3002</p> <p>Retrofit \u662f\u5bf9\u7f51\u7edc\u8bf7\u6c42\u7684\u5c01\u88c5\u5e93\uff0c\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\u7684\u8fc7\u7a0b\u5927\u81f4\u53ef\u4ee5\u62bd\u8c61\u5982\u4e0b\uff1a</p> <pre><code>\u521b\u5efa\u7f51\u7edc\u8bf7\u6c42 --&gt; \u53d1\u51fa\u7f51\u7edc\u8bf7\u6c42 --&gt; \u6536\u5230\u8bf7\u6c42\u5185\u5bb9 --&gt; \u5bf9\u5185\u5bb9\u8fdb\u884c\u5904\u7406\n</code></pre> <p>\u800c Retrofit \u53ef\u4ee5\u8bf4\u662f\u5bf9\u4e0a\u9762\u7684\u6d41\u7a0b\u90fd\u8fdb\u884c\u4e86\u62bd\u8c61\uff0c\u62bd\u8c61\u51fa\u4e00\u4e9b\u7c7b\u548c\u63a5\u53e3\uff0c\u8fd9\u4e9b\u62bd\u8c61\u7c7b\u6216\u8005\u63a5\u53e3\u7684\u8c03\u7528\u5c31\u662f\u5b9e\u73b0\u4e0a\u9762\u7684\u8bf7\u6c42\u6d41\u7a0b\u3002</p> <p><code>adapterFactories</code> \u5c31\u662f\u5bf9\u521b\u5efa\u7684\u7f51\u7edc\u8bf7\u6c42\u9002\u914d\u7684\u96c6\u5408\uff0c\u6bd4\u5982\u9ed8\u8ba4\u8bf7\u6c42\u662f <code>Call</code>\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7 <code>RxJavaCallAdapterFactory</code> \u5c06\u7f51\u7edc\u8bf7\u6c42\u9002\u914d\u5230 RxJava \u7684 <code>Observable</code> \u3002</p> <p><code>callFactory</code> \u5c31\u662f\u7528\u6765\u6267\u884c\u7f51\u7edc\u8bf7\u6c42\u7684\uff0c\u5c06\u8bf7\u6c42\u53d1\u51fa\u53bb\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u8be5\u53d8\u91cf\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528 <code>OkHttpClient</code> \u6765\u5b8c\u6210\u8be5\u529f\u80fd\u3002</p> <p><code>converterFactories</code> \u5c31\u662f\u5c06\u8bf7\u6c42\u540e\u7684\u5185\u5bb9\u8f6c\u6362\u6210\u6307\u5b9a\u7684\u683c\u5f0f\u7684\u96c6\u5408\uff0c\u5982\u679c\u670d\u52a1\u5668\u8fd4\u56de\u7684\u662f GSON \u683c\u5f0f\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6307\u5b9a <code>GsonConverterFactory</code> \u5c06 HTTP \u7684 Response \u5185\u5bb9\u8f6c\u6362 GSON \u5bf9\u8c61\u3002</p> <p><code>callbackExecutor</code> \u5c31\u662f\u5728\u7f51\u7edc\u8bf7\u6c42\u7ed3\u675f\u540e\uff0c\u4ece\u5b50\u7ebf\u7a0b\u5207\u6362\u5230\u5bf9\u6570\u636e\u64cd\u4f5c\u7684\u7ebf\u7a0b\uff0c\u4e3b\u8981\u5c31\u662f\u5207\u6362\u5230\u4e3b\u7ebf\u7a0b\u3002</p> <p>\u4f9d\u7167\u7f51\u7edc\u8bf7\u6c42\u6d41\u7a0b\uff0c\u4e0a\u9762\u56db\u4e2a\u91cd\u70b9\u53d8\u91cf\u5728\u8bf7\u6c42\u4e2d\u51fa\u73b0\u7684\u5148\u540e\u987a\u5e8f\u4e5f\u662f\u5982\u4e0b\uff1a</p> <pre><code>adapterFactories --&gt; callFactory --&gt; converterFactories --&gt; callbackExecutor\n</code></pre> <p>\u53e6\u5916\uff0cRetrofit \u8fd8\u662f\u652f\u6301\u591a\u5e73\u53f0\u7684\uff0c\u9664\u4e86 Android \u5e73\u53f0\u4e4b\u5916\uff0c\u8fd8\u6709 Java \u7b49\u5e73\u53f0\uff0c\u5728 <code>Retrofit.Builder</code> \u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u5c31\u5bf9\u5f53\u524d\u5e73\u53f0\u505a\u4e86\u4e00\u4e2a\u5224\u65ad\uff0c\u8fd9\u91cc\u5c31\u53ea\u770b Android Platform \u5c31\u597d\u4e86\u3002</p> <p>\u5f04\u61c2\u4e86\u5927\u81f4\u7684\u8109\u7edc\uff0c\u63a5\u7740\u518d\u6765\u770b\u5b9e\u9645\u4ee3\u7801\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u8bf7\u6c42\u540e\u7684\u7ebf\u7a0b\u5207\u6362\u64cd\u4f5c\uff0c\u90a3\u4e48\u5c31\u4f1a\u4f7f\u7528 <code>defaultCallbackExecutor</code> \u3002 Android \u4e0b\u9ed8\u8ba4\u7684\u5c31\u662f <code>MainThreadExecutor</code> \uff0c\u901a\u8fc7\u4e3b\u7ebf\u7a0b\u7684 Handler \u6765\u5b9e\u73b0\u7ebf\u7a0b\u5207\u6362\u3002</p> <pre><code>    static class MainThreadExecutor implements Executor {\n      private final Handler handler = new Handler(Looper.getMainLooper());\n      // \u5411\u4e3b\u7ebf\u7a0b post \u4e00\u4e2a runnable \u5b9e\u73b0\u5207\u6362\n      @Override public void execute(Runnable r) {\n        handler.post(r);\n      }\n    }\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u6dfb\u52a0\u7f51\u7edc\u8bf7\u6c42\u9002\u914d\u5668\u5bf9\u8c61\uff0c\u90a3\u4e48\u5c31\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u7684 <code>defaultCallAdapterFactory</code> \u3002Android \u4e0b\u9ed8\u8ba4\u7684\u5c31\u662f <code>ExecutorCallAdapterFactory</code> \uff0c</p> <p>\u5b83\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>  @Override\n  public CallAdapter&lt;?, ?&gt; get(Type returnType, Annotation[] annotations, Retrofit retrofit) {\n    if (getRawType(returnType) != Call.class) {\n      return null;\n    }\n    final Type responseType = Utils.getCallResponseType(returnType);\n    // \u8fd4\u56de CallAdapter \u5bf9\u8c61\u8fdb\u884c\u9002\u914d\n    return new CallAdapter&lt;Object, Call&lt;?&gt;&gt;() {\n      @Override public Type responseType() {\n        return responseType;\n      }\n      // \u5177\u4f53\u9002\u914d\u51fd\u6570\n      @Override public Call&lt;Object&gt; adapt(Call&lt;Object&gt; call) {\n        // \u8fd4\u56de ExecutorCallbackCall \u51fd\u6570\uff0c\u56e0\u4e3a\u5c31\u662f\u5bf9 call \u7684\u4e00\u4e2a\u59d4\u6258\n        return new ExecutorCallbackCall&lt;&gt;(callbackExecutor, call);\n      }\n    };\n  }\n</code></pre> <p>\u91cd\u70b9\u5728\u4e8e\u8fd4\u56de <code>CallAdapter</code> \u5bf9\u8c61\uff0c\u5b83\u5c06\u7f51\u7edc\u8bf7\u6c42\u8fdb\u884c\u9002\u914d\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528 RxJava \u7684\u8bdd\uff0c\u90a3\u4e48\u8fd4\u56de\u7684\u5c31\u662f <code>ExecutorCallbackCall</code> \u3002</p> <p>\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u8bf7\u6c42\u7ed3\u679c\u8f6c\u6362\u5bf9\u8c61\uff0c\u90a3\u4e48\u5c31\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u7684 <code>BuiltInConverters</code> \u7c7b\u8fdb\u884c\u8f6c\u6362\uff0c<code>BuiltInConverters</code> \u4e0e\u8bf7\u6c42\u9002\u914d\u548c\u7ebf\u7a0b\u5207\u6362\u4e0d\u540c\uff0c\u5b83\u662f\u548c\u5e73\u53f0\u65e0\u5173\u7684\u3002</p> <p>\u5728 <code>adapterFactories</code> \u548c <code>converterFactories</code> \u4e2d\u8fd8\u7528\u5230\u4e86\u5de5\u5382\u6a21\u5f0f\uff0c\u901a\u8fc7\u5de5\u5382\u6a21\u5f0f\u5bf9\u5177\u4f53\u6267\u884c\u64cd\u4f5c\u7684 <code>CallAdapter</code> \u548c <code>Converter</code> \u8fdb\u884c\u5c01\u88c5\u3002</p> <p>\u4ee5\u4e0a\u5c31\u5b8c\u6210\u4e86 Retrofit \u5bf9\u8c61\u7684\u521b\u5efa\u3002</p>","tags":["Retrofit"]},{"location":"android/retrofit-analysis/#_2","title":"\u52a8\u6001\u4ee3\u7406\u521b\u5efa\u7f51\u7edc\u8bf7\u6c42\u5bf9\u8c61","text":"<p>\u63a5\u4e0b\u6765\u5c31\u662f\u4f7f\u7528 Retrofit \u7c7b\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u3002</p> <pre><code>// \u5b9a\u4e49\u8bf7\u6c42\u63a5\u53e3\npublic interface GitHubService {\n  @GET(\"users/{user}/repos\")\n  Call&lt;List&lt;Repo&gt;&gt; listRepos(@Path(\"user\") String user);\n}\n// \u52a8\u6001\u4ee3\u7406\u521b\u5efa\u5b9e\u73b0\u4e86\u8bf7\u6c42\u63a5\u53e3\u7684\u7c7b\nGitHubService service = retrofit.create(GitHubService.class);\n</code></pre> <p>\u52a8\u6001\u4ee3\u7406\u7684\u4f5c\u7528\u4e0e\u5b9e\u73b0\uff0c\u53ef\u4ee5\u53c2\u8003 \u8fd9\u7bc7\u6587\u7ae0\u3002</p> <p>\u8bf7\u6c42\u63a5\u53e3\u5b9a\u4e49\u7684\u6240\u6709\u65b9\u6cd5\uff0c\u90fd\u4f1a\u901a\u8fc7 <code>InvocationHandler</code> \u4e2d\u7684 <code>invoke</code> \u65b9\u6cd5\u53bb\u5206\u53d1\u5904\u7406\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8bf7\u6c42\u63a5\u53e3\u5b9a\u4e49\u7684\u8fd4\u56de\u7c7b\u578b\u662f <code>Call</code> \uff0c\u90a3\u4e48 <code>invoke</code> \u65b9\u6cd5\u8fd4\u56de\u7684\u4e5f\u662f <code>Call</code> \u7c7b\u578b\u3002</p> <p>\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>        new InvocationHandler() {\n          private final Platform platform = Platform.get();\n\n          @Override public Object invoke(Object proxy, Method method, @Nullable Object[] args)\n              throws Throwable {\n            // If the method is a method from Object then defer to normal invocation.\n            if (method.getDeclaringClass() == Object.class) {\n              return method.invoke(this, args);\n            }\n            if (platform.isDefaultMethod(method)) {\n              return platform.invokeDefaultMethod(method, service, proxy, args);\n            }\n            ServiceMethod&lt;Object, Object&gt; serviceMethod =\n                (ServiceMethod&lt;Object, Object&gt;) loadServiceMethod(method);\n            OkHttpCall&lt;Object&gt; okHttpCall = new OkHttpCall&lt;&gt;(serviceMethod, args);\n            return serviceMethod.adapt(okHttpCall);\n          }\n        });\n</code></pre> <p>\u5176\u4e2d\uff0c<code>method</code> \u5c31\u662f\u5bf9\u5e94\u63a5\u53e3\u4e2d\u58f0\u660e\u7684\u65b9\u6cd5\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u90fd\u4f1a\u901a\u8fc7 <code>loadServiceMethod</code> \u65b9\u6cd5\u5c06\u5b83\u8f6c\u6362\u6210 <code>ServiceMethod</code> \u5bf9\u8c61\u3002</p> <p>serviceMethod \u4f1a\u5148\u4ece\u7f13\u5b58 <code>ConcurrentHashMap</code> \u4e2d\u67e5\u627e\uff0c\u5982\u679c\u6ca1\u6709\u5728\u901a\u8fc7 <code>ServiceMethod.Builder</code> \u521b\u5efa\u4e00\u4e2a\u3002</p> <p>\u521b\u5efa\u65f6\u9996\u5148\u662f\u5982\u4e0b\u4e24\u4e2a\u65b9\u6cd5\uff1a</p> <pre><code>    // \u901a\u8fc7 method \u7684\u8fd4\u56de\u7c7b\u578b\u548c \u6ce8\u89e3 \u627e\u5230\u5bf9\u5e94\u7684 callAdapter\n    callAdapter = createCallAdapter();\n    // \u901a\u8fc7 method \u7684 \u8bf7\u6c42\u8fd4\u56de\u7c7b\u578b \u548c \u6ce8\u89e3 \u627e\u5230\u5bf9\u5e94\u7684 responseConverter\n    responseConverter = createResponseConverter();\n</code></pre> <p>\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u6709\u70b9\u7c7b\u4f3c\uff0c\u5728\u524d\u9762\u63d0\u5230\u7684 <code>adapterFactories</code> \u9002\u914d\u5668\u96c6\u5408\u548c <code>converterFactories</code> \u8f6c\u6362\u5668\u96c6\u5408\u90fd\u662f\u5217\u8868\u3002</p> <p>\u8981\u901a\u8fc7\u65b9\u6cd5\u7684\u8fd4\u56de\u7c7b\u578b\u3001\u8bf7\u6c42\u7ed3\u679c\u7684\u8fd4\u56de\u7c7b\u578b\u3001\u65b9\u6cd5\u6ce8\u89e3\uff0c\u4e3a\u5f53\u524d\u65b9\u6cd5\u627e\u5230\u5408\u9002\u7684\u9002\u914d\u5668\u548c\u8f6c\u6362\u5668\u3002</p> <p>\u5728\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\uff0cRetrofit \u5176\u5b9e\u652f\u6301\u5728\u8bf7\u6c42\u63a5\u53e3\u4e2d\u5b9a\u4e49\u4e0d\u540c\u7684\u8fd4\u56de\u7c7b\u578b\uff0c\u53ef\u4ee5 <code>Call</code> \u548c <code>Observable</code> \u540c\u65f6\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5 <code>GSON</code> \u548c <code>Response</code> \u540c\u65f6\u4f7f\u7528\u3002</p> <p>\u786e\u5b9a\u4e86\u8bf7\u6c42\u9002\u914d\u548c\u7ed3\u679c\u8f6c\u6362\u7c7b\u4e4b\u540e\uff0c\u5c31\u662f\u5904\u7406\u63a5\u53e3\u65b9\u6cd5\u4e2d\u5b9a\u4e49\u7684\u90a3\u4e9b\u6ce8\u89e3\uff0c\u5206\u522b\u662f\u4e3a\u8be5\u65b9\u6cd5\u5b9a\u4e49\u7684\u6ce8\u89e3\u548c\u4e3a\u8be5\u65b9\u6cd5\u53c2\u6570\u5b9a\u4e49\u7684\u6ce8\u89e3\u3002</p> <pre><code>      // \u5904\u7406\u65b9\u6cd5\u5bf9\u5e94\u7684\u6ce8\u89e3\n      for (Annotation annotation : methodAnnotations) {\n        parseMethodAnnotation(annotation);\n      }\n      // \u5904\u7406\u65b9\u6cd5\u53c2\u6570\u5bf9\u5e94\u7684\u6ce8\u89e3\n      int parameterCount = parameterAnnotationsArray.length;\n      parameterHandlers = new ParameterHandler&lt;?&gt;[parameterCount];\n      for (int p = 0; p &lt; parameterCount; p++) {\n          parameterHandlers[p] = parseParameter(p, parameterType, parameterAnnotations);\n      }\n</code></pre> <p>\u5173\u4e8e\u6ce8\u89e3\u5904\u7406\u8fd9\u5757\u6bd4\u8f83\u5197\u957f\uff0c\u6587\u7ae0\u7bc7\u5e45\u6709\u9650\uff0c\u5c31\u4e0d\u7ec6\u5199\u4e86\uff0c\u5176\u5b9e\u4e5f\u4e3b\u8981\u662f\u5bf9\u90a3\u4e9b <code>GET</code>\u3001<code>POST</code>\u3001<code>HEAD</code> \u7b49\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u5bf9\u8fd9\u4e9b\u6ce8\u89e3\u7684\u5904\u7406\u5728\u6700\u540e\u521b\u5efa <code>Call</code> \u7528\u6765\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u65f6\u4f1a\u7528\u5230\u3002</p> <p>\u5f53\u6ce8\u89e3\u4e5f\u5904\u7406\u5b8c\u4e86\u4e4b\u540e\uff0c\u5c31\u521b\u5efa\u4e86 serviceMethod \u5bf9\u8c61\uff0c\u63a5\u7740\u521b\u5efa <code>OkHttpCall</code> \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u4e0d\u662f\u7f13\u5b58\u7684\u4e86\uff0c\u56e0\u4e3a\u5b83\u5c31\u662f\u7528\u6765\u6267\u884c\u8bf7\u6c42\u7684\uff0c\u6bcf\u4e00\u6b21\u90fd\u8981\u65b0\u5efa\u4e00\u4e2a\u3002</p> <p>OkHttpCall \u5b9e\u73b0\u4e86 <code>Call</code> \u63a5\u53e3\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u5bf9\u5b83\u7684\u5c01\u88c5\u3002<code>Call</code> \u63a5\u53e3\u5728 OkHttp \u4e2d\u5c31\u662f\u7528\u6765\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u7684\uff0c\u5b83\u4e3b\u8981\u65b9\u6cd5\u5c31\u662f <code>execute</code> \u548c <code>enqueue</code> \uff0c</p> <p>\u7136\u540e serviceMethod \u5bf9\u8c61\u901a\u8fc7 <code>adapt</code> \u65b9\u6cd5\u5bf9 OkHttpCall \u8fdb\u884c\u9002\u914d\u8f6c\u6362\uff0c\u5e76\u4e14\u8fd4\u56de\u4e86\u8f6c\u6362\u7ed3\u679c\uff0c\u5982\u679c\u5728\u521b\u5efa Retrofit \u65f6\u6dfb\u52a0\u4e86 RxJava \u7684\u9002\u914d\uff0c\u90a3\u4e48\u8fd4\u56de\u7684\u5c31\u662f Observable \u7c7b\u578b\u3002</p> <p>\u8fd9\u4e2a <code>adapt</code> \u65b9\u6cd5\u7684\u9002\u914d\u5176\u5b9e\u5c31\u662f\u7531 serviceMethod \u7684 <code>callAdapter</code> \u6765\u5b9e\u73b0\u7684\u3002</p> <p>\u4e0a\u9762\u63d0\u5230\uff0c\u9ed8\u8ba4\u662f\u4f7f\u7528 <code>ExecutorCallAdapterFactory</code> \u5de5\u5382\u6765\u5b9e\u73b0\u7684\u3002</p> <p>\u6700\u540e\uff0c<code>invoke</code> \u51fd\u6570\u8fd4\u56de\u7684\u5c31\u662f\u628a <code>OkHttpCall</code> \u7ecf\u8fc7 <code>adapt</code> \u9002\u914d\u540e\u7684\u5bf9\u8c61\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8fd4\u56de <code>ExecutorCallbackCall</code> \u5bf9\u8c61\u3002</p>","tags":["Retrofit"]},{"location":"android/retrofit-analysis/#_3","title":"\u6267\u884c\u7f51\u7edc\u8bf7\u6c42","text":"<p>\u6709\u4e86 <code>ExecutorCallbackCall</code> \u5bf9\u8c61\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u50cf OkHttp \u90a3\u6837\u53bb\u6267\u884c\u8bf7\u6c42\u4e86\u3002</p> <pre><code>        // \u5f02\u6b65\u8bf7\u6c42\n        repos.enqueue(object : Callback&lt;MutableList&lt;Repo&gt;&gt; {\n            override fun onFailure(call: Call&lt;MutableList&lt;Repo&gt;&gt;?, t: Throwable?) {\n            }\n\n            override fun onResponse(call: Call&lt;MutableList&lt;Repo&gt;&gt;?, response: Response&lt;MutableList&lt;Repo&gt;&gt;?) {\n            }\n        })\n        // \u540c\u6b65\u8bf7\u6c42\n        repos.execute()\n</code></pre> <p><code>ExecutorCallbackCall</code> \u5bf9\u8c61\u5176\u5b9e\u662f\u5bf9 <code>OkHttpCall</code> \u7684\u59d4\u6258\uff0c\u5177\u4f53\u7684 <code>enqueue</code> \u548c <code>execute</code> \u65b9\u6cd5\u90fd\u662f\u7531 OkHttpCall \u6765\u5b9e\u73b0\u7684\u3002</p> <p>\u5148\u770b\u4e00\u4e0b\u540c\u6b65\u8c03\u7528</p> <pre><code>   private @Nullable okhttp3.Call rawCall;\n   @Override public Response&lt;T&gt; execute() throws IOException {\n    okhttp3.Call call;\n    synchronized (this) {\n      if (executed) throw new IllegalStateException(\"Already executed.\");\n      executed = true;\n      call = rawCall;\n      if (call == null) {\n        try {\n        // createRawCall \u65b9\u6cd5\u521b\u5efa call \n          call = rawCall = createRawCall();\n        } catch (IOException | RuntimeException | Error e) {\n        }\n      }\n    }\n    // \u53d6\u6d88\u8bf7\u6c42\n    if (canceled) {\n      call.cancel();\n    }\n    // \u89e3\u6790\u8bf7\u6c42\u5185\u5bb9\n    return parseResponse(call.execute());\n  }\n</code></pre> <p>\u5b9e\u9645\u662f\u901a\u8fc7 <code>createRawCall</code> \u65b9\u6cd5\u6765\u521b\u5efa <code>Call</code> \u7684\uff0c\u5728 <code>createRawCall</code> \u91cc\u9762\u53c8\u4e3b\u8981\u662f\u901a\u8fc7 <code>serviceMethod.toCall</code> \u65b9\u6cd5\u6765\u5b8c\u6210\u7684\u3002</p> <pre><code>  okhttp3.Call toCall(@Nullable Object... args) throws IOException {\n    // \u7528\u4e0a\u4e86\u4e4b\u524d\u89e3\u6790\u6ce8\u89e3\u5f97\u5230\u7684\u7ed3\u679c\n    RequestBuilder requestBuilder = new RequestBuilder(httpMethod, baseUrl, relativeUrl, headers,\n        contentType, hasBody, isFormEncoded, isMultipart);\n    // \u5904\u7406\u8bf7\u6c42\u7684\u53c2\u6570\n    @SuppressWarnings(\"unchecked\") // It is an error to invoke a method with the wrong arg types.\n    ParameterHandler&lt;Object&gt;[] handlers = (ParameterHandler&lt;Object&gt;[]) parameterHandlers;\n\n    int argumentCount = args != null ? args.length : 0;\n    if (argumentCount != handlers.length) {\n      throw new IllegalArgumentException(\"Argument count (\" + argumentCount\n          + \") doesn't match expected count (\" + handlers.length + \")\");\n    }\n    // \u628a\u6ce8\u89e3\u548c\u53c2\u6570\u5bf9\u5e94\u4e0a\n    for (int p = 0; p &lt; argumentCount; p++) {\n      handlers[p].apply(requestBuilder, args[p]);\n    }\n    // \u6700\u540e\u8fd8\u662f\u901a\u8fc7 callFactory \u6765\u521b\u5efa Call \n    return callFactory.newCall(requestBuilder.build());\n  }\n</code></pre> <p>\u5728 <code>toCall</code> \u65b9\u6cd5\u91cc\u5c31\u7528\u5230\u4e86\u4e4b\u524d\u89e3\u6790\u7684\u6ce8\u89e3\u5185\u5bb9\uff0c\u4f9d\u7136\u901a\u8fc7\u5efa\u9020\u8005\u6a21\u5f0f\u521b\u5efa\u8bf7\u6c42\uff0c\u5e76\u4e14\u628a\u8bf7\u6c42\u7684\u53c2\u6570\u548c\u5bf9\u5e94\u7684\u6ce8\u89e3\u5185\u5bb9\u5bf9\u5e94\u4e0a\uff0c\u4e5f\u5c31\u662f <code>ParameterHandler</code> \u7684 <code>apply</code> \u65b9\u6cd5\u3002</p> <p>\u6700\u540e\u662f\u901a\u8fc7 callFactory \u7f51\u7edc\u8bf7\u6c42\u5de5\u5382\u6765\u521b\u5efa\u8bf7\u6c42\uff0c\u9ed8\u8ba4\u5c31\u662f\u4f7f\u7528 OkHttp \u6765\u521b\u5efa\u3002</p> <p><code>parseResponse</code> \u65b9\u6cd5\u4f1a\u5904\u7406 <code>Call</code> \u6267\u884c\u7684\u7ed3\u679c\uff0c\u6700\u7ec8\u4e5f\u662f\u901a\u8fc7 <code>serviceMethod.toResponse</code> \u65b9\u6cd5\u6765\u5904\u7406\u3002</p> <pre><code>  R toResponse(ResponseBody body) throws IOException {\n    return responseConverter.convert(body);\n  }\n</code></pre> <p>\u5728\u8be5\u65b9\u6cd5\u91cc\uff0c\u7528\u5230\u4e4b\u524d\u63d0\u5230\u7684\u6570\u636e\u8f6c\u6362\u5668 <code>responseConverter</code> \u6765\u5b9e\u73b0\u6570\u636e\u7684\u8f6c\u6362,\u6700\u7ec8\u5c31\u5f97\u5230\u4e86\u8bf7\u6c42\u7684\u7ed3\u679c <code>Response</code> \u3002</p> <p>\u5f02\u6b65\u8bf7\u6c42\u548c\u540c\u6b65\u8bf7\u6c42\u5927\u81f4\u76f8\u540c\uff0c\u4e0d\u540c\u70b9\u5728\u4e8e\u5f02\u6b65\u8bf7\u6c42\u8981\u5207\u6362\u5230\u4e3b\u7ebf\u7a0b\uff0c\u8fd9\u4e5f\u662f\u7528\u4e4b\u524d\u63d0\u5230\u7684 <code>callbackExecutor</code> \u6765\u5b9e\u73b0\u7ebf\u7a0b\u5207\u6362\u3002</p> <pre><code>      delegate.enqueue(new Callback&lt;T&gt;() {\n        @Override public void onResponse(Call&lt;T&gt; call, final Response&lt;T&gt; response) {\n          // \u5207\u6362\u7ebf\u7a0b\n          callbackExecutor.execute(new Runnable() {\n            @Override public void run() {\n              if (delegate.isCanceled()) {\n                // Emulate OkHttp's behavior of throwing/delivering an IOException on cancellation.\n                callback.onFailure(ExecutorCallbackCall.this, new IOException(\"Canceled\"));\n              } else {\n                callback.onResponse(ExecutorCallbackCall.this, response);\n              }\n            }\n          });\n        }\n        //...\n      }\n</code></pre> <p><code>enqueue</code> \u8bf7\u6c42\u7684\u56de\u8c03\u65b9\u6cd5\u901a\u8fc7 <code>callbackExecutor</code> \u5b9e\u73b0\u4e86\u7ebf\u7a0b\u5207\u6362\u3002</p> <p>\u4ee5\u4e0a\uff0c\u5c31\u5206\u6790\u4e86 Retrofit \u4ece\u521b\u5efa\u5230\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u7684\u8fc7\u7a0b\u3002</p>","tags":["Retrofit"]},{"location":"android/retrofit-analysis/#_4","title":"\u5c0f\u7ed3","text":"<p>Retrofit \u7684\u8bbe\u8ba1\u601d\u60f3\u975e\u5e38\u503c\u5f97\u5b66\u4e60\uff0c\u4e8b\u5b9e\u4e0a\u76f4\u63a5\u4f7f\u7528 OkHttp \u540c\u6837\u53ef\u4ee5\u5b9e\u73b0\u529f\u80fd\uff0c\u4f46\u662f Retrofit \u5bf9 OkHttp \u7684\u5c01\u88c5\u5374\u66f4\u52a0\u65b9\u4fbf\u4e86\u3002</p> <p>\u9996\u5148\uff0c\u662f\u628a\u7f51\u7edc\u8bf7\u6c42\u7684\u7c7b\u578b\u548c\u53c2\u6570\uff0c\u901a\u8fc7\u6ce8\u89e3\u6765\u5904\u7406\u4e86\uff0c\u7528\u6ce8\u89e3\u6807\u6ce8\uff0c\u53ef\u4ee5\u7b80\u5316\u4e0d\u5c11\u4ee3\u7801\uff0c\u5728 Retrofit \u5185\u90e8\u53bb\u5b9e\u73b0\u6ce8\u89e3\u7684\u89e3\u6790\uff0c\u5e76\u4e14\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u53bb\u521b\u5efa\u5b9e\u73b0\u4e86\u6ce8\u89e3\u65b9\u6cd5\u63a5\u53e3\u7684\u5bf9\u8c61\u5b9e\u4f8b\u3002</p> <p>\u5176\u6b21\uff0c\u5927\u91cf\u8bbe\u8ba1\u6a21\u5f0f\u7684\u8fd0\u7528\u8ba9 Retrofit \u66f4\u5bb9\u6613\u53bb\u62d3\u5c55\uff0c\u6dfb\u52a0\u4e0d\u540c\u7684\u9002\u914d\u548c\u8f6c\u6362\uff0c\u628a\u7f51\u7edc\u8bf7\u6c42\u7684\u6bcf\u4e00\u4e2a\u73af\u8282\u90fd\u8fdb\u884c\u62c6\u5206\uff0c\u9762\u5411\u63a5\u53e3\u7684\u7f16\u7a0b\uff0c\u7f51\u7edc\u8bf7\u6c42\u9002\u914d\u548c\u6570\u636e\u8f6c\u6362\uff0c\u6bcf\u4e00\u4e2a\u90e8\u5206\u90fd\u53ef\u4ee5\u72ec\u7acb\u5f00\u3002</p> <p>\u63a5\u7740\uff0c\u57fa\u4e8e\u5bf9 OkHttp \u7684\u5c01\u88c5\uff0c\u80fd\u591f\u5229\u7528 OkHttp \u53bb\u5b9e\u73b0\u6700\u91cd\u8981\u7684\u7f51\u7edc\u8bf7\u6c42\u529f\u80fd\u3002</p> <p>\u6700\u540e\uff0c\u5b66\u4e60 Retrofit \u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u5e76\u628a\u5b83\u4eec\u7528\u5230\u6211\u4eec\u7684\u4ee3\u7801\u4e2d\u53bb\u3002</p>","tags":["Retrofit"]},{"location":"android/rust-compile-so-library/","title":"rust \u5f00\u53d1\u7f16\u8bd1 Android \u52a8\u6001\u5e93\u5b9e\u8df5","text":"<p>\u6700\u8fd1\u5173\u6ce8\u4e86\u4e00\u6ce2 rust\uff0c\u4e00\u95e8\u76ee\u524d\u8fd8\u6bd4\u8f83\u5c0f\u4f17\u4f46\u5374\u5f88\u5f3a\u5927\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b98\u7f51\u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://www.rust-lang.org/</p> <p>rust \u7684\u5b66\u4e60\u66f2\u7ebf\u6bd4\u8f83\u9661\u5ced\uff0c\u5728\u5f00\u59cb\u5b66\u4e60\u4e4b\u524d\u5efa\u8bae\u770b\u770b\u738b\u57a0\u7684\u8fd9\u7bc7\u6587\u7ae0 \u300a\u5982\u4f55\u638c\u63e1\u6240\u6709\u7684\u7f16\u7a0b\u8bed\u8a00\u300b\uff0c\u5730\u5740\u5982\u4e0b:</p> <p>https://www.yinwang.org/blog-cn/2017/07/06/master-pl</p> <p>\u5b66\u4e60\u8bed\u8a00\uff0c\u91cd\u8981\u7684\u662f\u638c\u63e1\u5176\u8bed\u8a00\u7279\u6027\u3002</p> <p>\u738b\u57a0\u4e3e\u4e86\u4e00\u4e9b\u8bed\u8a00\u7279\u6027\u7684\u4f8b\u5b50\uff1a</p> <ul> <li>\u53d8\u91cf\u5b9a\u4e49</li> <li>\u7b97\u672f\u8fd0\u7b97</li> <li>for \u5faa\u73af\u8bed\u53e5\uff0cwhile \u5faa\u73af\u8bed\u53e5</li> <li>\u51fd\u6570\u5b9a\u4e49\uff0c\u51fd\u6570\u8c03\u7528</li> <li>\u9012\u5f52</li> <li>\u9759\u6001\u7c7b\u578b\u7cfb\u7edf</li> <li>\u7c7b\u578b\u63a8\u5bfc</li> <li>lambda \u51fd\u6570</li> <li>\u9762\u5411\u5bf9\u8c61</li> <li>\u5783\u573e\u56de\u6536</li> <li>\u6307\u9488\u7b97\u672f</li> <li>goto \u8bed\u53e5</li> </ul> <p>\u770b\u7740\u8fd9\u4e9b\u7279\u6027\u662f\u4e0d\u662f\u5f88\u50cf\u4e00\u4e9b\u7f16\u7a0b\u8bed\u8a00\u4e66\u7684\u76ee\u5f55\ud83e\udd14</p> <p>\u5728\u5b66\u4e60 rust \u7684\u65f6\u5019\u4e5f\u53ef\u4ee5\u7167\u7740\u8fd9\u4e9b\u8bed\u8a00\u7279\u6027\u53bb\u5bf9\u6bd4\u81ea\u5df1\u662f\u5426\u638c\u63e1\u4e86\u3002</p> <p>\u90a3\u4e48 rust \u5230\u5e95\u5f3a\u5927\u5728\u54ea\u91cc\uff1f\u5728 Kotlin \u521a\u51fa\u7684\u65f6\u5019\u5ba3\u4f20\u7684\u70b9\u5c31\u662f\u7a7a\u5b89\u5168 \uff0c\u5f25\u8865 Java \u5728\u8fd9\u65b9\u9762\u7684\u4e0d\u8db3\u3002\u800c rust \u53ef\u4ee5\u8bf4\u5bf9\u6bd4\u7684\u662f C++\uff0c\u5f25\u8865 C++ \u5728\u7a7a\u6307\u9488\u548c\u91ce\u6307\u9488\uff08\u60ac\u5782\u6307\u9488\uff09\u65b9\u9762\u7684\u4e0d\u8db3\uff0c\u5f53\u7136 rust \u7684\u4f18\u52bf\u8fd8\u4e0d\u8db3\u5982\u6b64\u3002</p> <p>\u4ee5\u4e0b\u662f\u6765\u81ea\u7ef4\u57fa\u767e\u79d1\u7684\u4ecb\u7ecd\uff0c\u6709\u4e9b\u7279\u6027\u6211\u6682\u65f6\u8fd8\u6ca1\u4f53\u9a8c\u8fc7\uff0c\u5148\u6458\u5f55\u4e00\u6ce2\uff1a</p> <p>Rust \u662f\u7531 Mozilla \u4e3b\u5bfc\u5f00\u53d1\u7684\u901a\u7528\u3001\u7f16\u8bd1\u578b\u7f16\u7a0b\u8bed\u8a00\u3002\u3002\u8bbe\u8ba1\u51c6\u5219\u4e3a\u201c\u5b89\u5168\u3001\u5e76\u53d1\u3001\u5b9e\u7528\u201d\uff0c\u652f\u6301\u51fd\u6570\u5f0f\u3001\u5e76\u53d1\u5f0f\u3001\u8fc7\u7a0b\u5f0f\u4ee5\u53ca\u9762\u5411\u5bf9\u8c61\u7684\u7f16\u7a0b\u98ce\u683c\u3002</p> <p>\u76ee\u524d\u56fd\u5185\u4e5f\u5df2\u7ecf\u6709\u4e00\u4e9b\u56e2\u961f\u5728\u7528 rust \u8fdb\u884c\u5f00\u53d1\u4e86\uff0c\u53ef\u4ee5\u5728\u89c2\u671b\u4e00\u6ce2\u540e\uff0c\u518d\u51b3\u5b9a\u662f\u5426\u6295\u5165\u7cbe\u529b\u5165\u5751<sub>~</sub></p>","tags":["rust","so"]},{"location":"android/rust-compile-so-library/#rust-so","title":"rust \u7f16\u8bd1 so \u5b9e\u8df5","text":"<p>\u4e0b\u9762\u662f\u7528 rust \u7f16\u8bd1 Android \u52a8\u6001\u5e93\u5b9e\u8df5\uff0c\u4e3b\u8981\u53c2\u8003\u4e86 Mozilla \u7ed9\u7684\u4f8b\u5b50\uff0c\u5177\u4f53\u94fe\u63a5\u5728\u540e\u9762\u3002</p>","tags":["rust","so"]},{"location":"android/rust-compile-so-library/#rust","title":"\u5b89\u88c5 rust","text":"<p>\u9996\u5148\u662f\u5b89\u88c5 rust \uff0c\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u5b89\u88c5\uff1a</p> <pre><code>curl https://sh.rustup.rs -sSf | sh\n</code></pre> <p>\u7136\u540e\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8f93\u51fa rust \u7248\u672c\u4ee5\u53ca\u9a8c\u8bc1\u662f\u5426\u5b89\u88c5\u6210\u529f\u3002</p> <pre><code>rustc --version\n</code></pre>","tags":["rust","so"]},{"location":"android/rust-compile-so-library/#rust_1","title":"\u914d\u7f6e rust \u4ea4\u53c9\u7f16\u8bd1","text":"<p>\u786e\u4fdd Android \u7684 sdk \u76ee\u5f55\u914d\u7f6e\u5230\u4e86\u7cfb\u7edf\u73af\u5883\u4e2d\u3002</p> <pre><code>export ANDROID_HOME=/Users/$USER/Library/Android/sdk\nexport NDK_HOME=$ANDROID_HOME/ndk-bundle\n</code></pre> <p>\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>mkdir NDK\n${NDK_HOME}/build/tools/make_standalone_toolchain.py --api 26 --arch arm64 --install-dir NDK/arm64\n${NDK_HOME}/build/tools/make_standalone_toolchain.py --api 26 --arch arm --install-dir NDK/arm\n${NDK_HOME}/build/tools/make_standalone_toolchain.py --api 26 --arch x86 --install-dir NDK/x86\n</code></pre> <p>\u4e3b\u8981\u662f\u6267\u884c ndk-bundle \u76ee\u5f55\u4e0b\u7684 python \u811a\u672c\uff0c\u8be5\u811a\u672c\u5728 NDK \u76ee\u5f55\u4e2d\u53bb\u521b\u5efa arm64\u3001arm\u3001x86 \u67b6\u6784\u5e73\u53f0\u7684\u7f16\u8bd1\u73af\u5883\u3002</p> <p>\u5728\u628a\u73af\u5883\u6dfb\u52a0\u5230 rust \u7684\u914d\u7f6e\u4e2d\u3002</p> <p>\u521b\u5efa <code>cargo-config.toml</code> \u6587\u4ef6\uff0c\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>[target.aarch64-linux-android]\nar = \"&lt;path&gt;/NDK/arm64/bin/aarch64-linux-android-ar\"\nlinker = \"&lt;path&gt;/NDK/arm64/bin/aarch64-linux-android-clang\"\n\n[target.armv7-linux-androideabi]\nar = \"&lt;path&gt;/NDK/arm/bin/arm-linux-androideabi-ar\"\nlinker = \"&lt;path&gt;/NDK/arm/bin/arm-linux-androideabi-clang\"\n\n[target.i686-linux-android]\nar = \"&lt;path&gt;/NDK/x86/bin/i686-linux-android-ar\"\nlinker = \"&lt;path&gt;/NDK/x86/bin/i686-linux-android-clang\"\n</code></pre> <p>\u8bb0\u5f97\u628a  \u66ff\u6362\u6210 NDK \u6587\u4ef6\u5939\u6240\u5728\u7684\u8def\u5f84\u3002 <p>\u7136\u540e\u6267\u884c\uff1a</p> <pre><code>cp cargo-config.toml ~/.cargo/config\n</code></pre> <p>\u628a cargo-config.toml \u79fb\u52a8\u5230 <code>~/.cargo/</code> \u76ee\u5f55\u4e0b\u3002</p> <p>\u518d\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>rustup target add aarch64-linux-android armv7-linux-androideabi i686-linux-android\n</code></pre> <p>\u4ee5\u4e0a\u5c31\u5b8c\u6210\u4e86\u4ea4\u53c9\u7f16\u8bd1\u73af\u5883\u7684\u914d\u7f6e\u3002</p>","tags":["rust","so"]},{"location":"android/rust-compile-so-library/#rust_2","title":"rust \u5f00\u53d1\u53ca\u7f16\u8bd1","text":"<p>\u73b0\u5728\u8981\u6d89\u53ca\u5230\u5177\u4f53\u7684 rust \u5f00\u53d1\u4e86\uff0c\u63a8\u8350\u4f7f\u7528 JetBrains \u7cfb\u5217\u7684 IntelliJ IDEA \uff0c\u65e0\u9700\u6fc0\u6d3b\uff0c\u4f7f\u7528\u793e\u533a\u7248\u5c31\u884c\uff0c\u5b89\u88c5 rust \u63d2\u4ef6\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u7f16\u5199\u4ee3\u7801\u4e86\u3002</p> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u5de5\u7a0b\u76ee\u5f55\uff1a</p> <pre><code>mkdir rust-android\ncd rust-android\n</code></pre> <p>\u7136\u540e\u521b\u5efa rust \u9879\u76ee\uff1a <pre><code>cargo new rust --lib\ncd rust\n</code></pre></p> <p><code>rust</code> \u4ee3\u8868\u521b\u5efa\u7684\u9879\u76ee\u6240\u5728\u6587\u4ef6\u5939\u540d\u5b57\u3002</p> <p><code>--lib</code> \u4ee3\u8868\u6211\u4eec\u521b\u5efa\u7684\u662f\u4e00\u4e2a\u5e93\u9879\u76ee\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u6267\u884c\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</p> <p>\u9879\u76ee\u7ed3\u6784\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u7ed3\u6784\u5f88\u7b80\u5355\uff0c\u5c31\u4e24\u4e2a\u6587\u4ef6\uff0c\u672c\u7bc7\u6587\u7ae0\u4e5f\u4e0d\u4f1a\u81ea\u5df1\u53bb\u65b0\u589e\u6587\u4ef6\uff0c\u5f53\u7136\u80af\u5b9a\u662f\u4f1a\u6709\u7f16\u8bd1\u6587\u4ef6\u51fa\u73b0\u7684\u3002</p> <p><code>Cargo.toml</code> \u5c31\u76f8\u5f53\u4e8e Android \u4e2d\u7684 build.gradle \uff0c\u4e00\u4e9b\u7b2c\u4e09\u65b9\u5e93\u90fd\u662f\u901a\u8fc7\u8fd9\u91cc\u53bb\u5f15\u7528\u7684\u3002</p> <p><code>lib.rs</code> \u5c31\u662f\u5177\u4f53\u7f16\u5199\u4ee3\u7801\u7684\u5730\u65b9\u4e86\u3002</p> <p>\u9996\u5148\u8981\u5728 Cargo.toml \u4e2d\u53bb\u6dfb\u52a0\u4e00\u4e9b\u5185\u5bb9\uff1a</p> <pre><code>[dependencies]\n# \u6dfb\u52a0 jni \u4f9d\u8d56\uff0c\u5e76\u6307\u5b9a\u7248\u672c\njni = { version = \"0.10.2\", default-features = false }\n\n[profile.release]\nlto = true\n\n[lib]\n# \u7f16\u8bd1\u7684\u52a8\u6001\u5e93\u540d\u5b57\nname = \"rust\"\n# \u7f16\u8bd1\u7c7b\u578b cdylib \u6307\u5b9a\u4e3a\u52a8\u6001\u5e93\ncrate-type = [\"cdylib\"]\n</code></pre> <p>\u5173\u4e8e\u6dfb\u52a0\u7684\u5185\u5bb9\u542b\u4e49\u5982\u4e0a\u6ce8\u91ca\uff0c\u4e3b\u8981\u662f\u6dfb\u52a0\u4e86 jni \u4f9d\u8d56\u548c\u6307\u5b9a\u7f16\u8bd1\uff0c\u6709\u4e86 jni \u4f9d\u8d56\u624d\u80fd\u591f\u8ba9 Android \u9879\u76ee\u4ee3\u7801\u8c03\u7528\u5230 so \u52a8\u6001\u5e93\u7684\u5185\u5bb9\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7f16\u5199 rust \u4ee3\u7801\u4e86\u3002</p> <pre><code>// \u6307\u5b9a os \u7c7b\u578b\n#![cfg(target_os = \"android\")]\n// \u5141\u8bb8\u4e0d\u662f snake_case \u7684\u547d\u4ee4\u65b9\u5f0f\n#![allow(non_snake_case)]\n\n// \u5f15\u7528\u6807\u51c6\u5e93\u7684\u4e00\u4e9b\u5185\u5bb9\nuse std::ffi::{CString, CStr};\n// \u5f15\u7528 jni \u5e93\u7684\u4e00\u4e9b\u5185\u5bb9\uff0c\u5c31\u662f\u4e0a\u9762\u6dfb\u52a0\u7684 jni \u4f9d\u8d56\nuse jni::JNIEnv;\nuse jni::objects::{JObject, JString};\nuse jni::sys::jstring;\n\n#[no_mangle]\n// jni \u51fd\u6570\u8c03\u7528\u7684\u5934\npub unsafe extern fn Java_com_glumes_rust_MainActivity_hello(\n    env: JNIEnv, _: JObject, j_recipient: JString) -&gt; jstring {\n    // \u5c06 Android \u4e0a\u5c42\u4f20\u6765\u7684\u5b57\u7b26\u4e32\u8f6c\u51fa rust \u4e2d\u7684\u5b57\u7b26\u4e32\u53d8\u91cf\n    let recipient = CString::from(\n        CStr::from_ptr(\n            env.get_string(j_recipient).unwrap().as_ptr()\n        )\n    );\n    // \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32\n    let output = env.new_string(\"hello\".to_owned() + recipient.to_str().unwrap()).unwrap();\n    output.into_inner()\n}\n</code></pre> <p>\u629b\u5f00 rust \u5177\u4f53\u8bed\u6cd5\u4e0d\u770b\uff0c\u4ee3\u7801\u5185\u5bb9\u4e5f\u5f88\u7b80\u5355\uff0c\u4f20\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u6267\u884c\u5177\u4f53\u7684\u7f16\u8bd1\uff1a</p> <pre><code>cargo build --target aarch64-linux-android --release\ncargo build --target armv7-linux-androideabi --release\ncargo build --target i686-linux-android --release\n</code></pre> <p>\u5206\u522b\u6267\u884c\u4e0a\u9762\u4e09\u4e2a\u547d\u4ee4\uff0c\u4f1a\u5206\u522b\u6784\u5efa\u4e09\u4e2a\u4e0d\u540c\u5e73\u53f0\u7684 so \u5e93\u3002</p> <p>\u7136\u540e\u628a so \u5e93\u66ff\u6362\u5230 Android \u9879\u76ee\u7684 jniLibs \u5177\u4f53\u6587\u4ef6\u5939\u5c31\u597d\u4e86\u3002</p> <p></p> <p>\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u7528 rust \u7f16\u8bd1 Android \u5e73\u53f0\u7684 so \u52a8\u6001\u5e93\uff0c\u5e76\u4e14\u6bcf\u6b21\u7f16\u8bd1\u540e\u7684\u65f6\u5019\u5c31\u8981\u8fdb\u884c so \u7684\u66ff\u6362\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u60f3\u529e\u6cd5\u628a rust so \u7684\u7f16\u8bd1\u653e\u5728 Android gradle \u7684\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\uff0c\u5c31\u548c\u7528 CMake \u7f16\u8bd1\u4e00\u6837\u3002</p>","tags":["rust","so"]},{"location":"android/rust-compile-so-library/#_1","title":"\u95ee\u9898\u548c\u601d\u8003","text":"<p>\u4ee5\u4e0a\u53ea\u662f\u4e00\u4e2a\u5c0f\u5c0f\u7684\u4f8b\u5b50\uff0c\u60f3\u7528 rust \u5b9e\u73b0\u50cf C++ \u90a3\u6837\u53bb\u5f00\u53d1\u52a8\u6001\u5e93\uff0c\u53ef\u80fd\u8fd8\u4e00\u4e9b\u5751\u8981\u53bb\u63a2\u7d22\u3002\u4ec5\u4ec5\u662f\u5b9e\u73b0 jni \u7684\u8c03\u7528\u8fd8\u662f\u8fdc\u4e0d\u591f\u7684\uff0c\u5728 NDK \u5f00\u53d1\u91cc\u9762\u8fd8\u6709\u5f88\u591a\u5934\u6587\u4ef6\uff0c\u5982\u4f55\u53bb\u5728 rust \u91cc\u9762\u53bb\u5b9e\u73b0\u8c03\u7528\uff1f</p> <p>\u5982\u679c\u60f3\u8981 rust \u53bb\u6253\u5370 Android NDK \u4e2d\u7684 log \uff0c\u5012\u662f\u53ef\u4ee5\u53c2\u8003 android_logger-rs \u9879\u76ee\uff0c\u81f3\u4e8e\u5176\u4ed6\u7684\u6162\u6162\u6478\u7d22\u4e2d\u3002</p> <p>\u53e6\u5916\u8fd8\u6709\u4e2a\u95ee\u9898\uff0c\u5982\u4f55\u5728 Android \u4e2d\u53bb\u65ad\u70b9\u8c03\u8bd5 rust \u7684\u4ee3\u7801\uff0c\u5728\u7f51\u4e0a\u641c\u7d22\u4e86\u4e00\u756a\uff0c\u8fd8\u6ca1\u627e\u5230\u5408\u9002\u7684\u7b54\u6848\uff0c\u6709\u77e5\u9053\u7684\u670b\u53cb\u53ef\u4ee5\u6307\u70b9\u6211\u4e00\u4e8c \ud83e\udd7a</p>","tags":["rust","so"]},{"location":"android/rust-compile-so-library/#_2","title":"\u53c2\u8003","text":"<p>\u5177\u4f53\u7684\u4f8b\u5b50\u53ef\u4ee5\u53c2\u8003\u6211\u7684 GitHub \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/rust-android-example</p> <ol> <li>https://www.yinwang.org/blog-cn/2017/07/06/master-pl</li> <li>https://mozilla.github.io/firefox-browser-architecture/experiments/2017-09-21-rust-on-android.html</li> </ol>","tags":["rust","so"]},{"location":"android/rxjava-wrapper-callback/","title":"\u7528 RxJava \u5c01\u88c5\u56de\u8c03\u65b9\u6cd5 CallBack","text":"<p>\u5728\u77e5\u4e4e\u4e0a\u770b\u5230\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898\uff1aRxJava\u6b63\u786e\u7684\u5c01\u88c5callback\u7684\u65b9\u5f0f\u5e94\u8be5\u662f\u600e\u4e48\u6837\u7684\uff1f\u3002\u867d\u8bf4\u5df2\u7ecf\u662f\u4e2a\u4e00\u5e74\u524d\u7684\u95ee\u9898\u4e86\uff0c\u81ea\u5df1\u73b0\u5728\u624d\u9047\u5230 (\u7f9e\u6127\u8138) \u3002</p> <p>\u6700\u8fd1\u5728\u5904\u7406\u84dd\u7259\u64cd\u4f5c\u65f6\uff0c\u4e5f\u60f3\u7740\u5982\u4f55\u628a RxJava \u4f18\u52bf\u7528\u5230\u84dd\u7259\u5f00\u53d1\u4e2d\u6765\u3002</p> <p>\u4f7f\u7528 RxJava \u80fd\u591f\u7b80\u5316\u6211\u4eec\u7684\u7f16\u7a0b\uff0c\u6709\u6548\u7684\u907f\u514d\u56de\u8c03\u5730\u72f1 (<code>Callback Hell</code>) \u7684\u60c5\u51b5\u3002\u5c06\u56de\u8c03\u64cd\u4f5c\u4ea4\u7ed9\u89c2\u5bdf\u8005 Observer \u7684 onNext \u4e2d\u53bb\u5904\u7406\uff0c\u540c\u65f6\u8fd8\u6709\u7740\u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26\u8fdb\u884c\u5404\u9879\u5904\u7406\u3002</p> <p>\u4f46\u662f\u6709\u4e9b\u73b0\u6210\u7684\u64cd\u4f5c\u5df2\u7ecf\u5904\u7406\u597d\u56de\u8c03\u65b9\u6cd5\u4e86\uff0c\u4f8b\u5982\u84dd\u7259\u626b\u63cf\uff0c\u53ea\u8981\u5728 onLeScan \u65b9\u6cd5\u4e2d\u5904\u7406\u8fd4\u56de\u7684\u84dd\u7259\u8bbe\u5907\u5373\u53ef\uff0c\u5176\u4ed6\u65b9\u6cd5\u4e5f\u5927\u81f4\u5982\u6b64\uff0c\u53d1\u51fa\u8bf7\u6c42\uff0c\u5728\u56de\u8c03\u4e2d\u5904\u7406\u8bf7\u6c42\u3002</p> <pre><code>mBluetoothAdapter.startLeScan(new BluetoothAdapter.LeScanCallback() {\n            @Override\n            public void onLeScan(BluetoothDevice bluetoothDevice, int i, byte[] bytes) {\n                // \u56de\u8c03\u65b9\u6cd5\uff0c\u5904\u7406\u626b\u63cf\u5230\u7684\u84dd\u7259\u8bbe\u5907\n            }\n        });\n</code></pre> <p>\u800c\u73b0\u5728\uff0c\u8981\u505a\u7684\u5c31\u662f\u7528 RxJava \u5bf9\u84dd\u7259\u626b\u63cf\u8fc7\u7a0b\u8fdb\u884c\u5c01\u88c5\uff0c\u8fd4\u56de RxJava \u4e2d\u7684\u88ab\u89c2\u5bdf\u8005 Observable \uff0c\u7136\u540e\u5728\u518d\u5bf9\u8fd9\u4e2a Observable \u4f7f\u7528\u5404\u79cd\u64cd\u4f5c\u7b26\uff0c\u7ebf\u7a0b\u8c03\u5ea6\uff0c\u6700\u540e\u6267\u884c\u8ba2\u9605 subscribe \u65b9\u6cd5\u3002</p>","tags":["Android","RxJava"]},{"location":"android/rxjava-wrapper-callback/#rxjava-observable","title":"RxJava \u521b\u5efa Observable \u8fc7\u7a0b","text":"<p>\u521b\u5efa\u4e00\u4e2a Observable \u7684\u65b9\u6cd5\u5927\u81f4\u662f\u8fd9\u6837\u7684\uff1a <pre><code>        Observable.create(new Observable.OnSubscribe&lt;String&gt;() {\n            @Override\n            public void call(Subscriber&lt;? super String&gt; subscriber) {\n                // \u5728\u56de\u8c03\u65b9\u6cd5\u4e2d\uff0c\u5bf9\u53d1\u5c04\u7684\u6570\u636e\u5904\u7406 onNext\u3001onComplete\u3001 onError \n                // \u5b9e\u5219\u662f\u8c03\u7528 subscriber \u7684\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\n            }\n        }).subscribe(new Observer());\n</code></pre> \u4f7f\u7528 create \u65b9\u6cd5\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2a Observable \u5bf9\u8c61\u5e76\u8fd4\u56de\u3002\u800c create \u65b9\u6cd5\u7684\u53c2\u6570 OnSubscribe \u5c31\u662f\u4e00\u4e2a\u56de\u8c03\u65b9\u6cd5\uff0c\u5728\u6267\u884c\u8ba2\u9605 subscribe \u65b9\u6cd5\u65f6\u4f1a\u56de\u8c03\u91cc\u9762\u7684 call \u65b9\u6cd5\u3002</p> <p>\u800c call \u65b9\u6cd5\u91cc\u7684\u53c2\u6570 subscriber \u5c31\u662f\u6211\u4eec\u5728 subscribe \u65b9\u6cd5\u4e2d\u4f20\u5165\u7684\u89c2\u5bdf\u8005 Observer \u3002RxJava \u5185\u90e8\u4f1a\u5bf9\u4f20\u5165\u7684 Observer \u8fdb\u884c\u5904\u7406\uff0c\u5305\u88c5\u6210 ObserverSubscriber \u5bf9\u8c61\uff0c\u7ee7\u627f\u81ea Subscriber \uff0c\u6240\u4ee5\u6700\u7ec8\u90fd\u662f\u8c03\u7528\u7684 Subscriber \u7c7b\u578b\u7684\u65b9\u6cd5\u3002</p> <p>\u6240\u4ee5\u5047\u82e5\u5bf9\u56de\u8c03\u65b9\u6cd5\u8fdb\u5305\u88c5\uff0c\u90a3\u4e48\u5728 call \u65b9\u6cd5\u4e2d\u5c31\u5e94\u8be5\u5bf9\u56de\u8c03\u6570\u636e\u8fdb\u884c\u5904\u7406\u4e86\u3002</p> <p>\u540c\u65f6\uff0csubscribe \u65b9\u6cd5\u6700\u540e\u8fd4\u56de\u7684\u5bf9\u8c61\u662f Subscription \u7c7b\u578b\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u7528  Subscription \u7c7b\u578b\u7684\u5bf9\u8c61\u7684 unsubscribe \u65b9\u6cd5\u6765\u53d6\u6d88\u8ba2\u9605\u3002\u53c2\u7167 RxJava \u6e90\u7801\u53d1\u73b0\uff0cSubscriber \u7c7b\u578b\u5b9e\u73b0\u4e86 Subscription \u63a5\u53e3\uff0c\u5e76\u4e14\u6700\u540e\u8fd4\u56de\u7684\u4e5f\u662f call \u65b9\u6cd5\u4e2d\u7684\u53c2\u6570 subscriber \u3002</p> <pre><code>        try {\n            // allow the hook to intercept and/or decorate\n            // \u56de\u8c03 call \u65b9\u6cd5\n            RxJavaHooks.onObservableStart(observable, observable.onSubscribe).call(subscriber);\n            // \u8fd4\u56de Subscription \n            return RxJavaHooks.onObservableReturn(subscriber);\n        } catch (Throwable e) { // \u7701\u7565\n        }\n</code></pre> <p>\u5bf9\u4e8e\u4f7f\u7528 from \u65b9\u6cd5\u521b\u5efa\u7684 Observable \uff0c\u6700\u540e\u7684\u8c03\u7528\u8fc7\u7a0b\u4e5f\u662f\u4e00\u81f4\u7684\uff0cRxJava \u5185\u90e8\u5c06\u4f20\u5165\u7684\u53c2\u6570\u5c01\u88c5\u6210\u4e86 OnSubscribeFromIterable \u5bf9\u8c61\uff0c\u5176\u4ed6\u7684\u5927\u540c\u5c0f\u5f02\u4e86\u3002</p>","tags":["Android","RxJava"]},{"location":"android/rxjava-wrapper-callback/#rxjava","title":"RxJava \u5c01\u88c5\u84dd\u7259\u626b\u63cf\u8fc7\u7a0b","text":"<p>\u5bf9\u84dd\u7259\u626b\u63cf\u7684\u5305\u88c5\uff1a</p> <p>\u6709\u4e86\u4e0a\u9762\u7684\u601d\u8def\uff0c\u5c31\u53ef\u4ee5\u7b80\u5355\u7684\u5b9e\u73b0\u5305\u88c5\u4e86\uff0c\u4f7f\u7528 create \u65b9\u6cd5\u8fd4\u56de\u4e86\u4e00\u4e2a <code>Observable&lt;BluetoothDevice&gt;</code>\u5bf9\u8c61\uff0c\u7136\u540e\u5728\u5bf9\u5176\u8ba2\u9605\u3002</p> <p><pre><code>Subscription subscription = Observable.create(new Observable.OnSubscribe&lt;BluetoothDevice&gt;() {\n            @Override\n            public void call(final Subscriber&lt;? super BluetoothDevice&gt; subscriber) {\n                BluetoothAdapter.LeScanCallback leScanCallback =  new BluetoothAdapter.LeScanCallback() {\n                    @Override\n                    public void onLeScan(BluetoothDevice bluetoothDevice, int i, byte[] bytes) {\n                        //\n                        subscriber.onNext(bluetoothDevice);\n                    }\n                } ;\n                mBluetoothAdapter.startLeScan(leScanCallback) ;\n            }\n        }).subscribe(new Observer()) ;\n</code></pre> \u7b80\u5355\u5730\u8bf4\uff0c\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5bf9 BluetoothDevice \u5bf9\u8c61\u7684\u5c01\u88c5\uff0c\u53ef\u4f9d\u65e7\u5b58\u5728\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Subscription \u6765\u53d6\u6d88\u8ba2\u9605\uff0c\u4e0d\u63a5\u6536\u53d1\u9001\u6570\u636e\uff0c\u4f46\u5374\u6ca1\u6709\u505c\u6b62\u84dd\u7259\u8bbe\u5907\u7684\u626b\u63cf\uff0c\u56e0\u6b64\u4e0b\u4e00\u6b65\u5c31\u662f\u5728\u53d6\u6d88\u8ba2\u9605\u540c\u65f6\u7ec8\u6b62\u626b\u63cf\u3002</p> <pre><code>    Subscription subscription = Observable.create(new Observable.OnSubscribe&lt;BluetoothDevice&gt;() {\n            @Override\n            public void call(final Subscriber&lt;? super BluetoothDevice&gt; subscriber) {\n                final BluetoothAdapter.LeScanCallback leScanCallback =  new BluetoothAdapter.LeScanCallback() {\n                    @Override\n                    public void onLeScan(BluetoothDevice bluetoothDevice, int i, byte[] bytes) {\n                        // \u5224\u65ad\u662f\u5426\u8fd8\u5728\u8ba2\u9605\uff0c\u907f\u514d\u53d1\u9001\u4e0d\u5fc5\u8981\u7684\u6570\u636e\n                        if (!subscriber.isUnsubscribed()){\n                            subscriber.onNext(bluetoothDevice);\n                        }\n                    }\n                } ;\n                mBluetoothAdapter.startLeScan(leScanCallback) ;\n                // \u4f7f\u7528 Subscriptions \u7684 create \u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u53ea\u6709\u53d6\u6d88\u8ba2\u9605\u65f6\u624d\u8c03\u7528\u7684\u65b9\u6cd5\n                subscriber.add(Subscriptions.create(new Action0() {\n                    @Override\n                    public void call() {\n                        mBluetoothAdapter.stopLeScan(leScanCallback);\n                    }\n                }));\n            }\n        }).subscribe();\n</code></pre> <p>Subscriber \u7c7b\u6709\u4e2a\u65b9\u6cd5\u662f addSubscription \uff0c\u4f7f\u7528 Subscriptions \u7c7b\u7684 create \u65b9\u6cd5\u5c31\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5728\u53d6\u6d88\u8ba2\u9605\u65f6\u624d\u6267\u884c\u7684\u65b9\u6cd5\u3002</p> <p>Subscriptions \u7c7b\u7684\u547d\u540d\u65b9\u5f0f\u6709\u70b9\u7c7b\u4f3c\u4e8e Java \u7684 Collections \u547d\u540d\uff0c\u5de5\u5177\u7c7b\u540e\u7f00\u52a0\u4e2a s \u7684\u65b9\u5f0f\u3002</p> <p>\u8fd9\u6837\u5c31\u5b9e\u73b0\u4e86\u5728\u53d6\u6d88\u8ba2\u9605\u7684\u540c\u65f6\u4e5f\u505c\u6b62\u84dd\u7259\u626b\u63cf\u8fc7\u7a0b\u3002</p>","tags":["Android","RxJava"]},{"location":"android/rxjava-wrapper-callback/#rxjava_1","title":"RxJava \u81ea\u5e26\u5904\u7406\u65b9\u5f0f","text":"<p>\u6700\u540e\uff0cRxJava \u5728\u540e\u7eed\u7684\u7248\u672c\u4e2d\u8fd8\u63d0\u4f9b\u4e86\u5176\u4ed6\u7684\u65b9\u6cd5\u6765\u9488\u5bf9\u4e0a\u8ff0\u95ee\u9898\uff0c\u4e0d\u9700\u8981\u518d\u901a\u8fc7 Subscriber \u6dfb\u52a0\u4e00\u4e2a Subscription \u6765\u89e3\u51b3\u4e86\u3002</p> <pre><code>Observable.fromEmitter(new Action1&lt;Emitter&lt;BluetoothDevice&gt;&gt;() {\n            @Override\n            public void call(final Emitter&lt;BluetoothDevice&gt; bluetoothDeviceEmitter) {\n            final BluetoothAdapter.LeScanCallback scanCallback = new BluetoothAdapter.LeScanCallback() {\n                    @Override\n                    public void onLeScan(BluetoothDevice bluetoothDevice, int i, byte[] bytes) {\n                        bluetoothDeviceEmitter.onNext(bluetoothDevice);\n                    }\n                };\n                // \u5f00\u59cb\u626b\u63cf\n                mBluetoothAdapter.startLeScan(scanCallback) ;\n                // \u5f53 unsubscribe \u65f6\u6267\u884c\u8be5\u65b9\u6cd5\n                bluetoothDeviceEmitter.setCancellation(new Cancellable() {\n                    @Override\n                    public void cancel() throws Exception {\n                        mBluetoothAdapter.stopLeScan(scanCallback);\n                    }\n                });\n            }\n        }, Emitter.BackpressureMode.BUFFER); // RxJava \u89e3\u51b3\u80cc\u538b\u95ee\u9898\u7684\u65b9\u5f0f\n</code></pre> <p>\u901a\u8fc7 Observable \u7684 fromEmitter \u65b9\u6cd5\u6765\u521b\u5efa Observable \uff0c\u540c\u65f6\u901a\u8fc7 Emitter \u7684 setCancellation \u65b9\u6cd5\u8bbe\u7f6e\u53d6\u6d88\u8ba2\u9605\u65f6\u7684\u52a8\u4f5c\u3002</p> <p>\u540c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 Emitter \u7684\u4e0d\u540c\u7684 <code>BackpressureMode</code> \u6765\u5904\u7406\u80cc\u538b\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u5f53\u751f\u4ea7\u8005\u7684\u751f\u4ea7\u901f\u5ea6\u6bd4\u6d88\u8d39\u8005\u7684\u6d88\u8d39\u901f\u5ea6\u5feb\u7684\u60c5\u51b5\uff0cEmmiter \u63d0\u4f9b\u4e86\u5982\u4e0b\u65b9\u6cd5\uff1a</p> <ul> <li>BUFFER               \u7f13\u5b58</li> <li>LATEST                \u4f7f\u7528\u6700\u65b0\u7684</li> <li>DROP                   \u76f4\u63a5\u4e22\u5f03</li> <li>ERROR/NONE      \u629b\u51fa\u5f02\u5e38 MissingBackpressureException </li> </ul> <p>\u5982\u6b64\u4e00\u6765\u5c31\u53ef\u4ee5\u4f7f\u7528 RxJava \u5bf9\u84dd\u7259\u626b\u63cf\u8fc7\u7a0b\u8fdb\u884c\u5c01\u88c5\u4e86\u3002</p> <p>\u7528 RxJava \u5c01\u88c5\u5176\u4ed6\u56de\u8c03\u65b9\u6cd5\u4e5f\u5927\u81f4\u5982\u6b64\u4e86\uff0c\u628a\u539f\u672c\u7684\u56de\u8c03\u65b9\u6cd5\u5904\u7406\u7528 onNext \u6765\u5904\u7406\uff0c\u5f02\u5e38\u7528 onError \u5904\u7406\uff0c\u9700\u8981\u53d6\u6d88\u56de\u8c03\u7684\u5c31\u5728\u53d6\u6d88\u8ba2\u9605\u65f6\u5904\u7406\u3002</p>","tags":["Android","RxJava"]},{"location":"android/rxjava-wrapper-callback/#_1","title":"\u53c2\u8003","text":"<p>1\u3001http://ryanharter.com/blog/2015/07/07/wrapping-existing-libraries-with-rxjava/ 2\u3001http://blog.chengyunfeng.com/?p=1019</p>","tags":["Android","RxJava"]},{"location":"android/rxjava-wrapper-dialog/","title":"\u7528 Rxjava \u5c01\u88c5 Dialog \u4ee5\u53ca RxBinding \u5b9e\u73b0\u7b80\u8981\u5206\u6790","text":"<p>\u4e4b\u524d\u6709\u5199\u8fc7\u4e00\u7bc7\u6587\u7ae0\uff1a\u7528 RxJava \u5c01\u88c5\u56de\u8c03\u65b9\u6cd5 CallBack\u3002</p> <p>RxJava \u5c01\u88c5\u56de\u8c03\u65b9\u6cd5\u7684\u5927\u4f53\u601d\u8def\u5c31\u662f\uff1a\u4f7f\u7528 Observable \u7684 create \u65b9\u6cd5\u6765\u8fd4\u56de\u4e00\u4e2a Observable\uff0c\u5728 create \u65b9\u6cd5\u5185\u7ed9\u4e8b\u7269\u8bbe\u7f6e\u56de\u8c03\u63a5\u53e3\uff0c\u7528 Observable \u7684 onNext \u65b9\u6cd5\u6765\u63a5\u53d7\u56de\u8c03\u63a5\u53e3\u6240\u4ea7\u751f\u7684\u5185\u5bb9\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u901a\u8fc7 onNext \u65b9\u6cd5\u5c31\u628a\u4e8b\u7269\u7684\u56de\u8c03\u65b9\u6cd5\u8f6c\u6362\u5230 Rxjava \u5bf9\u5e94\u7684\u4e8b\u4ef6\u6d41\u91cc\u9762\u4e86\uff0c\u518d\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u64cd\u4f5c\u7b26\uff0c\u5982 Map\u3001FlatMap \u7b49\u5bf9\u4e8b\u4ef6\u6d41\u8fdb\u884c\u76f8\u5e94\u7684\u8f6c\u6362\u3002</p> <p>\u4e0b\u6765\u5c55\u793a\u5177\u4f53\u4ee3\u7801\u7684\u64cd\u4f5c\uff0c\u7528\u7684\u662f RxJava 2.x \u7684\u7248\u672c\uff1a</p> <pre><code> private Observable&lt;Integer&gt; handleRxJavaDialog() {\n        return Observable.create(emitter -&gt; {\n            final AlertDialog dialog = new AlertDialog.Builder(mContext)\n                    .setMessage(\"RxJava\u5c01\u88c5Dialog\u4e8b\u4ef6\u6d41\")\n                    .setNegativeButton(\"\u53d6\u6d88\", (dialog12, which) -&gt; emitter.onNext(which)) \n                    .setPositiveButton(\"\u786e\u8ba4\", (dialog1, which) -&gt; emitter.onComplete())\n                    .create();\n            dialog.show();\n            // \u5f53\u88ab\u53d6\u6d88\u8ba2\u9605\uff0cunsubscribed \u65f6\u8c03\u7528\u7684\u65b9\u6cd5\n            emitter.setCancellable(() -&gt; {\n                if (dialog.isShowing()) {\n                    dialog.dismiss();\n                }\n            });\n        });\n    }\n</code></pre> <p>\u5982\u6b64\u5c01\u88c5\u4e4b\u540e\uff0c\u76f4\u63a5\u901a\u8fc7 RxJava \u7684 onNext \u65b9\u6cd5\u5c06\u4e8b\u4ef6\u5c01\u88c5\u5230 RxJava \u4e8b\u4ef6\u6d41\u91cc\u9762\u53bb\u3002</p> <p>\u5f04\u5230\u8fd9\uff0c\u60f3\u8d77\u4e86\u4e00\u4e2a\u5f00\u6e90\u7684 RxJava \u7cfb\u5217\u6846\u67b6\uff1aRxBinding\uff0c\u548c\u672c\u6587\u7684\u5c01\u88c5\u6709\u76f8\u540c\u4e4b\u5904\u3002</p>","tags":["Android","RxJava"]},{"location":"android/rxjava-wrapper-dialog/#rxbinding","title":"RxBinding \u5b9e\u73b0\u7b80\u8981\u5206\u6790","text":"<p>RxBinding \u662f\u7528\u6765\u5904\u7406\u63a7\u4ef6\u5f02\u6b65\u8c03\u7528\u7684\u4e00\u4e2a\u6846\u67b6\uff0c\u5b83\u4e5f\u5df2\u7ecf\u66f4\u65b0\u5230\u4e86 RxJava 2.x \u7684\u7248\u672c\u3002</p> <p>\u5728\u5b83\u7684\u6e90\u7801\u91cc\u5bf9\u8bb8\u591a\u63a7\u4ef6\u90fd\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u53ef\u4ee5\u770b\u5230\u5982\uff1a<code>RxView</code>\u3001<code>RxTextView</code>\u3001<code>RxSeekBar</code>\u3001<code>RxProgressBar</code>\u3001<code>RxPopupMenu</code>\u7b49\u7b49\u3002</p> <p>\u5b83\u4eec\u7684\u4f7f\u7528\u4e5f\u662f\u5927\u540c\u5c0f\u5f02\uff0c\u6bd4\u5982\u8981\u5bf9\u4e00\u4e2a View \u5c01\u88c5\u5176\u70b9\u51fb\u4e8b\u4ef6\uff0c\u5c31\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a <pre><code>  RxView.clicks(mBtn)\n        .subscribe(new Consumer&lt;Object&gt;() {\n            @Override\n            public void accept(@NonNull Object o) throws Exception {\n                Timber.d(\"RxView\");\n            }\n        });\n</code></pre> \u5728\u4ee3\u7801\u7684\u524d\u534a\u90e8\u5206<code>RxView.clicks(mBtn)</code>\u8fd4\u56de\u7684\u6b63\u597d\u662f\u4e00\u4e2a Observable \u5bf9\u8c61\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u50cf\u5e73\u65f6\u4f7f\u7528 RxJava \u4e00\u6837\u6dfb\u52a0\u5404\u79cd\u64cd\u4f5c\u7b26\uff0c\u6700\u540e\u901a\u8fc7 subscribe \u8fdb\u884c\u8ba2\u9605\u4e86\u3002</p> <p>\u5728 RxView.clicks \u7684\u6e90\u7801\u4e2d\uff0c\u6700\u540e\u8fd4\u56de\u7684\u662f\u4e00\u4e2a ViewClickObservable\uff0c\u4ece\u540d\u5b57\u53ef\u89c1\uff0c\u8fd9\u4e2a Observable \u4e13\u95e8\u662f\u7528\u6765\u5904\u7406\u70b9\u51fb\u4e8b\u4ef6\u7684\uff0c\u5728 RxBinding \u4e2d\u8fd8\u6709\u5f88\u591a\u4e13\u95e8\u5904\u7406\u5176\u4ed6\u4e8b\u4ef6\u7684 Observable\uff0c\u4f8b\u5982\uff1a<code>ViewDragObservable</code>\u3001<code>ViewLongClickObservable</code>\u3001<code>ViewScrollChangeEventObservable</code>\u7b49\u7b49\uff0c\u4ed6\u4eec\u7684\u5b9e\u73b0\u65b9\u6cd5\u4e5f\u90fd\u5927\u540c\u5c0f\u5f02\u4e86\u3002</p> <pre><code>  @CheckResult @NonNull\n  public static Observable&lt;Object&gt; clicks(@NonNull View view) {\n    checkNotNull(view, \"view == null\");\n    return new ViewClickObservable(view);\n  }\n</code></pre> <p>\u5728\u4e13\u95e8\u5904\u7406\u5404\u79cd\u4e8b\u4ef6\u7684 Observable \u7c7b\u4e2d\uff0c\u90fd\u4f1a\u6709\u4e00\u4e2a\u5b9e\u73b0 <code>Disposable</code>\u63a5\u53e3\u548c\u5177\u4f53\u4e8b\u4ef6\u6240\u5bf9\u5e94\u7684\u63a5\u53e3\u7684 Listener \u7c7b\uff0c\u800c\u8fd9\u4e2a Listener \u7c7b\u7684\u4f5c\u7528\uff0c\u5c31\u662f\u7ed9\u6211\u4eec\u6240\u9700\u8981\u7684 View \u8bbe\u7f6e\u5bf9\u5e94\u4e8b\u4ef6\u56de\u8c03\u63a5\u53e3\u7684\uff0c\u5e76\u4e14\u5728\u56de\u8c03\u63a5\u53e3\u4e2d\u8c03\u7528 Observable \u7684 onNext \u65b9\u6cd5\u6765\u5c06\u4e8b\u4ef6\u8f6c\u6362\u5230 RxJava \u7684\u4e8b\u4ef6\u6d41\u4e2d\u3002</p> <p><pre><code>    ViewClickObservable(View view) {\n    this.view = view;\n    }\n\n  @Override protected void subscribeActual(Observer&lt;? super Object&gt; observer) {\n    if (!checkMainThread(observer)) {\n      return;\n    }\n    Listener listener = new Listener(view, observer);\n    // onSubscribe \u8bbe\u7f6e\u4e86 Disposable \u63a5\u53e3\uff0c\u5f53\u53d6\u6d88\u8ba2\u9605\u65f6\u8be5\u6267\u884c\u7684\u64cd\u4f5c\u3002\n    observer.onSubscribe(listener);\n    view.setOnClickListener(listener);\n  }\n// ViewClickObservable \u7684 Listener \u7c7b\u5b9e\u73b0\u4e86 OnClickListener \u63a5\u53e3\n  static final class Listener extends MainThreadDisposable implements OnClickListener {\n    private final View view;\n    private final Observer&lt;? super Object&gt; observer;\n\n    Listener(View view, Observer&lt;? super Object&gt; observer) {\n      this.view = view;\n      this.observer = observer;\n    }\n    // \u5728 onClick \u65b9\u6cd5\u5185\uff0c\u8c03\u7528 onNext \u65b9\u6cd5\uff0c\u5c06 onClick \u7684\u4e8b\u4ef6\u8f6c\u79fb\u5230\u4e86 RxJava \u7684\u4e8b\u4ef6\u6d41\u91cc\u9762\u53bb\u4e86\n    @Override public void onClick(View v) {\n      if (!isDisposed()) {\n        observer.onNext(Notification.INSTANCE);\n      }\n    }\n    // \u5f53\u88ab\u53d6\u6d88\u8ba2\u9605\u65f6\uff0c\u5c31\u8bbe\u7f6e\u63a5\u53e3\u4e3a null.\n    @Override protected void onDispose() {\n      view.setOnClickListener(null);\n    }\n  }\n</code></pre> \u800c\u5728\u5f00\u59cb\u8ba2\u9605\u65f6\uff0c\u5c31\u8c03\u7528<code>subscribeActual</code>\u65b9\u6cd5\u6765\u7ed9 View \u8bbe\u7f6e\u56de\u8c03\u63a5\u53e3\u4ee5\u4fbf\u8f6c\u6362\u4e8b\u4ef6\u6d41\u3002\u5e76\u4e14\u8fd8\u8bbe\u7f6e\u4e86<code>Disposable</code>\u4ee5\u4fbf\u54cd\u5e94\u5f53\u7ed3\u675f\u8ba2\u9605\u65f6\u7684\u64cd\u4f5c\u3002</p> <p>\u8fd9\u4e00\u903b\u8f91\u548c\u672c\u6587\u4e0a\u534a\u90e8\u5206\u5c06\u7684\u6709\u76f8\u540c\u4e4b\u5904\uff0c\u6838\u5fc3\u90fd\u662f\u7528 onNext \u65b9\u6cd5\u8f6c\u6362\u4e8b\u4ef6\u6d41\u3002</p> <p>\u800c RxBinding \u5219\u5c01\u88c5\u7684\u66f4\u591a\u4e86\uff0c\u6ca1\u6709\u5728 create \u65b9\u6cd5\u91cc\u9762\u8fdb\u884c\u64cd\u4f5c\uff0c \u800c\u662f\u9488\u5bf9 View \u63a7\u4ef6\u4e0d\u540c\u7684\u4e8b\u4ef6\u6765\u751f\u6210\u5bf9\u5e94\u7684 Observable \u5bf9\u8c61\uff0c\u5bf9\u8c61\u91cc\u9762\u6301\u6709 View \u63a7\u4ef6\u7684\u5b9e\u4f8b\uff0c\u5e76\u4e14\u4e5f\u5b8c\u6210\u4e86\u7ed9 View \u63a7\u4ef6\u8bbe\u7f6e\u56de\u8c03\u63a5\u53e3\u4ee5\u53ca\u53d6\u6d88\u8ba2\u9605\u65f6\u7684\u65b9\u6cd5\u3002</p> <p>\u4f46\u6beb\u65e0\u7591\u95ee\uff0c\u9488\u5bf9 View \u63a7\u4ef6\u7684\u4e8b\u4ef6\u6765\u751f\u6210 Observable \u4f1a\u4f7f\u5f97\u4ee3\u7801\u7684\u517c\u5bb9\u6027\u66f4\u5f3a\u4e86\u5427\uff0c\u6bd5\u7adf\u5927\u591a\u6570\u63a7\u4ef6\u90fd\u6709\u516c\u5171\u4e8b\u4ef6\uff0c\u800c\u53ea\u9700\u8981\u9488\u5bf9\u8fd9\u4e2a\u529f\u80fd\u4e8b\u4ef6\u5199\u4e00\u904d\u4ee3\u7801\u5c31\u884c\u4e86\uff0c\u4e0d\u9700\u8981\u9488\u5bf9\u6bcf\u4e2a\u63a7\u4ef6\u6765\u5b9e\u73b0\u4e00\u5957\u4ee3\u7801\u4e86\u3002</p> <p>\u603b\u7ed3\u7ecf\u9a8c\uff0c\u5199\u4ee3\u7801\u65f6\u8fd8\u662f\u8981\u591a\u60f3\u60f3\uff0c\u8c0b\u5b9a\u800c\u540e\u52a8\uff01\uff01\uff01</p>","tags":["Android","RxJava"]},{"location":"android/rxjava-wrapper-dialog/#_1","title":"\u53c2\u8003","text":"<p>1\u3001http://adelnizamutdinov.github.io/blog/2014/11/23/advanced-rxjava-on-android-popupmenus-and-dialogs/</p>","tags":["Android","RxJava"]},{"location":"android/stb-image-introduce/","title":"\u7b80\u5355\u6613\u7528\u7684\u56fe\u50cf\u89e3\u7801\u5e93\u4ecb\u7ecd \u2014\u2014 stb_image","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/Mh_cLQeRy5J5AufeaGaOmA</p> <p>\u8bf4\u5230\u56fe\u50cf\u89e3\u7801\u5e93\uff0c\u6700\u5bb9\u6613\u60f3\u8d77\u7684\u5c31\u662f <code>libpng</code> \u548c <code>libjpeg</code> \u8fd9\u4e24\u4e2a\u8001\u724c\u56fe\u50cf\u89e3\u7801\u5e93\u4e86\u3002</p> <p><code>libpng</code> \u548c <code>libjpeg</code> \u5206\u522b\u5404\u81ea\u5bf9\u5e94 <code>png</code> \u548c <code>jpeg</code> \u4e24\u79cd\u56fe\u50cf\u683c\u5f0f\u3002\u8fd9\u4e24\u79cd\u683c\u5f0f\u7684\u533a\u522b\u5982\u4e0b\uff1a</p> <p><code>png</code> \u652f\u6301\u900f\u660e\u5ea6\uff0c\u65e0\u635f\u538b\u7f29\u7684\u56fe\u7247\u683c\u5f0f\uff0c\u80fd\u5728\u4fdd\u8bc1\u4e0d\u5931\u771f\u7684\u60c5\u51b5\u4e0b\u5c3d\u53ef\u80fd\u538b\u7f29\u56fe\u50cf\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u56e0\u6b64\u56fe\u50cf\u8d28\u91cf\u9ad8\uff0c\u5728\u4e00\u4e9b\u8d34\u7eb8\u5e94\u7528\u4e2d\u4e5f\u5927\u90e8\u5206\u7528\u7684\u662f png \u56fe\u7247\u3002</p> <p><code>jpg</code> \u4e0d\u652f\u6301\u900f\u660e\u5ea6\uff0c\u6709\u635f\u538b\u7f29\u7684\u56fe\u7247\u683c\u5f0f\uff0c\u6709\u635f\u538b\u7f29\u4f1a\u4f7f\u5f97\u539f\u59cb\u56fe\u7247\u6570\u636e\u8d28\u91cf\u4e0b\u8f7d\uff0c\u4e5f\u56e0\u6b64\u5b83\u5360\u7528\u7684\u5185\u5b58\u5c0f\uff0c\u5728\u7f51\u9875\u5e94\u7528\u4e2d\u52a0\u901f\u901f\u5ea6\u5feb\u3002</p> <p>\u8981\u60f3\u5728\u5de5\u7a0b\u4e2d\u540c\u65f6\u89e3\u7801 <code>png</code> \u548c <code>jpeg</code> \u683c\u5f0f\u56fe\u7247\uff0c\u5c31\u5fc5\u987b\u540c\u65f6\u5f15\u7528\u8fd9\u4e24\u79cd\u5e93\uff0c\u800c\u4e14\u8fd8\u5f97\u7ecf\u8fc7\u4e00\u7cfb\u5217\u7f16\u8bd1\u6b65\u9aa4\u624d\u884c\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u4ecb\u7ecd\u4e00\u4e2a\u7b80\u5355\u6613\u7528\u7684\u56fe\u50cf\u5e93\uff1a<code>stb_image</code> \u3002Github \u5730\u5740\u4e3a\uff1ahttps://github.com/nothings/stb \uff0c\u76ee\u524d\u5df2\u7ecf\u6709\u4e86 9600+ Star \u3002\u5b83\u7684\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u770b\u770b README \u53ef\u80fd\u4f60\u5c31\u4f1a\u4e86\u3002</p> <p>\u770b\u770b\u5b83\u7684\u6e90\u7801\uff0c\u4f60\u4f1a\u53d1\u73b0\u5168\u662f <code>.h</code> \u5934\u6587\u4ef6\u3002\u8fd9\u5c31\u662f\u5b83\u7684\u5f3a\u5927\u4e4b\u5904\u4e86\uff0c\u4ec5\u9700\u5728\u5de5\u7a0b\u4e2d\u52a0\u5165\u5934\u6587\u4ef6\u5c31\u53ef\u4ee5\u89e3\u6790\u56fe\u50cf\u4e86\uff08\u5b9e\u9645\u4e0a\u662f\u51fd\u6570\u5b9e\u73b0\u7b49\u5185\u5bb9\u90fd\u653e\u5728\u5934\u6587\u4ef6\u4e86\u800c\u5df2\uff09\u3002</p> <p>\u91cd\u70b9\u5173\u6ce8\u5982\u4e0b\u4e09\u4e2a\u5934\u6587\u4ef6\uff1a</p> <ul> <li>stb_image.h<ul> <li>\u7528\u4e8e\u56fe\u50cf\u52a0\u8f7d</li> </ul> </li> <li>stb_image_write.h<ul> <li>\u7528\u4e8e\u5199\u5165\u56fe\u50cf\u6587\u4ef6</li> </ul> </li> <li>stb_image_resize.h<ul> <li>\u7528\u4e8e\u6539\u53d8\u56fe\u50cf\u5c3a\u5bf8</li> </ul> </li> </ul> <p>\u4e0b\u9762\u5c31\u5f00\u59cb\u5b9e\u8df5\u5427\uff0c\u5148\u7ed9\u51fa\u4e00\u4e2a\u5b8c\u6574\u7684\u4f8b\u5b50\uff1a</p> <pre><code>#include &lt;iostream&gt;\n\n#define STB_IMAGE_IMPLEMENTATION\n#include \"stb_image.h\"\n#define STB_IMAGE_WRITE_IMPLEMENTATION\n#include \"stb_image_write.h\"\n#define STB_IMAGE_RESIZE_IMPLEMENTATION\n#include \"stb_image_resize.h\"\n#include &lt;string&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;vector&gt;\n\nusing namespace std;\n\nint main() {\n    std::cout &lt;&lt; \"Hello, STB_Image\" &lt;&lt; std::endl;\n\n    string inputPath = \"/Users/glumes/Pictures/input.png\";\n    int iw, ih, n;\n\n    // \u52a0\u8f7d\u56fe\u7247\u83b7\u53d6\u5bbd\u3001\u9ad8\u3001\u989c\u8272\u901a\u9053\u4fe1\u606f\n    unsigned char *idata = stbi_load(inputPath.c_str(), &amp;iw, &amp;ih, &amp;n, 0);\n\n    int ow = iw / 2;\n    int oh = ih / 2;\n    auto *odata = (unsigned char *) malloc(ow * oh * n);\n\n    // \u6539\u53d8\u56fe\u7247\u5c3a\u5bf8\n    stbir_resize(idata, iw, ih, 0, odata, ow, oh, 0, STBIR_TYPE_UINT8, n, STBIR_ALPHA_CHANNEL_NONE, 0,\n                 STBIR_EDGE_CLAMP, STBIR_EDGE_CLAMP,\n                 STBIR_FILTER_BOX, STBIR_FILTER_BOX,\n                 STBIR_COLORSPACE_SRGB, nullptr\n    );\n\n    string outputPath = \"/Users/glumes/Pictures/output.png\";\n    // \u5199\u5165\u56fe\u7247\n    stbi_write_png(outputPath.c_str(), ow, oh, n, odata, 0);\n\n    stbi_image_free(idata);\n    stbi_image_free(odata);\n    return 0;\n}\n</code></pre> <p>\u8fd9\u4e2a\u4f8b\u5b50\u5f88\u7b80\u5355\u4e5f\u5f88\u5168\u9762\uff0c\u4e3b\u8981\u5c31\u662f\u52a0\u8f7d\u4e86\u4e00\u5f20\u56fe\u7247\uff0c\u5e76\u5c06\u5b83\u7684\u5bbd\u9ad8\u90fd\u7f29\u5c0f\u4e00\u500d\uff0c\u5e76\u4fdd\u5b58\u7f29\u5c0f\u540e\u56fe\u7247\u3002</p>","tags":["stb_image"]},{"location":"android/stb-image-introduce/#stb_image","title":"stb_image","text":"<p>\u9996\u5148\u662f\u8c03\u7528 <code>stbi_load</code> \u65b9\u6cd5\u53bb\u52a0\u8f7d\u56fe\u50cf\u6570\u636e\uff0c\u5e76\u83b7\u53d6\u76f8\u5173\u4fe1\u606f\u3002\u4f20\u5165\u7684\u53c2\u6570\u9664\u4e86\u56fe\u7247\u6587\u4ef6\u5730\u5740\uff0c\u8fd8\u6709\u5bbd\u3001\u9ad8\u3001\u989c\u8272\u901a\u9053\u4fe1\u606f\u7684\u5f15\u7528\u3002</p> <p>\u53d8\u91cf <code>n</code> \u5c31\u4ee3\u8868\u56fe\u7247\u7684\u989c\u8272\u901a\u9053\u503c\uff0c\u901a\u5e38\u6709\u5982\u4e0b\u7684\u60c5\u51b5\uff1a</p> <ul> <li>1 \uff1a \u7070\u5ea6\u56fe</li> <li>2 \uff1a \u7070\u5ea6\u56fe\u52a0\u900f\u660e\u5ea6  </li> <li>3 \uff1a \u7ea2\u7eff\u84dd RGB \u4e09\u8272\u56fe</li> <li>4 \uff1a \u7ea2\u7eff\u84dd\u52a0\u900f\u660e\u5ea6 RGBA \u56fe</li> </ul> <p>\u8fd4\u56de\u7684\u7ed3\u679c\u5c31\u662f\u56fe\u7247\u50cf\u7d20\u6570\u636e\u7684\u6307\u9488\u4e86\u3002</p> <p><code>stbi_load</code> \u4e0d\u4ec5\u4ec5\u652f\u6301 <code>png</code> \u683c\u5f0f\uff0c\u628a\u4e0a\u9762\u4f8b\u5b50\u4e2d\u7684\u56fe\u7247\u6539\u6210 <code>jpg</code> \u683c\u5f0f\u540e\u7f00\u7684\u4f9d\u65e7\u53ef\u884c\u3002</p> <p>\u5b83\u652f\u6301\u7684\u6240\u6709\u683c\u5f0f\u5982\u4e0b\uff1a</p> <ul> <li>png</li> <li>jpg</li> <li>tga</li> <li>bmp</li> <li>psd</li> <li>gif</li> <li>hdr</li> <li>pic</li> </ul> <p>\u683c\u5f0f\u867d\u591a\uff0c\u4e0d\u8fc7\u4e00\u822c\u7528\u5230 png \u548c jpg \u5c31\u597d\u4e86\u3002</p> <p>\u9664\u4e86\u4ece\u6587\u4ef6\u52a0\u8f7d\u56fe\u7247\uff0cstb_image \u8fd8\u652f\u6301\u4ece\u5185\u5b58\u4e2d\u52a0\u8f7d\u56fe\u7247\uff0c\u901a\u8fc7\u8be5\u65b9\u6cd5 <code>stbi_load_from_memory</code> \uff0c\u5728\u540e\u7eed\u6587\u7ae0\u4e2d\u4f1a\u7528\u5230\u5b83\u7684\u3002</p> <p>\u52a0\u8f7d\u5b8c\u56fe\u7247\u4e4b\u540e\uff0cstb_image \u8fd8\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684\u91ca\u653e\u65b9\u6cd5 <code>stbi_image_free</code>\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u628a <code>free</code> \u5c01\u88c5\u4e86\u4e00\u4e0b\u800c\u5df2\u3002</p>","tags":["stb_image"]},{"location":"android/stb-image-introduce/#sbt_image_resize","title":"sbt_image_resize","text":"<p>\u52a0\u8f7d\u5b8c\u56fe\u7247\u50cf\u7d20\u6570\u636e\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7 <code>stbir_resize</code> \u65b9\u6cd5\u6539\u53d8\u56fe\u7247\u7684\u5c3a\u5bf8\u3002</p> <p><code>stbir_resize</code> \u65b9\u6cd5\u53c2\u6570\u6709\u5f88\u591a\uff1a</p> <pre><code>STBIRDEF int stbir_resize(const void *input_pixels , int input_w , int input_h , int input_stride_in_bytes,\n                             void *output_pixels, int output_w, int output_h, int output_stride_in_bytes,\n                             stbir_datatype datatype,\n                             int num_channels, int alpha_channel, int flags,\n                             // stb \u4e2d\u63d0\u4f9b\u4e86\u591a\u79cd\u6a21\u5f0f\uff0c\u4f46\u662f\u4fee\u6539\u540e\u5e76\u6ca1\u6709\u89c1\u5f88\u660e\u663e\u7684\u6548\u679c\n                             stbir_edge edge_mode_horizontal, stbir_edge edge_mode_vertical, \n                             stbir_filter filter_horizontal,  stbir_filter filter_vertical,\n                             stbir_colorspace space, void *alloc_context)\n</code></pre> <p><code>stbir_edge</code> \u548c <code>stbir_filter</code> \u7c7b\u578b\u7684\u53c2\u6570\uff0cstb_image_resize \u63d0\u4f9b\u4e86\u591a\u79cd\u7c7b\u578b:</p> <pre><code>typedef enum\n{\n    STBIR_EDGE_CLAMP   = 1,\n    STBIR_EDGE_REFLECT = 2,\n    STBIR_EDGE_WRAP    = 3,\n    STBIR_EDGE_ZERO    = 4,\n} stbir_edge;\n\ntypedef enum\n{\n    STBIR_FILTER_DEFAULT      = 0,  // use same filter type that easy-to-use API chooses\n    STBIR_FILTER_BOX          = 1,  // A trapezoid w/1-pixel wide ramps, same result as box for integer scale ratios\n    STBIR_FILTER_TRIANGLE     = 2,  // On upsampling, produces same results as bilinear texture filtering\n    STBIR_FILTER_CUBICBSPLINE = 3,  // The cubic b-spline (aka Mitchell-Netrevalli with B=1,C=0), gaussian-esque\n    STBIR_FILTER_CATMULLROM   = 4,  // An interpolating cubic spline\n    STBIR_FILTER_MITCHELL     = 5,  // Mitchell-Netrevalli filter with B=1/3, C=1/3\n} stbir_filter;\n</code></pre> <p>\u4f46\u5b9e\u9645\u4e0a\u8c03\u6574\u4e0d\u540c\u7c7b\u578b\u7ec4\u5408\u5f97\u5230\u7684\u56fe\u7247\u5e76\u6ca1\u6709\u592a\u591a\u7684\u53d8\u5316 \u2511(\uffe3\u0414 \uffe3)\u250d\u3002</p> <p>\u771f\u6b63\u6709\u7528\u7684\u53ef\u80fd\u8fd8\u662f\u524d\u9762\u90a3\u51e0\u4e2a\u53c2\u6570\uff0c\u6307\u5b9a\u4e86\u8981\u5c06\u56fe\u7247\u7f29\u653e\u540e\u7684\u5bbd\u9ad8\u6570\u636e\u3002</p>","tags":["stb_image"]},{"location":"android/stb-image-introduce/#stb_image_write","title":"stb_image_write","text":"<p>\u6700\u540e\u5c31\u662f\u8c03\u7528 <code>stbi_write_png</code> \u65b9\u6cd5\u5c06\u50cf\u7d20\u6570\u636e\u5199\u5165\u6587\u4ef6\u4e2d\uff0c\u9664\u6b64\u4e4b\u5916\uff0cstb_image_write \u8fd8\u63d0\u4f9b\u4e86 <code>stbi_write_jpg</code> \u65b9\u6cd5\u6765\u4fdd\u5b58 jpg \u683c\u5f0f\u56fe\u7247\u3002</p> <p>\u6839\u636e\u4e24\u8005\u683c\u5f0f\u7684\u4e0d\u540c\uff0c\u65b9\u6cd5\u8c03\u7528\u7684\u53c2\u6570\u4e5f\u662f\u4e0d\u4e00\u6837\u7684\u3002</p> <pre><code>int stbi_write_jpg(char const *filename, int x, int y, int comp, const void *data, int quality)\n\nint stbi_write_png(char const *filename, int x, int y, int comp, const void *data, int stride_bytes)\n</code></pre>","tags":["stb_image"]},{"location":"android/stb-image-introduce/#_1","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u5173\u4e8e stb_image \u56fe\u50cf\u89e3\u7801\u5e93\u7684\u5c0f\u4ecb\u7ecd\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u5b83\u8fd8\u662f\u633a\u7b80\u5355\u6613\u7528\u7684\uff0c\u5728\u5e73\u5e38\u505a\u4e00\u4e9b Demo \u4ee5\u53ca\u9700\u8981\u5feb\u901f\u5b9e\u73b0\u3001\u9a8c\u8bc1\u529f\u80fd\u7684\u60c5\u51b5\u4e0b\u90fd\u53ef\u4ee5\u8003\u8651\u8003\u8651\u3002</p> <p>\u4f46\u662f\u5728\u4e00\u4e9b\u5927\u578b\u7684\u9879\u76ee\u4e2d\uff0c\u8fd8\u662f\u8981\u6df1\u601d\u719f\u8651\u4e00\u4e9b\uff0c\u4ece\u6027\u80fd\u65b9\u9762\u8003\u8651\uff0c\u5b83\u80af\u5b9a\u4e0d\u5982\u8001\u724c\u7684\u56fe\u50cf\u89e3\u7801\u5e93\u4e86\uff0c\u50cf <code>libjpeg-turbo</code> \u89e3\u7801\u7528\u5230\u4e86 <code>NEON</code> \u8fd9\u6837 SIMD \uff08\u5355\u6307\u4ee4\u6d41\u591a\u6570\u636e\u6d41\uff09\u7684\u64cd\u4f5c\uff0c\u624d\u662f\u5927\u578b\u9879\u76ee\u7684\u9996\u9009\u4e86\u3002</p>","tags":["stb_image"]},{"location":"android/stb-image-introduce/#_2","title":"\u53c2\u8003","text":"<p>\u5173\u4e8e stb_image \u5728 Android \u4e2d\u7684\u4f7f\u7528\u5b9e\u8df5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684\u9879\u76ee\uff1a</p> <p>https://github.com/glumes/InstantGLSL</p>","tags":["stb_image"]},{"location":"android/framework/android-start-activity-from-launcher-1/","title":"Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e00\uff09","text":"<p>\u5f53 Android \u7cfb\u7edf\u5728\u542f\u52a8\u65f6\uff0c\u4f1a\u626b\u63cf\u7cfb\u7edf\u7279\u5b9a\u76ee\u5f55\uff0c\u7136\u540e\u81ea\u52a8\u5b89\u88c5\u91cc\u9762\u7684 Android \u5e94\u7528\u7a0b\u5e8f\u3002\u5f53\u7cfb\u7edf\u542f\u52a8\u5b8c\u6210\u4e4b\u540e\uff0c\u4f1a\u542f\u52a8\u4e00\u4e2a Home \u5e94\u7528\u7a0b\u5e8f\u6765\u663e\u793a\u5b89\u88c5\u5728\u7cfb\u7edf\u4e2d\u7684 Android \u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u8fd9\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5c31\u662f Launcher \u5e94\u7528\uff0c\u4e5f\u5c31\u662f\u624b\u673a\u5c4f\u5e55\u4e0a\u663e\u793a\u7684\u5404\u79cd\u5e94\u7528\u56fe\u6807\uff0cLauncher \u662f Android \u7cfb\u7edf\u542f\u52a8\u7684\u7b2c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u800c\u5f53\u6211\u4eec\u70b9\u51fb\u5e94\u7528\u7a0b\u5e8f\u56fe\u6807\u65f6\uff0c\u4e5f\u5c31\u5f00\u542f\u4e86\u4ece Launcher \u542f\u52a8 Activity \u7684\u8fc7\u7a0b\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#_1","title":"\u8fc7\u7a0b\u6982\u8ff0","text":"<p>Activity \u5176\u5b9e\u4e5f\u8fd8\u662f Java \u91cc\u7684\u4e00\u4e2a\u7c7b\uff0c\u4f46\u662f\u5728 Android \u5f00\u53d1\u4e2d\u53ef\u4e0d\u80fd\u628a\u5b83\u5f53\u505a\u4e00\u4e2a\u666e\u901a\u7c7b\u6765\u5904\u7406\uff0c\u5b83\u53ef\u662f Android \u56db\u5927\u7ec4\u4ef6\u4e4b\u4e00\u3002</p> <p>Activity \u7684\u542f\u52a8\u662f\u7531 ActivityManagerService \u6765\u5b8c\u6210\u7684\uff0c\u7531\u4e8e Launcher \u7ec4\u4ef6\u3001Activity \u7ec4\u4ef6\u3001ActivityManagerService \u7ec4\u4ef6\u5206\u522b\u662f\u8fd0\u884c\u5728\u4e09\u4e2a\u4e0d\u540c\u7684\u8fdb\u7a0b\u4e2d\u7684\uff0c\u8fd9\u4e09\u4e2a\u8fdb\u7a0b\u7684\u901a\u4fe1\u662f\u901a\u8fc7 Binder \u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\u6765\u5b8c\u6210\u3002</p> <p>Launcher \u7ec4\u4ef6\u901a\u8fc7 ServiceManager \u5f97\u5230 ActivityManagerService \u7684\u4ee3\u7406\u5bf9\u8c61 Binder \uff0c\u901a\u8fc7\u5b83\u5411 ActivityManagerService \u53d1\u8d77\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8bf7\u6c42\uff0c\u540c\u65f6\u628a\u81ea\u5df1\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff08ActivityThread\uff09\u7684 Binder \u5bf9\u8c61\uff08ApplicationThread\uff09\u4f20\u9012\u7ed9 ActivityManagerService\uff0c\u4ee5\u4fbf ActivityManagerService \u8c03\u7528 Launcher \u7ec4\u4ef6\u7684\u65b9\u6cd5\u3002\u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u6709\u6765\u6709\u53bb\u7684\u53cc\u65b9\u901a\u4fe1\u673a\u5236\u3002</p> <p>Launcher \u7ec4\u4ef6\u542f\u52a8 Activity \u7684\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b\u6240\u793a\uff1a</p> <ol> <li>Launcher \u7ec4\u4ef6\u5411 ActivityManagerService \u7ec4\u4ef6\u53d1\u9001\u4e00\u4e2a\u542f\u52a8 Activity \u7ec4\u4ef6\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8bf7\u6c42\u3002 2ActivityManagerService \u9996\u5148\u5c06\u8981\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u7684\u4fe1\u606f\u4fdd\u5b58\u4e0b\u6765\uff0c\u7136\u540e\u518d\u5411 Launcher \u7ec4\u4ef6\u53d1\u9001\u4e00\u4e2a\u8fdb\u5165\u4e2d\u6b62\u72b6\u6001\uff08<code>onPause \u65b9\u6cd5</code>\uff09\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8bf7\u6c42\u3002</li> <li>Launcher \u7ec4\u4ef6\u8fdb\u5165\u5230\u4e2d\u6b62\u72b6\u6001\uff08<code>onPause \u65b9\u6cd5</code>\uff09\u4e4b\u540e\uff0c\u5c31\u4f1a\u5411 ActivityManagerService \u53d1\u9001\u4e00\u4e2a\u5df2\u8fdb\u5165\u4e2d\u6b62\u72b6\u6001\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8bf7\u6c42\uff0c\u4ee5\u4fbf ActivityManagerService \u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u542f\u52a8 Activity \u7ec4\u4ef6\u7684\u64cd\u4f5c\u3002</li> <li>ActivityManagerService \u4f1a\u68c0\u67e5\u5f53\u524d Activity \u7ec4\u4ef6\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u901a\u8fc7 Binder \u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\u6765\u8bf7\u6c42 Zygote \u8fdb\u7a0b\u5c06\u5f53\u524d\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u542f\u52a8\u8d77\u6765\u3002</li> <li>\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u542f\u52a8\u5b8c\u6bd5\u540e\uff0c\u5c31\u4f1a\u5411 ActivityManagerService \u53d1\u9001\u4e00\u4e2a\u542f\u52a8\u5b8c\u6210\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8bf7\u6c42\uff0c\u4ee5\u4fbf ActivityManagerService \u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u542f\u52a8 Activity \u7ec4\u4ef6\u7684\u64cd\u4f5c\u3002</li> <li>ActivityManagerService \u5c06\u7b2c\u4e8c\u6b65\u4fdd\u7559\u7684 Activity \u7ec4\u4ef6\u7684\u4fe1\u606f\u53d1\u9001\u7ed9\u7b2c\u56db\u6b65\u521b\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u4ee5\u4fbf\u5b83\u53ef\u4ee5\u5c06 Activity \u7ec4\u4ef6\u542f\u52a8\u8d77\u6765\u3002</li> </ol>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#_2","title":"\u4ee3\u7801\u8fc7\u7a0b\u5206\u6790","text":"","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#launcher-startactivitysafely","title":"Launcher \u7c7b\u7684 startActivitySafely() \u65b9\u6cd5","text":"<p>Launcher \u6bd5\u7adf\u662f\u4e00\u4e2a\u7cfb\u7edf\u5e94\u7528\uff0c\u5b83\u7684\u6e90\u4ee3\u7801\u4f4d\u4e8e <code>packages/apps/Launcher2/src/com/android/launcher2/Launcher.java</code> \u3002</p> <pre><code>/**\n * Default launcher application.\n */\npublic final class Launcher extends Activity\n        implements View.OnClickListener, OnLongClickListener, LauncherModel.Callbacks, View.OnTouchListener {\n</code></pre> <p>\u4ece\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230 Launcher \u7ee7\u627f\u81ea Activity\uff0c\u5e76\u4e14\u5b9e\u73b0\u4e86\u70b9\u51fb\u3001\u957f\u6309\u3001\u89e6\u6478\u7b49\u63a5\u53e3\u3002</p> <p>\u6240\u4ee5\u5728<code>onClick</code>\u65b9\u6cd5\u4e2d\u5c31\u80fd\u627e\u5230\u542f\u52a8 Activity \u7ec4\u4ef6\u7684\u8c03\u7528\u65b9\u6cd5 <code>startActivitySafely</code>\u3002\u5176\u4e2d<code>Intent</code>\u53c2\u6570\u5305\u542b\u4e86\u76f8\u5e94\u7684\u4fe1\u606f\u3002</p> <pre><code> boolean startActivitySafely(View v, Intent intent, Object tag) {\n        boolean success = false;\n        try {\n            // \u8c03\u7528 Launcher \u7c7b\u7684 startActivity \u51fd\u6570\uff0c\u4e0d\u662f Activity \u91cc\u9762\u7684\uff0c\u53c2\u6570\u5f62\u5f0f\u4e0d\u5bf9\u3002\n            success = startActivity(v, intent, tag);\n        } catch (ActivityNotFoundException e) {\n            Toast.makeText(this, R.string.activity_not_found, Toast.LENGTH_SHORT).show();\n            Log.e(TAG, \"Unable to launch. tag=\" + tag + \" intent=\" + intent, e);\n        }\n        return success;\n    }\n</code></pre> <p><code>startActivitySafely</code>\u51fd\u6570\u53c8\u8c03\u7528\u4e86 Launcher \u91cc\u9762\u5c01\u88c5\u7684 <code>startActivity(View view, Intent intent, Object tag)</code>\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#launcher-startactivity","title":"Launcher \u7c7b\u7684 startActivity() \u65b9\u6cd5","text":"<pre><code> boolean startActivity(View v, Intent intent, Object tag) {\n        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n        try {\n            // Only launch using the new animation if the shortcut has not opted out (this is a\n            // private contract between launcher and may be ignored in the future).\n            boolean useLaunchAnimation = (v != null) &amp;&amp;  \n                    !intent.hasExtra(INTENT_EXTRA_IGNORE_LAUNCH_ANIMATION);\n            // \u5b89\u5353\u591a\u7528\u6237\u76f8\u5173 UserHandle \n            UserHandle user = (UserHandle) intent.getParcelableExtra(ApplicationInfo.EXTRA_PROFILE);\n            LauncherApps launcherApps = (LauncherApps) // \n                    this.getSystemService(Context.LAUNCHER_APPS_SERVICE);\n            if (useLaunchAnimation) {  // \u662f\u5426\u4f7f\u7528\u542f\u52a8\u52a8\u753b\n                ActivityOptions opts = ActivityOptions.makeScaleUpAnimation(v, 0, 0,\n                        v.getMeasuredWidth(), v.getMeasuredHeight());\n                if (user == null || user.equals(android.os.Process.myUserHandle())) {\n                    // Could be launching some bookkeeping activity\n                    startActivity(intent, opts.toBundle()); // \u4f7f\u7528\u52a8\u753b\uff0c\u542f\u52a8Activity\n                } else {\n                    launcherApps.startMainActivity(intent.getComponent(), user,\n                            intent.getSourceBounds(),\n                            opts.toBundle());\n                }\n            } else {\n                if (user == null || user.equals(android.os.Process.myUserHandle())) {\n                    startActivity(intent);\n                } else {\n                    launcherApps.startMainActivity(intent.getComponent(), user,\n                            intent.getSourceBounds(), null);\n                }\n            }\n            return true;\n        } catch (SecurityException e) {\n            Toast.makeText(this, R.string.activity_not_found, Toast.LENGTH_SHORT).show();\n        }\n        return false;\n    }\n</code></pre> <p>\u7531\u4e8e\u542f\u52a8\u7684 Activity \u548c Launcher \u7ec4\u4ef6\u4e0d\u5728\u540c\u4e00\u8fdb\u7a0b\uff0c\u5219\u5728 Intent \u4e0a\u6dfb\u52a0\u4e86 <code>FLAG_ACTIVITY_NEW_TASK</code>\u7684 Flag \u542f\u52a8\u6807\u8bc6\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u5728\u65b0\u7684 <code>TASK</code>\u4e2d\u542f\u52a8\u3002</p> <p>\u542f\u52a8\u65f6\u4f1a\u5224\u65ad\u5f53\u524d Activity \u7ec4\u4ef6\u662f\u5426\u4f7f\u7528\u52a8\u753b\u6548\u679c\u3002\u5e76\u4e14\uff0cAndroid \u4e2d\u8fd8\u6709  <code>LAUNCHER_APPS_SERVICE</code> \u8fd9\u6837\u4e00\u4e2a Service \u7528\u6765\u542f\u52a8 Activity \u7ec4\u4ef6\u3002</p> <p>\u8fd9\u91cc\uff0c\u5047\u8bbe\u6ca1\u6709\u52a8\u753b\uff0c\u5e76\u4e14 user == null \u7684 if \u5224\u65ad\u6210\u7acb\uff0c\u5219\u76f4\u63a5\u8c03\u7528\u7236\u7c7b Activity \u7684 <code>startActivity(Intent intent)</code>\u65b9\u6cd5\u3002 <pre><code>@Override\n    public void startActivity(Intent intent) {\n        this.startActivity(intent, null);\n    }\n</code></pre> \u6700\u7ec8\u8c03\u7528\u4e86\u7236\u7c7b Activity \u7684<code>startActivity(Intent intent, @Nullable Bundle options)</code>\u65b9\u6cd5\u3002</p> <pre><code> @Override\n    public void startActivity(Intent intent, @Nullable Bundle options) {\n        if (options != null) {\n            startActivityForResult(intent, -1, options);\n        } else {\n            startActivityForResult(intent, -1); // \u65b9\u6cd5\u5185\u8c03\u7528\u7684\u4e5f\u662f\u4e0a\u4e00\u79cd\u65b9\u6cd5\u5f62\u5f0f\uff0c\u53ea\u662f options \u4e3a null \n        }\n    }\n</code></pre>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#activity-startactivityforresult","title":"Activity \u7c7b\u7684 startActivityForResult() \u65b9\u6cd5","text":"<p>\u7531\u4e8e\u4e4b\u524d\u5047\u8bbe\u7684 options \u53c2\u6570\u4e3a null\uff0c\u5219\u76f4\u63a5\u8c03\u7528<code>startActivityForResult(intent, -1)</code>\uff0c\u65b9\u6cd5\u539f\u578b\u5982\u4e0b\uff1a <pre><code>public void startActivityForResult(Intent intent, int requestCode) {\n        startActivityForResult(intent, requestCode, null);\n    }\n</code></pre></p> <p>\u8fd9\u91cc\u9762\u8c03\u7528\u7684\u4e5f\u662f<code>startActivityForResult</code>\uff0c\u53ea\u4e0d\u8fc7\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a null \u4e86\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u7684 options \u53c2\u6570\u3002 \u53ea\u6709\u5f53\u8bf7\u6c42\u7801 <code>requestCode &gt;=0</code>\uff0c\u624d\u4f1a\u6267\u884c\u8c03\u7528\u8005\u7684 <code>onActivityResult()</code>\u65b9\u6cd5\uff0c\u8fd9\u91cc\u4e3a -1 \uff0c\u4e0d\u4f1a\u3002 <pre><code>public void startActivityForResult(Intent intent, int requestCode, @Nullable Bundle options) {\n        if (mParent == null) {\n            Instrumentation.ActivityResult ar =\n                mInstrumentation.execStartActivity(\n                    this, mMainThread.getApplicationThread(), mToken, this,\n                    intent, requestCode, options);\n            if (ar != null) {\n                mMainThread.sendActivityResult(\n                    mToken, mEmbeddedID, requestCode, ar.getResultCode(),\n                    ar.getResultData());\n            }\n            if (requestCode &gt;= 0) {\n                mStartedActivity = true;\n            }\n            cancelInputsAndStartExitTransition(options);\n        } else {\n            // \u7531\u4e8e\u7b2c\u4e00\u6b21\u4ece Launcher \u542f\u52a8 Activity \uff0cmParent \u4e3a null \u3002\n        }\n    }\n</code></pre> \u5728 if \u5224\u65ad\u91cc\u9762\u6267\u884c\u4e86 <code>Instrumentation</code> \u7c7b\u7684<code>execStartActivity</code>\u65b9\u6cd5\u3002</p> <p><code>Instrumentation</code> \u7c7b\u4f1a\u5728\u5e94\u7528\u7684\u4efb\u4f55\u4ee3\u7801\u6267\u884c\u524d\u88ab\u5b9e\u5217\u5316\uff0c\u662f\u7528\u6765\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u548c\u7cfb\u7edf\u4e4b\u95f4\u7684\u4ea4\u4e92\u64cd\u4f5c\u3002</p> <p>\u65b9\u6cd5\u539f\u578b\u4e3a\uff1a <pre><code>    public ActivityResult execStartActivity(\n            Context who, IBinder contextThread, IBinder token, Activity target,\n            Intent intent, int requestCode, Bundle options) {\n</code></pre></p> <p>\u8fd9\u91cc\u6bd4\u8f83\u91cd\u8981\u7684\u5c31\u662f\u91cc\u9762\u4f20\u5165\u7684\u53c2\u6570\u4e86\uff0c\u4e4b\u524d\u7684\u53c2\u6570\u90fd\u662f Intent \u9644\u5e26\u7684 Activity \u7ec4\u4ef6\u7684\u4fe1\u606f\u3002</p> <p>\u4e00\u4e00\u5bf9\u5e94\u5982\u4e0b\uff1a</p> \u53c2\u6570\u7c7b\u578b \u5b9e\u9645\u53c2\u6570 \u542b\u4e49 Context who this Context \u7c7b IBinder contextThread mMainThread.getApplicationThread() \u81ea\u5df1\u7684Binder\u672c\u5730\u5bf9\u8c61 IBinder token mToken ActivityManagerService \u4e2d\u7684ActivityRecord \u4ee3\u7406\u5bf9\u8c61 Activity target this \u76ee\u6807 Intent intent intent \u7ec4\u4ef6\u4fe1\u606f int requestCode requestCode \u8bf7\u6c42\u7801 Bundle options options \u9644\u4ef6\u4fe1\u606f <p>\u5176\u4e2d\uff0coptions\u3001requestCode\u3001intent\u3001who \u53c2\u6570\u90fd\u6bd4\u8f83\u597d\u7406\u89e3\u3002</p> <p>\u800c contextThread \u53c2\u6570\u662f\u4e00\u4e2a <code>IBinder</code> \u7c7b\u578b\uff0c\u5b9e\u9645\u53c2\u6570\u4e3a<code>mMainThread.getApplicationThread()</code>\u3002</p> <p>\u5176\u5b9e <code>mMainThread</code> \u7684\u7c7b\u578b\u4e3a <code>ActivityThread</code>\uff0c\u7528\u6765\u63cf\u8ff0\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u5b83\u5e76\u4e0d\u662f\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u662f\u4e00\u4e2a <code>final</code> \u7c7b\u578b\u7684\u7c7b\u3002</p> <p>\u7cfb\u7edf\u6bcf\u5f53\u542f\u52a8\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u65f6\uff0c\u90fd\u4f1a\u5728\u5b83\u91cc\u9762\u52a0\u8f7d\u4e00\u4e2a <code>ActivityThread</code>\u7c7b\u5b9e\u4f8b\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e2a <code>ActivityThread</code>\u7c7b\u5b9e\u4f8b\u4fdd\u5b58\u5728\u6bcf\u4e00\u4e2a\u5728\u8be5\u8fdb\u7a0b\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u7684\u7236\u7c7b Activity \u7684\u6210\u5458\u53d8\u91cf <code>mMainThread</code>\u4e2d\u3002</p> <p>\u800c<code>ActivityThread</code>\u7c7b\u7684\u6210\u5458\u51fd\u6570<code>getApplicationThread()</code>\u7528\u6765\u83b7\u53d6\u5b83\u5185\u90e8\u7684\u4e00\u4e2a\u7c7b\u578b\u4e3a<code>ApplicationThread</code>\u7684<code>Binder\u672c\u5730\u5bf9\u8c61</code>\u3002</p> <p><pre><code>private class ApplicationThread extends ApplicationThreadNative {}\npublic abstract class ApplicationThreadNative extends Binder implements IApplicationThread {}\n</code></pre> <code>ApplicationThread</code>\u7c7b\u662f\u4e00\u4e2a Binder \u7c7b\uff0c\u90a3\u4e48\u5b83\u7684\u4f5c\u7528\u662f\u7528\u6765\u4e0e ActivityManagerService \u901a\u4fe1\u7684\u3002</p> <p>\u4e4b\u524d\u5728 Binder \u5b66\u4e60\u7684\u65f6\u5019\uff0cbindService \u64cd\u4f5c\u4f1a\u5728 onServiceConnected \u8fd4\u56de Service \u7684\u4e00\u4e2a Binder \u5bf9\u8c61\uff0c\u901a\u8fc7\u8be5 Binder \u5bf9\u8c61\u4fbf\u53ef\u4ee5\u6267\u884c Service \u4e2d\u7684\u51fd\u6570\uff0c\u6b64\u65f6\u4fbf\u5b8c\u6210\u7684\u4e86 Activity \u4e0e Service \u7684\u901a\u4fe1\u3002\u800c\u73b0\u5728\uff0c\u6211\u4eec\u5728 execStartActivity() \u65b9\u6cd5\u4e2d\u628a\u81ea\u5df1\u7684 Binder \u5bf9\u8c61\u4f20\u9012\u7ed9 ActivityManagerService\uff0c\u4e0d\u5c31\u662f\u76f8\u5f53\u4e8e onServiceConnected \u4e2d\u56de\u8c03 Binder \u4e86\u561b\u3002\u6709\u4e86\u8fd9\u4e2a Binder \u5bf9\u8c61\uff0cActivityManagerService \u624d\u80fd\u591f\u901a\u77e5 Launcher \u7ec4\u4ef6\u8fdb\u5165 <code>Paused</code> \u72b6\u6001\u3002</p> <p><code>mToken</code>\u7c7b\u4e5f\u662f\u4e00\u4e2a Binder \u7c7b\u578b\uff0c\u5b83\u662f\u4e00\u4e2a <code>Binder\u4ee3\u7406\u5bf9\u8c61</code>\uff0c\u5b83\u6307\u5411\u4e86 ActivityManagerService \u4e2d\u4e00\u4e2a\u7c7b\u578b\u4e3a <code>ActivityRecord</code>\u7684 <code>Binder\u672c\u5730\u5bf9\u8c61</code>\u3002\u6bcf\u4e00\u4e2a\u5df2\u7ecf\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u5728 ActivityManagerService \u4e2d\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684<code>ActivityRecord</code>\u5bf9\u8c61\uff0c\u7528\u6765\u7ef4\u62a4\u5bf9\u5e94\u7684 Activity \u7ec4\u4ef6\u7684\u8fd0\u884c\u72b6\u6001\u3002\u5c06\u5b83\u4f20\u9012\u7ed9 ActivityManagerService\uff0c\u4ee5\u4fbf ActivityManagerService \u83b7\u5f97 Launcher \u7ec4\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\u4e86\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#instrumentation-execstartactivity","title":"Instrumentation \u7c7b\u7684 execStartActivity() \u65b9\u6cd5","text":"<pre><code>    public ActivityResult execStartActivity(\n            Context who, IBinder contextThread, IBinder token, Activity target,\n            Intent intent, int requestCode, Bundle options) {\n        IApplicationThread whoThread = (IApplicationThread) contextThread;\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n        try {\n            intent.migrateExtraStreamToClipData();\n            intent.prepareToLeaveProcess();\n            int result = ActivityManagerNative.getDefault()\n                .startActivity(whoThread, who.getBasePackageName(), intent,\n                        intent.resolveTypeIfNeeded(who.getContentResolver()),\n                        token, target != null ? target.mEmbeddedID : null,\n                        requestCode, 0, null, options);\n            checkStartActivityResult(result, intent);\n        } catch (RemoteException e) {\n            throw new RuntimeException(\"Failure from system\", e);\n        }\n        return null;\n    }\n</code></pre> <p>Intent \u6267\u884c\u4e86\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\u540e\uff0c\u4fbf\u8c03\u7528 ActivityManagerService \u7684\u4ee3\u7406\u5bf9\u8c61\u7684 <code>startActivity</code>\u65b9\u6cd5\u4e86\u3002</p> <p>ActivityManagerNative.getDefault() \u65b9\u6cd5\u8fd4\u56de\u7684\u5c31\u662f ActivityManagerService \u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u4ee3\u7406\u5bf9\u8c61\u7684\u83b7\u53d6\u5728\u4e4b\u524d Binder \u5b66\u4e60\u7684\u6587\u7ae0\u4e2d\u5df2\u7ecf\u4e86\u89e3\u8fc7\u4e86\u3002</p> <pre><code>public abstract class ActivityManagerNative extends Binder implements IActivityManager{\n\n    static public IActivityManager asInterface(IBinder obj) {\n        if (obj == null) {\n            return null;\n        }\n        IActivityManager in =\n            (IActivityManager)obj.queryLocalInterface(descriptor);\n        if (in != null) {\n            return in;\n        }\n\n        return new ActivityManagerProxy(obj);\n    }\n\n    static public IActivityManager getDefault() {\n        return gDefault.get();\n    }\n\n    private static final Singleton&lt;IActivityManager&gt; gDefault = new Singleton&lt;IActivityManager&gt;() {\n        protected IActivityManager create() {\n        // \u901a\u8fc7 ServiceManager \u6765\u83b7\u5f97 ActivityServiceManager \u7684\u4ee3\u7406\u5bf9\u8c61\u3002\n        // \u518d\u901a\u8fc7 asInterface \u65b9\u6cd5\u5224\u65ad\u662f\u5426\u4e3a\u540c\u4e00\u8fdb\u7a0b\uff0c\u4e0d\u662f\uff0c\u5219\u5c01\u88c5\u6210 ActivityManagerProxy \u4ee3\u7406\u5bf9\u8c61\u3002\n        // ActivityManagerProxy \u4ee3\u7406\u5bf9\u8c61\u7684\u64cd\u4f5c\u90fd\u662f\u7531 ActivityServiceManager \u7684\u4ee3\u7406\u5bf9\u8c61 Binder \u6765\u5b8c\u6210\u7684\u3002\n        // ActivityManagerProxy \u53ea\u662f\u5728\u4e4b\u4e0a\u5bf9\u6570\u636e\u5c01\u88c5\u4e86\u4e00\u5c42\u3002\n            IBinder b = ServiceManager.getService(\"activity\");\n            if (false) {\n                Log.v(\"ActivityManager\", \"default service binder = \" + b);\n            }\n            IActivityManager am = asInterface(b);\n            if (false) {\n                Log.v(\"ActivityManager\", \"default service = \" + am);\n            }\n            return am;\n        }\n    };\n}\n</code></pre> <p>\u5728 ActivityManagerNative \u4e2d\u8fd8\u770b\u5230\u4e86\u4e00\u4e2a\u6709\u610f\u601d\u7684\u5355\u4f8b\u5199\u6cd5\uff1a <pre><code>public abstract class Singleton&lt;T&gt; {\n    private T mInstance;\n    protected abstract T create();\n    public final T get() {\n        synchronized (this) {\n            if (mInstance == null) {\n                mInstance = create();\n            }\n            return mInstance;\n        }\n    }\n}\n</code></pre></p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#activitymanagerproxy-startactivity","title":"ActivityManagerProxy \u7c7b\u7684 startActivity() \u65b9\u6cd5","text":"<p>Instrumentation \u7c7b\u7684 execStartActivity() \u65b9\u6cd5\u6700\u7ec8\u8c03\u7528\u4e86ActivityManagerProxy \u7c7b\u7684 startActivity() \u65b9\u6cd5\uff0c\u7531 ActivityManagerService \u7684\u4ee3\u7406\u5bf9\u8c61 Binder \u53bb\u53d1\u8d77\u7c7b\u578b\u4e3a START_ACTIVITY_TRANSACTION \u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8bf7\u6c42\u3002\u53c2\u6570\u4fe1\u606f\u5982\u6ce8\u91ca\u6240\u793a\uff1a <pre><code>    public int startActivity(IApplicationThread caller, String callingPackage, Intent intent,\n            String resolvedType, IBinder resultTo, String resultWho, int requestCode,\n            int startFlags, ProfilerInfo profilerInfo, Bundle options) throws RemoteException {\n        Parcel data = Parcel.obtain();\n        Parcel reply = Parcel.obtain();\n        data.writeInterfaceToken(IActivityManager.descriptor);\n        // caller \u53c2\u6570\u4e3a Launcher \u7ec4\u4ef6\u6240\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u7684 ApplicationThread Binder \u672c\u5730\u5bf9\u8c61\u3002\n        data.writeStrongBinder(caller != null ? caller.asBinder() : null); \n        // Launcher \u7ec4\u4ef6\u7684\u5305\u540d\n        data.writeString(callingPackage);\n        // \u9700\u8981\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u7684\u4fe1\u606f\n        intent.writeToParcel(data, 0);\n        data.writeString(resolvedType);\n        // ActivityManagerService \u5185\u90e8\u7684 ActivityRecord \u5bf9\u8c61\uff0c\u4fdd\u5b58\u4e86 Launcher \u7ec4\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\n        data.writeStrongBinder(resultTo);\n        data.writeString(resultWho);\n        data.writeInt(requestCode);\n        data.writeInt(startFlags);\n        if (profilerInfo != null) {\n            data.writeInt(1);\n            profilerInfo.writeToParcel(data, Parcelable.PARCELABLE_WRITE_RETURN_VALUE);\n        } else {\n            data.writeInt(0);\n        }\n        if (options != null) {\n            data.writeInt(1);\n            options.writeToParcel(data, 0);\n        } else {\n            data.writeInt(0);\n        }\n        mRemote.transact(START_ACTIVITY_TRANSACTION, data, reply, 0);\n        reply.readException();\n        int result = reply.readInt();\n        reply.recycle();\n        data.recycle();\n        return result;\n    }\n</code></pre></p> <p>\u4ee5\u4e0a\u4e94\u6b65\uff0c\u5c31\u5b8c\u6210\u4e86\u542f\u52a8\u4e00\u4e2a Activity \uff0c\u5728 Launcher \u7ec4\u4ef6\u4e2d\u7684\u6b65\u9aa4\uff0c\u8fd9\u4e94\u6b65\u90fd\u5728 Launcher \u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5185\u6267\u884c\u7684\u3002</p> <p>\u5269\u4e0b\u7684\u6b65\u9aa4\u5c06\u4f1a\u5728 ActivityManagerService \u8fdb\u7a0b\u53bb\u6267\u884c\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#_3","title":"\u6d89\u53ca\u5230\u7684\u5176\u4ed6\u7c7b","text":"<ul> <li>UserHandle</li> <li>LauncherApps</li> <li>ActivityOptions</li> <li>Instrumentation<ul> <li>\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u548c\u7cfb\u7edf\u4e4b\u95f4\u7684\u4ea4\u4e92\u64cd\u4f5c</li> </ul> </li> <li>ActivityRecord <ul> <li>\u7ef4\u62a4 Activity \u7ec4\u4ef6\u7684\u8fd0\u884c\u72b6\u6001</li> </ul> </li> <li>ActivityThread<ul> <li>\u8868\u793a Android \u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b</li> </ul> </li> <li>ApplicationThread<ul> <li>Binder \u7c7b\u578b\u53d8\u91cf\uff0c\u7528\u6765\u548c ActivityManagerService \u901a\u4fe1</li> </ul> </li> </ul>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-1/#_4","title":"\u53c2\u8003","text":"<ol> <li>Android 6.0 \u6e90\u7801</li> <li>\u300aAndroid \u7cfb\u7edf\u6e90\u4ee3\u7801\u60c5\u666f\u5206\u6790\u300b</li> </ol>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/","title":"Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e8c\uff09","text":"<p>\u5728 Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e00\uff09 \u5206\u6790\u5b8c\u4e86 Launcher \u7ec4\u4ef6\u4e2d\u542f\u52a8\u7684\u6b65\u9aa4\uff0c\u63a5\u4e0b\u6765\u7684\u73af\u8282\u662f\u8be5 ActivityManagerService \u51fa\u573a\u4e86\u3002</p> <p>\u901a\u8fc7 ActivityManagerNative.getDefault() \u65b9\u6cd5\u5f97\u5230 ActivityManagerService \u7684\u4ee3\u7406\u5bf9\u8c61\u540e\u6267\u884c\u7684 startActivity \u65b9\u6cd5\uff0c\u6700\u7ec8\u4f1a\u53d1\u8d77\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8bf7\u6c42\uff0c\u901a\u8fc7 Binder \u9a71\u52a8\uff0c\u518d\u8c03\u7528 ActivityManagerService \u4e2d\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitymanagerservice-startactivity","title":"ActivityManagerService \u7c7b\u7684 startActivity()\u65b9\u6cd5","text":"<pre><code> @Override\n    public final int startActivity(IApplicationThread caller, String callingPackage,\n            Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode,\n            int startFlags, ProfilerInfo profilerInfo, Bundle options) {\n        return startActivityAsUser(caller, callingPackage, intent, resolvedType, resultTo,\n            resultWho, requestCode, startFlags, profilerInfo, options,\n            UserHandle.getCallingUserId());\n    }\n</code></pre> <p>\u663e\u7136\uff0c\u6700\u540e\u8c03\u7528\u4e86 <code>startActivityAsUser</code> \u65b9\u6cd5\uff1a</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitymanagerservice-startactivityasuser","title":"ActivityManagerService \u7c7b\u7684 startActivityAsUser()\u65b9\u6cd5","text":"<p><pre><code>@Override\n    public final int startActivityAsUser(IApplicationThread caller, String callingPackage,\n            Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode,\n            int startFlags, ProfilerInfo profilerInfo, Bundle options, int userId) {\n        // \u76f8\u5173\u9a8c\u8bc1\u8fc7\u7a0b\n        enforceNotIsolatedCaller(\"startActivity\");\n        userId = handleIncomingUser(Binder.getCallingPid(), Binder.getCallingUid(), userId,\n                false, ALLOW_FULL_ONLY, \"startActivity\", null);\n        // \n        return mStackSupervisor.startActivityMayWait(caller, -1, callingPackage, intent,\n                resolvedType, null, null, resultTo, resultWho, requestCode, startFlags,\n                profilerInfo, null, null, options, false, userId, null, null);\n    }\n</code></pre> \u5728 <code>startActivityAsUser</code>\u5148\u662f\u6267\u884c\u4e86\u76f8\u5173\u7684\u9a8c\u8bc1\u8fc7\u7a0b\uff0c\u7136\u540e\u8c03\u7528\u4e86\u7c7b\u578b\u4e3a <code>ActivityStackSupervisor</code>\u7684<code>mStackSupervisor</code>\u7684<code>startActivityMayWait()</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitystacksupervisor-startactivitymaywait","title":"ActivityStackSupervisor \u7c7b\u7684 startActivityMayWait() \u65b9\u6cd5","text":"<p>Android \u4e2d\u7684 Activity \u7ec4\u4ef6\u5806\u6808\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f Task\uff0c\u662f\u7528 <code>ActivityStack</code> \u7c7b\u7ba1\u7406\u7684\uff0c\u800c<code>ActivityStackSupervisor</code>\u5219\u662f\u4e00\u4e2a\u7ba1\u7406\u6240\u6709\u7684<code>ActivityStack</code>\u7684\u7c7b\u3002</p> <pre><code>    final int startActivityMayWait(IApplicationThread caller, int callingUid,\n            String callingPackage, Intent intent, String resolvedType,\n            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,\n            IBinder resultTo, String resultWho, int requestCode, int startFlags,\n            ProfilerInfo profilerInfo, WaitResult outResult, Configuration config,\n            Bundle options, boolean ignoreTargetSecurity, int userId,\n            IActivityContainer iContainer, TaskRecord inTask) {\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n\n        // Collect information about the target of the Intent.\n        // \u901a\u8fc7 PackageManagerService \u89e3\u6790 Intent \u53c2\u6570\u5185\u5bb9\uff0c\u83b7\u5f97\u66f4\u591a\u4fe1\u606f\uff0c\u4fdd\u5b58\u5230 ActivityInfo \u7c7b\u4e2d\n        ActivityInfo aInfo =\n                resolveActivity(intent, resolvedType, startFlags, profilerInfo, userId);\n\n        // \u7701\u7565\u90e8\u5206\u5173\u4e8e aInfo \u4ee3\u7801\n\n            int res = startActivityLocked(caller, intent, resolvedType, aInfo,\n                    voiceSession, voiceInteractor, resultTo, resultWho,\n                    requestCode, callingPid, callingUid, callingPackage,\n                    realCallingPid, realCallingUid, startFlags, options, ignoreTargetSecurity,\n                    componentSpecified, null, container, inTask);\n\n            Binder.restoreCallingIdentity(origId);\n            return res;\n        }\n    }\n\n// resolveActivity \u51fd\u6570\n    ActivityInfo resolveActivity(Intent intent, String resolvedType, int startFlags,\n            ProfilerInfo profilerInfo, int userId) {\n        // Collect information about the target of the Intent.\n        ActivityInfo aInfo;\n        try {\n            ResolveInfo rInfo =\n                AppGlobals.getPackageManager().resolveIntent(\n                        intent, resolvedType,\n                        PackageManager.MATCH_DEFAULT_ONLY\n                                    | ActivityManagerService.STOCK_PM_FLAGS, userId);\n            aInfo = rInfo != null ? rInfo.activityInfo : null;\n        } catch (RemoteException e) {\n            aInfo = null;\n        }\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n\n    }\n</code></pre> <p>\u9996\u5148\u4f1a\u5148\u8c03\u7528<code>resolveActivity</code>\u51fd\u6570\uff0c\u901a\u8fc7 PackageManagerService \u89e3\u6790 Intent \u5f97\u5230\u66f4\u591a\u4fe1\u606f\uff0c\u8fd4\u56de<code>ActivityInfo</code>\u5bf9\u8c61\u4e4b\u540e\uff0c\u4fbf\u6267\u884c <code>startActivityLocked</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitystacksupervisor-startactivitylocked","title":"ActivityStackSupervisor \u7c7b\u7684 startActivityLocked() \u65b9\u6cd5","text":"<pre><code>final int startActivityLocked(IApplicationThread caller,\n            Intent intent, String resolvedType, ActivityInfo aInfo,\n            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,\n            IBinder resultTo, String resultWho, int requestCode,\n            int callingPid, int callingUid, String callingPackage,\n            int realCallingPid, int realCallingUid, int startFlags, Bundle options,\n            boolean ignoreTargetSecurity, boolean componentSpecified, ActivityRecord[] outActivity,\n            ActivityContainer container, TaskRecord inTask) {\n        int err = ActivityManager.START_SUCCESS;\n        ProcessRecord callerApp = null;\n        if (caller != null) {\n            callerApp = mService.getRecordForAppLocked(caller); // \u5f97\u5230\u8c03\u7528\u8005\u7684 ProcessRecord\n            if (callerApp != null) {\n                callingPid = callerApp.pid;  // \u8c03\u7528\u8005\u7684 PID\n                callingUid = callerApp.info.uid; // \u8c03\u7528\u8005\u7684 UID \n            } else {\n                err = ActivityManager.START_PERMISSION_DENIED;\n            }\n        }\n\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801 \uff0c\u5f97\u5230\u63cf\u8ff0 Launcher \u7ec4\u4ef6\u7684 ActivityRecord \u5bf9\u8c61\uff0c\u4fdd\u5b58\u5728\u53d8\u91cf sourceRecord \u4e2d\n        ActivityRecord sourceRecord = null;\n        ActivityRecord resultRecord = null;\n        if (resultTo != null) {\n            sourceRecord = isInAnyStackLocked(resultTo);\n            if (DEBUG_RESULTS) Slog.v(TAG_RESULTS,\n                    \"Will send result to \" + resultTo + \" \" + sourceRecord);\n            if (sourceRecord != null) { \n            // \u4ece Launcher \u542f\u52a8\uff0crequestCode \u4e3a -1 \uff0c\u4e0b\u9762\u7684if\u4e0d\u6210\u7acb\uff0cresultRecord \u4e3a null \u3002\n                if (requestCode &gt;= 0 &amp;&amp; !sourceRecord.finishing) {\n                    resultRecord = sourceRecord;\n                }\n            }\n        }\n\n        // \u521b\u5efa\u7528\u6765\u63cf\u8ff0\u88ab\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u7684 ActivityRecord \u3002\n        ActivityRecord r = new ActivityRecord(mService, callerApp, callingUid, callingPackage, intent, resolvedType, aInfo, mService.mConfiguration, resultRecord, resultWho, requestCode, componentSpecified, voiceSession != null, this, container, options);\n\n        err = startActivityUncheckedLocked(r, sourceRecord, voiceSession, voiceInteractor,\n                startFlags, true, options, inTask);\n}\n\n// \u6839\u636e token \u627e\u5230\u5bf9\u5e94\u7684 ActivityRecord \u53d8\u91cf\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u6570\u7ec4\u53d8\u91cf\u91cc\u9762\u7684\u6bcf\u4e2a\u5143\u7d20\u53c8\u6301\u6709\u4e00\u4e2a\u6570\u7ec4\u3002\nActivityRecord isInAnyStackLocked(IBinder token) {\n        // mActivityDisplays \u53d8\u91cf\u7684\u7c7b\u578b\u4e3a SparseArray&lt;ActivityDisplay&gt;\n        int numDisplays = mActivityDisplays.size();\n        for (int displayNdx = 0; displayNdx &lt; numDisplays; ++displayNdx) {\n        // \u5185\u90e8\u6301\u6709\u4e00\u4e2a ArrayList&lt;ActivityStack&gt; \u7c7b\u578b\u7684\u53d8\u91cf mStacks\n            ArrayList&lt;ActivityStack&gt; stacks = mActivityDisplays.valueAt(displayNdx).mStacks;\n            for (int stackNdx = stacks.size() - 1; stackNdx &gt;= 0; --stackNdx) {\n                final ActivityRecord r = stacks.get(stackNdx).isInStackLocked(token);\n                if (r != null) {\n                    return r;\n                }\n            }\n        }\n        return null;\n    }\n</code></pre> <p>\u6bcf\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u90fd\u4f7f\u7528\u4e00\u4e2a <code>ProcessRecord</code>\u5bf9\u8c61\u6765\u63cf\u8ff0\uff0c\u5e76\u4e14\u4fdd\u5b58\u5728 ActivityManagerService \u5185\u90e8\u3002ActivityStackSupervisor \u7684 mService \u53d8\u91cf\u6307\u5411\u4e86ActivityManagerService \u3002\u901a\u8fc7\u5b83\u7684\u6210\u5458\u51fd\u6570<code>getRecordForAppLocked</code>\u6765\u83b7\u5f97\u53c2\u6570<code>caller</code>\u5bf9\u5e94\u7684\u4e00\u4e2a<code>ProcessRecord</code>\u5bf9\u8c61<code>callerApp</code>\u3002\u800c\u53c2\u6570<code>caller</code>\u6307\u5411\u7684\u662f Launcher \u7ec4\u4ef6\u6240\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u7684\u4e00\u4e2a ApplicationThread \u5bf9\u8c61\uff0c\u56e0\u6b64\uff0c<code>ProcessRecord</code>\u5bf9\u8c61 <code>callerApp</code>\u5b9e\u9645\u4e0a\u5c31\u6307\u5411\u4e86 Launcher \u7ec4\u4ef6\u6240\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u63a5\u7740\u5f97\u5230\u8fd9\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u7684 PID  \u548c UID \uff0c\u4fdd\u5b58\u5728\u53c2\u6570<code>callingPid</code>\u548c<code>callingUid</code>\u4e2d\u3002</p> <p>ActivityStackSupervisor \u53d8\u91cf\u5185\u90e8\u6709\u4e00\u4e2a\u53d8\u91cf mActivityDisplays\uff0c\u7c7b\u578b\u4e3a<code>SparseArray&lt;ActivityDisplay&gt;</code>,\u800c<code>ActivityDisplay</code>\u53d8\u91cf\u5185\u90e8\u53c8\u6301\u6709\u4e00\u4e2a<code>mStack</code>\u53d8\u91cf\uff0c\u7c7b\u578b\u4e3a<code>ArrayList&lt;ActivityStack&gt;</code>\uff0c\u901a\u8fc7\u627e\u5230Activity \u7ec4\u4ef6\u5806\u6808 <code>ActivityStack</code>\uff0c\u4ece\u800c\u5f97\u5230\u7528\u6765\u63cf\u8ff0<code>Launcher</code>\u7ec4\u4ef6\u7684<code>ActivityRecord</code>\u5bf9\u8c61\uff0c\u4fdd\u5b58\u5728\u53d8\u91cf<code>sourceRecord</code>\u4e2d\uff0c\u800c\u7531\u4e8e requestCode \u4e3a -1 \uff0c\u5219 <code>resultRecord</code>\u7ee7\u7eed\u4e3a null \u3002</p> <p>\u6700\u540e\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a ActivityRecord \u5bf9\u8c61<code>r</code>\u7528\u6765\u63cf\u8ff0\u5373\u5c06\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u3002</p> <p>\u73b0\u5728\uff0c\u5c31\u5df2\u7ecf\u5f97\u5230\u8bf7\u6c42\u542f\u52a8 Activity \u7ec4\u4ef6\u7684 Launcher ActivityRecord \u4fe1\u606f<code>sourceRecord</code>\u4ee5\u53ca\u9700\u8981\u542f\u52a8\u7684 Activity \u7684\u7ec4\u4ef6\u4fe1\u606f<code>r</code>\uff0c\u4e0b\u4e00\u6b65\u5c31\u6267\u884c<code>startActivityUncheckedLocked</code>\u64cd\u4f5c\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitystacksupervisor-startactivityuncheckedlocked","title":"ActivityStackSupervisor \u7c7b\u7684 startActivityUncheckedLocked() \u65b9\u6cd5","text":"<pre><code>final int startActivityUncheckedLocked(final ActivityRecord r, ActivityRecord sourceRecord,\n            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor, int startFlags, boolean doResume, Bundle options, TaskRecord inTask) {\n        final Intent intent = r.intent;\n        final int callingUid = r.launchedFromUid;\n        // \u5f97\u5230\u76ee\u6807 Activity \u7ec4\u4ef6\u7684\u542f\u52a8\u6807\u5fd7\u4f4d\n        int launchFlags = intent.getFlags(); \n\n        // We'll invoke onUserLeaving before onPause only if the launching\n        // activity did not explicitly state that this is an automated launch.\n        mUserLeaving = (launchFlags &amp; Intent.FLAG_ACTIVITY_NO_USER_ACTION) == 0;\n\n        boolean addingToTask = false; // \u662f\u5426\u5c06\u9700\u8981\u542f\u52a8\u7684 Activity \u6dfb\u52a0\u5230\u7ed9\u5b9a\u7684 task \u4e2d\n        TaskRecord reuseTask = null; // \n\n        // If the caller is not coming from another activity, but has given us an\n        // explicit task into which they would like us to launch the new activity,\n        // then let's see about doing that.\n        // \u5982\u679c\u8c03\u7528\u8005\n        if (sourceRecord == null &amp;&amp; inTask != null &amp;&amp; inTask.stack != null) {\n         // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n         // If task is empty, then adopt the interesting intent launch flags in to the\n         // activity being started.\n            if (root == null) {\n                final int flagsOfInterest = Intent.FLAG_ACTIVITY_NEW_TASK\n                        | Intent.FLAG_ACTIVITY_MULTIPLE_TASK | Intent.FLAG_ACTIVITY_NEW_DOCUMENT\n                        | Intent.FLAG_ACTIVITY_RETAIN_IN_RECENTS;\n                launchFlags = (launchFlags&amp;~flagsOfInterest)\n                        | (baseIntent.getFlags()&amp;flagsOfInterest);\n                intent.setFlags(launchFlags);\n                inTask.setIntent(r);\n                addingToTask = true;\n        }\n\n        // \u7701\u7565\u542f\u52a8 Activity \u5df2\u7ecf\u542f\u52a8\u8fc7\u7684\u60c5\u51b5\uff0c\u4e3b\u8981\u662f\u5c06 Activity \u79fb\u690d Task \u6808\u9876\n        // \u542f\u52a8\u4e00\u4e2a\u4ece\u672a\u542f\u52a8\u8fc7\u7684 Activity \n        boolean newTask = false; // \u8868\u793a\u5728\u4e00\u4e2a\u65b0\u7684 Task \u4e2d\u542f\u52a8 Activity\n        boolean keepCurTransition = false;\n\n        // Should this be considered a new task?\n        // \u662f\u5426\u8981\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Task \uff0c\u5f53\u7136\u662f\u8981\u7684\n        if (r.resultTo == null &amp;&amp; inTask == null &amp;&amp; !addingToTask\n                &amp;&amp; (launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_TASK) != 0) {\n            newTask = true;\n            targetStack = computeStackFocus(r, newTask);\n            targetStack.moveToFront(\"startingNewTask\");\n\n            if (reuseTask == null) {  // reuseTask \u4e3a null\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Task \n                r.setTask(targetStack.createTaskRecord(getNextTaskId(),\n                        newTaskInfo != null ? newTaskInfo : r.info,\n                        newTaskIntent != null ? newTaskIntent : intent,\n                        voiceSession, voiceInteractor, !launchTaskBehind /* toTop */),\n                        taskToAffiliate);\n                if (DEBUG_TASKS) Slog.v(TAG_TASKS,\n                        \"Starting new activity \" + r + \" in new task \" + r.task);\n            } else {\n                r.setTask(reuseTask, taskToAffiliate);\n            }\n            if (isLockTaskModeViolation(r.task)) {\n                Slog.e(TAG, \"Attempted Lock Task Mode violation r=\" + r);\n                return ActivityManager.START_RETURN_LOCK_TASK_MODE_VIOLATION;\n            }\n            if (!movedHome) {\n                if ((launchFlags &amp;\n                        (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_TASK_ON_HOME))\n                        == (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_TASK_ON_HOME)) {\n                    // Caller wants to appear on home activity, so before starting\n                    // their own activity we will bring home to the front.\n                    r.task.setTaskToReturnTo(HOME_ACTIVITY_TYPE);\n                }\n            }\n        } else if (sourceRecord != null) {\n            // \u4e0a\u9762\u7684 if \u5224\u65ad\u6210\u7acb\uff0c\u7701\u7565\u4ee3\u7801\n            // \u5728\u8c03\u7528\u8005\u7684 Task \u4e2d\u505a\u64cd\u4f5c \uff0cresumeTopActivityLocked \u65b9\u6cd5\n        } else if (inTask != null) {\n            // \u4e0a\u9762\u7684 if \u5224\u65ad\u6210\u7acb\uff0c\u7701\u7565\u4ee3\u7801\n            // \u5728\u6307\u5b9a\u7684 Task \u4e2d\u505a\u64cd\u4f5c\uff0c\n        } else {\n            // \u4e0a\u9762\u7684 if \u5224\u65ad\u6210\u7acb\uff0c\u7701\u7565\u4ee3\u7801\n        }\n\n        mService.grantUriPermissionFromIntentLocked(callingUid, r.packageName,\n                intent, r.getUriPermissionsLocked(), r.userId);\n\n        if (sourceRecord != null &amp;&amp; sourceRecord.isRecentsActivity()) {\n            r.task.setTaskToReturnTo(RECENTS_ACTIVITY_TYPE);\n        }\n        if (newTask) {\n            EventLog.writeEvent(EventLogTags.AM_CREATE_TASK, r.userId, r.task.taskId);\n        }\n        ActivityStack.logStartActivity(EventLogTags.AM_CREATE_ACTIVITY, r, r.task);\n        targetStack.mLastPausedActivity = null;\n        // \u542f\u52a8 Activity \u7ec4\u4ef6\u7684\u4e0b\u4e00\u6b65\n        targetStack.startActivityLocked(r, newTask, doResume, keepCurTransition, options);\n        if (!launchTaskBehind) {\n            // Don't set focus on an activity that's going to the back.\n            mService.setFocusedActivityLocked(r, \"startedActivity\");\n        }\n        return ActivityManager.START_SUCCESS;\n}\n</code></pre> <p>\u68c0\u67e5 launchFlags \u7684 <code>Intent.Flag_ACTIVITY_NO_USER_ACTION</code> \u662f\u5426\u7b49\u4e8e 1 \u3002\u5982\u679c\u7b49\u4e8e 1\uff0c\u5219\u8868\u793a\u76ee\u6807 Activity \u7ec4\u4ef6\u4e0d\u662f\u7531\u7528\u6237\u624b\u52a8\u542f\u52a8\u7684\u3002\u5982\u679c\u76ee\u6807 Activity \u7ec4\u4ef6\u662f\u7531\u7528\u6237\u624b\u52a8\u542f\u52a8\u7684\uff0c\u90a3\u4e48\u7528\u6765\u542f\u52a8\u5b83\u7684\u6e90 Activity \u5c31\u4f1a\u83b7\u5f97\u4e00\u4e2a\u7528\u6237\u79bb\u5f00\u4e8b\u4ef6\u901a\u77e5\u3002</p> <p>\u7531\u4e8e\u662f\u4ece Launcher \u542f\u52a8 Activity \u7ec4\u4ef6\uff0c\u5219 <code>Flag_ACTIVITY_NO_USER_ACTION</code>\u7b49\u4e8e 0 \uff0cmUserLeaving \u4e3a True \uff0c\u8868\u793a\u540e\u9762\u8981\u5411 Launcher \u7ec4\u4ef6\u53d1\u9001\u4e00\u4e2a\u7528\u6237\u79bb\u5f00\u4e8b\u4ef6\u901a\u77e5\u3002</p> <p>\u7531\u4e8e\u4ece Launcher \u542f\u52a8\u7684 Activity \u8fd0\u884c\u5728\u53e6\u4e00\u4e2a Task \u4e2d\uff0c\u5219 addingToTask \u4e3a <code>false</code> \uff0c\u540c\u65f6 <code>reuseTask</code>\u4e5f\u662f\u4e3a <code>null</code> \u7684\uff0c<code>inTask</code>\u4e3a <code>null</code>\uff0c\u5e76\u4e14 <code>r.resultTo</code>\u662f\u4e00\u4e2a ActivityRecord \u7c7b\u578b\uff0c\u7531\u4e8e Activity \u7ec4\u4ef6\u8fd8\u6ca1\u542f\u52a8\uff0c\u4e5f\u662f\u4e3a <code>null</code>\u3002\u6240\u4ee5\uff0c\u6700\u4e0a\u9762\u7684 if \u5224\u65ad\u6210\u7acb\uff0c\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Task \u4e86\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitystack-startactivitylocked","title":"ActivityStack \u7c7b\u7684 startActivityLocked() \u65b9\u6cd5","text":"<pre><code>    final void startActivityLocked(ActivityRecord r, boolean newTask,\n            boolean doResume, boolean keepCurTransition, Bundle options) {\n        TaskRecord rTask = r.task;\n        final int taskId = rTask.taskId;\n        // mLaunchTaskBehind tasks get placed at the back of the task stack.\n        if (!r.mLaunchTaskBehind &amp;&amp; (taskForIdLocked(taskId) == null || newTask)) {\n            // Last activity in task had been removed or ActivityManagerService is reusing task.\n            // Insert or replace.\n            // Might not even be in.\n            insertTaskAtTop(rTask, r);\n            mWindowManager.moveTaskToTop(taskId);\n        }\n\n         if (!newTask) {\n             // newTask \u4e3a true \uff0c\u7701\u7565\u90e8\u5206\u4ee3\u7801\n         }\n\n        // Place a new activity at top of stack, so it is next to interact\n        // with the user.\n\n        // If we are not placing the new activity frontmost, we do not want\n        // to deliver the onUserLeaving callback to the actual frontmost activity \n        // task \u53d8\u91cf\u4e3a null\uff0c\u5c1a\u672a\u8d4b\u503c\uff0c IF \u5224\u65ad\u4e0d\u6210\u7acb\n        if (task == r.task &amp;&amp; mTaskHistory.indexOf(task) != (mTaskHistory.size() - 1)) {\n            mStackSupervisor.mUserLeaving = false;\n            if (DEBUG_USER_LEAVING) Slog.v(TAG_USER_LEAVING,\n                    \"startActivity() behind front, mUserLeaving=false\");\n        }\n\n        task = r.task;\n        // Slot the activity into the history stack and proceed\n        if (DEBUG_ADD_REMOVE) Slog.i(TAG, \"Adding activity \" + r + \" to stack to task \" + task,\n                new RuntimeException(\"here\").fillInStackTrace());\n        task.addActivityToTop(r);\n        task.setFrontOfTask();\n         r.putInHistory();\n\n        // \u7701\u7565 Window \u6dfb\u52a0\u90e8\u5206\u4ee3\u7801\n        if (doResume) {\n            mStackSupervisor.resumeTopActivitiesLocked(this, r, options);\n        }\n    }\n// \u5c06 ActivityRecord \u6dfb\u52a0\u5230\u6808\u7684\u65b9\u6cd5\nvoid addActivityToTop(ActivityRecord r) {\n        addActivityAtIndex(mActivities.size(), r);\n}\n</code></pre> <p>\u5728\u4e0a\u4e00\u6b65\u4e2d\uff0c\u5df2\u7ecf\u901a\u8fc7 <code>r.setTask()</code>\u65b9\u6cd5\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684 Task\uff0c\u5e76\u4e14 <code>newTask</code>\u53d8\u91cf\u4e3a <code>true</code> \u3002\u5f53 Activity \u662f\u5728\u4e00\u4e2a\u65b0\u7684 Task \u4e2d\u542f\u52a8\u65f6\uff0c\u9700\u8981\u5c06\u5b83\u653e\u5230 TaskRecord \u7684\u4e2d\uff0c\u5e76\u4e14\u4f4d\u4e8e\u5806\u6808\u7684\u6700\u4e0a\u65b9\u3002</p> <p>\u5f53\u6dfb\u52a0\u5b8c\u4e4b\u540e\uff0c\u4fbf\u7ee7\u7eed\u6267\u884c <code>resumeTopActivitiesLocked</code> \u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitystacksupervisor-resumetopactivitieslocked","title":"ActivityStackSupervisor \u7c7b\u7684 resumeTopActivitiesLocked() \u65b9\u6cd5","text":"<p><pre><code>boolean resumeTopActivitiesLocked(ActivityStack targetStack, ActivityRecord target,\n            Bundle targetOptions) {\n        if (targetStack == null) {\n            targetStack = mFocusedStack;\n        }\n        // Do targetStack first.\n        boolean result = false;\n        if (isFrontStack(targetStack)) {\n            // \u8c03\u7528 ActivityStack \u7c7b\u7684 resumeTopActivityLocked \u65b9\u6cd5\n            result = targetStack.resumeTopActivityLocked(target, targetOptions);\n        }\n\n        for (int displayNdx = mActivityDisplays.size() - 1; displayNdx &gt;= 0; --displayNdx) {\n            final ArrayList&lt;ActivityStack&gt; stacks = mActivityDisplays.valueAt(displayNdx).mStacks;\n            for (int stackNdx = stacks.size() - 1; stackNdx &gt;= 0; --stackNdx) {\n                final ActivityStack stack = stacks.get(stackNdx);\n                if (stack == targetStack) {\n                    // Already started above.\n                    continue;\n                }\n                if (isFrontStack(stack)) {\n                    // \u8c03\u7528 ActivityStack \u7c7b\u7684 resumeTopActivityLocked \u65b9\u6cd5\uff0c\u53c2\u6570\u4e3a null\n                    stack.resumeTopActivityLocked(null);\n                }\n            }\n        }\n        return result;\n    }\n</code></pre> ActivityStackSupervisor \u7c7b\u91cd\u8f7d\u4e86\u4e24\u79cd\u5f62\u5f0f\u7684 <code>resumeTopActivitiesLocked</code>\u65b9\u6cd5\uff0c\u4e3b\u8981\u5c31\u662f\u5c06\u6240\u6709ActivityStack\u6808\u9876\u7684ActivityRecord\u8fc1\u79fb\u5230\u663e\u793a\u72b6\u6001\uff0c\u90fd\u662f\u8c03\u7528 <code>ActivityStack</code>\u7c7b\u7684<code>resumeTopActivityLocked</code>\u65b9\u6cd5\uff0c\u53ea\u4e0d\u8fc7\u53c2\u6570\u7565\u6709\u4e0d\u540c\u4e86\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitystack-resumetopactivitylocked","title":"ActivityStack \u7c7b\u7684 resumeTopActivityLocked() \u65b9\u6cd5","text":"<pre><code>final boolean resumeTopActivityLocked(ActivityRecord prev, Bundle options) {\n        if (mStackSupervisor.inResumeTopActivity) {\n            // Don't even start recursing.\n            return false;\n        }\n\n        boolean result = false;\n        try {\n            // Protect against recursion.\n            mStackSupervisor.inResumeTopActivity = true;\n            if (mService.mLockScreenShown == ActivityManagerService.LOCK_SCREEN_LEAVING) {\n                mService.mLockScreenShown = ActivityManagerService.LOCK_SCREEN_HIDDEN;\n                mService.updateSleepIfNeededLocked();\n            }\n            result = resumeTopActivityInnerLocked(prev, options);\n        } finally {\n            mStackSupervisor.inResumeTopActivity = false;\n        }\n        return result;\n    }\n</code></pre> <p>\u5728\u8be5\u65b9\u6cd5\u5185\u90e8\u6700\u540e\u8c03\u7528\u4e86<code>resumeTopActivityInnerLocked</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#activitystack-resumetopactivityinnerlocked","title":"ActivityStack \u7c7b\u7684 resumeTopActivityInnerLocked() \u65b9\u6cd5","text":"<pre><code>    private boolean resumeTopActivityInnerLocked(ActivityRecord prev, Bundle options) {\n         // Find the first activity that is not finishing.\n         // \u627e\u5230\u5f53\u524d ActivityRecord \u7684\u6808\u9876\uff0c\u6307\u5411\u4e86\u8981\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u3002\n        final ActivityRecord next = topRunningActivityLocked(null);\n        final TaskRecord prevTask = prev != null ? prev.task : null;\n\n        if (next == null) {\n            \u8fdb\u5165\u8be5\u5206\u652f\u8868\u793a\u6ca1\u6709\u8981\u542f\u52a8\u7684 Activity \u3002\n        }\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n        // If the top activity is the resumed one, nothing to do.\n        // \u68c0\u67e5\u8981\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u662f\u5426\u7b49\u4e8e\u5f53\u524d\u88ab\u6fc0\u6d3b\u7684 Activity \u7ec4\u4ef6\uff0c\u5982\u679c\u7b49\u4e8e\uff0c\u5e76\u4e14\u5904\u4e8e RESUMED \u72b6\u6001\uff0c\u76f4\u63a5\u8fd4\u56de\n        if (mResumedActivity == next &amp;&amp; next.state == ActivityState.RESUMED &amp;&amp;\n                    mStackSupervisor.allResumedActivitiesComplete()) {\n            // Make sure we have executed any pending transitions, since there\n            // should be nothing left to do at this point.\n            mWindowManager.executeAppTransition();\n            mNoAnimActivities.clear();\n            ActivityOptions.abort(options);\n            return false;\n        }\n\n        // If we are sleeping, and there is no resumed activity, and the top\n        // activity is paused, well that is the state we want.\n        // \u68c0\u67e5\u8981\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u662f\u5426\u7b49\u4e8e\u4e0a\u4e00\u6b21\u88ab\u4e2d\u6b62\u4e86\u7684 Activity \u7ec4\u4ef6\uff0c\u5982\u679c\u7b49\u4e8e\uff0c\n        // \u5e76\u4e14\u8fd9\u65f6\u5019\u7cfb\u7edf\u6b63\u8981\u8fdb\u5165\u5173\u673a\u6216\u7761\u7720\u72b6\u6001\uff0c\u5219\u76f4\u63a5\u9000\u51fa\uff0c\u542f\u52a8\u6beb\u65e0\u610f\u4e49\n        if (mService.isSleepingOrShuttingDown()\n                &amp;&amp; mLastPausedActivity == next\n                &amp;&amp; mStackSupervisor.allPausedActivitiesComplete()) {\n            // Make sure we have executed any pending transitions, since there\n            // should be nothing left to do at this point.\n            mWindowManager.executeAppTransition();\n            mNoAnimActivities.clear();\n            ActivityOptions.abort(options);\n            return false;\n        }\n\n        // If we are currently pausing an activity, then don't do anything until that is done.\n        // \u68c0\u67e5\u7cfb\u7edf\u4e2d\u6b62 Activity \u7ec4\u4ef6\u662f\u5426\u5b8c\u6210\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u4e86\uff0c\u7b49\u5f85\u6240\u6709\u7684 Activity \u8fdb\u5165\u4e2d\u6b62\u72b6\u6001\n        if (!mStackSupervisor.allPausedActivitiesComplete()) {\n            return false;\n        }\n\n        // We need to start pausing the current activity so the top one can be resumed...\n        // Launcher \u7ec4\u4ef6\u8fdb\u5165 onPause \u72b6\u6001\n        boolean dontWaitForPause = (next.info.flags&amp;ActivityInfo.FLAG_RESUME_WHILE_PAUSING) != 0;\n        boolean pausing = mStackSupervisor.pauseBackStacks(userLeaving, true, dontWaitForPause);\n        if (mResumedActivity != null) {\n        // mResumedActivity \u6307\u5411\u4e86 Launcher \u7ec4\u4ef6\uff0c\u4e0d\u4e3a null \uff0c\u5219\u4e2d\u6b62 Launcher \u7ec4\u4ef6\n            pausing |= startPausingLocked(userLeaving, false, true, dontWaitForPause);\n        }\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n\n        if (next.app != null &amp;&amp; next.app.thread != null) {\n            // \u5f85\u542f\u52a8\u7684 Activity \u5728\u65b0\u7684\u8fdb\u7a0b\u4e2d\uff0capp \u53d8\u91cf\u4e3a null \n        } else {\n            // \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\n            mStackSupervisor.startSpecificActivityLocked(next, true, true);\n        }\n\n    }\n</code></pre> <p>ActivityStack \u7c7b\u6709\u4e09\u4e2a\u6210\u5458\u53d8\u91cf\uff1a<code>mResumedActivity</code>\u3001<code>mLastPausedActivity</code>\u3001<code>mPausingActivity</code>\uff0c\u5b83\u4eec\u7684\u7c7b\u578b\u5747\u4e3a <code>ActivityRecord</code>\uff0c\u5206\u522b\u7528\u6765\u63cf\u8ff0\u7cfb\u7edf\u5f53\u524d\u6fc0\u6d3b\u7684 Activity \u7ec4\u4ef6\u3001\u4e0a\u4e00\u6b21\u88ab\u4e2d\u6b62\u7684 Activity \u7ec4\u4ef6\uff0c\u4ee5\u53ca\u6b63\u5728\u88ab\u4e2d\u6b62\u7684 Activity \u7ec4\u4ef6\u3002</p> <p>\u800c\u5728<code>resumeTopActivityInnerLocked</code>\u65b9\u6cd5\u4e2d\uff0c\u5f85\u5176\u7684 Activity \u7684 ActivityRecord \u5df2\u7ecf\u4f4d\u4e8e\u6808\u9876\u4e86\uff0c\u9700\u8981\u5c06\u5b83\u8fd0\u884c\u5230 <code>Resumed</code> \u72b6\u6001\uff0c\u800c\u5728\u8fd9\u4e4b\u524d\u9700\u8981\u5224\u65ad\u6ee1\u8db3\u5f88\u591a\u6761\u4ef6\uff0c\u6bd4\u5982\u5f53\u524d\u6240\u6709\u7684 Activity \u7ec4\u4ef6\u8981\u5904\u4e8e <code>onPaused</code>\u72b6\u6001\uff0cLauncher \u7ec4\u4ef6\u8981\u5904\u4e8e<code>onPaused</code>\u72b6\u6001\uff0c\u5426\u5219\u4f1a\u76f4\u63a5 return \u9000\u51fa\u4e86\u3002</p> <p>\u5f53\u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\u65f6\uff0c\u6700\u540e\u5c31\u662f\u5224\u65ad\u5f85\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u662f\u5426\u521b\u5efa\uff0c\u5982\u679c\u8fd8\u6ca1\u6709\uff0c\u5219\u901a\u8fc7<code>startSpecificActivityLocked</code>\u521b\u5efa\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u6765\u542f\u52a8 Activity \u7ec4\u4ef6\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#_1","title":"\u6d89\u53ca\u5230\u7684\u5176\u4ed6\u7c7b","text":"<ul> <li>ActivityStack</li> <li>ActivityStackSupervisor</li> <li>ActivityDisplay</li> <li>ActivityRecord</li> <li>ActivityInfo</li> <li>TaskRecord</li> </ul>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#_2","title":"\u53c2\u8003","text":"<p>1\u3001 Android 6.0 \u6e90\u7801  2\u3001\u300aAndroid \u7cfb\u7edf\u6e90\u4ee3\u7801\u60c5\u666f\u5206\u6790\u300b 3\u3001http://duanqz.github.io/2016-07-29-Activity-LaunchProcess-Part1</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-2/#_3","title":"\u7591\u95ee","text":"<ul> <li>Activity \u7684 \u5806\u6808 ActivityStack </li> </ul>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/","title":"Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e09\uff09","text":"<p>\u5728  Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e8c\uff09 \u5206\u6790\u5b8c\u4e86\u5bf9\u5f85\u542f\u52a8 Activity \u7ec4\u4ef6\u7684\u9a8c\u8bc1\u8fc7\u7a0b\uff0c\u83b7\u5f97\u7ec4\u4ef6\u4fe1\u606f\uff0c\u4ee5\u53ca ActivityRecord \u6dfb\u52a0\u81f3\u6808\u9876\uff0c\u5c06\u5176\u4ed6 Activity \u8fdb\u5165\u4e2d\u6b62\u72b6\u6001\uff0c\u6700\u540e\u5c06\u5f85\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u8fdb\u5165 <code>Resumed</code>\u72b6\u6001\uff0c\u7136\u800c\uff0c\u7531\u4e8e\u5f85\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5c1a\u672a\u542f\u52a8\uff0c\u6700\u540e\u6267\u884c <code>startSpecificActivityLocked</code>\u65b9\u6cd5\u521b\u5efa\u8fdb\u7a0b\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitystacksupervisor-startspecificactivitylocked","title":"ActivityStackSupervisor \u7c7b\u7684 startSpecificActivityLocked() \u65b9\u6cd5","text":"<p><pre><code> void startSpecificActivityLocked(ActivityRecord r,\n            boolean andResume, boolean checkConfig) {\n        // Is this activity's application already running?\n        ProcessRecord app = mService.getProcessRecordLocked(r.processName,\n                r.info.applicationInfo.uid, true);\n\n        r.task.stack.setLaunchTime(r);\n\n        if (app != null &amp;&amp; app.thread != null) {\n            try {\n                if ((r.info.flags&amp;ActivityInfo.FLAG_MULTIPROCESS) == 0\n                        || !\"android\".equals(r.info.packageName)) {\n                    app.addPackage(r.info.packageName, r.info.applicationInfo.versionCode,\n                            mService.mProcessStats);\n                }\n                realStartActivityLocked(r, app, andResume, checkConfig);\n                return;\n            } catch (RemoteException e) {\n            }\n        }\n        // \u8fdb\u7a0b\u5c1a\u672a\u542f\u52a8\uff0capp \u4e3a null \u3002\n        mService.startProcessLocked(r.processName, r.info.applicationInfo, true, 0,\n                \"activity\", r.intent.getComponent(), false, false, true);\n    }\n</code></pre> \u5728 ActivityManagerService \u4e2d\uff0c\u6bcf\u4e00\u4e2a Activity \u7ec4\u4ef6\u90fd\u6709\u4e00\u4e2a\u7528\u6237 ID \u548c\u4e00\u4e2a\u8fdb\u7a0b\u540d\u79f0\uff0c\u5176\u4e2d\uff0c\u7528\u6237 ID \u662f\u5728\u5b89\u88c5\u8be5 Activity \u7ec4\u4ef6\u65f6\u7531 PackageManagerService \u5206\u914d\u7684\uff0c\u800c\u8fdb\u7a0b\u540d\u79f0\u5219\u662f\u7531\u8be5 Activity \u7ec4\u4ef6\u7684 <code>android:process</code>\u5c5e\u6027\u6765\u51b3\u5b9a\u7684\u3002ActivityManagerService \u5728\u542f\u52a8\u4e00\u4e2a Activity \u7ec4\u4ef6\u65f6\uff0c\u9996\u5148\u4f1a\u4ee5\u5b83\u7684\u7528\u6237 ID \u548c\u8fdb\u7a0b\u540d\u79f0\u6765\u68c0\u67e5\u7cfb\u7edf\u4e2d\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u5bf9\u5e94\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u3002\u5982\u679c\u5b58\u5728\uff0c\u5c31\u4f1a\u76f4\u63a5\u901a\u77e5\u8fd9\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5c06 Activity \u7ec4\u4ef6\u542f\u52a8\u8d77\u6765\uff1b\u5426\u5219\uff0c\u5c31\u4f1a\u5148\u4ee5\u8fd9\u4e2a\u7528\u6237 ID \u548c\u8fdb\u7a0b\u540d\u79f0\u6765\u521b\u5efa\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u7136\u540e\u5728\u901a\u77e5\u8fd9\u4e2a\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5c06\u8be5 Activity \u7ec4\u4ef6\u542f\u52a8\u8d77\u6765\u3002</p> <p>\u7531\u4e8e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5c1a\u672a\u542f\u52a8\uff0c\u5219 app \u4e3a null \uff0cmService \u53d8\u91cf\u4e3a ActivityManagerService \u3002\u6267\u884c <code>startProcessLocked</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitymanagerservice-startprocesslocked","title":"ActivityManagerService\u7c7b\u7684 startProcessLocked() \u65b9\u6cd5","text":"<pre><code> final ProcessRecord startProcessLocked(String processName, ApplicationInfo info,\n            boolean knownToBeDead, int intentFlags, String hostingType, ComponentName hostingName,\n            boolean allowWhileBooting, boolean isolated, int isolatedUid, boolean keepIfLarge,\n            String abiOverride, String entryPoint, String[] entryPointArgs, Runnable crashHandler) {\n        long startTime = SystemClock.elapsedRealtime();\n        ProcessRecord app;\n        if (!isolated) { // \u4f20\u5165\u7684 isolated \u53c2\u6570\u4e3a false \uff0cif \u6210\u7acb\uff0c\u5e76\u4e0d\u662f\u9694\u79bb\u7684\u8fdb\u7a0b\n            // \u6839\u636e\u8fdb\u7a0b\u540d\u79f0\u548c\u7528\u6237 ID \u5f97\u5230\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u7531\u4e8e\u4e0d\u5b58\u5728\uff0c\u5219\u4e3a null \u3002\n            app = getProcessRecordLocked(processName, info.uid, keepIfLarge);\n            checkTime(startTime, \"startProcess: after getProcessRecord\");\n            // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n        } else {\n            // If this is an isolated process, it can't re-use an existing process.\n            app = null;\n        }\n        // \u5f53\u8fdb\u7a0b\u5df2\u7ecf\u88ab\u5206\u914d\u7684 PID \u65f6\uff0c\n        if (app != null &amp;&amp; app.pid &gt; 0) {\n        }\n        // \u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u7684\u8fdb\u7a0b\n        if (app == null) {\n            checkTime(startTime, \"startProcess: creating new process record\");\n            // \u521b\u5efa\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\n            app = newProcessRecordLocked(info, processName, isolated, isolatedUid);\n            if (app == null) {\n            }\n            app.crashHandler = crashHandler;\n            checkTime(startTime, \"startProcess: done creating new process record\");\n        } else {\n            // If this is a new package in the process, add the package to the list\n            app.addPackage(info.packageName, info.versionCode, mProcessStats);\n            checkTime(startTime, \"startProcess: added package to existing proc\");\n        }\n        // \u521b\u5efa\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u540e\uff0c\u6700\u7ec8\u8c03\u7528 startProcessLocked \u65b9\u6cd5\n        startProcessLocked(\n                app, hostingType, hostingNameStr, abiOverride, entryPoint, entryPointArgs);\n</code></pre> <p>ActivityManagerService \u7c7b\u7684 <code>startProcessLocked</code>\u65b9\u6cd5\u91cd\u8f7d\u4e86\u591a\u4e2a\u5f62\u5f0f\uff0c\u6700\u7ec8\u6267\u884c\u4e86\u4e0a\u8ff0\u7684\u51fd\u6570\u3002</p> <p>\u7531\u4e8e\u5e76\u4e0d\u662f\u9694\u79bb\u7684\u8fdb\u7a0b\uff0c\u9996\u5148\u4f1a\u6839\u636e\u8fdb\u7a0b\u540d\u79f0\u548c\u7528\u6237 ID \u68c0\u67e5\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u5b58\u5728\uff0c\u7531\u4e8e\u4e0d\u5b58\u5728\uff0capp \u4e3a null \uff0c\u5219\u521b\u5efa\u4e86\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u901a\u8fc7<code>newProcessRecordLocked</code>\u65b9\u6cd5\u3002\u6700\u540e\u8fd8\u662f\u8c03\u7528\u4e86 <code>startProcessLocked</code> \u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitymanagerservice-newprocessrecordlocked","title":"ActivityManagerService\u7c7b\u7684 newProcessRecordLocked() \u65b9\u6cd5","text":"<p><pre><code>final ProcessRecord newProcessRecordLocked(ApplicationInfo info, String customProcess,\n            boolean isolated, int isolatedUid) {\n        String proc = customProcess != null ? customProcess : info.processName;\n        BatteryStatsImpl stats = mBatteryStatsService.getActiveStatistics();\n        final int userId = UserHandle.getUserId(info.uid);\n        int uid = info.uid;\n        if (isolated) {\n          // \u7701\u7565\u4e0e\u9694\u79bb\u8fdb\u7a0b\u76f8\u5173\u4ee3\u7801\n        }\n        final ProcessRecord r = new ProcessRecord(stats, info, proc, uid);\n        if (!mBooted &amp;&amp; !mBooting\n                &amp;&amp; userId == UserHandle.USER_OWNER\n                &amp;&amp; (info.flags &amp; PERSISTENT_MASK) == PERSISTENT_MASK) {\n            r.persistent = true;\n        }\n        addProcessNameLocked(r);\n        return r;\n    }\n</code></pre> \u901a\u8fc7 ApplicationInfo \u521b\u5efa\u4e86\u4e00\u4e2a ProcessRecord \u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitymanagerservice-startprocesslocked_1","title":"ActivityManagerService\u7c7b\u7684 startProcessLocked() \u65b9\u6cd5","text":"<p>\u5f53\u521b\u5efa\u5b8c ProcessRecord \u540e\uff0c\u6700\u540e\u8fd8\u662f\u8c03\u7528\u4e86 <code>startProcessLocked</code>\u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b <code>Process</code> \u3002</p> <pre><code>private final void startProcessLocked(ProcessRecord app, String hostingType,\n            String hostingNameStr, String abiOverride, String entryPoint, String[] entryPointArgs) {\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n        // Start the process.  It will either succeed and return a result containing\n        // the PID of the new process, or else throw a RuntimeException.\n        // \u5728\u4e4b\u524d\u7684\u51fd\u6570\u8c03\u7528\u4e2d\uff0centryPoint \u53c2\u6570\u4e3a null\uff0c\u5219\u8d4b\u503c\u4e3a android.app.ActivityThread \u3002\n        boolean isActivityProcess = (entryPoint == null);\n            if (entryPoint == null) entryPoint = \"android.app.ActivityThread\";\n        // \u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\n        Process.ProcessStartResult startResult = Process.start(entryPoint,\n                app.processName, uid, uid, gids, debugFlags, mountExternal,\n                app.info.targetSdkVersion, app.info.seinfo, requiredAbi, instructionSet,\n                app.info.dataDir, entryPointArgs);\n\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n         app.setPid(startResult.pid);\n            app.usingWrapper = startResult.usingWrapper;\n            app.removed = false;\n            app.killed = false;\n            app.killedByAm = false;\n            checkTime(startTime, \"startProcess: starting to update pids map\");\n            synchronized (mPidsSelfLocked) {\n            // app \u7c7b\u578b\u4e3a ProcessRecord\n            // \u5c06 ProcessRecord \u5bf9\u8c61\u4fdd\u5b58\u5728 ActivityManagerService \u7c7b\u7684\u6210\u5458\u53d8\u91cf mPidsSelfLocked \u4e2d\n                this.mPidsSelfLocked.put(startResult.pid, app);\n                if (isActivityProcess) {\n                // \u5411 ActivityManagerService \u6240\u8fd0\u884c\u7684\u7ebf\u7a0b\u7684\u6d88\u606f\u961f\u5217\u53d1\u9001 PROC_START_TIMEOUT_MSG \u7c7b\u578b\u7684\u6d88\u606f\n                // \u5e76\u6307\u5b9a\u8fd9\u4e2a\u6d88\u606f\u5728 PROC_START_TIMEOUT \u6beb\u79d2\u540e\u5904\u7406\n                    Message msg = mHandler.obtainMessage(PROC_START_TIMEOUT_MSG);\n                    msg.obj = app;\n                    mHandler.sendMessageDelayed(msg, startResult.usingWrapper\n                            ? PROC_START_TIMEOUT_WITH_WRAPPER : PROC_START_TIMEOUT);\n                }\n            }\n}\n</code></pre> <p>\u8c03\u7528 Process \u7c7b\u7684\u9759\u6001\u6210\u5458\u51fd\u6570<code>start</code>\u6765\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u3002</p> <p>\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u5f53\u524d\u8fdb\u7a0b\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u5927\u4e8e 0 \u7684\u8fdb\u7a0b ID \uff0c\u4fdd\u5b58\u5728\u53d8\u91cf <code>pid</code>\u4e2d\uff0c\u63a5\u7740\u5c31\u4ee5\u53d8\u91cf <code>pid</code>\u4e3a\u5173\u952e\u5b57\u5c06\u53c2\u6570 app \u6240\u6307\u5411\u7684\u4e00\u4e2a ProcessRecord \u5bf9\u8c61\u4fdd\u5b58\u5728 ActivityManagerService \u7c7b\u7684\u6210\u5458\u53d8\u91cf <code>mPidsSelfLocked</code>\u4e2d\u3002</p> <p>\u6700\u540e\uff0c\u5f53\u65b0\u7684\u8fdb\u7a0b\u542f\u52a8\u5b8c\u540e\uff0c\u8fd8\u9700\u8981\u5411 ActivityManagerService \u53d1\u9001\u4e00\u4e2a\u901a\u77e5\uff0c\u4ee5\u4fbf ActivityManagerService \u53ef\u4ee5\u5728\u5b83\u91cc\u9762\u542f\u52a8\u4e00\u4e2a Service \u7ec4\u4ef6\uff0c\u5426\u5219\uff0cActivityManagerService \u4f1a\u8ba4\u4e3a\u5b83\u8d85\u65f6\u4e86\uff0c\u56e0\u6b64\uff0c\u4e0d\u80fd\u5c06 Activity \u7ec4\u4ef6\u542f\u52a8\u8d77\u6765\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitythread-main","title":"ActivityThread \u7c7b\u7684 main() \u65b9\u6cd5","text":"<p>\u7531\u4e8e Process \u7c7b\u7684\u9759\u6001\u65b9\u6cd5 start \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u660e\u4e86\u8fdb\u7a0b\u8fdb\u5165\u70b9\uff0c\u5219 ActivityThread \u7684 main \u65b9\u6cd5\u4e3a\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5f00\u59cb\u70b9\u3002</p> <pre><code>public final class ActivityThread {\n   final ApplicationThread mAppThread = new ApplicationThread();\n   public static void main(String[] args) {\n       // \u521d\u59cb\u5316\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u961f\u5217\n       Looper.prepareMainLooper();\n       ActivityThread thread = new ActivityThread();\n       thread.attach(false);\n\n       if (sMainThreadHandler == null) {\n            sMainThreadHandler = thread.getHandler();\n       }\n       // \u5f00\u542f\u6d88\u606f\u5faa\u73af\n       Looper.loop();\n   }\n\n   private void attach(boolean system) {\n        sCurrentActivityThread = this;\n        mSystemThread = system;\n        if (!system) { // \u662f\u5426\u4e3a\u7cfb\u7edf\u8fdb\u7a0b\n            android.ddm.DdmHandleAppName.setAppName(\"&lt;pre-initialized&gt;\",\n                                                    UserHandle.myUserId());\n            RuntimeInit.setApplicationObject(mAppThread.asBinder());\n            // \u83b7\u5f97 ActivityManagerService \u7684\u4ee3\u7406\u5bf9\u8c61\n            final IActivityManager mgr = ActivityManagerNative.getDefault();\n            try {\n                mgr.attachApplication(mAppThread);\n            } catch (RemoteException ex) {\n                // Ignore\n            }\n\n        } else {\n           // \u7701\u7565\u7cfb\u7edf\u8fdb\u7a0b\u4ee3\u7801\n        } \n        // \u7701\u7565 ViewRootImpl \u76f8\u5173\u4ee3\u7801\n    }\n}\n\n// ActivityManagerProxy \u7684 attachApplication \u65b9\u6cd5\n    public void attachApplication(IApplicationThread app) throws RemoteException\n    {\n        Parcel data = Parcel.obtain();\n        Parcel reply = Parcel.obtain();\n        data.writeInterfaceToken(IActivityManager.descriptor);\n        data.writeStrongBinder(app.asBinder());\n        mRemote.transact(ATTACH_APPLICATION_TRANSACTION, data, reply, 0);\n        reply.readException();\n        data.recycle();\n        reply.recycle();\n    }\n</code></pre> <p>\u65b0\u7684\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c\u5728 main \u65b9\u6cd5\u91cc\u4e3b\u8981\u505a\u4e86\u4e24\u4ef6\u4e8b\u60c5\uff1a *   \u5728\u65b0\u7684\u8fdb\u7a0b\u91cc\u9762\u521b\u5efa\u4e00\u4e2a ActivityThread \u5bf9\u8c61\uff0c\u5e76\u4e14\u8c03\u7528\u5b83\u7684\u6210\u5458\u51fd\u6570 attach \u5411 ActivityManagerService \u53d1\u9001\u4e00\u4e2a\u542f\u52a8\u5b8c\u6210\u901a\u77e5\u3002 *   \u8c03\u7528 Looper \u7c7b\u7684\u9759\u6001\u6210\u5458\u51fd\u6570<code>prepareMainLooper</code>\u521b\u5efa\u4e00\u4e2a\u6d88\u606f\u5faa\u73af\uff0c\u5e76\u4e14\u5728\u5411 ActivityManagerService \u53d1\u9001\u542f\u52a8\u5b8c\u6210\u901a\u77e5\u4e4b\u540e\uff0c\u4f7f\u5f97\u5f53\u524d\u8fdb\u7a0b\u8fdb\u5165\u5230\u8fd9\u4e2a\u6d88\u606f\u5faa\u73af\u4e2d\u3002</p> <p>\u5728 ActivityThread \u5bf9\u8c61\u5185\u8fd8\u521b\u5efa\u4e86\u4e00\u4e2a ApplicationThread \u5bf9\u8c61\uff0c\u5728\u4e4b\u524d\u63d0\u5230\u8fc7 ApplicationThread \u662f\u4e00\u4e2a Binder \u672c\u5730\u5bf9\u8c61\uff0cActivityManagerService \u5c31\u662f\u901a\u8fc7\u5b83\u6765\u548c\u5e94\u7528\u7a0b\u5e8f\u901a\u4fe1\u7684\u3002</p> <p>\u5728 <code>attach</code>\u65b9\u6cd5\u5185\u90e8\u901a\u8fc7 <code>ActivityManagerNative.getDefault()</code>\u5f97\u5230\u4e86 ActivityManagerService \u7684\u4ee3\u7406\u5bf9\u8c61 <code>ActivityManagerProxy</code>\u3002<code>ActivityManagerProxy</code>\u901a\u8fc7 Binder \u9a71\u52a8\u53d1\u8d77\u4e00\u4e2a\u7c7b\u578b\u4e3a <code>ATTACH_APPLICATION_TRANSACTION</code>\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002\u63a5\u4e0b\u6765\u5c31\u662f ActivityManagerService \u54cd\u5e94\u8fd9\u4e2a\u901a\u4fe1\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitymanagerservice-attachapplication","title":"ActivityManagerService\u7c7b\u7684 attachApplication() \u65b9\u6cd5","text":"<p><pre><code>    public final void attachApplication(IApplicationThread thread) {\n        synchronized (this) {\n            int callingPid = Binder.getCallingPid();\n            final long origId = Binder.clearCallingIdentity();\n            attachApplicationLocked(thread, callingPid);\n            Binder.restoreCallingIdentity(origId);\n        }\n    }\n</code></pre> \u63a5\u4e0b\u6765\u6267\u884c <code>attachApplicationLocked</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitymanagerservice-attachapplicationlocked","title":"ActivityManagerService\u7c7b\u7684 attachApplicationLocked() \u65b9\u6cd5","text":"<p><pre><code>private final boolean attachApplicationLocked(IApplicationThread thread, int pid) {\n        ProcessRecord app;\n        if (pid != MY_PID &amp;&amp; pid &gt;= 0) {\n            synchronized (mPidsSelfLocked) {\n                app = mPidsSelfLocked.get(pid);\n            }\n        } else {\n            app = null;\n        }\n\n       final String processName = app.processName;\n       try {\n            AppDeathRecipient adr = new AppDeathRecipient(\n                    app, pid, thread);\n            thread.asBinder().linkToDeath(adr, 0);\n            app.deathRecipient = adr;\n        } catch (RemoteException e) {\n            app.resetPackageList(mProcessStats);\n            startProcessLocked(app, \"link fail\", processName);\n            return false;\n        }\n        app.makeActive(thread, mProcessStats);\n        app.curAdj = app.setAdj = -100;\n        app.curSchedGroup = app.setSchedGroup = Process.THREAD_GROUP_DEFAULT;\n        app.forcingToForeground = null;\n        updateProcessForegroundLocked(app, false, false);\n        app.hasShownUi = false;\n        app.debugging = false;\n        app.cached = false;\n        app.killedByAm = false;\n\n        // \u79fb\u9664\u8d85\u65f6\u6d88\u606f\uff0c\u5e94\u7528\u7a0b\u5e8f\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u5b8c\u6210\u4e86\u542f\u52a8\u3002\n        mHandler.removeMessages(PROC_START_TIMEOUT_MSG, app);\n\n        try{\n        // \u7701\u7565\u90e8\u5206\u4ee3\u7801\uff0c\u8de8\u8fdb\u7a0b\u8c03\u7528 ActivityThread \u7684\u65b9\u6cd5\n            thread.bindApplication(processName, appInfo, providers, app.instrumentationClass,\n                    profilerInfo, app.instrumentationArguments, app.instrumentationWatcher,\n                    app.instrumentationUiAutomationConnection, testMode, enableOpenGlTrace,\n                    enableTrackAllocation, isRestrictedBackupMode || !normalMode, app.persistent,\n                    new Configuration(mConfiguration), app.compat,\n                    getCommonServicesLocked(app.isolated),\n                    mCoreSettingsObserver.getCoreSettingsLocked());\n        }catch(Exception e){\n            // \n        }\n        boolean badApp = false;\n        boolean didSomething = false;\n\n         // See if the top visible activity is waiting to run in this process...\n         // \u8c03\u5ea6 Activity\n        if (normalMode) {\n            try {\n                if (mStackSupervisor.attachApplicationLocked(app)) {\n                    didSomething = true;\n                }\n            } catch (Exception e) {\n                badApp = true;\n            }\n        }\n        // Find any services that should be running in this process...\n        // \u8c03\u5ea6 Service\n        if (!badApp) {\n            try {\n                didSomething |= mServices.attachApplicationLocked(app, processName);\n            } catch (Exception e) {\n                badApp = true;\n            }\n        }\n        // Check if a next-broadcast receiver is in this process...\n        // \u8c03\u5ea6 Broadcast \n        if (!badApp &amp;&amp; isPendingBroadcastProcessLocked(pid)) {\n            try {\n                didSomething |= sendPendingBroadcastsLocked(app);\n            } catch (Exception e) {\n                // If the app died trying to launch the receiver we declare it 'bad'\n                badApp = true;\n            }\n        }\n\n\n}\n\n// ApplicationThread \u7684 bindApplication \u65b9\u6cd5\npublic final void bindApplication(String processName, ApplicationInfo appInfo,\n                List&lt;ProviderInfo&gt; providers, ComponentName instrumentationName,\n                ProfilerInfo profilerInfo, Bundle instrumentationArgs,\n                IInstrumentationWatcher instrumentationWatcher,\n                IUiAutomationConnection instrumentationUiConnection, int debugMode,\n                boolean enableOpenGlTrace, boolean trackAllocation, boolean isRestrictedBackupMode,\n                boolean persistent, Configuration config, CompatibilityInfo compatInfo,\n                Map&lt;String, IBinder&gt; services, Bundle coreSettings) {\n\n            if (services != null) {\n                // Setup the service cache in the ServiceManager\n                ServiceManager.initServiceCache(services);\n            }\n            setCoreSettings(coreSettings);\n            AppBindData data = new AppBindData();\n            data.processName = processName;\n            data.appInfo = appInfo;\n            data.providers = providers;\n            data.instrumentationName = instrumentationName;\n            data.instrumentationArgs = instrumentationArgs;\n            data.instrumentationWatcher = instrumentationWatcher;\n            data.instrumentationUiAutomationConnection = instrumentationUiConnection;\n            data.debugMode = debugMode;\n            data.enableOpenGlTrace = enableOpenGlTrace;\n            data.trackAllocation = trackAllocation;\n            data.restrictedBackupMode = isRestrictedBackupMode;\n            data.persistent = persistent;\n            data.config = config;\n            data.compatInfo = compatInfo;\n            data.initProfilerInfo = profilerInfo;\n            // \u5411 ActivityThread \u7684\u5e94\u7528\u7a0b\u5e8f\u4e3b\u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\n            sendMessage(H.BIND_APPLICATION, data);\n        }\n</code></pre> \u65b9\u6cd5\u7684\u53c2\u6570 <code>pid</code>\u6307\u5411\u4e86\u524d\u9762\u6240\u521b\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u7684 PID \uff0c\u5728\u4e4b\u524d\u7684\u6b65\u9aa4\u4e2d\uff0cActivityManagerService \u4ee5 PID \u4e3a\u5173\u952e\u5b57\u5c06\u4e00\u4e2a ProcessRecord \u5bf9\u8c61\u4fdd\u5b58\u5728\u4e86\u6210\u5458\u53d8\u91cf <code>mPidsSelfLocked</code> \u4e2d\uff0c\u56e0\u6b64\u53c8\u901a\u8fc7\u8be5 PID \u5c06 ProcessRecord \u5bf9\u8c61\u53d6\u56de\uff0c\u4fdd\u5b58\u5728 app \u53d8\u91cf\u4e2d\u3002</p> <p>\u7136\u540e\u5c31\u5bf9 app \u53d8\u91cf\u8fdb\u7a0b\u8d4b\u503c\u521d\u59cb\u5316\uff0c\u6700\u91cd\u8981\u7684\u5c31\u662f\u5c06\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u7684 ApplicationThread \u5bf9\u8c61\u8d4b\u503c\u7ed9 ProcessThread \u7684 <code>thread</code> \u6210\u5458\u53d8\u91cf\uff0c\u8fd9\u6837 ActivityManagerService \u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a ApplicationThread \u4ee3\u7406\u5bf9\u8c61\u548c\u65b0\u521b\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u8fdb\u884c\u901a\u4fe1\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u4f1a\u6267\u884c thread \u7684 <code>bindApplication</code>\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u662f\u4e00\u4e2a\u8de8\u8fdb\u7a0b\u901a\u4fe1\u4e86\uff0c\u56e0\u4e3a thread \u662f ApplicationThread \u7c7b\u578b\u3002ActivityManagerService \u6b63\u662f\u901a\u8fc7\u5b83\u4e0e Activity \u7ec4\u4ef6\u901a\u4fe1\u7684\u3002\u8be5\u65b9\u6cd5\u7684\u4f5c\u7528\u4e3b\u8981\u662f\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u4e00\u4e9b\u4fe1\u606f\u53d1\u9001\u7ed9 Activity \uff0c\u4f8b\u5982\uff1a<code>ProfilerInfo</code>\u4e4b\u7c7b\u7684\u3002</p> <p>\u800c<code>ApplicationThread</code>\u5185\u4e5f\u54cd\u5e94\u4e86\u8be5\u65b9\u6cd5\uff0c\u901a\u8fc7\u89e3\u6790\u5c01\u88c5\u76f8\u5e94\u7684\u6570\u636e\uff0c\u5411\u4e3b\u7ebf\u7a0b\u53d1\u9001\u4e00\u4e2a\u7c7b\u578b\u4e3a<code>BIND_APPLICATION</code>\u7684\u6d88\u606f\u3002</p> <p>\u800c\u5728<code>ActivityThread</code>\u4e2d\u4e5f\u6709\u4e00\u4e2a\u7c7b\u578b\u4e3a <code>H</code>\u7684 Handler \uff0c\u7ee7\u627f\u81ea Handler\uff0c\u7528\u6765\u5904\u7406\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u5faa\u73af\u3002\u5728 <code>H</code>\u7c7b\u7684<code>handleMessage</code>\u4e2d\u901a\u8fc7<code>handleBindApplication</code>\u65b9\u6cd5\u5904\u7406\u4e86\u7c7b\u578b\u4e3a<code>BIND_APPLICATION</code>\u7684\u6d88\u606f\u3002</p> <p>\u5f53 <code>ActivityManagerService</code> \u7684\u4fe1\u606f\u4f20\u9012\u7ed9 ActivityThread \u540e\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u8c03\u5ea6\u4e86 Activity \u7ec4\u4ef6\u4e86\u3002\u901a\u8fc7 <code>attachApplicationLocked</code>\u65b9\u6cd5\u8c03\u5ea6 Activity \u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitythread-handlebindapplication","title":"ActivityThread \u7c7b\u7684 handleBindApplication() \u65b9\u6cd5","text":"<pre><code>private void handleBindApplication(AppBindData data) {\n\n    // send up app name; do this *before* waiting for debugger\n    // \u8bbe\u7f6e\u8fdb\u7a0b\u540d\n        Process.setArgV0(data.processName);\n    // \u521b\u5efa Android \u8fd0\u884c\u73af\u5883 Context .\n    final ContextImpl appContext = ContextImpl.createAppContext(this, data.info);\n\n    // \u521d\u59cb\u5316 Intrumentation \u5bf9\u8c61\n    if (data.instrumentationName != null) {\n        try {\n           java.lang.ClassLoader cl = instrContext.getClassLoader();\n           mInstrumentation = (Instrumentation)\n                        cl.loadClass(data.instrumentationName.getClassName()).newInstance();\n           } catch (Exception e) {\n           }\n           mInstrumentation.init(this, instrContext, appContext,\n                   new ComponentName(ii.packageName, ii.name), data.instrumentationWatcher,\n                   data.instrumentationUiAutomationConnection);\n     } else {\n            mInstrumentation = new Instrumentation();\n     }\n\n     // Allow disk access during application and provider setup. This could\n     // block processing ordered broadcasts, but later processing would\n     // probably end up doing the same disk access.\n\n        try {\n            // If the app is being launched for full backup or restore, bring it up in\n            // a restricted environment with the base application class.\n            // \u521b\u5efa Application \u5bf9\u8c61\n            Application app = data.info.makeApplication(data.restrictedBackupMode, null);\n            mInitialApplication = app;\n\n            // don't bring up providers in restricted mode; they may depend on the\n            // app's custom Application class\n            if (!data.restrictedBackupMode) {\n                List&lt;ProviderInfo&gt; providers = data.providers;\n                if (providers != null) {\n                    installContentProviders(app, providers);\n                    // For process that contains content providers, we want to\n                    // ensure that the JIT is enabled \"at some point\".\n                    mH.sendEmptyMessageDelayed(H.ENABLE_JIT, 10*1000);\n                }\n            }\n\n            // Do this after providers, since instrumentation tests generally start their\n            // test thread at this point, and we don't want that racing.\n            try {\n                mInstrumentation.onCreate(data.instrumentationArgs);\n            }\n            catch (Exception e) {         \n            }\n            try {\n            // \u6267\u884c Application \u7684 onCreate \u65b9\u6cd5\n                mInstrumentation.callApplicationOnCreate(app);\n            } catch (Exception e) {\n            }\n        } finally {\n        }\n}\n</code></pre> <p>\u7cfb\u7edf\u8fdb\u7a0b\u5c06\u5f88\u591a\u4e0e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u76f8\u5173\u7684\u4fe1\u606f\u4f20\u9012\u81f3\u6b64\u8fdb\u884c\u7ed1\u5b9a\uff0c\u5c31\u662f\u4e3a\u4e86\u521d\u59cb\u5316\u4e00\u4e2a Android \u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u4fe1\u606f\u3002</p> <ul> <li>\u521d\u59cb\u5316\u4e86\u8fd0\u884c\u73af\u5883\u4e0a\u4e0b\u6587 Context \u3002</li> <li>\u521d\u59cb\u5316\u4e86 Instrumentation \u3002</li> <li>\u521d\u59cb\u5316\u4e86 Application \u7c7b\u3002</li> <li>\u8c03\u7528\u4e86 Application \u7684 onCreate \u65b9\u6cd5\u3002</li> </ul> <p>\u5f53\u628a\u8fd9\u4e9b\u4fe1\u606f\u4f20\u9012\u7ed9 Activity \u7ec4\u4ef6\uff0c\u5e76\u4e14\u521d\u59cb\u5316\u7ed3\u675f\u540e\uff0c\u65b0\u7684\u4e00\u4e2a\u8fdb\u7a0b\u5c31\u8715\u53d8\u6210\u4e86 Android \u8fdb\u7a0b\u4e86\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#stacksupervisor-attachapplicationlocked","title":"StackSupervisor \u7c7b\u7684 attachApplicationLocked() \u65b9\u6cd5","text":"<pre><code> boolean attachApplicationLocked(ProcessRecord app) throws RemoteException {\n        final String processName = app.processName;\n        boolean didSomething = false;\n        for (int displayNdx = mActivityDisplays.size() - 1; displayNdx &gt;= 0; --displayNdx) {\n            ArrayList&lt;ActivityStack&gt; stacks = mActivityDisplays.valueAt(displayNdx).mStacks;\n            for (int stackNdx = stacks.size() - 1; stackNdx &gt;= 0; --stackNdx) {\n                final ActivityStack stack = stacks.get(stackNdx);\n                if (!isFrontStack(stack)) {\n                    continue;\n                }\n                ActivityRecord hr = stack.topRunningActivityLocked(null);\n                if (hr != null) {\n                    if (hr.app == null &amp;&amp; app.uid == hr.info.applicationInfo.uid\n                            &amp;&amp; processName.equals(hr.processName)) {\n                        try {\n                            if (realStartActivityLocked(hr, app, true, true)) {\n                                didSomething = true;\n                            }\n                        } catch (RemoteException e) {\n                            throw e;\n                        }\n                    }\n                }\n            }\n        }\n        if (!didSomething) {\n            ensureActivitiesVisibleLocked(null, 0);\n        }\n        return didSomething;\n    }\n</code></pre> <p>\u904d\u5386 ActivityStack \u548c TaskRecord\uff0c\u627e\u5230\u4f4d\u4e8e Activity \u5806\u6808\u9876\u7aef\u7684\u4e00\u4e2a ActivityRecord \u5bf9\u8c61 <code>hr</code>\uff0c\u63a5\u7740\u68c0\u67e5\u8fd9\u4e2a Activity \u7ec4\u4ef6\u7684\u7528\u6237 ID \u548c \u8fdb\u7a0b\u540d\u662f\u5426\u4e0e ProcessRecord \u5bf9\u8c61 app \u6240\u63cf\u8ff0\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u7528\u6237 ID \u548c\u8fdb\u7a0b\u540d\u4e00\u81f4\uff0c\u5982\u679c\u4e00\u81f4\uff0c\u5219\u8c03\u7528 <code>realStartActivityLocked</code>\u65b9\u6cd5\u6765\u8bf7\u6c42\u8be5\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u542f\u52a8\u4e00\u4e2a Activity \u7ec4\u4ef6\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#stacksupervisor-realstartactivitylocked","title":"StackSupervisor \u7c7b\u7684 realStartActivityLocked() \u65b9\u6cd5","text":"<pre><code>    final boolean realStartActivityLocked(ActivityRecord r,\n            ProcessRecord app, boolean andResume, boolean checkConfig)\n            throws RemoteException {\n\n        r.app = app;\n        app.waitingToKill = null;\n        r.launchCount++;\n        r.lastLaunchTime = SystemClock.uptimeMillis();\n\n        int idx = app.activities.indexOf(r);\n        if (idx &lt; 0) {\n            app.activities.add(r);\n        }\n\n        try {\n            app.thread.scheduleLaunchActivity(new Intent(r.intent), r.appToken,\n                    System.identityHashCode(r), r.info, new Configuration(mService.mConfiguration),\n                    new Configuration(stack.mOverrideConfig), r.compat, r.launchedFromPackage,\n                    task.voiceInteractor, app.repProcState, r.icicle, r.persistentState, results,\n                    newIntents, !andResume, mService.isNextTransitionForward(), profilerInfo);\n        } catch (RemoteException e) {\n        }\n        return true;\n  }\n// ApplicationThread \u7684 scheduleRelaunchActivity \u65b9\u6cd5\n public final void scheduleLaunchActivity(Intent intent, IBinder token, int ident,\n                ActivityInfo info, Configuration curConfig, Configuration overrideConfig,\n                CompatibilityInfo compatInfo, String referrer, IVoiceInteractor voiceInteractor,\n                int procState, Bundle state, PersistableBundle persistentState,\n                List&lt;ResultInfo&gt; pendingResults, List&lt;ReferrerIntent&gt; pendingNewIntents,\n                boolean notResumed, boolean isForward, ProfilerInfo profilerInfo) {\n\n            updateProcessState(procState, false);\n\n            ActivityClientRecord r = new ActivityClientRecord();\n\n            r.token = token;\n            r.ident = ident;\n            r.intent = intent;\n            r.referrer = referrer;\n            r.voiceInteractor = voiceInteractor;\n            r.activityInfo = info;\n            r.compatInfo = compatInfo;\n            r.state = state;\n            r.persistentState = persistentState;\n\n            r.pendingResults = pendingResults;\n            r.pendingIntents = pendingNewIntents;\n\n            r.startsNotResumed = notResumed;\n            r.isForward = isForward;\n\n            r.profilerInfo = profilerInfo;\n\n            r.overrideConfig = overrideConfig;\n            updatePendingConfiguration(curConfig);\n            // \u5411\u4e3b\u7ebf\u7a0b\u53d1\u9001\u6d88\u606f\n            sendMessage(H.LAUNCH_ACTIVITY, r);\n        }\n</code></pre> <p>\u9996\u5148\u5c06\u53c2\u6570 <code>r</code>\u7684\u6210\u5458\u53d8\u91cf<code>app</code>\u7684\u503c\u8bbe\u7f6e\u4e3a\u53c2\u6570<code>app</code>\uff0c\u8868\u793a\u5b83\u63cf\u8ff0\u7684 Activity \u7ec4\u4ef6\u662f\u5728\u53c2\u6570 app \u6240\u63cf\u8ff0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u4e2d\u542f\u52a8\u7684\uff0c\u63a5\u7740\u5c06\u8be5 Activity \u7ec4\u4ef6\u6dfb\u52a0\u5230\u53c2\u6570 <code>app</code>\u6240\u63cf\u8ff0\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u7684 Activity \u7ec4\u4ef6\u5217\u8868\u4e2d\u3002</p> <p>\u63a5\u4e0b\u6765\u8c03\u7528<code>thread</code>\u7684<code>scheduleLaunchActivity</code>\u65b9\u6cd5\u6765\u901a\u77e5\u524d\u9762\u521b\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u542f\u52a8\u7531\u53c2\u6570<code>r</code>\u6240\u63cf\u8ff0\u7684\u4e00\u4e2a Activity \u7ec4\u4ef6\u3002</p> <p>\u7531\u4e8e <code>thread</code>\u7684\u7c7b\u578b\u662f ApplicationThread\uff0c\u53c8\u662f\u4e00\u4e2a Binder \u5bf9\u8c61\uff0c\u5219\u53c8\u662f\u8de8\u8fdb\u7a0b\u7684\u901a\u4fe1\uff0c\u6b64\u65f6\u7684\u6267\u884c\u8fd8\u662f\u5728 ActivityManagerService \u8fdb\u7a0b\u5185\u7684\u3002\u901a\u8fc7 ApplicationThread \u8de8\u8fdb\u7a0b\u5411\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u53d1\u9001\u8bf7\u6c42\u3002</p> <p>\u5728\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u5faa\u73af\u4e2d\u5bf9\u5e94\u7684\u54cd\u5e94\u65b9\u6cd5\u4e3a<code>handleLaunchActivity</code>\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitythread-handlelaunchactivity","title":"ActivityThread \u7c7b\u7684 handleLaunchActivity() \u65b9\u6cd5","text":"<pre><code>private void handleLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n\n         // Initialize before creating the activity\n        WindowManagerGlobal.initialize();\n        Activity a = performLaunchActivity(r, customIntent);\n\n        if (a != null) {\n            r.createdConfig = new Configuration(mConfiguration);\n            Bundle oldState = r.state;\n            handleResumeActivity(r.token, false, r.isForward,\n                    !r.activity.mFinished &amp;&amp; !r.startsNotResumed);\n        } else {\n            // If there was an error, for any reason, tell the activity\n            // manager to stop us.\n            try {\n                ActivityManagerNative.getDefault()\n                    .finishActivity(r.token, Activity.RESULT_CANCELED, null, false);\n            } catch (RemoteException ex) {\n                // Ignore\n            }\n        }\n</code></pre> <p>\u9996\u5148\u8c03\u7528\u4e86<code>performLaunchActivity</code>\u5c06 Activity \u7ec4\u4ef6\u542f\u52a8\u8d77\u6765\uff0c\u7136\u540e\u5728\u8c03\u7528 <code>handleResumeActivity</code>\u65b9\u6cd5\u5c06 Activity \u7ec4\u4ef6\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a <code>Resumed</code>\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitythread-performlaunchactivity","title":"ActivityThread \u7c7b\u7684 performLaunchActivity() \u65b9\u6cd5","text":"<pre><code>private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\n\n    ComponentName component = r.intent.getComponent();\n        if (component == null) {\n            component = r.intent.resolveActivity(\n                mInitialApplication.getPackageManager());\n            r.intent.setComponent(component);\n        }\n    // \u901a\u8fc7\u53cd\u5c04 \u65b0\u5efa\u4e00\u4e2a Activity \u5bf9\u8c61\n    Activity activity = null;\n        try {\n            java.lang.ClassLoader cl = r.packageInfo.getClassLoader();\n            activity = mInstrumentation.newActivity(\n                    cl, component.getClassName(), r.intent);\n            StrictMode.incrementExpectedActivityCount(activity.getClass());\n            r.intent.setExtrasClassLoader(cl);\n            r.intent.prepareToEnterProcess();\n            if (r.state != null) {\n                r.state.setClassLoader(cl);\n            }\n        } catch (Exception e) {\n        }\n\n        try {\n            Application app = r.packageInfo.makeApplication(false, mInstrumentation);\n            if (activity != null) {\n                // \u521b\u5efa Context \uff0c\u4f5c\u4e3a Activity \u7684\u8fd0\u884c\u4e0a\u4e0b\u6587\u73af\u5883\n                Context appContext = createBaseContextForActivity(r, activity);\n                CharSequence title = r.activityInfo.loadLabel(appContext.getPackageManager());\n                Configuration config = new Configuration(mCompatConfiguration);\n\n                activity.attach(appContext, this, getInstrumentation(), r.token,\n                        r.ident, app, r.intent, r.activityInfo, title, r.parent,\n                        r.embeddedID, r.lastNonConfigurationInstances, config,\n                        r.referrer, r.voiceInteractor);\n\n                if (r.isPersistable()) { // \u56de\u8c03 Activity \u7684 onCreate \u51fd\u6570\n                    mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);\n                } else {\n                    mInstrumentation.callActivityOnCreate(activity, r.state);\n                }\n\n                r.activity = activity;\n                r.stopped = true;\n                if (!r.activity.mFinished) { // \u56de\u8c03 Activity \u7684 onStart \u51fd\u6570\n                    activity.performStart();\n                    r.stopped = false;\n                }\n                if (!r.activity.mFinished) { // Activity \u7684 onRestoreInstanceState \u51fd\u6570\n                    if (r.isPersistable()) {\n                        if (r.state != null || r.persistentState != null) {\n                            mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state,\n                                    r.persistentState);\n                        }\n                    } else if (r.state != null) {\n                        mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state);\n                    }\n                }\n\n            }\n            r.paused = true;\n            mActivities.put(r.token, r);\n        } catch (SuperNotCalledException e) {\n            throw e;\n        } catch (Exception e) {\n        }\n}\n</code></pre> <p>\u9996\u5148\u83b7\u5f97\u8981\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u7684\u5305\u540d\u548c\u7c7b\u540d\uff0c\u5b83\u4eec\u4f7f\u7528\u4e00\u4e2a<code>ComponentName</code>\u5bf9\u8c61 component \u6765\u63cf\u8ff0\u3002</p> <p>\u63a5\u7740\u901a\u8fc7\u53cd\u5c04\u521b\u5efa\u4e00\u4e2a Activity \u7c7b\u5b9e\u4f8b\u3002\u7136\u540e\uff0c\u521d\u59cb\u5316\u4e86\u4e00\u4e2a Context \u5bf9\u8c61\uff0c\u4f5c\u4e3a\u524d\u9762\u521b\u5efa\u7684 Android \u7c7b\u5b9e\u4f8b\u7684\u8fd0\u884c\u73af\u5883\u4e0a\u4e0b\u6587\uff0c\u901a\u8fc7\u5b83\u5c31\u80fd\u8bbf\u95ee\u7279\u5b9a\u7684\u5e94\u7528\u7a0b\u5e8f\u8d44\u6e90\uff0c\u518d\u8c03\u7528 <code>attach</code>\u65b9\u6cd5\uff0c\u521d\u59cb\u5316 Activity \u76f8\u5173\u4fe1\u606f\u3002</p> <p>\u518d\u8c03\u7528<code>Instrumentation</code>\u7c7b\u7684<code>callActivityOnCreate</code>\u65b9\u6cd5\u5c06 Activity \u542f\u52a8\u8d77\u6765\uff0c\u6b64\u65f6\uff0cActivity \u7684 onCreate \u65b9\u6cd5\u5c31\u4f1a\u88ab\u8c03\u7528\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u8c03\u7528 <code>performStart</code>\u65b9\u6cd5\uff0c\u65b9\u6cd5\u5185\u90e8\u8c03\u7528<code>Instrumentation</code>\u7c7b\u7684<code>callActivityOnStart</code>\u65b9\u6cd5\u8c03\u7528 Activity \u7684 onStart \u65b9\u6cd5\u3002\u6b64\u65f6\uff0cActivity \u7684 onCreate \u548c onStart \u4e24\u5927\u65b9\u6cd5\u90fd\u8c03\u7528\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u6267\u884c<code>handleResumeActivity</code>\u65b9\u6cd5\u5c06 Activity \u7ec4\u4ef6\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a <code>Resumed</code>\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitythread-handleresumeactivity","title":"ActivityThread \u7c7b\u7684 handleResumeActivity() \u65b9\u6cd5","text":"<p><pre><code> final void handleResumeActivity(IBinder token,\n            boolean clearHide, boolean isForward, boolean reallyResume) {\n\n     // TODO Push resumeArgs into the activity for consideration\n     // \u771f\u6b63\u6267\u884c\u7684\u662f performResumeActivity \u65b9\u6cd5\n        ActivityClientRecord r = performResumeActivity(token, clearHide);\n        if (r != null) {\n            // \u7701\u7565\u548c Window \u76f8\u5173\u4ee3\u7801\n        } else {\n            try {\n                ActivityManagerNative.getDefault()\n                    .finishActivity(token, Activity.RESULT_CANCELED, null, false);\n            } catch (RemoteException ex) {\n            }\n        }\n}\n</code></pre> \u771f\u6b63\u6267\u884c\u7684\u662f <code>performResumeActivity</code>\u65b9\u6cd5\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#activitythread-performresumeactivity","title":"ActivityThread \u7c7b\u7684 performResumeActivity() \u65b9\u6cd5","text":"<pre><code>    public final ActivityClientRecord performResumeActivity(IBinder token,\n            boolean clearHide) {\n             ActivityClientRecord r = mActivities.get(token);\n             if (r != null &amp;&amp; !r.activity.mFinished) {\n                 r.activity.performResume();\n             }\n             return r ;\n    }\n</code></pre> <p>\u6700\u540e\uff0c<code>performResume</code>\u65b9\u6cd5\u8fd8\u662f\u8c03\u7528\u7684<code>Instrumentation</code>\u7c7b\u7684 <code>callActivityOnResume</code>\u65b9\u6cd5\uff0c\u8ba9\u5f53\u524d Activity \u7ec4\u4ef6\u8fdb\u5165\u4e86 <code>Resumed</code>\u72b6\u6001\u3002</p> <p>\u81f3\u6b64\uff0c\u4ece Launcher \u7ec4\u4ef6\u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\u5c31\u7b97\u662f\u8fc7\u4e86\u4e00\u904d\u4e86\uff0c\u91cc\u9762\u8fd8\u6709\u8bb8\u591a\u7ec6\u8282\u4e4b\u5904\uff0c\u7b49\u5f85\u65e5\u540e\u6316\u6398\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-3/#_1","title":"\u53c2\u8003","text":"<ol> <li>Android 6.0 \u6e90\u7801 </li> <li>\u300aAndroid \u7cfb\u7edf\u6e90\u4ee3\u7801\u60c5\u666f\u5206\u6790\u300b </li> <li>http://duanqz.github.io/2016-07-29-Activity-LaunchProcess-Part1</li> </ol>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-4/","title":"Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u5206\u6790\u5c0f\u7ed3\uff08\u56db\uff09","text":"<p>\u5728\u5982\u4e0b\u4e09\u7bc7\u6587\u7ae0\u4e2d\u8fc7\u4e86\u4e00\u904d Launcher \u542f\u52a8 Activity \u7684\u4ee3\u7801\u6d41\u7a0b\u3002</p> <ul> <li> Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e00\uff09</li> <li> Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e8c\uff09</li> <li> Android 6.0 Launcher \u542f\u52a8 Activity \u8fc7\u7a0b\u6e90\u7801\u5206\u6790\uff08\u4e09\uff09</li> </ul> <p>\u7136\u800c\uff0c \u5373\u4f7f\u770b\u8fc7\u4e86\u591a\u904d\u4ee3\u7801\u6d41\u7a0b\u4f9d\u65e7\u6709\u70b9\u4e91\u91cc\u96fe\u91cc\u7684\u611f\u89c9\u3002\u4e0d\u4ece\u6574\u4f53\u4e0a\u6765\u628a\u63e1\uff0c\u5149\u6293\u4f4f\u7ec6\u8282\u4ee3\u7801\u4f1a\u59cb\u7ec8\u4e0d\u5f97\u8981\u9886\u3002</p> <p>\u7531\u4e8e\u662f\u4ece Launcher \u7ec4\u4ef6\u542f\u52a8\u4e00\u4e2a Activity \u7ec4\u4ef6\uff0c\u5176\u4e2d\u8fd8\u9700\u8981\u4e0e ActivityManagerService \u901a\u4fe1\uff0c\u800c\u8fd9\u4e09\u4e2a\u90e8\u5206\u90fd\u662f\u4f4d\u4e8e\u4e0d\u540c\u7684\u8fdb\u7a0b\u5185\uff0c\u6d89\u53ca\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u6574\u4e2a\u8fc7\u7a0b\u5212\u5206\u4e3a\u4e09\u4e2a\u4e0d\u540c\u7684\u90e8\u5206\u6765\u5206\u6790\uff0c\u5728 Launcher \u8fdb\u7a0b\u5185\u7684\u64cd\u4f5c\uff0c\u5728 ActivityManagerService \u8fdb\u7a0b\u5185\u7684\u64cd\u4f5c\uff0c\u5728\u521b\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5185\u7684\u64cd\u4f5c\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-4/#launcher","title":"Launcher \u8fdb\u7a0b\u5185\u7684\u64cd\u4f5c","text":"<p>\u5728 Launcher \u8fdb\u7a0b\u5185\u6267\u884c\u51fd\u6570\uff1a</p> <ul> <li> <p>Launcher . <code>startActivitySafely</code>(View v, Intent intent, Object tag)</p> </li> <li> <p>Launcher . <code>startActivity</code>(View v, Intent intent, Object tag)</p> </li> <li>Activity . <code>startActivity</code>(Intent intent, @Nullable Bundle options)</li> <li>Activity . <code>startActivityForResult</code>(Intent intent, int requestCode, @Nullable Bundle options)</li> <li>Instrumentation . <code>execStartActivity</code>( Context who, IBinder contextThread, IBinder token, Activity target, Intent intent, int requestCode, Bundle options)</li> <li>ActivityManagerProxy . <code>startActivity</code>(IApplicationThread caller, String callingPackage, Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode, int startFlags, ProfilerInfo profilerInfo, Bundle options)</li> </ul> <p>Launcher \u8fdb\u7a0b\u8fd9\u90e8\u5206\u6267\u884c\u7684\u64cd\u4f5c\u4e3b\u8981\u5c31\u662f <code>\u59d4\u6258</code>ActivityManagerService \u53bb\u542f\u52a8\u4e00\u4e2a Activity \u7ec4\u4ef6\uff0c\u628a\u8fd9\u4e2a Activity \u7ec4\u4ef6\u7684 <code>Intent</code>\u4fe1\u606f\u4f20\u9012\u8fc7\u53bb\uff0c\u628a\u81ea\u5df1\u7684\u5305\u540d\u4fe1\u606f\u4f20\u9012\u8fc7\u53bb\uff0c\u8fd8\u628a\u81ea\u5df1\u7684\u672c\u5730 Binder \u5bf9\u8c61 <code>ApplicationThread</code>\u4f20\u9012\u8fc7\u53bb\uff0c\u4ee5\u4fbf ActivityManagerService \u53ef\u4ee5\u901a\u8fc7\u5b83\u6765\u8054\u7cfb\u5230 Launcher \u7ec4\u4ef6\u3002</p> <p>\u6bd5\u7adf\uff0c\u5f53 ActivityManagerService \u8981\u53bb\u521b\u5efa\u65b0\u7684 Activity \u7ec4\u4ef6\u65f6\uff0c\u9996\u5148\u5f97\u8ba9\u4e4b\u524d\u7684 Activity \u7ec4\u4ef6\u8fdb\u5165 <code>Paused</code>\u72b6\u6001\u3002</p> <p>Launcher \u7ec4\u4ef6\u7684\u8fd0\u884c\u6d41\u7a0b\u4ece<code>startActivitySafely</code>\u5230<code>startActivity</code>\uff0c\u518d\u4ece Activity \u7c7b\u7684<code>startActivity</code>\u5230<code>startActivityForResult</code>\uff0c\u6700\u540e\u901a\u8fc7 <code>Instrumentation</code>\u7c7b\u7684<code>execStartActivity</code>\u65b9\u6cd5\u5f97\u5230 ActivityManagerService \u7684\u4ee3\u7406\u5bf9\u8c61 <code>ActivityManagerProxy</code>\u6765\u6267\u884c<code>startActivity</code>\u3002\u6210\u529f\u5730\u628a Activity \u7ec4\u4ef6\u542f\u52a8\u7684\u4efb\u52a1\u4ea4\u7ed9\u4e86 ActivityManagerService \u53bb\u5b8c\u6210\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-4/#activitymanagerservice","title":"ActivityManagerService \u8fdb\u7a0b","text":"<p>\u5728 Launcher \u8fdb\u7a0b\u5185\u6267\u884c\u51fd\u6570\uff1a</p> <ul> <li>ActivityManagerService . <code>startActivity</code>(IApplicationThread caller, String callingPackage, Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode, int startFlags, ProfilerInfo profilerInfo, Bundle options)</li> <li> <p>ActivityManagerService . <code>startActivityAsUser</code>(IApplicationThread caller, String callingPackage, Intent intent, String resolvedType, IBinder resultTo, String resultWho, int requestCode, int startFlags, ProfilerInfo profilerInfo, Bundle options, int userId)</p> </li> <li> <p>ActivityStackSupervisor . <code>startActivityMayWait</code>(...)</p> </li> <li>ActivityStackSupervisor . <code>startActivityLocked</code>( ...)</li> <li>ActivityStackSupervisor . <code>startActivityUncheckedLocked</code>( ...)</li> <li>ActivityStack . <code>startActivityLocked</code>(ActivityRecord r, boolean newTask, boolean doResume, boolean keepCurTransition, Bundle options)</li> <li>ActivityStackSupervisor . <code>resumeTopActivitiesLocked</code>(ActivityStack targetStack, ActivityRecord target, Bundle targetOptions)</li> <li>ActivityStack . <code>resumeTopActivityLocked</code>(ActivityRecord prev, Bundle options)</li> <li>ActivityStack . <code>resumeTopActivityInnerLocked</code>(ActivityRecord prev, Bundle options)</li> <li>ActivityStackSupervisor . <code>startSpecificActivityLocked</code>(ActivityRecord r, boolean andResume, boolean checkConfig)</li> </ul> <p>ActivityManagerService \u54cd\u5e94\u8de8\u8fdb\u7a0b\u8c03\u7528\u6267\u884c<code>startActivity</code>\u65b9\u6cd5\uff0c\u65b9\u6cd5\u5185\u6267\u884c<code>startActivityAsUser</code>\u65b9\u6cd5\u3002</p> <p>\u63a5\u7740\u6267\u884c<code>startActivityMayWait</code>\u65b9\u6cd5\uff0c\u9996\u5148\u901a\u8fc7 <code>PackageManager</code>\u89e3\u6790\u5f85\u542f\u52a8 Activity \u7684 Intent \u4fe1\u606f\uff0c\u5f97\u5230\u4e86\u5305\u542b\u66f4\u591a\u4fe1\u606f\u7684 <code>ActivityInfo</code>\u5bf9\u8c61\u3002</p> <p>\u63a5\u7740\u5f00\u59cb\u6267\u884c<code>startActivityLocked</code>\u65b9\u6cd5\uff0c\u521b\u5efa\u4e00\u4e2a\u5f85\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u7684 <code>ActivityRecord</code>\u5bf9\u8c61\uff0c\u91cc\u9762\u5305\u542b\u4e86\u76f8\u5173\u4fe1\u606f\u3002\u5728\u63a5\u4e0b\u6765\u7684\u65b9\u6cd5<code>startActivityUncheckedLocked</code>\u4e2d\u4e3a\u5f85\u542f\u52a8\u7684 Activity \u7ec4\u4ef6\u627e\u5230\u5b83\u7684 <code>Task</code> \u4efb\u52a1\uff0c\u7531\u4e8e\u662f\u65b0\u5efa\u7684 Activity\uff0c\u5219\u76f4\u63a5\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684 <code>Task</code>\u3002\u800c\u8fd9\u4e2a <code>Task</code>\u4e5f\u662f <code>ActivityRecord</code>\u7684\u6210\u5458\u53d8\u91cf<code>task</code>\u3002\u7531\u8fd9\u4e2a <code>TaskRecord</code>\u5f97\u5230\u5b83\u7684\u6210\u5458\u53d8\u91cf<code>ActivityStack</code> \uff0c\u7ba1\u7406 Activity \u7684\u5806\u6808\u3002</p> <p>\u63a5\u4e0b\u6765\u4fbf\u6267\u884c <code>ActivityStack</code>\u7c7b\u7684<code>startActivityLocked</code>\u65b9\u6cd5\uff0c \u9996\u5148\u5c06\u5f85\u542f\u52a8\u7684 ActivityRecord \u4f4d\u4e8e\u6808\u9876\uff0c\u7136\u540e\u6267\u884c <code>resumeTopActivitiesLocked</code>\u65b9\u6cd5\uff0c\u5c06\u6240\u6709 ActivityStack \u6808\u9876\u7684 ActivityRecord \u8fd0\u884c\u81f3 <code>Resumed</code> \u72b6\u6001\uff0c\u5176\u4e2d\u90fd\u662f\u8c03\u7528\u7684<code>resumeTopActivityLocked</code>\u65b9\u6cd5\uff0c\u800c\u8be5\u65b9\u6cd5\u5185\u90e8\u53c8\u662f\u8c03\u7528\u7684<code>resumeTopActivityInnerLocked</code>\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u4f1a\u505a\u4e00\u7cfb\u5217\u7684\u5224\u65ad\uff0c\u5224\u65ad\u5f53\u5e74\u80fd\u591f\u5c06 ActivityStack \u6808\u9876\u7684 Activity \u8fd0\u884c\u81f3 <code>Resumed</code>\u72b6\u6001\uff0c\u6bd4\u5982\uff1a\u5f53\u6709 Activity \u6ca1\u6709\u8fdb\u5165 <code>Paused</code> \u72b6\u6001\u65f6\uff0c\u4fbf\u4f1a\u901a\u8fc7\u8de8\u8fdb\u7a0b\u901a\u4fe1\u6765\u901a\u77e5\u5b83\u8fdb\u5165 <code>Paused</code> \u72b6\u6001\u3002\u5f53\u6240\u6709\u7684\u72b6\u6001\u90fd\u6ee1\u8db3\u4e86\uff0c\u51c6\u5907\u5c31\u7eea\u4e86\uff0c\u5c31\u4f1a\u53bb\u68c0\u67e5\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u662f\u5426\u542f\u52a8\u4e86\uff0c\u5982\u679c\u6ca1\u6709\u5219\u53bb\u521b\u5efa\u8fdb\u7a0b\uff0c\u5426\u5219\u8ba9 Activity \u7ec4\u4ef6\u8fd0\u884c\u81f3 <code>Resumed</code> \u72b6\u6001\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-4/#activitymanagerservice_1","title":"ActivityManagerService \u521b\u5efa\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b","text":"<ul> <li>ActivityStackSupervisor . <code>startSpecificActivityLocked</code>(ActivityRecord r, boolean andResume, boolean checkConfig)</li> <li> <p>ActivityManagerService . <code>startProcessLocked</code>(...)</p> </li> <li> <p>ActivityManagerService . <code>newProcessRecordLocked</code>(ApplicationInfo info, String customProcess, boolean isolated, int isolatedUid)</p> </li> <li>ActivityManagerService . <code>startProcessLocked</code>(...)</li> </ul> <p><code>startSpecificActivityLocked</code>\u65b9\u6cd5\u4f1a\u521b\u5efa\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u5728 <code>startProcessLocked</code>\u65b9\u6cd5\u5185\u90e8\u6839\u636e\u8fdb\u7a0b\u540d\u79f0\u548c\u7528\u6237 ID \u68c0\u67e5\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\uff0c\u5219\u8c03\u7528\u4e86<code>newProcessRecordLocked</code>\u65b9\u6cd5\u521b\u5efa\u4e86\u4e00\u4e2a<code>ProcessRecord</code>\u5bf9\u8c61\uff0c\u5b83\u5305\u542b\u4e86\u8fdb\u7a0b\u7684\u57fa\u672c\u4fe1\u606f\uff0c\u6839\u636e\u8fd9\u4e2a <code>ProcessRecord</code>\u5bf9\u8c61\uff0c\u5728<code>startProcessLocked</code>\u51fd\u6570\u7684\u53e6\u4e00\u5f62\u5f0f\u4e2d\u53bb\u521b\u5efa\u4e86\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u3002</p> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u521b\u5efa\u6210\u529f\u540e\uff0c\u4f1a\u5f97\u5230\u4e00\u4e2a\u5927\u4e8e 0 \u7684\u8fdb\u7a0b ID \uff0c\u800c ActivityManagerService \u5c31\u4ee5\u8fd9\u4e2a ID \u4e3a\u5173\u952e\u5b57\u5c06\u8fd9\u4e2a\u8fdb\u7a0b\u5bf9\u5e94\u7684 ProcessRecord \u4fdd\u5b58\u5728\u53d8\u91cf<code>mPidsSelfLocked</code>\u4e2d\uff0c\u4ee5\u4fbf ActivityManagerService \u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a ID \u627e\u5230\u8be5\u8fdb\u7a0b\u7684\u8bb0\u5f55\u4fe1\u606f\u3002</p> <p>\u5f53\u8fdb\u7a0b\u521b\u5efa\u6210\u529f\u540e\uff0c\u4fbf\u4f1a\u5f00\u59cb\u8fd0\u884c\u4e86\uff0c\u800c Java \u7a0b\u5e8f\u7684\u5165\u53e3\u5c31\u662f <code>main</code>\u51fd\u6570\u4e86\u3002</p>","tags":["Android"]},{"location":"android/framework/android-start-activity-from-launcher-4/#activity","title":"Activity \u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u542f\u52a8","text":"<ul> <li> <p>ActivityThread . <code>main</code>(...)</p> </li> <li> <p>ActivityThread . <code>attach</code>(boolean system)</p> </li> <li>ActivityManagerService . <code>attachApplication</code>(IApplicationThread thread)</li> <li>ActivityManagerService . <code>attachApplicationLocked</code>(IApplicationThread thread, int pid)</li> <li>ApplicationThread . <code>bindApplication</code>(...)</li> <li>ActivityThread . <code>handleBindApplication</code>(AppBindData data)</li> <li>StackSupervisor . <code>attachApplicationLocked</code>(ProcessRecord app)</li> <li>StackSupervisor .  <code>realStartActivityLocked</code>(ActivityRecord r, ProcessRecord app, boolean andResume, boolean checkConfig)</li> <li>ApplicationThread . <code>scheduleLaunchActivity</code>(...)</li> <li>ActivityThread . <code>handleLaunchActivity</code>(ActivityClientRecord r, Intent customIntent)</li> <li>ActivityThread . <code>performLaunchActivity</code>(ActivityClientRecord r, Intent customIntent)</li> <li>ActivityThread . <code>handleResumeActivity</code>(IBinder token, boolean clearHide, boolean isForward, boolean reallyResume)</li> <li>ActivityThread . <code>performResumeActivity</code>(IBinder token, boolean clearHide) </li> </ul> <p>\u7531\u4e8e Process \u7c7b\u7684 start \u65b9\u6cd5\u6307\u5b9a\u4e86 ActivityThread \u7c7b\u7684 <code>main</code> \u65b9\u6cd5\u4f5c\u4e3a\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5f00\u59cb\u70b9\uff0c\u8ddf\u8fdb main \u65b9\u6cd5\uff0c\u521d\u59cb\u5316\u7ebf\u7a0b\u6d88\u606f\u5faa\u73af\uff0c\u5e76\u4e14\u5728 <code>attach</code>\u65b9\u6cd5\u4e2d\u5411 ActivityManagerService \u8de8\u8fdb\u7a0b\u53d1\u9001\u8bf7\u6c42\uff0c\u8981\u6c42 ActivityManagerService \u5c06\u5f53\u524d\u8fdb\u7a0b\u6dfb\u52a0 Application \uff0c\u6bd5\u7adf\u8fd9\u8fd8\u662f\u4e2a\u5355\u7eaf\u7684\u8fdb\u7a0b\uff0c\u5e76\u4e0d\u662f Android \u8fdb\u7a0b\u3002</p> <p>\u4e8e\u662f ActivityManagerService \u6267\u884c\u4e86 <code>attachApplication</code>\u65b9\u6cd5\u54cd\u5e94\u8fd9\u4e2a\u8de8\u8fdb\u7a0b\u8bf7\u6c42\uff0c\u63a5\u7740\u53c8\u7ee7\u7eed\u8c03\u7528\u4e86 <code>attachApplicationLocked</code>\u65b9\u6cd5\uff0c\u4ece<code>mPidsSelfLocked</code>\u53d8\u91cf\u4e2d\u6839\u636e PID \u627e\u5230 Activity \u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5bf9\u5e94\u7684 <code>ProcessRecord</code> \u3002\u7136\u540e\u5c06<code>ProcessRecord</code>\u7ed1\u5b9a\u5230\u5e94\u7528\u8fdb\u7a0b\uff0c\u5c06<code>ApplicationThread</code>\u8d4b\u503c\u7ed9<code>ProcessRecord</code>\u7684\u6210\u5458\u53d8\u91cf<code>thread</code>\uff0c\u8fd9\u6837\u5c31\u80fd ActivityManagerService \u5c31\u80fd\u901a\u8fc7\u5b83\u6765\u548c Activity \u901a\u4fe1\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765 ActivityManagerService \u53c8\u53d1\u8d77\u8de8\u8fdb\u7a0b\u8c03\u7528\uff0c\u901a\u8fc7 <code>ApplicationThread</code>\u7684<code>bindApplication</code>\u65b9\u6cd5\u3002ActivityThread \u4e3b\u7ebf\u7a0b\u6d88\u606f\u5faa\u73af\u6536\u5230 Handler \u53d1\u9001\u7684\u6d88\u606f\uff0c\u54cd\u5e94\u65b9\u6cd5\u4e3a<code>handleBindApplication</code>\u3002\u5728\u6b64\u65b9\u6cd5\u5185\uff0c\u521b\u5efa\u4e86Application \u8fd0\u884c\u73af\u5883\u4e0a\u4e0b\u6587<code>Context</code>\u3001\u76d1\u63a7\u7a0b\u5e8f\u4e0e\u7cfb\u7edf\u4ea4\u4e92\u7684<code>Instrumentation</code>\u3001\u5e94\u7528\u7a0b\u5e8f\u7684<code>Application</code>\u3001\u5e76\u4e14\u8c03\u7528\u4e86<code>Application</code>\u7684 onCreate \u65b9\u6cd5\u3002</p> <p>\u5f53 ActivityManagerService \u5c06 Activity \u7684 Application \u521b\u5efa\u5b8c\u6210\u540e\uff0c\u53c8\u5f00\u59cb\u8c03\u5ea6 Activity \u7684\u751f\u547d\u5468\u671f\u4e86\u3002\u901a\u8fc7 StackSupervisor \u7c7b\u7684 <code>attachApplicationLocked</code>\u65b9\u6cd5\uff0c\u627e\u5230\u4f4d\u4e8e\u6808\u9876\u7684 <code>ActivityRecord</code>\u5bf9\u8c61\uff0c\u68c0\u67e5\u8fd9\u4e2a Activity \u7ec4\u4ef6\u7684\u7528\u6237 ID \u548c\u8fdb\u7a0b\u540d\u662f\u5426\u4e0e ProcessRecord \u5bf9\u8c61\u6240\u63cf\u8ff0\u7684\u4e00\u81f4\uff0c\u5982\u679c\u4e00\u81f4\uff0c\u5219\u8c03\u7528<code>realStartActivityLocked</code>\u771f\u6b63\u7684\u5f00\u542f\u4e00\u4e2a Activity \u7ec4\u4ef6\u4e86\u3002</p> <p>\u5f00\u542f\u4e00\u4e2a Activity \u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u5f53\u7136\u662f\u5728\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5185\u4e86\uff0c\u6b64\u65f6\u53c8\u662f ActivityManagerService \u7684\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff0c\u6267\u884c ApplicationThread \u7684 <code>scheduleLaunchActivity</code>\uff0cActivityThread \u7684\u6d88\u606f\u5faa\u73af\u54cd\u5e94\u65b9\u6cd5\u4e3a <code>handleLaunchActivity</code>\u3002\u5728\u8be5\u65b9\u6cd5\u5185\u53c8\u7ee7\u7eed\u6267\u884c <code>performLaunchActivity</code>\u5c06 Activity \u7ec4\u4ef6\u542f\u52a8\u8d77\u6765\u3002\u901a\u8fc7\u53cd\u5c04\u521b\u5efa\u4e86\u4e00\u4e2a Activity \u5bf9\u8c61\uff0c\u5e76\u4e14\u521b\u5efa\u4e86 Activity \u7684\u8fd0\u884c\u73af\u5883\u4e0a\u4e0b\u6587\uff0c\u901a\u8fc7 <code>Instrumentation</code> \u6267\u884c\u4e86 Activity \u7684 onCreate \u65b9\u6cd5\u3001onStart \u65b9\u6cd5\u3002\u63a5\u7740\u53c8\u6267\u884c\u4e86<code>handleResumeActivity</code>\u65b9\u6cd5\u8ba9 Activity \u8fd0\u884c\u5230 <code>Resumed</code>\u72b6\u6001\uff0c\u771f\u6b63\u6267\u884c\u64cd\u4f5c\u7684\u662f<code>performResumeActivity</code>\u65b9\u6cd5\uff0c\u800c\u6700\u7ec8\u8fd8\u662f\u8c03\u7528 <code>Instrumentation</code>\u7c7b\u7684<code>callActivityOnResume</code>\u65b9\u6cd5\u3002</p> <p>\u81f3\u6b64\uff0c\u4e00\u4e2a Activity \u7ec4\u4ef6\u5c31\u5df2\u7ecf\u521b\u5efa\u6210\u529f\u4e86\uff0c\u91cc\u9762\u5177\u4f53\u7684\u4ee3\u7801\u7ec6\u8282\u6682\u4e0d\u6df1\u5165\u8ba8\u8bba\u4e86\uff0c\u6bd4\u5982 Activity \u7684\u52a0\u8f7d\u4e4b\u7c7b\u7684\u3002</p>","tags":["Android"]},{"location":"android/jni/android-jni-access-field-and-method/","title":"Android \u901a\u8fc7 JNI \u8bbf\u95ee Java \u5b57\u6bb5\u548c\u65b9\u6cd5\u8c03\u7528","text":"<p>\u5728\u524d\u9762\u7684\u4e24\u7bc7\u6587\u7ae0\u4e2d\uff0c\u4ecb\u7ecd\u4e86 Android \u901a\u8fc7 JNI \u8fdb\u884c\u57fa\u7840\u7c7b\u578b\u3001\u5b57\u7b26\u4e32\u548c\u6570\u7ec4\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u5e76\u63cf\u8ff0\u4e86 Java \u548c Native \u5728\u7c7b\u578b\u548c\u7b7e\u540d\u4e4b\u95f4\u7684\u8f6c\u6362\u5173\u7cfb\u3002</p> <p>\u6709\u4e86\u4e4b\u524d\u90a3\u4e9b\u57fa\u7840\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0 Java \u548c Native \u7684\u76f8\u4e92\u8c03\u7528\u4e86\uff0c\u5728 Native \u4e2d\u53bb\u8bbf\u95ee Java \u7c7b\u7684\u5b57\u6bb5\u5e76\u8c03\u7528\u76f8\u5e94\u7684\u65b9\u6cd5\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-access-field-and-method/#_1","title":"\u8bbf\u95ee\u5b57\u6bb5","text":"<p>Native \u65b9\u6cd5\u8bbf\u95ee Java \u7684\u5b57\u6bb5\u6709\u4e24\u79cd\u5f62\u5f0f\uff0c\u5206\u522b\u662f\u8bbf\u95ee\u7c7b\u7684\u5b9e\u4f8b\u5b57\u6bb5\u548c\u8bbf\u95ee\u7c7b\u7684\u9759\u6001\u5b57\u6bb5\u3002</p> <p>\u4e0d\u7ba1\u54ea\u79cd\u64cd\u4f5c\uff0c\u9996\u5148\u8981\u5b9a\u4e49\u4e00\u4e2a\u5177\u4f53\u7684 Java \u7c7b\u578b\uff0c\u5176\u4e2d\uff0c\u6709\u5b9e\u4f8b\u7684\u5b57\u6bb5\u7c7b\u578b\u548c\u65b9\u6cd5\uff0c\u4e5f\u6709\u9759\u6001\u7684\u5b57\u6bb5\u7c7b\u578b\u548c\u65b9\u6cd5\u3002</p> <pre><code>public class Animal {\n    protected String name;\n    public static int num = 0;\n    public Animal(String name) {\n        this.name = name;\n    }\n    public String getName() {\n        return this.name;\n    }\n    public int getNum() {\n        return num;\n    }\n}\n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-access-field-and-method/#_2","title":"\u8bbf\u95ee\u7c7b\u7684\u5b9e\u4f8b\u5b57\u6bb5","text":"<p>\u8bbf\u95ee Java \u7c7b\u7684\u5b57\u6bb5\uff0c\u5927\u81f4\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u83b7\u53d6 Java \u5bf9\u8c61\u7684\u7c7b</li> <li>\u83b7\u53d6\u5bf9\u5e94\u5b57\u6bb5\u7684 id</li> <li>\u83b7\u53d6\u5177\u4f53\u7684\u5b57\u6bb5\u503c</li> </ol> <p>\u4ee5\u8bbf\u95ee\u4ee5\u4e0a Animal \u7c7b\u7684 name \u5b57\u6bb5\uff0c\u5e76\u5c06\u5176\u4fee\u6539\u4e3a\u4f8b\uff1a</p> <pre><code>private native void accessInstanceFiled(Animal animal);\n</code></pre> <p>\u5bf9\u5e94\u7684 C++ \u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>extern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_FieldAndMethodOps_accessInstanceFiled(JNIEnv *env,jobject instance, jobject animal) {\n    jfieldID fid; // \u60f3\u8981\u83b7\u53d6\u7684\u5b57\u6bb5 id\n    jstring jstr; // \u5b57\u6bb5\u5bf9\u5e94\u7684\u5177\u4f53\u7684\u503c\n    const char *str; // \u5c06 Java \u7684\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a Native \u7684\u5b57\u7b26\u4e32\n    jclass cls = env-&gt;GetObjectClass(animal); // \u83b7\u53d6 Java \u5bf9\u8c61\u7684\u7c7b\n    fid = env-&gt;GetFieldID(cls, \"name\", \"Ljava/lang/String;\"); // \u83b7\u53d6\u5bf9\u5e94\u5b57\u6bb5\u7684 id\n    if (fid == NULL) { // \u5982\u679c\u5b57\u6bb5\u4e3a NULL \uff0c\u76f4\u63a5\u9000\u51fa\uff0c\u67e5\u627e\u5931\u8d25\n        return;\n    }\n    jstr = (jstring) env-&gt;GetObjectField(animal, fid); // \u83b7\u53d6\u5b57\u6bb5\u5bf9\u5e94\u7684\u503c\n    str = env-&gt;GetStringUTFChars(jstr, NULL);\n    if (str == NULL) {\n        return;\n    }\n    LOGD(\"name is %s\", str);\n    env-&gt;ReleaseStringUTFChars(jstr, str);\n    jstr = env-&gt;NewStringUTF(\"replaced name\");\n    if (jstr == NULL) {\n        return;\n    }\n    env-&gt;SetObjectField(animal, fid, jstr); // \u4fee\u6539\u5b57\u6bb5\u5bf9\u5e94\u7684\u503c \n}\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u9996\u5148\u901a\u8fc7 <code>GetObjectClass</code> \u51fd\u6570\u83b7\u53d6\u5bf9\u5e94\u7684 Java \u7c7b\uff0c\u5176\u53c2\u6570\u5c31\u662f\u8981\u83b7\u5f97\u7684\u5bf9\u8c61\u7c7b\u578b jobject \uff0c\u7136\u540e\u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662f\u4e00\u4e2a jclass \u7c7b\u578b\u7684\u503c\uff0c\u4ee3\u8868 Java \u7684 Class \u7c7b\u578b\u3002</p> <p>\u5176\u6b21\u662f\u901a\u8fc7 <code>GetFieldID</code> \u65b9\u6cd5\u83b7\u5f97 Java \u7c7b\u578b\u5bf9\u5e94\u7684\u5b57\u6bb5 id \u3002\u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u662f\u4e4b\u524d\u83b7\u5f97\u7684 Java \u7c7b\u578b\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f\u5728 Java \u4e2d\u5b57\u6bb5\u7684\u5177\u4f53\u540d\u5b57\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u5c31\u662f\u5b57\u6bb5\u5bf9\u5e94\u7684\u5177\u4f53\u7c7b\u578b\uff0c\u8fd9\u4e2a\u7c7b\u578b\u7684\u7b7e\u540d\u63cf\u8ff0\u8981\u8f6c\u6362\u6210 Native \u7684\u8868\u793a\u5f62\u5f0f\uff0c\u4e5f\u5c31\u662f\u4e4b\u524d\u63d0\u5230\u7684 Java \u548c Native \u7684\u7b7e\u540d\u8f6c\u6362\u3002</p> <p>\u5f97\u5230\u4e86 Java \u7c7b\u578b\u548c\u5b57\u6bb5\u7684 id \u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7 <code>GetObjectField</code> \u65b9\u6cd5\u6765\u83b7\u53d6\u5177\u4f53\u7684\u503c\uff0c\u5b83\u7684\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u662f\u4e4b\u524d\u83b7\u5f97\u7684 Java \u7c7b\u578b\u548c\u5b57\u6bb5 id \u3002</p> <p><code>GetObjectField</code> \u65b9\u6cd5\u6709\u5f88\u591a\u5f62\u6001\uff0c\u5bf9\u4e8e\u5b57\u6bb5\u503c\u662f\u5f15\u7528\u7c7b\u578b\u7684\uff0c\u7edf\u4e00\u662f <code>GetObjectField</code>\uff0c\u7136\u540e\u5f97\u5230\u7684\u7ed3\u679c\u8f6c\u578b\u4e3a\u60f3\u8981\u7684\u7c7b\u578b\u3002\u5bf9\u4e8e\u57fa\u7840\u7c7b\u578b\uff0c\u5219\u6709\u5219\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982 <code>GetBooleanField</code>\u3001<code>GetIntField</code>\u3001<code>GetDoubleField</code> \u7b49\u7b49\u3002</p> <p>\u5f97\u5230\u4e86\u5b57\u6bb5\u7684\u503c\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u60f3\u8981\u7684\u64cd\u4f5c\u4e86\u3002</p> <p>\u6700\u540e\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 <code>SetObjectField</code> \u65b9\u6cd5\u6765\u4fee\u6539\u5b57\u6bb5\u5bf9\u5e94\u7684\u503c\u3002\u5b83\u7684\u524d\u4e24\u4e2a\u53c2\u6570\u4e5f\u662f\u5bf9\u5e94\u7684 Java \u7c7b\u578b\u548c\u5b57\u6bb5 id\uff0c\u6700\u540e\u7684\u53c2\u6570\u5219\u662f\u5177\u4f53\u7684\u503c\uff0c\u6b64\u65b9\u6cd5\u4e5f\u662f\u9488\u5bf9\u4e8e\u5b57\u6bb5\u7c7b\u578b\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u800c\u5bf9\u4e8e\u57fa\u7840\u7c7b\u578b\uff0c\u4e5f\u6709\u7740\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982 <code>SetBooleanField</code>\u3001<code>SetCharField</code>\u3001<code>SetDoubleField</code>\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-access-field-and-method/#_3","title":"\u8bbf\u95ee\u7c7b\u7684\u9759\u6001\u5b57\u6bb5","text":"<p>\u8bbf\u95ee\u7c7b\u7684\u9759\u6001\u5b57\u6bb5\uff0c\u5927\u81f4\u6b65\u9aa4\u548c\u7c7b\u7684\u5b9e\u4f8b\u5b57\u6bb5\u7c7b\u4f3c\uff1a</p> <pre><code>private native void accessStaticField(Animal animal);\n</code></pre> <p>\u5bf9\u5e94\u7684 C++ \u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>extern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_FieldAndMethodOps_accessStaticField(JNIEnv *env, jobject instance,jobject animal) {\n    jfieldID fid;\n    jint num;\n    jclass cls = env-&gt;GetObjectClass(animal);\n    fid = env-&gt;GetStaticFieldID(cls, \"num\", \"I\");\n    if (fid == NULL) {\n        return;\n    }\n    num = env-&gt;GetStaticIntField(cls, fid);\n    LOGD(\"get static field num is %d\", num);\n    env-&gt;SetStaticIntField(cls, fid, ++num);\n}\n</code></pre></p> <p>\u7c7b\u7684\u9759\u6001\u548c\u5b9e\u4f8b\u5b57\u6bb5\u7684\u8bbf\u95ee\u6700\u5927\u4e0d\u540c\u5c31\u5728\u4e8e\uff0cJNI \u8c03\u7528\u5bf9\u5e94\u7684\u65b9\u6cd5\u4e0d\u540c\u3002\u5bf9\u4e8e\u7c7b\u7684\u9759\u6001\u5b57\u6bb5\uff0cJNI \u7684\u65b9\u6cd5\u591a\u4e86 <code>Static</code> \u7684\u6807\u5fd7\u6765\u8868\u660e\u8fd9\u4e2a\u5bf9\u5e94\u4e8e\u7c7b\u7684\u9759\u6001\u5b57\u6bb5\u8bbf\u95ee\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-access-field-and-method/#_4","title":"\u65b9\u6cd5\u8c03\u7528","text":"<p>JNI \u8c03\u7528 Java \u65b9\u6cd5\u548c JNI \u8bbf\u95ee Java \u5b57\u6bb5\u7684\u6b65\u9aa4\u4e5f\u5927\u81f4\u76f8\u540c\uff0c</p> <ol> <li>\u83b7\u53d6 Java \u5bf9\u8c61\u7684\u7c7b</li> <li>\u83b7\u53d6\u5bf9\u5e94\u65b9\u6cd5\u7684 id</li> <li>\u8c03\u7528\u5177\u4f53\u7684\u65b9\u6cd5</li> </ol> <p>\u4ee5\u8c03\u7528\u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5\u548c\u9759\u6001\u65b9\u6cd5\u4e3a\u4f8b\uff1a</p>","tags":["NDK"]},{"location":"android/jni/android-jni-access-field-and-method/#_5","title":"\u8c03\u7528\u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5","text":"<p>JNI \u8c03\u7528 Java \u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5</p> <pre><code>    private native void callInstanceMethod(Animal animal);\n</code></pre> <p>\u5bf9\u5e94 C++ \u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>// Native \u8bbf\u95ee Java \u7684\u7c7b\u5b9e\u4f8b\u65b9\u6cd5\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_FieldAndMethodOps_callInstanceMethod(JNIEnv *env, jobject instance,jobject animal) {\n    jclass cls = env-&gt;GetObjectClass(animal); // \u83b7\u5f97\u5177\u4f53\u7684\u7c7b\n    jmethodID mid = env-&gt;GetMethodID(cls, \"callInstanceMethod\", \"(I)V\"); // \u83b7\u5f97\u5177\u4f53\u7684\u65b9\u6cd5 id\n    if (mid == NULL) {\n        return;\n    }\n    env-&gt;CallVoidMethod(animal, mid, 2); // \u8c03\u7528\u65b9\u6cd5\n}\n</code></pre></p> <p>\u4e0e\u8bbf\u95ee\u5b57\u6bb5\u4e0d\u540c\u7684\u662f\uff0c<code>GetFieldID</code> \u65b9\u6cd5\u6362\u6210\u4e86 <code>GetMethodID</code> \u65b9\u6cd5\uff0c\u53e6\u5916\u7531 <code>CallVoidMethod</code> \u51fd\u6570\u6765\u8c03\u7528\u5177\u4f53\u7684\u65b9\u6cd5\uff0c\u524d\u9762\u4e24\u4e2a\u53c2\u6570\u662f\u83b7\u5f97\u7684\u7c7b\u548c\u65b9\u6cd5 id\uff0c\u6700\u540e\u7684\u53c2\u6570\u662f\u5177\u4f53\u8c03\u7528\u65b9\u6cd5\u7684\u53c2\u6570\u3002</p> <p><code>GetMethodID</code> \u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u662f\u5177\u4f53\u7684 Java \u7c7b\u578b\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8be5 Java \u7c7b\u7684\u5bf9\u5e94\u5b9e\u4f8b\u65b9\u6cd5\u7684\u540d\u79f0\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u5c31\u662f\u8be5\u65b9\u6cd5\u5bf9\u5e94\u7684\u8fd4\u56de\u7c7b\u578b\u548c\u53c2\u6570\u7b7e\u540d\u8f6c\u6362\u6210 Native \u5bf9\u5e94\u7684\u63cf\u8ff0\u3002</p> <p>\u5bf9\u4e8e\u4e0d\u9700\u8981\u8fd4\u56de\u503c\u7684\u51fd\u6570\uff0c\u8c03\u7528 <code>CallVoidMethod</code> \u5373\u53ef\uff0c\u5bf9\u4e8e\u8fd4\u56de\u503c\u4e3a\u5f15\u7528\u7c7b\u578b\u7684\uff0c\u8c03\u7528 <code>CallObjectMethod</code> \u65b9\u6cd5\uff0c\u5bf9\u4e8e\u8fd4\u56de\u57fa\u7840\u7c7b\u578b\u7684\u65b9\u6cd5\uff0c\u5219\u6709\u5404\u81ea\u5bf9\u5e94\u7684\u65b9\u6cd5\u8c03\u7528\uff0c\u6bd4\u5982\uff1a<code>CallBooleanMethod</code>\u3001<code>CallShortMethod</code>\u3001<code>CallDoubleMethod</code> \u7b49\u7b49\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-access-field-and-method/#_6","title":"\u8c03\u7528\u7c7b\u7684\u9759\u6001\u65b9\u6cd5","text":"<p>\u5bf9\u4e8e\u8c03\u7528\u7c7b\u7684\u9759\u6001\u65b9\u6cd5\u548c\u8c03\u7528\u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5\u7c7b\u4f3c\uff1a</p> <p><pre><code>    private native void callStaticMethod(Animal animal);\n</code></pre> \u5bf9\u5e94 C++ \u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>// Native \u8bbf\u95ee Java \u7684\u9759\u6001\u65b9\u6cd5\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_FieldAndMethodOps_callStaticMethod(JNIEnv *env,jobject instance, jobject animal) {\n    jclass cls = env-&gt;GetObjectClass(animal);\n    jmethodID argsmid = env-&gt;GetStaticMethodID(cls, \"callStaticMethod\",\n                                               \"(Ljava/lang/String;)Ljava/lang/String;\");\n    if (argsmid == NULL) {\n        return;\n    }\n    jstring jstr = env-&gt;NewStringUTF(\"jstring\");\n    env-&gt;CallStaticObjectMethod(cls, argsmid, jstr);\n</code></pre></p> <p>\u8c03\u7528\u7c7b\u7684\u9759\u6001\u65b9\u6cd5 callStaticMethod\uff0c\u8be5\u65b9\u6cd5\u9700\u8981\u4f20\u9012\u4e00\u4e2a String \u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u540c\u65f6\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u53c2\u6570\u3002</p> <p>\u5177\u4f53\u7684\u8c03\u7528\u8fc7\u7a0b\u548c\u8c03\u7528\u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5\u7c7b\u4f3c\uff0c\u5dee\u522b\u4e5f\u53ea\u662f\u5728\u4e8e\u8c03\u7528\u65b9\u6cd5\u540d\u591a\u52a0\u4e86\u4e00\u4e2a Static \u7684\u6807\u8bc6\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-access-field-and-method/#_7","title":"\u5c0f\u7ed3","text":"<p>\u53ef\u4ee5\u770b\u5230\uff0c\u4ece JNI \u4e2d\u8bbf\u95ee Java \u7684\u5b57\u6bb5\u548c\u8bbf\u95ee\uff0c\u4e24\u8005\u7684\u6b65\u9aa4\u90fd\u662f\u5927\u81f4\u76f8\u4f3c\u7684\uff0c\u53ea\u662f\u8c03\u7528\u7684 JNI \u65b9\u6cd5\u6709\u6240\u533a\u522b\u3002</p> <p>\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u53c2\u8003\u6211\u7684 Github \u9879\u76ee https://github.com/glumes/AndroidDevWithCpp\uff0c\u6b22\u8fce Star\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-array-operation/","title":"Android JNI \u6570\u7ec4 \u64cd\u4f5c","text":"<p>JNI \u4e2d\u6709\u4e24\u79cd\u6570\u7ec4\u64cd\u4f5c\uff0c\u57fa\u7840\u6570\u636e\u7c7b\u578b\u6570\u7ec4\u548c\u5bf9\u8c61\u6570\u7ec4\uff0cJNI \u5bf9\u5f85\u57fa\u7840\u6570\u636e\u7c7b\u578b\u6570\u7ec4\u548c\u5bf9\u8c61\u6570\u7ec4\u662f\u4e0d\u4e00\u6837\u7684\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-array-operation/#_1","title":"\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6570\u7ec4","text":"<p>\u5bf9\u4e8e\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6570\u7ec4\uff0cJNI \u90fd\u6709\u548c Java \u76f8\u5bf9\u5e94\u7684\u7ed3\u6784\uff0c\u5728\u4f7f\u7528\u8d77\u6765\u548c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u4f7f\u7528\u7c7b\u4f3c\u3002</p> <p>\u5728 Android JNI \u57fa\u7840\u77e5\u8bc6\u7bc7\u63d0\u5230\u4e86 Java \u6570\u7ec4\u7c7b\u578b\u5bf9\u5e94\u7684 JNI \u6570\u7ec4\u7c7b\u578b\u3002\u6bd4\u5982\uff0cJava int \u6570\u7ec4\u5bf9\u5e94\u4e86 jintArray\uff0cboolean \u6570\u7ec4\u5bf9\u5e94\u4e86 jbooleanArray\u3002</p> <p>\u5982\u540c String \u7684\u64cd\u4f5c\u4e00\u6837\uff0cJNI \u63d0\u4f9b\u4e86\u5bf9\u5e94\u7684\u8f6c\u6362\u51fd\u6570\uff1aGetArrayElements\u3001ReleaseArrayElements\u3002</p> <pre><code>    intArray = env-&gt;GetIntArrayElements(intArray_, NULL);\n    env-&gt;ReleaseIntArrayElements(intArray_, intArray, 0);\n</code></pre> <p>\u53e6\u5916\uff0cJNI \u8fd8\u63d0\u4f9b\u4e86\u5982\u4e0b\u7684\u51fd\u6570\uff1a</p> <ul> <li>GetTypeArrayRegion / SetTypeArrayRegion</li> </ul> <p>\u5c06\u6570\u7ec4\u5185\u5bb9\u590d\u5236\u5230 C \u7f13\u51b2\u533a\u5185\uff0c\u6216\u5c06\u7f13\u51b2\u533a\u5185\u7684\u5185\u5bb9\u590d\u5236\u5230\u6570\u7ec4\u4e0a\u3002</p> <ul> <li>GetArrayLength</li> </ul> <p>\u5f97\u5230\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u4e5f\u5c31\u662f\u957f\u5ea6\u3002</p> <ul> <li>NewTypeArray</li> </ul> <p>\u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u6570\u636e\u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u5e76\u4e14\u901a\u8fc7 SetTypeArrayRegion \u6765\u7ed9\u6307\u5b9a\u7c7b\u578b\u6570\u7ec4\u8d4b\u503c\u3002</p> <ul> <li>GetPrimitiveArrayCritical / ReleasePrimitiveArrayCritical</li> </ul> <p>\u5982\u540c String \u4e2d\u7684\u64cd\u4f5c\u4e00\u6837\uff0c\u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u57fa\u7840\u6570\u636e\u7c7b\u578b\u6570\u7ec4\u7684\u76f4\u63a5\u6307\u9488\uff0c\u5728\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u95f4\u4e0d\u80fd\u505a\u4efb\u4f55\u963b\u585e\u7684\u64cd\u4f5c\u3002</p> <p>\u5b9e\u9645\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <pre><code>    // Java \u4f20\u9012 \u6570\u7ec4 \u5230 Native \u8fdb\u884c\u6570\u7ec4\u6c42\u548c\n    private native int intArraySum(int[] intArray, int size);\n</code></pre> <p>\u5bf9\u5e94\u7684 C++ \u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>JNIEXPORT jint JNICALL\nJava_com_glumes_cppso_jnioperations_ArrayTypeOps_intArraySum(JNIEnv *env, jobject instance,\n                                                             jintArray intArray_, jint num) {\n    jint *intArray;\n    int sum = 0;\n    // \u64cd\u4f5c\u65b9\u6cd5\u4e00\uff1a\n    // \u5982\u540c getUTFString \u4e00\u6837\uff0c\u4f1a\u7533\u8bf7 native \u5185\u5b58\n    intArray = env-&gt;GetIntArrayElements(intArray_, NULL);\n    if (intArray == NULL) {\n        return 0;\n    }\n    // \u5f97\u5230\u6570\u7ec4\u7684\u957f\u5ea6\n    int length = env-&gt;GetArrayLength(intArray_);\n    LOGD(\"array length is %d\", length);\n    for (int i = 0; i &lt; length; ++i) {\n        sum += intArray[i];\n    }\n    LOGD(\"sum is %d\", sum);\n\n    // \u64cd\u4f5c\u65b9\u6cd5\u4e8c\uff1a\n    jint buf[num];\n    // \u901a\u8fc7 GetIntArrayRegion \u65b9\u6cd5\u6765\u83b7\u53d6\u6570\u7ec4\u5185\u5bb9\n    env-&gt;GetIntArrayRegion(intArray_, 0, num, buf);\n    sum = 0;\n    for (int i = 0; i &lt; num; ++i) {\n        sum += buf[i];\n    }\n    LOGD(\"sum is %d\", sum);\n    // \u4f7f\u7528\u5b8c\u4e86\u522b\u5fd8\u4e86\u91ca\u653e\u5185\u5b58\n    env-&gt;ReleaseIntArrayElements(intArray_, intArray, 0);\n    return sum;\n}\n</code></pre></p> <p>\u5047\u5982\u9700\u8981\u4ece JNI \u4e2d\u8fd4\u56de\u4e00\u4e2a\u57fa\u7840\u6570\u636e\u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u5bf9\u5e94\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>    // \u4ece Native \u8fd4\u56de\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6570\u7ec4\n    private native int[] getIntArray(int num);\n</code></pre> <p>\u5bf9\u5e94\u7684 C++ \u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>/**\n * \u4ece Native \u8fd4\u56de int \u6570\u7ec4\uff0c\u4e3b\u8981\u8c03\u7528 set&lt;Type&gt;ArrayRegion \u6765\u586b\u5145\u6570\u636e\uff0c\u5176\u4ed6\u6570\u636e\u7c7b\u578b\u7c7b\u4f3c\u64cd\u4f5c\n */\nextern \"C\"\nJNIEXPORT jintArray JNICALL\nJava_com_glumes_cppso_jnioperations_ArrayTypeOps_getIntArray(JNIEnv *env, jobject instance,\n                                                             jint num) {\n    jintArray intArray;\n    intArray = env-&gt;NewIntArray(num);\n\n    jint buf[num];\n    for (int i = 0; i &lt; num; ++i) {\n        buf[i] = i * 2;\n    }\n\n    // \u4f7f\u7528 setIntArrayRegion \u6765\u8d4b\u503c\n    env-&gt;SetIntArrayRegion(intArray, 0, num, buf);\n    return intArray;\n}\n</code></pre></p> <p>\u4ee5\u4e0a\u4f8b\u5b50\uff0c\u57fa\u672c\u628a\u76f8\u5173\u7684\u64cd\u4f5c\u90fd\u4f7f\u7528\u4e0a\u4e86\uff0c\u53ef\u4ee5\u53d1\u73b0\u548c String \u7684\u64cd\u4f5c\u5927\u90fd\u662f\u76f8\u4f3c\u7684\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-array-operation/#_2","title":"\u5bf9\u8c61\u6570\u7ec4","text":"<p>\u5bf9\u4e8e\u5bf9\u8c61\u6570\u7ec4\uff0c\u4e5f\u5c31\u662f\u5f15\u7528\u7c7b\u578b\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u7c7b\u578b\u90fd\u662f\u5f15\u7528\u7c7b\u578b\uff0cJNI \u53ea\u63d0\u4f9b\u4e86\u5982\u4e0b\u51fd\u6570\u6765\u64cd\u4f5c\u3002</p> <ul> <li>GetObjectArrayElement / SetObjectArrayElement</li> </ul> <p>\u548c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4e0d\u540c\u7684\u662f\uff0c\u4e0d\u80fd\u4e00\u6b21\u5f97\u5230\u6570\u636e\u4e2d\u7684\u6240\u6709\u5bf9\u8c61\u5143\u7d20\u6216\u8005\u4e00\u6b21\u590d\u5236\u591a\u4e2a\u5bf9\u8c61\u5143\u7d20\u5230\u7f13\u51b2\u533a\u3002\u53ea\u80fd\u901a\u8fc7\u4e0a\u9762\u7684\u51fd\u6570\u6765\u8bbf\u95ee\u6216\u8005\u4fee\u6539\u6307\u5b9a\u4f4d\u7f6e\u7684\u5143\u7d20\u5185\u5bb9\u3002</p> <p>\u5b57\u7b26\u4e32\u548c\u6570\u7ec4\u90fd\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u56e0\u6b64\u4e5f\u53ea\u80fd\u901a\u8fc7\u4e0a\u9762\u7684\u65b9\u6cd5\u6765\u8bbf\u95ee\u3002</p> <p>\u4f8b\u5982\u5728 JNI \u4e2d\u521b\u5efa\u4e00\u4e2a\u4e8c\u7ef4\u7684\u6574\u578b\u6570\u7ec4\u5e76\u8fd4\u56de\uff1a</p> <pre><code>    // \u4ece Native \u8fd4\u56de\u4e8c\u7ef4\u6574\u578b\u6570\u7ec4\uff0c\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u4e00\u7ef4\u6574\u578b\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u9879\u5185\u5bb9\u53c8\u662f\u6570\u7ec4\n    private native int[][] getTwoDimensionalArray(int size);\n</code></pre> <p>\u4e8c\u7ef4\u6570\u7ec4\u5177\u6709\u7279\u6b8a\u6027\u5728\u4e8e\uff0c\u53ef\u4ee5\u5c06\u5b83\u770b\u6210\u4e00\u7ef4\u6570\u7ec4\uff0c\u5176\u4e2d\u6570\u7ec4\u7684\u6bcf\u9879\u5185\u5bb9\u53c8\u662f\u4e00\u7ef4\u6570\u7ec4\u3002</p> <p>\u5177\u4f53 C++ \u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>/**\n * \u4ece Native \u8fd4\u56de\u4e00\u4e2a\u4e8c\u7ef4\u7684\u6574\u578b\u6570\u7ec4\n */\nextern \"C\"\nJNIEXPORT jobjectArray JNICALL\nJava_com_glumes_cppso_jnioperations_ArrayTypeOps_getTwoDimensionalArray(JNIEnv *env,\n                                                                        jobject instance,\n                                                                        jint size) {\n    // \u58f0\u660e\u4e00\u4e2a\u5bf9\u8c61\u6570\u7ec4\n    jobjectArray result;\n    // \u627e\u5230\u5bf9\u8c61\u6570\u7ec4\u4e2d\u5177\u4f53\u7684\u5bf9\u8c61\u7c7b\u578b,[I \u6307\u7684\u5c31\u662f\u6570\u7ec4\u7c7b\u578b\n    jclass intArrayCls = env-&gt;FindClass(\"[I\");\n\n    if (intArrayCls == NULL) {\n        return NULL;\n    }\n    // \u76f8\u5f53\u4e8e\u521d\u59cb\u5316\u4e00\u4e2a\u5bf9\u8c61\u6570\u7ec4\uff0c\u7528\u6307\u5b9a\u7684\u5bf9\u8c61\u7c7b\u578b\n    result = env-&gt;NewObjectArray(size, intArrayCls, NULL);\n\n    if (result == NULL) {\n        return NULL;\n    }\n    for (int i = 0; i &lt; size; ++i) {\n        // \u7528\u6765\u7ed9\u6574\u578b\u6570\u7ec4\u586b\u5145\u6570\u636e\u7684\u7f13\u51b2\u533a\n        jint tmp[256];\n        // \u58f0\u660e\u4e00\u4e2a\u6574\u578b\u6570\u7ec4\n        jintArray iarr = env-&gt;NewIntArray(size);\n        if (iarr == NULL) {\n            return NULL;\n        }\n        for (int j = 0; j &lt; size; ++j) {\n            tmp[j] = i + j;\n        }\n        // \u7ed9\u6574\u578b\u6570\u7ec4\u586b\u5145\u6570\u636e\n        env-&gt;SetIntArrayRegion(iarr, 0, size, tmp);\n        // \u7ed9\u5bf9\u8c61\u6570\u7ec4\u6307\u5b9a\u4f4d\u7f6e\u586b\u5145\u6570\u636e\uff0c\u8fd9\u4e2a\u6570\u636e\u5c31\u662f\u4e00\u4e2a\u4e00\u7ef4\u6574\u578b\u6570\u7ec4\n        env-&gt;SetObjectArrayElement(result, i, iarr);\n        // \u91ca\u653e\u5c40\u90e8\u5f15\u7528\n        env-&gt;DeleteLocalRef(iarr);\n    }\n    return result;\n}\n</code></pre> <p>\u9996\u5148\u9700\u8981\u4f7f\u7528 NewObjectArray \u65b9\u6cd5\u6765\u521b\u5efa\u5bf9\u8c61\u6570\u7ec4\u3002</p> <p>\u7136\u540e\u4f7f\u7528 SetObjectArrayElement \u51fd\u6570\u586b\u5145\u6570\u636e\u65f6\uff0c\u9700\u8981\u6784\u5efa\u597d\u6bcf\u4e2a\u4f4d\u7f6e\u5bf9\u5e94\u7684\u5bf9\u8c61\u3002\u8fd9\u91cc\u5c31\u4f7f\u7528\u4e86 NewIntArray \u6765\u521b\u9020\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5e76\u7ed9\u5bf9\u8c61\u586b\u5145\u6570\u636e\u540e\uff0c\u5728\u8d4b\u503c\u7ed9\u5bf9\u8c61\u6570\u7ec4\u3002</p> <p>\u901a\u8fc7\u4e00\u4e2a for \u5faa\u73af\u5c31\u5b8c\u6210\u7ed9\u5bf9\u8c61\u6570\u7ec4\u8d4b\u503c\u7684\u64cd\u4f5c\u3002</p> <p>\u5728\u521b\u5efa\u5bf9\u8c61\u6570\u7ec4\u65f6\uff0c\u6709\u4e00\u4e2a\u64cd\u4f5c\u662f\u627e\u5230\u5bf9\u5e94\u7684\u5bf9\u8c61\u7c7b\u578b\uff0c\u901a\u8fc7 findClass \u65b9\u6cd5\u3002findClass \u7684\u53c2\u6570 [I \u8fd9\u91cc\u5c31\u6d89\u53ca\u5230 Java \u4e0e JNI \u5bf9\u5e94\u7b7e\u540d\u7684\u8f6c\u6362\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-array-operation/#java-jni","title":"Java \u4e0e JNI \u7b7e\u540d\u7684\u8f6c\u6362","text":"<p>\u5728\u524d\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u7528\u8868\u683c\u5217\u51fa\u4e86 Java \u4e0e JNI \u5bf9\u5e94\u7684\u6570\u636e\u7c7b\u578b\u683c\u5f0f\u7684\u8f6c\u6362\u5173\u7cfb\uff0c\u73b0\u5728\u8981\u5217\u4e3e\u7684\u662f Java \u4e0e JNI \u5bf9\u5e94\u7b7e\u540d\u7684\u8f6c\u6362\u5173\u7cfb\u3002</p> <p>\u8fd9\u91cc\u7684\u7b7e\u540d\u6307\u7684\u662f\u5728 JNI \u4e2d\u53bb\u67e5\u627e Java \u4e2d\u5bf9\u5e94\u7684\u6570\u636e\u7c7b\u578b\u3001\u5bf9\u5e94\u7684\u65b9\u6cd5\u65f6\uff0c\u9700\u8981\u5c06 Java \u4e2d\u7684\u7b7e\u540d\u8f6c\u6362\u6210 JNI \u6240\u80fd\u8bc6\u522b\u7684\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-array-operation/#_3","title":"\u5bf9\u4e8e\u7c7b\u7684\u7b7e\u540d\u8f6c\u6362","text":"<p>\u5bf9\u4e8e Java \u4e2d\u7c7b\u6216\u8005\u63a5\u53e3\u7684\u8f6c\u6362\uff0c\u9700\u8981\u7528\u5230 Java \u4e2d\u7c7b\u6216\u8005\u63a5\u53e3\u7684\u5168\u9650\u5b9a\u540d\uff0c\u628a Java \u4e2d\u63cf\u8ff0\u7c7b\u6216\u8005\u63a5\u53e3\u7684 . \u6362\u6210 / \u5c31\u597d\u4e86\uff0c\u6bd4\u5982 String \u7c7b\u578b\u5bf9\u5e94\u7684 JNI \u63cf\u8ff0\u4e3a\uff1a</p> <pre><code>java/lang/String     // . \u6362\u6210 / \n</code></pre> <p>\u5bf9\u4e8e\u6570\u7ec4\u7c7b\u578b\uff0c\u5219\u662f\u7528 [ \u6765\u8868\u793a\u6570\u7ec4\uff0c\u7136\u540e\u8ddf\u4e00\u4e2a\u5b57\u6bb5\u7684\u7b7e\u540d\u8f6c\u6362\u3002</p> <pre><code>[I      // \u4ee3\u8868\u4e00\u7ef4\u6574\u578b\u6570\u7ec4\uff0cI \u8868\u793a\u6574\u578b\n[[I     // \u4ee3\u8868\u4e8c\u7ef4\u6574\u578b\u6570\u7ec4\n[Ljava/lang/String;      // \u4ee3\u8868\u4e00\u7ef4\u5b57\u7b26\u4e32\u6570\u7ec4\uff0c \n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-array-operation/#_4","title":"\u5bf9\u4e8e\u5b57\u6bb5\u7684\u7b7e\u540d\u8f6c\u6362","text":"<p>\u5bf9\u5e94\u57fa\u7840\u7c7b\u578b\u5b57\u6bb5\u7684\u8f6c\u6362\uff1a</p> Java \u7c7b\u578b JNI \u5bf9\u5e94\u7684\u63cf\u8ff0\u8f6c boolean Z byte B char C short S int I long J float F double D <p>\u5bf9\u4e8e\u5f15\u7528\u7c7b\u578b\u7684\u5b57\u6bb5\u7b7e\u540d\u8f6c\u6362\uff0c\u662f\u5927\u5199\u5b57\u6bcd L \u5f00\u5934\uff0c\u7136\u540e\u662f\u7c7b\u7684\u7b7e\u540d\u8f6c\u6362\uff0c\u6700\u540e\u4ee5 ; \u7ed3\u5c3e\u3002</p> Java \u7c7b\u578b JNI \u5bf9\u5e94\u7684\u63cf\u8ff0\u8f6c\u6362 String Ljava/lang/String; Class Ljava/lang/Class; Throwable Ljava/lang/Throwable int[] \"[I\" Object[] \"[Ljava/lang/Object;\"","tags":["NDK"]},{"location":"android/jni/android-jni-array-operation/#_5","title":"\u5bf9\u4e8e\u65b9\u6cd5\u7684\u7b7e\u540d\u8f6c\u6362","text":"<p>\u5bf9\u4e8e\u65b9\u6cd5\u7b7e\u540d\u63cf\u8ff0\u7684\u8f6c\u6362\uff0c\u9996\u5148\u662f\u5c06\u65b9\u6cd5\u5185\u6240\u6709\u53c2\u6570\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u5b57\u6bb5\u63cf\u8ff0\uff0c\u5e76\u5168\u90e8\u5199\u5728\u5c0f\u62ec\u53f7\u5185\uff0c\u7136\u540e\u5728\u5c0f\u62ec\u53f7\u5916\u518d\u7d27\u8ddf\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u7c7b\u578b\u63cf\u8ff0\u3002</p> Java \u7c7b\u578b JNI \u5bf9\u5e94\u7684\u63cf\u8ff0\u8f6c\u6362 String f(); ()Ljava/lang/String; long f(int i, Class c); (ILjava/lang/Class;)J String(byte[] bytes); ([B)V <p>\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\u5728 JNI \u5bf9\u5e94\u7684\u63cf\u8ff0\u8f6c\u6362\u4e2d\u4e0d\u8981\u51fa\u73b0\u7a7a\u683c\u3002</p> <p>\u4e86\u89e3\u5e76\u638c\u63e1\u8fd9\u4e9b\u8f6c\u6362\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u66f4\u591a\u7684\u64cd\u4f5c\u4e86\uff0c\u5b9e\u73b0 Java \u4e0e C++ \u7684\u76f8\u4e92\u8c03\u7528\u3002</p> <p>\u6bd4\u5982\uff0c\u6709\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 Java \u7c7b\uff0c\u7136\u540e\u518d Native \u4e2d\u6253\u5370\u7c7b\u7684\u5bf9\u8c61\u6570\u7ec4\u7684\u67d0\u4e00\u4e2a\u5b57\u6bb5\u503c\u3002</p> <pre><code>    private native void printAnimalsName(Animal[] animal);\n</code></pre> <p>\u5177\u4f53 C++ \u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>/**\n * \u6253\u5370\u5bf9\u8c61\u6570\u7ec4\u4e2d\u7684\u4fe1\u606f\n */\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_ArrayTypeOps_printAnimalsName(JNIEnv *env, jobject instance,\n                                                                  jobjectArray animals) {\n    jobject animal;\n    // \u6570\u7ec4\u957f\u5ea6\n    int size = env-&gt;GetArrayLength(animals);\n    // \u6570\u7ec4\u4e2d\u5bf9\u5e94\u7684\u7c7b\n    jclass cls = env-&gt;FindClass(\"com/glumes/cppso/model/Animal\");\n    // \u7c7b\u5bf9\u5e94\u7684\u5b57\u6bb5\u63cf\u8ff0\n    jfieldID fid = env-&gt;GetFieldID(cls, \"name\", \"Ljava/lang/String;\");\n    // \u7c7b\u7684\u5b57\u6bb5\u5177\u4f53\u7684\u503c\n    jstring jstr;\n    // \u7c7b\u5b57\u6bb5\u5177\u4f53\u503c\u8f6c\u6362\u6210 C/C++ \u5b57\u7b26\u4e32\n    const char *str;\n\n    for (int i = 0; i &lt; size; ++i) {\n        // \u5f97\u5230\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\n        animal = env-&gt;GetObjectArrayElement(animals, i);\n        // \u6bcf\u4e00\u4e2a\u5143\u7d20\u5177\u4f53\u5b57\u6bb5\u7684\u503c\n        jstr = (jstring) (env-&gt;GetObjectField(animal, fid));\n        str = env-&gt;GetStringUTFChars(jstr, NULL);\n        if (str == NULL) {\n            continue;\n        }\n        LOGD(\"str is %s\", str);\n        env-&gt;ReleaseStringUTFChars(jstr, str);\n    }\n}\n</code></pre> <p>\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u53c2\u8003\u6211\u7684 Github \u9879\u76ee https://github.com/glumes/AndroidDevWithCpp\uff0c\u6b22\u8fce Star\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/","title":"Android JNI \u57fa\u672c\u64cd\u4f5c","text":"<p>\u81ea\u4ece Android Studio \u5347\u7ea7\u5230 2.3 \u7248\u672c\u4ee5\u540e\uff0c\u4f7f\u7528 CMake \u8fdb\u884c\u7f16\u8bd1\u5c31\u65b9\u4fbf\u591a\u4e86\uff0c\u4e0d\u9700\u8981\u518d\u5199 Android.mk \u4e86\uff0c\u4e5f\u4e0d\u9700\u8981\u7528 javah \u6765\u751f\u6210\u5934\u6587\u4ef6\u4e86\uff0c\u76f4\u63a5\u5199\u597d native \u65b9\u6cd5\uff0c\u5feb\u6377\u65b9\u5f0f\u5c31\u53ef\u4ee5\u751f\u6210\u5bf9\u5e94\u7684 C++ \u65b9\u6cd5\uff0c\u53ea\u8981\u4e13\u6ce8\u5199\u597d C++ \u4ee3\u7801\uff0cCMake \u5c31\u53ef\u4ee5\u6307\u5b9a\u7684 CPU \u67b6\u6784\u751f\u6210\u5bf9\u5e94\u7684 SO \u5e93\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#jni-ndk","title":"JNI \u548c NDK \u7684\u533a\u522b","text":"<p>NDK \u5f00\u53d1\u96be\u514d\u4f1a\u641e\u4e0d\u6e05 JNI \u548c NDK \u7684\u533a\u522b\u3002</p> <p>JNI \u5168\u79f0\u662f Java Native Interface\uff0c\u5373 Java \u672c\u5730\u63a5\u53e3\u3002\u5b83\u662f\u7528\u6765\u4f7f\u5f97 Java \u8bed\u8a00\u548c C/C++ \u8bed\u8a00\u76f8\u4e92\u8c03\u7528\u7684\u3002\u5b83\u672c\u8eab\u548c Android \u5e76\u65e0\u5173\u7cfb\uff0c\u53ea\u662f\u5728 Android \u5f00\u53d1\u4e2d\u4f1a\u7528\u5230\uff0c\u5728\u5176\u4ed6\u5730\u65b9\u4e5f\u4f1a\u7528\u5230\u7684\u3002</p> <p>\u800c NDK \u7684\u5168\u79f0\u662f Native Development Kit\uff0c\u548c SDK \u7684\u5168\u79f0\u662f Software Development Kit \u4e00\u6837\uff0c\u90fd\u662f\u5f00\u53d1\u5de5\u5177\u5305\u3002NDK \u662f Android \u5f00\u53d1\u7684\u5de5\u5177\u5305\uff0c\u4e3b\u8981\u7528\u4f5c C/C++ \u5f00\u53d1\uff0c\u63d0\u4f9b\u4e86\u76f8\u5173\u7684\u52a8\u6001\u5e93\u3002</p> <p>\u5728 Android \u4e0a\u8fdb\u884c NDK \u5f00\u53d1\u8fd8\u662f\u5f97\u5148\u5b66\u4f1a JNI \u76f8\u5173\u6280\u80fd\uff0c\u5148\u53ef\u4ee5\u4ece Java \u5c42\u5230 C/C++ \u5c42\u7684\u76f8\u4e92\u8c03\u7528\uff0c\u7136\u540e\u518d\u5b66\u4e60 NDK \u5f00\u53d1\u7684\u90a3\u4e9b\u6280\u5de7\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#_1","title":"\u7b80\u5355\u5b9e\u4f8b","text":"<p>\u5728 AS \u65b0\u5efa\u5de5\u7a0b\u65f6\u82e5\u9009\u62e9\u4e86 Include C++ Support\uff0c\u5c31\u4f1a\u81ea\u5e26\u914d\u7f6e\u597d\u7684 C++ \u5f00\u53d1\u73af\u5883\u3002</p> <p>\u5728\u58f0\u660e native \u65b9\u6cd5\u65f6\u8fd8\u662f\u7528 Java \u6765\u5199\u6bd4\u8f83\u597d\uff0c\u6bd4 Kotlin \u7684 external \u5173\u952e\u5b57\u8981\u53cb\u597d\u591a\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u5feb\u6377\u952e\u751f\u6210\u5bf9\u7528\u7684 C++ \u65b9\u6cd5\u3002</p> <p>\u58f0\u660e native \u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>public static native int plus(int a, int b);\n</code></pre> <p>\u5feb\u6377\u952e\u4fbf\u4f1a\u751f\u6210\u5bf9\u5e94\u7684 C++ \u65b9\u6cd5 <pre><code>extern \"C\"\nJNIEXPORT jint JNICALL\nJava_com_glumes_myapplication_NativeClass_plus(JNIEnv *env, jobject instance, jint a, jint b) {\n    jint sum = a + b;\n    return sum;\n}\n</code></pre></p> <p>\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u8ba1\u7b97 a+b \u7684 native \u65b9\u6cd5\uff0c\u4f46\u5374\u5305\u542b\u4e86\u8bb8\u591a\u57fa\u672c\u5185\u5bb9\uff0c\u5728 C++ \u5c42\u63a5\u6536\u6765\u81ea Java \u5c42\u7684\u53c2\u6570\uff0c\u5e76\u8f6c\u6362\u6210 C++ \u5c42\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8ba1\u7b97\u4e4b\u540e\u518d\u8fd4\u56de\u6210 Java \u5c42\u7684\u6570\u636e\u7c7b\u578b\u3002</p> <p>\u5728 Java \u5c42\u4e2d\u53ea\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u800c\u5728 C++ \u4ee3\u7801\u5c31\u6709\u56db\u4e2a\u53c2\u6570\u4e86\uff0c\u81f3\u5c11\u90fd\u4f1a\u5305\u542b\u524d\u9762\u4e24\u4e2a\u53c2\u6570\uff0c\u4e0b\u9762\u8bb2\u89e3\u8fd9\u4e9b\u53c2\u6570\u610f\u4e49\u3002</p> <p>\u5176\u4e2d\uff1a * <code>env</code>\u53d8\u91cf\u662f JNIEnv \u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u662f\u4e00\u4e2a Java \u865a\u62df\u673a\u6240\u8fd0\u884c\u7684\u73af\u5883\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u8bbf\u95ee\u5230 Java \u865a\u62df\u673a\u5185\u90e8\u7684\u5404\u79cd\u5bf9\u8c61\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#jnienv-env","title":"JNIEnv \u7c7b\u578b\u5bf9\u8c61\u53c2\u6570 env","text":"<p><code>JNIEnv*</code> \u662f\u5b9a\u4e49\u4efb\u610f native \u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u5b83\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u8bbf\u95ee\u865a\u62df\u673a\u5185\u90e8\u7684\u5404\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u540c\u65f6\u5b83\u8fd8\u6307\u5411 JVM \u51fd\u6570\u8868\u7684\u6307\u9488\uff0c\u51fd\u6570\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5165\u53e3\u6307\u5411\u4e00\u4e2a JNI \u51fd\u6570\uff0c\u6bcf\u4e2a\u51fd\u6570\u7528\u4e8e\u8bbf\u95ee JVM \u4e2d\u7279\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u9762\u6d89\u53ca\u4e86\u4e09\u7c7b\u6307\u9488\uff0cJNIEnv * \u672c\u8eab\u5c31\u662f\u6307\u9488\uff0c\u800c\u5b83\u6307\u5411\u7684\u4e5f\u662f\u6307\u9488\uff0c\u5728 JVM \u51fd\u6570\u8868\u91cc\u9762\u7684\u6bcf\u4e00\u9879\u53c8\u90fd\u662f\u6307\u9488\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#jobject","title":"jobject \u53c2\u6570","text":"<p>jobject \u662f native \u51fd\u6570\u91cc\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7c7b\u578b\uff0c\u4f46\u5374\u4e0d\u662f\u4e00\u5b9a\u7684\u3002</p> <p>\u5982\u679c\u8be5 native \u65b9\u6cd5\u662f\u4e00\u4e2a\u9759\u6001 static \u65b9\u6cd5\uff0c\u90a3\u4e48\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f jobject \u7c7b\u578b\uff0c\u6307\u7684\u662f\u8c03\u7528\u8be5\u51fd\u6570\u7684\u5bf9\u8c61\uff1b</p> <p>\u5982\u679c\u662f\u4e00\u4e2a\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u90a3\u4e48\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f jclass \u7c7b\u578b\uff0c\u6307\u7684\u662f\u8c03\u7528\u8be5\u51fd\u6570\u7684\u7c7b\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#_2","title":"\u57fa\u672c\u6570\u636e\u7c7b\u578b\u8f6c\u6362","text":"<p>\u5728 Java \u4e2d\u4f20\u9012\u7684\u53c2\u6570\u7c7b\u578b\u662f int\uff0c\u800c\u5728 JNI \u4e2d\u5c31\u6210\u4e86 jint\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230 Java \u5230 JNI \u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u3002</p> <p>\u5982\u4e0b\u8868\u6240\u793a\uff1a</p> Java \u7c7b\u578b Native \u7c7b\u578b \u7b26\u53f7\u5c5e\u6027 \u5b57\u957f boolean jboolean \u65e0\u7b26\u53f7 8\u4f4d byte jbyte \u65e0\u7b26\u53f7 8\u4f4d char jchar \u65e0\u7b26\u53f7 16\u4f4d short jshort \u6709\u7b26\u53f7 16\u4f4d int jnit \u6709\u7b26\u53f7 32\u4f4d long jlong \u6709\u7b26\u53f7 64\u4f4d float jfloat \u6709\u7b26\u53f7 32\u4f4d double jdouble \u6709\u7b26\u53f7 64\u4f4d <p>\u6211\u4eec\u4f20\u9012\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u5728 JNI \u4e2d\u90fd\u6709\u76f8\u5bf9\u7684\u6570\u636e\u7c7b\u578b\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#_3","title":"\u5f15\u7528\u6570\u636e\u7c7b\u578b\u8f6c\u6362","text":"<p>\u9664\u4e86\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4e4b\u5916\uff0c\u5f15\u7528\u6570\u636e\u7c7b\u578b\u4e5f\u6709\u7740\u4e00\u4e00\u5bf9\u5e94\u3002</p> Java \u5f15\u7528\u7c7b\u578b Native \u7c7b\u578b Java \u5f15\u7528\u7c7b\u578b Native \u7c7b\u578b All objects jobject char\\([]\\) jcharArray java.lang.Class jclass short\\([]\\) jshortArray java.lang.String jstring int\\([]\\) jintArray Object\\([]\\) jobjectArray long\\([]\\) jlongArray boolean\\([]\\) jbooleanArray float\\([]\\) jfloatArray byte\\([]\\) jbyteArray double\\([]\\) jdoubleArray java.lang.Throwable jthrowable <p>\u53ef\u4ee5\u770b\u5230\uff0c\u9664\u4e86 Java \u4e2d\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u6570\u7ec4\u3001Class\u3001String \u548c Throwable \u5916\uff0c\u5176\u4f59\u6240\u6709 Java \u5bf9\u8c61\u7684\u6570\u636e\u7c7b\u578b\u5728 JNI \u4e2d\u90fd\u7528 jobject \u8868\u793a\u3002</p> <p>\u660e\u767d\u4e86\u53c2\u6570\u7c7b\u578b\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u6309\u7167\u6b63\u5e38\u5199\u4ee3\u7801\u4e00\u6837\uff0c\u5b8c\u6210\u51fd\u6570\u7684\u8fd4\u56de\u503c\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#string","title":"String \u5b57\u7b26\u4e32\u64cd\u4f5c","text":"<p>\u5bf9\u4e8e\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982 boolean\u3001int\u3001float \u7b49\u90fd\u5927\u540c\u5c0f\u5f02\uff0c\u65e0\u975e\u662f\u5728\u539f\u6765\u7684\u6570\u636e\u7c7b\u578b\u524d\u9762\u52a0\u4e86\u4e00\u4e2a <code>j</code>\u6765\u8868\u793a JNI \u6570\u636e\u7c7b\u578b\u3002</p> <p>\u800c\u5bf9\u4e8e String \u7c7b\u578b\uff0c\u5fc5\u987b\u8981\u4f7f\u7528\u5408\u9002\u7684 JNI \u51fd\u6570\u6765\u5c06 jstring \u8f6c\u53d8\u6210 C/C++ \u5b57\u7b26\u4e32\u3002</p> <p>\u5bf9\u4e8e\u4e0b\u9762\u7684 Native \u65b9\u6cd5\uff0c\u4f20\u5165\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u8981\u6c42\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002</p> <p><pre><code>    public static native String getNativeString(String str);\n</code></pre> \u751f\u6210\u7684\u5bf9\u5e94\u7684 C++ \u4ee3\u7801\u5982\u4e0b\uff1a</p> <p><pre><code>extern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_glumes_cppso_SampleNativeMethod_getNativeString(JNIEnv *env, jclass type, jstring str_) {\n\n    // \u751f\u6210 jstring \u7c7b\u578b\u7684\u5b57\u7b26\u4e32\n    jstring returnValue = env-&gt;NewStringUTF(\"hello native string\");\n    // \u5c06 jstring \u7c7b\u578b\u7684\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a C \u98ce\u683c\u7684\u5b57\u7b26\u4e32\uff0c\u4f1a\u989d\u5916\u7533\u8bf7\u5185\u5b58\n    const char *str = env-&gt;GetStringUTFChars(str_, 0);\n    // \u91ca\u653e\u6389\u7533\u8bf7\u7684 C \u98ce\u683c\u5b57\u7b26\u4e32\u7684\u5185\u5b58\n    env-&gt;ReleaseStringUTFChars(str_, str);\n    // \u8fd4\u56de jstring \u7c7b\u578b\u5b57\u7b26\u4e32\n    return returnValue;\n}\n</code></pre> Java \u5c42\u7684\u5b57\u7b26\u4e32\u5230\u4e86 JNI \u5c31\u6210\u4e86 jstring \u7c7b\u578b\u7684\uff0c\u4f46 jstring \u6307\u5411\u7684\u662f JVM \u5185\u90e8\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u4e0d\u662f C \u98ce\u683c\u7684\u5b57\u7b26\u4e32 <code>char*</code>\uff0c\u6240\u4ee5\u4e0d\u80fd\u50cf\u4f7f\u7528 C \u98ce\u683c\u5b57\u7b26\u4e32\u4e00\u6837\u6765\u4f7f\u7528 jstring \u3002</p> <p>JNI \u652f\u6301\u5c06 jstring \u8f6c\u6362\u6210 UTF \u7f16\u7801\u548c Unicode \u7f16\u7801\u4e24\u79cd\u3002\u56e0\u4e3a Java \u9ed8\u8ba4\u4f7f\u7528 Unicode \u7f16\u7801\uff0c\u800c C/C++ \u9ed8\u8ba4\u4f7f\u7528 UTF \u7f16\u7801\u3002</p> <ul> <li>GetStringUTFChars(jstring string, jboolean* isCopy)</li> </ul> <p>\u5c06 jstring \u8f6c\u6362\u6210 UTF \u7f16\u7801\u7684\u5b57\u7b26\u4e32</p> <ul> <li>GetStringChars(jstring string, jboolean* isCopy)</li> </ul> <p>\u5c06 jstring \u8f6c\u6362\u6210 Unicode \u7f16\u7801\u7684\u5b57\u7b26\u4e32\uff0c\u7531\u4e8e Native \u5c42\u662f C/C++ \u7f16\u7801\uff0c\u9ed8\u8ba4\u4f7f\u7528 UTF \u683c\u5f0f\uff0c\u6240\u4ee5 GetStringChars \u5e76\u4e0d\u5e38\u7528\u3002</p> <p>\u5176\u4e2d\uff0cjstring \u7c7b\u578b\u53c2\u6570\u5c31\u662f\u6211\u4eec\u9700\u8981\u8f6c\u6362\u7684\u5b57\u7b26\u4e32\uff0c\u800c isCopy \u53c2\u6570\u7684\u503c\u4e3a  <code>JNI_TRUE</code> \u6216\u8005 <code>JNI_FALSE</code> \uff0c\u4ee3\u8868\u662f\u5426\u8fd4\u56de JVM \u6e90\u5b57\u7b26\u4e32\u7684\u4e00\u4efd\u62f7\u8d1d\u3002\u5982\u679c\u4e3a<code>JNI_TRUE</code> \u5219\u8fd4\u56de\u62f7\u8d1d\uff0c\u5e76\u4e14\u8981\u4e3a\u4ea7\u751f\u7684\u5b57\u7b26\u4e32\u62f7\u8d1d\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff1b\u5982\u679c\u4e3a<code>JNI_FALSE</code> \u5c31\u76f4\u63a5\u8fd4\u56de\u4e86 JVM \u6e90\u5b57\u7b26\u4e32\u7684\u6307\u9488\uff0c\u610f\u5473\u7740\u53ef\u4ee5\u901a\u8fc7\u6307\u9488\u4fee\u6539\u6e90\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\uff0c\u4f46\u8fd9\u5c31\u8fdd\u53cd\u4e86 Java \u4e2d\u5b57\u7b26\u4e32\u4e0d\u80fd\u4fee\u6539\u7684\u89c4\u5b9a\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u76f4\u63a5\u586b NULL \u5c31\u597d\u4e86\u3002</p> <p>\u5f53\u8c03\u7528\u5b8c GetStringUTFChars \u65b9\u6cd5\u65f6\u522b\u5fd8\u4e86\u505a\u5b8c\u5168\u68c0\u67e5\u3002\u56e0\u4e3a JVM \u9700\u8981\u4e3a\u4ea7\u751f\u7684\u65b0\u5b57\u7b26\u4e32\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u679c\u5206\u914d\u5931\u8d25\u5c31\u4f1a\u8fd4\u56de NULL\uff0c\u5e76\u4e14\u4f1a\u629b\u51fa OutOfMemoryError \u5f02\u5e38\uff0c\u6240\u4ee5\u8981\u5bf9 GetStringUTFChars \u7ed3\u679c\u8fdb\u884c\u5224\u65ad\u3002</p> <p>\u5f53\u4f7f\u7528\u5b8c UTF \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u65f6\uff0c\u8fd8\u4e0d\u80fd\u5fd8\u4e86\u91ca\u653e\u6240\u7533\u8bf7\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u8c03\u7528 ReleaseStringUTFChars \u65b9\u6cd5\u8fdb\u884c\u91ca\u653e\u3002</p> <p>\u5b8c\u6574\u5730\u8f6c\u6362\u5b57\u7b26\u4e32\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>    // \u7533\u8bf7\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff0cjstring \u8f6c\u6362\u4e3a C \u98ce\u683c\u5b57\u7b26\u4e32\n    const char *utfStr = env-&gt;GetStringUTFChars(str_,NULL);\n    // \u505a\u68c0\u67e5\u5224\u65ad\n    if (utfStr == NULL){\n        return NULL;\n    }\n    // \u5b9e\u9645\u64cd\u4f5c\n    printf(\"%s\",utfStr);\n    // \u64cd\u4f5c\u7ed3\u675f\u540e\uff0c\u91ca\u653e\u5185\u5b58\n    env-&gt;ReleaseStringUTFChars(str_,utfStr);\n</code></pre> <p>\u9664\u4e86\u5c06 jstring \u8f6c\u6362\u4e3a C \u98ce\u683c\u5b57\u7b26\u4e32\uff0cJNI \u8fd8\u63d0\u4f9b\u4e86\u5c06 C \u98ce\u683c\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a jstring \u7c7b\u578b\u3002</p> <p>\u901a\u8fc7 NewStringUTF \u51fd\u6570\u53ef\u4ee5\u5c06 UTF \u7f16\u7801\u7684 C \u98ce\u683c\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a jstring \u7c7b\u578b\uff0c\u901a\u8fc7 NewString \u51fd\u6570\u53ef\u4ee5\u5c06 Unicode \u7f16\u7801\u7684 C \u98ce\u683c\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a jstring \u7c7b\u578b\u3002\u8fd9\u4e2a jstring \u7c7b\u578b\u4f1a\u81ea\u52a8\u8f6c\u6362\u6210 Java \u652f\u6301\u7684 Unicode \u7f16\u7801\u683c\u5f0f\u3002</p> <p>\u9664\u4e86 jstring \u548c C \u98ce\u683c\u5b57\u7b26\u4e32\u7684\u76f8\u4e92\u8f6c\u6362\u4e4b\u5916\uff0cJNI \u8fd8\u63d0\u4f9b\u4e86\u5176\u4ed6\u7684\u51fd\u6570\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#_4","title":"\u83b7\u5f97\u6e90\u5b57\u7b26\u4e32\u7684\u6307\u9488","text":"<p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ea\u9700\u8981\u83b7\u5f97 Java \u5b57\u7b26\u4e32\u7684\u76f4\u63a5\u6307\u9488\uff0c\u800c\u4e0d\u9700\u8981\u628a\u5b83\u8f6c\u6362\u6210 C \u98ce\u683c\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5185\u5bb9\u5f88\u5927\uff0c\u6709 1 M \u591a\uff0c\u800c\u6211\u4eec\u53ea\u662f\u9700\u8981\u8bfb\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u518d\u628a\u5b83\u8f6c\u6362\u4e3a C \u98ce\u683c\u5b57\u7b26\u4e32\uff0c\u4e0d\u4ec5\u591a\u6b64\u4e00\u4e3e\uff08\u901a\u8fc7\u76f4\u63a5\u5b57\u7b26\u4e32\u6307\u9488\u4e5f\u53ef\u4ee5\u8bfb\u53d6\u5185\u5bb9\uff09\uff0c\u800c\u4e14\u8fd8\u9700\u8981\u4e3a C \u98ce\u683c\u5b57\u7b26\u4e32\u5206\u914d\u5185\u5b58\u3002</p> <p>\u4e3a\u6b64\uff0cJNI \u63d0\u4f9b\u4e86 GetStringCritical \u548c ReleaseStringCritical \u51fd\u6570\u6765\u8fd4\u56de\u5b57\u7b26\u4e32\u7684\u76f4\u63a5\u6307\u9488\uff0c\u8fd9\u6837\u53ea\u9700\u8981\u5206\u914d\u4e00\u4e2a\u6307\u9488\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u597d\u4e86\u3002</p> <pre><code>    const jchar *c_str = NULL;\n    c_str = env-&gt;GetStringCritical(str_, NULL);\n\n    if (c_str == NULL) {\n        // error handle\n    }\n    env-&gt;ReleaseStringCritical(str_, c_str);\n</code></pre> <p>\u548c GetStringUTFChars \u4e00\u6837\uff0c\u5728\u4f7f\u7528\u5b8c\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u5c06\u5206\u914d\u7684\u6307\u9488\u5185\u5b58\u7a7a\u95f4\u7ed9\u91ca\u653e\u6389\u3002</p> <p>\u6ce8\u610f\u5b83\u7684\u8fd4\u56de\u503c\u6307\u9488\u7c7b\u578b\u662f <code>const jchar *</code>\uff0c\u800c GetStringUTFChars \u51fd\u6570\u7684\u8fd4\u56de\u503c\u5c31\u662f <code>const char*</code>\uff0c\u8fd9\u5c31\u8bf4\u660e GetStringUTFChars \u8fd4\u56de\u7684\u662f C \u98ce\u683c\u5b57\u7b26\u4e32\u7684\u6307\u9488\uff0c\u800c GetStringCritical \u8fd4\u56de\u7684\u662f\u6e90 Java \u5b57\u7b26\u4e32\u7684\u76f4\u63a5\u6307\u9488\u3002</p> <p>\u53e6\u5916\uff0cGetStringCritical \u8fd8\u6709\u989d\u5916\u7684\u9650\u5236\u3002</p> <p>\u5728 GetStringCritical \u548c ReleaseStringCritical \u4e24\u4e2a\u51fd\u6570\u4e4b\u95f4\u7684 Native \u4ee3\u7801\u4e0d\u80fd\u8c03\u7528\u4efb\u4f55\u4f1a\u8ba9\u7ebf\u7a0b\u963b\u585e\u6216\u8005\u7b49\u5f85 JVM \u4e2d\u5176\u4ed6\u7ebf\u7a0b\u7684 Native \u51fd\u6570\u6216 JNI \u51fd\u6570\u3002</p> <p>\u56e0\u4e3a\u901a\u8fc7 GetStringCritical \u5f97\u5230\u7684\u662f\u4e00\u4e2a\u6307\u5411 JVM \u5185\u90e8\u5b57\u7b26\u4e32\u7684\u76f4\u63a5\u6307\u9488\uff0c\u83b7\u53d6\u8fd9\u4e2a\u76f4\u63a5\u6307\u9488\u540e\u4f1a\u5bfc\u81f4\u6682\u505c GC \u7ebf\u7a0b\uff0c\u5f53 GC \u7ebf\u7a0b\u88ab\u6682\u505c\u540e\uff0c\u5982\u679c\u5176\u4ed6\u7ebf\u7a0b\u89e6\u53d1 GC \u7ee7\u7eed\u8fd0\u884c\u7684\u8bdd\uff0c\u90fd\u4f1a\u5bfc\u81f4\u963b\u585e\u8c03\u7528\u8005\u3002\u6240\u4ee5\uff0cGetStringCritical \u548c ReleaseStringCritical \u8fd9\u5bf9\u51fd\u6570\u4e2d\u95f4\u7684\u4efb\u4f55\u672c\u5730\u4ee3\u7801\u90fd\u4e0d\u53ef\u4ee5\u6267\u884c\u5bfc\u81f4\u963b\u585e\u7684\u8c03\u7528\u6216\u4e3a\u65b0\u5bf9\u8c61\u5728 JVM \u4e2d\u5206\u914d\u5185\u5b58\uff0c\u5426\u5219\uff0cJVM \u6709\u53ef\u80fd\u6b7b\u9501\u3002</p> <p>\u53e6\u5916\u8fd8\u662f\u9700\u8981\u68c0\u67e5\u662f\u5426\u56e0\u4e3a\u5185\u5b58\u6ea2\u51fa\u800c\u5bfc\u81f4\u8fd4\u56de\u503c\u4e3a NULL\uff0c\u56e0\u4e3a JVM \u5728\u6267\u884c GetStringCritical \u51fd\u6570\u65f6\uff0c\u4ecd\u6709\u53d1\u751f\u6570\u636e\u590d\u5236\u7684\u53ef\u80fd\u6027\uff0c\u5c24\u5176\u662f\u5f53 JVM \u5185\u90e8\u5b58\u50a8\u7684\u6570\u7ec4\u4e0d\u8fde\u7eed\u65f6\uff0c\u4e3a\u4e86\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u7684\u6307\u9488\uff0cJVM \u5fc5\u987b\u590d\u5236\u6240\u6709\u6570\u636e\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#_5","title":"\u83b7\u5f97\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff1a","text":"<p>\u7531\u4e8e UTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u4ee5 <code>\\0</code> \u7ed3\u5c3e\uff0c\u800c Unicode \u5b57\u7b26\u4e32\u4e0d\u662f\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4e24\u79cd\u7f16\u7801\u83b7\u5f97\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u51fd\u6570\u4e5f\u662f\u4e0d\u540c\u7684\u3002</p> <ul> <li>GetStringLength</li> </ul> <p>\u83b7\u5f97 Unicode \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002</p> <ul> <li>GetStringUTFLength</li> </ul> <p>\u83b7\u5f97 UTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u6216\u8005\u4f7f\u7528 C \u8bed\u8a00\u7684 strlen \u51fd\u6570\u3002</p> <p>\u8fd9\u91cc\u7684\u5b57\u7b26\u4e32\u6307\u7684\u662f Java \u5c42\u7684\u5b57\u7b26\u4e32\uff0c\u4f20\u5165\u7684\u53c2\u6570\u90fd\u662f jsting \u7c7b\u578b\uff0c\u800c Java \u5c42\u9ed8\u8ba4\u662f Unicode \u7f16\u7801\uff0c\u6240\u4ee5\u5927\u591a\u4f7f\u7528 GetStringLength \u65b9\u6cd5\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#_6","title":"\u83b7\u5f97\u6307\u5b9a\u8303\u56f4\u7684\u5b57\u7b26\u4e32\u5185\u5bb9","text":"<p>JNI \u63d0\u4f9b\u4e86\u51fd\u6570\u6765\u83b7\u5f97\u5b57\u7b26\u4e32\u6307\u5b9a\u8303\u56f4\u7684\u5185\u5bb9\uff0c\u8fd9\u91cc\u7684\u5b57\u7b26\u4e32\u6307\u7684\u662f Java \u5c42\u7684\u5b57\u7b26\u4e32\u3002\u51fd\u6570\u4f1a\u628a\u6e90\u5b57\u7b26\u4e32\u590d\u5236\u5230\u4e00\u4e2a\u9884\u5148\u5206\u914d\u7684\u7f13\u51b2\u533a\u5185\u3002</p> <ul> <li>GetStringRegion</li> </ul> <p>\u83b7\u5f97 Unicode \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u6307\u5b9a\u5185\u5bb9\u3002</p> <ul> <li>GetStringUTFRegion</li> </ul> <p>\u83b7\u5f97 UTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u6307\u5b9a\u5185\u5bb9\u3002</p> <pre><code>    jchar outbuf[128],inbuf[128];\n    int len = env-&gt;GetStringLength(str_);\n    env-&gt;GetStringRegion(str_,0,len,outbuf);\n    LOGD(\"%s\",outbuf);\n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#string_1","title":"String \u5b57\u7b26\u4e32\u51fd\u6570\u64cd\u4f5c\u603b\u7ed3","text":"<p>\u5173\u4e8e\u5b57\u7b26\u4e32\u7684\u51fd\u6570\u6c47\u603b</p> JNI \u51fd\u6570 \u63cf\u8ff0 GetStringChars / ReleaseStringChars \u83b7\u5f97\u6216\u91ca\u653e\u4e00\u4e2a\u6307\u5411 Unicode \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u7684\u6307\u9488\uff08\u6307 C/C++ \u5b57\u7b26\u4e32\uff09 GetStringUTFChars / ReleaseStringUTFChars \u83b7\u5f97\u6216\u91ca\u653e\u4e00\u4e2a\u6307\u5411 UTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u7684\u6307\u9488\uff08\u6307 C/C++ \u5b57\u7b26\u4e32\uff09 GetStringLength \u8fd4\u56de Unicode \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u7684\u957f\u5ea6 getStringUTFLength \u8fd4\u56de UTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u7684\u957f\u5ea6 NewString \u5c06 Unicode \u7f16\u7801\u7684 C/C++ \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a Java \u5b57\u7b26\u4e32 NewStringUTF \u5c06 UTF-8 \u7f16\u7801\u7684 C/C++ \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a Java \u5b57\u7b26\u4e32 GetStringCritical / ReleaseStringCritical \u83b7\u5f97\u6216\u91ca\u653e\u4e00\u4e2a\u6307\u5411\u5b57\u7b26\u4e32\u5185\u5bb9\u7684\u6307\u9488(\u6307 Java \u5b57\u7b26\u4e32) GetStringRegion \u83b7\u53d6\u6216\u8005\u8bbe\u7f6e Unicode \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u7684\u6307\u5b9a\u8303\u56f4\u7684\u5185\u5bb9 GetStringUTFRegion \u83b7\u53d6\u6216\u8005\u8bbe\u7f6e UTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u7684\u6307\u5b9a\u8303\u56f4\u7684\u5185\u5bb9 <p>\u9009\u62e9\u5408\u9002\u7684 JNI \u51fd\u6570</p> <p></p> <p>\u5bf9\u4e8e JNI String \u64cd\u4f5c\uff0c\u8981\u9009\u62e9\u5408\u9002\u7684\u51fd\u6570\uff0c\u4e0a\u8868\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u8003\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-basic-operation/#_7","title":"\u53c2\u8003","text":"<ol> <li>\u300aThe Java Native Interface\u300b</li> <li>https://github.com/glumes/AndroidDevWithCpp</li> </ol> <p>\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u53c2\u8003\u6211\u7684 Github \u9879\u76ee https://github.com/glumes/AndroidDevWithCpp\uff0c\u6b22\u8fce Star\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-bitmap-operation/","title":"Android JNI \u4e4b Bitmap \u64cd\u4f5c","text":"<p>\u5728 Android \u4e2d\u901a\u8fc7 JNI \u53bb\u64cd\u4f5c Bitmap\u3002</p> <p>\u5728 Android \u901a\u8fc7 JNI \u53bb\u8c03\u7528 Bitmap\uff0c\u901a\u8fc7 CMake \u53bb\u7f16 so \u52a8\u6001\u94fe\u63a5\u5e93\u7684\u8bdd\uff0c\u9700\u8981\u6dfb\u52a0 jnigraphics \u56fe\u50cf\u5e93\u3002</p> <pre><code>target_link_libraries( # Specifies the target library.\n                       native-operation\n                       jnigraphics\n                       ${log-lib} )\n</code></pre> <p>\u5728 Android \u4e2d\u5173\u4e8e JNI Bitmap \u7684\u64cd\u4f5c\uff0c\u90fd\u5b9a\u4e49\u5728 <code>bitmap.h</code> \u7684\u5934\u6587\u4ef6\u91cc\u9762\u4e86\uff0c\u4e3b\u8981\u5c31\u4e09\u4e2a\u51fd\u6570\uff0c\u660e\u767d\u5b83\u4eec\u7684\u542b\u4e49\u4e4b\u540e\u5c31\u53ef\u4ee5\u53bb\u5b9e\u8df5\u4f53\u4f1a\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-bitmap-operation/#bitmap","title":"\u68c0\u7d22 Bitmap \u5bf9\u8c61\u4fe1\u606f","text":"<p>AndroidBitmap_getInfo \u51fd\u6570\u5141\u8bb8\u539f\u751f\u4ee3\u7801\u68c0\u7d22 Bitmap \u5bf9\u8c61\u4fe1\u606f\uff0c\u5982\u5b83\u7684\u5927\u5c0f\u3001\u50cf\u7d20\u683c\u5f0f\u7b49\uff0c\u51fd\u6570\u7b7e\u540d\u5982\u4e0b\uff1a</p> <pre><code>/**\n * Given a java bitmap object, fill out the AndroidBitmapInfo struct for it.\n * If the call fails, the info parameter will be ignored.\n */\nint AndroidBitmap_getInfo(JNIEnv* env, jobject jbitmap,\n                          AndroidBitmapInfo* info);\n</code></pre> <p>\u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u662f JNI \u63a5\u53e3\u6307\u9488\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f Bitmap \u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u6307\u5411 AndroidBitmapInfo \u7ed3\u6784\u4f53\u7684\u6307\u9488\u3002</p> <p>AndroidBitmapInfo \u7ed3\u6784\u4f53\u5982\u4e0b\uff1a</p> <pre><code>/** Bitmap info, see AndroidBitmap_getInfo(). */\ntypedef struct {\n    /** The bitmap width in pixels. */\n    uint32_t    width;\n    /** The bitmap height in pixels. */\n    uint32_t    height;\n    /** The number of byte per row. */\n    uint32_t    stride;\n    /** The bitmap pixel format. See {@link AndroidBitmapFormat} */\n    int32_t     format;\n    /** Unused. */\n    uint32_t    flags;      // 0 for now\n} AndroidBitmapInfo;\n</code></pre> <p>\u5176\u4e2d\uff0cwidth \u5c31\u662f Bitmap \u7684\u5bbd\uff0cheight \u5c31\u662f\u9ad8\uff0cformat \u5c31\u662f\u56fe\u50cf\u7684\u683c\u5f0f\uff0c\u800c stride \u5c31\u662f\u6bcf\u4e00\u884c\u7684\u5b57\u8282\u6570\u3002</p> <p>\u56fe\u50cf\u7684\u683c\u5f0f\u6709\u5982\u4e0b\u652f\u6301\uff1a</p> <pre><code>/** Bitmap pixel format. */\nenum AndroidBitmapFormat {\n    /** No format. */\n    ANDROID_BITMAP_FORMAT_NONE      = 0,\n    /** Red: 8 bits, Green: 8 bits, Blue: 8 bits, Alpha: 8 bits. **/\n    ANDROID_BITMAP_FORMAT_RGBA_8888 = 1,\n    /** Red: 5 bits, Green: 6 bits, Blue: 5 bits. **/\n    ANDROID_BITMAP_FORMAT_RGB_565   = 4,\n    /** Deprecated in API level 13. Because of the poor quality of this configuration, it is advised to use ARGB_8888 instead. **/\n    ANDROID_BITMAP_FORMAT_RGBA_4444 = 7,\n    /** Alpha: 8 bits. */\n    ANDROID_BITMAP_FORMAT_A_8       = 8,\n};\n</code></pre> <p>\u5982\u679c AndroidBitmap_getInfo \u6267\u884c\u6210\u529f\u7684\u8bdd\uff0c\u4f1a\u8fd4\u56de 0 \uff0c\u5426\u5219\u8fd4\u56de\u4e00\u4e2a\u8d1f\u6570\uff0c\u4ee3\u8868\u6267\u884c\u7684\u9519\u8bef\u7801\u5217\u8868\u5982\u4e0b\uff1a</p> <pre><code>/** AndroidBitmap functions result code. */\nenum {\n    /** Operation was successful. */\n    ANDROID_BITMAP_RESULT_SUCCESS           = 0,\n    /** Bad parameter. */\n    ANDROID_BITMAP_RESULT_BAD_PARAMETER     = -1,\n    /** JNI exception occured. */\n    ANDROID_BITMAP_RESULT_JNI_EXCEPTION     = -2,\n    /** Allocation failed. */\n    ANDROID_BITMAP_RESULT_ALLOCATION_FAILED = -3,\n};\n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-bitmap-operation/#_1","title":"\u8bbf\u95ee\u539f\u751f\u50cf\u7d20\u7f13\u5b58","text":"<p>AndroidBitmap_lockPixels \u51fd\u6570\u9501\u5b9a\u4e86\u50cf\u7d20\u7f13\u5b58\u4ee5\u786e\u4fdd\u50cf\u7d20\u7684\u5185\u5b58\u4e0d\u4f1a\u88ab\u79fb\u52a8\u3002</p> <p>\u5982\u679c Native \u5c42\u60f3\u8981\u8bbf\u95ee\u50cf\u7d20\u6570\u636e\u5e76\u64cd\u4f5c\u5b83\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56de\u4e86\u50cf\u7d20\u7f13\u5b58\u7684\u4e00\u4e2a\u539f\u751f\u6307\u9488\uff0c</p> <pre><code>/**\n * Given a java bitmap object, attempt to lock the pixel address.\n * Locking will ensure that the memory for the pixels will not move\n * until the unlockPixels call, and ensure that, if the pixels had been\n * previously purged, they will have been restored.\n *\n * If this call succeeds, it must be balanced by a call to\n * AndroidBitmap_unlockPixels, after which time the address of the pixels should\n * no longer be used.\n *\n * If this succeeds, *addrPtr will be set to the pixel address. If the call\n * fails, addrPtr will be ignored.\n */\nint AndroidBitmap_lockPixels(JNIEnv* env, jobject jbitmap, void** addrPtr);\n</code></pre> <p>\u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u662f JNI \u63a5\u53e3\u6307\u9488\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f Bitmap \u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u6307\u5411\u50cf\u7d20\u7f13\u5b58\u5730\u5740\u7684\u6307\u9488\u3002</p> <p>AndroidBitmap_lockPixels \u6267\u884c\u6210\u529f\u7684\u8bdd\u8fd4\u56de 0 \uff0c\u5426\u5219\u8fd4\u56de\u4e00\u4e2a\u8d1f\u6570\uff0c\u9519\u8bef\u7801\u5217\u8868\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-bitmap-operation/#_2","title":"\u91ca\u653e\u539f\u751f\u50cf\u7d20\u7f13\u5b58","text":"<p>\u5bf9 Bitmap \u8c03\u7528\u5b8c AndroidBitmap_lockPixels \u4e4b\u540e\u90fd\u5e94\u8be5\u5bf9\u5e94\u8c03\u7528\u4e00\u6b21 AndroidBitmap_unlockPixels  \u7528\u6765\u91ca\u653e\u539f\u751f\u50cf\u7d20\u7f13\u5b58\u3002</p> <p>\u5f53\u5b8c\u6210\u5bf9\u539f\u751f\u50cf\u7d20\u7f13\u5b58\u7684\u8bfb\u5199\u4e4b\u540e\uff0c\u5c31\u5e94\u8be5\u91ca\u653e\u5b83\uff0c\u4e00\u65e6\u91ca\u653e\u540e\uff0cBitmap Java \u5bf9\u8c61\u53c8\u53ef\u4ee5\u5728 Java \u5c42\u4f7f\u7528\u4e86\uff0c\u51fd\u6570\u7b7e\u540d\u5982\u4e0b\uff1a</p> <pre><code>/**\n * Call this to balance a successful call to AndroidBitmap_lockPixels.\n */\nint AndroidBitmap_unlockPixels(JNIEnv* env, jobject jbitmap);\n</code></pre> <p>\u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u662f JNI \u63a5\u53e3\u6307\u9488\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c31\u662f Bitmap \u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u5982\u679c\u6267\u884c\u6210\u529f\u8fd4\u56de 0\uff0c\u5426\u5219\u8fd4\u56de 1\u3002</p> <p>\u5bf9 Bitmap \u7684\u64cd\u4f5c\uff0c\u6700\u91cd\u8981\u7684\u5c31\u662f AndroidBitmap_lockPixels \u51fd\u6570\u62ff\u5230\u6240\u6709\u50cf\u7d20\u7684\u7f13\u5b58\u5730\u5740\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u50cf\u7d20\u503c\u8fdb\u884c\u64cd\u4f5c\uff0c\u4ece\u800c\u66f4\u6539 Bitmap \u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-bitmap-operation/#_3","title":"\u5b9e\u8df5","text":"<p>\u901a\u8fc7\u5bf9 Bitmap \u8fdb\u884c\u65cb\u8f6c\uff0c\u4e0a\u4e0b\u7ffb\u8f6c\uff0c\u5de6\u53f3\u955c\u50cf\u6765\u4f53\u9a8c JNI \u7684\u5f00\u53d1\u3002</p> <p>\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5177\u4f53\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6b22\u8fce Star\u3002</p> <p>https://github.com/glumes/AndroidDevWithCpp</p>","tags":["NDK"]},{"location":"android/jni/android-jni-bitmap-operation/#jni-bitmap","title":"\u901a\u8fc7 JNI \u5c06 Bitmap \u65cb\u8f6c","text":"<p>\u9996\u5148\u5b9a\u4e49\u4e00\u4e2a\u8fd9\u6837\u7684 native \u51fd\u6570\uff1a</p> <pre><code>    // \u987a\u65f6\u9488\u65cb\u8f6c 90\u00b0 \u7684\u64cd\u4f5c\n    public native Bitmap rotateBitmap(Bitmap bitmap);\n</code></pre> <p>\u4f20\u5165\u4e00\u4e2a Bitmap \u5bf9\u8c61\uff0c\u7136\u540e\u8fd4\u56de\u4e00\u4e2a Bitmap \u5bf9\u8c61\u3002</p> <p>\u7136\u540e\u5728 C++ \u4ee3\u7801\u4e2d\uff0c\u9996\u5148\u68c0\u7d22 Bitmap \u7684\u4fe1\u606f\uff0c\u770b\u770b\u662f\u5426\u6210\u529f\u3002</p> <pre><code>    AndroidBitmapInfo bitmapInfo;\n    int ret;\n    if ((ret = AndroidBitmap_getInfo(env, bitmap, &amp;bitmapInfo)) &lt; 0) {\n        LOGE(\"AndroidBitmap_getInfo() failed ! error=%d\", ret);\n        return NULL;\n    }\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u83b7\u5f97 Bitmap \u7684\u50cf\u7d20\u7f13\u5b58\u6307\u9488\uff1a</p> <pre><code>    // \u8bfb\u53d6 bitmap \u7684\u50cf\u7d20\u5185\u5bb9\u5230 native \u5185\u5b58\n    void *bitmapPixels;\n    if ((ret = AndroidBitmap_lockPixels(env, bitmap, &amp;bitmapPixels)) &lt; 0) {\n        LOGE(\"AndroidBitmap_lockPixels() failed ! error=%d\", ret);\n        return NULL;\n    }\n</code></pre> <p>\u8fd9\u4e2a\u6307\u9488\u6307\u5411\u7684\u5c31\u662f Bitmap \u50cf\u7d20\u5185\u5bb9\uff0c\u5b83\u662f\u4e00\u4e2a\u4ee5\u4e00\u7ef4\u6570\u7ec4\u7684\u5f62\u5f0f\u4fdd\u5b58\u6240\u6709\u7684\u50cf\u7d20\u70b9\u7684\u503c\uff0c\u4f46\u662f\u6211\u4eec\u5728\u5b9a\u4e49 Bitmap \u56fe\u50cf\u65f6\uff0c\u90fd\u4f1a\u5b9a\u4e49\u5bbd\u548c\u9ad8\uff0c\u8fd9\u5c31\u76f8\u5bf9\u4e8e\u662f\u4e00\u4e2a\u4e8c\u7ef4\u7684\u4e86\uff0c\u90a3\u4e48\u5c31\u5b58\u5728 Bitmap \u7684\u50cf\u7d20\u5185\u5bb9\u5982\u4f55\u8f6c\u6210\u6307\u9488\u6307\u5411\u7684\u4e00\u7ef4\u5185\u5bb9\uff0c\u662f\u6309\u7167\u884c\u6392\u5217\u8fd8\u662f\u6309\u7167\u5217\u6392\u5217\u5462\uff1f</p> <p>\u5728\u8fd9\u91cc\u662f\u6309\u7167\u884c\u8fdb\u884c\u6392\u5217\u7684\uff0c\u800c\u4e14\u884c\u7684\u6392\u5217\u662f\u4ece\u5de6\u5f80\u53f3\uff0c\u5217\u7684\u6392\u5217\u662f\u4ece\u4e0a\u5f80\u4e0b\uff0c\u8d77\u59cb\u70b9\u5c31\u548c\u5c4f\u5e55\u5750\u6807\u539f\u70b9\u4e00\u6837\uff0c\u4f4d\u4e8e\u5de6\u4e0a\u89d2\u3002</p> <p>\u901a\u8fc7 AndroidBitmap_lockPixels \u65b9\u6cd5\uff0cbitmapPixels \u6307\u9488\u5c31\u6307\u5411\u4e86 Bitmap \u7684\u50cf\u7d20\u5185\u5bb9\uff0c\u5b83\u7684\u957f\u5ea6\u5c31\u662f Bitmap \u7684\u5bbd\u548c\u9ad8\u7684\u4e58\u79ef\u3002</p> <p>\u8981\u5c06 Bitmap \u8fdb\u884c\u65cb\u8f6c\uff0c\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u66f4\u6539 bitmapPixels \u6307\u9488\u6307\u5411\u7684\u50cf\u7d20\u70b9\u7684\u503c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Bitmap \u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u50cf\u7d20\u503c\u586b\u5145\u5230 Bitmap \u5bf9\u8c61\u4e2d\uff0c\u8fd9\u91cc\u9009\u62e9\u540e\u8005\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002</p> <p>\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Bitmap \u5bf9\u8c61\uff0c\u53c2\u8003\u4e4b\u524d\u6587\u7ae0\u4e2d\u63d0\u5230\u7684\u65b9\u5f0f\uff1aAndroid \u901a\u8fc7 JNI \u8bbf\u95ee Java \u5b57\u6bb5\u548c\u65b9\u6cd5\u8c03\u7528\u3002</p> <p>\u5728 Java \u4ee3\u7801\u4e2d\uff0c\u901a\u8fc7  createBitmap \u65b9\u6cd5\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a Bitmap\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p><pre><code> Bitmap.createBitmap(int width, int height, @NonNull Config config)`\n</code></pre> \u6240\u4ee5\u5728 JNI \u4e2d\u5c31\u9700\u8981\u8c03\u7528 Bitmap \u7684\u9759\u6001\u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a Bitmap \u5bf9\u8c61\u3002</p> <pre><code>jobject generateBitmap(JNIEnv *env, uint32_t width, uint32_t height) {\n\n    jclass bitmapCls = env-&gt;FindClass(\"android/graphics/Bitmap\");\n    jmethodID createBitmapFunction = env-&gt;GetStaticMethodID(bitmapCls,\n                                                            \"createBitmap\",\n                                                            \"(IILandroid/graphics/Bitmap$Config;)Landroid/graphics/Bitmap;\");\n    jstring configName = env-&gt;NewStringUTF(\"ARGB_8888\");\n    jclass bitmapConfigClass = env-&gt;FindClass(\"android/graphics/Bitmap$Config\");\n    jmethodID valueOfBitmapConfigFunction = env-&gt;GetStaticMethodID(\n            bitmapConfigClass, \"valueOf\",\n            \"(Ljava/lang/String;)Landroid/graphics/Bitmap$Config;\");\n\n    jobject bitmapConfig = env-&gt;CallStaticObjectMethod(bitmapConfigClass,\n                                                       valueOfBitmapConfigFunction, configName);\n\n    jobject newBitmap = env-&gt;CallStaticObjectMethod(bitmapCls,\n                                                    createBitmapFunction,\n                                                    width,\n                                                    height, bitmapConfig);\n    return newBitmap;\n}\n</code></pre> <p>\u9996\u5148\u901a\u8fc7 <code>FindClass</code> \u65b9\u6cd5\u627e\u5230 Config \u7c7b\uff0c\u5f97\u5230\u4e00\u4e2a ARGB_8888 \u7684\u914d\u7f6e\uff0c\u7136\u540e\u5f97\u5230 Bitmap \u7c7b\uff0c\u8c03\u7528\u5b83\u7684\u9759\u6001\u65b9\u6cd5 <code>createBitmap</code> \u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Bitmap \u5bf9\u8c61\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u4e4b\u524d\u7684\u6587\u7ae0\u3002</p> <p>\u5728\u8fd9\u91cc\u8981\u4f20\u5165\u65b0 Bitmap \u7684\u5bbd\u9ad8\uff0c\u8fd9\u4e2a\u5bbd\u9ad8\u4e5f\u662f\u901a\u8fc7 <code>AndroidBitmap_getInfo</code> \u65b9\u6cd5\u5f97\u5230\u539f\u6765\u7684\u5bbd\u9ad8\u4e4b\u540e\uff0c\u6839\u636e\u4e0d\u540c\u7684\u64cd\u4f5c\u8ba1\u7b97\u540e\u5f97\u5230\u7684\u3002</p> <pre><code>    // \u65cb\u8f6c\u64cd\u4f5c\uff0c\u65b0 Bitmap \u7684\u5bbd\u7b49\u4e8e\u539f\u6765\u7684\u9ad8\uff0c\u65b0 Bitmap \u7684\u9ad8\u7b49\u4e8e\u539f\u6765\u7684\u5bbd\n   uint32_t newWidth = bitmapInfo.height;\n    uint32_t newHeight = bitmapInfo.width;\n</code></pre> <p>\u6709\u4e86\u65b0\u7684 Bitmap \u5bf9\u8c61\uff0c\u53c8\u6709\u4e86\u539f\u6709\u7684 Bitmap \u50cf\u7d20\u6307\u9488\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u521b\u5efa\u65b0\u7684\u50cf\u7d20\u6307\u9488\uff0c\u5e76\u586b\u5145\u50cf\u7d20\u5185\u5bb9\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u50cf\u7d20\u5185\u5bb9\u518d\u586b\u5145\u5230 Bitmap \u4e0a\u3002</p> <pre><code>    // \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6570\u7ec4\u6307\u9488\uff0c\u628a\u8fd9\u4e2a\u65b0\u7684\u6570\u7ec4\u6307\u9488\u586b\u5145\u50cf\u7d20\u503c\n    uint32_t *newBitmapPixels = new uint32_t[newWidth * newHeight];\n    int whereToGet = 0;\n    for (int y = 0; y &lt; newHeight; ++y) {\n        for (int x = newWidth - 1; x &gt;= 0; x--) {\n            uint32_t pixel = ((uint32_t *) bitmapPixels)[whereToGet++];\n            newBitmapPixels[newWidth * y + x] = pixel;\n        }\n    }\n</code></pre> <p>\u5728\u8fd9\u4e24\u4e2a <code>for</code>\u5faa\u73af\u91cc\u9762\u5c31\u662f\u4ece\u539f\u6765\u7684\u50cf\u7d20\u6307\u9488\u4e2d\u53d6\u51fa\u50cf\u7d20\u503c\uff0c\u7136\u540e\u628a\u5b83\u6309\u7167\u7279\u5b9a\u7684\u6392\u5217\u987a\u5e8f\u586b\u5145\u5230\u65b0\u7684\u50cf\u7d20\u6307\u9488\u4e2d\u5bf9\u5e94\u4f4d\u7f6e\u7684\u503c\uff0c\u8fd9\u91cc\u4e5f\u5c31\u662f\u524d\u9762\u5f3a\u8c03\u7684\u50cf\u7d20\u6307\u9488\u662f\u6309\u7167\u884c\u8fdb\u884c\u6392\u5217\u7684\uff0c\u8d77\u70b9\u662f Bitmap \u7684\u5de6\u4e0a\u89d2\u3002</p> <pre><code>    void *resultBitmapPixels;\n    if ((ret = AndroidBitmap_lockPixels(env, newBitmap, &amp;resultBitmapPixels)) &lt; 0) {\n        LOGE(\"AndroidBitmap_lockPixels() failed ! error=%d\", ret);\n        return NULL;\n    }\n    int pixelsCount = newWidth * newHeight;\n    memcpy((uint32_t *) resultBitmapPixels, newBitmapPixels, sizeof(uint32_t) * pixelsCount);\n    AndroidBitmap_unlockPixels(env, newBitmap);\n</code></pre> <p>\u518d\u6b21\u521b\u5efa\u4e00\u4e2a resultBitmapPixels \u6307\u9488\uff0c\u5e76\u8c03\u7528 AndroidBitmap_lockPixels \u65b9\u6cd5\u83b7\u53d6\u65b0\u7684 Bitmap \u7684\u50cf\u7d20\u6307\u9488\u7f13\u5b58\uff0c\u7136\u540e\u8c03\u7528 <code>memcpy</code> \u65b9\u6cd5\uff0c\u5c06\u5f85\u586b\u5145\u7684\u50cf\u7d20\u6307\u9488\u586b\u5145\u5230 resultBitmapPixels \u4e0a\uff0c\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u50cf\u7d20\u7684\u8d4b\u503c\uff0c\u6700\u540e\u8c03\u7528 <code>AndroidBitmap_unlockPixels</code> \u65b9\u6cd5\u91ca\u653e\u50cf\u7d20\u6307\u9488\u7f13\u5b58\uff0c\u5b8c\u6210\u6574\u4e2a\u8d4b\u503c\u8fc7\u7a0b\u3002</p> <p>\u5c31\u8fd9\u6837\u901a\u8fc7\u8bfb\u53d6\u539f\u6709 Bitmap \u7684\u50cf\u7d20\u5185\u5bb9\u7136\u540e\u8fdb\u884c\u64cd\u4f5c\u540e\u518d\u8d4b\u503c\u7ed9\u65b0\u7684 Bitmap \u5bf9\u8c61\u5c31\u5b8c\u6210\u4e86 JNI \u64cd\u4f5c Bitmap \u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-bitmap-operation/#jni-bitmap_1","title":"\u901a\u8fc7 JNI \u5c06 Bitmap \u4e0a\u4e0b\u7ffb\u8f6c\u548c\u5de6\u53f3\u955c\u50cf","text":"<p>\u5c06 Bitmap \u8fdb\u884c\u4e0a\u4e0b\u7ffb\u8f6c\u4ee5\u53ca\u5de6\u53f3\u955c\u50cf\u548c\u65cb\u8f6c\u64cd\u4f5c\u7c7b\u4f3c\u4e86\uff0c\u53ea\u662f\u9488\u5bf9\u50cf\u7d20\u6307\u9488\u7684\u64cd\u4f5c\u65b9\u5f0f\u4e0d\u540c\u3002</p> <p>\u4e0a\u4e0b\u7ffb\u8f6c\u7684\u64cd\u4f5c\uff1a</p> <pre><code>    int whereToGet = 0;\n    for (int y = 0; y &lt; newHeight; ++y) {\n        for (int x = 0; x &lt; newWidth; x++) {\n            uint32_t pixel = ((uint32_t *) bitmapPixels)[whereToGet++];\n            newBitmapPixels[newWidth * (newHeight - 1 - y) + x] = pixel;\n        }\n    }\n</code></pre> <p>\u5de6\u53f3\u955c\u50cf\u7684\u64cd\u4f5c\uff1a</p> <pre><code>    int whereToGet = 0;\n    for (int y = 0; y &lt; newHeight; ++y) {\n        for (int x = newWidth - 1; x &gt;= 0; x--) {\n            uint32_t pixel = ((uint32_t *) bitmapPixels)[whereToGet++];\n            newBitmapPixels[newWidth * y + x] = pixel;\n        }\n    }\n</code></pre> <p>\u5176\u4ed6\u7684\u64cd\u4f5c\u90fd\u76f8\u540c\u4e86\uff0c\u5177\u4f53\u8fd8\u662f\u770b\u9879\u76ee\u4ee3\u7801\u5427\u3002</p> <p>\u53c2\u8003</p> <ol> <li>\u300aAndroid C++ \u9ad8\u7ea7\u7f16\u7a0b--\u4f7f\u7528 NDK\u300b</li> </ol>","tags":["NDK"]},{"location":"android/jni/android-jni-cache-fieldid-and-methodid/","title":"Android  JNI \u8c03\u7528\u65f6\u7f13\u5b58\u5b57\u6bb5\u548c\u65b9\u6cd5 ID","text":"<p>\u5728 JNI \u53bb\u8c03\u7528 Java \u7684\u65b9\u6cd5\u548c\u8bbf\u95ee\u5b57\u6bb5\u65f6\uff0c\u6700\u5148\u8981\u505a\u7684\u64cd\u4f5c\u5c31\u662f\u83b7\u5f97\u5bf9\u5e94\u7684\u7c7b\u4ee5\u53ca\u5bf9\u5e94\u7684\u65b9\u6cd5 id\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u901a\u8fc7 FindClass \u3001GetFieldID\u3001GetMethodID \u53bb\u627e\u5230\u5bf9\u5e94\u7684\u4fe1\u606f\u662f\u5f88\u8017\u65f6\u7684\uff0c\u5982\u679c\u65b9\u6cd5\u88ab\u9891\u7e41\u8c03\u7528\uff0c\u90a3\u4e48\u80af\u5b9a\u4e0d\u80fd\u6bcf\u6b21\u90fd\u53bb\u67e5\u627e\u5bf9\u5e94\u7684\u4fe1\u606f\uff0c\u6709\u5fc5\u8981\u5c06\u5b83\u4eec\u7f13\u5b58\u8d77\u6765\uff0c\u5728\u4e0b\u4e00\u6b21\u8c03\u7528\u65f6\uff0c\u76f4\u63a5\u4f7f\u7528\u7f13\u5b58\u5185\u5bb9\u5c31\u597d\u4e86\u3002</p> <p>\u7f13\u5b58\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u5206\u522b\u662f\u4f7f\u7528\u65f6\u7f13\u5b58\u548c\u521d\u59cb\u5316\u65f6\u7f13\u5b58\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-cache-fieldid-and-methodid/#_1","title":"\u4f7f\u7528\u65f6\u7f13\u5b58","text":"<p>\u4f7f\u7528\u65f6\u7f13\u5b58\uff0c\u5c31\u662f\u5728\u8c03\u7528\u65f6\u67e5\u627e\u4e00\u6b21\uff0c\u7136\u540e\u5c06\u5b83\u7f13\u5b58\u6210 <code>static</code> \u53d8\u91cf\uff0c\u8fd9\u6837\u4e0b\u6b21\u8c03\u7528\u65f6\u5c31\u5df2\u7ecf\u88ab\u521d\u59cb\u5316\u8fc7\u4e86\u3002</p> <p>\u76f4\u5230\u5185\u5b58\u91ca\u653e\u4e86\uff0c\u624d\u4f1a\u7f13\u5b58\u5931\u6548\u3002</p> <pre><code>extern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_CacheFieldAndMethodOps_staticCacheField(JNIEnv *env, jobject instance, jobject animal) {\n    static jfieldID fid = NULL; // \u58f0\u660e\u4e3a static \u53d8\u91cf\u8fdb\u884c\u7f13\u5b58\n    // \u4e24\u79cd\u65b9\u6cd5\u90fd\u884c\n//    jclass cls = env-&gt;GetObjectClass(animal);\n    jclass cls = env-&gt;FindClass(\"com/glumes/cppso/model/Animal\");\n    jstring jstr;\n    const char *c_str;\n    // \u4ece\u7f13\u5b58\u4e2d\u67e5\u627e\n    if (fid == NULL) {\n        fid = env-&gt;GetFieldID(cls, \"name\", \"Ljava/lang/String;\");\n        if (fid == NULL) {\n            return;\n        }\n    } else {\n        LOGD(\"field id is cached\");\n    }\n    jstr = (jstring) env-&gt;GetObjectField(animal, fid);\n    c_str = env-&gt;GetStringUTFChars(jstr, NULL);\n    if (c_str == NULL) {\n        return;\n    }\n    env-&gt;ReleaseStringUTFChars(jstr, c_str);\n    jstr = env-&gt;NewStringUTF(\"new name\");\n    if (jstr == NULL) {\n        return;\n    }\n    env-&gt;SetObjectField(animal, fid, jstr);\n}\n</code></pre> <p>\u901a\u8fc7\u58f0\u660e\u4e3a static \u53d8\u91cf\u8fdb\u884c\u7f13\u5b58\u3002\u4f46\u8fd9\u79cd\u7f13\u5b58\u65b9\u5f0f\u663e\u7136\u6709\u5f0a\u7aef\uff0c\u5f53\u591a\u4e2a\u8c03\u7528\u8005\u540c\u65f6\u8c03\u7528\u65f6\uff0c\u5c31\u4f1a\u51fa\u73b0\u7f13\u5b58\u591a\u6b21\u7684\u60c5\u51b5\uff0c\u5e76\u4e14\u6bcf\u6b21\u8c03\u7528\u65f6\u90fd\u8981\u68c0\u67e5\u662f\u5426\u7f13\u5b58\u8fc7\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-cache-fieldid-and-methodid/#_2","title":"\u521d\u59cb\u5316\u65f6\u7f13\u5b58","text":"<p>\u5728\u521d\u59cb\u5316\u65f6\u7f13\u5b58\uff0c\u5c31\u662f\u5728\u7c7b\u52a0\u8f7d\u65f6\uff0c\u8fdb\u884c\u7f13\u5b58\u3002\u5f53\u7c7b\u88ab\u52a0\u8f7d\u8fdb\u5185\u5b58\u65f6\uff0c\u4f1a\u5148\u8c03\u7528\u7c7b\u7684\u9759\u6001\u4ee3\u7801\u5757\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728\u7c7b\u7684\u9759\u6001\u4ee3\u7801\u5757\u4e2d\u8fdb\u884c\u7f13\u5b58\u3002</p> <p>\u6bd4\u5982\uff1a <pre><code>public class CacheFieldAndMethodOps extends BaseOperation {\n\n    static {\n        initCacheMethodId(); // \u9759\u6001\u4ee3\u7801\u5757\u4e2d\u8fdb\u884c\u7f13\u5b58\n    }\n    private static native void initCacheMethodId();\n}\n</code></pre></p> <p>\u5728\u9759\u6001\u4ee3\u7801\u5757\u4e2d\uff0c\u53ef\u4ee5\u5c06\u6240\u9700\u8981\u7684\u5b57\u6bb5 id \u6216\u8005\u65b9\u6cd5 id \u7f13\u5b58\u6210\u5168\u5c40\u53d8\u91cf\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p><pre><code>// \u5168\u5c40\u53d8\u91cf\uff0c\u4f5c\u4e3a\u7f13\u5b58\u65b9\u6cd5 id\njmethodID InstanceMethodCache;\n\n// \u521d\u59cb\u5316\u52a0\u8f7d\u65f6\u7f13\u5b58\u65b9\u6cd5 id\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_CacheFieldAndMethodOps_initCacheMethodId(JNIEnv *env, jclass type) {\n    jclass cls = env-&gt;FindClass(\"com/glumes/cppso/model/Animal\");\n    InstanceMethodCache = env-&gt;GetMethodID(cls, \"getName\", \"()Ljava/lang/String;\");\n}\n</code></pre> \u5728 JNI \u4e2d\u76f4\u63a5\u5c06\u65b9\u6cd5 id \u7f13\u5b58\u6210\u5168\u5c40\u53d8\u91cf\u4e86\uff0c\u8fd9\u6837\u518d\u8c03\u7528\u65f6\uff0c\u5c31\u4e0d\u8981\u518d\u8fdb\u884c\u4e00\u6b21\u67e5\u627e\u4e86\uff0c\u5e76\u4e14\u907f\u514d\u4e86\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8c03\u7528\u4f1a\u591a\u6b21\u67e5\u627e\u7684\u60c5\u51b5\u3002</p> <pre><code>extern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_CacheFieldAndMethodOps_callCacheMethod(JNIEnv *env, jobject instance, jobject animal) {\n    jstring name = (jstring) env-&gt;CallObjectMethod(animal, InstanceMethodCache);\n    const char *c_name = env-&gt;GetStringUTFChars(name, NULL);\n    LOGD(\"call cache method and value is %s\", c_name);\n}\n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-cache-fieldid-and-methodid/#_3","title":"\u5c0f\u7ed3","text":"<p>\u53ef\u4ee5\u770b\u51fa\uff0c\u5982\u679c\u4e0d\u80fd\u9884\u5148\u77e5\u9053\u65b9\u6cd5\u548c\u5b57\u6bb5\u6240\u5728\u7c7b\u7684\u6e90\u7801\uff0c\u90a3\u4e48\u5728\u4f7f\u7528\u65f6\u7f13\u5b58\u6bd4\u8f83\u5408\u7406\u3002\u4f46\u5982\u679c\u77e5\u9053\u7684\u8bdd\uff0c\u5728\u521d\u59cb\u5316\u65f6\u7f13\u5b58\u4f18\u70b9\u8f83\u591a\uff0c\u65e2\u907f\u514d\u4e86\u6bcf\u6b21\u4f7f\u7528\u65f6\u68c0\u67e5\uff0c\u8fd8\u907f\u514d\u4e86\u5728\u591a\u7ebf\u7a0b\u88ab\u8c03\u7528\u7684\u60c5\u51b5\u3002</p> <p>\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u53c2\u8003\u6211\u7684 Github \u9879\u76ee https://github.com/glumes/AndroidDevWithCpp\uff0c\u6b22\u8fce Star\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-exception-handle/","title":"Android JNI \u8c03\u7528\u65f6\u7684\u5f02\u5e38\u5904\u7406","text":"<p>Android JNI \u8c03\u7528\u65f6\u7684\u5f02\u5e38\u4e3b\u8981\u6709\u5982\u4e0b\u4e24\u79cd\uff1a</p> <ul> <li>Native \u4ee3\u7801\u8c03\u7528 Java \u5c42\u4ee3\u7801\u65f6\u53d1\u751f\u4e86\u5f02\u5e38\u8981\u5904\u7406</li> <li>Native \u4ee3\u7801\u81ea\u5df1\u629b\u51fa\u4e86\u4e00\u4e2a\u5f02\u5e38\u8ba9 Java \u5c42\u53bb\u5904\u7406</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\u5f02\u5e38\u7684\u53d1\u751f\u548c\u5904\u7406\u57fa\u672c\u90fd\u9700\u8981 Native \u548c Java \u4ea4\u4e92\uff0c\u800c\u5bf9\u4e8e Native \u81ea\u8eab\u51fa\u4e86\u5f02\u5e38\uff0c\u4e5f\u5c31\u662f C/C++ \u4ee3\u7801\u6709\u95ee\u9898\uff0c\u5bfc\u81f4\u5e94\u7528\u5d29\u6e83\u7684\u53c8\u662f\u53e6\u4e00\u56de\u4e8b\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-exception-handle/#native-java","title":"Native \u8c03\u7528 Java \u65b9\u6cd5\u65f6\u7684\u5f02\u5e38","text":"<p>\u4e4b\u524d\u7684\u535a\u5ba2\u4e2d\u5c31\u8bb2\u8ff0\u4e86\u5982\u4f55\u4ece Native \u8c03\u7528 Java \u7684\u65b9\u6cd5\uff0c\u5148\u51c6\u5907\u4e00\u4e2a\u6709\u5f02\u5e38\u7684\u65b9\u6cd5\u4f9b Native \u53bb\u8c03\u7528\u3002</p> <pre><code>    private int operation() {\n        return 2 / 0;\n    }\n</code></pre> <p>\u7136\u540e\u5728 Native \u4e2d\u8c03\u7528\u8be5\u65b9\u6cd5\u3002</p> <pre><code>    jclass cls = env-&gt;FindClass(\"com/glumes/cppso/jnioperations/ExceptionOps\");\n    jmethodID mid = env-&gt;GetMethodID(cls, \"&lt;init&gt;\", \"()V\");\n    jobject obj = env-&gt;NewObject(cls, mid);\n    mid = env-&gt;GetMethodID(cls, \"operation\", \"()I\");\n    // \u5148\u521d\u59cb\u5316\u4e00\u4e2a\u7c7b\uff0c\u7136\u540e\u8c03\u7528\u7c7b\u65b9\u6cd5\uff0c\u5c31\u5982\u535a\u5ba2\u4e2d\u63cf\u8ff0\u7684\u90a3\u6837\n    env-&gt;CallIntMethod(obj, mid);\n</code></pre> <p>\u663e\u7136\uff0c\u9664\u6570\u4e3a 0 \uff0c\u4e00\u8c03\u7528\u5e94\u7528\u76f4\u63a5\u5d29\u6e83\u4e86\u3002</p> <pre><code> java.lang.ArithmeticException: divide by zero\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u8981\u8fdb\u884c\u5f02\u5e38\u5904\u7406\u7684\u90e8\u5206\u4e86\u3002</p> <pre><code>    jclass cls = env-&gt;FindClass(\"com/glumes/cppso/jnioperations/ExceptionOps\");\n    jmethodID mid = env-&gt;GetMethodID(cls, \"&lt;init&gt;\", \"()V\");\n    jobject obj = env-&gt;NewObject(cls, mid);\n    mid = env-&gt;GetMethodID(cls, \"operation\", \"()I\");\n// \u5148\u521d\u59cb\u5316\u4e00\u4e2a\u7c7b\uff0c\u7136\u540e\u8c03\u7528\u7c7b\u65b9\u6cd5\uff0c\u5c31\u5982\u535a\u5ba2\u4e2d\u63cf\u8ff0\u7684\u90a3\u6837\n    env-&gt;CallIntMethod(obj, mid);\n    //\u68c0\u67e5\u662f\u5426\u53d1\u751f\u4e86\u5f02\u5e38\n    jthrowable exc = env-&gt;ExceptionOccurred();\n//    jboolean result = env-&gt;ExceptionCheck();\n\n    if (exc) {\n        // \u6253\u5370\u5f02\u5e38\u65e5\u5fd7\n        env-&gt;ExceptionDescribe();\n        // \u8fd9\u884c\u4ee3\u7801\u624d\u662f\u5173\u952e\u4e0d\u8ba9\u5e94\u7528\u5d29\u6e83\u7684\u4ee3\u7801\uff0c\n        env-&gt;ExceptionClear();\n        // \u53d1\u751f\u5f02\u5e38\u4e86\u8981\u8bb0\u5f97\u91ca\u653e\u8d44\u6e90\n        env-&gt;DeleteLocalRef(cls);\n        env-&gt;DeleteLocalRef(obj);\n    }\n</code></pre> <p>\u6dfb\u52a0\u5982\u4e0a\u4ee3\u7801\u8fdb\u884c\u5904\u7406\u540e\uff0c\u5e94\u7528\u5e76\u4e0d\u4f1a\u76f4\u63a5\u5d29\u6e83\u4e86\uff0c\u5e76\u4e14\u5728 LogCat \u4e2d\u4f1a\u770b\u5230\u5bf9\u5e94\u7684\u5f02\u5e38\u65e5\u5fd7\uff0c\u8fd9\u91cc\u9762\u5230\u4e86\u505a\u4e86\u54ea\u4e9b\u64cd\u4f5c\u5462\uff1f</p> <p>Native \u63d0\u4f9b\u4e86 <code>ExceptionOccurred</code> \u548c <code>ExceptionCheck</code> \u65b9\u6cd5\u6765\u68c0\u6d4b\u662f\u5426\u6709\u5f02\u5e38\u53d1\u751f\uff0c\u524d\u8005\u8fd4\u56de\u7684\u662f <code>jthrowable</code> \u7c7b\u578b\uff0c\u540e\u8005\u8fd4\u56de\u7684\u662f <code>jboolean</code> \u7c7b\u578b\u3002</p> <p>\u5982\u679c\u6709\u5f02\u5e38\uff0c\u4f1a\u901a\u8fc7 <code>ExceptionDescribe</code> \u65b9\u6cd5\u6765\u6253\u5370\u5f02\u5e38\u4fe1\u606f\uff0c\u65b9\u4fbf\u6211\u4eec\u5728 LogCat \u4e2d\u770b\u5230\u5bf9\u5e94\u7684\u4fe1\u606f\u3002</p> <p>\u800c <code>ExceptionClear</code> \u65b9\u6cd5\u5219\u662f\u5173\u952e\u7684\u4e0d\u4f1a\u8ba9\u5e94\u7528\u76f4\u63a5\u5d29\u6e83\u7684\u65b9\u6cd5\uff0c\u7c7b\u4f3c\u4e8e Java \u7684 <code>catch</code> \u6355\u83b7\u5f02\u5e38\u5904\u7406\uff0c\u5b83\u4f1a\u6d88\u9664\u8fd9\u6b21\u5f02\u5e38\u3002</p> <p>\u8fd9\u6837\u5c31\u628a\u7531 Native \u8c03\u7528 Java \u65f6\u7684\u4e00\u4e2a\u5f02\u5e38\u8fdb\u884c\u4e86\u5904\u7406\uff0c\u5f53\u5904\u7406\u5b8c\u5f02\u5e38\u4e4b\u540e\uff0c\u522b\u5fd8\u4e86\u91ca\u653e\u5bf9\u5e94\u7684\u8d44\u6e90\u3002</p> <p>\u4e0d\u8fc7\uff0c\u6211\u4eec\u8fd9\u6837\u4ec5\u4ec5\u662f\u6d88\u9664\u4e86\u8fd9\u6b21\u5f02\u5e38\uff0c\u8fd8\u5e94\u8be5\u8ba9\u8c03\u7528\u8005\u6709\u5f02\u5e38\u7684\u53d1\u751f\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u901a\u8fc7 Native \u6765\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\u544a\u8bc9 Java \u8c03\u7528\u8005\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-exception-handle/#native-java_1","title":"Native \u629b\u51fa Java \u4e2d\u7684\u5f02\u5e38","text":"<p>\u6709\u65f6\u5728 Native \u4ee3\u7801\u4e2d\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u9700\u8981\u629b\u51fa\u5f02\u5e38\u5230 Java \uff0c\u4ea4\u7531\u4e0a\u5c42\u53bb\u5904\u7406\u3002</p> <p>\u6bd4\u5982 Java \u8c03\u7528 Native \u65b9\u6cd5\u4f20\u9012\u4e86\u67d0\u4e2a\u53c2\u6570\uff0c\u800c\u8fd9\u4e2a\u53c2\u6570\u6709\u95ee\u9898\uff0c\u90a3\u4e48 Native \u5c31\u53ef\u4ee5\u629b\u51fa\u5f02\u5e38\u8ba9 Java \u53bb\u5904\u7406\u8fd9\u4e2a\u53c2\u6570\u5f02\u5e38\u7684\u95ee\u9898\u3002</p> <p>Native \u629b\u51fa\u5f02\u5e38\u7684\u4ee3\u7801\u5927\u81f4\u90fd\u662f\u76f8\u540c\u7684\uff0c\u53ef\u4ee5\u62bd\u51fa\u4e00\u4e2a\u901a\u7528\u51fd\u6570\u6765\uff1a</p> <pre><code>void throwByName(JNIEnv *env, const char *name, const char *msg) {\n    jclass cls = env-&gt;FindClass(name);\n    if (cls != NULL) {\n        env-&gt;ThrowNew(cls, msg);\n    }\n    env-&gt;DeleteLocalRef(cls);\n}\n// \u8c03\u7528\u629b\u51fa\u5f02\u5e38\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_ExceptionOps_nativeThrowException(JNIEnv *env, jobject instance) {\n    throwByName(env, \"java/lang/IllegalArgumentException\", \"native throw exception\");\n}\n</code></pre> <p>\u6839\u636e\u5f02\u5e38\u7c7b\u578b\u548c\u5f02\u5e38\u4fe1\u606f\u6765\u629b\u51fa\u5f02\u5e38\u3002</p> <p>\u800c\u5728 Java \u4e2d\uff0c\u5c31\u5fc5\u987b\u8981\u7528 try ... catch... \u6765\u51c6\u5907\u597d\u6355\u83b7\u8fd9\u6b21\u5f02\u5e38\u4e86\u3002</p> <pre><code>        try {\n            nativeThrowException();\n        } catch (IllegalArgumentException e) {\n            Log.e(\"NativeMethod\", e.getMessage());\n        }\n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-exception-handle/#_1","title":"\u5f02\u5e38\u5904\u7406\u5c0f\u7ed3","text":"<p>\u9664\u4e86\u4ee5\u4e0a\u4e24\u79cd\u5f02\u5e38\u60c5\u51b5\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u7279\u522b\u5e38\u89c1\u7684\u5f02\u5e38\uff0c\u5c31\u662f\u5f53\u5224\u65ad\u67d0\u4e2a\u53d8\u91cf\u4e3a NULL \u4e4b\u540e\uff0c\u6267\u884c\u7acb\u5373\u8fd4\u56de\u7684\u64cd\u4f5c\u3002</p> <p>\u5f53\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u4e00\u5b9a\u8981\u5148\u5904\u7406\u5f02\u5e38\uff0c\u7136\u540e\u624d\u80fd\u7ee7\u7eed\u6267\u884c\u540e\u9762\u7684\u6b65\u9aa4\u3002\u5982\u679c\u4e0d\u662f\u9700\u8981\u7acb\u5373\u8fd4\u56de\u7684\uff0c\u90a3\u4e48\u5c31\u901a\u8fc7 <code>ExceptionClear</code>\u6e05\u9664\u8fd9\u6b21\u5f02\u5e38\uff0c\u7136\u540e\u5728\u8fdb\u884c\u5176\u4ed6\u7684\u5904\u7406\u3002</p> <p>\u5bf9\u4e8e\u5728 Native \u4e2d\u53d1\u751f\u4e86\u5f02\u5e38\uff0c\u9700\u8981\u8ba9 Java \u5c42\u53bb\u5904\u7406\u4e86\uff0c\u5219\u5728 Native \u4e2d\u629b\u51fa\u5bf9\u5e94\u7684\u5f02\u5e38\uff0c\u7531 Java \u5c42\u53bb\u6355\u83b7\uff0c\u6bd4\u5982\u5728\u4f7f\u7528 <code>ExceptionClear</code> \u6e05\u9664\u4e86\u5f02\u5e38\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7 <code>throwNew</code> \u6765\u629b\u51fa\u5f02\u5e38\u4fe1\u606f\u3002</p> <p>\u5177\u4f53\u7684\u5f02\u5e38\u5904\u7406\u65b9\u6cd5\u548c\u65f6\u673a\u8fd8\u662f\u8981\u770b\u5177\u4f53\u7684\u4f7f\u7528\u573a\u666f\uff0c\u9009\u62e9\u6700\u5408\u9002\u7684\u5904\u7406\u65b9\u6cd5\u3002</p> <p>\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u53c2\u8003\u6211\u7684 Github \u9879\u76ee https://github.com/glumes/AndroidDevWithCpp\uff0c\u6b22\u8fce Star\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-invoke-constructor-method-and-super-method/","title":"Android \u901a\u8fc7 JNI \u8c03\u7528 Java \u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u548c\u7236\u7c7b\u7684\u65b9\u6cd5","text":"<p>Android \u8fd8\u53ef\u4ee5\u901a\u8fc7 JNI \u6765\u8c03\u7528 Java \u4e00\u4e2a\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u4ece\u800c\u521b\u5efa\u4e00\u4e2a Java \u7c7b\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-invoke-constructor-method-and-super-method/#_1","title":"\u8c03\u7528\u6784\u9020\u65b9\u6cd5","text":"<p>\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u7684\u6b65\u9aa4\u548c\u4e4b\u524d\u8c03\u7528\u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5\u6b65\u9aa4\u7c7b\u4f3c\uff0c\u4e5f\u9700\u8981\u83b7\u5f97\u5bf9\u5e94\u7684\u7c7b\u548c\u65b9\u6cd5 id\u3002</p> <p>\u5bf9\u4e8e\u7c7b\uff0c\u901a\u8fc7 FindClass \u53ef\u4ee5\u627e\u5230\u5bf9\u5e94\u7684 Java \u7c7b\u578b\u3002</p> <p>\u5bf9\u4e8e\u6784\u9020\u65b9\u6cd5\uff0c\u5b83\u7684\u65b9\u6cd5 id \u8fd8\u662f\u901a\u8fc7 <code>GetMethodID</code> \u65b9\u6cd5\u6765\u83b7\u5f97\uff0c\u4f46\u662f\u6784\u9020\u65b9\u6cd5\u5bf9\u5e94\u7684\u540d\u79f0\u4e3a \uff0c\u8fd4\u56de\u503c\u7c7b\u578b\u662f void \u7c7b\u578b\u7684\u3002 <p>\u5b8c\u6210\u4e86\u4ee5\u4e0a\u51c6\u5907\u6761\u4ef6\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7 <code>NewObject</code> \u6765\u8c03\u7528\u6784\u9020\u65b9\u6cd5\uff0c\u4ece\u800c\u521b\u5efa\u5177\u4f53\u7684\u7c7b\u3002</p> <p>\u4e0b\u9762\u4ee5 String \u7684\u67d0\u4e2a\u6784\u9020\u65b9\u6cd5\u4e3a\u4f8b</p> <pre><code>public String(char value[]) // Java String \u7c7b\u7684\u5176\u4e2d\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5\n</code></pre> <p>\u5bf9\u5e94\u7684 C++ \u4ee3\u7801\uff1a <pre><code>extern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_glumes_cppso_jnioperations_InvokeConstructorOps_invokeStringConstructors(JNIEnv *env, jobject instance) {\n\n    jclass stringClass;\n    jmethodID cid;\n    jcharArray elemArr;\n    jstring result;\n\n    // \u7531 C++ \u5b57\u7b26\u4e32\u521b\u5efa\u4e00\u4e2a Java \u5b57\u7b26\u4e32\n    jstring temp = env-&gt;NewStringUTF(\"this is char array\");\n    // \u518d\u4ece Java \u5b57\u7b26\u4e32\u83b7\u5f97\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4\u6307\u9488\uff0c\u4f5c\u4e3a String \u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\n    const jchar *chars = env-&gt;GetStringChars(temp, NULL);\n    int len = 10;\n\n    stringClass = env-&gt;FindClass(\"java/lang/String\"); // \u627e\u5230\u5177\u4f53\u7684 String \u7c7b\n    if (stringClass == NULL) {\n        return NULL;\n    }\n    // \u627e\u5230\u5177\u4f53\u7684\u65b9\u6cd5\uff0c([C)V \u8868\u793a\u9009\u62e9 String \u7684 String(char value[]) \u6784\u9020\u65b9\u6cd5\n    cid = env-&gt;GetMethodID(stringClass, \"&lt;init&gt;\", \"([C)V\");\n    if (cid == NULL) {\n        return NULL;\n    }\n    // \u5b57\u7b26\u4e32\u6570\u7ec4\u4f5c\u4e3a\u53c2\u6570\n    elemArr = env-&gt;NewCharArray(len);\n    if (elemArr == NULL) {\n        return NULL;\n    }\n    // \u7ed9\u5b57\u7b26\u4e32\u6570\u7ec4\u8d4b\u503c\n    env-&gt;SetCharArrayRegion(elemArr, 0, len, chars);\n    // \u521b\u5efa\u7c7b\n    result = (jstring) env-&gt;NewObject(stringClass, cid, elemArr);\n    env-&gt;DeleteLocalRef(elemArr);\n    env-&gt;DeleteLocalRef(stringClass);\n    return result;\n}\n</code></pre></p> <p>\u7531\u4e8e String \u7684\u6784\u9020\u51fd\u6570\u9700\u8981\u4f20\u9012\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4\uff0c\u5c31\u5148\u6784\u9020\u597d\u4e86\u5b57\u7b26\u6570\u7ec4\u5e76\u8d4b\u503c\uff0c\u5f97\u5230\u5bf9\u5e94\u7684\u7c7b\u548c\u65b9\u6cd5 id \u4e4b\u540e\uff0c\u76f4\u63a5\u901a\u8fc7 <code>NewObject</code> \u65b9\u6cd5\u8c03\u7528\u5373\u53ef\u3002</p> <p>\u518d\u6765\u770b\u4e00\u4e2a\u8c03\u7528\u81ea\u5b9a\u4e49\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u7684\u793a\u4f8b\uff0c\u8fd8\u662f\u4e4b\u524d\u7684 Animal \u7c7b\uff0c\u5b83\u7684\u6784\u9020\u65b9\u6cd5\u6709\u4e00\u4e2a String \u7c7b\u578b\u7684\u53c2\u6570\u3002</p> <p><pre><code>/**\n * \u521b\u5efa\u4e00\u4e2a Java \u7684 Animal \u7c7b\u5e76\u8fd4\u56de\n */\nextern \"C\"\nJNIEXPORT jobject JNICALL\nJava_com_glumes_cppso_jnioperations_InvokeConstructorOps_invokeAnimalConstructors(JNIEnv *env, jobject instance) {\n    jclass animalClass;\n    jmethodID mid;\n    jobject result;\n    animalClass = env-&gt;FindClass(\"com/glumes/cppso/model/Animal\");\n    if (animalClass == NULL) {\n        return NULL;\n    }\n    mid = env-&gt;GetMethodID(animalClass, \"&lt;init&gt;\", \"(Ljava/lang/String;)V\");\n    if (mid == NULL) {\n        return NULL;\n    }\n    jstring args = env-&gt;NewStringUTF(\"this animal name\");\n    result = env-&gt;NewObject(animalClass, mid, args);\n    env-&gt;DeleteLocalRef(animalClass);\n    return result;\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u8c03\u7528\u6d41\u7a0b\u53ea\u8981\u6309\u7167\u6b65\u9aa4\u6765\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u9664\u4e86 NewObject \u65b9\u6cd5\u4e4b\u5916\uff0cJNI \u8fd8\u63d0\u4f9b\u4e86 AllocObject \u65b9\u6cd5\u6765\u521b\u5efa\u5bf9\u8c61\uff0c\u4ee5\u540c\u6837\u8c03\u7528 Animal \u7c7b\u6784\u9020\u65b9\u6cd5\u4e3a\u4f8b\uff1a</p> <pre><code>/**\n * \u901a\u8fc7 AllocObject \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a\u7c7b\n */\nextern \"C\"\nJNIEXPORT jobject JNICALL\nJava_com_glumes_cppso_jnioperations_InvokeConstructorOps_allocObjectConstructor(JNIEnv *env, jobject instance) {\n    jclass animalClass;\n    jobject result;\n    jmethodID mid;\n    // \u83b7\u5f97\u5bf9\u5e94\u7684 \u7c7b\n    animalClass = env-&gt;FindClass(\"com/glumes/cppso/model/Animal\");\n    if (animalClass == NULL) {\n        return NULL;\n    }\n    // \u83b7\u5f97\u6784\u9020\u65b9\u6cd5 id\n    mid = env-&gt;GetMethodID(animalClass, \"&lt;init&gt;\", \"(Ljava/lang/String;)V\");\n    if (mid == NULL) {\n        return NULL;\n    }\n    // \u6784\u9020\u65b9\u6cd5\u7684\u53c2\u6570\n    jstring args = env-&gt;NewStringUTF(\"use AllocObject\");\n    // \u521b\u5efa\u5bf9\u8c61\uff0c\u6b64\u65f6\u521b\u5efa\u7684\u5bf9\u8c61\u672a\u521d\u59cb\u5316\u7684\u5bf9\u8c61\n    result = env-&gt;AllocObject(animalClass);\n    if (result == NULL) {\n        return NULL;\n    }\n    // \u8c03\u7528 CallNonvirtualVoidMethod \u65b9\u6cd5\u53bb\u8c03\u7528\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\n    env-&gt;CallNonvirtualVoidMethod(result, animalClass, mid, args);\n    if (env-&gt;ExceptionCheck()) {\n        env-&gt;DeleteLocalRef(result);\n        return NULL;\n    }\n    return result;\n}\n</code></pre> <p>\u540c\u6837\u7684\uff0c\u8981\u5148\u51c6\u5907\u5fc5\u8981\u7684\u4e1c\u897f\u3002\u83b7\u5f97\u5bf9\u5e94\u7c7b\u7684\u7c7b\u578b\u3001\u65b9\u6cd5 id\u3001\u6784\u9020\u65b9\u6cd5\u7684\u53c2\u6570\u3002</p> <p>\u7136\u540e\u901a\u8fc7 <code>AllocObject</code> \u65b9\u6cd5\u521b\u5efa\u5bf9\u8c61\uff0c\u4f46\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6b64\u65f6\u521b\u5efa\u7684\u5bf9\u8c61\u662f\u672a\u88ab\u521d\u59cb\u5316\u7684\uff0c\u4e0d\u540c\u4e8e <code>NewObject</code> \u65b9\u6cd5\u521b\u5efa\u7684\u5bf9\u8c61\u76f4\u63a5\u5c31\u662f\u521d\u59cb\u5316\u4e86\uff0c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\uff0c\u53ef\u4ee5\u8bf4 <code>AllocObject</code> \u65b9\u6cd5\u662f\u5ef6\u8fdf\u521d\u59cb\u5316\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\u662f\u8981\u901a\u8fc7 <code>CallNonvirtualVoidMethod</code> \u6765\u8c03\u7528\u5bf9\u5e94\u7684\u6784\u9020\u65b9\u6cd5\u3002\u6b64\u5904\u4f20\u5165\u7684\u4e00\u4e2a\u53c2\u6570\u4e0d\u518d\u662f jclass \u7c7b\u578b\uff0c\u800c\u662f\u521b\u5efa\u7684\u672a\u88ab\u521d\u59cb\u5316\u7684\u7c7b jobject \u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u6cd5\uff0c\u540c\u6837\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a Java \u4e2d\u7684\u7c7b\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-invoke-constructor-method-and-super-method/#_2","title":"\u8c03\u7528\u7236\u7c7b\u7684\u65b9\u6cd5","text":"<p>\u53ef\u4ee5\u901a\u8fc7 JNI \u6765\u8c03\u7528\u7236\u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5\u3002</p> <p>\u5728\u5b50\u7c7b\u4e2d\u901a\u8fc7\u8c03\u7528 <code>CallNonvirtual&lt;Type&gt;Method</code> \u65b9\u6cd5\u6765\u8c03\u7528\u7236\u7c7b\u7684\u65b9\u6cd5\u3002</p> <p>\u9996\u5148\uff0c\u6784\u9020\u4e00\u4e2a\u76f8\u5e94\u7684\u5b50\u7c7b\uff0c\u7136\u540e\u83b7\u5f97\u7236\u7c7b\u7684 \u7c7b\u578b\u548c\u65b9\u6cd5 id\uff0c\u4ee5\u53ca\u51c6\u5907\u5bf9\u5e94\u7684\u53c2\u6570\uff0c\u6839\u636e\u7236\u7c7b\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u9009\u62e9\u8c03\u7528\u4e0d\u540c\u7684 <code>CallNonvirtual&lt;Type&gt;Method</code>  \u51fd\u6570\u3002</p> <p>\u5bf9\u4e8e\u5f15\u7528\u7c7b\u578b\u7684\uff0c\u8c03\u7528 CallNonvirtualObjectMethod \u65b9\u6cd5\uff1b\u5bf9\u4e8e\u57fa\u7840\u7c7b\u578b\u7684\uff0c\u8c03\u7528 CallNonvirtualBooleanMethod\u3001CallNonvirtualIntMethod \u7b49\u7b49\uff1b\u5bf9\u4e8e\u65e0\u8fd4\u56de\u503c\u7c7b\u578b\u7684\uff0c\u8c03\u7528 CallNonvirtualVoidMethod \u65b9\u6cd5\u3002</p> <p>\u5177\u4f53\u770b\u4ee3\u7801\uff1a</p> <pre><code>/**\n * \u8c03\u7528\u7236\u7c7b\u7684\u65b9\u6cd5\n * \u521b\u5efa\u4e00\u4e2a\u5b50\u7c7b\uff0c\u7531\u5b50\u7c7b\u53bb\u8c03\u7528\u7236\u7c7b\u7684\u65b9\u6cd5\n */\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_InvokeConstructorOps_callSuperMethod(JNIEnv *env, jobject instance) {\n    jclass cat_cls; // Cat \u7c7b\u7684\u7c7b\u578b\n    jmethodID cat_cid; // Cat \u7c7b\u7684\u6784\u9020\u65b9\u6cd5 id\n    jstring cat_name; // Cat \u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u53c2\u6570\n    jobject cat;\n    // \u83b7\u5f97\u5bf9\u5e94\u7684 \u7c7b\n    cat_cls = env-&gt;FindClass(\"com/glumes/cppso/model/Cat\");\n    if (cat_cls == NULL) {\n        return;\n    }\n    // \u83b7\u5f97\u6784\u9020\u65b9\u6cd5 id\n    cat_cid = env-&gt;GetMethodID(cat_cls, \"&lt;init&gt;\", \"(Ljava/lang/String;)V\");\n    if (cat_cid == NULL) {\n        return;\n    }\n    // \u51c6\u5907\u6784\u9020\u65b9\u6cd5\u7684\u53c2\u6570\n    cat_name = env-&gt;NewStringUTF(\"this is cat name\");\n    // \u521b\u5efa Cat \u7c7b\n    cat = env-&gt;NewObject(cat_cls, cat_cid, cat_name);\n    if (cat == NULL) {\n        return;\n    }\n    //\u8c03\u7528\u7236\u7c7b\u7684 getName \u53c2\u6570\n    jclass animal_cls; // \u7236\u7c7b\u7684\u7c7b\u578b\n    jmethodID animal_mid; // \u88ab\u8c03\u7528\u7684\u7236\u7c7b\u7684\u65b9\u6cd5 id\n    // \u83b7\u5f97\u7236\u7c7b\u5bf9\u5e94\u7684\u7c7b\n    animal_cls = env-&gt;FindClass(\"com/glumes/cppso/model/Animal\");\n    if (animal_cls == NULL) {\n        return;\n    }\n    // \u83b7\u5f97\u7236\u7c7b\u88ab\u8c03\u7528\u7684\u65b9\u6cd5 id\n    animal_mid = env-&gt;GetMethodID(animal_cls, \"getName\", \"()Ljava/lang/String;\");\n    if (animal_mid == NULL) {\n        return;\n    }\n    jstring name = (jstring) env-&gt;CallNonvirtualObjectMethod(cat, animal_cls, animal_mid);\n    if (name == NULL) {\n        return;\n    }\n    LOGD(\"getName method value is %s\", env-&gt;GetStringUTFChars(name, NULL));\n\n    // \u8c03\u7528\u7236\u7c7b\u7684\u5176\u4ed6\u65b9\u6cd5\n    animal_mid = env-&gt;GetMethodID(animal_cls, \"callInstanceMethod\", \"(I)V\");\n    if (animal_mid == NULL) {\n        return;\n    }\n    env-&gt;CallNonvirtualVoidMethod(cat, animal_cls, animal_mid);\n}\n</code></pre> <p>Cat \u7c7b\u4f5c\u4e3a Animal \u7c7b\u7684\u5b50\u7c7b\uff0c\u9996\u5148\u7531 NewObject \u65b9\u6cd5\u521b\u5efa Cat \u7c7b\uff0c\u7136\u540e\u8c03\u7528\u5b83\u7684\u7236\u7c7b\u7684\u65b9\u6cd5\u3002</p> <p>\u7531\u6b64\uff0c\u901a\u8fc7 JNI \u6765\u8c03\u7528 Java \u7b97\u662f\u57fa\u672c\u5b8c\u6210\u4e86\u3002</p> <p>\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u53c2\u8003\u6211\u7684 Github \u9879\u76ee https://github.com/glumes/AndroidDevWithCpp\uff0c\u6b22\u8fce Star\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/","title":"Android JNI \u4e2d\u7684\u5f15\u7528\u7ba1\u7406","text":"<p>\u5728 Native \u4ee3\u7801\u4e2d\u6709\u65f6\u5019\u4f1a\u63a5\u6536 Java \u4f20\u5165\u7684\u5f15\u7528\u7c7b\u578b\u53c2\u6570\uff0c\u6709\u65f6\u5019\u4e5f\u4f1a\u901a\u8fc7 NewObject \u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a Java \u7684\u5f15\u7528\u7c7b\u578b\u53d8\u91cf\u3002</p> <p>\u5728\u7f16\u5199 Native \u4ee3\u7801\u65f6\uff0c\u8981\u6ce8\u610f\u8fd9\u4e2a\u4ee3\u8868 Java \u6570\u636e\u7ed3\u6784\u7c7b\u578b\u7684\u5f15\u7528\u5728\u4f7f\u7528\u65f6\u4f1a\u88ab GC \u56de\u6536\u7684\u53ef\u80fd\u6027\u3002</p> <p>Native \u4ee3\u7801\u5e76\u4e0d\u80fd\u76f4\u63a5\u901a\u8fc7\u5f15\u7528\u6765\u8bbf\u95ee\u5176\u5185\u90e8\u7684\u6570\u636e\u63a5\u53e3\uff0c\u5fc5\u987b\u8981\u901a\u8fc7\u8c03\u7528 JNI \u63a5\u53e3\u6765\u95f4\u63a5\u64cd\u4f5c\u8fd9\u4e9b\u5f15\u7528\u5bf9\u8c61\uff0c\u5c31\u5982\u5728\u4e4b\u524d\u7684\u7cfb\u5217\u6587\u7ae0\u4e2d\u5199\u7684\u90a3\u6837\u3002\u5e76\u4e14 JNI \u8fd8\u63d0\u4f9b\u4e86\u548c Java \u76f8\u5bf9\u5e94\u7684\u5f15\u7528\u7c7b\u578b\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u5c31\u9700\u8981\u901a\u8fc7\u7ba1\u7406\u597d\u8fd9\u4e9b\u5f15\u7528\u6765\u7ba1\u7406 Java \u5bf9\u8c61\uff0c\u907f\u514d\u5728\u4f7f\u7528\u65f6\u88ab GC \u56de\u6536\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#_1","title":"\u5f15\u7528\u7b80\u4ecb","text":"<p>JNI \u63d0\u4f9b\u4e86\u4e09\u79cd\u5f15\u7528\u7c7b\u578b\uff1a</p> <ul> <li>\u5c40\u90e8\u5f15\u7528</li> <li>\u5168\u5c40\u5f15\u7528</li> <li>\u5f31\u5168\u5c40\u5f15\u7528</li> </ul>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#_2","title":"\u5c40\u90e8\u5f15\u7528","text":"<p>\u5c40\u90e8\u5f15\u7528\u662f\u6700\u5e38\u89c1\u7684\u4e00\u79cd\u5f15\u7528\u3002\u7edd\u5927\u591a\u6570 JNI \u51fd\u6570\u521b\u5efa\u7684\u90fd\u662f\u5c40\u90e8\u5f15\u7528\uff0c\u6bd4\u5982\uff1aNewObject\u3001FindClass\u3001NewObjectArray \u51fd\u6570\u7b49\u7b49\u3002</p> <p>\u5c40\u90e8\u5f15\u7528\u4f1a\u963b\u6b62 GC \u56de\u6536\u6240\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u540c\u65f6\uff0c\u5b83\u4e0d\u80fd\u5728\u672c\u5730\u51fd\u6570\u4e2d\u8de8\u51fd\u6570\u4f20\u9012\uff0c\u4e0d\u80fd\u8de8\u7ebf\u7a0b\u4f7f\u7528\u3002</p> <p>\u5c40\u90e8\u5f15\u7528\u5728 Native \u51fd\u6570\u8fd4\u56de\u540e\uff0c\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u4f1a\u88ab GC \u81ea\u52a8\u56de\u6536\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 DeleteLocalRef \u51fd\u6570\u6765\u624b\u52a8\u56de\u6536\u3002</p> <p>\u5728\u4e4b\u524d\u6587\u7ae0 JNI \u8c03\u7528\u65f6\u7f13\u5b58\u5b57\u6bb5\u548c\u65b9\u6cd5 ID\uff0c\u7b2c\u4e00\u79cd\u65b9\u6cd5\u91c7\u7528\u7684\u662f\u4f7f\u7528\u65f6\u7f13\u5b58\uff0c\u628a\u5b57\u6bb5 ID \u901a\u8fc7 static \u53d8\u91cf\u7f13\u5b58\u8d77\u6765\u3002</p> <p>\u5982\u679c\u628a FindClass \u51fd\u6570\u521b\u5efa\u7684\u5c40\u90e8\u5f15\u7528\u4e5f\u901a\u8fc7 static \u53d8\u91cf\u7f13\u5b58\u8d77\u6765\uff0c\u90a3\u4e48\u5728\u51fd\u6570\u9000\u51fa\u540e\uff0c\u5c40\u90e8\u5f15\u7528\u88ab\u81ea\u52a8\u91ca\u653e\u4e86\uff0cstatic \u9759\u6001\u53d8\u91cf\u4e2d\u5b58\u50a8\u7684\u5c31\u662f\u4e00\u4e2a\u88ab\u91ca\u653e\u540e\u7684\u5185\u5b58\u5730\u5740\uff0c\u6210\u4e3a\u4e86\u4e00\u4e2a\u91ce\u6307\u9488\uff0c\u518d\u6b21\u8c03\u7528\u65f6\u5c31\u4f1a\u5f15\u8d77\u7a0b\u5e8f\u5d29\u6e83\u4e86\u3002</p> <pre><code>extern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_glumes_cppso_jnioperations_LocalAndGlobalReferenceOps_errorCacheUseLocalReference(\n        JNIEnv *env, jobject instance) {\n    static jmethodID mid = NULL;\n    static jclass cls;\n    // \u5c40\u90e8\u5f15\u7528\u4e0d\u80fd\u4f7f\u7528 static \u6765\u7f13\u5b58\uff0c\u5426\u5219\u51fd\u6570\u9000\u51fa\u540e\uff0c\u81ea\u52a8\u91ca\u653e\uff0c\u6210\u4e3a\u91ce\u6307\u9488\uff0c\u7a0b\u5e8f Crash\n    if (cls == NULL) {\n        cls = env-&gt;FindClass(\"java/lang/String\");\n        if (cls == NULL) {\n            return NULL;\n        }\n    } else {\n        LOGD(\"cls is not null but program will crash\");\n    }\n    if (mid == NULL) {\n        mid = env-&gt;GetMethodID(cls, \"&lt;init&gt;\", \"([C)V\");\n        if (mid == NULL) {\n            return NULL;\n        }\n    }\n    jcharArray charEleArr = env-&gt;NewCharArray(10);\n    const jchar *j_char = env-&gt;GetStringChars(env-&gt;NewStringUTF(\"LocalReference\"), NULL);\n    env-&gt;SetCharArrayRegion(charEleArr, 0, 10, j_char);\n    jstring result = (jstring) env-&gt;NewObject(cls, mid, charEleArr);\n    env-&gt;DeleteLocalRef(charEleArr);\n    return result;\n}\n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#_3","title":"\u5c40\u90e8\u5f15\u7528\u624b\u52a8\u91ca\u653e\u65f6\u673a","text":"<p>\u5c40\u90e8\u5f15\u7528\u9664\u4e86\u81ea\u52a8\u91ca\u653e\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 DeleteLocalRef \u51fd\u6570\u624b\u52a8\u91ca\u653e\uff0c\u5b83\u4e00\u822c\u5b58\u5728\u4e8e\u4ee5\u4e0b\u573a\u666f\u4e2d\uff1a</p> <ul> <li>\u5f53\u8981\u521b\u5efa\u5927\u91cf\u7684\u5c40\u90e8\u5f15\u7528\u5bf9\u8c61\u65f6\uff0c\u4f1a\u9020\u6210 JNI \u5c40\u90e8\u5f15\u7528\u8868\u7684\u6ea2\u51fa\u3002</li> </ul> <p>\u5047\u5982\u6709\u4ee5\u4e0b\u4ee3\u7801\uff0c\u5219\u8981\u7279\u522b\u6ce8\u610f\uff0c\u53ca\u65f6\u91ca\u653e\u5c40\u90e8\u5f15\u7528\uff0c\u9632\u6b62\u6ea2\u51fa\u3002</p> <pre><code>    for (int i = 0; i &lt; len; ++i) {\n        jstring jstr = (*env)-&gt;GetObjectArrayElement(env, arr, i);\n        ... /* process jstr */\n        (*env)-&gt;DeleteLocalRef(env, jstr);\n    }\n</code></pre> <ul> <li>\u7f16\u5199\u5de5\u5177\u7c7b\u65f6\uff0c\u5373\u65f6\u91ca\u653e\u5c40\u90e8\u5f15\u7528\u3002</li> </ul> <p>\u5728\u7f16\u5199\u5de5\u5177\u7c7b\u65f6\uff0c\u5f88\u96be\u77e5\u9053\u88ab\u8c03\u7528\u8005\u5177\u4f53\u4f1a\u662f\u8c01\uff0c\u8003\u8651\u5230\u901a\u7528\u6027\uff0c\u5b8c\u6210\u5de5\u5177\u7c7b\u7684\u4efb\u52a1\u4e4b\u540e\uff0c\u5c31\u8981\u53ca\u65f6\u91ca\u653e\u76f8\u5e94\u7684\u5c40\u90e8\u5f15\u7528\uff0c\u9632\u6b62\u88ab\u5360\u7740\u5185\u5b58\u7a7a\u95f4\u3002</p> <ul> <li>\u4e0d\u9700\u8981\u8fd4\u56de\u7684 Native \u65b9\u6cd5\uff0c\u5373\u65f6\u91ca\u653e\u5c40\u90e8\u5f15\u7528\u3002</li> </ul> <p>\u5982\u679c Native \u65b9\u6cd5\u4e0d\u4f1a\u8fd4\u56de\uff0c\u90a3\u4e48\u81ea\u52a8\u91ca\u653e\u5c40\u90e8\u5f15\u7528\u5c31\u5931\u6548\u4e86\uff0c\u8fd9\u65f6\u5019\u5c31\u5fc5\u987b\u8981\u624b\u52a8\u91ca\u653e\u3002\u6bd4\u5982\uff0c\u5728\u67d0\u4e2a\u4e00\u76f4\u7b49\u5f85\u7684\u5faa\u73af\u4e2d\uff0c\u5982\u679c\u4e0d\u53ca\u65f6\u91ca\u653e\u5c40\u90e8\u5f15\u7528\uff0c\u5f88\u5feb\u5c31\u4f1a\u6ea2\u51fa\u4e86\u3002</p> <ul> <li>\u5c40\u90e8\u5f15\u7528\u4f7f\u7528\u5b8c\u4e86\u5c31\u5220\u9664\uff0c\u4e0d\u5fc5\u8981\u7b49\u5230\u51fd\u6570\u7ed3\u5c3e\u3002</li> </ul> <p>\u6bd4\u5982\uff0c\u901a\u8fc7\u5c40\u90e8\u5f15\u7528\u521b\u5efa\u4e86\u4e00\u4e2a\u5927\u5bf9\u8c61\uff0c\u7136\u540e\u8fd9\u4e2a\u5bf9\u8c61\u5728\u51fd\u6570\u4e2d\u95f4\u5c31\u5b8c\u6210\u4e86\u4efb\u52a1\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u65e9\u65e9\u5730\u901a\u8fc7\u624b\u52a8\u91ca\u653e\u4e86\uff0c\u800c\u4e0d\u662f\u7b49\u5230\u51fd\u6570\u7684\u7ed3\u5c3e\u624d\u91ca\u653e\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#_4","title":"\u7ba1\u7406\u5c40\u90e8\u5f15\u7528","text":"<p>Java \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u51fd\u6570\u6765\u7ba1\u7406\u5c40\u90e8\u5f15\u7528\u7684\u751f\u547d\u5468\u671f\uff1a</p> <ul> <li>EnsureLocalCapacity</li> <li>NewLocalRef</li> <li>PushLocalFrame</li> <li>PopLocalFrame</li> </ul>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#ensurelocalcapacity","title":"EnsureLocalCapacity \u51fd\u6570","text":"<p>JNI \u7684\u89c4\u8303\u6307\u51fa\uff0cJVM \u8981\u786e\u4fdd\u6bcf\u4e2a Native \u65b9\u6cd5\u81f3\u5c11\u53ef\u4ee5\u521b\u5efa 16 \u4e2a\u5c40\u90e8\u5f15\u7528\uff0c\u7ecf\u9a8c\u8868\u660e\uff0c16 \u4e2a\u5c40\u90e8\u5f15\u7528\u5df2\u7ecf\u8db3\u591f\u5e73\u5e38\u7684\u4f7f\u7528\u4e86\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u8981\u4e0e JVM \u7684\u4e2d\u5bf9\u8c61\u8fdb\u884c\u590d\u6742\u7684\u4ea4\u4e92\u8ba1\u7b97\uff0c\u5c31\u9700\u8981\u521b\u5efa\u66f4\u591a\u7684\u5c40\u90e8\u5f15\u7528\u4e86\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u4f7f\u7528 <code>EnsureLocalCapacity</code> \u6765\u786e\u4fdd\u53ef\u4ee5\u521b\u5efa\u6307\u5b9a\u6570\u91cf\u7684\u5c40\u90e8\u5f15\u7528\uff0c\u5982\u679c\u521b\u5efa\u6210\u529f\u8fd4\u56de 0 \uff0c\u8fd4\u56de\u8fd4\u56de\u5c0f\u4e8e 0 \uff0c\u5982\u4e0b\u4ee3\u7801\u793a\u4f8b\uff1a</p> <pre><code>    // Use EnsureLocalCapacity\n    int len = 20;\n    if (env-&gt;EnsureLocalCapacity(len) &lt; 0) {\n        // \u521b\u5efa\u5931\u8d25\uff0cout of memory\n    }\n    for (int i = 0; i &lt; len; ++i) {\n        jstring  jstr = env-&gt;GetObjectArrayElement(arr,i);\n        // \u5904\u7406 \u5b57\u7b26\u4e32\n        // \u521b\u5efa\u4e86\u8db3\u591f\u591a\u7684\u5c40\u90e8\u5f15\u7528\uff0c\u8fd9\u91cc\u5c31\u4e0d\u7528\u5220\u9664\u4e86\uff0c\u663e\u7136\u5360\u7528\u66f4\u591a\u7684\u5185\u5b58\n    }\n</code></pre> <p>\u5f15\u7528\u786e\u4fdd\u53ef\u4ee5\u521b\u5efa\u4e86\u8db3\u591f\u7684\u5c40\u90e8\u5f15\u7528\u6570\u91cf\uff0c\u6240\u4ee5\u5728\u5faa\u73af\u5904\u7406\u5c40\u90e8\u5f15\u7528\u65f6\u53ef\u4ee5\u4e0d\u8fdb\u884c\u5220\u9664\u4e86\uff0c\u4f46\u662f\u663e\u7136\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u5185\u5b58\u7a7a\u95f4\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#pushlocalframe-poplocalframe","title":"PushLocalFrame \u4e0e PopLocalFrame \u51fd\u6570\u5bf9","text":"<p>PushLocalFrame \u4e0e PopLocalFrame \u662f\u4e24\u4e2a\u914d\u5957\u4f7f\u7528\u7684\u51fd\u6570\u5bf9\u3002</p> <p>\u5b83\u4eec\u53ef\u4ee5\u4e3a\u5c40\u90e8\u5f15\u7528\u521b\u5efa\u4e00\u4e2a\u6307\u5b9a\u6570\u91cf\u5185\u5d4c\u7684\u7a7a\u95f4\uff0c\u5728\u8fd9\u4e2a\u51fd\u6570\u5bf9\u4e4b\u95f4\u7684\u5c40\u90e8\u5f15\u7528\u90fd\u4f1a\u5728\u8fd9\u4e2a\u7a7a\u95f4\u5185\uff0c\u76f4\u5230\u91ca\u653e\u540e\uff0c\u6240\u6709\u7684\u5c40\u90e8\u5f15\u7528\u90fd\u4f1a\u88ab\u91ca\u653e\u6389\uff0c\u4e0d\u7528\u518d\u62c5\u5fc3\u6bcf\u4e00\u4e2a\u5c40\u90e8\u5f15\u7528\u7684\u91ca\u653e\u95ee\u9898\u4e86\u3002</p> <p>\u5e38\u89c1\u7684\u4f7f\u7528\u573a\u666f\u5c31\u662f\u5728\u5faa\u73af\u4e2d\uff1a</p> <pre><code> // Use PushLocalFrame &amp; PopLocalFrame\n    for (int i = 0; i &lt; len; ++i) {\n        if (env-&gt;PushLocalFrame(len)) { // \u521b\u5efa\u6307\u5b9a\u6570\u636e\u7684\u5c40\u90e8\u5f15\u7528\u7a7a\u95f4\n            //out ot memory\n        }\n        jstring jstr = env-&gt;GetObjectArrayElement(arr, i);\n        // \u5904\u7406\u5b57\u7b26\u4e32\n        // \u671f\u95f4\u521b\u5efa\u7684\u5c40\u90e8\u5f15\u7528\uff0c\u90fd\u4f1a\u5728 PushLocalFrame \u521b\u5efa\u7684\u5c40\u90e8\u5f15\u7528\u7a7a\u95f4\u4e2d\n        // \u8c03\u7528 PopLocalFrame \u76f4\u63a5\u91ca\u653e\u8fd9\u4e2a\u7a7a\u95f4\u5185\u7684\u6240\u6709\u5c40\u90e8\u5f15\u7528\n        env-&gt;PopLocalFrame(NULL); \n    }\n</code></pre> <p>\u4f7f\u7528 PushLocalFrame &amp; PopLocalFrame \u51fd\u6570\u5bf9\uff0c\u5c31\u53ef\u4ee5\u5728\u671f\u95f4\u653e\u5fc3\u5730\u5904\u7406\u5c40\u90e8\u5f15\u7528\uff0c\u6700\u540e\u7edf\u4e00\u91ca\u653e\u6389\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#_5","title":"\u5168\u5c40\u5f15\u7528","text":"<p>\u5168\u5c40\u5f15\u7528\u548c\u5c40\u90e8\u5f15\u7528\u4e00\u6837\uff0c\u4e5f\u4f1a\u963b\u6b62\u5b83\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u88ab\u56de\u6536\u3002\u4f46\u662f\u5b83\u4e0d\u4f1a\u5728\u65b9\u6cd5\u8fd4\u56de\u65f6\u88ab\u81ea\u52a8\u91ca\u653e\uff0c\u5fc5\u987b\u8981\u901a\u8fc7\u624b\u52a8\u91ca\u653e\u624d\u884c\uff0c\u800c\u4e14\uff0c\u5168\u5c40\u5f15\u7528\u53ef\u4ee5\u8de8\u65b9\u6cd5\u3001\u8de8\u7ebf\u7a0b\u4f7f\u7528\u3002</p> <p>\u5168\u5c40\u5f15\u7528\u53ea\u80fd\u901a\u8fc7 <code>NewGlobalRef</code>\u51fd\u6570\u6765\u521b\u5efa\uff0c\u7136\u540e\u901a\u8fc7 <code>DeleteGlobalRef</code> \u51fd\u6570\u6765\u624b\u52a8\u91ca\u653e\u3002</p> <p>\u8fd8\u662f\u4e0a\u9762\u63d0\u5230\u7684\u7f13\u5b58\u5b57\u6bb5\u7684\u4f8b\u5b50\uff0c\u73b0\u5728\u5c31\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u5f15\u7528\u6765\u7f13\u5b58\u4e86\u3002</p> <pre><code>extern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_glumes_cppso_jnioperations_LocalAndGlobalReferenceOps_cacheWithGlobalReference(JNIEnv *env, jobject instance) {\n    static jclass stringClass = NULL;\n    if (stringClass == NULL) {\n        jclass localRefs = env-&gt;FindClass(\"java/lang/String\");\n        if (localRefs == NULL) {\n            return NULL;\n        }\n        stringClass = (jclass) env-&gt;NewGlobalRef(localRefs);\n        env-&gt;DeleteLocalRef(localRefs);\n        if (stringClass == NULL) {\n            return NULL;\n        }\n    } else {\n        LOGD(\"use stringClass cached\");\n    }\n    static jmethodID stringMid = NULL;\n    if (stringMid == NULL) {\n        stringMid = env-&gt;GetMethodID(stringClass, \"&lt;init&gt;\", \"(Ljava/lang/String;)V\");\n        if (stringMid == NULL) {\n            return NULL;\n        }\n    } else {\n        LOGD(\"use method cached\");\n    }\n    jstring str = env-&gt;NewStringUTF(\"string\");\n    return (jstring) env-&gt;NewObject(stringClass, stringMid, str);\n}\n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#_6","title":"\u5f31\u5168\u5c40\u5f15\u7528","text":"<p>\u5f31\u5168\u5c40\u5f15\u7528\u6709\u70b9\u7c7b\u4f3c\u4e8e Java \u4e2d\u7684\u5f31\u5f15\u7528\uff0c\u5b83\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u53ef\u4ee5\u88ab GC \u56de\u6536\uff0c\u5e76\u4e14\u5b83\u4e5f\u53ef\u4ee5\u8de8\u65b9\u6cd5\u3001\u8de8\u7ebf\u7a0b\u4f7f\u7528\u3002</p> <p>\u5f31\u5f15\u7528\u4f7f\u7528 <code>NewWeakGlobalRef</code> \u65b9\u6cd5\u521b\u5efa\uff0c\u4f7f\u7528 <code>DeleteWeakGlobalRef</code> \u65b9\u6cd5\u91ca\u653e\u3002</p> <pre><code>extern \"C\"\nJNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_LocalAndGlobalReferenceOps_useWeakGlobalReference(JNIEnv *env, jobject instance) {\n    static jclass stringClass = NULL;\n    if (stringClass == NULL) {\n        jclass localRefs = env-&gt;FindClass(\"java/lang/String\");\n        if (localRefs == NULL) {\n            return;\n        }\n        stringClass = (jclass) env-&gt;NewWeakGlobalRef(localRefs);\n        if (stringClass == NULL) {\n            return;\n        }\n    }\n    static jmethodID stringMid = NULL;\n    if (stringMid == NULL) {\n        stringMid = env-&gt;GetMethodID(stringClass, \"&lt;init&gt;\", \"(Ljava/lang/String;)V\");\n        if (stringMid == NULL) {\n            return;\n        }\n    }\n    jboolean isGC = env-&gt;IsSameObject(stringClass, NULL);\n    if (isGC) {\n        LOGD(\"weak reference has been gc\");\n    } else {\n        jstring str = (jstring) env-&gt;NewObject(stringClass, stringMid,\n                                               env-&gt;NewStringUTF(\"jstring\"));\n        LOGD(\"str is %s\", env-&gt;GetStringUTFChars(str, NULL));\n    }\n}\n</code></pre> <p>\u5728\u4f7f\u7528\u5f31\u5f15\u7528\u65f6\uff0c\u8981\u5148\u68c0\u67e5\u5f31\u5f15\u7528\u6240\u6307\u7684\u7c7b\u5bf9\u8c61\u662f\u5426\u88ab GC \u7ed9\u56de\u6536\u4e86\u3002\u901a\u8fc7 <code>isSameObject</code> \u65b9\u6cd5\u8fdb\u884c\u68c0\u67e5\u3002</p> <p><code>isSameObject</code> \u65b9\u6cd5\u53ef\u4ee5\u7528\u6765\u6bd4\u8f83\u4e24\u4e2a\u5f15\u7528\u7c7b\u578b\u662f\u5426\u76f8\u540c\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u6bd4\u8f83\u5f15\u7528\u662f\u5426\u4e3a NULL\u3002\u540c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u7528 <code>isSameObject</code> \u6765\u6bd4\u8f83\u5f31\u5168\u5c40\u5f15\u7528\u6240\u5f15\u7528\u7684\u5bf9\u8c61\u662f\u5426\u88ab GC \u4e86\uff0c\u8fd4\u56de JNI_TRUE \u5219\u8868\u793a\u56de\u6536\u4e86\uff0cJNI_FALSE \u5219\u8868\u793a\u672a\u88ab\u56de\u6536\u3002</p> <pre><code>env-&gt;IsSameObject(obj1, obj2) // \u6bd4\u8f83\u5c40\u90e8\u5f15\u7528 \u548c \u5168\u5c40\u5f15\u7528\u662f\u5426\u76f8\u540c\nenv-&gt;IsSameObject(obj, NULL)  // \u6bd4\u8f83\u5c40\u90e8\u5f15\u7528\u6216\u8005\u5168\u5c40\u5f15\u7528\u662f\u5426\u4e3a NULL\nenv-&gt;IsSameObject(wobj, NULL) // \u6bd4\u8f83\u5f31\u5168\u5c40\u5f15\u7528\u6240\u5f15\u7528\u5bf9\u8c61\u662f\u5426\u88ab GC \u56de\u6536\n</code></pre>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#_7","title":"\u5408\u7406\u7ba1\u7406\u5f15\u7528","text":"<p>\u603b\u7ed3\u4e00\u4e9b\u5173\u4e8e\u5f15\u7528\u7ba1\u7406\u65b9\u9762\u7684\u77e5\u8bc6\u70b9\uff0c\u53ef\u4ee5\u51cf\u5c11\u5185\u5b58\u7684\u4f7f\u7528\u548c\u907f\u514d\u56e0\u4e3a\u5bf9\u8c61\u88ab\u5f15\u7528\u4e0d\u80fd\u91ca\u653e\u800c\u9020\u6210\u7684\u5185\u5b58\u6d6a\u8d39\u3002</p> <p>\u901a\u5e38\u6765\u8bf4\uff0cNative \u4ee3\u7801\u5927\u4f53\u6709\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u76f4\u63a5\u5b9e\u73b0 Java \u5c42\u58f0\u660e\u7684 Native \u51fd\u6570\u7684\u4ee3\u7801</li> <li>\u7528\u5728\u4efb\u4f55\u573a\u666f\u4e0b\u7684\u5de5\u5177\u51fd\u6570</li> </ul> <p>\u5bf9\u4e8e\u76f4\u63a5\u5b9e\u73b0 Java \u5c42\u58f0\u660e\u7684 Native \u51fd\u6570\uff0c\u4e0d\u8981\u9020\u6210\u5168\u5c40\u5f15\u7528\u548c\u5f31\u5168\u5c40\u5f15\u7528\u7684\u7d2f\u52a0\uff0c\u56e0\u4e3a\u5b83\u4eec\u5728\u51fd\u6570\u8fd4\u56de\u540e\u5e76\u4e0d\u4f1a\u81ea\u52a8\u91ca\u653e\u3002</p> <p>\u5bf9\u4e8e\u5de5\u5177\u7c7b\u7684 Native \u51fd\u6570\uff0c\u7531\u4e8e\u5b83\u7684\u8c03\u7528\u573a\u5408\u548c\u6b21\u6570\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u6240\u4ee5\u8981\u683c\u5916\u5c0f\u5fc3\u5404\u79cd\u5f15\u7528\u7c7b\u578b\uff0c\u907f\u514d\u9020\u6210\u7d2f\u79ef\u800c\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff0c\u6bd4\u5982\u5982\u4e0b\u89c4\u5219\uff1a</p> <ul> <li>\u8fd4\u56de\u57fa\u7840\u7c7b\u578b\u7684 Native \u5de5\u5177\u51fd\u6570\uff0c\u4e0d\u80fd\u9020\u6210\u5168\u5c40\u5f15\u7528\u3001\u5f31\u5168\u5c40\u5f15\u7528\u3001\u5c40\u90e8\u5f15\u7528\u7684\u79ef\u7d2f\u3002</li> <li>\u8fd4\u56de\u5f15\u7528\u7c7b\u578b\u7684 Native \u5de5\u5177\u51fd\u6570\uff0c\u9664\u4e86\u8981\u8fd4\u56de\u7684\u5f15\u7528\u4e4b\u5916\uff0c\u4e5f\u4e0d\u80fd\u9020\u6210\u4efb\u4f55\u7684\u5168\u5c40\u5f15\u7528\u3001\u5f31\u5168\u5c40\u5f15\u7528\u3001\u5c40\u90e8\u5f15\u7528\u7684\u79ef\u7d2f\u3002</li> </ul> <p>\u540c\u65f6\uff0c\u5bf9\u4e8e\u5de5\u5177\u7c7b\u7684 Native \u51fd\u6570\uff0c\u4f7f\u7528\u7f13\u5b58\u6280\u672f\u6765\u4fdd\u5b58\u4e00\u4e9b\u5168\u5c40\u5f15\u7528\u4e5f\u662f\u80fd\u591f\u63d0\u9ad8\u6548\u7387\u7684\uff0c\u6b63\u5982 Android JNI \u8c03\u7528\u65f6\u7f13\u5b58\u5b57\u6bb5\u548c\u65b9\u6cd5 ID \u6587\u7ae0\u4e2d\u5199\u5230\u7684\u4e00\u6837\u3002\u540c\u65f6\uff0c\u5728\u5de5\u5177\u7c7b\u4e2d\uff0c\u5982\u679c\u8fd4\u56de\u7684\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u6700\u597d\u8bf4\u660e\u8fd4\u56de\u7684\u5f15\u7528\u662f\u54ea\u4e00\u79cd\u7c7b\u578b\uff0c\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>while (JNI_TRUE) {\n       jstring infoString = GetInfoString(info);\n       ... /* process infoString */\n       ??? /* we need to call DeleteLocalRef, DeleteGlobalRef,\n              or DeleteWeakGlobalRef depending on the type of\n              reference returned by GetInfoString. */\n}\n</code></pre> <p>\u56e0\u4e3a\u4e0d\u6e05\u695a\u8fd4\u56de\u7684\u5f15\u7528\u662f\u4ec0\u4e48\u7c7b\u578b\uff0c\u5bfc\u81f4\u4e0d\u77e5\u9053\u8c03\u7528\u54ea\u79cd\u65b9\u5f0f\u6765\u5220\u9664\u8fd9\u4e2a\u5f15\u7528\u7c7b\u578b\u3002</p> <p>JNI \u4e2d\u63d0\u4f9b\u4e86 <code>NewLocalRef</code> \u51fd\u6570\u6765\u4fdd\u8bc1\u5de5\u5177\u7c7b\u51fd\u6570\u8fd4\u56de\u7684\u603b\u662f\u4e00\u4e2a\u5c40\u90e8\u5f15\u7528\u7c7b\u578b\uff0c\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code> static jstring cachedString = NULL;\n if (cachedString == NULL) {\n       /* create cachedString for the first time */\n       jstring cachedStringLocal = ... ;\n       /* cache the result in a global reference */\n       cachedString =(*env)-&gt;NewGlobalRef(env, cachedStringLocal);\n }\nreturn (*env)-&gt;NewLocalRef(env, cachedString);\n</code></pre> <p>\u6b63\u5982\u4e4b\u524d\u63d0\u5230\u7684\uff0cstatic \u7f13\u5b58\u662f\u4e0d\u80fd\u7f13\u5b58\u4e00\u4e2a\u5c40\u90e8\u5f15\u7528\u7684\uff0c\u800c cachedString \u6b63\u662f\u4e00\u4e2a\u7f13\u5b58\u7684\u5168\u5c40\u5f15\u7528\uff0c\u4f46\u662f\u901a\u8fc7 NewLocalRef \u51fd\u6570\u786e\u4fdd\u5c06\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5c40\u90e8\u5f15\u7528\uff0c\u8fd9\u6837\u518d\u4f7f\u7528\u540e\u5c40\u90e8\u5f15\u7528\u5c31\u4f1a\u88ab\u81ea\u52a8\u91ca\u653e\u6389\u4e86\u3002</p> <p>\u5bf9\u4e8e\u5f15\u7528\u7684\u7ba1\u7406\uff0c\u6700\u597d\u7684\u65b9\u5f0f\u8fd8\u662f\u4f7f\u7528 <code>PushLocalFrame</code> \u4e0e <code>PopLocalFrame</code> \u51fd\u6570\u5bf9\uff0c\u5728\u8fd9\u4e2a\u51fd\u6570\u5bf9\u4e4b\u95f4\u7684\u5c40\u90e8\u5f15\u7528\u5c31\u53ef\u4ee5\u81ea\u52a8\u88ab PushLocalFrame \u548c PopLocalFrame \u63a5\u7ba1\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-reference-manage-rules/#_8","title":"\u53c2\u8003","text":"<ol> <li>https://blog.csdn.net/xyang81/article/details/44657385</li> </ol> <p>\u5177\u4f53\u793a\u4f8b\u4ee3\u7801\u53ef\u53c2\u8003\u6211\u7684 Github \u9879\u76ee https://github.com/glumes/AndroidDevWithCpp\uff0c\u6b22\u8fce Star\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-thread-operation/","title":"Android JNI \u4e2d\u7684\u7ebf\u7a0b\u64cd\u4f5c","text":"<p>\u5b66\u4e60\u4e00\u4e0b\u5982\u4f55\u5728 Native \u4ee3\u7801\u4e2d\u4f7f\u7528\u7ebf\u7a0b\u3002</p> <p>Native \u4e2d\u652f\u6301\u7684\u7ebf\u7a0b\u6807\u51c6\u662f POSIX \u7ebf\u7a0b\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u5957\u521b\u5efa\u548c\u64cd\u4f5c\u7ebf\u7a0b\u7684 API \u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728 Native \u4ee3\u7801\u4e2d\u4f7f\u7528 POSIX \u7ebf\u7a0b\uff0c\u5c31\u76f8\u5f53\u4e8e\u4f7f\u7528\u4e00\u4e2a\u5e93\u4e00\u6837\uff0c\u9996\u5148\u9700\u8981\u5305\u542b\u8fd9\u4e2a\u5e93\u7684\u5934\u6587\u4ef6\uff1a</p> <pre><code>#include &lt;pthread.h&gt;\n</code></pre> <p>\u8fd9\u4e2a\u5934\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86\u5f88\u591a\u548c\u7ebf\u7a0b\u76f8\u5173\u7684\u51fd\u6570\uff0c\u8fd9\u91cc\u5c31\u6682\u65f6\u4f7f\u7528\u5230\u4e86\u5176\u4e2d\u90e8\u5206\u5185\u5bb9\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-thread-operation/#_1","title":"\u521b\u5efa\u7ebf\u7a0b","text":"<p>POSIX \u521b\u5efa\u7ebf\u7a0b\u7684\u51fd\u6570\u5982\u4e0b\uff1a</p> <pre><code>int pthread_create(\n    pthread_t* __pthread_ptr, \n    pthread_attr_t const* __attr, \n    void* (*__start_routine)(void*), \n    void* arg);\n</code></pre> <p>\u5b83\u7684\u53c2\u6570\u5bf9\u5e94\u5982\u4e0b\uff1a</p> <ul> <li> <p>__pthread_ptr \u4e3a\u6307\u5411 pthread_t \u7c7b\u578b\u53d8\u91cf\u7684\u6307\u9488\uff0c\u7528\u5b83\u4ee3\u8868\u8fd4\u56de\u7ebf\u7a0b\u7684\u53e5\u67c4\u3002</p> </li> <li> <p>__attr \u4e3a\u6307\u5411 pthread_attr_t \u7ed3\u6784\u7684\u6307\u9488\uff0c\u53ef\u4ee5\u901a\u8fc7\u8be5\u7ed3\u6784\u6765\u6307\u5b9a\u65b0\u7ebf\u7a0b\u7684\u4e00\u4e9b\u5c5e\u6027\uff0c\u6bd4\u5982\u6808\u5927\u5c0f\u3001\u8c03\u5ea6\u4f18\u5148\u7ea7\u7b49\uff0c\u5177\u4f53\u770b pthread_attr_t \u7ed3\u6784\u7684\u5185\u5bb9\u3002\u5982\u679c\u6ca1\u6709\u7279\u6b8a\u8981\u6c42\uff0c\u53ef\u4f7f\u7528\u9ed8\u8ba4\u503c\uff0c\u628a\u8be5\u53d8\u91cf\u53d6\u503c\u4e3a NULL \u3002</p> </li> <li> <p>\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a\u8be5\u7ebf\u7a0b\u542f\u52a8\u7a0b\u5e8f\u7684\u51fd\u6570\u6307\u9488\uff0c\u4e5f\u5c31\u662f\u7ebf\u7a0b\u542f\u52a8\u65f6\u8981\u6267\u884c\u7684\u90a3\u4e2a\u65b9\u6cd5\uff0c\u7c7b\u4f3c\u4e8e Java Runnable \u4e2d\u7684 run \u65b9\u6cd5\uff0c\u5b83\u7684\u51fd\u6570\u7b7e\u540d\u683c\u5f0f\u5982\u4e0b\uff1a <pre><code>void* start_routine(void* args)\n</code></pre></p> </li> </ul> <p>\u542f\u52a8\u7a0b\u5e8f\u5c06\u7ebf\u7a0b\u53c2\u6570\u770b\u6210 void \u6307\u9488\uff0c\u8fd4\u56de void \u6307\u9488\u7c7b\u578b\u7ed3\u679c\u3002</p> <ul> <li>\u7b2c\u56db\u4e2a\u53c2\u6570\u4e3a\u7ebf\u7a0b\u542f\u52a8\u7a0b\u5e8f\u7684\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u51fd\u6570\u7684\u53c2\u6570\uff0c\u5982\u679c\u4e0d\u9700\u8981\u4f20\u9012\u53c2\u6570\uff0c\u5b83\u53ef\u4ee5\u4e3a NULL \u3002</li> </ul> <p><code>pthread_create</code> \u51fd\u6570\u5982\u679c\u6267\u884c\u6210\u529f\u4e86\u5219\u8fd4\u56de 0 \uff0c\u5982\u679c\u8fd4\u56de\u5176\u4ed6\u9519\u8bef\u4ee3\u7801\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u4f53\u9a8c\u4e00\u4e0b pthread_create \u65b9\u6cd5\u521b\u5efa\u7ebf\u7a0b\u3002</p> <p>\u9996\u5148\uff0c\u521b\u5efa\u7ebf\u7a0b\u542f\u52a8\u65f6\u8fd0\u884c\u7684\u51fd\u6570\uff1a <pre><code>void *printThreadHello(void *);\nvoid *printThreadHello(void *) {\n    LOGD(\"hello thread\");\n    // \u5207\u8bb0\u8981\u6709\u8fd4\u56de\u503c\n    return NULL;\n}\n</code></pre></p> <p>\u8981\u6ce8\u610f\u7ebf\u7a0b\u542f\u52a8\u51fd\u6570\u662f\u8981\u6709\u8fd4\u56de\u503c\u7684\uff0c\u6ca1\u6709\u8fd4\u56de\u503c\u5c31\u76f4\u63a5\u5d29\u6e83\u4e86\u3002</p> <p>\u53e6\u5916\u8fd9\u4e2a\u51fd\u6570\u4e00\u65e6 pthread_create \u8c03\u7528\u4e86\uff0c\u5b83\u5c31\u4f1a\u7acb\u5373\u6267\u884c\u3002</p> <p>\u63a5\u4e0b\u6765\u521b\u5efa\u7ebf\u7a0b\uff1a <pre><code>JNIEXPORT void JNICALL\nJava_com_glumes_cppso_jnioperations_ThreadOps_createNativeThread(JNIEnv *, jobject) {\n    pthread_t handles; // \u7ebf\u7a0b\u53e5\u67c4\n    int result = pthread_create(&amp;handles, NULL, printThreadHello, NULL);\n    if (result != 0) {\n        LOGD(\"create thread failed\");\n    } else {\n        LOGD(\"create thread success\");\n    }\n}\n</code></pre></p> <p>\u7531\u4e8e\u6ca1\u6709\u7ed9\u8be5\u7ebf\u7a0b\u8bbe\u7f6e\u5c5e\u6027\uff0c\u5e76\u4e14\u7ebf\u7a0b\u8fd0\u884c\u51fd\u6570\u4e5f\u4e0d\u9700\u8981\u53c2\u6570\uff0c\u5c31\u90fd\u76f4\u63a5\u8bbe\u7f6e\u4e3a\u4e86 NULL\uff0c\u90a3\u4e48\u4e0a\u9762\u90a3\u6bb5\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u6267\u884c\u4e86\uff0c\u5e76\u4e14 printThreadHello \u51fd\u6570\u662f\u8fd0\u884c\u5728\u65b0\u7684\u7ebf\u7a0b\u4e2d\u7684\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-thread-operation/#java","title":"\u5c06\u7ebf\u7a0b\u9644\u7740\u5728 Java \u865a\u62df\u673a\u4e0a","text":"<p>\u5728\u4e0a\u9762\u7684\u7ebf\u7a0b\u542f\u52a8\u51fd\u6570\u4e2d\uff0c\u53ea\u662f\u7b80\u5355\u7684\u6267\u884c\u4e86\u6253\u5370 log \u7684\u64cd\u4f5c\uff0c\u5982\u679c\u60f3\u8981\u6267\u884c\u548c Java \u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u4ece JNI \u8c03\u7528 Java \u7684\u51fd\u6570\u7b49\u7b49\uff0c\u90a3\u5c31\u9700\u8981\u7528\u5230 Java \u865a\u62df\u673a\u73af\u5883\u4e86\uff0c\u4e5f\u5c31\u662f\u7528\u5230 JNIEnv \u6307\u9488\uff0c\u6bd5\u7adf\u6240\u6709\u7684\u8c03\u7528\u51fd\u6570\u90fd\u662f\u4ee5\u5b83\u5f00\u5934\u7684\u3002</p> <p>pthread_create \u521b\u5efa\u7684\u7ebf\u7a0b\u662f\u4e00\u4e2a C++ \u4e2d\u7684\u7ebf\u7a0b\uff0c\u865a\u62df\u673a\u5e76\u4e0d\u80fd\u8bc6\u522b\u5b83\u4eec\uff0c\u4e3a\u4e86\u548c Java \u7a7a\u95f4\u4ea4\u4e92\uff0c\u9700\u8981\u5148\u628a POSIX \u7ebf\u7a0b\u9644\u7740\u5230 Java \u865a\u62df\u673a\u4e0a\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u83b7\u5f97\u5f53\u524d\u7ebf\u7a0b\u7684 JNIEnv \u6307\u9488\uff0c\u56e0\u4e3a JNIEnv \u6307\u9488\u53ea\u662f\u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\u6709\u6548\u3002</p> <p>\u901a\u8fc7 <code>AttachCurrentThread</code> \u65b9\u6cd5\u53ef\u4ee5\u5c06\u5f53\u524d\u7ebf\u7a0b\u9644\u7740\u5230 Java \u865a\u62df\u673a\u4e0a\uff0c\u5e76\u4e14\u53ef\u4ee5\u83b7\u5f97 JNIEnv \u6307\u9488\u3002</p> <p><code>AttachCurrentThread</code> \u65b9\u6cd5\u662f\u7531 JavaVM \u6307\u9488\u8c03\u7528\u7684\uff0c\u5b83\u4ee3\u8868\u7684\u662f Java \u865a\u62df\u673a\u63a5\u53e3\u6307\u9488\uff0c\u53ef\u4ee5\u5728 JNI_OnLoad \u52a0\u8f7d\u65f6\u6765\u83b7\u5f97\uff0c\u901a\u8fc7\u5168\u5c40\u53d8\u91cf\u4fdd\u5b58\u8d77\u6765</p> <pre><code>static JavaVM *gVm = NULL;\nJNIEXPORT int JNICALL JNI_OnLoad(JavaVM *vm, void *reserved) {\n    JNIEnv *env;\n    if (vm-&gt;GetEnv((void **) &amp;env, JNI_VERSION_1_6) != JNI_OK) {\n        return JNI_ERR;\n    }\n    gVm = vm;\n    return JNI_VERSION_1_6;\n}\n</code></pre> <p>\u5f53\u901a\u8fc7 <code>AttachCurrentThread</code> \u65b9\u6cd5\u5c06\u7ebf\u7a0b\u9644\u7740\u5f53 Java \u865a\u62df\u673a\u4e0a\u540e\uff0c\u8fd8\u9700\u8981\u5c06\u8be5\u7ebf\u7a0b\u4ece Java \u865a\u62df\u673a\u4e0a\u5206\u79bb\uff0c\u901a\u8fc7 <code>DetachCurrentThread</code> \u65b9\u6cd5\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u662f\u8981\u540c\u65f6\u4f7f\u7528\u7684\uff0c\u5426\u5219\u4f1a\u5e26\u6765 BUG \u3002</p> <p>\u5177\u4f53\u4f7f\u7528\u5982\u4e0b\uff1a</p> <p>\u9996\u5148\u5728 Java \u4e2d\u5b9a\u4e49\u5728 C++ \u7ebf\u7a0b\u4e2d\u56de\u8c03\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u5c31\u662f\u6253\u5370\u7ebf\u7a0b\u540d\u5b57\uff1a</p> <pre><code>    private void printThreadName() {\n        LogUtil.Companion.d(\"print thread name current thread name is \" + Thread.currentThread().getName());\n            Thread.sleep(5000);\n    }\n</code></pre> <p>\u7136\u540e\u5b9a\u4e49 Native \u7ebf\u7a0b\u4e2d\u8fd0\u884c\u7684\u65b9\u6cd5\uff1a <pre><code>void *run(void *);\nvoid *run(void *args) {\n    JNIEnv *env = NULL;\n    // \u5c06\u5f53\u524d\u7ebf\u7a0b\u6dfb\u52a0\u5230 Java \u865a\u62df\u673a\u4e0a\n    // \u5047\u8bbe\u6709\u53c2\u6570\u4f20\u9012\n    ThreadRunArgs *threadRunArgs = (ThreadRunArgs *) args;\n    if (gVm-&gt;AttachCurrentThread(&amp;env, NULL) == 0) {\n    // \u56de\u8c03 Java \u7684\u65b9\u6cd5\uff0c\u6253\u5370\u5f53\u524d\u7ebf\u7a0b id \uff0c\u53d1\u73b0\u4e0d\u662f\u4e3b\u7ebf\u7a0b\u5c31\u5bf9\u4e86\n        env-&gt;CallVoidMethod(gObj, printThreadName);\n        // \u4ece Java \u865a\u62df\u673a\u4e0a\u5206\u79bb\u5f53\u524d\u7ebf\u7a0b\n        gVm-&gt;DetachCurrentThread();  \n    }\n    return (void *) threadRunArgs-&gt;result;\n}\n</code></pre></p> <p>\u6700\u540e\u521b\u5efa\u7ebf\u7a0b\u5e76\u8fd0\u884c\u65b9\u6cd5\uff1a <pre><code>        // \u521b\u5efa\u4f20\u9012\u7684\u53c2\u6570\n        ThreadRunArgs *threadRunArgs = new ThreadRunArgs();\n        threadRunArgs-&gt;id = i;\n        threadRunArgs-&gt;result = i * i;\n        // \u8fd0\u884c\u7ebf\u7a0b\n        int result = pthread_create(&amp;handles, NULL, run, (void *) threadRunArgs);\n</code></pre></p> <p>\u901a\u8fc7\u8fd9\u6837\u7684\u8c03\u7528\uff0c\u5c31\u53ef\u4ee5\u5728 Native \u7ebf\u7a0b\u4e2d\u8c03\u7528 Java \u76f8\u5173\u7684\u51fd\u6570\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/android-jni-thread-operation/#_2","title":"\u7b49\u5f85\u7ebf\u7a0b\u8fd4\u56de\u7ed3\u679c","text":"<p>\u524d\u9762\u63d0\u5230\u5728\u7ebf\u7a0b\u8fd0\u884c\u51fd\u6570\u4e2d\u5fc5\u987b\u8981\u6709\u8fd4\u56de\u503c\uff0c\u6700\u5f00\u59cb\u53ea\u662f\u8fd4\u56de\u4e86\u4e00\u4e2a\u7a7a\u6307\u9488 NULL \uff0c\u5e76\u4e14\u5728\u67d0\u4e2a\u65b9\u6cd5\u91cc\u9762\u5f00\u542f\u4e86\u65b0\u7ebf\u7a0b\uff0c\u65b0\u7ebf\u7a0b\u8fd0\u884c\u540e\uff0c\u8be5\u65b9\u6cd5\u4e5f\u5c31\u7acb\u5373\u8fd4\u56de\u9000\u51fa\uff0c\u6267\u884c\u5b8c\u4e86\u3002</p> <p>\u73b0\u5728\uff0c\u8fd8\u53ef\u4ee5\u5728\u8be5\u65b9\u6cd5\u91cc\u7b49\u5f85\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u62ff\u5230\u7ebf\u7a0b\u6267\u884c\u5b8c\u7684\u7ed3\u679c\u4e4b\u540e\u518d\u63a8\u51fa\u3002</p> <p>\u901a\u8fc7 <code>pthread_join</code> \u65b9\u6cd5\u53ef\u4ee5\u7b49\u5f85\u7ebf\u7a0b\u7ec8\u6b62\u3002</p> <pre><code>int pthread_join(pthread_t __pthread, void** __return_value_ptr);\n</code></pre> <p>\u5176\u4e2d\uff1a</p> <ul> <li>__pthread \u4ee3\u8868\u521b\u5efa\u7ebf\u7a0b\u7684\u53e5\u67c4</li> <li>__return_value_ptr \u4ee3\u8868\u7ebf\u7a0b\u8fd0\u884c\u51fd\u6570\u8fd4\u56de\u7684\u7ed3\u679c</li> </ul> <p>\u4f7f\u7528\u5982\u4e0b\uff1a</p> <pre><code>    for (int i = 0; i &lt; num; ++i) {\n        pthread_t pthread;\n        // \u521b\u5efa\u7ebf\u7a0b\uff0c\n        int result = pthread_create(&amp;handles[i], NULL, run, (void *) threadRunArgs);\n        }\n    }\n    for (int i = 0; i &lt; num; ++i) {\n        void *result = NULL; // \u7ebf\u7a0b\u6267\u884c\u8fd4\u56de\u7ed3\u679c\n        // \u7b49\u5f85\u7ebf\u7a0b\u6267\u884c\u7ed3\u675f\n        if (pthread_join(handles[i], &amp;result) != 0) {\n            throwByName(env, runtimeException, \"Unable to join thread\");\n        } else {\n            LOGD(\"return value is %d\",result);\n        }\n    }\n</code></pre> <p>\u5982\u679c pthread_join \u8fd4\u56de\u4e3a 0 \u4ee3\u8868\u6267\u884c\u6210\u529f\uff0c\u975e 0 \u5219\u6267\u884c\u5931\u8d25\u3002</p> <p>\u5177\u4f53\u7684\u4ee3\u7801\u793a\u4f8b\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6b22\u8fce Star \u3002</p> <p>https://github.com/glumes/AndroidDevWithCpp</p> <p>\u53c2\u8003</p> <ol> <li>\u300aAndroid C++ \u9ad8\u7ea7\u7f16\u7a0b--\u4f7f\u7528 NDK\u300b</li> </ol>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/","title":"Android NDK \u5f00\u53d1\u4e4b CMake \u5fc5\u77e5\u5fc5\u4f1a","text":"<p>Android Studio \u4ece 2.2 \u7248\u672c\u8d77\u5f00\u59cb\u652f\u6301 CMake ,\u53ef\u4ee5\u901a\u8fc7 CMake \u548c NDK \u5c06 C/C++ \u4ee3\u7801\u7f16\u8bd1\u6210\u5e95\u5c42\u7684\u5e93\uff0c\u7136\u540e\u518d\u914d\u5408 Gradle \u7684\u7f16\u8bd1\u5c06\u5e93\u6253\u5305\u5230 APK \u4e2d\u3002</p> <p>\u8fd9\u610f\u5473\u5c31\u4e0d\u9700\u8981\u518d\u7f16\u5199 <code>.mk</code> \u6587\u4ef6\u6765\u7f16\u8bd1 <code>so</code> \u52a8\u6001\u5e93\u4e86\u3002</p> <p>CMake \u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u6784\u5efa\u7cfb\u7edf\uff0c\u5728 Android Studio \u5f15\u5165 CMake \u4e4b\u524d\uff0c\u5b83\u5c31\u5df2\u7ecf\u88ab\u5e7f\u6cdb\u8fd0\u7528\u4e86\u3002</p> <p>Google \u5b98\u65b9\u7f51\u7ad9\u4e0a\u6709\u5bf9 CMake \u7684\u4f7f\u7528\u793a\u8303\uff0c\u53ef\u4ee5\u53c2\u8003 \u5b98\u65b9\u6307\u5357\u3002</p> <p>\u603b\u7ed3\u5b98\u7f51\u5bf9 CMake \u7684\u4f7f\u7528\uff0c\u5176\u5b9e\u4e5f\u5c31\u5982\u4e0b\u7684\u6b65\u9aa4\uff1a</p> <ol> <li>add_library \u6307\u5b9a\u8981\u7f16\u8bd1\u7684\u5e93\uff0c\u5e76\u5c06\u6240\u6709\u7684 <code>.c</code> \u6216 <code>.cpp</code> \u6587\u4ef6\u5305\u542b\u6307\u5b9a\u3002</li> <li>include_directories \u5c06\u5934\u6587\u4ef6\u6dfb\u52a0\u5230\u641c\u7d22\u8def\u5f84\u4e2d</li> <li>set_target_properties \u8bbe\u7f6e\u5e93\u7684\u4e00\u4e9b\u5c5e\u6027</li> <li>target_link_libraries \u5c06\u5e93\u4e0e\u5176\u4ed6\u5e93\u76f8\u5173\u8054</li> </ol> <p>\u5982\u679c\u4f60\u5bf9\u4e0a\u9762\u7684\u6b65\u9aa4\u8fd8\u662f\u4e0d\u4e86\u89e3\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u66f4\u6df1\u5165\u4e86\u89e3 CMake \u76f8\u5173\u5185\u5bb9\u5427<sub>~</sub></p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#cmake","title":"CMake \u7684\u57fa\u672c\u64cd\u4f5c","text":"<p>\u4ee5 Clion \u4f5c\u4e3a\u5de5\u5177\u6765\u8bb2\u89e3 CMake \u7684\u57fa\u672c\u4f7f\u7528\u3002</p> <p></p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#cmake_1","title":"CMake \u7f16\u8bd1\u53ef\u6267\u884c\u6587\u4ef6","text":"<p>\u4e00\u4e2a\u6253\u5370 hello world \u7684 cpp \u6587\u4ef6\uff0c\u901a\u8fc7 CMake \u5c06\u5b83\u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u5728 cpp \u7684\u540c\u4e00\u76ee\u5f55\u4e0b\u521b\u5efa <code>CMakeLists.txt</code> \u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code># \u6307\u5b9a CMake \u4f7f\u7528\u7248\u672c\ncmake_minimum_required(VERSION 3.9)\n# \u5de5\u7a0b\u540d\nproject(HelloCMake)\n# \u7f16\u8bd1\u53ef\u6267\u884c\u6587\u4ef6\nadd_executable(HelloCMake main.cpp )\n</code></pre> <p>\u5176\u4e2d\uff0c\u901a\u8fc7 <code>cmake_minimum_required</code> \u65b9\u6cd5\u6307\u5b9a CMake \u4f7f\u7528\u7248\u672c\uff0c\u901a\u8fc7 <code>project</code> \u6307\u5b9a\u5de5\u7a0b\u540d\u3002</p> <p>\u800c <code>add_executable</code> \u5c31\u662f\u6307\u5b9a\u6700\u540e\u7f16\u8bd1\u7684\u53ef\u6267\u884c\u6587\u4ef6\u540d\u79f0\u548c\u9700\u8981\u7f16\u8bd1\u7684 cpp \u6587\u4ef6\uff0c\u5982\u679c\u5de5\u7a0b\u5f88\u5927\uff0c\u6709\u591a\u4e2a cpp \u6587\u4ef6\uff0c\u90a3\u4e48\u90fd\u8981\u628a\u5b83\u4eec\u6dfb\u52a0\u8fdb\u6765\u3002</p> <p>\u5b9a\u4e49\u4e86 CMake \u6587\u4ef6\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u7f16\u8bd1\u6784\u5efa\u4e86\u3002</p> <p>CMake \u5728\u6784\u5efa\u5de5\u7a0b\u65f6\u4f1a\u751f\u6210\u8bb8\u591a\u4e34\u65f6\u6587\u4ef6\uff0c\u907f\u514d\u8ba9\u8fd9\u4e9b\u4e34\u65f6\u6587\u4ef6\u6c61\u67d3\u4ee3\u7801\uff0c\u4e00\u822c\u4f1a\u628a\u5b83\u4eec\u653e\u5230\u4e00\u4e2a\u5355\u72ec\u7684\u76ee\u5f55\u4e2d\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <pre><code># \u5728 cpp \u76ee\u5f55\u4e0b\u521b\u5efa build \u76ee\u5f55\nmkdir build\n# \u8c03\u7528 cmake \u547d\u4ee4\u751f\u6210 makefile \u6587\u4ef6\ncmake ..\n# \u7f16\u8bd1\nmake\n</code></pre> <p>\u5728 build \u76ee\u5f55\u4e2d\u53ef\u4ee5\u627e\u5230\u6700\u7ec8\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u8fd9\u5c31\u662f CMake \u7684\u4e00\u4e2a\u7b80\u5355\u64cd\u4f5c\uff0c\u5c06 cpp \u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4f46\u5728 Android \u4e2d\uff0c\u5927\u591a\u6570\u573a\u666f\u90fd\u662f\u628a cpp \u7f16\u8bd1\u6210\u5e93\u6587\u4ef6\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#cmake_2","title":"CMake \u7f16\u8bd1\u9759\u6001\u5e93\u548c\u52a8\u6001\u5e93","text":"<p>\u540c\u6837\u8fd8\u662f\u4e00\u4e2a cpp \u6587\u4ef6\u548c\u4e00\u4e2a CMake \u6587\u4ef6\uff0ccpp \u6587\u4ef6\u5185\u5bb9\u4e3a\u6253\u5370\u5b57\u7b26\u4e32\u7684\u51fd\u6570\uff1a</p> <pre><code>#include &lt;iostream&gt;\nvoid print() {\n    std::cout &lt;&lt; \"hello lib\" &lt;&lt; std::endl;\n}\n</code></pre> <p>\u540c\u65f6\uff0cCMake \u6587\u4ef6\u4e5f\u8981\u505a\u76f8\u5e94\u66f4\u6539\uff1a</p> <pre><code>cmake_minimum_required(VERSION 3.12)\n# \u6307\u5b9a\u7f16\u8bd1\u7684\u5e93\u548c\u6587\u4ef6\uff0cSHARED \u7f16\u8bd1\u52a8\u6001\u5e93\nadd_library(share_lib SHARED lib.cpp)\n# STATIC \u7f16\u8bd1\u9759\u6001\u5e93\n# add_library(share_lib STATIC lib.cpp)\n</code></pre> <p>\u901a\u8fc7 <code>add_library</code> \u6307\u5b9a\u8981\u7f16\u8bd1\u7684\u5e93\u7684\u540d\u79f0\uff0c\u4ee5\u53ca\u52a8\u6001\u5e93\u8fd8\u662f\u9759\u6001\u5e93\uff0c\u8fd8\u6709\u8981\u7f16\u8bd1\u7684\u6587\u4ef6\u3002</p> <p>\u6700\u540e\u540c\u6837\u5730\u6267\u884c\u6784\u5efa\uff0c\u5728 build \u76ee\u5f55\u4e0b\u53ef\u4ee5\u770b\u5230\u751f\u6210\u7684\u5e93\u6587\u4ef6\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u5c31\u57fa\u672c\u53ef\u4ee5\u4f7f\u7528 CMake \u6765\u6784\u5efa C/C++ \u5de5\u7a0b\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#cmake_3","title":"CMake \u57fa\u672c\u8bed\u6cd5","text":"<p>\u719f\u6089\u4e86\u4e0a\u9762\u7684\u57fa\u672c\u64cd\u4f5c\u4e4b\u540e\uff0c\u5c31\u5fc5\u7136\u4f1a\u9047\u5230\u4ee5\u4e0b\u7684\u95ee\u9898\u4e86\uff1a</p> <ul> <li>\u5982\u679c\u8981\u53c2\u4e0e\u7f16\u8bd1\u7684 C/C++ \u6587\u4ef6\u5f88\u591a\uff0c\u96be\u9053\u6bcf\u4e2a\u90fd\u8981\u624b\u52a8\u6dfb\u52a0\u561b\uff1f</li> <li>\u53ef\u4ee5\u628a\u7f16\u8bd1\u597d\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005\u5e93\u81ea\u52a8\u653e\u5230\u6307\u5b9a\u4f4d\u7f6e\u561b?</li> <li>\u53ef\u4ee5\u628a\u7f16\u8bd1\u597d\u7684\u5e93\u6307\u5b9a\u7248\u672c\u53f7\u561b\uff1f</li> </ul> <p>\u5e26\u7740\u8fd9\u4e9b\u95ee\u9898\uff0c\u8fd8\u662f\u8981\u7ee7\u7eed\u6df1\u5165\u5b66\u4e60 CMake \u7684\u76f8\u5173\u8bed\u6cd5\uff0c\u6700\u597d\u7684\u5b66\u4e60\u6750\u6599\u5c31\u662f \u5b98\u7f51\u6587\u6863 \u4e86\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u76f4\u63a5\u770b\u5b98\u65b9\u6587\u6863\u65f6\u4e00\u5934\u96fe\u6c34\uff0c\u8fd9\u91cc\u5217\u4e3e\u4e00\u4e9b\u5e38\u7528\u7684\u8bed\u6cd5\u547d\u4ee4\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_1","title":"\u6ce8\u91ca\u4e0e\u5927\u5c0f\u5199","text":"<p>\u5728\u524d\u9762\u5c31\u5df2\u7ecf\u7528\u5230\u4e86 CMake \u6ce8\u91ca\u4e86\uff0c\u6bcf\u4e00\u884c\u7684\u5f00\u5934 <code>#</code> \u4ee3\u8868\u6ce8\u91ca\u3002</p> <p>\u53e6\u5916\uff0cCMake \u7684\u6240\u6709\u8bed\u6cd5\u6307\u4ee4\u662f\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_2","title":"\u53d8\u91cf\u5b9a\u4e49\u4e0e\u6d88\u606f\u6253\u5370","text":"<p>\u901a\u8fc7 <code>set</code> \u6765\u5b9a\u4e49\u53d8\u91cf\uff1a</p> <pre><code># \u53d8\u91cf\u540d\u4e3a var\uff0c\u503c\u4e3a hello\nset(var hello) \n</code></pre> <p>\u5f53\u9700\u8981\u5f15\u7528\u53d8\u91cf\u65f6\uff0c\u5728\u53d8\u91cf\u540d\u5916\u9762\u52a0\u4e0a <code>${}</code> \u7b26\u5408\u6765\u5f15\u7528\u53d8\u91cf\u3002 <pre><code># \u5f15\u7528 var \u53d8\u91cf\n${var}\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u901a\u8fc7 <code>message</code> \u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u51fa\u6253\u5370\u5185\u5bb9\u3002</p> <pre><code>set(var hello) \nmessage(${var})\n</code></pre>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_3","title":"\u6570\u5b66\u548c\u5b57\u7b26\u4e32\u64cd\u4f5c","text":"","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_4","title":"\u6570\u5b66\u64cd\u4f5c","text":"<p>CMake \u4e2d\u901a\u8fc7 <code>math</code> \u6765\u5b9e\u73b0\u6570\u5b66\u64cd\u4f5c\u3002</p> <pre><code># math \u4f7f\u7528\uff0cEXPR \u4e3a\u5927\u5c0f\nmath(EXPR &lt;output-variable&gt; &lt;math-expression&gt;)\n</code></pre> <pre><code>math(EXPR var \"1+1\")\n# \u8f93\u51fa\u7ed3\u679c\u4e3a 2\nmessage(${var})\n</code></pre> <p>math \u652f\u6301 <code>+, -, *, /, %, |, &amp;, ^, ~, &lt;&lt;, &gt;&gt;</code> \u7b49\u64cd\u4f5c\uff0c\u548c C \u8bed\u8a00\u4e2d\u5927\u81f4\u76f8\u540c\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_5","title":"\u5b57\u7b26\u4e32\u64cd\u4f5c","text":"<p>CMake \u901a\u8fc7 <code>string</code> \u6765\u5b9e\u73b0\u5b57\u7b26\u4e32\u7684\u64cd\u4f5c\uff0c\u8fd9\u6ce2\u64cd\u4f5c\u6709\u5f88\u591a\uff0c\u5305\u62ec\u5c06\u5b57\u7b26\u4e32\u5168\u90e8\u5927\u5199\u3001\u5168\u90e8\u5c0f\u5199\u3001\u6c42\u5b57\u7b26\u4e32\u957f\u5ea6\u3001\u67e5\u627e\u4e0e\u66ff\u6362\u7b49\u64cd\u4f5c\u3002</p> <p>\u5177\u4f53\u67e5\u770b \u5b98\u65b9\u6587\u6863\u3002</p> <pre><code>set(var \"this is  string\")\nset(sub \"this\")\nset(sub1 \"that\")\n# \u5b57\u7b26\u4e32\u7684\u67e5\u627e\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728 result \u53d8\u91cf\u4e2d\nstring(FIND ${var} ${sub1} result )\n# \u627e\u5230\u4e86\u8f93\u51fa 0 \uff0c\u5426\u5219\u4e3a -1\nmessage(${result})\n\n# \u5c06\u5b57\u7b26\u4e32\u5168\u90e8\u5927\u5199\nstring(TOUPPER ${var} result)\nmessage(${result})\n\n# \u6c42\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\nstring(LENGTH ${var} num)\nmessage(${num})\n</code></pre> <p>\u53e6\u5916\uff0c\u901a\u8fc7\u7a7a\u767d\u6216\u8005\u5206\u9694\u7b26\u53f7\u53ef\u4ee5\u8868\u793a\u5b57\u7b26\u4e32\u5e8f\u5217\u3002</p> <pre><code>set(foo this is a list) // \u5b9e\u9645\u5185\u5bb9\u4e3a\u5b57\u7b26\u4e32\u5e8f\u5217\nmessage(${foo})\n</code></pre> <p>\u5f53\u5b57\u7b26\u4e32\u4e2d\u9700\u8981\u7528\u5230\u7a7a\u767d\u6216\u8005\u5206\u9694\u7b26\u65f6\uff0c\u518d\u7528\u53cc\u62ec\u53f7<code>\"\"</code>\u8868\u793a\u4e3a\u540c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5185\u5bb9\u3002</p> <pre><code>set(foo \"this is a list\") // \u5b9e\u9645\u5185\u5bb9\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\nmessage(${foo})\n</code></pre>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_6","title":"\u6587\u4ef6\u64cd\u4f5c","text":"<p>CMake \u4e2d\u901a\u8fc7 <code>file</code> \u6765\u5b9e\u73b0\u6587\u4ef6\u64cd\u4f5c\uff0c\u5305\u62ec\u6587\u4ef6\u8bfb\u5199\u3001\u4e0b\u8f7d\u6587\u4ef6\u3001\u6587\u4ef6\u91cd\u547d\u540d\u7b49\u3002</p> <p>\u5177\u4f53\u67e5\u770b \u5b98\u65b9\u6587\u6863</p> <pre><code># \u6587\u4ef6\u91cd\u547d\u540d\nfile(RENAME \"test.txt\" \"new.txt\")\n\n# \u6587\u4ef6\u4e0b\u8f7d\n# \u628a\u6587\u4ef6 URL \u8bbe\u5b9a\u4e3a\u53d8\u91cf\nset(var \"http://img.zcool.cn/community/0117e2571b8b246ac72538120dd8a4.jpg\")\n\n# \u4f7f\u7528 DOWNLOAD \u4e0b\u8f7d\nfile(DOWNLOAD ${var} \"/Users/glumes/CLionProjects/HelloCMake/image.jpg\")\n</code></pre> <p>\u5728\u6587\u4ef6\u7684\u64cd\u4f5c\u4e2d\uff0c\u8fd8\u6709\u4e24\u4e2a\u5f88\u91cd\u8981\u7684\u6307\u4ee4 <code>GLOB</code> \u548c <code>GLOB_RECURSE</code> \u3002</p> <pre><code># GLOB \u7684\u4f7f\u7528\nfile(GLOB ROOT_SOURCE *.cpp)\n# GLOB_RECURSE \u7684\u4f7f\u7528\nfile(GLOB_RECURSE CORE_SOURCE ./detail/*.cpp)\n</code></pre> <p>\u5176\u4e2d\uff0c<code>GLOB</code> \u6307\u4ee4\u4f1a\u5c06\u6240\u6709\u5339\u914d <code>*.cpp</code> \u8868\u8fbe\u5f0f\u7684\u6587\u4ef6\u7ec4\u6210\u4e00\u4e2a\u5217\u8868\uff0c\u5e76\u4fdd\u5b58\u5728 <code>ROOT_SOURCE</code> \u53d8\u91cf\u4e2d\u3002</p> <p>\u800c <code>GLOB_RECURSE</code> \u6307\u4ee4\u548c <code>GLOB</code> \u7c7b\u4f3c\uff0c\u4f46\u662f\u5b83\u4f1a\u904d\u5386\u5339\u914d\u76ee\u5f55\u7684\u6240\u6709\u6587\u4ef6\u4ee5\u53ca\u5b50\u76ee\u5f55\u4e0b\u9762\u7684\u6587\u4ef6\u3002</p> <p>\u4f7f\u7528  <code>GLOB</code> \u548c <code>GLOB_RECURSE</code> \u6709\u597d\u5904\uff0c\u5c31\u662f\u5f53\u6dfb\u52a0\u9700\u8981\u7f16\u8bd1\u7684\u6587\u4ef6\u65f6\uff0c\u4e0d\u7528\u518d\u4e00\u4e2a\u4e00\u4e2a\u624b\u52a8\u6dfb\u52a0\u4e86\uff0c\u540c\u4e00\u76ee\u5f55\u4e0b\u7684\u5185\u5bb9\u90fd\u88ab\u5305\u542b\u5728\u5bf9\u5e94\u53d8\u91cf\u4e2d\u4e86\uff0c\u4f46\u4e5f\u6709\u5f0a\u7aef\uff0c\u5c31\u662f\u65b0\u5efa\u4e86\u6587\u4ef6\uff0c\u4f46\u662f CMake \u5e76\u6ca1\u6709\u6539\u53d8\uff0c\u5bfc\u81f4\u5728\u7f16\u8bd1\u65f6\u4e5f\u4f1a\u91cd\u65b0\u4ea7\u751f\u6784\u5efa\u6587\u4ef6\uff0c\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u52a8\u4e00\u52a8 CMake\uff0c\u8ba9\u7f16\u8bd1\u5668\u68c0\u6d4b\u5230\u5b83\u6709\u6539\u53d8\u5c31\u597d\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_7","title":"\u9884\u5b9a\u4e49\u7684\u5e38\u91cf","text":"<p>\u5728 CMake \u4e2d\u6709\u8bb8\u591a\u9884\u5b9a\u4e49\u7684\u5e38\u91cf\uff0c\u4f7f\u7528\u597d\u8fd9\u4e9b\u5e38\u91cf\u80fd\u8d77\u5230\u4e8b\u534a\u529f\u500d\u7684\u6548\u679c\u3002</p> <ul> <li>CMAKE_CURRENT_SOURCE_DIR<ul> <li>\u6307\u5f53\u524d CMake \u6587\u4ef6\u6240\u5728\u7684\u6587\u4ef6\u5939\u8def\u5f84</li> </ul> </li> <li>CMAKE_SOURCE_DIR<ul> <li>\u6307\u5f53\u524d\u5de5\u7a0b\u7684 CMake \u6587\u4ef6\u6240\u5728\u8def\u5f84</li> </ul> </li> <li>CMAKE_CURRENT_LIST_FILE<ul> <li>\u6307\u5f53\u524d CMake \u6587\u4ef6\u7684\u5b8c\u6574\u8def\u5f84</li> </ul> </li> <li>PROJECT_SOURCE_DIR<ul> <li>\u6307\u5f53\u524d\u5de5\u7a0b\u7684\u8def\u5f84</li> </ul> </li> </ul> <p>\u6bd4\u5982\uff0c\u5728 <code>add_library</code> \u4e2d\u9700\u8981\u6307\u5b9a cpp \u6587\u4ef6\u7684\u8def\u5f84\uff0c\u4ee5 <code>CMAKE_CURRENT_SOURCE_DIR</code> \u4e3a\u57fa\u51c6\uff0c\u6307\u5b9a cpp \u76f8\u5bf9\u5b83\u7684\u8def\u5f84\u5c31\u597d\u4e86\u3002</p> <pre><code># \u5229\u7528\u9884\u5b9a\u4e49\u7684\u5e38\u91cf\u6765\u6307\u5b9a\u6587\u4ef6\u8def\u5f84\nadd_library( # Sets the name of the library.\n             openglutil\n             # Sets the library as a shared library.\n             SHARED\n             # Provides a relative path to your source file(s).\n             ${CMAKE_CURRENT_SOURCE_DIR}/opengl_util.cpp\n             )\n</code></pre>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_8","title":"\u5e73\u53f0\u76f8\u5173\u7684\u5e38\u91cf","text":"<p>CMake \u80fd\u591f\u7528\u6765\u5728 Window\u3001Linux\u3001Mac \u5e73\u53f0\u4e0b\u8fdb\u884c\u7f16\u8bd1\uff0c\u5728\u5b83\u7684\u5185\u90e8\u4e5f\u5b9a\u4e49\u4e86\u548c\u8fd9\u4e9b\u5e73\u53f0\u76f8\u5173\u7684\u53d8\u91cf\u3002</p> <p>\u5177\u4f53\u67e5\u770b \u5b98\u65b9\u6587\u6863 \u3002</p> <p>\u5217\u4e3e\u4e00\u4e9b\u5e38\u89c1\u7684\uff1a</p> <ul> <li>WIN32<ul> <li>\u5982\u679c\u7f16\u8bd1\u7684\u76ee\u6807\u7cfb\u7edf\u662f Window,\u90a3\u4e48 WIN32 \u4e3a True \u3002</li> </ul> </li> <li>UNIX<ul> <li>\u5982\u679c\u7f16\u8bd1\u7684\u76ee\u6807\u7cfb\u7edf\u662f Unix \u6216\u8005\u7c7b Unix \u4e5f\u5c31\u662f Linux ,\u90a3\u4e48 UNIX \u4e3a True \u3002</li> </ul> </li> <li>MSVC<ul> <li>\u5982\u679c\u7f16\u8bd1\u5668\u662f Window \u4e0a\u7684 Visual C++ \u4e4b\u7c7b\u7684\uff0c\u90a3\u4e48 MSVC \u4e3a True \u3002</li> </ul> </li> <li>ANDROID<ul> <li>\u5982\u679c\u76ee\u6807\u7cfb\u7edf\u662f Android \uff0c\u90a3\u4e48 ANDROID \u4e3a 1 \u3002</li> </ul> </li> <li>APPLE<ul> <li>\u5982\u679c\u76ee\u6807\u7cfb\u7edf\u662f APPLE \uff0c\u90a3\u4e48 APPLE \u4e3a 1 \u3002</li> </ul> </li> </ul> <p>\u6709\u4e86\u8fd9\u4e9b\u5e38\u91cf\u505a\u533a\u5206\uff0c\u5c31\u53ef\u4ee5\u5728\u4e00\u4efd CMake \u6587\u4ef6\u4e2d\u7f16\u5199\u4e0d\u540c\u5e73\u53f0\u7684\u7f16\u8bd1\u9009\u9879\u3002</p> <pre><code>if(WIN32){\n    # do something\n}elseif(UNIX){\n    # do something\n}\n</code></pre>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_9","title":"\u51fd\u6570\u3001\u5b8f\u3001\u6d41\u7a0b\u63a7\u5236\u548c\u9009\u9879 \u7b49\u547d\u4ee4","text":"<p>\u5177\u4f53\u53c2\u8003cmake-commands \uff0c\u8fd9\u91cc\u9762\u5305\u62ec\u4e86\u5f88\u591a\u91cd\u8981\u4e14\u5e38\u89c1\u7684\u6307\u4ee4\u3002</p> <p>\u7b80\u5355\u793a\u4f8b CMake \u4e2d\u7684\u51fd\u6570\u64cd\u4f5c\uff1a</p> <pre><code>function(add a b)\n    message(\"this is function call\")\n    math(EXPR num \"${a} + ${b}\" )\n    message(\"result is ${aa}\")\nendfunction()\n\nadd(1 2)\n</code></pre> <p>\u5176\u4e2d\uff0cfunction \u4e3a\u5b9a\u4e49\u51fd\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u51fd\u6570\u540d\u79f0\uff0c\u540e\u9762\u4e3a\u51fd\u6570\u53c2\u6570\u3002</p> <p>\u5728\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u53c2\u6570\u4e4b\u95f4\u7528\u7a7a\u683c\u9694\u5f00\uff0c\u4e0d\u8981\u7528\u9017\u53f7\u3002</p> <p>\u5b8f\u7684\u4f7f\u7528\u4e0e\u51fd\u6570\u4f7f\u7528\u6709\u70b9\u7c7b\u4f3c\uff1a</p> <pre><code>macro(del a b)\n    message(\"this is macro call\")\n    math(EXPR num \"${a} - ${b}\")\n    message(\"num is ${num}\")\nendmacro()\n\ndel(1 2)\n</code></pre> <p>\u5728\u6d41\u7a0b\u63a7\u5236\u65b9\u9762\uff0cCMake \u4e5f\u63d0\u4f9b\u4e86 if\u3001else \u8fd9\u6837\u7684\u64cd\u4f5c\uff1a</p> <pre><code>set(num 0)\nif (1 AND ${num})\n    message(\"and operation\")\nelseif (1 OR ${num})\n    message(\"or operation\")\nelse ()\n    message(\"not reach\")\nendif ()\n</code></pre> <p>\u5176\u4e2d\uff0cCMake \u63d0\u4f9b\u4e86 <code>AND</code>\u3001<code>OR</code>\u3001<code>NOT</code>\u3001<code>LESS</code>\u3001<code>EQUAL</code> \u7b49\u7b49\u8fd9\u6837\u7684\u64cd\u4f5c\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u5224\u65ad\uff0c\u6bd4\u5982 <code>AND</code> \u5c31\u662f\u8981\u6c42\u4e24\u8fb9\u540c\u4e3a True \u624d\u884c\u3002</p> <p>\u53e6\u5916 CMake \u8fd8\u63d0\u4f9b\u4e86\u5faa\u73af\u8fed\u4ee3\u7684\u64cd\u4f5c\uff1a</p> <pre><code>set(stringList this is string list)\nforeach (str ${stringList})\n    message(\"str is ${str}\")\nendforeach ()\n</code></pre> <p>CMake \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a <code>option</code> \u6307\u4ee4\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7\u5b83\u6765\u7ed9 CMake \u5b9a\u4e49\u4e00\u4e9b\u5168\u5c40\u9009\u9879:</p> <pre><code>option(ENABLE_SHARED \"Build shared libraries\" TRUE)\n\nif(ENABLE_SHARED)\n    # do something\nelse()\n    # do something   \nendif()\n</code></pre> <p>\u53ef\u80fd\u4f1a\u89c9\u5f97 <code>option</code> \u65e0\u975e\u5c31\u662f\u4e00\u4e2a True or False \u7684\u6807\u5fd7\u4f4d\uff0c\u53ef\u4ee5\u7528\u53d8\u91cf\u6765\u4ee3\u66ff\uff0c\u4f46\u4f7f\u7528\u53d8\u91cf\u7684\u8bdd\uff0c\u8fd8\u5f97\u6dfb\u52a0 <code>${}</code> \u6765\u8868\u793a\u53d8\u91cf\uff0c\u800c\u4f7f\u7528 <code>option</code> \u76f4\u63a5\u5f15\u7528\u540d\u79f0\u5c31\u597d\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#cmake_4","title":"CMake \u9605\u8bfb\u5b9e\u8df5","text":"<p>\u660e\u767d\u4e86\u4e0a\u8ff0\u7684 CMake \u8bed\u6cd5\u4ee5\u53ca\u4ece\u5b98\u7f51\u53bb\u67e5\u627e\u964c\u751f\u7684\u6307\u4ee4\u610f\u601d\uff0c\u5c31\u57fa\u672c\u4e0a\u53ef\u4ee5\u770b\u61c2\u5927\u90e8\u5206\u7684 CMake \u6587\u4ef6\u4e86\u3002</p> <p>\u8fd9\u91cc\u4e3e\u4e24\u4e2a\u5f00\u6e90\u5e93\u7684\u4f8b\u5b50\uff1a</p> <ul> <li>https://github.com/g-truc/glm<ul> <li><code>glm</code> \u662f\u4e00\u4e2a\u7528\u6765\u5b9e\u73b0\u77e9\u9635\u8ba1\u7b97\u7684\uff0c\u5728 OpenGL \u7684\u5f00\u53d1\u4e2d\u4f1a\u7528\u5230\u3002</li> <li><code>CMakeLists.txt</code> \u5730\u5740\u5728 \u8fd9\u91cc</li> </ul> </li> <li>https://github.com/libjpeg-turbo/libjpeg-turbo<ul> <li><code>libjpeg-turbo</code> \u662f\u7528\u6765\u8fdb\u884c\u56fe\u7247\u538b\u7f29\u7684\uff0c\u5728 Android \u5e95\u5c42\u5c31\u662f\u7528\u7684\u5b83\u3002</li> <li><code>CMakeLists.txt</code> \u5730\u5740\u5728 \u8fd9\u91cc</li> </ul> </li> </ul> <p>\u8fd9\u4e24\u4e2a\u4f8b\u5b50\u4e2d\u5927\u91cf\u7528\u5230\u4e86\u524d\u9762\u6240\u8bb2\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u8bd5\u7740\u8bfb\u4e00\u8bfb\u589e\u52a0\u719f\u7ec3\u5ea6\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_10","title":"\u4e3a\u7f16\u8bd1\u7684\u5e93\u8bbe\u7f6e\u5c5e\u6027","text":"<p>\u63a5\u4e0b\u6765\u518d\u56de\u5230\u7528 CMake \u7f16\u8bd1\u52a8\u6001\u5e93\u7684\u8bdd\u9898\u4e0a\uff0c\u6bd5\u7adf Android NDK \u5f00\u53d1\u4e5f\u4e3b\u8981\u662f\u7528\u6765\u7f16\u8bd1\u5e93\u4e86\uff0c\u5f53\u7f16\u8bd1\u5b8c so \u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5b83\u505a\u4e00\u4e9b\u64cd\u4f5c\u3002</p> <p>\u901a\u8fc7 <code>set_target_properties</code> \u6765\u7ed9\u7f16\u8bd1\u7684\u5e93\u8bbe\u5b9a\u76f8\u5173\u5c5e\u6027\u5185\u5bb9\uff0c\u51fd\u6570\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>set_target_properties(target1 target2 ...\n                      PROPERTIES prop1 value1\n                      prop2 value2 ...)\n</code></pre> <p>\u6bd4\u5982\uff0c\u8981\u5c06\u7f16\u8bd1\u7684\u5e93\u6539\u4e2a\u540d\u79f0\uff1a</p> <pre><code>set_target_properties(native-lib PROPERTIES OUTPUT_NAME \"testlib\" )\n</code></pre> <p>\u66f4\u591a\u7684\u5c5e\u6027\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003 \u5b98\u65b9\u6587\u6863\u3002</p> <p>\u4e0d\u8fc7\uff0c\u8fd9\u91cc\u9762\u6709\u4e00\u4e9b\u5c5e\u6027\u8bbe\u5b9a\u65e0\u6548\uff0c\u5728 Android Studio \u4e0a\u8bd5\u4e86\u65e0\u6548\uff0c\u5728 CLion \u4e0a\u53cd\u800c\u53ef\u4ee5\uff0c\u5f53\u7136\u4e5f\u53ef\u80fd\u662f\u6211\u4f7f\u7528\u59ff\u52bf\u4e0d\u5bf9\u3002</p> <p>\u6bd4\u5982\uff0c\u5b9e\u73b0\u52a8\u6001\u5e93\u7684\u7248\u672c\u53f7\uff1a</p> <pre><code>set_target_properties(native-lib PROPERTIES VERSION 1.2 SOVERSION 1 )\n</code></pre> <p>\u5bf9\u4e8e\u5df2\u7ecf\u7f16\u8bd1\u597d\u7684\u52a8\u6001\u5e93\uff0c\u60f3\u8981\u628a\u5b83\u5bfc\u5165\u8fdb\u6765\uff0c\u4e5f\u9700\u8981\u7528\u5230\u4e00\u4e2a\u5c5e\u6027\u3002</p> <p>\u6bd4\u5982\u7f16\u8bd1\u7684 <code>FFmpeg</code> \u52a8\u6001\u5e93\uff0c</p> <pre><code># \u4f7f\u7528 IMPORTED \u8868\u793a\u5bfc\u5165\u5e93\nadd_library(avcodec-57_lib SHARED IMPORTED)\n# \u4f7f\u7528 IMPORTED_LOCATION \u5c5e\u6027\u6307\u5b9a\u5e93\u7684\u8def\u5f84\nset_target_properties(avcodec-57_lib PROPERTIES IMPORTED_LOCATION\n                        ${CMAKE_CURRENT_SOURCE_DIR}/src/main/jniLibs/armeabi/libavcodec-57.so )\n</code></pre>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_11","title":"\u94fe\u63a5\u5230\u5176\u4ed6\u7684\u5e93","text":"<p>\u5982\u679c\u7f16\u8bd1\u4e86\u591a\u4e2a\u5e93\uff0c\u5e76\u4e14\u60f3\u5e93\u4e0e\u5e93\u4e4b\u95f4\u8fdb\u884c\u94fe\u63a5\uff0c\u90a3\u4e48\u5c31\u8981\u901a\u8fc7 <code>target_link_libraries</code> \u3002</p> <pre><code>target_link_libraries( native-lib\n                       glm\n                       turbojpeg\n                       log )\n</code></pre> <p>\u5728 Android \u5e95\u5c42\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e9b so \u5e93\u4f9b\u4e0a\u5c42\u94fe\u63a5\u4f7f\u7528\uff0c\u4e5f\u8981\u901a\u8fc7\u4e0a\u9762\u7684\u65b9\u5f0f\u6765\u94fe\u63a5\uff0c\u6bd4\u5982\u6700\u5e38\u89c1\u7684\u5c31\u662f <code>log</code> \u5e93\u6253\u5370\u65e5\u5fd7\u3002</p> <p>\u5982\u679c\u8981\u94fe\u63a5\u81ea\u5df1\u7f16\u8bd1\u7684\u591a\u4e2a\u5e93\u6587\u4ef6\uff0c\u9996\u5148\u8981\u4fdd\u8bc1\u6bcf\u4e2a\u5e93\u7684\u4ee3\u7801\u90fd\u5bf9\u5e94\u4e00\u4e2a <code>CMakeLists.txt</code> \u6587\u4ef6\uff0c\u8fd9\u4e2a <code>CMakeLists.txt</code> \u6587\u4ef6\u6307\u5b9a\u5f53\u524d\u8981\u7f16\u8bd1\u7684\u5e93\u7684\u4fe1\u606f\u3002</p> <p>\u7136\u540e\u5728\u5f53\u524d\u5e93\u7684 <code>CMakeLists.txt</code> \u6587\u4ef6\u4e2d\u901a\u8fc7 <code>ADD_SUBDIRECTORY</code> \u5c06\u5176\u4ed6\u5e93\u7684\u76ee\u5f55\u6dfb\u52a0\u8fdb\u6765\uff0c\u8fd9\u6837\u624d\u80fd\u591f\u94fe\u63a5\u5230\u3002</p> <pre><code>ADD_SUBDIRECTORY(src/main/cpp/turbojpeg)\nADD_SUBDIRECTORY(src/main/cpp/glm)\n</code></pre>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_12","title":"\u6dfb\u52a0\u5934\u6587\u4ef6","text":"<p>\u5728\u4f7f\u7528\u7684\u65f6\u5019\u6709\u4e00\u4e2a\u5bb9\u6613\u5ffd\u7565\u7684\u6b65\u9aa4\u5c31\u662f\u6dfb\u52a0\u5934\u6587\u4ef6\uff0c\u901a\u8fc7 <code>include_directories</code> \u6307\u4ee4\u628a\u5934\u6587\u4ef6\u76ee\u5f55\u5305\u542b\u8fdb\u6765\u3002</p> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 <code>#include \"header.h\"</code> \u7684\u65b9\u5f0f\u5305\u542b\u5934\u6587\u4ef6\uff0c\u800c\u4e0d\u7528  <code>#include \"path/path/header.h\"</code> \u8fd9\u6837\u6dfb\u52a0\u8def\u5f84\u7684\u65b9\u5f0f\u6765\u5305\u542b\u3002</p>","tags":["NDK"]},{"location":"android/jni/cmake-best-practices/#_13","title":"\u5c0f\u7ed3","text":"<p>\u4ee5\u4e0a\uff0c\u5c31\u662f\u5173\u4e8e CMake \u7684\u90e8\u5206\u603b\u7ed3\u5185\u5bb9\u3002</p>","tags":["NDK"]},{"location":"android/jni/imooc-course-online/","title":"Android NDK \u5f00\u53d1\u7684\u514d\u8d39\u6280\u672f\u89c6\u9891\u6765\u5566~~","text":"","tags":["NDK"]},{"location":"android/jni/imooc-course-online/#_1","title":"\u7b80\u4ecb","text":"<p>\u524d\u6bb5\u65f6\u95f4\u5728\u6155\u8bfe\u7f51\u4e0a\u4f53\u9a8c\u4e86\u4e00\u628a\u505a\u8bb2\u5e08\u7684\u611f\u89c9\uff0c\u5f55\u5236\u4e86\u4e00\u5957\u514d\u8d39\u6280\u672f\u89c6\u9891~~</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728\u6155\u8bfe\u7f51\u4e0a\u901a\u8fc7\u5982\u4e0b\u8def\u5f84\u5c31\u53ef\u4ee5\u627e\u5230\u5566</p> <p>\u514d\u8d39\u8bfe\u7a0b -&gt; \u8bfe\u7a0b -&gt; \u79fb\u52a8\u5f00\u53d1 -&gt; Android -&gt; Android CMake \u4ee5\u53ca NDK \u5b9e\u8df5\u57fa\u7840</p> <p>\u89c6\u9891\u8bfe\u7a0b\u4e3b\u8981\u662f\u8bb2\u89e3\u4e86 CMake \u4ee5\u53ca Android JNI \u7684\u4e00\u4e9b\u4f7f\u7528\u3002</p> <p>\u5176\u4e2d\u5173\u4e8e CMake \u7684\u4f7f\u7528\u4ecb\u7ecd\u65f6\u957f\u76f8\u5bf9\u5730\u5c11\u4e86\u4e00\u70b9\uff0c\u5927\u90e8\u5206\u65f6\u95f4\u90fd\u5728\u8bb2\u89e3 JNI \u7684\u4f7f\u7528\uff0c\u4e3b\u8981\u6d89\u53ca\u5230 Java \u4e0e JNI \u4e4b\u95f4\u7684\u5404\u79cd\u4ea4\u4e92\u3001JNI \u7684\u7ebf\u7a0b\u3001\u5f15\u7528\u548c\u5f02\u5e38\u7ba1\u7406\u7b49\u3002</p> <p>\u8003\u8651\u5230\u8bfe\u7a0b\u65f6\u957f\u7684\u539f\u56e0\uff0c\u628a\u6bcf\u4e2a\u5c0f\u6280\u672f\u70b9\u90fd\u5355\u72ec\u51fa\u4e00\u4e2a\u89c6\u9891\u8bb2\u89e3\uff0c\u914d\u4e0a\u89c6\u9891\u4ee3\u7801\u6848\u4f8b\u3002\u56e0\u6b64\uff0c\u6bcf\u4e2a\u89c6\u9891\u65f6\u95f4\u90fd\u4e0d\u957f\uff0c\u5e76\u4e14\u6839\u636e\u6807\u9898\u5c31\u53ef\u4ee5\u5f97\u77e5\u8be5\u89c6\u9891\u5185\u5bb9\uff0c\u65b9\u6cd5\u540e\u671f\u8fdb\u884c\u76f8\u5e94\u5730\u67e5\u627e\u3002</p> <p>\u53e6\u5916\uff0c\u7531\u4e8e\u6280\u672f\u80fd\u529b\u6709\u9650\uff0c\u89c6\u9891\u5185\u5bb9\u5728\u8868\u8ff0\u65f6\u4e5f\u4f1a\u6709\u4e00\u4e9b\u9519\u8bef\uff0c\u5982\u679c\u6709\u4ec0\u4e48\u8bb2\u89e3\u4e0d\u5bf9\u7684\u5730\u65b9\uff0c\u6b22\u8fce\u65a7\u6b63\u3002</p> <p>\u4e5f\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 \u3010ezglumes\u3011,\u4ea4\u6d41\u66f4\u591a\u5185\u5bb9 \ud83e\udd14\ud83e\udd14</p> <p>\u5173\u4e8e CMake \u5f00\u53d1\uff0c\u53ef\u4ee5\u770b\u4e4b\u524d\u5199\u8fc7\u7684\u4e00\u7bc7 Android NDK \u4f7f\u7528 CMake \u7684\u6587\u7ae0\uff1a</p> <ul> <li>Android NDK \u5f00\u53d1\u4e4b CMake \u5fc5\u77e5\u5fc5\u4f1a</li> </ul> <p>\u540e\u7eed\u518d\u516c\u4f17\u53f7\u91cc\u9762\u5728\u7ee7\u7eed\u66f4\u65b0 CMake \u4f7f\u7528\u7684\u5c0f\u6280\u5de7~~</p> <p>\u53e6\u5916\uff0c\u5bf9\u4e8e JNI \u4f7f\u7528\uff0c\u4e4b\u524d\u4e5f\u5199\u8fc7\u7cfb\u5217\u7684\u6587\u7ae0\uff1a</p> <ul> <li>Android JNI \u57fa\u7840\u77e5\u8bc6</li> <li>Android JNI \u6570\u7ec4\u64cd\u4f5c</li> <li>Android \u901a\u8fc7 JNI \u8bbf\u95ee Java \u5b57\u6bb5\u548c\u65b9\u6cd5\u8c03\u7528</li> <li>Android \u901a\u8fc7 JNI \u8c03\u7528 Java \u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u548c\u7236\u7c7b\u7684\u65b9\u6cd5</li> <li>Android  JNI \u8c03\u7528\u65f6\u7f13\u5b58\u5b57\u6bb5\u548c\u65b9\u6cd5 ID</li> <li>Android JNI \u4e2d\u7684\u5f15\u7528\u7ba1\u7406</li> <li>Android JNI \u8c03\u7528\u65f6\u7684\u5f02\u5e38\u5904\u7406</li> <li>Android JNI \u4e2d\u7684\u7ebf\u7a0b\u64cd\u4f5c</li> <li>Android JNI \u4e4b Bitmap \u64cd\u4f5c</li> </ul> <p>\u5982\u679c\u89c9\u5f97\u770b\u89c6\u9891\u592a\u8d39\u4e8b\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u770b\u6587\u7ae0~~</p>","tags":["NDK"]},{"location":"android/jni/imooc-course-online/#_2","title":"\u505a\u5f55\u5236\u89c6\u9891\u7684\u611f\u53d7\uff1a","text":"","tags":["NDK"]},{"location":"android/jni/imooc-course-online/#_3","title":"\u624b\u4e0a\u6572\u7740\u4ee3\u7801\uff0c\u53e3\u4e2d\u8bb2\u89e3\u4ee3\u7801\uff0c\u4e24\u8005\u540c\u65f6\u8fdb\u884c\u662f\u4e00\u4ef6\u6709\u96be\u5ea6\u7684\u4e8b\u60c5\u3002","text":"<p>\u8fd9\u79cd\u6280\u672f\u7c7b\u89c6\u9891\u4e3b\u8981\u8fd8\u662f\u4ee3\u7801\u7684\u6f14\u793a\uff0c\u4f46\u8fd8\u4e0d\u80fd\u4e00\u76f4\u6572\u4ee3\u7801\uff0c\u8981\u4e00\u904d\u8bb2\u89e3\u4e00\u904d\u6572\u4ee3\u7801\u3002</p> <p>\u4e00\u5fc3\u4e8c\u7528\uff0c\u5f88\u5bb9\u6613\u51fa\u73b0\u952e\u76d8\u9891\u7e41\u6572\u9519\u5b57\u6bcd\uff0c\u5634\u4e0a\u8bf4\u9519\u4e86\u8bdd\u7b49\u60c5\u51b5\uff0c\u5076\u5c14\u4e00\u6b21\u8fd8\u597d\uff0c\u8981\u662f\u77ed\u77ed\u51e0\u5206\u949f\u5185\u51fa\u73b0\u4e86\u597d\u591a\u6b21\uff0c\u5c31\u5f97\u91cd\u5934\u5f00\u59cb\u5f55\u5236\u4e86\u3002</p> <p>\u521a\u5f00\u59cb\u7684\u65f6\u5019\u7ecf\u5e38\u51fa\u73b0\u4e0a\u9762\u7684\u60c5\u51b5\uff0c\u5bfc\u81f4\u77ed\u77ed\u51e0\u5206\u949f\u7684\u89c6\u9891\u90fd\u8981\u5f55\u5236\u597d\u51e0\u6b21...</p> <p>\u540e\u9762\u66f4\u719f\u6089\u4e00\u4e9b\u4e86\uff0c\u60c5\u51b5\u624d\u6e10\u6e10\u597d\u8f6c\uff0c\u5f55\u5236\u4e00\u8282\u89c6\u9891\u4e5f\u66f4\u5feb\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/imooc-course-online/#_4","title":"\u524d\u671f\u51c6\u5907\u5de5\u4f5c\u5f88\u91cd\u8981","text":"<p>\u9664\u4e86\u5b9e\u9645\u64cd\u4f5c\u6709\u96be\u5ea6\uff0c\u524d\u671f\u505a\u597d\u51c6\u5907\u4e5f\u5f88\u91cd\u8981\u3002</p> <p>\u4e00\u5f00\u59cb\u6211\u8fd8\u5199\u7740\u7a3f\u5b50\uff0c\u51c6\u5907\u4e00\u8fb9\u5f55\u5236\u5199\u4ee3\u7801\uff0c\u4e00\u8fb9\u5ff5\u7740\u7a3f\u5b50\uff0c\u907f\u514d\u51fa\u9519\u91cd\u590d\u5f55\u5236\u3002</p> <p>\u56e0\u4e3a\u662f\u5de6\u53f3\u53cc\u5c4f\u5e55\uff0c\u7a3f\u5b50\u5728\u5de6\u8fb9\u5c4f\u5e55\uff0c\u5f55\u5236\u4ee3\u7801\u5728\u53f3\u8fb9\u5c4f\u5e55\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6572\u4ee3\u7801\u65f6\u773c\u775b\u8fd8\u5f97\u770b\u5230\u7a3f\u5b50\uff0c\u66f4\u5c31\u5bb9\u6613\u51fa\u9519\u4e86\u3002</p> <p>\u540e\u6765\u5e72\u8106\u6452\u5f03\u4e86\u5199\u7a3f\u5b50\u7684\u60f3\u6cd5\uff0c\u5728\u5f55\u5236\u89c6\u9891\u524d\u5199\u597d\u4e00\u4e2a\u5927\u7eb2\uff0c\u5206\u51e0\u4e2a\u90e8\u5206\u3002\u5341\u51e0\u5206\u949f\u7684\u89c6\u9891\uff0c\u6309\u7167\u8fd9\u51e0\u4e2a\u90e8\u5206\u5212\u5206\u8bb2\u4e0b\u53bb\u5c31\u597d\u4e86\u3002</p>","tags":["NDK"]},{"location":"android/jni/imooc-course-online/#mac","title":"Mac \u5f55\u5236\u89c6\u9891\u7684\u8f6f\u4ef6\u662f\u771f\u7684\u5c11","text":"<p>\u90fd\u8bf4\u5de5\u6b32\u5584\u5176\u4e8b\uff0c\u5fc5\u5148\u5229\u5176\u5668\u3002\u5728\u77e5\u4e4e\u4e0a\u641c\u4e86 Mac \u6709\u54ea\u4e9b\u597d\u7528\u7684\u89c6\u9891\u5f55\u5236\u8f6f\u4ef6\uff0c\u6700\u7ec8\u8fd8\u662f\u4f7f\u7528\u81ea\u5e26\u7684 QuickTime Player\u3002</p> <p>\u8fd9\u8f6f\u4ef6\u6700\u4e0d\u597d\u7684\u5730\u65b9\u5c31\u662f\u6682\u505c\u4e0d\u597d\u7528\uff0c\u672c\u6765\u8fd8\u60f3\u7740\u5f55\u5236\u4e2d\u95f4\u505c\u4e0b\u6765\u4f11\u606f\u4f1a\uff0c\u4e00\u6bb5\u4e00\u6bb5\u7684\u5f55\u5236\uff0c\u7136\u540e\u7ed9\u5408\u6210\u5c31\u884c\u4e86\uff0c\u7ed3\u679c\u64cd\u4f5c\u96be\u5ea6\u592a\u5927\u4e86\uff0c\u76f4\u63a5\u653e\u5f03\u4e86\u3002</p> <p>\u5982\u679c\u6709\u4ec0\u4e48 Mac \u4e0a\u597d\u7528\u7684\u5f55\u5236\u8f6f\u4ef6\uff0c\u6b22\u8fce\u63a8\u8350\u7ed9\u6211 \ud83d\ude4f</p>","tags":["NDK"]},{"location":"blog/","title":"Blog","text":""},{"location":"code/c%2B%2B-multi-thread/","title":"C++ \u4e2d\u7684\u591a\u7ebf\u7a0b\u7684\u4f7f\u7528\u548c\u7ebf\u7a0b\u6c60\u5efa\u8bbe","text":"<p>C++ 11 \u5f15\u5165\u4e86 std::thread \u6807\u51c6\u5e93\uff0c\u65b9\u4fbf\u4e86\u591a\u7ebf\u7a0b\u76f8\u5173\u7684\u5f00\u53d1\u5de5\u4f5c\u3002</p> <p>\u8bf4\u5230\u591a\u7ebf\u7a0b\u5f00\u53d1\uff0c\u53ef\u4e0d\u4ec5\u4ec5\u662f\u521b\u5efa\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u5c31\u597d\u4e86\uff0c\u4e0d\u53ef\u907f\u514d\u7684\u8981\u6d89\u53ca\u5230\u7ebf\u7a0b\u540c\u6b65\u7684\u95ee\u9898\u3002</p> <p>\u800c\u4fdd\u8bc1\u7ebf\u7a0b\u540c\u6b65\uff0c\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\uff0c\u5c31\u8981\u7528\u5230\u76f8\u5173\u7684\u5de5\u5177\u4e86\uff0c\u6bd4\u5982\u4fe1\u53f7\u91cf\u3001\u4e92\u65a5\u91cf\u3001\u6761\u4ef6\u53d8\u91cf\u3001\u539f\u5b50\u53d8\u91cf\u7b49\u7b49\u3002</p> <p>\u8fd9\u4e9b\u540d\u8bcd\u6982\u5ff5\u90fd\u662f\u6765\u64cd\u4f5c\u7cfb\u7edf\u91cc\u9762\u5f15\u7533\u6765\u7684\uff0c\u5e76\u4e0d\u662f\u5c5e\u4e8e\u54ea\u4e00\u79cd\u7f16\u7a0b\u8bed\u8a00\u6240\u7279\u6709\u7684\uff0c\u5728\u4e0d\u540c\u8bed\u8a00\u4e0a\u7684\u8868\u73b0\u5f62\u5f0f\u4e0d\u4e00\u6837\uff0c\u4f46\u5176\u80cc\u540e\u7684\u539f\u7406\u662f\u4e00\u81f4\u7684\u3002</p> <p>C++ 11 \u540c\u6837\u5f15\u5165\u4e86 mutex\u3001condition_variable\u3001future \u7b49\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u7684\u7c7b\uff0c\u4e0b\u9762\u5c31\u6765\u4e00\u4e00\u4e86\u89e3\u5b83\u4eec\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#mutex","title":"mutex","text":"<p>mutex \u4f5c\u4e3a\u4e92\u65a5\u91cf\uff0c\u63d0\u4f9b\u4e86\u72ec\u5360\u6240\u6709\u6743\u7684\u7279\u6027\u3002</p> <p>\u4e00\u4e2a\u7ebf\u7a0b\u5c06\u4e92\u65a5\u91cf\u9501\u4f4f\uff0c\u76f4\u5230\u8c03\u7528 unlock \u4e4b\u524d\uff0c\u8be5\u7ebf\u7a0b\u90fd\u662f\u62e5\u6709\u8be5\u9501\u7684\uff0c\u800c\u5176\u4ed6\u7ebf\u7a0b\u8bbf\u95ee\u88ab\u9501\u4f4f\u7684\u4e92\u65a5\u91cf\uff0c\u5219\u4f1a\u88ab\u963b\u585e\u4f4f\u3002</p> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>#include &lt;thread&gt;\n#include &lt;iostream&gt;\n\nint num = 0;\nstd::mutex mutex;\n\nvoid plus(){\n    std::lock_guard&lt;std::mutex&gt; guard(mutex);\n    std::cout &lt;&lt; num++ &lt;&lt;std::endl;\n}\n\nint main(){\n    std::thread threads[10];\n    for (auto &amp; i : threads) {\n        i = std::thread(plus);\n    }\n    for (auto &amp; thread : threads) {\n        thread.join();\n    }\n    return 0;\n}\n</code></pre> <p>\u5982\u4e0a\u4ee3\u7801\uff0c\u521b\u5efa\u4e86 10 \u4e2a\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u5148\u6253\u5370 num \u7684\u503c\uff0c\u7136\u540e\u518d\u5c06 num \u53d8\u91cf\u52a0\u4e00\uff0c\u4f9d\u6b21\u6253\u5370 0 \u5230 9 \u3002</p> <p>\u4f17\u6240\u5468\u77e5\uff0c+1 \u7684\u64cd\u4f5c\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5b9e\u9645\u5305\u542b\u4e86\u4e09\u6b65\uff0c\u5148\u8bfb\u53d6\uff0c\u518d\u52a0\u4e00\uff0c\u6700\u540e\u8d4b\u503c\u3002\u4f46\u662f\u56e0\u4e3a\u4f7f\u7528\u4e86\u4e92\u65a5\u91cf mutex \uff0c\u4fdd\u8bc1\u72ec\u5360\u6027\uff0c\u6240\u4ee5\u7ed3\u679c\u90fd\u662f\u6309\u7167\u987a\u5e8f\u9012\u589e\u6253\u5370\u7684\u3002</p> <p>\u5982\u679c\u4e0d\u4f7f\u7528\u4e92\u65a5\u91cf\uff0c\u90a3\u4e48\u53ef\u80fd\u524d\u4e00\u4e2a\u7ebf\u7a0b\u8fd8\u6ca1\u6709\u8d4b\u503c\u5b8c\uff0c\u540e\u4e00\u4e2a\u7ebf\u7a0b\u5c31\u8fdb\u884c\u4e86\u8bfb\u53d6\uff0c\u6700\u540e\u7684\u7ed3\u679c\u5c31\u662f\u968f\u673a\u4e0d\u53ef\u9884\u6599\u7684\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#condition_variable","title":"condition_variable","text":"<p>condition_variable \u4f5c\u4e3a\u6761\u4ef6\u53d8\u91cf\uff0c\u5b83\u4f1a\u8c03\u7528 wait \u51fd\u6570\u7b49\u5f85\u67d0\u4e2a\u6761\u4ef6\u6ee1\u8db3\uff0c\u5982\u679c\u4e0d\u6ee1\u8db3\u7684\u8bdd\uff0c\u5c31\u901a\u8fc7 unique_lock \u6765\u9501\u4f4f\u5f53\u524d\u7ebf\u7a0b\uff0c\u5f53\u524d\u7ebf\u7a0b\u5c31\u5904\u4e8e\u963b\u585e\u72b6\u6001\uff0c\u76f4\u5230\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528\u4e86\u6761\u4ef6\u53d8\u91cf\u7684 nofity \u51fd\u6570\u6765\u5524\u9192\u3002</p> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n\nint num = 0;\nstd::mutex mutex;\nstd::condition_variable cv;\n\nvoid plus(int target){\n    std::unique_lock&lt;std::mutex&gt; lock(mutex);\n    cv.wait(lock,[target]{return num == target;});\n    num++;\n    std::cout &lt;&lt; target &lt;&lt;std::endl;\n    cv.notify_all();\n}\n\nint main(){\n    std::thread threads[10];\n    for (int i = 0; i &lt; 10; ++i) {\n        threads[i] = std::thread(plus,9-i);\n    }\n    for (auto &amp; thread : threads) {\n        thread.join();\n    }\n    return 0;\n}\n</code></pre> <p>\u540c\u6837\u662f\u521b\u5efa\u4e86 10 \u4e2a\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u6709\u4e00\u4e2a target \u53c2\u6570\uff0c\u4ee3\u8868\u8be5\u7ebf\u7a0b\u8981\u6253\u5370\u7684\u6570\u503c\uff0c\u6309\u7167 9 -&gt; 0 \u987a\u5e8f\u521b\u5efa\u7ebf\u7a0b\uff0c\u6700\u540e\u8fd0\u884c\u7ed3\u679c\u662f\u4f9d\u6b21\u6253\u5370 0 -&gt; 9 \u3002</p> <p>\u6bcf\u4e2a\u7ebf\u7a0b\u8fd0\u884c\u65f6\u90fd\u4f1a\u5148\u8c03\u7528 wait \u51fd\u6570\u7b49\u5f85 num == target \u8fd9\u4e00\u6761\u4ef6\u6ee1\u8db3\uff0c\u4e00\u65e6\u6ee1\u8db3\u5c31\u4f1a\u5c06 num \u52a0\u4e00\uff0c\u5e76\u6253\u5370 target \u503c\uff0c\u7136\u540e\u5524\u9192\u4e0b\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u503c\u3002</p> <p>\u901a\u8fc7\u6539\u53d8\u6761\u4ef6\u53d8\u91cf\u7684 wait \u51fd\u6570\u5524\u9192\u6761\u4ef6\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u7684\u591a\u7ebf\u7a0b\u6a21\u5f0f\uff0c\u6bd4\u5982\u5e38\u89c1\u7684\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u3002 </p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#condiation_variable","title":"condiation_variable \u5b9e\u73b0\u751f\u4ea7\u6d88\u8d39\u8005\u6a21\u5f0f","text":"<pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;queue&gt;\n\nint main(){\n    std::queue&lt;int&gt; products;\n    std::condition_variable cv_pro,cv_con;\n    std::mutex mtx;\n\n    bool end = false;\n    std::thread producer([&amp;]{\n        for (int i = 0; i &lt; 10; ++i) {\n            std::unique_lock&lt;std::mutex&gt; lock(mtx);\n            cv_pro.wait(lock,[&amp;]{return products.empty();});\n            products.push(i);\n            cv_con.notify_all();\n        }\n        cv_con.notify_all();\n        end = true;\n    });\n\n    std::thread consumer([&amp;]{\n        while (!end){\n            std::unique_lock&lt;std::mutex&gt; lock(mtx);\n            cv_con.wait(lock,[&amp;]{return !products.empty();});\n            int d = products.front();\n            products.pop();\n            std::cout &lt;&lt; d &lt;&lt; std::endl;\n            cv_pro.notify_all();\n        }\n    });\n\n    producer.join();\n    consumer.join();\n    return 0;\n}\n</code></pre>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#future-promise","title":"future &amp; promise","text":"<p>future \u8fd9\u4e00\u7279\u6027\u5728\u65e5\u5e38\u5f00\u53d1\u4e2d\u7528\u7684\u6bd4\u8f83\u5c11\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u83b7\u53d6\u5f02\u6b65\u4efb\u52a1\u7684\u7ed3\u679c\uff0c\u4e5f\u53ef\u4ee5\u5f53\u505a\u4e00\u79cd\u7ebf\u7a0b\u95f4\u540c\u6b65\u7684\u624b\u6bb5\u3002</p> <p>\u5047\u8bbe\u73b0\u5728\u7a0b\u5e8f\u8981\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u6267\u884c\u8017\u65f6\u64cd\u4f5c\uff0c\u5e76\u4e14\u7b49\u8017\u65f6\u64cd\u4f5c\u7ed3\u675f\u4e86\u4e4b\u540e\u8981\u62ff\u5230\u8fd4\u56de\u503c\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7 condiation_variable \u6765\u5b9e\u73b0\uff0c\u5728\u5f02\u6b65\u7ebf\u7a0b\u6267\u884c\u5b8c\u4e86\u4e4b\u540e\u8c03\u7528 notify \u65b9\u6cd5\u6765\u5524\u9192\u4e3b\u7ebf\u7a0b\uff0c\u540c\u6837\u4e5f\u53ef\u4ee5\u901a\u8fc7 future \u6765\u5b9e\u73b0\u3002</p> <p>\u5f53\u7a0b\u5e8f\u901a\u8fc7\u7279\u5b9a\u65b9\u6cd5\u521b\u5efa\u4e86\u4e00\u4e2a\u5f02\u6b65\u64cd\u4f5c\u4e4b\u540e\u4f1a\u8fd4\u56de\u4e00\u4e2a future \uff0c\u8be5 future \u53ef\u4ee5\u8bbf\u95ee\u5230\u5f02\u6b65\u7ebf\u7a0b\u7684\u72b6\u6001\u3002</p> <p>\u5728\u5f02\u6b65\u7ebf\u7a0b\u91cc\u9762\u8bbe\u7f6e\u67d0\u4e2a\u5171\u4eab\u72b6\u6001\u7684\u503c\uff0c\u4e0e\u8be5\u5171\u4eab\u72b6\u6001\u76f8\u5173\u8054\u7684 future \u5c31\u53ef\u4ee5\u901a\u8fc7 get \u65b9\u6cd5\u6765\u83b7\u53d6\u7ed3\u679c\uff0cget() \u65b9\u6cd5\u4f1a\u963b\u585e\u8c03\u7528\u7ebf\u7a0b\uff0c\u4ece\u800c\u7b49\u5f85\u5f02\u6b65\u7ebf\u7a0b\u5b8c\u6210\u8bbe\u7f6e\u3002</p> <p>future \u7684 get \u65b9\u6cd5\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e condiation_variable \u7684 wait \u65b9\u6cd5\uff0c\u800c\u5f02\u6b65\u7ebf\u7a0b\u8bbe\u7f6e\u5171\u4eab\u72b6\u6001\u7684\u503c\u7684\u65b9\u6cd5\u5c31\u76f8\u5f53\u4e8e condiation_variable \u7684 notify \u65b9\u6cd5\u3002</p> <p>future \u7684\u521b\u5efa\u6709\u5982\u4e0b\u4e09\u79cd\u65b9\u5f0f\uff1a</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#stdpromise","title":"std::promise","text":"<p>promise \u5c31\u50cf\u5b83\u7684\u5b57\u9762\u610f\u601d\u4e00\u6837\uff0c\u4ee3\u8868\u627f\u8bfa\uff0c\u8bf4\u660e\u5b83\u4e00\u5b9a\u4f1a\u5728\u5f02\u6b65\u7ebf\u7a0b\u8bbe\u7f6e\u5171\u4eab\u72b6\u6001\u7684\uff0c\u800c future \u5c31\u8010\u5fc3\u7b49\u5f85\u597d\u4e86\u3002</p> <p>promise \u548c future \u7684\u8c03\u7528\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;chrono&gt;\n#include &lt;future&gt;\n\nvoid task(std::promise&lt;int&gt;&amp; promise){\n    std::this_thread::sleep_for(std::chrono::seconds(1));\n    promise.set_value(10);\n}\n\nint main(){\n    std::promise&lt;int&gt; promise;\n    std::future&lt;int&gt; future = promise.get_future();\n    std::thread t(task,std::ref(promise));\n    int result = future.get();\n    std::cout &lt;&lt; \"thread result is \" &lt;&lt; result &lt;&lt; std::endl;\n    t.join();\n    return 0;\n}\n</code></pre> <p>promise \u901a\u8fc7 get_future \u65b9\u6cd5\u83b7\u53d6\u4e0e\u8be5 promise \u5173\u8054\u7684 future \u5bf9\u8c61\uff0c\u5e76\u4e14\u901a\u8fc7 set_value \u65b9\u6cd5\u8bbe\u7f6e\u5171\u4eab\u72b6\u6001\u7684\u503c\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#stdpackaged_task","title":"std::packaged_task","text":"<p>packaged_task \u53ef\u4ee5\u7528\u6765\u5305\u88c5\u4e00\u4e2a\u53ef\u8c03\u7528\u7684\u5bf9\u8c61 \uff0c\u5e76\u4e14\u80fd\u4f5c\u4e3a\u7ebf\u7a0b\u7684\u8fd0\u884c\u51fd\u6570\uff0c\u6709\u70b9\u7c7b\u4f3c\u4e8e std::function \u3002</p> <p>\u4f46\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u5c06\u5176\u5305\u88c5\u7684\u53ef\u8c03\u7528\u5bf9\u8c61\u7684\u6267\u884c\u7ed3\u679c\u4f20\u9012\u4e00\u4e2a\u76f8\u5173\u8054\u7684 future \uff0c\u4ece\u800c\u5b9e\u73b0\u72b6\u6001\u7684\u5171\u4eab\uff0cfuture \u901a\u8fc7 get \u65b9\u6cd5\u6765\u7b49\u5f85\u53ef\u8c03\u7528\u5bf9\u8c61\u6267\u884c\u7ed3\u675f\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;chrono&gt;\n#include &lt;future&gt;\n\nint task(){\n    std::this_thread::sleep_for(std::chrono::seconds(1));\n    return 10;\n}\n\nint main(){\n    std::packaged_task&lt;int(void)&gt; packaged_task(task);\n    std::future&lt;int&gt; future = packaged_task.get_future();\n    std::thread thread(std::move(packaged_task));\n    int result = future.get();\n    std::cout &lt;&lt; \"thread result is \" &lt;&lt; result &lt;&lt; std::endl;\n    thread.join();\n    return 0;\n}\n</code></pre> <p>packaged_task \u901a\u8fc7 get_future \u65b9\u6cd5\u6765\u83b7\u5f97\u76f8\u5173\u8054\u7684 future \u5bf9\u8c61\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#stdasync","title":"std::async","text":"<p>async \u4e5f\u80fd\u521b\u5efa future \uff0c\u5e76\u4e14\u5b83\u66f4\u50cf\u662f\u5bf9 std::thread\uff0cstd::packaged_task\uff0cstd::promise \u7684\u5c01\u88c5\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;thread&gt;\n#include &lt;chrono&gt;\n#include &lt;future&gt;\n\nint task(){\n    std::this_thread::sleep_for(std::chrono::seconds(1));\n    return 10;\n}\n\nint main(){\n    std::future&lt;int&gt; future = std::async(std::launch::async,task);\n    int result = future.get();\n    std::cout &lt;&lt; \"thread result is \" &lt;&lt; result &lt;&lt; std::endl;\n    return 0;\n}\n</code></pre> <p>\u901a\u8fc7 async \u76f4\u63a5\u521b\u5efa\u5f02\u6b65\u7ebf\u7a0b\u5e76\u4e14\u83b7\u53d6\u76f8\u5173\u8054\u7684 future \u5bf9\u8c61\uff0c\u8fde thread \u521b\u5efa\u7ebf\u7a0b\u7684\u64cd\u4f5c\u90fd\u7701\u4e86\u3002</p> <p>async \u6709\u4e24\u79cd\u6267\u884c\u7b56\u7565\uff0claunch::async \u548c launch::deferred \u3002\u5176\u4e2d\u524d\u8005\u662f\u7acb\u5373\u6267\u884c\uff0c\u540e\u8005\u662f\u7b49\u8c03\u7528 future.get() \u65b9\u6cd5\u65f6\u624d\u4f1a\u521b\u5efa\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_1","title":"\u7ebf\u7a0b\u6c60\u7684\u5efa\u8bbe","text":"<p>\u4e86\u89e3\u4e86\u4ee5\u4e0a\u7684\u7ebf\u7a0b\u76f8\u5173\u64cd\u4f5c\u7c7b\uff0c\u5c31\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8fdb\u9636\uff0c\u901a\u8fc7\u5b83\u4eec\u6765\u6253\u9020\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u4e86\u3002</p> <p>\u5173\u4e8e\u7ebf\u7a0b\u6c60\u5efa\u8bbe\uff0c\u6839\u636e\u5177\u4f53\u4e1a\u52a1\u548c\u4f7f\u7528\u573a\u666f\uff0c\u4f1a\u6709\u5f88\u591a\u4e0d\u540c\u652f\u6301\uff0c\u4f46\u6709\u4e9b\u672c\u8d28\u5185\u5bb9\u8fd8\u662f\u4e0d\u4f1a\u53d8\u7684\u3002</p> <p>\u7ebf\u7a0b\u6c60\u7684\u51fa\u53d1\u70b9\u5f53\u7136\u662f\u4e3a\u4e86\u51cf\u5c11\u5728\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u4e0a\u6240\u82b1\u7684\u65f6\u95f4\u548c\u7cfb\u7edf\u8d44\u6e90\u7684\u5f00\u9500\uff0c\u8868\u73b0\u5f62\u5f0f\u4e0a\u5c31\u662f\u6709\u4e00\u6c60\u5b50\u7684\u7ebf\u7a0b\uff0c\u5411\u7ebf\u7a0b\u6c60\u63d0\u4ea4\u4efb\u52a1\uff0c\u6700\u7ec8\u5206\u914d\u5230\u67d0\u4e2a\u7ebf\u7a0b\u4e0a\u53bb\u6267\u884c\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5c31\u662f\u4e00\u4e2a\u7b80\u6613\u7ebf\u7a0b\u6c60\u7684\u96cf\u5f62\uff0c\u6709\u4efb\u52a1 Task\uff0c\u6709 Thread Pool \u6765\u5206\u53d1\u4efb\u52a1\uff0c\u4e5f\u6709 Worker Thread \u6765\u6700\u7ec8\u6267\u884c\u4efb\u52a1\uff0c\u9ebb\u96c0\u867d\u5c0f\u4e94\u810f\u4ff1\u5168\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u8be6\u7ec6\u62c6\u89e3\u4ee5\u4e0a\u90e8\u5206\u5185\u5bb9\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_2","title":"\u4efb\u52a1\u7c7b\u578b","text":"<p>\u4efb\u52a1 Task \u7684\u7c7b\u578b\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u53ef\u4ee5\u6709\u591a\u79cd\u5b9a\u4e49\uff0c\u4e3b\u8981\u5dee\u522b\u5728\u4e8e\u4efb\u52a1\u9700\u8981\u7684\u53c2\u6570\u7c7b\u578b\u4ee5\u53ca\u8fd4\u56de\u503c\u7c7b\u578b\u3002</p> <p>\u53e6\u5916\uff0c\u4efb\u52a1\u672c\u8eab\u4e5f\u53ef\u4ee5\u6709\u4e00\u4e9b\u5c5e\u6027\u6765\u6807\u8bc6\u8be5\u5c5e\u6027\u7684\u7c7b\u578b\uff0c\u5e94\u8be5\u653e\u5230\u4ec0\u4e48\u6837\u7684\u7ebf\u7a0b\u53bb\u6267\u884c\u7b49\u7b49\u3002</p> <p>\u7b80\u5355\u8d77\u89c1\uff0c\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684 Task \u7c7b\u578b\uff0c\u65e0\u9700\u53c2\u6570\uff0c\u4e5f\u4e0d\u9700\u8981\u8fd4\u56de\u503c\u7c7b\u578b\u3002</p> <pre><code>using task = std::function&lt;void()&gt;;\n</code></pre>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_3","title":"\u7ebf\u7a0b\u6570\u91cf","text":"<p>\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u8be5\u6709\u591a\u5c11\u7ebf\u7a0b\u5462\uff1f\u5982\u679c\u6570\u91cf\u592a\u591a\uff0c\u4f1a\u5bfc\u81f4\u8d44\u6e90\u6d6a\u8d39\uff0c\u6709\u4e9b\u7ebf\u7a0b\u4e0d\u4e00\u5b9a\u80fd\u5145\u5206\u4f7f\u7528\u3002\u5982\u679c\u592a\u5c11\u5c31\u4f1a\u5bfc\u81f4\u9891\u7e41\u521b\u5efa\u65b0\u7ebf\u7a0b\u3002</p> <p>\u4e00\u4e2a\u7075\u6d3b\u7684\u7ebf\u7a0b\u6c60\u5e94\u8be5\u662f\u53ef\u4ee5\u52a8\u6001\u6539\u53d8\u7ebf\u7a0b\u6570\u91cf\u7684\uff0c\u53c2\u8003 Java\u7ebf\u7a0b\u6c60\u5b9e\u73b0\u539f\u7406\u53ca\u5176\u5728\u7f8e\u56e2\u4e1a\u52a1\u4e2d\u7684\u5b9e\u8df5\u3002</p> <p>\u5728 Java \u7684 ThreadPoolExecutor \u4e2d\u901a\u8fc7 corePoolSize \u548c maximumPoolSize \u6765\u9650\u5236\u7ebf\u7a0b\u7684\u6570\u91cf\uff0c\u7ebf\u7a0b\u6570\u91cf\u4f1a\u5728 <code>[0 ~ corePoolSize]</code> \u548c <code>[corePoolSize ~ maximumPoolSize]</code>\u4e4b\u95f4\u6ce2\u52a8\u3002</p> <p>\u5f53\u4efb\u52a1\u5403\u7d27\uff0c\u7ebf\u7a0b\u548c\u7f13\u5b58\u90fd\u6ee1\u4e86\uff0c\u5c31\u4f1a\u7533\u8bf7\u7ebf\u7a0b\uff0c\u6570\u91cf\u8fbe\u5230 <code>[corePoolSize ~ maximumPoolSize]</code> \u8303\u56f4\uff0c\u4e00\u65e6\u4efb\u52a1\u677e\u61c8\uff0c\u5c31\u4f1a\u91ca\u653e\u4e00\u4e9b\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u6570\u91cf\u56de\u843d\u5230 <code>[0 ~ corePoolSize]</code> \u8303\u56f4\uff0c\u5982\u679c\u4efb\u52a1\u6301\u7eed\u5403\u7d27\uff0c\u90a3\u4e48\u5c31\u4f1a\u62d2\u7edd\u4efb\u52a1\u4e86\u3002</p> <p>\u5f53\u7136\uff0c\u4e5f\u6709\u5176\u4ed6\u786e\u5b9a\u7ebf\u7a0b\u6570\u91cf\u7684\u7b56\u7565\uff0c\u6839\u636e\u5177\u4f53\u7684\u4e1a\u52a1\u9700\u6c42\u6765\u6838\u5b9a\uff0c\u6bd4\u5982\u6839\u636e CPU \u591a\u6838\u6765\u51b3\u5b9a\u7ebf\u7a0b\u6570\u91cf\u591a\u5c11\u3002</p> <p>\u7b80\u5355\u8d77\u89c1\uff0c\u8fd9\u91cc\u5c31\u4ee5\u56fa\u5b9a\u7ebf\u7a0b\u6570\u91cf\u4f5c\u4e3a\u6f14\u793a\u4e86\u3002</p> <pre><code>size_t N = std::thread::hardware_concurrency();\n</code></pre>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_4","title":"\u4efb\u52a1\u7f13\u5b58","text":"<p>\u5047\u8bbe\u73b0\u5728\u5df2\u7ecf\u56fa\u5b9a\u4e86 N \u4e2a\u7ebf\u7a0b\uff0c\u5e76\u4e14\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4efb\u52a1\u5728\u6267\u884c\uff0c\u8fd9\u65f6\u6709\u6765\u4e86\u4e00\u4e2a\u65b0\u4efb\u52a1\uff0c\u90a3\u4e48\u8be5\u600e\u4e48\u5904\u7406\u5462\uff1f \u8fd9\u65f6\u5019\u5c31\u9700\u8981\u4efb\u52a1\u7f13\u5b58\u673a\u5236\u4e86\uff08\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u62d2\u7edd\u8be5\u4efb\u52a1\uff09\u3002</p> <p>\u4efb\u52a1\u7f13\u5b58\u4e5f\u5206\u591a\u79cd\u5f62\u5f0f\uff1a</p> <ol> <li>\u5168\u5c40\u7f13\u5b58</li> <li>\u7ebf\u7a0b\u7f13\u5b58</li> <li>\u5168\u5c40\u7f13\u5b58 + \u7ebf\u7a0b\u7f13\u5b58</li> </ol>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_5","title":"\u5168\u5c40\u7f13\u5b58","text":"<p>\u5168\u5c40\u7f13\u5b58\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u5728\u7ebf\u7a0b\u6c60\u6709\u4e00\u4e2a\u5168\u5c40\u7684\u7f13\u5b58\u961f\u5217\uff0c\u51e1\u662f\u8fdb\u5165\u5230\u7ebf\u7a0b\u6c60\u7684\u4efb\u52a1\u90fd\u4f1a\u5148\u8fdb\u5230\u5168\u5c40\u7f13\u5b58\u4e2d\uff0c\u7136\u540e\u7531\u5168\u5c40\u7f13\u5b58\u8fdb\u884c\u4efb\u52a1\u7684\u5206\u53d1\uff0c\u6700\u540e\u7531\u4e0d\u540c\u7684\u5de5\u4f5c\u7ebf\u7a0b\u53bb\u6267\u884c\u4efb\u52a1\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_6","title":"\u7ebf\u7a0b\u7f13\u5b58","text":"<p>\u7ebf\u7a0b\u7f13\u5b58\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u5728\u6bcf\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\u7f13\u5b58\u961f\u5217\uff0c\u7136\u540e\u7ebf\u7a0b\u4e0d\u65ad\u5faa\u73af\u5904\u7406\u81ea\u5df1\u7f13\u5b58\u961f\u5217\u4e0a\u7684\u4efb\u52a1\u3002\u51e1\u662f\u8fdb\u5165\u5230\u7ebf\u7a0b\u6c60\u7684\u4efb\u52a1\uff0c\u90fd\u4f1a\u7531\u7ebf\u7a0b\u6c60\u8fdb\u5230\u8c03\u5ea6\u548c\u5206\u53d1\uff0c\u7136\u540e\u8fdb\u5165\u5230\u5de5\u4f5c\u7ebf\u7a0b\u5bf9\u5e94\u7684\u7f13\u5b58\u961f\u5217\u4e2d\uff0c\u6700\u7ec8\u88ab\u6267\u884c\u7ed3\u675f</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_7","title":"\u5168\u5c40\u7f13\u5b58 + \u7ebf\u7a0b\u7f13\u5b58","text":"<p>\u5168\u5c40\u7f13\u5b58 + \u7ebf\u7a0b\u7f13\u5b58 \u5c31\u662f\u5c06\u4e0a\u9762\u4e24\u8005\u7ed3\u5408\u8d77\u6765\u4e86\uff0c\u7528\u5982\u4e0b\u56fe\u6765\u6c47\u603b\u6f14\u793a\uff1a</p> <p></p> <p>\u8fd9\u79cd\u7f13\u5b58\u65b9\u5f0f\u7b97\u662f\u6bd4\u8f83\u590d\u6742\u7684\u60c5\u5f62\u4e86\uff0c\u9002\u7528\u4e8e\u90a3\u79cd\u8ba1\u7b97\u91cf\u5927\u4e14\u5feb\u901f\u6267\u884c\u7684\u60c5\u5f62\uff0c\u4e00\u822c\u6765\u8bf4\u8fd8\u662f\u5168\u5c40\u7f13\u5b58\u7528\u7684\u6bd4\u8f83\u666e\u904d\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_8","title":"\u7f13\u5b58\u961f\u5217","text":"<p>\u6709\u4e86\u4efb\u52a1\u7f13\u5b58\uff0c\u90a3\u4e48\u8fd8\u5e94\u8be5\u5b9a\u4e49\u4e00\u4e0b\u7f13\u5b58\u961f\u5217\u3002\u6beb\u65e0\u7591\u95ee\uff0c\u7f13\u5b58\u961f\u5217\u5fc5\u987b\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u5b83\u8981\u5728\u591a\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u4efb\u52a1\u3002</p> <p>\u7f13\u5b58\u961f\u5217\u7684\u5f62\u5f0f\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u963b\u585e\u961f\u5217\uff0c\u53cc\u5411\u94fe\u8868\u7684\u963b\u585e\u961f\u5217\u7b49\u7b49\uff0c\u8fd9\u91cc\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684\u961f\u5217\uff0c\u628a std::queue \u505a\u4e00\u4e0b\u7ebf\u7a0b\u5b89\u5168\u7684\u5c01\u88c5\u3002</p> <pre><code>#pragma once\n\n#include &lt;mutex&gt;\n#include &lt;queue&gt;\n\n// Thread safe implementation of a Queue using an std::queue\ntemplate &lt;typename T&gt;\nclass SafeQueue {\nprivate:\n  std::queue&lt;T&gt; m_queue;\n  std::mutex m_mutex;\npublic:\n  SafeQueue() {\n\n  }\n\n  bool empty() {\n    std::unique_lock&lt;std::mutex&gt; lock(m_mutex);\n    return m_queue.empty();\n  }\n\n  int size() {\n    std::unique_lock&lt;std::mutex&gt; lock(m_mutex);\n    return m_queue.size();\n  }\n\n  void enqueue(T&amp; t) {\n    std::unique_lock&lt;std::mutex&gt; lock(m_mutex);\n    m_queue.push(t);\n  }\n\n  bool dequeue(T&amp; t) {\n    std::unique_lock&lt;std::mutex&gt; lock(m_mutex);\n\n    if (m_queue.empty()) {\n      return false;\n    }\n    t = std::move(m_queue.front());\n\n    m_queue.pop();\n    return true;\n  }\n};\n</code></pre> <p>\u5b9a\u4e49\u4e86 enqueue \u548c dequeue \u65b9\u6cd5\u5411\u961f\u5217\u4e2d\u585e\u4efb\u52a1\u548c\u53d6\u4efb\u52a1\uff0c\u901a\u8fc7\u52a0\u9501\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_9","title":"\u7ebf\u7a0b\u8c03\u5ea6","text":"<p>\u7ebf\u7a0b\u6c60\u6700\u6838\u5fc3\u7684\u90e8\u5206\u4e5f\u5c31\u662f\u7ebf\u7a0b\u8c03\u5ea6\u4e86\uff0c\u5047\u8bbe\u4f7f\u7528\u4e86\u5168\u5c40\u7f13\u5b58\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u5982\u4f55\u628a\u5168\u5c40\u7f13\u5b58\u4e2d\u7684\u4efb\u52a1\u5206\u53d1\u7ed9\u7a7a\u95f2\u7ebf\u7a0b\u5462\uff1f</p> <p>\u5b9e\u9645\u4e0a\u4ece\u67d0\u79cd\u89d2\u5ea6\u6765\u8bf4\uff0c\u5168\u5c40\u7f13\u5b58\u7684\u7ebf\u7a0b\u6c60\u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e00\u4e2a\u5355\u751f\u4ea7\u8005-\u591a\u6d88\u8d39\u8005\u6a21\u5f0f\uff0c\u5168\u5c40\u7f13\u5b58\u5c31\u662f\u751f\u4ea7\u8005\uff0c\u800c\u591a\u4e2a\u7ebf\u7a0b\u5c31\u662f\u591a\u4e2a\u6d88\u8d39\u8005\u4e86\u3002</p> <p>\u5728\u524d\u9762\u7684\u4ee3\u7801\u5b9e\u8df5\u4e2d\u5df2\u7ecf\u5199\u4e86\u4e00\u4e2a\u5355\u751f\u4ea7\u8005-\u5355\u6d88\u8d39\u8005\u6a21\u5f0f\uff0c\u5f53\u751f\u4ea7\u8005\u751f\u4ea7\u4e86 Task \u4e4b\u540e\uff0c\u5c31\u901a\u8fc7 notify \u65b9\u6cd5\u6765\u5524\u9192\u6d88\u8d39\u8005\uff0c\u4ece\u800c\u5c06 Task \u5206\u914d\u5230\u6d88\u8d39\u8005\u53bb\u6267\u884c\u3002\u7531\u4e8e\u53ea\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u90a3\u5524\u9192\u7684\u5c31\u662f\u552f\u4e00\u7684\u90a3\u4e2a\u4e86\u3002</p> <p>\u90a3\u5047\u82e5\u6709\u591a\u4e2a\u6d88\u8d39\u8005\uff0c\u5524\u9192\u7684\u53c8\u662f\u54ea\u4e00\u4e2a\u5462\uff1f\u7b54\u6848\u662f\u968f\u673a\u7684\u3002\u8c03\u7528 notify_one \u65b9\u6cd5\u4f1a\u968f\u673a\u5524\u9192\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u8c03\u7528 notify_all \u5219\u4f1a\u5524\u9192\u5168\u90e8\u7ebf\u7a0b\u3002</p> <p>\u4f46\u662f\u5524\u9192\u5e76\u4e0d\u4ee3\u8868\u7ebf\u7a0b\u5c31\u4f1a\u6d88\u8d39 Task\uff0c\u4e00\u4e2a Task \u5bf9\u5e94\u591a\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u5524\u9192\u4e4b\u540e\u4f1a\u53bb\u5168\u5c40\u7f13\u5b58\u62a2\u593a Task \u4efb\u52a1\uff0c\u4e00\u65e6\u5f97\u624b\u5c31\u6267\u884c\uff0c\u800c\u5176\u4ed6\u6ca1\u6709\u62a2\u5230\u7684\u7ebf\u7a0b\u5219\u7ee7\u7eed\u6302\u8d77\uff0c\u7b49\u5f85\u4e0b\u4e00\u6b21\u7684\u5524\u9192\u3002</p> <p>\u7ebf\u7a0b\u6c60\u4e2d\u7ebf\u7a0b\u7684\u8fd0\u884c\u72b6\u6001\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u672c\u8d28\u4e0a\uff0c\u7ebf\u7a0b\u6c60\u8fd8\u662f\u901a\u8fc7 notify \u65b9\u6cd5\u6765\u5524\u9192\u7ebf\u7a0b\uff0c\u4ece\u800c\u5b9e\u73b0\u4efb\u52a1\u5206\u53d1\u548c\u8c03\u5ea6\u7684\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u5177\u6709\u4e00\u5b9a\u7684\u968f\u673a\u6027\uff0c\u4e0d\u80fd\u786e\u4fdd\u5230\u5e95\u5524\u9192\u4e86\u54ea\u4e2a\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u9700\u8981\u5b9a\u5236\u76f8\u5173\u7684\u8c03\u5ea6\u903b\u8f91\uff0c\u6bd4\u5982\u53ea\u5524\u9192\u67d0\u4e9b\u5177\u6709\u5171\u540c\u5c5e\u6027\u7684\u7ebf\u7a0b\uff0c\u6216\u8005\u6839\u636e Task \u4efb\u52a1\u7684\u8981\u6c42\u6765\u5524\u9192\u6307\u5b9a\u7ebf\u7a0b\uff0c\u66f4\u53ef\u4ee5\u4e0d\u901a\u8fc7 notify \u7684\u65b9\u5f0f\uff0c\u76f4\u63a5\u628a\u4efb\u52a1\u6d3e\u53d1\u7ed9\u5bf9\u5e94\u7684\u7ebf\u7a0b\u53bb\u6267\u884c\u3002</p> <p>\u6839\u636e\u4e0a\u8ff0\u6d41\u7a0b\u56fe\u5c31\u53ef\u4ee5\u7ed9\u51fa\u5de5\u4f5c\u7ebf\u7a0b\u8fd0\u884c\u7684\u4ee3\u7801\u4e86\uff1a</p> <pre><code>class WorkerThread {\nprivate:\n    int m_id;\n    ThreadPool *m_pool;\npublic:\n    WorkerThread(ThreadPool *pool, int id) : m_pool(pool), m_id(id) {\n\n    }\n\n    void operator()() {\n        task func;\n        bool dequeued;\n        while (!m_pool-&gt;m_shutdown) {\n            std::unique_lock&lt;std::mutex&gt; lock(m_pool-&gt;m_mutex);\n            if (m_pool-&gt;m_queue.empty()){\n                m_pool-&gt;m_condition_variable.wait(lock);\n            }\n            dequeued = m_pool-&gt;m_queue.dequeue(func);\n            if (dequeued) {\n                func();\n            }\n        }\n    }\n};\n</code></pre> <p>\u4e0b\u9762\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u7ebf\u7a0b\u6c60\u4ee3\u7801\u5b9e\u8df5\uff1a</p> <pre><code>#ifndef THREAD_POOL_THREADPOOL_H\n#define THREAD_POOL_THREADPOOL_H\n\n#include &lt;functional&gt;\n#include &lt;future&gt;\n#include &lt;mutex&gt;\n#include &lt;condition_variable&gt;\n#include &lt;thread&gt;\n#include &lt;queue&gt;\n#include \"SafeQueue.h\"\n\nusing task = std::function&lt;void()&gt;;\n\nclass ThreadPool {\npublic:\n    ThreadPool(size_t thread_num = std::thread::hardware_concurrency()) : m_threads(\n            std::vector&lt;std::thread&gt;(thread_num)), m_shutdown(false) {\n    }\n\n    void init() {\n        for (int i = 0; i &lt; m_threads.size(); ++i) {\n            m_threads[i] = std::thread(WorkerThread(this, i));\n        }\n    }\n\n    void shutdown() {\n        m_shutdown = true;\n        m_condition_variable.notify_all();\n        for (int i = 0; i &lt; m_threads.size(); ++i) {\n            if (m_threads[i].joinable()) {\n                m_threads[i].join();\n            }\n        }\n    }\n\n\n    std::future&lt;void&gt; submit(task t){\n        auto p_task = std::make_shared&lt;std::packaged_task&lt;void()&gt;&gt;(t);\n        task wrapper_task = [p_task](){\n             (*p_task)();\n        };\n        m_queue.enqueue(wrapper_task);\n        m_condition_variable.notify_one();\n        return p_task-&gt;get_future();\n    }\n\nprivate:\n    class WorkerThread {\n    private:\n        int m_id;\n        ThreadPool *m_pool;\n    public:\n        WorkerThread(ThreadPool *pool, int id) : m_pool(pool), m_id(id) {\n\n        }\n\n        void operator()() {\n            task func;\n            bool dequeued;\n            while (!m_pool-&gt;m_shutdown) {\n                std::unique_lock&lt;std::mutex&gt; lock(m_pool-&gt;m_mutex);\n                if (m_pool-&gt;m_queue.empty()){\n                    m_pool-&gt;m_condition_variable.wait(lock);\n                }\n                dequeued = m_pool-&gt;m_queue.dequeue(func);\n                if (dequeued) {\n                    func();\n                }\n            }\n        }\n    };\n\n    bool m_shutdown;\n    SafeQueue&lt;task&gt; m_queue;\n    std::vector&lt;std::thread&gt; m_threads;\n    std::mutex m_mutex;\n    std::condition_variable m_condition_variable;\n\n};\n\n#endif //THREAD_POOL_THREADPOOL_H\n</code></pre> <p>\u901a\u8fc7 submit  \u65b9\u6cd5\u63d0\u4ea4\u4efb\u52a1\u5230\u5168\u5c40\u7f13\u5b58\u961f\u5217\u4e2d\uff0c\u7136\u540e\u5524\u9192\u7ebf\u7a0b\u53bb\u6d88\u8d39\u4efb\u52a1\u6267\u884c\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-multi-thread/#_10","title":"\u5c0f\u7ed3","text":"<p>\u5173\u4e8e C++ \u591a\u7ebf\u7a0b\u7684\u4f7f\u7528\u8fd8\u6709\u5f88\u591a\u77e5\u8bc6\u70b9\uff0c\u4ee5\u4e0a\u53ea\u662f\u4ecb\u7ecd\u4e86\u90e8\u5206\u5185\u5bb9\uff0c\u8fd8\u6709\u5f88\u591a\u4e0d\u8db3\u4e4b\u5904\uff0c\u540e\u7eed\u518d\u8865\u5145\u4e86\u3002</p>","tags":["C++","\u591a\u7ebf\u7a0b"]},{"location":"code/c%2B%2B-stl-container-overview/","title":"C++ \u6807\u51c6\u5bb9\u5668\u5e93\u5c0f\u7ed3","text":"<p>\u300aC++ Primer\u300b \u7b2c\u4e94\u7248\u7b14\u8bb0\u6458\u5f55<sub>~</sub></p> <p>C++ \u5bb9\u5668\u7684\u79cd\u7c7b\u5982\u4e0b\uff1a</p> <ul> <li>\u987a\u5e8f\u5bb9\u5668<ul> <li>vector</li> <li>list</li> <li>deque</li> </ul> </li> <li>\u5173\u8054\u5bb9\u5668<ul> <li>map</li> <li>set</li> <li>multimap</li> <li>multiset</li> </ul> </li> <li>\u5bb9\u5668\u9002\u914d\u5668<ul> <li>stack</li> <li>queue</li> <li>priority_queue</li> </ul> </li> </ul>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_1","title":"\u987a\u5e8f\u5bb9\u5668","text":"<p>\u987a\u5e8f\u5bb9\u5668\u63d0\u4f9b\u4e86\u63a7\u5236\u5143\u7d20\u5b58\u50a8\u548c\u8bbf\u95ee\u987a\u5e8f\u7684\u80fd\u529b\uff0c\u8fd9\u79cd\u987a\u5e8f\u4e0d\u4f9d\u8d56\u4e8e\u5143\u7d20\u7684\u503c\uff0c\u800c\u662f\u4e0e\u5143\u7d20\u52a0\u5165\u5bb9\u5668\u7684\u4f4d\u7f6e\u76f8\u5bf9\u5e94\u3002</p> <p>\u4ee5\u4e0b\u8868\u683c\u662f\u6807\u51c6\u5e93\u4e2d\u7684\u987a\u5e8f\u5bb9\u5668\uff0c\u5b83\u4eec\u90fd\u63d0\u4f9b\u5feb\u901f\u987a\u5e8f\u8bbf\u95ee\u5143\u7d20\u7684\u80fd\u529b\uff0c\u4f46\u662f\u8fd9\u4e9b\u5bb9\u5668\u5728\u4ee5\u4e0b\u65b9\u9762\u6709\u4e0d\u540c\u7684\u6027\u80fd\u8fd9\u79cd\uff1a</p> <ul> <li>\u5411\u5bb9\u5668\u6dfb\u52a0\u6216\u4ece\u5bb9\u5668\u4e2d\u5220\u9664\u5143\u7d20\u7684\u4ee3\u4ef7</li> <li>\u975e\u987a\u5e8f\u8bbf\u95ee\u5bb9\u5668\u4e2d\u5143\u7d20\u7684\u4ee3\u4ef7</li> </ul> \u5bb9\u5668\u7c7b\u578b \u4ecb\u7ecd vector \u53ef\u53d8\u5927\u5c0f\u6570\u7ec4\u3002\u652f\u6301\u5feb\u901f\u968f\u673a\u8bbf\u95ee\u3002\u5728\u5c3e\u90e8\u4e4b\u5916\u7684\u4f4d\u7f6e\u63d2\u5165\u6216\u5220\u9664\u5143\u7d20\u53ef\u80fd\u5f88\u6162 deque \u53cc\u7aef\u961f\u5217\u3002\u652f\u6301\u5feb\u901f\u968f\u673a\u8bbf\u95ee\u3002\u5728\u5934\u5c3e\u4f4d\u7f6e\u63d2\u5165/\u5220\u9664\u901f\u5ea6\u5f88\u5feb list \u53cc\u5411\u94fe\u8868\u3002\u53ea\u652f\u6301\u53cc\u5411\u987a\u5e8f\u8bbf\u95ee\u3002\u5728 list \u4e2d\u4efb\u4f55\u4f4d\u7f6e\u8fdb\u884c\u63d2\u5165/\u5220\u9664\u64cd\u4f5c\u901f\u5ea6\u90fd\u5f88\u5feb forward_list \u5355\u5411\u94fe\u8868\u3002\u53ea\u652f\u6301\u5355\u5411\u987a\u5e8f\u8bbf\u95ee\u3002\u5728\u94fe\u8868\u4efb\u4f55\u4f4d\u7f6e\u8fdb\u884c\u63d2\u5165/\u5220\u9664\u64cd\u4f5c\u901f\u5ea6\u90fd\u5f88\u5feb array \u56fa\u5b9a\u6570\u7ec4\u5927\u5c0f\u3002\u652f\u6301\u5feb\u901f\u968f\u673a\u8bbf\u95ee\u3002\u4e0d\u80fd\u6dfb\u52a0\u6216\u5220\u9664\u5143\u7d20 string \u4e0e vector \u76f8\u4f3c\u7684\u5bb9\u5668\uff0c\u4f46\u4e13\u95e8\u7528\u4e8e\u4fdd\u5b58\u5b57\u7b26\u3002\u968f\u673a\u8bbf\u95ee\u5feb\u3002\u5728\u5c3e\u90e8\u63d2\u5165/\u5220\u9664\u901f\u5ea6\u5feb <p>\u6240\u6709\u5bb9\u5668\u6709\u4e00\u4e9b\u5171\u6709\u7684\u64cd\u4f5c\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_2","title":"\u987a\u5e8f\u5bb9\u5668\u64cd\u4f5c","text":"<p>\u987a\u5e8f\u5bb9\u5668\u51e0\u4e4e\u53ef\u4ee5\u4fdd\u5b58\u4efb\u610f\u7c7b\u578b\u7684\u5143\u7d20\uff0c\u7279\u522b\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u5bb9\u5668\uff0c\u5176\u5143\u7d20\u7684\u7c7b\u578b\u662f\u53e6\u4e00\u4e2a\u5bb9\u5668\u3002</p> <pre><code>vector&lt;vector&lt;string&gt;&gt; lines ; // vector \u7684 vector\n</code></pre>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_3","title":"\u5bb9\u5668\u7684\u4e00\u4e9b\u901a\u7528\u64cd\u4f5c","text":"","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_4","title":"\u5bb9\u5668\u5b9a\u4e49\u548c\u521d\u59cb\u5316","text":"<p>\u6bcf\u4e2a\u5bb9\u5668\u7c7b\u578b\u90fd\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u3002\u9664 array \u4e4b\u5916\uff0c\u5176\u4ed6\u5bb9\u5668\u7684\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u6307\u5b9a\u7c7b\u578b\u7684\u7a7a\u5bb9\u5668\uff0c\u4e14\u90fd\u53ef\u4ee5\u63a5\u53d7\u6307\u5b9a\u5bb9\u5668\u5927\u5c0f\u548c\u5143\u7d20\u521d\u59cb\u503c\u7684\u53c2\u6570\u3002</p> <p>\u5bb9\u5668\u5b9a\u4e49\u548c\u521d\u59cb\u5316\u65b9\u6cd5\u89c1\u4e0b\u56fe\uff1a</p> <p></p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_5","title":"\u5c06\u4e00\u4e2a\u5bb9\u5668\u521d\u59cb\u5316\u4e3a\u53e6\u4e00\u4e2a\u5bb9\u5668\u7684\u62f7\u8d1d","text":"<p>\u5c06\u4e00\u4e2a\u5bb9\u5668\u521b\u5efa\u4e3a\u53e6\u4e00\u4e2a\u5bb9\u5668\u7684\u62f7\u8d1d\u7684\u65b9\u6cd5\u6709\u4e24\u79cd\uff1a</p> <ol> <li>\u53ef\u4ee5\u76f4\u63a5\u62f7\u8d1d\u6574\u4e2a\u5bb9\u5668\u3002</li> <li>\u62f7\u8d1d\u7531\u4e00\u4e2a\u8fed\u4ee3\u5668\u5bf9\u6307\u5b9a\u7684\u5143\u7d20\u8303\u56f4\uff08\u9664 array \u5916\uff09\u3002</li> </ol> <pre><code>    list&lt;string&gt; authors = {\"milton\", \"shake\", \"audio\"};\n    list&lt;string&gt; list2(authors);\n    cout &lt;&lt; *list2.begin() &lt;&lt; endl;\n\n    vector&lt;const char *&gt; articles = {\"a\", \"an\", \"use\"};\n    forward_list&lt;string&gt; word(articles.begin(), articles.end());\n    cout &lt;&lt; *word.begin() &lt;&lt; endl;\n</code></pre> <p>\u5f53\u5c06\u4e00\u4e2a\u5bb9\u5668\u521d\u59cb\u5316\u4e3a\u53e6\u4e00\u4e2a\u5bb9\u5668\u7684\u62f7\u8d1d\u65f6\uff0c\u4e24\u4e2a\u5bb9\u5668\u7684\u5bb9\u5668\u7c7b\u578b\u548c\u5143\u7d20\u7c7b\u578b\u90fd\u5fc5\u987b\u76f8\u540c\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5f53\u4f20\u9012\u8fed\u4ee3\u5668\u53c2\u6570\u6765\u62f7\u8d1d\u4e00\u4e2a\u8303\u56f4\u65f6\uff0c\u5c31\u4e0d\u8981\u6c42\u5bb9\u5668\u7c7b\u578b\u662f\u76f8\u540c\u7684\u4e86\uff0c\u800c\u4e14\uff0c\u65b0\u5bb9\u5668\u548c\u539f\u5bb9\u5668\u7684\u5143\u7d20\u7c7b\u578b\u4e5f\u53ef\u4ee5\u4e0d\u540c\uff0c\u53ea\u8981\u80fd\u5c06\u8981\u62f7\u8d1d\u7684\u5143\u7d20\u8f6c\u6362\u4e3a\u8981\u521d\u59cb\u5316\u7684\u5bb9\u5668\u7684\u5143\u7d20\u7c7b\u578b\u5373\u53ef\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_6","title":"\u8fed\u4ee3\u5668","text":"<p>\u6240\u6709\u6807\u51c6\u5e93\u5bb9\u5668\u90fd\u53ef\u4ee5\u4f7f\u7528\u8fed\u4ee3\u5668\uff0c\u4f46\u662f\u5176\u4e2d\u53ea\u6709\u5c11\u6570\u51e0\u79cd\u624d\u540c\u65f6\u652f\u6301\u4e0b\u6807\u8fd0\u7b97\u7b26\u3002</p> <p>\u548c\u6307\u9488\u7c7b\u4f3c\uff0c\u8fed\u4ee3\u5668\u4e5f\u63d0\u4f9b\u4e86\u5bf9\u5bf9\u8c61\u7684\u95f4\u63a5\u8bbf\u95ee\u3002\u5c31\u8fed\u4ee3\u5668\u800c\u8a00\uff0c\u5176\u5bf9\u8c61\u662f\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u6216\u8005 string \u5bf9\u8c61\u4e2d\u7684\u5b57\u7b26\u3002\u4f7f\u7528\u8fed\u4ee3\u5668\u53ef\u4ee5\u8bbf\u95ee\u67d0\u4e2a\u5143\u7d20\uff0c\u8fed\u4ee3\u5668\u4e5f\u80fd\u4ece\u4e00\u4e2a\u5143\u7d20\u79fb\u52a8\u5230\u53e6\u5916\u4e00\u4e2a\u5143\u7d20\u3002</p> <p>\u8fed\u4ee3\u5668\u6709\u6709\u6548\u548c\u65e0\u6548\u4e4b\u5206\uff0c\u8fd9\u4e00\u70b9\u548c\u6307\u9488\u5dee\u4e0d\u591a\u3002\u6709\u6548\u7684\u8fed\u4ee3\u5668\u6216\u8005\u6307\u5411\u67d0\u4e2a\u5143\u7d20\uff0c\u6216\u8005\u6307\u5411\u5bb9\u5668\u4e2d\u5c3e\u5143\u7d20\u7684\u4e0b\u4e00\u4f4d\u7f6e\uff1a\u5176\u4ed6\u6240\u6709\u60c5\u51b5\u90fd\u5c5e\u4e8e\u65e0\u6548\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_7","title":"\u8fed\u4ee3\u5668\u7684\u4f7f\u7528","text":"<p>\u83b7\u53d6\u8fed\u4ee3\u5668\u4e0d\u662f\u4f7f\u7528\u53d6\u5730\u5740\u7b26\uff0c\u6709\u8fed\u4ee3\u5668\u7684\u7c7b\u578b\u540c\u65f6\u62e5\u6709\u8fd4\u56de\u8fed\u4ee3\u5668\u7684\u6210\u5458\u3002</p> <p>\u6bd4\u5982\uff0c\u8fd9\u4e9b\u7c7b\u578b\u90fd\u62e5\u6709\u540d\u4e3a <code>begin</code> \u548c <code>end</code> \u7684\u6210\u5458\uff0c\u5176\u4e2d begin \u6210\u5458\u8d1f\u8d23\u8fd4\u56de\u6307\u5411\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u8fed\u4ee3\u5668\uff0cend \u6210\u5458\u5219\u8d1f\u8d23\u8fd4\u56de\u6307\u5411\u5bb9\u5668\u5c3e\u5143\u7d20\u7684\u4e0b\u4e00\u4f4d\u7f6e\u7684\u8fed\u4ee3\u5668\uff0c\u5e38\u79f0\u4f5c <code>\u5c3e\u540e\u8fed\u4ee3\u5668</code> \uff0c\u4e5f\u5c31\u662f\u8bf4\u8be5\u8fed\u4ee3\u5668\u6307\u793a\u7684\u662f\u5bb9\u5668\u4e00\u4e2a\u672c\u4e0d\u5b58\u5728\u7684 <code>\u5c3e\u540e\u5143\u7d20</code> \u3002</p> <p>\u7279\u6b8a\u60c5\u51b5\u4e0b\u5982\u679c\u5bb9\u5668\u4e3a\u7a7a\uff0c\u5219 begin \u548c end \u8fd4\u56de\u7684\u5c31\u662f\u540c\u4e00\u4e2a\u8fed\u4ee3\u5668\u3002</p> <pre><code>    string content = \"content\";\n    string::iterator begin = content.begin();\n    auto end = content.end();\n    while (begin != end) {\n        cout &lt;&lt; (*begin) &lt;&lt; endl;\n        begin++;\n    }\n</code></pre>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_8","title":"\u8fed\u4ee3\u5668\u7684\u7c7b\u578b","text":"<p>\u4e00\u822c\u6765\u8bf4\u4e0d\u9700\u8981\u77e5\u9053\u8fed\u4ee3\u5668\u7684\u7cbe\u786e\u7c7b\u578b\uff0c\u800c\u5b9e\u9645\u4e0a\uff0c\u62e5\u6709\u8fed\u4ee3\u5668\u7684\u6807\u51c6\u5e93\u7c7b\u578b\u4f7f\u7528 <code>iterator</code> \u548c <code>const_iterator</code> \u6765\u8868\u793a\u8fed\u4ee3\u5668\u7684\u7c7b\u578b\u3002</p> <pre><code>    vector&lt;int&gt;::iterator it ;    // it \u80fd\u8bfb\u5199 vector&lt;int&gt; \u7684\u5143\u7d20\n    string::iterator it2 ;        // it2 \u80fd\u8bfb\u5199 string \u5bf9\u8c61\u4e2d\u7684\u5b57\u7b26\n\n    vector&lt;int&gt;::const_iterator it3;   // it3 \u53ea\u80fd\u8bfb\u5143\u7d20\uff0c\u4e0d\u80fd\u5199\u5143\u7d20\n    string::const_iterator it4;        // it4 \u53ea\u80fd\u8bfb\u5b57\u7b26\uff0c\u4e0d\u80fd\u5199\u5b57\u7b26\n</code></pre> <p>begin \u548c end \u8fd4\u56de\u7684\u5177\u4f53\u7c7b\u578b\u7531\u5bf9\u8c61\u662f\u5426\u662f\u5e38\u91cf\u51b3\u5b9a\uff0c\u5982\u679c\u5bf9\u8c61\u662f\u5e38\u91cf\uff0c\u8fd4\u56de\u7684\u662f const_iterator \uff0c\u5982\u679c\u5bf9\u8c61\u4e0d\u662f\u5e38\u91cf\uff0c\u8fd4\u56de\u7684\u662f iterator \u3002</p> <p>\u5982\u679c\u5bf9\u8c61\u53ea\u9700\u8bfb\u64cd\u4f5c\uff0c\u65e0\u9700\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fed\u4ee3\u5668\u6700\u597d\u4f7f\u7528\u5e38\u91cf\u7c7b\u578b\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u4e13\u95e8\u5f97\u5230 const_iterator \u7c7b\u578b\u7684\u8fd4\u56de\u503c\uff0cC++ 11 \u65b0\u6807\u51c6\u5f15\u5165\u4e86\u4e24\u4e2a\u65b0\u51fd\u6570\uff0c\u5206\u522b\u662f <code>cbegin</code> \u548c <code>cend</code> \u3002</p> <p>\u7c7b\u4f3c\u4e8e begin \u548c end \uff0c\u4e0a\u8ff0\u4e24\u4e2a\u65b0\u51fd\u6570\u4e5f\u5206\u522b\u8fd4\u56de\u6307\u793a\u5bb9\u5668\u7b2c\u4e00\u4e2a\u5143\u7d20\u6216\u6700\u540e\u5143\u7d20\u4e0b\u4e00\u4f4d\u7f6e\u7684\u8fed\u4ee3\u5668\uff0c\u6709\u6240\u4e0d\u540c\u7684\u662f\uff0c\u4e0d\u8bba vector \u5bf9\u8c61\uff08\u6216 string \u5bf9\u8c61\uff09\u672c\u8eab\u662f\u5426\u662f\u5e38\u91cf\uff0c\u8fd4\u56de\u503c\u90fd\u662f const_iterator \u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_9","title":"\u8fed\u4ee3\u5668\u89e3\u5f15\u7528\u548c\u6210\u5458\u8bbf\u95ee\u64cd\u4f5c","text":"<p>\u89e3\u5f15\u7528\u8fed\u4ee3\u5668\u53ef\u4ee5\u83b7\u5f97\u8fed\u4ee3\u5668\u6240\u6307\u7684\u5bf9\u8c61\uff0c\u5982\u679c\u8be5\u5bf9\u8c61\u7684\u7c7b\u578b\u6070\u597d\u662f\u7c7b\uff0c\u5c31\u6709\u53ef\u80fd\u5e0c\u671b\u8fdb\u4e00\u6b65\u8bbf\u95ee\u5b83\u7684\u6210\u5458\u3002</p> <pre><code>    vector&lt;string&gt; strings(3, \"content\");\n    auto it = strings.begin();\n    // \u8fed\u4ee3\u5668\u89e3\u5f15\u7528\n    cout &lt;&lt; *it &lt;&lt; endl;\n    // \u8fed\u4ee3\u5668\u89e3\u5f15\u7528\u4e4b\u540e\u8bbf\u95ee\u6210\u5458\n    cout &lt;&lt; (*it).empty() &lt;&lt; endl;\n    // \u901a\u8fc7\u7bad\u5934\u8fd0\u7b97\u7b26 -&gt; \u628a\u89e3\u5f15\u7528\u548c\u6210\u5458\u8bbf\u95ee\u7ed3\u5408\u5728\u4e00\u8d77\n    cout &lt;&lt; it-&gt;empty() &lt;&lt; endl;\n</code></pre> <p>C++ \u8bed\u8a00\u5b9a\u4e49\u4e86\u7bad\u5934\u8fd0\u7b97\u7b26 <code>-&gt;</code> \uff0c\u80fd\u591f\u628a\u89e3\u5f15\u7528\u548c\u6210\u5458\u8bbf\u95ee\u4e24\u4e2a\u64cd\u4f5c\u7ed3\u5408\u5728\u4e00\u8d77\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_10","title":"\u987a\u5e8f\u5bb9\u5668\u6dfb\u52a0\u548c\u5220\u9664\u5143\u7d20","text":"<p>\u9664\u4e86 array \u56fa\u5b9a\u5927\u5c0f\u4e4b\u5916\uff0c\u6240\u6709\u6807\u51c6\u5bb9\u5668\u5e93\u90fd\u63d0\u4f9b\u7075\u6d3b\u7684\u5185\u5b58\u7ba1\u7406\u3002\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u52a8\u6001\u6dfb\u52a0\u6216\u5220\u9664\u5143\u7d20\u6765\u6539\u53d8\u5bb9\u5668\u5927\u5c0f\u3002</p> <p>\u4ee5\u4e0b\u662f\u5411\u987a\u5e8f\u5bb9\u5668\u4e2d\u6dfb\u52a0\u5143\u7d20\u7684\u64cd\u4f5c\u3002</p> <p></p> <p>\u5f53\u4f7f\u7528\u5982\u4e0a\u7684\u64cd\u4f5c\u65f6\uff0c\u5fc5\u987b\u8bb0\u5f97\u4e0d\u540c\u5bb9\u5668\u4f7f\u7528\u4e0d\u540c\u7684\u7b56\u7565\u6765\u5206\u914d\u5143\u7d20\u7a7a\u95f4\uff0c\u8fd9\u4e9b\u7b56\u7565\u76f4\u63a5\u5f71\u54cd\u6027\u80fd\u3002</p> <p>\u6dfb\u52a0\u4e3b\u8981\u64cd\u4f5c\u51fd\u6570\u6709\u5982\u4e0b\uff1a</p> <ul> <li>push_back<ul> <li>\u5c06\u4e00\u4e2a\u5143\u7d20\u8ffd\u52a0\u5230\u5bb9\u5668\u7684\u5c3e\u90e8\uff0c\u9664\u4e86 array \u548c forward_list \u4e4b\u5916\uff0c\u6bcf\u4e2a\u987a\u5e8f\u5bb9\u5668\u90fd\u652f\u6301\u3002</li> </ul> </li> <li>push_front<ul> <li>\u5c06\u5143\u7d20\u63d2\u5165\u5230\u5bb9\u5668\u5934\u90e8\uff0c\u9664\u4e86 push_back\uff0clist\u3001forward_list \u548c deque \u5bb9\u5668\u8fd8\u652f\u6301 push_front \u64cd\u4f5c\u3002</li> </ul> </li> <li>insert<ul> <li>\u5728\u5bb9\u5668\u4e2d\u4efb\u610f\u4f4d\u7f6e\u63d2\u5165 0 \u4e2a\u6216\u591a\u4e2a\u5143\u7d20\uff0cvector\u3001deque\u3001list \u548c string \u90fd\u652f\u6301 insert \u64cd\u4f5c\u3002</li> <li>forward_list \u63d0\u4f9b\u4e86\u7279\u6b8a\u7248\u672c\u7684 insert \u6210\u5458\u3002</li> <li>\u6bcf\u4e2a insert \u51fd\u6570\u90fd\u63a5\u53d7\u4e00\u4e2a\u8fed\u4ee3\u5668\u4f5c\u4e3a\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u8fed\u4ee3\u5668\u6307\u51fa\u4e86\u5728\u5bb9\u5668\u4e2d\u4ec0\u4e48\u4f4d\u7f6e\u653e\u7f6e\u65b0\u5143\u7d20\u3002</li> <li>insert \u51fd\u6570\u5c06\u5143\u7d20\u63d2\u5165\u5230\u8fed\u4ee3\u5668\u6240\u6307\u5b9a\u7684\u4f4d\u7f6e\u4e4b\u524d\u3002</li> </ul> </li> <li>emplace<ul> <li>C++ \u65b0\u6807\u51c6\u5f15\u5165\u4e86\u4e09\u4e2a\u65b0\u6210\u5458\uff0cemplace_front\u3001emplace \u548c emplace_back\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u6784\u9020\u800c\u4e0d\u662f\u62f7\u8d1d\u5143\u7d20\u3002\u8fd9\u4e9b\u64cd\u4f5c\u5206\u522b\u5bf9\u5e94\u4e8e push_front\u3001insert \u548c push_back \uff0c\u5141\u8bb8\u6211\u4eec\u5c06\u5143\u7d20\u653e\u7f6e\u5728\u5bb9\u5668\u5934\u90e8\u3001\u4e00\u4e2a\u6307\u5b9a\u4f4d\u7f6e\u4e4b\u524d\u6216\u8005\u5bb9\u5668\u5c3e\u90e8\u3002</li> <li>\u5f53\u8c03\u7528 push \u6216 insert \u6210\u5458\u51fd\u6570\u65f6\uff0c\u6211\u4eec\u5c06\u5143\u7d20\u7c7b\u578b\u7684\u5bf9\u8c61\u4f20\u9012\u7ed9\u5b83\u4eec\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u88ab\u62f7\u8d1d\u5230\u5bb9\u5668\u4e2d\u3002</li> <li>\u800c\u5f53\u6211\u4eec\u8c03\u7528\u4e00\u4e2a emplace \u6210\u5458\u51fd\u6570\u65f6\uff0c\u5219\u662f\u5c06\u53c2\u6570\u4f20\u9012\u7ed9\u5143\u7d20\u7c7b\u578b\u7684\u6784\u9020\u51fd\u6570\uff0cemplace \u6210\u5458\u4f7f\u7528\u8fd9\u4e9b\u53c2\u6570\u5728\u5bb9\u5668\u7ba1\u7406\u7684\u5185\u5b58\u7a7a\u95f4\u76f4\u63a5\u6784\u9020\u5143\u7d20\u3002</li> </ul> </li> </ul> <p>\u5220\u9664\u4e3b\u8981\u64cd\u4f5c\u51fd\u6570\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>pop_front \u548c pop_back<ul> <li>pop_front \u548c pop_back \u6210\u5458\u51fd\u6570\u5206\u522b\u5220\u9664\u9996\u5143\u7d20\u548c\u5c3e\u5143\u7d20\u3002</li> <li>\u4e0e vector \u548c string \u4e0d\u652f\u6301 push_front \u4e00\u6837\uff0c\u8fd9\u4e9b\u7c7b\u578b\u4e5f\u4e0d\u652f\u6301 pop_front \u3002</li> <li>forward_list \u4e0d\u652f\u6301 pop_back \u3002</li> <li>\u4e0d\u80fd\u5bf9\u4e00\u4e2a\u7a7a\u5bb9\u5668\u6267\u884c\u5f39\u51fa\u64cd\u4f5c\u3002</li> </ul> </li> <li>erase<ul> <li>\u4ece\u5bb9\u5668\u6307\u5b9a\u4f4d\u7f6e\u5220\u9664\u5143\u7d20\u3002</li> <li>\u53ef\u4ee5\u5220\u9664\u7531\u4e00\u4e2a\u8fed\u4ee3\u5668\u6307\u5b9a\u7684\u5355\u4e2a\u5143\u7d20\uff0c\u4e5f\u53ef\u4ee5\u5220\u9664\u7531\u4e00\u5bf9\u8fed\u4ee3\u5668\u6307\u5b9a\u7684\u8303\u56f4\u5185\u7684\u6240\u6709\u5143\u7d20\u3002</li> <li>\u4e24\u79cd\u5f62\u5f0f\u7684 erase \u90fd\u8fd4\u56de\u6307\u5411\u5220\u9664\u7684\uff08\u6700\u540e\u4e00\u4e2a\uff09\u5143\u7d20\u4e4b\u540e\u4f4d\u7f6e\u7684\u8fed\u4ee3\u5668\u3002</li> <li>\u63a5\u53d7\u4e00\u5bf9\u8fed\u4ee3\u5668\u7684 erase \u8fd0\u884c\u5220\u9664\u4e00\u4e2a\u8303\u56f4\u5185\u7684\u5143\u7d20\u3002</li> </ul> </li> </ul> <p>\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>    vector&lt;string&gt; str(5, \"content\");\n    // \u6dfb\u52a0\u5c3e\u5143\u7d20\n    str.push_back(\"push_back\");\n    // \u901a\u8fc7\u6784\u9020\u51fd\u6570\u6dfb\u52a0\u5c3e\u5143\u7d20\n    str.emplace_back(\"emplace\");\n    // \u63d2\u5165\u5143\u7d20\n    str.insert(str.cbegin(), \"insert\");\n\n    auto begin = str.cbegin();\n    auto end = str.cend();\n    while (begin != end) {\n        cout &lt;&lt; *begin &lt;&lt; endl;\n        begin++;\n    }\n\n    cout &lt;&lt; endl &lt;&lt; \"delete\" &lt;&lt; endl;\n\n    // \u5220\u9664\u5c3e\u5143\u7d20\n    str.pop_back();\n    // \u901a\u8fc7\u8fed\u4ee3\u5668\u5220\u9664\u5355\u4e2a\u5143\u7d20\n    str.erase(str.cbegin());\n    // \u901a\u8fc7\u8fed\u4ee3\u5668\u5220\u9664\u591a\u4e2a\u5143\u7d20\n    str.erase(str.cbegin() + 1, str.cend() - 1);\n\n    auto del_begin = str.cbegin();\n    auto del_end = str.end();\n    while (del_begin != del_end) {\n        cout &lt;&lt; *del_begin &lt;&lt; endl;\n        del_begin++;\n    }\n</code></pre>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_11","title":"\u5bb9\u5668\u9002\u914d\u5668","text":"<p>\u9664\u4e86\u987a\u5e8f\u5bb9\u5668\u5916\uff0c\u6807\u51c6\u5e93\u8fd8\u5b9a\u4e49\u4e86\u4e09\u4e2a\u987a\u5e8f\u5bb9\u5668\u9002\u914d\u5668\uff1a</p> <ul> <li>stack</li> <li>queue</li> <li>priority_queue</li> </ul> <p>\u9002\u914d\u5668\u662f\u6807\u51c6\u5e93\u4e2d\u7684\u4e00\u4e2a\u901a\u7528\u6982\u5ff5\uff0c\u5bb9\u5668\u3001\u8fed\u4ee3\u5668\u548c\u51fd\u6570\u90fd\u8981\u9002\u914d\u5668\u3002</p> <p>\u672c\u8d28\u4e0a\uff0c\u4e00\u4e2a\u9002\u914d\u5668\u662f\u4e00\u79cd\u673a\u5236\uff0c\u80fd\u4f7f\u67d0\u79cd\u4e8b\u7269\u7684\u884c\u4e3a\u770b\u8d77\u6765\u50cf\u53e6\u5916\u4e00\u79cd\u4e8b\u7269\u4e00\u6837\uff0c\u4e00\u4e2a\u5bb9\u5668\u9002\u914d\u5668\u63a5\u53d7\u4e00\u79cd\u5df2\u6709\u7684\u5bb9\u5668\u7c7b\u578b\uff0c\u4f7f\u5176\u884c\u4e3a\u770b\u8d77\u6765\u50cf\u4e00\u79cd\u4e0d\u540c\u7684\u7c7b\u578b\u3002\u4f8b\u5982\uff0cstack \u9002\u914d\u5668\u63a5\u53d7\u4e00\u4e2a\u987a\u5e8f\u5bb9\u5668\uff08\u9664 array \u6216 forward_list \u5916\uff09\uff0c\u5e76\u4f7f\u5176\u64cd\u4f5c\u8d77\u6765\u50cf\u4e00\u4e2a stack \u4e00\u6837\u3002</p> <p>\u6240\u6709\u5bb9\u5668\u9002\u914d\u5668\u90fd\u652f\u6301\u7684\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <p></p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_12","title":"\u5b9a\u4e49\u9002\u914d\u5668","text":"<p>\u6bcf\u4e2a\u9002\u914d\u5668\u90fd\u5b9a\u4e49\u4e24\u4e2a\u6784\u9020\u51fd\u6570\uff1a\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u7a7a\u5bf9\u8c61\uff0c\u63a5\u53d7\u4e00\u4e2a\u5bb9\u5668\u7684\u6784\u9020\u51fd\u6570\u62f7\u8d1d\u8be5\u51fd\u6570\u6765\u521d\u59cb\u5316\u9002\u914d\u5668\u3002</p> <p>\u4f8b\u5982\uff0c\u5047\u5982 deq \u662f\u4e00\u4e2a deque \uff0c\u53ef\u4ee5\u7528 deq \u6765\u521d\u59cb\u5316\u4e00\u4e2a\u65b0\u7684 stack \u3002 <pre><code>stack&lt;int&gt; stk(deq);    // \u4ece deq \u62f7\u8d1d\u5143\u7d20\u5230 stk\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cstack \u548c queue \u662f\u57fa\u4e8e deque \u5b9e\u73b0\u7684\uff0cpriority_queue \u662f\u5728 vector \u4e4b\u4e0a\u5b9e\u73b0\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u9002\u914d\u5668\u65f6\u5c06\u4e00\u4e2a\u547d\u540d\u7684\u987a\u5e8f\u5bb9\u5668\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u7c7b\u578b\u53c2\u6570\uff0c\u6765\u91cd\u8f7d\u9ed8\u8ba4\u5bb9\u5668\u7c7b\u578b\u3002</p> <pre><code>// \u5728 vector \u4e0a\u5b9e\u73b0\u7684\u7a7a\u6808\nstack&lt;string, vector&lt;string&gt;&gt; str_stk;\n// str_stk2 \u5728 vector \u4e0a\u5b9e\u73b0\uff0c\u521d\u59cb\u5316\u65f6\u4fdd\u5b58 svec \u7684\u62f7\u8d1d\nstack&lt;string, vector&lt;string&gt;&gt; str_stk2(svec);\n</code></pre> <p>\u5bf9\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u7684\u9002\u914d\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9b\u5bb9\u5668\u662f\u6709\u9650\u5236\u7684\u3002\u6240\u6709\u9002\u914d\u5668\u90fd\u8981\u6c42\u5bb9\u5668\u5177\u6709\u6dfb\u52a0\u548c\u5220\u9664\u5143\u7d20\u7684\u80fd\u529b\u3002\u56e0\u6b64\uff0c\u9002\u914d\u5668\u4e0d\u80fd\u6784\u9020\u5728 array \u4e4b\u4e0a\uff0c\u7c7b\u4f3c\u7684\uff0c\u4e5f\u4e0d\u80fd\u7528 forward_list \u6765\u6784\u9020\u9002\u914d\u5668\uff0c\u56e0\u4e3a\u6240\u6709\u9002\u914d\u5668\u90fd\u8981\u6c42\u5bb9\u5668\u5177\u6709\u6dfb\u52a0\u3001\u5220\u9664\u4ee5\u53ca\u8bbf\u95ee\u5c3e\u5143\u7d20\u7684\u80fd\u529b\u3002</p> <p>stack \u53ea\u8981\u6c42 push_back\u3001pop_back \u548c back \u64cd\u4f5c\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u9664 array \u548c forward_list \u4e4b\u5916\u7684\u4efb\u4f55\u5bb9\u5668\u6765\u6784\u9020 stack \u3002</p> <p>queue \u9002\u914d\u5668\u8981\u6c42 back\u3001push_back\u3001front \u548c push_front \uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u6784\u9020\u4e8e list \u6216 queue \u4e4b\u4e0a\uff0c\u4f46\u4e0d\u80fd\u57fa\u4e8e vector \u6784\u9020\u3002</p> <p>priority_queue \u9664\u4e86 front\u3001push_back \u548c pop_back \u64cd\u4f5c\u4e4b\u5916\u8fd8\u8981\u6c42\u968f\u673a\u8bbf\u95ee\u80fd\u529b\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u6784\u9020\u4e8e vector \u6216 queue \u4e4b\u4e0a\uff0c\u4f46\u4e0d\u80fd\u57fa\u4e8e list \u6784\u9020\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_13","title":"\u6808\u9002\u914d\u5668","text":"<p>stack \u7c7b\u578b\u5b9a\u4e49\u5728 stack \u5934\u6587\u4ef6\u4e2d\uff0c\u652f\u6301\u7684\u64cd\u4f5c\u5982\u4e0b\u8868\uff1a</p> <p></p> <p>\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>stack&lt;int&gt; intStack; // \u58f0\u660e\u4e00\u4e2a\u7a7a\u6808\nfor(size_t ix = 0;ix != 10;ix++){\n    intStack.push(ix);\n}\nwhile(!intStack.empty()){\n    int value = intStack.top();\n    intStack.pop();\n}\n</code></pre> <p>\u6bcf\u4e2a\u5bb9\u5668\u9002\u914d\u5668\u90fd\u57fa\u4e8e\u5e95\u5c42\u5bb9\u5668\u7c7b\u578b\u7684\u64cd\u4f5c\u5b9a\u4e49\u4e86\u81ea\u5df1\u7684\u7279\u6b8a\u64cd\u4f5c\u3002\u6211\u4eec\u53ea\u53ef\u4ee5\u4f7f\u7528\u9002\u914d\u5668\u64cd\u4f5c\uff0c\u800c\u4e0d\u80fd\u4f7f\u7528\u5e95\u5c42\u5bb9\u5668\u7c7b\u578b\u7684\u64cd\u4f5c\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_14","title":"\u961f\u5217\u9002\u914d\u5668","text":"<p>queue \u548c priority_queue \u9002\u914d\u5668\u5b9a\u4e49\u5728 queue \u5934\u6587\u4ef6\u4e2d\uff0c\u652f\u6301\u7684\u64cd\u4f5c\u5982\u4e0b\u8868\uff1a</p> <p></p> <p></p> <p>\u6807\u51c6\u5e93 queue \u4f7f\u7528\u5148\u8fdb\u5148\u51fa\u7684\u5b58\u50a8\u548c\u8bbf\u95ee\u7b56\u7565\u3002\u8fdb\u5165\u961f\u5217\u7684\u5bf9\u8c61\u88ab\u653e\u7f6e\u5230\u961f\u5c3e\uff0c\u800c\u79bb\u5f00\u961f\u5217\u7684\u5bf9\u8c61\u4ece\u961f\u9996\u5220\u9664\u3002</p> <p>priority_queue \u5141\u8bb8\u6211\u4eec\u4e3a\u961f\u5217\u4e2d\u7684\u5143\u7d20\u5efa\u7acb\u4f18\u5148\u7ea7\u3002\u65b0\u52a0\u5165\u7684\u5143\u7d20\u4f1a\u6392\u5728\u6240\u6709\u4f18\u5148\u7ea7\u6bd4\u5b83\u4f4e\u7684\u5df2\u6709\u5143\u7d20\u4e4b\u524d\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_15","title":"\u987a\u5e8f\u5bb9\u5668\u5c0f\u7ed3","text":"<p>\u6807\u51c6\u5e93\u5bb9\u5668\u662f\u6a21\u677f\u7c7b\u578b\uff0c\u7528\u6765\u4fdd\u5b58\u7ed9\u5b9a\u7c7b\u578b\u7684\u5bf9\u8c61\u3002\u5728\u4e00\u4e2a\u987a\u5e8f\u5bb9\u5668\u4e2d\uff0c\u5143\u7d20\u662f\u6309\u987a\u5e8f\u5b58\u653e\u7684\uff0c\u901a\u8fc7\u4f4d\u7f6e\u6765\u8bbf\u95ee\u3002\u987a\u5e8f\u5bb9\u5668\u6709\u516c\u5171\u7684\u6807\u51c6\u63a5\u53e3\uff1a\u5982\u679c\u4e24\u4e2a\u987a\u5e8f\u5bb9\u5668\u90fd\u63d0\u4f9b\u4e00\u4e2a\u7279\u5b9a\u7684\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u64cd\u4f5c\u5728\u4e24\u4e2a\u5bb9\u5668\u4e2d\u5177\u6709\u76f8\u540c\u7684\u63a5\u53e3\u548c\u542b\u4e49\u3002</p> <p>\u6240\u6709\u5bb9\u5668\uff08\u9664 array \u5916\uff09\u90fd\u63d0\u4f9b\u9ad8\u6548\u7684\u52a8\u6001\u5185\u5b58\u7ba1\u7406\u3002\u6211\u4eec\u53ef\u4ee5\u5411\u5bb9\u5668\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u800c\u4e0d\u5fc5\u62c5\u5fc3\u5143\u7d20\u5b58\u50a8\u5728\u54ea\u91cc\u3002\u5bb9\u5668\u8d1f\u8d23\u7ba1\u7406\u81ea\u8eab\u7684\u5b58\u50a8\u3002vector \u548c string \u90fd\u63d0\u4f9b\u66f4\u7ec6\u81f4\u7684\u5185\u5b58\u7ba1\u7406\u63a7\u5236\uff0c\u8fd9\u662f\u901a\u8fc7\u5b83\u4eec\u7684 reserve \u548c capacity \u6210\u5458\u51fd\u6570\u6765\u5b9e\u73b0\u7684\u3002</p> <p>\u5f88\u5927\u7a0b\u5ea6\u4e0a\uff0c\u5bb9\u5668\u53ea\u5b9a\u4e49\u4e86\u6781\u5c11\u7684\u64cd\u4f5c\u3002\u6bcf\u4e2a\u5bb9\u5668\u90fd\u5b9a\u4e49\u4e86\u6784\u9020\u51fd\u6570\u3001\u6dfb\u52a0\u548c\u5220\u9664\u5143\u7d20\u7684\u64cd\u4f5c\u3001\u786e\u5b9a\u5bb9\u5668\u5927\u5c0f\u7684\u64cd\u4f5c\u4ee5\u53ca\u8fd4\u56de\u7279\u5b9a\u5143\u7d20\u8fed\u4ee3\u5668\u7684\u64cd\u4f5c\u3002\u5176\u4ed6\u4e00\u4e9b\u6709\u7528\u7684\u64cd\u4f5c\uff0c\u5982\u6392\u5e8f\u6216\u641c\u7d22\uff0c\u5e76\u4e0d\u662f\u7531\u5bb9\u5668\u7c7b\u578b\u5b9a\u4e49\u7684\uff0c\u800c\u662f\u7531\u6807\u51c6\u5e93\u7b97\u6cd5\u5b9e\u73b0\u7684\u3002</p> <p>\u5f53\u4f7f\u7528\u6dfb\u52a0\u6216\u5220\u9664\u5143\u7d20\u7684\u5bb9\u5668\u64cd\u4f5c\u65f6\uff0c\u5fc5\u987b\u6ce8\u610f\u8fd9\u4e9b\u64cd\u4f5c\u53ef\u80fd\u4f7f\u6307\u5411\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u7684\u8fed\u4ee3\u5668\u3001\u6307\u9488\u6216\u5f15\u7528\u5931\u6548\u3002\u5f88\u591a\u4f1a\u4f7f\u8fed\u4ee3\u5668\u5931\u6548\u7684\u64cd\u4f5c\uff0c\u5982 insert \u548c erase \uff0c\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u8fed\u4ee3\u5668\uff0c\u6765\u5e2e\u52a9\u7a0b\u5e8f\u5458\u7ef4\u62a4\u5bb9\u5668\u4e2d\u7684\u4f4d\u7f6e\u3002\u5982\u679c\u5faa\u73af\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u4e86\u6539\u53d8\u5bb9\u5668\u5927\u5c0f\u7684\u64cd\u4f5c\uff0c\u5c31\u8981\u5c24\u5176\u5c0f\u5fc3\u5176\u4e2d\u8fed\u4ee3\u5668\u3001\u6307\u9488\u548c\u5f15\u7528\u7684\u4f7f\u7528\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_16","title":"\u5173\u8054\u5bb9\u5668","text":"<p>\u5173\u8054\u5bb9\u5668\u548c\u987a\u5e8f\u5bb9\u5668\u6709\u7740\u6839\u672c\u7684\u4e0d\u540c\uff1a\u5173\u8054\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u662f\u6309\u5173\u952e\u5b57\u6765\u4fdd\u5b58\u548c\u8bbf\u95ee\u7684\uff0c\u4e0e\u4e4b\u76f8\u5bf9\uff0c\u987a\u5e8f\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u662f\u6309\u5b83\u4eec\u5728\u5bb9\u5668\u4e2d\u7684\u4f4d\u7f6e\u6765\u987a\u5e8f\u4fdd\u5b58\u548c\u8bbf\u95ee\u7684\u3002</p> <p>\u5173\u8054\u5bb9\u5668\u652f\u6301\u9ad8\u6548\u7684\u5173\u952e\u5b57\u67e5\u627e\u548c\u8bbf\u95ee\uff0c\u4e24\u4e2a\u4e3b\u8981\u7684\u5173\u8054\u5bb9\u5668\u7c7b\u578b\u662f <code>map</code> \u548c <code>set</code> \u3002</p> <p>map \u4e2d\u7684\u5143\u7d20\u662f\u4e00\u4e9b \u5173\u952e\u5b57-\u503c \u5bf9\uff1a\u5173\u952e\u5b57\u8d77\u5230\u7d22\u5f15\u7684\u4f5c\u7528\uff0c\u503c\u5219\u8868\u793a\u4e0e\u7d22\u5f15\u76f8\u5173\u8054\u7684\u6570\u636e\u3002</p> <p>set \u4e2d\u6bcf\u4e2a\u5143\u7d20\u53ea\u5305\u542b\u4e00\u4e2a\u5173\u952e\u5b57\uff0cset \u652f\u6301\u9ad8\u6548\u7684\u5173\u952e\u8bcd\u67e5\u8be2\u64cd\u4f5c\uff0c\u68c0\u67e5\u4e00\u4e2a\u7ed9\u5b9a\u5173\u952e\u5b57\u662f\u5426\u5728 set \u4e2d\u3002</p> <p>\u6807\u51c6\u5e93\u63d0\u4f9b\u4e86 8 \u4e2a\u5173\u8054\u5bb9\u5668\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9 8 \u4e2a\u5173\u8054\u5bb9\u5668\u95f4\u7684\u4e0d\u540c\u4f53\u73b0\u5728\u4e09\u4e2a\u7ef4\u5ea6\u4e0a\uff1a</p> <ul> <li>\u6bcf\u4e2a\u5bb9\u5668\u6216\u662f\u4e00\u4e2a set \u6216\u8005\u662f\u4e00\u4e2a map \u3002</li> <li>\u6216\u8005\u8981\u6c42\u4e0d\u91cd\u590d\u7684\u5173\u952e\u5b57\uff0c\u6216\u8005\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\u3002</li> <li>\u6309\u987a\u5e8f\u4fdd\u5b58\u5143\u7d20\uff0c\u6216\u65e0\u5e8f\u4fdd\u5b58\u3002</li> </ul> <p>\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\u7684\u540d\u5b57\u4e2d\u90fd\u5305\u542b\u5355\u8bcd <code>multi</code> \u3002</p> <p>\u4e0d\u4fdd\u6301\u5173\u952e\u5b57\u6309\u987a\u5e8f\u5b58\u50a8\u7684\u5bb9\u5668\u7684\u540d\u5b57\u90fd\u4ee5\u5355\u8bcd <code>unordered</code> \u5f00\u5934\u3002</p> <p>\u56e0\u6b64\uff0c\u4e00\u4e2a <code>unordered_multi_set</code> \u662f\u4e00\u4e2a\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\uff0c\u5143\u7d20\u65e0\u5e8f\u4fdd\u5b58\u7684\u96c6\u5408\uff0c\u800c\u4e00\u4e2a set \u5219\u662f\u8981\u6c42\u4e0d\u91cd\u590d\u5173\u952e\u5b57\uff0c\u6709\u5e8f\u5b58\u50a8\u7684\u96c6\u5408\u3002</p> <p>\u7c7b\u578b map \u548c multimap \u5b9a\u4e49\u5728\u5934\u6587\u4ef6 map \u4e2d\uff0cset \u548c multiset \u5b9a\u4e49\u5728\u5934\u6587\u4ef6 set \u4e2d\uff0c\u65e0\u5e8f\u5bb9\u5668\u5219\u5b9a\u4e49\u5728\u5934\u6587\u4ef6 unordered_map \u548c unordered_set \u4e2d\u3002</p> <p>map \u7684\u7b80\u5355\u793a\u4f8b\uff1a <pre><code>    map&lt;string, size_t&gt; word_count;\n    string word;\n    while (cin &gt;&gt; word) {\n        ++word_count[word];\n    }\n    for (const auto &amp;w : word_count) {\n        cout &lt;&lt; w.first &lt;&lt; \" occurs\" &lt;&lt;\n             w.second &lt;&lt; ((w.second &gt; 1) ? \" times\" : \" time\") &lt;&lt; endl;\n    }\n</code></pre></p> <p>set \u7684\u7b80\u5355\u793a\u4f8b\uff1a</p> <pre><code>    map&lt;string, size_t&gt; word_count;\n    set&lt;string&gt; exclude = {\"The\", \"But\", \"And\"};\n    string word;\n    while (cin &gt;&gt; word) {\n        if (exclude.find(word) == exclude.end()) {\n            ++word_count[word];\n        }\n    }\n</code></pre>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#pair","title":"pair \u7c7b\u578b","text":"<p>\u5728\u5f00\u59cb\u5173\u8054\u5bb9\u5668\u7684\u64cd\u4f5c\u4e4b\u524d\uff0c\u9700\u8981\u4e86\u89e3 <code>pair</code> \u7684\u6807\u51c6\u5e93\u7c7b\u578b\uff0c\u5b83\u5b9a\u4e49\u5728\u5934\u6587\u4ef6 <code>utility</code> \u4e2d\u3002</p> <p>\u4e00\u4e2a pair \u4fdd\u5b58\u4e24\u4e2a\u6570\u636e\u6210\u5458\u3002pair \u662f\u4e00\u4e2a\u7528\u6765\u751f\u6210\u7279\u522b\u7c7b\u578b\u7684\u6a21\u677f\u3002\u5f53\u521b\u5efa\u4e00\u4e2a pair \u65f6\uff0c\u6211\u4eec\u5fc5\u987b\u63d0\u4f9b\u4e24\u4e2a\u7c7b\u578b\u540d\uff0cpair \u7684\u6570\u636e\u6210\u5458\u5c06\u5177\u6709\u5bf9\u5e94\u7684\u7c7b\u578b\uff0c\u4e24\u4e2a\u7c7b\u578b\u4e0d\u8981\u6c42\u4e00\u6837\uff1a</p> <pre><code>pair&lt;string,string&gt; anon;\npair&lt;string,size_t&gt; word_count;\npair&lt;string,vector&lt;int&gt;&gt; line;\npair&lt;string,string&gt; author{\"James\",\"Joyce\"};\n</code></pre> <p>pair \u7684\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u5bf9\u6570\u636e\u6210\u5458\u8fdb\u884c\u503c\u521d\u59cb\u5316\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u6210\u5458\u63d0\u4f9b\u521d\u59cb\u5316\u5668\u3002</p> <p>pair \u7684\u6570\u636e\u6210\u5458\u662f public \u7684\u3002\u4e24\u4e2a\u6210\u5458\u5206\u522b\u547d\u540d\u4e3a first \u548c second \u3002\u53ef\u4ee5\u7528\u666e\u901a\u7684\u8bbf\u95ee\u7b26\u6765\u8bbf\u95ee\u5b83\u4eec\u3002</p> <p>\u5177\u4f53 pair \u4e0a\u7684\u4e00\u4e9b\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <p></p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_17","title":"\u5173\u8054\u5bb9\u5668\u8fed\u4ee3\u5668","text":"<p>\u5f53\u89e3\u5f15\u7528\u4e00\u4e2a\u5173\u8054\u5bb9\u5668\u8fed\u4ee3\u5668\u65f6\uff0c\u6211\u4eec\u4f1a\u5f97\u5230\u4e00\u4e2a\u7c7b\u578b\u4e3a\u5bb9\u5668\u7684 value_type \u7684\u503c\u7684\u5f15\u7528\u3002\u5bf9 map \u800c\u8a00\uff0cvalue_type \u662f\u4e00\u4e2a pair \u7c7b\u578b\uff0c\u5176 first \u6210\u5458\u4fdd\u5b58 const \u7684\u5173\u952e\u5b57\uff0csecond \u6210\u5458\u4fdd\u5b58\u503c\u3002</p> <pre><code>    // \u83b7\u5f97\u6307\u5411 word_count \u4e2d\u4e00\u4e2a\u5143\u7d20\u7684\u8fed\u4ee3\u5668\n    auto map_it = word_count.begin();\n    // *map_it \u662f\u6307\u5411\u4e00\u4e2a pair&lt;const string,size_t&gt; \u5bf9\u8c61\u7684\u5f15\u7528\n    cout &lt;&lt; map_it-&gt;first;\n    cout &lt;&lt; map_it-&gt;second;\n    // \u53ef\u4ee5\u901a\u8fc7\u8fed\u4ee3\u5668\u6539\u53d8\u5143\u7d20\n    ++map_it-&gt;second;\n</code></pre> <p>\u4e00\u4e2a map \u7684 value_type \u662f\u4e00\u4e2a pari \uff0c\u6211\u4eec\u53ef\u4ee5\u6539\u53d8 pair \u7684\u503c\uff0c\u4f46\u4e0d\u80fd\u6539\u53d8\u5173\u952e\u5b57\u6210\u5458\u7684\u503c\u3002</p> <p>\u5bf9\u4e8e set \u800c\u8a00\uff0c\u5b83\u7684 iterator \u548c const_iterator \u8fed\u4ee3\u5668\u90fd\u53ea\u5141\u8bb8\u53ea\u8bfb\u8bbf\u95ee set \u4e2d\u7684\u5143\u7d20\uff0c\u800c\u4e14\uff0cset \u4e2d\u7684\u5173\u952e\u5b57\u4e5f\u662f const \u7684 \u3002</p> <pre><code>    set&lt;int&gt; iset = {0, 1, 2, 3, 4, 5};\n    set&lt;int&gt;::iterator set_it = iset.begin();\n    if (set_it != iset.end()) {\n        // *set_it = 42;   // \u5173\u952e\u5b57\u53ea\u8bfb\uff0c\u4e0d\u80fd\u8d4b\u503c\n        cout &lt;&lt; *set_it &lt;&lt; endl;\n    }\n</code></pre>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#map","title":"\u5411 map \u6dfb\u52a0\u5143\u7d20\uff1a","text":"<p>\u5bf9\u4e00\u4e2a map \u8fdb\u884c insert \u64cd\u4f5c\u65f6\uff0c\u5fc5\u987b\u8bb0\u4f4f\u5143\u7d20\u7c7b\u578b\u662f <code>pair</code> \u3002</p> <p>\u901a\u5e38\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u60f3\u8981\u63d2\u5165\u7684\u6570\u636e\uff0c\u5e76\u6ca1\u6709\u4e00\u4e2a\u73b0\u6210\u7684 pair \u5bf9\u8c61\uff0c\u53ef\u4ee5\u5728 insert \u7684\u53c2\u6570\u5217\u8868\u4e2d\u521b\u5efa\u4e00\u4e2a <code>pair</code> \u3002</p> <pre><code>    map&lt;string, size_t&gt; word_count;\n    string word = \"word\";\n    // \u5411 map \u4e2d\u63d2\u5165\u6570\u636e\u7684\u65b9\u5f0f\u7684 4 \u4e2d\u65b9\u5f0f\n    word_count.insert({word, 1});\n    word_count.insert(make_pair(word, 1));\n    word_count.insert(pair&lt;string, size_t&gt;(word, 1));\n    word_count.insert(map&lt;string, size_t&gt;::value_type(word, 1));\n</code></pre> <p>\u5728\u65b0\u6807\u51c6\u4e0b\uff0c\u521b\u5efa\u4e00\u4e2a pair \u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u5728\u53c2\u6570\u5217\u8868\u4e2d\u4f7f\u7528\u82b1\u62ec\u53f7\u521d\u59cb\u5316\uff0c\u4e5f\u53ef\u4ee5\u7528 <code>make_pair</code> \u6216\u663e\u793a\u6784\u9020 <code>pair</code> \u3002\u6216\u8005\u901a\u8fc7 <code>map&lt;string,size_t&gt;::value_type</code> \u6784\u9020\u4e00\u4e2a\u6070\u5f53\u7684 pair \u7c7b\u578b\uff0c\u5e76\u6784\u9020\u8be5\u7c7b\u578b\u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u7136\u540e\u63d2\u5165\u5230 map \u4e2d\u3002</p> <p>\u5173\u8054\u5bb9\u5668\u7684 insert \u64cd\u4f5c\u5982\u4e0b\u8868\uff1a</p> <p></p> <p>insert \uff08\u6216 emplace\uff09\u8fd4\u56de\u7684\u503c\u4f9d\u8d56\u4e8e\u5bb9\u5668\u7c7b\u578b\u548c\u53c2\u6570\u3002\u5bf9\u4e8e\u4e0d\u5305\u542b\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\uff0c\u6dfb\u52a0\u5355\u4e00\u5143\u7d20\u7684 insert \u548c emplace \u7248\u672c\u8fd4\u56de\u4e00\u4e2a pair \uff0c\u544a\u8bc9\u6211\u4eec\u63d2\u5165\u64cd\u4f5c\u662f\u5426\u6210\u529f\u3002</p> <p>pair \u7684 first \u6210\u5458\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u6307\u5411\u5177\u6709\u7ed9\u5b9a\u5173\u952e\u5b57\u7684\u5143\u7d20\uff1bsecond \u6210\u5458\u662f\u4e00\u4e2a bool \u503c\uff0c\u6307\u51fa\u5143\u7d20\u662f\u63d2\u5165\u6210\u529f\u8fd8\u662f\u5df2\u7ecf\u5b58\u5728\u4e8e\u5bb9\u5668\u4e2d\u3002\u5982\u679c\u5173\u952e\u5b57\u5df2\u5728\u5bb9\u5668\u4e2d\uff0c\u5219 insert \u4ec0\u4e48\u4e8b\u60c5\u4e5f\u4e0d\u505a\uff0c\u4e14\u8fd4\u56de\u503c\u4e2d\u7684 bool \u90e8\u5206\u4e3a false\u3002\u5982\u679c\u5173\u952e\u5b57\u4e0d\u5b58\u5728\uff0c\u5143\u7d20\u88ab\u63d2\u5165\u5bb9\u5668\uff0c\u4e14 bool \u503c\u4e3a true \u3002</p> <p>\u6bd4\u5982\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>    map&lt;string, size_t&gt; word_count;\n    string word = \"word\";\n    for (int i = 0; i &lt; 5; ++i) {\n        // key \u662f word \uff0cvalue \u662f 1\n        auto ret = word_count.insert({word, 1});\n        if (!ret.second) {\n            ++ret.first-&gt;second;\n        }\n    }\n</code></pre> <p>\u5728 if \u4e2d\u6839\u636e second \u6765\u5224\u65ad\u662f\u5426\u63d2\u5165\u6210\u529f\uff0c\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u4e86\uff0c\u5c31\u628a pair \u5bf9\u5e94\u7684 value \u503c\u9012\u589e\u3002</p> <p>\u8fd9\u91cc\u8981\u91cd\u70b9\u67e5\u770b\u9012\u589e\u8bed\u53e5\uff0c\u6bd4\u8f83\u96be\u7406\u89e3\uff1a</p> <pre><code>    ++ret.first-&gt;second;\n    // \u7b49\u4ef7\u4e8e\n    ++((ret.first)-&gt;second);\n</code></pre> <p><code>ret.first</code> \u662f pair \u7684\u7b2c\u4e00\u4e2a\u6210\u5458\uff0c\u662f\u4e00\u4e2a map \u8fed\u4ee3\u5668\uff0c\u6307\u5411\u5177\u6709\u7ed9\u5b9a\u5173\u952e\u5b57\u7684\u5143\u7d20\u3002 <code>ret.first-&gt;</code> \u89e3\u5f15\u7528\u6b64\u8fed\u4ee3\u5668\uff0c\u63d0\u53d6 map \u4e2d\u7684\u5143\u7d20\uff0c\u5143\u7d20\u4e5f\u662f\u4e00\u4e2a pair \u3002 <code>ret.first-&gt;second</code> map \u4e2d\u5143\u7d20\u7684\u503c\u90e8\u5206\u3002 <code>++ret.first-&gt;second</code> \u9012\u589e\u6b64\u503c\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#multiset-multimap","title":"\u5411 multiset \u6216\u8005 multimap \u6dfb\u52a0\u5143\u7d20","text":"<p>\u5982\u679c\u5e0c\u671b\u6dfb\u52a0\u5177\u6709\u76f8\u540c\u5173\u952e\u5b57\u7684\u591a\u4e2a\u5143\u7d20\uff0c\u5c31\u5e94\u8be5\u4f7f\u7528 <code>multimap</code> \u3002\u7531\u4e8e\u4e00\u4e2a multi \u5bb9\u5668\u4e2d\u7684\u5173\u952e\u5b57\u4e0d\u5fc5\u552f\u4e00\uff0c\u5728\u8fd9\u4e9b\u7c7b\u578b\u4e0a\u8c03\u7528 insert \u603b\u4f1a\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\u3002</p> <pre><code>    multimap&lt;string, string&gt; authors;\n    // \u63d2\u5165\u4e24\u4e2a\u5143\u7d20\uff0c\u5173\u952e\u5b57\u90fd\u4e3a Barth\n    authors.insert({\"Barth\", \"fadt\"});\n    authors.insert({\"Barth\", \"asdd\"});\n</code></pre> <p>\u5bf9\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\uff0c\u63a5\u53d7\u5355\u4e2a\u5143\u7d20\u7684 insert \u64cd\u4f5c\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u65b0\u5143\u7d20\u7684\u8fed\u4ee3\u5668\u3002\u8fd9\u91cc\u65e0\u987b\u8fd4\u56de\u4e00\u4e2a bool \u503c\uff0c\u56e0\u4e3a insert \u603b\u662f\u5411\u8fd9\u7c7b\u5bb9\u5668\u52a0\u5165\u4e00\u4e2a\u65b0\u5143\u7d20\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#map_1","title":"map \u79fb\u9664\u5143\u7d20","text":"<p>\u5173\u8054\u5bb9\u5668\u5b9a\u4e49\u4e86\u4e09\u4e2a\u7248\u672c\u7684 <code>earse</code> \u3002</p> <p></p> <p>\u4e0e\u987a\u5e8f\u5bb9\u5668\u4e00\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f20\u9012\u7ed9 erase \u4e00\u4e2a\u8fed\u4ee3\u5668\u6216\u4e00\u4e2a\u8fed\u4ee3\u5668\u5bf9\u6765\u5220\u9664\u4e00\u4e2a\u5143\u7d20\u6216\u8005\u4e00\u4e2a\u5143\u7d20\u8303\u56f4\u3002\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u989d\u5916\u7684 earse \u64cd\u4f5c\uff0c\u5b83\u63a5\u53d7\u4e00\u4e2a <code>key_type</code> \u53c2\u6570\uff0c\u5b83\u4f1a\u5220\u9664\u6240\u6709\u5339\u914d\u7ed9\u5b9a\u5173\u952e\u5b57\u7684\u5143\u7d20\uff08\u5982\u679c\u5b58\u5728\u7684\u8bdd\uff09\uff0c\u8fd4\u56de\u5b9e\u9645\u5220\u9664\u7684\u5143\u7d20\u7684\u6570\u91cf\u3002</p> <p>\u5bf9\u4e8e\u4e0d\u4fdd\u5b58\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\uff0cerase \u7684\u8fd4\u56de\u503c\u603b\u662f 0 \u6216 1 \u3002\u82e5\u8fd4\u56de\u503c\u4e3a 0 \uff0c\u5219\u8868\u660e\u60f3\u8981\u5220\u9664\u7684\u5143\u7d20\u5e76\u4e0d\u5728\u5bb9\u5668\u4e2d\u3002\u5bf9\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\uff0c\u5220\u9664\u5143\u7d20\u7684\u6570\u91cf\u53ef\u80fd\u5927\u4e8e 1 \u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#map_2","title":"map \u7684\u4e0b\u6807\u64cd\u4f5c\u548c\u5143\u7d20\u8bbf\u95ee\u64cd\u4f5c","text":"","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_18","title":"\u4e0b\u6807\u64cd\u4f5c","text":"<p>map \u548c unordered_map \u5bb9\u5668\u63d0\u4f9b\u4e86\u4e0b\u6807\u8fd0\u7b97\u7b26\u548c\u4e00\u4e2a\u5bf9\u5e94\u7684 <code>at</code> \u51fd\u6570\u3002</p> <p></p> <p>set \u7c7b\u578b\u4e0d\u652f\u6301\u4e0b\u6807\u64cd\u4f5c\uff0c\u56e0\u4e3a set \u4e2d\u6ca1\u6709\u4e0e\u5173\u952e\u5b57\u76f8\u5173\u8054\u7684 \u201c\u503c\u201d \uff0c\u5143\u7d20\u672c\u8eab\u5c31\u662f\u5173\u952e\u5b57\uff0c\u56e0\u6b64 \u201c\u83b7\u53d6\u4e0e\u4e00\u4e2a\u5173\u952e\u5b57\u76f8\u5173\u8054\u7684\u503c\u201d \u7684\u64cd\u4f5c\u5c31\u6ca1\u610f\u4e49\u4e86\u3002</p> <p>\u4e0d\u80fd\u5bf9\u4e00\u4e2a multimap \u6216\u4e00\u4e2a unordered_multimap \u8fdb\u884c\u4e0b\u6807\u64cd\u4f5c\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u5bb9\u5668\u4e2d\u53ef\u80fd\u6709\u591a\u4e2a\u503c\u4e0e\u4e00\u4e2a\u5173\u952e\u5b57\u76f8\u5173\u8054\u3002</p> <p>\u7c7b\u4f3c\u4e8e\u5176\u4ed6\u4e0b\u6807\u8fd0\u7b97\u7b26\uff0cmap \u4e0b\u6807\u8fd0\u7b97\u7b26\u63a5\u53d7\u4e00\u4e2a\u7d22\u5f15\uff08\u5373\uff1a\u5173\u952e\u5b57\uff09\uff0c\u83b7\u53d6\u4e8e\u6b64\u5173\u952e\u5b57\u76f8\u5173\u8054\u7684\u503c\u3002\u4f46\u662f\uff0c\u5982\u679c\u5173\u952e\u5b57\u5e76\u4e0d\u5728 map \u4e2d\uff0c\u4f1a\u4e3a\u5b83\u521b\u5efa\u4e00\u4e2a\u5143\u7d20\u5e76\u63d2\u5165\u5230 map \u4e2d\uff0c\u5173\u8054\u503c\u5c06\u8fdb\u884c\u503c\u521d\u59cb\u5316\u3002</p> <pre><code>    map&lt;string, size_t&gt; word_count;\n    // \u63a5\u53d7\u7d22\u5f15\u4e3a\u5173\u952e\u5b57\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u521b\u5efa\u4e00\u4e2a\u5e76\u63d2\u5165\u5230 map \u4e2d\n    word_count[\"Anna\"] = 1;\n</code></pre> <p>\u5982\u679c\u4e0b\u6807\u8fd0\u7b97\u7b26\u53ef\u80fd\u63d2\u5165\u4e00\u4e2a\u65b0\u5143\u7d20\uff0c\u6211\u4eec\u53ea\u53ef\u4ee5\u5bf9\u975e const \u7684 map \u4f7f\u7528\u4e0b\u6807\u64cd\u4f5c\u3002</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u89e3\u5f15\u7528\u4e00\u4e2a\u8fed\u4ee3\u5668\u6240\u8fd4\u56de\u7684\u7c7b\u578b\u4e0e\u4e0b\u6807\u8fd0\u7b97\u7b26\u8fd4\u56de\u7684\u7c7b\u578b\u662f\u4e00\u6837\u7684\u3002\u4f46\u5bf9\u4e8e map \u5219\u4e0d\u7136\uff1a\u5f53\u5bf9\u4e00\u4e2a map \u8fdb\u884c\u4e0b\u6807\u64cd\u4f5c\u65f6\uff0c\u4f1a\u83b7\u5f97\u4e00\u4e2a <code>mapped_type</code> \u5bf9\u8c61\uff1b\u5f53\u89e3\u5f15\u7528\u4e00\u4e2a map \u8fed\u4ee3\u5668\u65f6\uff0c\u4f1a\u5f97\u5230\u4e00\u4e2a <code>valut_type</code> \u5bf9\u8c61\u3002</p> <p>\u4e0e\u5176\u4ed6\u4e0b\u6807\u8fd0\u7b97\u7b26\u76f8\u540c\u7684\u662f\uff0cmap \u7684\u4e0b\u6807\u8fd0\u7b97\u7b26\u8fd4\u56de\u4e00\u4e2a\u5de6\u503c\u3002\u7531\u4e8e\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5de6\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u65e2\u53ef\u4ee5\u8bfb\u4e5f\u53ef\u4ee5\u5199\u5143\u7d20\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_19","title":"\u5143\u7d20\u8bbf\u95ee","text":"<p>\u5173\u8054\u5bb9\u5668\u63d0\u4f9b\u591a\u79cd\u67e5\u627e\u4e00\u4e2a\u6307\u5b9a\u5143\u7d20\u7684\u65b9\u6cd5\u3002</p> <p></p> <p></p> <p>\u5e94\u8be5\u4f7f\u7528\u54ea\u4e2a\u64cd\u4f5c\u4f9d\u8d56\u4e8e\u6211\u4eec\u8981\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\uff1a</p> <ul> <li>\u5982\u679c\u5173\u5fc3\u7684\u662f\u4e00\u4e2a\u7279\u5b9a\u5143\u7d20\u662f\u5426\u5df2\u5728\u5bb9\u5668\u4e2d\uff0c\u53ef\u80fd <code>find</code> \u662f\u6700\u4f73\u9009\u62e9\u3002</li> <li>\u5bf9\u4e8e\u4e0d\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\uff0c\u53ef\u80fd\u4f7f\u7528 <code>find</code> \u8fd8\u662f <code>count</code> \u6ca1\u4ec0\u4e48\u533a\u522b\u3002</li> <li>\u5bf9\u4e8e\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\uff0c<code>count</code> \u8fd8\u4f1a\u7edf\u8ba1\u6709\u591a\u5c11\u4e2a\u5143\u7d20\u6709\u76f8\u540c\u7684\u5173\u952e\u5b57\uff0c\u5982\u679c\u4e0d\u9700\u8981\uff0c\u6700\u597d\u4f7f\u7528 <code>find</code> \u3002</li> </ul> <p>\u5bf9 map \u548c unordered_map \u7c7b\u578b\uff0c\u4e0b\u6807\u8fd0\u7b97\u7b26\u63d0\u4f9b\u4e86\u6700\u7b80\u5355\u7684\u63d0\u53d6\u5143\u7d20\u7684\u65b9\u6cd5\u3002\u4f46\u662f\uff0c\u4f7f\u7528\u4e0b\u6807\u6709\u4e00\u4e2a\u4e25\u91cd\u7684\u526f\u4f5c\u7528\uff1a\u5982\u679c\u5173\u952e\u5b57\u8fd8\u672a\u5728 map \u4e2d\uff0c\u4e0b\u6807\u64cd\u4f5c\u4f1a\u63d2\u5165\u4e00\u4e2a\u5177\u6709\u7ed9\u5b9a\u5173\u952e\u5b57\u7684\u5143\u7d20\u3002\u8fd9\u79cd\u884c\u4e3a\u662f\u5426\u6b63\u786e\u5b8c\u5168\u4f9d\u8d56\u4e8e\u6211\u4eec\u7684\u9884\u671f\u662f\u662f\u4ec0\u4e48\u3002</p> <p>\u4f46\u6709\u65f6\uff0c\u5982\u679c\u53ea\u662f\u60f3\u77e5\u9053\u4e00\u4e2a\u7ed9\u5b9a\u5173\u952e\u5b57\u662f\u5426\u5728 map \u4e2d\uff0c\u800c\u4e0d\u60f3\u6539\u53d8 map \uff0c\u90a3\u5c31\u4e0d\u80fd\u4f7f\u7528\u4e0b\u6807\u8fd0\u7b97\u7b26\u6765\u68c0\u67e5\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u5b58\u5728\uff0c\u800c\u662f\u8be5\u4f7f\u7528 find \u64cd\u4f5c\u7b26\u3002</p> <p>\u5982\u679c\u8981\u5728\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\u4e2d\u67e5\u627e\u5143\u7d20\uff0c\u5728\u5bb9\u5668\u4e2d\u53ef\u80fd\u6709\u5f88\u591a\u5143\u7d20\u5177\u6709\u7ed9\u5b9a\u7684\u5173\u952e\u5b57\u3002\u5982\u679c\u4e00\u4e2a multimap \u6216 mulitset \u4e2d\u6709\u591a\u4e2a\u5143\u7d20\u5177\u6709\u7ed9\u5b9a\u5173\u952e\u5b57\uff0c\u5219\u8fd9\u4e9b\u5143\u7d20\u5728\u5bb9\u5668\u4e2d\u4f1a\u76f8\u90bb\u5b58\u50a8\u3002</p> <p>\u4ee3\u7801\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>    string search_item(\"Alain de Botton\");\n    // \u8fd4\u56de\u5173\u952e\u5b57\u7b49\u4e8e search_item \u7684\u6570\u91cf\n    auto entries = authors.count(search_item);\n    // \u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\n    auto iter = authors.find(search_item);\n    while (entries) {\n        // pair \u8fed\u4ee3\u5668\u7684 second \u4ee3\u8868\u503c\n        cout &lt;&lt; iter-&gt;second &lt;&lt; endl;\n        ++iter;\n        --entries;\n    }\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528 <code>lower_bound</code> \u548c <code>upper_bound</code> \u6765\u5b9e\u73b0\u4e0a\u8ff0\u4ee3\u7801\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u90fd\u63a5\u53d7\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u3002</p> <p>\u5982\u679c\u5173\u952e\u5b57\u5728\u5bb9\u5668\u4e2d\uff0c<code>lower_bound</code> \u8fd4\u56de\u7684\u8fed\u4ee3\u5668\u5c06\u6307\u5411\u7b2c\u4e00\u4e2a\u5177\u6709\u7ed9\u5b9a\u5173\u952e\u5b57\u7684\u5143\u7d20\uff0c\u800c <code>upper_bound</code> \u8fd4\u56de\u7684\u8fed\u4ee3\u5668\u5219\u6307\u5411\u6700\u540e\u4e00\u4e2a\u5339\u914d\u7ed9\u5b9a\u5173\u952e\u5b57\u7684\u5143\u7d20\u4e4b\u540e\u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u5143\u7d20\u4e0d\u5728 multimap \u4e2d\uff0c\u5219 lower_bound \u548c upper_bound \u4f1a\u8fd4\u56de\u76f8\u7b49\u7684\u8fed\u4ee3\u5668\uff0c\u6307\u5411\u4e00\u4e2a\u4e0d\u5f71\u54cd\u6392\u5e8f\u7684\u5173\u952e\u5b57\u63d2\u5165\u4f4d\u7f6e\u3002</p> <p>\u56e0\u6b64\u7528\u76f8\u540c\u7684\u5173\u952e\u5b57\u8c03\u7528 lower_bound \u548c upper_bound \u4f1a\u5f97\u5230\u4e00\u4e2a\u8fed\u4ee3\u5668\u8303\u56f4\uff0c\u8868\u793a\u6240\u6709\u5177\u6709\u8be5\u5173\u952e\u5b57\u7684\u5143\u7d20\u7684\u8303\u56f4\u3002</p> <pre><code>    string search_item(\"Alain de Botton\");\n    for (auto beg = authors.lower_bound(search_item),\n                 end = authors.upper_bound(search_item);\n         beg != end;\n         ++beg\n            ) {\n        cout &lt;&lt; beg-&gt;second &lt;&lt; endl;\n    }\n</code></pre> <p>\u53e6\u5916\u8fd8\u53ef\u4ee5\u4f7f\u7528 <code>equal_range</code> \u51fd\u6570\u6765\u5b9e\u73b0\u3002\u6b64\u51fd\u6570\u63a5\u53d7\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668 pair \u3002\u82e5\u5173\u952e\u5b57\u5b58\u5728\uff0c\u5219\u7b2c\u4e00\u4e2a\u8fed\u4ee3\u5668\u6307\u5411\u7b2c\u4e00\u4e2a\u4e0e\u5173\u952e\u5b57\u5339\u914d\u7684\u5143\u7d20\uff0c\u7b2c\u4e8c\u4e2a\u8fed\u4ee3\u5668\u6307\u5411\u6700\u540e\u4e00\u4e2a\u5339\u914d\u5143\u7d20\u4e4b\u540e\u7684\u4f4d\u7f6e\u3002\u82e5\u672a\u627e\u5230\u5339\u914d\u5143\u7d20\uff0c\u5219\u4e24\u4e2a\u8fed\u4ee3\u5668\u90fd\u6307\u5411\u5173\u952e\u5b57\u53ef\u4ee5\u63d2\u5165\u7684\u4f4d\u7f6e\u3002</p> <pre><code>    string search_item(\"Alain de Botton\");\n    for (auto pos = authors.equal_range(search_item);\n         pos.first != pos.second; ++pos.first) {\n        cout &lt;&lt; pos.first-&gt;second &lt;&lt; endl;\n    }\n</code></pre> <p><code>equal_range</code> \u8fd4\u56de\u7684 pair \u7684 first \u6210\u5458\u4fdd\u5b58\u7684\u8fed\u4ee3\u5668\u4e0e lower_bound \u8fd4\u56de\u7684\u8fed\u4ee3\u5668\u662f\u4e00\u6837\u7684\uff0csecond \u4fdd\u5b58\u7684\u8fed\u4ee3\u5668\u4e0e upper_bound \u7684\u8fd4\u56de\u503c\u662f\u4e00\u6837\u7684\u3002\u56e0\u6b64\u5728\u7a0b\u5e8f\u4e2d\uff0cpos.first \u7b49\u4e8e\u4e0a\u9762\u7684 beg \uff0cpos.second \u7b49\u4ef7\u4e8e end \u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u5355\u8bcd\u8f6c\u6362\u7684\u4ee3\u7801\u603b\u7ed3 map \u7684\u4f7f\u7528\uff1a</p> <p>\u901a\u8fc7\u8bfb\u53d6\u4e24\u4e2a\u6587\u4ef6\uff0c\u4e00\u4e2a\u662f\u5355\u8bcd\u8f6c\u6362\u6587\u4ef6\uff0c\u4e00\u4e2a\u662f\u8981\u8f6c\u6362\u7684\u6587\u672c\u6587\u4ef6\u6765\u5b9e\u73b0\u3002</p> <pre><code>/**\n * \u8bfb\u53d6\u8f6c\u6362\u89c4\u5219\u6587\u4ef6\uff0c\u4fdd\u5b58\u6bcf\u4e2a\u5355\u8bcd\u5230\u5176\u8f6c\u6362\u5185\u5bb9\u7684\u6620\u5c04\n * @param map_file\n * @return\n */\nmap&lt;string, string&gt; buildMap(ifstream &amp;map_file) {\n    map&lt;string, string&gt; trans_map; // \u4fdd\u5b58\u8f6c\u6362\u89c4\u5219\n    string key;\n    string value;\n    // \u8bfb\u53d6\u7b2c\u4e00\u4e2a\u5355\u8bcd\u5b58\u5165 key \u4e2d\uff0c\u884c\u4e2d\u5269\u4f59\u5185\u5bb9\u5b58\u5165 value\n    while (map_file &gt;&gt; key &amp;&amp; getline(map_file, value)) {\n        if (value.size() &gt; 1) {\n            trans_map[key] = value.substr(1);\n        } else {\n            throw runtime_error(\"no rule for \" + key);\n        }\n    }\n    return trans_map;\n}\n\n/**\n * \u63a5\u53d7\u4e00\u4e2a string \uff0c\u5982\u679c\u5b58\u5728\u8f6c\u6362\u89c4\u5219\uff0c\u5219\u8fd4\u56de\u8f6c\u6362\u540e\u7684\u5185\u5bb9\n * @param s\n * @param m\n * @return\n */\nconst string &amp;transfrom(const string &amp;s, const map&lt;string, string&gt; &amp;m) {\n    auto map_it = m.find(s);\n    // \u5982\u679c\u5355\u8bcd\u5728\u8f6c\u6362\u89c4\u5219 map \u4e2d\n    if (map_it != m.cend()) {\n        // \u4f7f\u7528\u66ff\u6362\u77ed\u8bed\n        return map_it-&gt;second;\n    } else {\n        return s;\n    }\n}\n\n/**\n * \u8bfb\u53d6\u8981\u8f6c\u6362\u7684\u6587\u672c\u6587\u4ef6\uff0c\n * @param map_file\n * @param input\n */\nvoid word_transform(ifstream &amp;map_file, ifstream &amp;input) {\n    auto trans_map = buildMap(map_file); // \u4fdd\u5b58\u8f6c\u6362\u89c4\u5219\n    string text;\n    while (getline(input, text)) {\n        istringstream stream(text);\n        string word;\n        bool firstword = true;\n        while (stream &gt;&gt; word) {\n            if (firstword) {\n                firstword = false;\n            } else {\n                cout &lt;&lt; \" \";\n                cout &lt;&lt; transfrom(word, trans_map);\n            }\n        }\n        cout &lt;&lt; endl;\n    }\n}\n</code></pre>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_20","title":"\u5173\u8054\u5bb9\u5668\u5c0f\u7ed3","text":"<p>\u5173\u8054\u5bb9\u5668\u652f\u6301\u901a\u8fc7\u5173\u952e\u5b57\u9ad8\u6548\u67e5\u627e\u548c\u63d0\u53d6\u5143\u7d20\u3002\u5bf9\u5173\u952e\u5b57\u7684\u4f7f\u7528\u5c06\u5173\u8054\u5bb9\u5668\u548c\u987a\u5e8f\u5bb9\u5668\u533a\u5206\u5f00\uff0c\u987a\u5e8f\u5bb9\u5668\u662f\u901a\u8fc7\u4f4d\u7f6e\u8bbf\u95ee\u5143\u7d20\u7684\u3002</p> <p>\u6807\u51c6\u5e93\u5b9a\u4e49\u4e86 8 \u4e2a\u5173\u8054\u5bb9\u5668\uff0c\u6bcf\u4e2a\u5bb9\u5668\uff1a</p> <ul> <li>\u662f\u4e00\u4e2a map \u6216\u662f\u4e00\u4e2a set \u3002map \u4fdd\u5b58 \u5173\u952e\u5b57-\u503c \u5bf9\uff1bset \u53ea\u4fdd\u5b58\u5173\u952e\u5b57\u3002</li> <li>\u8981\u6c42\u5173\u952e\u5b57\u552f\u4e00\u6216\u4e0d\u8981\u6c42\u3002s</li> <li>\u4fdd\u6301\u5173\u952e\u5b57\u6709\u5e8f\u6216\u4e0d\u4fdd\u8bc1\u6709\u5e8f\u3002</li> </ul> <p>\u6709\u5e8f\u5bb9\u5668\u4f7f\u7528\u6bd4\u8f83\u51fd\u6570\u6765\u6bd4\u8f83\u5173\u952e\u5b57\uff0c\u4ece\u800c\u5c06\u5143\u7d20\u6309\u987a\u5e8f\u5b58\u50a8\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bd4\u8f83\u64cd\u4f5c\u662f\u91c7\u7528\u5173\u952e\u5b57\u7c7b\u578b\u7684 <code>&lt;</code> \u8fd0\u7b97\u7b26\u3002\u65e0\u5e8f\u5bb9\u5668\u4f7f\u7528\u5173\u952e\u5b57\u7c7b\u578b\u7684 <code>==</code> \u8fd0\u7b97\u7b26\u548c\u4e00\u4e2a <code>hash&lt;key_type&gt;</code> \u7c7b\u578b\u7684\u5bf9\u8c61\u6765\u7ec4\u7ec7\u5143\u7d20\u3002</p> <p>\u5141\u8bb8\u91cd\u590d\u5173\u952e\u5b57\u7684\u5bb9\u5668\u7684\u540d\u5b57\u90fd\u5305\u542b multi \u3002\u800c\u4f7f\u7528\u54c8\u5e0c\u6280\u672f\u7684\u5bb9\u5668\u7684\u540d\u5b57\u90fd\u4ee5 <code>unordered</code> \u5f00\u5934\u3002\u4f8b\u5982\uff1aset \u662f\u4e00\u4e2a\u6709\u5e8f\u96c6\u5408\uff0c\u5176\u4e2d\u6bcf\u4e2a\u5173\u952e\u5b57\u53ea\u53ef\u4ee5\u51fa\u73b0\u4e00\u6b21\uff1bunordered_multiset \u5219\u662f\u4e00\u4e2a\u65e0\u5e8f\u7684\u5173\u952e\u5b57\u96c6\u5408\uff0c\u5176\u4e2d\u5173\u952e\u5b57\u53ef\u4ee5\u51fa\u73b0\u591a\u6b21\u3002</p> <p>\u5173\u8054\u5bb9\u5668\u548c\u987a\u5e8f\u5bb9\u5668\u6709\u5f88\u591a\u5171\u540c\u7684\u5143\u7d20\u3002\u4f46\u662f\uff0c\u5173\u8054\u5bb9\u5668\u5b9a\u4e49\u4e86\u4e00\u4e9b\u65b0\u64cd\u4f5c\uff0c\u5e76\u5bf9\u4e00\u4e9b\u548c\u987a\u5e8f\u5bb9\u5668\u548c\u5173\u8054\u5bb9\u5668\u90fd\u652f\u6301\u7684\u64cd\u4f5c\u91cd\u65b0\u5b9a\u4e49\u4e86\u542b\u4e49\u6216\u8fd4\u56de\u7c7b\u578b\u3002\u64cd\u4f5c\u7684\u4e0d\u540c\u53cd\u6620\u51fa\u5173\u8054\u5bb9\u5668\u4f7f\u7528\u5173\u952e\u5b57\u7684\u7279\u70b9\u3002</p> <p>\u6709\u5e8f\u5bb9\u5668\u7684\u8fed\u4ee3\u5668\u901a\u8fc7\u5173\u952e\u5b57\u6709\u5e8f\u8bbf\u95ee\u5bb9\u5668\u4e2d\u7684\u5143\u7d20\u3002\u65e0\u8bba\u5728\u6709\u5e8f\u5bb9\u5668\u4e2d\u8fd8\u662f\u5728\u65e0\u5e8f\u5bb9\u5668\u4e2d\uff0c\u5177\u6709\u76f8\u540c\u5173\u952e\u5b57\u7684\u5143\u7d20\u90fd\u662f\u76f8\u90bb\u5b58\u50a8\u7684\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-stl-container-overview/#_21","title":"\u5c0f\u7ed3","text":"<p>\u6807\u51c6\u5bb9\u5668\u5e93\u4f7f\u7528\u8fd8\u662f\u633a\u9891\u7e41\u7684\uff0c\u80fd\u7528\u6807\u51c6\u5e93\u7684\u65f6\u5019\u5c31\u5c3d\u91cf\u7528\uff0c\u5305\u62ec\u5237\u9898\u5199\u4ee3\u7801\u4e4b\u7c7b\u7684\uff0c\u300aC++ Primer\u300b\u8981\u591a\u770b\u51e0\u904d\u3002</p>","tags":["C++","STL"]},{"location":"code/c%2B%2B-template-1/","title":"C++ \u6a21\u677f\u7cfb\u5217\u5c0f\u7ed301-\u51fd\u6570\u6a21\u677f\u548c\u7c7b\u6a21\u677f","text":"<p>\u73b0\u5982\u4eca\uff0c\u638c\u63e1 C++ \u6a21\u677f\u6280\u5de7\u5e76\u4e14\u719f\u7ec3\u4f7f\u7528\u53ef\u4ee5\u8bf4\u662f\u80fd\u529b\u8fdb\u9636\u7684\u5fc5\u5907\u5185\u5bb9\u4e86\u3002</p> <p>\u5728\u4e00\u4e9b\u4f18\u79c0\u7684\u5f00\u6e90\u9879\u76ee\u4e2d\u7ecf\u5e38\u80fd\u770b\u5230\u6a21\u677f\u7684\u4f7f\u7528\uff0c\u8981\u662f\u4e0d\u4e86\u89e3\u5176\u4f7f\u7528\u65b9\u6cd5\uff0c\u5bf9\u5206\u6790\u6e90\u7801\u90fd\u4f1a\u6709\u4e9b\u963b\u788d\u3002</p> <p>\u63a8\u8350\u9605\u8bfb\u300aC++ Templates \u4e2d\u6587\u7248\u300b\u4e00\u4e66\uff0c\u6216\u8bb8\u53ef\u4ee5\u8ba9\u4f60\u5bf9 C++ \u6a21\u677f\u6709\u4e2a\u66f4\u52a0\u7cfb\u7edf\u7684\u6982\u5ff5\uff0c\u540c\u65f6\u8f85\u52a9\u9605\u8bfb\u7f51\u4e0a\u76f8\u5173\u7684\u535a\u5ba2\u6587\u7ae0\u52a0\u6df1\u7406\u89e3\uff0c\u5728\u4ee3\u7801\u5b9e\u8df5\u4e2d\u53bb\u638c\u63e1\u63d0\u9ad8\u3002</p> <p>C++ \u6a21\u677f\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a\u51fd\u6570\u6a21\u677f\u548c\u7c7b\u6a21\u677f\uff0c\u8fd9\u6b21\u5c31\u662f\u4ecb\u7ecd\u5b83\u4eec\u4e24\u4e2a\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-1/#_1","title":"\u51fd\u6570\u6a21\u677f","text":"<p>\u51fd\u6570\u6a21\u677f\u4e3b\u8981\u5c31\u662f\u5c06\u5b83\u7684\u53c2\u6570\u7528\u7c7b\u578b\u5e26\u4ee3\u66ff\uff0c\u5bf9\u6bcf\u4e2a\u4e0d\u540c\u7684\u7c7b\u578b\u90fd\u4f1a\u751f\u6210\u5bf9\u5e94\u7684\u51fd\u6570\uff0c\u6240\u4ee5\u51fd\u6570\u6a21\u677f\u53ef\u4ee5\u7528\u591a\u79cd\u4e0d\u540c\u7684\u7c7b\u578b\u8fdb\u884c\u8c03\u7528\uff0c\u5b83\u4ee3\u8868\u7684\u5176\u5b9e\u662f\u4e00\u4e2a\u51fd\u6570\u5bb6\u65cf\u800c\u4e0d\u662f\u4e00\u4e2a\u51fd\u6570\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e2a\u7b80\u5355\u7684\u51fd\u6570\u6a21\u677f\u793a\u4f8b\uff1a</p> <pre><code>#include &lt;iostream&gt;\n\ntemplate &lt;typename T&gt;\nT plus(T a,T b){\n    return a+b;\n}\n\n// \u4f7f\u7528\u5f15\u7528\u7c7b\u578b\uff0c\u51cf\u5c11\u62f7\u8d1d\u64cd\u4f5c\ntemplate&lt;typename T&gt;\ninline T const &amp;max(T const &amp;a, T const &amp;b) {\n    return a &lt; b ? b : a;\n}\n\nint main() {\n    plus(1.0, 1.0);\n    plus(static_cast&lt;int&gt;(1.0), 2);\n    plus&lt;int&gt;(2.0, 3.0);\n\n    max(2,1);\n    max(static_cast&lt;int&gt;(2.0),1);\n    max&lt;double&gt;(2.0,3.0);\n    return 0;\n}\n</code></pre> <p>\u901a\u5e38\u800c\u8a00\uff0c\u5e76\u4e0d\u662f\u628a\u6a21\u677f\u7f16\u8bd1\u6210\u4e00\u4e2a\u53ef\u4ee5\u5904\u7406\u4efb\u4f55\u5355\u4e00\u7c7b\u578b\u7684\u5355\u4e00\u5b9e\u4f53\uff0c\u800c\u662f\u9488\u5bf9\u5b9e\u4f8b\u6a21\u677f\u53c2\u6570\u7684\u6bcf\u79cd\u7c7b\u578b\uff0c\u90fd\u4ece\u6a21\u677f\u4ea7\u751f\u4e00\u4e2a\u4e0d\u540c\u7684\u5b9e\u4f53\u3002</p> <p>\u9488\u5bf9\u4e0a\u9762\u7684\u4f7f\u7528\uff0c\u6574\u578b\u548c\u6d6e\u70b9\u578b\u90fd\u751f\u6210\u4e86\u4e00\u4e2a\u5bf9\u5e94\u7684\u51fd\u6570\u3002</p> <p>\u5bf9\u4e8e\u51fd\u6570\u6a21\u677f\u7684\u53c2\u6570\uff0c\u662f\u53ef\u4ee5\u5728\u8c03\u7528\u65f6\u663e\u793a\u6307\u5b9a\u7684\uff0c\u53e6\u5916\u53ef\u4ee5\u5728\u8c03\u7528\u65f6\u5bf9\u7c7b\u578b\u505a\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\uff0c\u8fd9\u662f\u56e0\u4e3a\u6a21\u677f\u4e0d\u5141\u8bb8\u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\uff0c\u6240\u4ee5\u9700\u8981\u6211\u4eec\u624b\u52a8\u6765\u5b8c\u6210\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-1/#_2","title":"\u51fd\u6570\u6a21\u677f\u7684\u91cd\u8f7d","text":"<p>\u548c\u666e\u901a\u51fd\u6570\u4e00\u6837\uff0c\u51fd\u6570\u6a21\u677f\u4e5f\u53ef\u4ee5\u91cd\u8f7d\uff0c\u4e5f\u5c31\u662f\u76f8\u540c\u51fd\u6570\u540d\u79f0\u53ef\u4ee5\u5177\u6709\u4e0d\u540c\u7684\u51fd\u6570\u5b9a\u4e49\u3002</p> <pre><code>inline int const &amp;max(int const &amp;a, int const &amp;b) {\n    return a &lt; b ? b : a;\n}\n\ntemplate&lt;typename T&gt;\ninline T const &amp;max(T const &amp;a, T const &amp;b) {\n    return a &lt; b ? b : a;\n}\n\ntemplate&lt;typename T&gt;\ninline T const &amp;max(T const &amp;a, T const &amp;b, T const &amp;c) {\n    return ::max(::max(a,b),c);\n}\n</code></pre> <p>\u5982\u4e0a\u6240\u793a\uff0c\u4e00\u4e2a\u975e\u51fd\u6570\u6a21\u677f\u53ef\u4ee5\u5408\u4e00\u4e2a\u540c\u540d\u7684\u51fd\u6570\u6a21\u677f\u540c\u65f6\u5b58\u5728\uff0c\u800c\u4e14\u8be5\u51fd\u6570\u6a21\u677f\u8fd8\u53ef\u4ee5\u88ab\u5b9e\u4f8b\u5316\u4e3a\u8fd9\u4e2a\u975e\u51fd\u6570\u6a21\u677f\u3002</p> <p>\u5bf9\u4e8e\u975e\u51fd\u6570\u6a21\u677f\u548c\u540c\u540d\u7684\u51fd\u6570\u6a21\u677f\uff0c\u5982\u679c\u5176\u4ed6\u6761\u4ef6\u90fd\u76f8\u540c\u7684\u8bdd\uff0c\u90a3\u4e48\u5728\u8c03\u7528\u7684\u65f6\u5019\uff0c\u91cd\u8f7d\u89e3\u6790\u8fc7\u7a0b\u901a\u5e38\u4f1a\u8c03\u7528\u975e\u51fd\u6570\u6a21\u677f\uff0c\u800c\u4e0d\u4f1a\u4ece\u8be5\u6a21\u677f\u4ea7\u751f\u4e00\u4e2a\u5b9e\u4f8b\u3002</p> <p>\u5bf9\u4e8e\u51fd\u6570\u7684\u91cd\u8f7d\uff0c\u4e00\u822c\u6765\u8bf4\u6539\u53d8\u7684\u5185\u5bb9\u6700\u597d\u662f\u4e0b\u9762\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u6539\u53d8\u53c2\u6570\u7684\u6570\u76ee</li> <li>\u663e\u793a\u5730\u6307\u5b9a\u6a21\u677f\u53c2\u6570</li> </ul> <p>\u9075\u5faa\u4ee5\u4e0a\u4e24\u70b9\uff0c\u907f\u514d\u5728\u91cd\u8f7d\u51fd\u6570\u8c03\u7528\u8fc7\u4e8e\u590d\u6742\uff0c\u4ece\u800c\u5bfc\u81f4\u5339\u914d\u51fa\u5dee\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-1/#_3","title":"\u7c7b\u6a21\u677f","text":"<p>\u4e0e\u51fd\u6570\u6a21\u677f\u76f8\u4f3c\uff0c\u7c7b\u53ef\u4ee5\u88ab\u4e00\u79cd\u6216\u8005\u591a\u79cd\u7c7b\u578b\u53c2\u6570\u5316\u3002</p> <p>\u4ee5\u4e0b\u4ee3\u7801\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u7c7b\u6a21\u677f\u793a\u4f8b\uff1a</p> <pre><code>template&lt;typename T&gt;\nclass Stack {\nprivate:\n    std::vector&lt;T&gt; elems;\npublic:\n        void push(T const&amp;);\n        void pop();\n        T top() const;\n        bool empty() const{\n            return elems.empty();\n        }\n};\n\ntemplate&lt;typename T&gt;\nvoid Stack&lt;T&gt;::push(const T &amp; elem) {\n    elems.push_back(elem);\n}\n\ntemplate&lt;typename T&gt;\nvoid Stack&lt;T&gt;::pop() {\n    if (!elems.empty()){\n        elems.pop_back();\n    }\n}\n\ntemplate&lt;typename T&gt;\nT Stack&lt;T&gt;::top() const {\n    if (!elems.empty()){\n        return elems.back();\n    }\n    throw std::out_of_range(\"Stack::top(); empty Stack\");\n}\n\nint main() {\n    Stack&lt;int&gt; intStack;\n    intStack.push(1);\n    intStack.top();\n    intStack.pop();\n    return 0;\n}\n</code></pre> <p>\u7c7b\u6a21\u677f\u7684\u58f0\u660e\u548c\u51fd\u6570\u6a21\u677f\u58f0\u660e\u5f88\u7c7b\u4f3c\uff0c\u5728\u58f0\u660e\u4e4b\u524d\u90fd\u7528 <code>typename</code> \u58f0\u660e\u4f5c\u4e3a\u7c7b\u578b\u53c2\u6570\u7684\u6807\u8bc6\u7b26\u3002</p> <p>\u5728\u5b9a\u4e49\u7c7b\u6a21\u677f\u7684\u6210\u5458\u51fd\u6570\u65f6\uff0c\u5173\u4e8e\u6210\u5458\u51fd\u6570\u7684\u5b9e\u73b0\uff0c\u53ef\u4ee5\u5728\u7c7b\u58f0\u660e\u91cc\u9762\u53bb\u5b9e\u73b0\uff0c\u4e5f\u53ef\u4ee5\u653e\u5230\u5916\u9762\u53bb\u5b9e\u73b0\u3002</p> <p>\u5982\u679c\u662f\u5728\u7c7b\u5916\u9762\u58f0\u660e\u7684\uff0c\u90a3\u4e48\u5fc5\u73b0\u8981\u6307\u5b9a\u8be5\u6210\u5458\u51fd\u6570\u662f\u4e00\u4e2a\u51fd\u6570\u6a21\u677f\uff0c\u800c\u4e14\u8fd8\u9700\u8981\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u6a21\u677f\u7684\u5b8c\u6574\u7c7b\u578b\u9650\u5b9a\u7b26\u3002</p> <p>\u53e6\u5916\uff0c\u53ea\u6709\u90a3\u4e9b\u88ab\u8c03\u7528\u7684\u6210\u5458\u51fd\u6570\uff0c\u624d\u4f1a\u4ea7\u751f\u8fd9\u4e9b\u51fd\u6570\u7684\u5b9e\u4f8b\u5316\u4ee3\u7801\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-1/#_4","title":"\u7c7b\u6a21\u677f\u7684\u7279\u5316","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u6a21\u677f\u5b9e\u53c2\u6765\u7279\u5316\u7c7b\u6a21\u677f\u3002</p> <p>\u548c\u51fd\u6570\u6a21\u677f\u7684\u91cd\u8f7d\u7c7b\u4f3c\uff0c\u901a\u8fc7\u7279\u5316\u7c7b\u6a21\u677f\uff0c\u53ef\u4ee5\u4f18\u5316\u57fa\u4e8e\u67d0\u79cd\u7279\u5b9a\u7c7b\u578b\u7684\u5b9e\u73b0\uff0c\u6216\u8005\u514b\u670d\u67d0\u79cd\u7279\u5b9a\u7c7b\u578b\u5728\u5b9e\u4f8b\u5316\u7c7b\u6a21\u677f\u65f6\u6240\u51fa\u73b0\u7684\u4e0d\u8db3\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c\u8981\u7279\u5316\u4e00\u4e2a\u7c7b\u6a21\u677f\uff0c\u8fd8\u8981\u7279\u5316\u8be5\u7c7b\u6a21\u677f\u7684\u6240\u6709\u6210\u5458\u51fd\u6570\u3002\u867d\u7136\u4e5f\u53ef\u4ee5\u53ea\u7279\u5316\u67d0\u4e2a\u6210\u5458\u51fd\u6570\uff0c\u4f46\u8fd9\u4e2a\u505a\u6cd5\u5e76\u6ca1\u6709\u7279\u5316\u6574\u4e2a\u7c7b\uff0c\u4e5f\u5c31\u6ca1\u6709\u7279\u5316\u6574\u4e2a\u7c7b\u6a21\u677f\u3002</p> <p>\u4e3a\u4e86\u7279\u5316\u4e00\u4e2a\u7c7b\u6a21\u677f\uff0c\u5fc5\u987b\u5728\u8d77\u59cb\u5904\u58f0\u660e\u4e00\u4e2a <code>template&lt;&gt;</code> \uff0c\u63a5\u4e0b\u6765\u58f0\u660e\u7528\u7279\u5316\u7c7b\u6a21\u677f\u7684\u7c7b\u578b\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>template&lt;&gt;\nclass Stack&lt;std::string&gt; {\nprivate:\n        std::deque&lt;std::string&gt; elems;\npublic:\n        void push(std::string const&amp;);\n        void pop();\n        std::string top() const;\n        bool empty() const{\n            return elems.empty();\n        }\n};\n\nvoid Stack&lt;std::string&gt;::push(const std::string &amp;elem) {\n    elems.push_back(elem);\n}\n\nvoid Stack&lt;std::string&gt;::pop() {\n    if (!elems.empty()){\n        elems.pop_back();\n    }\n}\n\nstd::string Stack&lt;std::string&gt;::top() const {\n    if (!elems.empty()){\n        return elems.back();\n    }\n    throw std::out_of_range(\"Stack&lt;std::string&gt;::top(); empty Stack\");\n}\n\nint main() {\n    Stack&lt;std::string&gt; stringStack;\n    intStack.push(\"string\");\n    intStack.top();\n    intStack.pop();\n    return 0;\n}\n</code></pre> <p>\u8fdb\u884c\u7c7b\u6a21\u677f\u7684\u7279\u5316\u65f6\uff0c\u6bcf\u4e2a\u6210\u5458\u51fd\u6570\u90fd\u5fc5\u987b\u91cd\u65b0\u5b9a\u4e49\u4e3a\u666e\u901a\u51fd\u6570\uff0c\u539f\u6765\u51fd\u6570\u6a21\u677f\u4e2d\u7684\u6bcf\u4e2a T \u4e5f\u76f8\u5e94\u5730\u88ab\u8fdb\u884c\u7279\u5316\u7684\u7c7b\u578b\u53d6\u4ee3\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-1/#_5","title":"\u5c40\u90e8\u7279\u5316","text":"<p>\u4e0a\u9762\u7684\u7279\u5316\u53ef\u4ee5\u79f0\u4e4b\u4e3a\u5168\u7279\u5316\uff0c\u53e6\u5916\u7c7b\u6a21\u677f\u8fd8\u53ef\u4ee5\u5c40\u90e8\u7279\u5316\uff0c\u5728\u7279\u5b9a\u7684\u73af\u5883\u4e0b\u5236\u5b9a\u7c7b\u6a21\u677f\u7684\u5b9e\u73b0\uff0c\u5e76\u4e14\u8981\u6c42\u67d0\u4e9b\u6a21\u677f\u53c2\u6570\u4ecd\u7136\u5fc5\u987b\u7531\u7528\u6237\u6765\u5b9a\u4e49\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>template&lt;typename T1,typename T2&gt;\nclass MyClass{\n\n};\n\n// \u5c40\u90e8\u7279\u5316\uff0c\u4e24\u4e2a\u6a21\u677f\u53c2\u6570\u5177\u6709\u76f8\u540c\u7684\u7c7b\u578b\ntemplate&lt;typename T&gt;\nclass MyClass&lt;T,T&gt;{\n\n};\n\n// \u5c40\u90e8\u7279\u5316\uff0c \u7b2c\u4e8c\u4e2a\u6a21\u677f\u53c2\u6570\u7684\u7c7b\u578b\u662f int\ntemplate&lt;typename T&gt;\nclass MyClass&lt;T,int&gt;{\n\n};\n\n// \u5c40\u90e8\u7279\u5316\uff0c\u4e24\u4e2a\u6a21\u677f\u53c2\u6570\u90fd\u662f\u6307\u9488\u7c7b\u578b\ntemplate&lt;typename T1,typename T2&gt;\nclass MyClass&lt;T1*,T2*&gt;{\n\n};\n</code></pre> <p>\u5bf9\u4e8e\u5c40\u90e8\u7279\u5316\uff0c\u5176\u6210\u5458\u51fd\u6570\u540c\u6837\u8981\u6307\u5b9a\u662f\u6a21\u677f\u51fd\u6570\uff0c\u5e76\u4e14\u8981\u4f7f\u7528\u7279\u5316\u540e\u7684\u7c7b\u6a21\u677f\u5b8c\u6574\u7c7b\u578b\u9650\u5b9a\u7b26\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-1/#_6","title":"\u7f3a\u7701\u6a21\u677f\u5b9e\u53c2","text":"<p>\u5bf9\u4e8e\u7c7b\u6a21\u677f\uff0c\u53ef\u4ee5\u4e3a\u7c7b\u6a21\u677f\u53c2\u6570\u5b9a\u4e49\u9ed8\u8ba4\u503c\u3002\u8fd9\u4e9b\u503c\u5c31\u88ab\u79f0\u4e3a\u7f3a\u7701\u6a21\u677f\u5b9e\u53c2\uff0c\u800c\u4e14\u5b83\u4eec\u8fd8\u53ef\u4ee5\u5f15\u7528\u4e4b\u524d\u7684\u76ee\u6807\u53c2\u6570\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>template &lt;typename T,typename CONT = std::vector&lt;T&gt; &gt;\nclass MyStack{\nprivate:\n    CONT elems;\npublic:\n    void push(T const&amp;);\n    void pop();\n    T top() const;\n    bool empty() const{\n        return elems.empty();\n    }\n};\n\ntemplate&lt;typename T, typename CONT&gt;\nvoid MyStack&lt;T, CONT&gt;::push(const T &amp;elem) {\n    elems.push_back(elem);\n}\n\ntemplate&lt;typename T, typename CONT&gt;\nvoid MyStack&lt;T, CONT&gt;::pop() {\n    if (!elems.empty()){\n        elems.pop_back();\n    }\n}\n\ntemplate&lt;typename T, typename CONT&gt;\nT MyStack&lt;T, CONT&gt;::top() const {\n    if (!elems.empty()){\n        return elems.back();\n    }\n    throw std::out_of_range(\"MyStack&lt;&gt;::top(); empty Stack\");\n}\n\nint main() {\n    MyStack&lt;int&gt; intMyStack;\n    intMyStack.push(1);\n    intMyStack.top();\n    intMyStack.pop();\n\n    MyStack&lt;double, std::deque&lt;double&gt;&gt; doubleMyStack;\n    doubleMyStack.push(0.1);\n    doubleMyStack.top();\n    doubleMyStack.pop();\n    return 0;\n}\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\u4e2d\uff0c\u5982\u679c\u4e0d\u4f20\u9012\u7b2c\u4e8c\u4e2a\u6a21\u677f\u53c2\u6570\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u9ed8\u8ba4\u7684 vector \u6765\u7ba1\u7406\u5143\u7d20\u3002\u5982\u679c\u4f20\u4e86\uff0c\u5c31\u4f7f\u7528\u6307\u5b9a\u7684\u7c7b\u578b\u6765\u7ba1\u7406\u5143\u7d20\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-1/#_7","title":"\u5c0f\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u5173\u4e8e C++ \u6a21\u677f\u4e2d\u51fd\u6570\u6a21\u677f\u548c\u7c7b\u6a21\u677f\u7684\u5c0f\u603b\u7ed3\uff0c\u57fa\u672c\u4e0a\u8fd8\u662f\u5f88\u5bb9\u6613\u7406\u89e3\u7684\uff0c\u5c31\u662f\u7528\u6a21\u677f\u53c2\u6570 T \u4ee3\u66ff\u5177\u4f53\u7684\u7c7b\u578b\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u5bf9\u51fd\u6570\u6a21\u677f\u8fdb\u884c\u91cd\u8f7d\uff0c\u5bf9\u7c7b\u6a21\u677f\u8fdb\u884c\u7279\u5316\uff0c\u7c7b\u6a21\u677f\u8fd8\u53ef\u4ee5\u6307\u5b9a\u9ed8\u8ba4\u7c7b\u578b\u53c2\u6570\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-2/","title":"C++ \u6a21\u677f\u7cfb\u5217\u5c0f\u7ed302-\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570","text":"<p>\u524d\u9762\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u51fd\u6570\u6a21\u677f\u548c\u7c7b\u6a21\u677f\uff0c\u8fd8\u4ecb\u7ecd\u4e86\u7c7b\u6a21\u677f\u7684\u9ed8\u8ba4\u53c2\u6570\uff0c\u5728\u4ee3\u7801\u793a\u4f8b\u4e2d\u90fd\u662f\u7528\u5177\u4f53\u7c7b\u578b\u6765\u4f5c\u4e3a\u6a21\u677f\u53c2\u6570\u7684\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6a21\u677f\u53c2\u6570\u4e0d\u5c40\u9650\u4e8e\u7c7b\u578b\uff0c\u666e\u901a\u503c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u6a21\u677f\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u672c\u7bc7\u8981\u8bb2\u7684\u5185\u5bb9\uff1a\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-2/#_1","title":"\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570","text":"<p>\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570\u7684\u4f7f\u7528\u548c\u7c7b\u578b\u6a21\u677f\u53c2\u6570\u6709\u4e9b\u4e0d\u4e00\u6837\uff0c\u4e0d\u9700\u8981 <code>typename</code> \u5173\u952e\u5b57\u4e86\uff0c\u76f4\u63a5\u6307\u5b9a\u5177\u4f53\u7c7b\u578b\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>template&lt;typename T, int MAXSIZE = 20&gt;\nclass STACK {\nprivate:\n    T elems[MAXSIZE];\n    int numElems;\n\npublic:\n    STACK();\n\n    void push(T const &amp;);\n    void pop();\n    T top() const;\n    bool empty() const {\n        return numElems == 0;\n    }\n\n    bool full() const {\n        return numElems == MAXSIZE;\n    }\n};\n\ntemplate&lt;typename T, int MAXSIZE&gt;\nSTACK&lt;T, MAXSIZE&gt;::STACK() :numElems(0) {\n\n}\n\ntemplate&lt;typename T, int MAXSIZE&gt;\nvoid STACK&lt;T, MAXSIZE&gt;::push(const T &amp;elem) {\n    if (numElems == MAXSIZE) {\n        throw std::out_of_range(\"Stack&lt;&gt;::push(): stack is full\");\n    }\n    elems[numElems] = elem;\n    numElems++;\n}\n\ntemplate&lt;typename T, int MAXSIZE&gt;\nvoid STACK&lt;T, MAXSIZE&gt;::pop() {\n    if (numElems &lt;= 0) {\n        throw std::out_of_range(\"Stack&lt;&gt;::pop(): empty stack\");\n    }\n    numElems--;\n}\n\ntemplate&lt;typename T, int MAXSIZE&gt;\nT STACK&lt;T, MAXSIZE&gt;::top() const {\n    if (numElems &lt;= 0) {\n        throw std::out_of_range(\"Stack&lt;&gt;::top(): empty stack\");\n    }\n    return elems[numElems - 1];\n}\n\nint main() {\n    STACK&lt;int&gt; intStack;\n    intStack.push(1);\n    intStack.top();\n    intStack.pop();\n\n    STACK&lt;int,10&gt; int10Stack;\n    int10Stack.push(1);\n    int10Stack.top();\n    int10Stack.pop();\n    return 0;\n}\n</code></pre> <p>\u5728\u4f7f\u7528\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f\u57fa\u4e8e\u503c\u7684\u6a21\u677f\u53c2\u6570\uff0c\u8981\u4e48\u663e\u793a\u5730\u6307\u5b9a\u8fd9\u4e9b\u503c\uff0c\u8981\u4e48\u4f5c\u4e3a\u9ed8\u8ba4\u53c2\u6570\u6709\u9ed8\u8ba4\u503c\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-2/#_2","title":"\u975e\u7c7b\u578b\u7684\u51fd\u6570\u6a21\u677f\u53c2\u6570","text":"<p>\u9664\u4e86\u4e0a\u9762\u7684\u7c7b\u6a21\u677f\uff0c\u51fd\u6570\u6a21\u677f\u540c\u6837\u53ef\u4ee5\u7528\u975e\u7c7b\u578b\u7684\u6a21\u677f\u53c2\u6570\u3002</p> <pre><code>template &lt;typename T,int VAL = 3 &gt;\nT addValue(T const&amp;x){\n    return x + VAL;\n}\n\nint main{\n    addValue(10);\n    return 0;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u51fd\u6570\u6a21\u677f\u540c\u6837\u662f\u53ef\u4ee5\u7528\u9ed8\u8ba4\u53c2\u6570\u503c\u7684\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-2/#_3","title":"\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570\u7684\u9650\u5236","text":"<p>\u4e0d\u662f\u6240\u6709\u7684\u7c7b\u578b\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570\uff0c\u5b83\u662f\u6709\u9650\u5236\u7684\u3002</p> <p>\u901a\u5e38\u800c\u8a00\uff0c\u53ea\u6709\u5e38\u6574\u6570\uff08\u5305\u62ec\u679a\u4e3e\u503c\uff09\u6216\u8005\u6307\u5411\u5916\u5305\u94fe\u63a5\u5bf9\u8c61\u7684\u6307\u9488 \u624d\u53ef\u4ee5\uff0c\u800c\u6d6e\u70b9\u6570\u548c\u7c7b\u5bf9\u8c61\u662f\u4e0d\u5141\u8bb8\u4f5c\u4e3a\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570\u7684\u3002</p> <pre><code>template&lt;double VAT&gt;\ndouble process(double v){\n    return v * VAT;\n}\n</code></pre> <p>\u4ee5\u4e0a\u7684\u4ee3\u7801\u793a\u4f8b\u5c31\u662f\u4e0d\u884c\u7684\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-2/#_4","title":"\u5c0f\u7ed3","text":"<p>\u975e\u7c7b\u578b\u6a21\u677f\u53c2\u6570\u53ea\u662f C++ \u6a21\u677f\u77e5\u8bc6\u70b9\u91cc\u9762\u4e00\u4e2a\u5c0f\u65b9\u9762\u4e86\uff0c\u4f46\u5728\u67d0\u4e9b\u573a\u666f\u8fd8\u5728\u80fd\u53d1\u6325\u5927\u4f5c\u7528\u7684\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-3/","title":"C++ \u6a21\u677f\u7cfb\u5217\u5c0f\u7ed303-\u5728\u6a21\u677f\u4e2d\u6307\u5b9a\u53d8\u91cf\u7c7b\u578b","text":"<p>\u5728\u4e4b\u524d\u7684\u4ee3\u7801\u793a\u4f8b\u4e2d\uff0c\u9891\u7e41\u7528\u5230 <code>typename</code> \u5173\u952e\u5b57\u3002</p> <p>\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u58f0\u660e\u6a21\u677f\u53c2\u6570\u662f\u7c7b\u578b\u53c2\u6570\uff08\u5bf9\u4e8e\u975e\u7c7b\u578b\u53c2\u6570\uff0c\u4e4b\u524d\u7684\u6587\u7ae0\u4e5f\u6709\u63d0\u5230\u4e86\uff09\uff0c\u4e5f\u53ef\u4ee5\u7528 <code>class</code> \u5173\u952e\u5b57\u6765\u4ee3\u66ff\uff0c\u4f46\u4e3a\u4e86\u907f\u514d\u6b67\u4e49\uff0c\u5927\u591a\u8fd8\u662f\u4f7f\u7528 <code>typename</code> \u4e86\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u5728\u6a21\u677f\u7684\u5b9a\u4e49\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>typename</code> \u5173\u952e\u5b57\uff0c\u7528\u6765\u6307\u5b9a\u53d8\u91cf\u7684\u7c7b\u578b\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a</p> <pre><code>class Foo{\npublic:\n    typedef int num;\n    static int order;\n};\n\nint main(){\n    Foo::num a = 10;\n    Foo::order = 10;\n    return 0;\n}\n</code></pre> <p>\u4ee5\u4e0a\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7c7b Foo \uff0c\u5e76\u4e14\u5728\u7c7b\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7c7b\u578b\u522b\u540d <code>Foo::num</code> \uff0c\u540e\u7eed\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u8be5\u7c7b\u578b\u522b\u540d\u3002</p> <p>\u540c\u65f6\u4e5f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u7c7b\u53d8\u91cf <code>order</code> \uff0c\u540e\u7eed\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8be5\u7c7b\u53d8\u91cf\u3002</p> <p>\u7c7b\u53d8\u91cf\u548c\u7c7b\u4e2d\u58f0\u660e\u7684\u522b\u540d\u4f7f\u7528\u65b9\u5f0f\u6709\u76f8\u4f3c\u4e4b\u5904\uff0c\u90fd\u662f\u901a\u8fc7 <code>XX::XX</code> \u7684\u5f62\u5f0f\u4f7f\u7528\uff0c\u4f46\u4e00\u4e2a\u662f\u53d8\u91cf\uff0c\u4e00\u4e2a\u662f\u7c7b\u578b\u540d\u79f0\uff0c\u8fd9\u662f\u4e24\u8005\u7684\u6839\u672c\u5dee\u522b\u3002</p> <p>\u5047\u8bbe\u73b0\u5728\u5b9a\u4e49\u4e86\u5982\u4e0b\u7684 MyClass \u7c7b\u6a21\u677f\uff1a</p> <pre><code>template&lt;typename T&gt;\nclass MyClass {\nprivate:\n    T::num * a;\n};\n</code></pre> <p>\u7531\u4e8e\u7c7b\u53d8\u91cf\u548c\u7c7b\u4e2d\u522b\u540d\u7684\u76f8\u4f3c\u4e4b\u5904\uff0c\u6b64\u65f6\u7f16\u8bd1\u5668\u5c06\u4e0d\u77e5\u9053 T::num \u5230\u5e95\u662f\u53d8\u91cf\u8fd8\u662f\u7c7b\u578b\uff0c\u5982\u679c\u662f\u53d8\u91cf\u7684\u8bdd\uff0c\u52a0\u4e0a\u540e\u9762\u7684 * \u53f7\u4f1a\u88ab\u5f53\u6210\u662f\u4e00\u4e2a\u4e58\u6cd5\u64cd\u4f5c\u3002</p> <p>\u8fd9\u65f6\u5c31\u9700\u8981\u5728\u7c7b\u6a21\u677f\u5b9a\u4e49\u4e2d\u4f7f\u7528 <code>typename</code> \u5173\u952e\u5b57\u6307\u5b9a T::num \u662f\u4e00\u4e2a\u7c7b\u578b\u800c\u4e0d\u662f\u53d8\u91cf\u3002</p> <p>\u5982\u4e0b\u6240\u793a:</p> <pre><code>template&lt;typename T&gt;\nclass MyClass {\nprivate:\n   typename T::num * a;\n};\n</code></pre> <p>\u901a\u5e38\u800c\u8a00\uff0c\u5f53\u67d0\u4e2a\u4f9d\u8d56\u4e8e\u6a21\u677f\u53c2\u6570\u7684\u540d\u79f0\u662f\u4e00\u4e2a\u7c7b\u578b\u65f6\uff0c\u5c31\u5e94\u8be5\u4f7f\u7528 <code>typename</code> \u3002</p> <p>\u4e00\u4e2a\u5178\u578b\u7684\u5e94\u7528\u5c31\u662f\u5728\u6a21\u677f\u4ee3\u7801\u4e2d\u8bbf\u95ee STL \u5bb9\u5668\u7684\u8fed\u4ee3\u5668\uff1a</p> <pre><code>template&lt;typename T&gt;\nvoid printcoll(T const &amp;coll) {\n    typename T::const_iterator pos;\n    typename T::const_iterator end(coll.end());\n\n    for (pos = coll.begin(); pos != end; pos++) {\n        std::cout &lt;&lt; *pos &lt;&lt; std::endl;\n    }\n}\n</code></pre>","tags":["C++"]},{"location":"code/c%2B%2B-template-4/","title":"C++ \u6a21\u677f\u7cfb\u5217\u5c0f\u7ed304-\u7c7b\u6a21\u677f\u4e2d\u7684\u6210\u5458\u6a21\u677f","text":"<p>\u5728\u4e4b\u524d\u7684\u7c7b\u6a21\u677f\u4e2d\uff0c\u53ea\u5728\u7c7b\u58f0\u660e\u65f6\u7528\u4e86 typename \u6307\u5b9a\u6a21\u677f\u53c2\u6570\u7c7b\u578b\uff0c\u4e4b\u540e\u7684\u6210\u5458\u51fd\u6570\u590d\u7528\u6a21\u677f\u53c2\u6570\u7c7b\u578b\u3002</p> <p>\u4f46\u5b9e\u9645\u4e0a\uff0c\u7c7b\u6210\u5458\u4e5f\u53ef\u4ee5\u662f\u6a21\u677f\uff0c\u5d4c\u5957\u7c7b\u548c\u6210\u5458\u51fd\u6570\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u6a21\u677f\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>template&lt;typename T&gt;\nclass Stack {\nprivate:\n    std::deque&lt;T&gt; elems;\n\npublic:\n    void push(T const &amp;elem);\n\n    void pop();\n\n    T top() const;\n\n    bool empty() const {\n        return elems.empty();\n    }\n\n    template&lt;typename T2&gt;\n    Stack&lt;T&gt; &amp;operator=(Stack&lt;T2&gt; const &amp;);\n};\n\ntemplate&lt;typename T&gt;\nvoid Stack&lt;T&gt;::push(const T &amp;elem) {\n    elems.push_back(elem);\n}\n\ntemplate&lt;typename T&gt;\nvoid Stack&lt;T&gt;::pop() {\n    if (!elems.empty()) {\n        elems.pop_back();\n    }\n}\n\ntemplate&lt;typename T&gt;\nT Stack&lt;T&gt;::top() const {\n    if (!elems.empty()) {\n        return elems.back();\n    }\n    throw std::out_of_range(\"Stack::top(); empty Stack\");\n}\n\ntemplate&lt;typename T&gt;\ntemplate&lt;typename T2&gt;\nStack&lt;T&gt; &amp;Stack&lt;T&gt;::operator=(const Stack&lt;T2&gt; &amp;op2) {\n    if ((void *) this == (void *) &amp;op2) {\n        return *this;\n    }\n\n    Stack&lt;T2&gt; tmp(op2);\n    elems.clear();\n    while (!tmp.empty()) {\n        elems.push_front(tmp.top());\n        tmp.pop();\n    }\n    return *this;\n}\n</code></pre> <p>\u4ee5\u4e0a\u7c7b\u548c\u4e4b\u524d\u5b9a\u4e49\u7684 Stack \u7c7b\u7565\u6709\u5dee\u522b\uff0c\u4e3b\u8981\u662f\u81ea\u5b9a\u4e49\u4e86\u8d4b\u503c\u8fd0\u7b97\u7b26\uff0c\u53ef\u4ee5\u5c06\u4e24\u4e2a\u4e0d\u540c\u7c7b\u578b\u7684 Stack \u5bb9\u5668\u5185\u5bb9\u8fdb\u884c\u8f6c\u6362\u3002</p> <p>\u5728\u81ea\u5b9a\u4e49\u7684\u8d4b\u503c\u8fd0\u7b97\u7b26\u4e2d\uff0c\u9664\u4e86\u7c7b\u6a21\u677f\u58f0\u660e\u7684\u7c7b\u578b\u53c2\u6570 T \u4e4b\u5916\uff0c\u8fd8\u591a\u4e86\u4e00\u4e2a T2 \u7684\u7c7b\u578b\u53c2\u6570\uff0c\u6b64\u65f6\u7684\u6210\u5458\u51fd\u6570\u4e5f\u6210\u4e86\u4e00\u4e2a\u6a21\u677f\u51fd\u6570\u3002</p> <p>\u5728\u7c7b\u6a21\u677f\u4e2d\uff0c\u6210\u5458\u51fd\u6570\u7684\u6a21\u677f\u53c2\u6570\u53ef\u4ee5\u548c\u7c7b\u7684\u6a21\u677f\u53c2\u6570\u4e0d\u540c\uff0c\u4f46\u5728\u5b9a\u4e49\u4e2d\u5fc5\u987b\u6dfb\u52a0\u4e24\u4e2a\u6a21\u677f\u53c2\u6570\u5217\u8868\u3002</p> <p>\u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u4e3a\u7c7b\u7684\u6a21\u677f\u53c2\u6570\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u6210\u5458\u51fd\u6570\u7684\u3002</p> <pre><code>template&lt;typename T&gt;\nclass MyClass {\npublic:\n    template&lt;typename T2&gt; \n    void func(T2 t2);\n};\n\ntemplate&lt;typename T&gt;\ntemplate&lt;typename T2&gt;\nvoid MyClass&lt;T&gt;::func(T2 t2) {\n\n}\n</code></pre> <p>\u540c\u6837\u7684\uff0c\u7c7b\u6a21\u677f\u7684\u6210\u5458\u6a21\u677f\u4e5f\u53ea\u6709\u5728\u8c03\u7528\u65f6\u624d\u4f1a\u5b9e\u4f8b\u5316\uff0c\u5426\u5219\u4e0d\u4f1a\u3002</p> <p>\u6210\u5458\u6a21\u677f\u65e2\u53ef\u4ee5\u5728\u7c7b\u6a21\u677f\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5728\u666e\u901a\u7c7b\u4e2d\u3002</p> <pre><code>class MyClass2{\npublic:\n    template&lt;typename T&gt;\n    void func(T t);\n};\n\ntemplate&lt;typename T&gt;\nvoid MyClass2::func(T t) {\n\n}\n</code></pre>","tags":["C++"]},{"location":"code/c%2B%2B-template-5/","title":"C++ \u6a21\u677f\u7cfb\u5217\u5c0f\u7ed305-\u6a21\u677f\u7c7b\u578b\u4f5c\u4e3a\u6a21\u677f\u53c2\u6570","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\uff0c\u6a21\u677f\u53c2\u6570\u9664\u4e86\u662f\u7c7b\u578b\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u662f\u975e\u7c7b\u578b\u53c2\u6570\uff0c\u4f46\u53ea\u6709\u6574\u578b\u548c\u6307\u5411\u5916\u90e8\u94fe\u63a5\u5bf9\u8c61\u7684\u6307\u9488\u624d\u53ef\u4ee5\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u6a21\u677f\u7c7b\u578b\u540c\u6837\u53ef\u4ee5\u4f5c\u4e3a\u7c7b\u578b\u53c2\u6570\uff0c\u5e76\u4e14\u8fd8\u5f88\u6709\u7528\u5904\u3002</p> <p>\u5728\u4e4b\u524d\u5b9a\u4e49\u8fc7\u5982\u4e0b\u7684\u7c7b\u6a21\u677f\uff1a</p> <pre><code>template &lt;typename T,typename CONT = std::vector&lt;T&gt; &gt;\nclass Stack{\n\n};\n\nint main() {\n    Stack&lt;int&gt; stack1;\n    Stack&lt;int,std::vector&lt;int&gt;&gt; stack2;\n    return 0;\n}\n</code></pre> <p>\u8981\u4f7f\u7528\u5982\u4e0a\u7684\u7c7b\u6a21\u677f\uff0c\u5e76\u4e14\u4e0d\u4f7f\u7528\u9ed8\u8ba4\u53c2\u6570\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6307\u5b9a\u5bb9\u5668\u7c7b\u578b\u548c\u5bb9\u5668\u6240\u5305\u542b\u7684\u5143\u7d20\u7c7b\u578b\u3002</p> <p>\u4f46\u5982\u679c\u501f\u52a9\u6a21\u677f\u53c2\u6570\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u53ea\u6307\u5b9a\u5bb9\u5668\u7684\u7c7b\u578b\u800c\u4e0d\u9700\u8981\u6307\u5b9a\u6240\u5305\u542b\u5143\u7d20\u7684\u7c7b\u578b\u3002</p> <p>\u4e3a\u4e86\u8fbe\u5230\u4e0a\u8ff0\u76ee\u6807\uff0c\u5c31\u9700\u8981\u628a\u7b2c\u4e8c\u4e2a\u6a21\u677f\u53c2\u6570\u6307\u5b9a\u4e3a\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\uff0c\u58f0\u660e\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>template &lt;typename T, template&lt;typename ELEM&gt; class CONT = std::deque&gt;\nclass Stack{\nprivate:\n    CONT&lt;T&gt; elems;\npublic:\n    void push(T const&amp;);\n    void pop();\n    T top() const;\n    bool empty() const{\n        return elems.empty();\n    }\n};\n</code></pre> <p>\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0c\u7b2c\u4e8c\u4e2a\u6a21\u677f\u53c2\u6570\u9009\u62e9\u88ab\u58f0\u660e\u4e3a\u4e00\u4e2a\u7c7b\u6a21\u677f\u3002</p> <pre><code>template&lt;typename ELEM&gt; class CONT = std::deque\n</code></pre> <p>\u5728\u4f7f\u7528\u65f6\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5fc5\u73b0\u5f97\u662f\u4e00\u4e2a\u7c7b\u6a21\u677f\uff0c\u5e76\u4e14\u7531\u7b2c\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\u4f20\u9012\u8fdb\u6765\u7684\u7c7b\u578b\u8fdb\u884c\u5b9e\u4f8b\u5316\uff0c\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>CONT&lt;T&gt; elems;\n</code></pre> <p>\u8fd9\u4e5f\u662f\u6bd4\u8f83\u7279\u522b\u7684\u5730\u65b9\uff0c\u4f7f\u7528\u7b2c\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u6a21\u677f\u53c2\u6570\u7684\u5b9e\u4f8b\u5316\u7c7b\u578b\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u53ef\u4ee5\u4f7f\u7528\u7c7b\u6a21\u677f\u5185\u90e8\u7684\u4efb\u4f55\u7c7b\u578b\u6765\u5b9e\u4f8b\u5316\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-5/#class","title":"\u4f7f\u7528 Class \u5173\u952e\u5b57","text":"<p>\u4f5c\u4e3a\u6a21\u677f\u53c2\u6570\u7684\u58f0\u660e\uff0c\u901a\u5e38\u53ef\u4ee5\u4f7f\u7528 typename \u5173\u952e\u5b57\u6765\u66ff\u6362 class \u3002\u4f46\u662f\u4e0a\u9762\u7684 CONT \u662f\u4e3a\u4e86\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u4e00\u4e2a\u6a21\u677f\u7c7b\uff0c\u56e0\u6b64\u53ea\u80fd\u4f7f\u7528\u5173\u952e\u5b57 <code>class</code> \u3002</p> <p>\u6240\u4ee5\u5982\u4e0b\u7684\u58f0\u660e\u53cd\u800c\u662f\u9519\u8bef\u7684\uff1a</p> <pre><code>template &lt;typename T, template&lt;typename ELEM&gt; typename CONT = std::deque&gt;\n</code></pre> <p>\u4f46\u4e5f\u4e0d\u662f\u7edd\u5bf9\u7684\uff0c\u5728 C++17 \u4e2d\u4e5f\u662f\u5141\u8bb8\u4e0a\u9762\u58f0\u660e\u65b9\u5f0f\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u7531\u4e8e\u4ee3\u7801\u4e2d\u5b9e\u9645\u4e0a\u7528\u4e0d\u5230 \"\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\" \u4e2d\u7684\u6a21\u677f\u53c2\u6570\uff0c\u4e5f\u5c31\u662f <code>ELEM</code> \uff0c\u6240\u4ee5\u5b83\u662f\u53ef\u4ee5\u7701\u7565\u4e0d\u5199\u7684\u3002</p> <p>\u7701\u7565\u4e4b\u540e\u7684\u58f0\u660e\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>template &lt;typename T, template&lt;typename&gt; class CONT = std::deque&gt;\nclass Stack{\nprivate:\n    CONT&lt;T&gt; elems;\npublic:\n    void push(T const&amp;);\n    void pop();\n    T top() const;\n    bool empty() const{\n        return elems.empty();\n    }\n};\n</code></pre> <p>\u63a5\u4e0b\u6765\u5728\u5b9a\u4e49\u51fd\u6570\u5b9e\u73b0\u65f6\uff0c\u4e5f\u8981\u505a\u76f8\u5e94\u7684\u4fee\u6539\uff1a</p> <pre><code>template&lt;typename T, template&lt;typename&gt; class CONT&gt;\nvoid Stack&lt;T&gt;::push(const T &amp;elem) {\n    elems.push_back(elem);\n}\n\ntemplate&lt;typename T, template&lt;typename&gt; class CONT&gt;\nvoid Stack&lt;T&gt;::pop() {\n    if (!elems.empty()) {\n        elems.pop_back();\n    }\n}\n\ntemplate&lt;typename T, template&lt;typename&gt; class CONT&gt;\nT Stack&lt;T&gt;::top() const {\n    if (!elems.empty()) {\n        return elems.back();\n    }\n    throw std::out_of_range(\"Stack::top(); empty Stack\");\n}\n</code></pre> <p>\u6210\u5458\u51fd\u6570\u7684\u58f0\u660e\u8981\u548c\u7c7b\u6a21\u677f\u7684\u58f0\u660e\u4e00\u81f4\u3002</p> <p>\u53e6\u5916\uff0c\u51fd\u6570\u6a21\u677f\u662f\u4e0d\u652f\u6301\u6a21\u677f\u7c7b\u578b\u4f5c\u4e3a\u6a21\u677f\u53c2\u6570\u7684\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-5/#_1","title":"\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\u5b9e\u53c2\u5339\u914d","text":"<p>\u5b8c\u6210\u4e86\u4ee5\u4e0a\u7684\u58f0\u660e\u5b9a\u4e49\u4e4b\u540e\uff0c\u8fd8\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528 Stack \u7c7b\u6a21\u677f\uff0c\u56e0\u4e3a CONT \u7684\u9ed8\u8ba4\u503c std::deque \u548c\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570 CONT \u5e76\u4e0d\u5339\u914d\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u6a21\u677f\u7684\u6a21\u677f\u5b9e\u53c2\uff08\u6bd4\u5982 std::deque\uff09\u662f\u4e00\u4e2a\u5177\u6709\u53c2\u6570 A \u7684\u6a21\u677f\uff0c\u5b83\u5c06\u66ff\u6362\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\uff08\u6bd4\u5982 CONT\uff09\uff0c\u800c\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\u662f\u4e00\u4e2a\u5177\u6709\u53c2\u6570 B \u7684\u6a21\u677f\u3002</p> <p>std::deque \u7684\u58f0\u660e\u5982\u4e0b\uff1a</p> <pre><code>template &lt;class _Tp, class _Allocator = allocator&lt;_Tp&gt; &gt; class _LIBCPP_TEMPLATE_VIS deque;\n</code></pre> <p>\u5339\u914d\u8fc7\u7a0b\u8981\u6c42\u53c2\u6570 A \u548c\u53c2\u6570 B \u5fc5\u73b0\u5b8c\u5168\u5339\u914d\u3002\u7136\u540e\u5728\u8fd9\u91cc\uff0c\u5e76\u6ca1\u6709\u8003\u8651\u5230\u6a21\u677f\u7684\u6a21\u677f\u5b9e\u53c2\u7684\u9ed8\u8ba4\u6a21\u677f\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u7684 allocator \uff0c\u4ece\u800c\u4e5f\u5c31\u662f\u4f7f B \u4e2d\u7f3a\u5c11\u4e86\u8fd9\u4e9b\u9ed8\u8ba4\u53c2\u6570\u503c\uff0c\u5f53\u7136\u5c31\u4e0d\u80fd\u83b7\u5f97\u7cbe\u786e\u7684\u5339\u914d\u3002</p> <p>std::deque \u8fd8\u6709\u4e00\u4e2a\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u5185\u5b58\u5206\u914d\u5668 allocator \uff0c\u5b83\u6709\u4e00\u4e2a\u9ed8\u8ba4\u503c\uff0c\u4f46\u5728\u5339\u914d std::deque \u7684\u53c2\u6570\u548c CONT \u7684\u53c2\u6570\u65f6\uff0c\u5e76\u6ca1\u6709\u8003\u8651\u5230\u8fd9\u4e2a\u53c2\u6570\u503c\u3002</p> <p>\u56e0\u6b64\u4fee\u6539\u7c7b\u7684\u58f0\u660e\uff0c\u8ba9 CONT \u7684\u53c2\u6570\u662f\u5177\u6709\u4e24\u4e2a\u6a21\u677f\u53c2\u6570\u7684\u5bb9\u5668\u3002</p> <pre><code>template &lt;typename T, template&lt;typename ELEM,typename ALLOC = std::allocator&lt;ELEM&gt;&gt; class CONT = std::deque&gt;\nclass Stack{\nprivate:\n    CONT&lt;T&gt; elems;\npublic:\n    void push(T const&amp;);\n    void pop();\n    T top() const;\n    bool empty() const{\n        return elems.empty();\n    }\n};\n</code></pre> <p>\u7531\u4e8e ALLOC \u7528\u4e0d\u5230\uff0c\u5b9e\u9645\u4e0a\u5b83\u4e5f\u662f\u53ef\u4ee5\u7701\u7565\u7684\u3002</p> <pre><code>template &lt;typename T, template&lt;typename ELEM,typename = std::allocator&lt;ELEM&gt;&gt; class CONT = std::deque&gt;\nclass Stack{\nprivate:\n    CONT&lt;T&gt; elems;\npublic:\n    void push(T const&amp;);\n    void pop();\n    T top() const;\n    bool empty() const{\n        return elems.empty();\n    }\n};\n</code></pre> <p>\u76f8\u5e94\u7684\uff0c\u4e5f\u8981\u5c06\u6210\u5458\u51fd\u6570\u4fee\u6539\u4e86\uff0c\u51e1\u662f\u7528\u4e0d\u5230\u7684\u90fd\u53ef\u4ee5\u7701\u7565\u3002</p> <pre><code>template &lt;typename T, template&lt;typename ,typename &gt; class CONT&gt;\nvoid Stack&lt;T,CONT&gt;::push(const T &amp;elem) {\n    elems.push_back(elem);\n}\n\ntemplate &lt;typename T, template&lt;typename ,typename &gt; class CONT&gt;\nvoid Stack&lt;T,CONT&gt;::pop() {\n    if (!elems.empty()) {\n        elems.pop_back();\n    }\n}\ntemplate &lt;typename T, template&lt;typename ,typename &gt; class CONT&gt;\nT Stack&lt;T,CONT&gt;::top() const {\n    if (!elems.empty()) {\n        return elems.back();\n    }\n    throw std::out_of_range(\"Stack::top(); empty Stack\");\n}\n</code></pre> <p>\u5c06 Stack \u7684\u51fd\u6570\u58f0\u660e\u548c\u5b9e\u73b0\u62fc\u8d77\u6765\uff0c\u5c31\u662f\u6700\u7ec8\u7684\u7248\u672c\uff0c\u4f7f\u7528\u8d77\u6765\u4e5f\u4e0d\u9700\u8981\u518d\u6307\u5b9a\u5bb9\u5668\u6240\u5305\u542b\u7684\u7c7b\u578b\u4e86\u3002</p> <pre><code>int main() {\n    Stack&lt;int,std::vector&gt; intStack;\n    intStack.push(2);\n    intStack.top();\n    intStack.pop();\n    return 0;\n}\n</code></pre>","tags":["C++"]},{"location":"code/c%2B%2B-template-5/#_2","title":"\u5c0f\u7ed3","text":"<p>\u5728\u672c\u7bc7\u4e2d\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\u58f0\u660e\u65f6\uff0c\u4f7f\u7528\u5230\u4e86 class \u5173\u952e\u5b57\uff0c\u8981\u6ce8\u610f\u5b83\u7684\u4f7f\u7528\u573a\u666f\uff0c\u56e0\u4e3a\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\u662f\u4e00\u4e2a\u7c7b\uff0c\u6240\u4ee5\u8981\u7528 class \u5173\u952e\u5b57\u3002</p> <p>\u53c2\u8003 std::deque \u7684\u58f0\u660e\uff0c\u524d\u9762\u4e24\u4e2a class \u5173\u952e\u5b57\u53ef\u4ee5\u7528 typename \u66ff\u6362\uff0c\u540e\u9762\u4e00\u4e2a\u5c31\u4e0d\u884c\u4e86\u3002</p> <pre><code>template &lt;class _Tp, class _Allocator = allocator&lt;_Tp&gt; &gt; class _LIBCPP_TEMPLATE_VIS deque;\n</code></pre> <p>\u53e6\u5916\uff0c\u5728 C++ 17 \u4e4b\u540e\uff0c\u4e5f\u662f\u53ef\u4ee5\u7528 typename \u5173\u952e\u5b57\u6765\u58f0\u660e\u6a21\u677f\u7684\u6a21\u677f\u53c2\u6570\u7c7b\u578b\u4e86\uff0c\u4f46\u8003\u8651\u5230 C++ 17 \u666e\u53ca\u4f7f\u7528\u7a0b\u5ea6\u4e0d\u9ad8\uff0c\u8fd8\u662f\u6309\u7167 C++ 11 \u7684\u6807\u51c6\u6765\u5427\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-6/","title":"C++ \u6a21\u677f\u7cfb\u5217\u5c0f\u7ed306-\u53ef\u53d8\u53c2\u6570\u6a21\u677f\u7279\u6027","text":"<p>C++11 \u4e2d\u5f15\u5165\u4e86\u53ef\u53d8\u53c2\u6570\u6a21\u677f\u7684\u7279\u6027\uff0c\u53ef\u53d8\u53c2\u6570\u6a21\u677f\u5c31\u662f\u4e00\u4e2a\u63a5\u53d7\u53ef\u53d8\u6570\u76ee\u53c2\u6570\u7684\u6a21\u677f\u51fd\u6570\u6216\u8005\u6a21\u677f\u7c7b\u3002</p> <p>\u53ef\u53d8\u6570\u76ee\u7684\u53c2\u6570\u88ab\u79f0\u4e3a\u53c2\u6570\u5305\uff0c\u5b58\u5728\u5982\u4e0b\u4e24\u79cd\u53c2\u6570\u5305\uff1a</p> <ol> <li>\u6a21\u677f\u53c2\u6570\u5305\uff1a\u8868\u793a\u96f6\u4e2a\u6216\u591a\u4e2a\u6a21\u677f\u53c2\u6570</li> <li>\u51fd\u6570\u53c2\u6570\u5305\uff1a\u8868\u793a\u96f6\u4e2a\u6216\u591a\u4e2a\u51fd\u6570\u53c2\u6570</li> </ol> <p>\u5177\u4f53\u5982\u4e0b\u6240\u793a\uff0c\u58f0\u660e\u4e86\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\u51fd\u6570\u6a21\u677f\u3002</p> <pre><code>// Args \u662f\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\u5305\uff1brest \u662f\u4e00\u4e2a\u51fd\u6570\u53c2\u6570\u5305\n// Args \u8868\u793a\u96f6\u4e2a\u6216\u591a\u4e2a\u6a21\u677f\u7c7b\u578b\u53c2\u6570\n// rest \u8868\u793a\u96f6\u4e2a\u6216\u591a\u4e2a\u51fd\u6570\u53c2\u6570\ntemplate &lt;typename T,typename... Args&gt;\nvoid foo(const T &amp;t, const Args&amp;... rest);\n</code></pre> <p>\u53ef\u53d8\u53c2\u6570\u6a21\u677f\u7684\u8868\u793a\u5f62\u5f0f\u548c\u6b63\u5e38\u53ef\u53d8\u53c2\u6570\u51fd\u6570\u7c7b\u4f3c\uff0c\u90fd\u662f\u901a\u8fc7\u7701\u7565\u53f7 <code>...</code> \u6765\u8868\u8fbe\u96f6\u4e2a\u6216\u8005\u591a\u4e2a\u7684\u542b\u4e49\u3002</p> <p>\u5728\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\u5217\u8868\u4e2d\uff0ctypename... \u6216\u8005 class... \u6307\u51fa\u63a5\u4e0b\u6765\u7684\u53c2\u6570\u8868\u793a\u96f6\u4e2a\u6216\u591a\u4e2a\u7c7b\u578b\u7684\u5217\u8868\u3002</p> <p>\u6bd4\u5982 foo \u5c31\u662f\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\u51fd\u6570\u6a21\u677f\uff0c\u9664\u4e86\u4e00\u4e2a\u540d\u4e3a T \u7684\u7c7b\u578b\u53c2\u6570\uff0c\u8fd8\u6709\u4e00\u4e2a\u540d\u4e3a Args \u7684\u6a21\u677f\u53c2\u6570\u5305\uff0c\u8fd9\u4e2a\u5305\u8868\u793a\u96f6\u4e2a\u6216\u591a\u4e2a\u989d\u5916\u7684\u7c7b\u578b\u53c2\u6570\u3002</p> <pre><code>template &lt;typename T,typename... Args&gt;\n</code></pre> <p>\u4e00\u4e2a\u7c7b\u578b\u540d\u540e\u9762\u8ddf\u4e00\u4e2a\u7701\u7565\u53f7\u8868\u793a\u96f6\u4e2a\u6216\u591a\u4e2a\u7ed9\u5b9a\u7c7b\u578b\u7684\u975e\u7c7b\u578b\u53c2\u6570\u7684\u5217\u8868\u3002</p> <p>\u5728\u51fd\u6570\u53c2\u6570\u5217\u8868\u4e2d\uff0c\u5982\u679c\u4e00\u4e2a\u53c2\u6570\u7684\u7c7b\u578b\u662f\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\u5305\uff0c\u5219\u6b64\u51fd\u6570\u4e5f\u662f\u4e00\u4e2a\u51fd\u6570\u53c2\u6570\u5305\u3002</p> <p>\u5bf9\u4e8e\u53ef\u53d8\u53c2\u6570\u6a21\u677f\uff0c\u7f16\u8bd1\u5668\u4f1a\u4ece\u5b9e\u53c2\u63a8\u65ad\u6a21\u677f\u53c2\u6570\u7c7b\u578b\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\u6a21\u677f\uff0c\u7f16\u8bd1\u5668\u8fd8\u4f1a\u63a8\u65ad\u5305\u4e2d\u53c2\u6570\u7684\u6570\u76ee\u3002</p> <p>\u6bd4\u5982\u5982\u4e0b\u7684\u8c03\u7528\uff1a</p> <pre><code>int main(){\n    int i =0;\n    double d = 3.14;\n    string s = \"variadic template\";\n\n    foo(i,s,42,d);\n    foo(s,42,\"hi\");\n    foo(d,s);\n    foo(\"hi\");\n}\n</code></pre> <p>\u7f16\u8bd1\u5668\u4f1a\u4e3a foo \u6a21\u677f\u5b9e\u4f8b\u5316\u56db\u4e2a\u4e0d\u540c\u7684\u7248\u672c\uff1a</p> <pre><code>    void foo(const int&amp;,const string&amp;,const int&amp;,const double);\n    void foo(const string&amp;,const int&amp;,const char[3] &amp;);\n    void foo(const double&amp;,const string&amp;);\n    void foo(const char[3] &amp;);\n</code></pre>","tags":["C++"]},{"location":"code/c%2B%2B-template-6/#sizeof","title":"sizeof... \u8fd0\u7b97\u7b26\u83b7\u53d6\u53c2\u6570\u6570\u91cf","text":"<p>\u5f53\u9700\u8981\u77e5\u9053\u53c2\u6570\u5305\u4e2d\u6709\u591a\u5c11\u5143\u7d20\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 sizeof... \u8fd0\u7b97\u7b26\u3002</p> <p>sizeof \u4e5f\u8fd4\u56de\u4e00\u4e2a\u5e38\u91cf\u8868\u8fbe\u5f0f\uff0c\u800c\u4e14\u4e0d\u4f1a\u5bf9\u5176\u5b9e\u53c2\u6c42\u503c\u3002</p> <pre><code>template &lt;typename... Args&gt;\nvoid count(Args... args){\n    cout &lt;&lt; \"template parameter packet size is \" &lt;&lt; sizeof...(Args) &lt;&lt; endl;\n    cout &lt;&lt; \"function parameter packet size is \" &lt;&lt; sizeof...(args) &lt;&lt; endl;\n}\n\nint main(){\n    int i =0;\n    double d = 3.14;\n    string s = \"variadic template\";\n\n    count(i,s,42,d);\n    count(d,s);\n    return 0;    \n}    \n</code></pre>","tags":["C++"]},{"location":"code/c%2B%2B-template-6/#_1","title":"\u53ef\u53d8\u53c2\u6570\u51fd\u6570\u7684\u9012\u5f52\u5c55\u5f00","text":"<p>\u53ef\u53d8\u53c2\u6570\u51fd\u6570\u901a\u5e38\u662f\u9012\u5f52\u8c03\u7528\u7684\u3002\u7b2c\u4e00\u6b65\u8c03\u7528\u5904\u7406\u5305\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b9e\u53c2\uff0c\u7136\u540e\u7528\u5269\u4f59\u5b9e\u53c2\u8c03\u7528\u81ea\u8eab\u3002</p> <p>\u5982\u4e0b print \u51fd\u6570\u6240\u793a\uff1a</p> <pre><code>// \u7528\u6765\u7ec8\u6b62\u9012\u5f52\u5e76\u6253\u5370\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u7684\u51fd\u6570\n// \u6b64\u51fd\u6570\u5fc5\u987b\u5728\u53ef\u53d8\u51fd\u6570\u53c2\u6570\u7248\u672c\u7684 print \u5b9a\u4e49\u4e4b\u524d\u58f0\u660e\ntemplate&lt;typename T&gt;\nostream &amp;print(ostream &amp;os,const T &amp;t){\n    return os &lt;&lt; t ;\n}\n\n// \u53c2\u6570\u5305\u4e2d\u9664\u4e86\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4e4b\u5916\u7684\u5176\u4ed6\u5143\u7d20\u90fd\u4f1a\u8c03\u7528\u8fd9\u4e2a\u7248\u672c\u7684 print\ntemplate&lt;typename T,typename... Args&gt;\nostream &amp;print(ostream &amp;os,const T &amp;t,const Args&amp;... rest){\n    os &lt;&lt; t &lt;&lt; \", \";\n    return print(os,rest...);\n}\n\nint main(){\n    int i =0;\n    double d = 3.14;\n    string s = \"variadic template\";\n\n    print(cout,i,s,42);\n}\n</code></pre> <p>\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2a\u7248\u672c print \u8d1f\u8d23\u7ec8\u6b62\u9012\u5f52\u5e76\u6253\u5370\u521d\u59cb\u8c03\u7528\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5b9e\u53c2\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u7248\u672c\u7684 print \u662f\u53ef\u53d8\u53c2\u6570\u7248\u672c\uff0c\u5b83\u6253\u5370\u7ed1\u5b9a\u5230 t \u7684\u5b9e\u53c2\uff0c\u5e76\u8c03\u7528\u81ea\u8eab\u6765\u6253\u5370\u51fd\u6570\u53c2\u6570\u5305\u4e2d\u5269\u4e0b\u7684\u5269\u4f59\u503c\u3002</p> <p>\u4e0a\u9762\u7a0b\u5e8f\u7684\u5173\u952e\u90e8\u5206\u662f\u53ef\u53d8\u53c2\u6570\u51fd\u6570\u4e2d\u5bf9 print \u7684\u8c03\u7528\uff1a</p> <pre><code>return print(os,rest...); \n</code></pre> <p>\u53ef\u53d8\u53c2\u6570\u7248\u672c\u7684 print \u51fd\u6570\u63a5\u53d7\u4e09\u4e2a\u53c2\u6570\uff1a\u4e00\u4e2a ostream&amp; \uff0c\u4e00\u4e2a const T&amp; \u548c\u4e00\u4e2a\u53c2\u6570\u5305\u3002</p> <p>\u800c\u4e0a\u9762\u7684\u8c03\u7528\u53ea\u4f20\u9012\u4e86\u4e24\u4e2a\u5b9e\u53c2\uff0c\u7ed3\u679c\u5c31\u662f rest \u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b9e\u53c2\u5e76\u7ed1\u5b9a\u5230 <code>t</code> \uff0c\u5269\u4f59\u5b9e\u53c2\u5f62\u6210\u4e0b\u4e00\u4e2a print \u8c03\u7528\u7684\u53c2\u6570\u5305\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u6bcf\u4e2a\u8c03\u7528\u4e2d\uff0c\u5305\u4e2d\u7684\u7b2c\u4e00\u4e2a\u5b9e\u53c2\u88ab\u79fb\u9664\uff0c\u6210\u4e3a\u7ed1\u5b9a t \u7684\u5b9e\u53c2\uff0c\u6240\u4ee5\u4e0a\u9762\u7684\u8c03\u7528\u4f1a\u9012\u5f52\u5982\u4e0b\u6267\u884c\uff1a</p> <pre><code>print(cout,i,s,42);\n\n\u9012\u5f52\u5c55\u5f00\uff1a\n\nprint(cout,i,s,42);     \nprint(cout,s,42);\nprint(cout,42);\n</code></pre> <p>\u524d\u4e24\u4e2a\u8c03\u7528\u53ea\u80fd\u4e0e\u53ef\u53d8\u53c2\u6570\u7248\u672c\u7684 print \u5339\u914d\uff0c\u975e\u53ef\u53d8\u53c2\u6570\u7248\u672c\u662f\u4e0d\u884c\u7684\u3002</p> <p>\u6700\u540e\u4e00\u4e2a\u8c03\u7528\uff0c\u4e24\u4e2a print \u7248\u672c\u90fd\u662f\u53ef\u884c\u7684\u3002\u4f46\u975e\u53ef\u53d8\u53c2\u6570\u6a21\u677f\u6bd4\u53ef\u53d8\u53c2\u6570\u6a21\u677f\u66f4\u7279\u4f8b\u5316\uff0c\u56e0\u6b64\u7f16\u8bd1\u5668\u4f1a\u9009\u62e9\u975e\u53ef\u53d8\u53c2\u6570\u6a21\u677f\u3002</p> <p>\u53ef\u53d8\u53c2\u6570\u6a21\u677f\u7684\u9012\u5f52\u8c03\u7528\u7279\u6027\u8fd8\u53ef\u4ee5\u7528\u6765\u505a\u5176\u4ed6\u7684\u8fd0\u7b97\uff0c\u6bd4\u5982\u6c42\u548c\u8fd0\u7b97:</p> <pre><code>template&lt;typename T&gt;\nT sum(T t){\n    return t;\n}\n\ntemplate&lt;typename T, typename ...Args&gt;\nT sum(T first,Args... rest){\n    return first + sum&lt;T&gt;(rest...);\n}\n\nint main(){\n    sum(1,2,3,4)\n}\n</code></pre> <p>\u9012\u5f52\u5c55\u5f00\u540e\u7684\u8c03\u7528\u987a\u5e8f\u5982\u4e0b\uff1a</p> <pre><code>sum(4);\nsum(3,4);\nsum(2,3,4);\nsum(1,2,3,4);\n</code></pre> <p>\u9012\u5f52\u5c55\u5f00\u7684\u8fd9\u4e00\u7279\u6027\uff0c\u5728\u540e\u7eed\u6a21\u677f\u5143\u7f16\u7a0b\u4e2d\u8fd8\u4f1a\u7ee7\u7eed\u7528\u5230\u7684\u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-6/#_2","title":"\u53c2\u8003","text":"<ol> <li>https://www.cnblogs.com/qicosmos/p/4325949.html</li> </ol>","tags":["C++"]},{"location":"code/c%2B%2B-template-7/","title":"C++ \u6a21\u677f\u7cfb\u5217\u5c0f\u7ed307-\u5c3e\u7f6e\u8fd4\u56de\u7c7b\u578b","text":"<p>\u5728\u4f7f\u7528\u6a21\u677f\u65f6\u53ef\u4ee5\u663e\u793a\u6307\u5b9a\u6a21\u677f\u7c7b\u578b\uff0c\u5c24\u5176\u662f\u9488\u5bf9\u6709\u8fd4\u56de\u7c7b\u578b\u7684\u6a21\u677f\uff0c\u663e\u793a\u6307\u5b9a\u53ef\u4ee5\u907f\u514d\u7c7b\u578b\u8f6c\u6362\u5e26\u6765\u7684\u56f0\u6270\u3002</p> <p>\u4f46\u6709\u65f6\u5019\u663e\u793a\u6307\u5b9a\u6a21\u677f\u5b9e\u53c2\u7c7b\u578b\u4f1a\u7ed9\u7528\u6237\u589e\u6dfb\u989d\u5916\u8d1f\u62c5\uff0c\u800c\u4e14\u4e0d\u4f1a\u5e26\u6765\u4ec0\u4e48\u597d\u5904\u3002</p> <p>\u6bd4\u5982\u5982\u4e0b\u4ee3\u7801\uff0c\u63a5\u53d7\u8868\u793a\u5e8f\u5217\u7684\u4e00\u5bf9\u8fed\u4ee3\u5668\u548c\u8fd4\u56de\u5e8f\u5217\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\u7684\u5f15\u7528\uff1a</p> <pre><code>template&lt;typename It&gt;\n??? &amp;fcn(It beg,It end){\n    return *beg;\n}\n</code></pre> <p>\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u8fd4\u56de\u7ed3\u679c\u7684\u51c6\u786e\u7c7b\u578b\uff0c\u4f46\u77e5\u9053\u6240\u9700\u7c7b\u578b\u662f\u6240\u5904\u7406\u7684\u5e8f\u5217\u7684\u5143\u7d20\u7c7b\u578b\u3002</p> <pre><code>vector&lt;int&gt; vi = {1,2,3,4,5};\nauto &amp;i =fcn(vi.begin,vi.end());\n</code></pre> <p>\u5982\u4e0a\u4ee3\u7801\uff0c\u77e5\u9053\u51fd\u6570\u5e94\u8be5\u8fd4\u56de *beg\uff0c\u800c\u4e14\u77e5\u9053\u6211\u4eec\u53ef\u4ee5\u7528 decltype(*beg) \u6765\u83b7\u53d6\u6b64\u8868\u8fbe\u5f0f\u7684\u7c7b\u578b\u3002</p> <p>\u4f46\u662f\uff0c\u5728\u7f16\u8bd1\u5668\u9047\u5230\u51fd\u6570\u7684\u53c2\u6570\u5217\u8868\u4e4b\u524d\uff0cbeg \u90fd\u662f\u4e0d\u5b58\u5728\u7684\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528**\u5c3e\u7f6e\u8fd4\u56de\u7c7b\u578b**\u3002</p> <p>\u7531\u4e8e\u5c3e\u7f6e\u8fd4\u56de\u51fa\u73b0\u5728\u53c2\u6570\u5217\u8868\u4e4b\u540e\uff0c\u5b83\u53ef\u4ee5\u4f7f\u7528\u51fd\u6570\u7684\u53c2\u6570\uff1a</p> <pre><code>// \u5c3e\u7f6e\u8fd4\u56de\u5141\u8bb8\u5728\u53c2\u6570\u5217\u8868\u4e4b\u540e\u58f0\u660e\u8fd4\u56de\u7c7b\u578b\ntemplate&lt;typename It&gt;\nauto fcn(It beg,It end) -&gt; decltype(*beg){\n    return *beg;\n}\n</code></pre> <p>\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cfcn \u7684\u8fd4\u56de\u7c7b\u578b\u548c\u89e3\u5f15\u7528 beg \u53c2\u6570\u7684\u7ed3\u679c\u7c7b\u578b\u76f8\u540c\u3002</p> <p>\u89e3\u5f15\u7528\u8fd0\u7b97\u7b26\u8fd4\u56de\u4e00\u4e2a\u5de6\u503c\uff0c\u56e0\u6b64\u901a\u8fc7 decltype \u63a8\u65ad\u7684\u7c7b\u578b\u4e3a beg \u8868\u793a\u7684\u5143\u7d20\u7684\u7c7b\u578b\u7684\u5f15\u7528\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u5bf9\u4e00\u4e2a string \u5e8f\u5217\u8c03\u7528 fcn\uff0c\u8fd4\u56de\u7c7b\u578b\u662f string&amp; \uff0c\u5982\u679c\u662f int \u5e8f\u5217\uff0c\u8fd4\u56de\u7c7b\u578b\u662f int&amp; \u3002</p> <p>\u5173\u4e8e\u4e3a\u4f55\u8fd4\u56de\u7684\u7c7b\u578b\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u53ef\u4ee5\u56de\u987e\u4e00\u4e0b decltype \u7684\u4f7f\u7528\uff1a</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-7/#decltype","title":"decltype \u7684\u4f7f\u7528","text":"<p>\u5f53\u5e0c\u671b\u4ece\u8868\u8fbe\u5f0f\u7684\u7c7b\u578b\u63a8\u65ad\u51fa\u8981\u5b9a\u4e49\u7684\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u4f46\u662f\u4e0d\u60f3\u7528\u8be5\u8868\u8fbe\u5f0f\u7684\u503c\u521d\u59cb\u5316\u53d8\u91cf\u3002\u4e3a\u4e86\u6ee1\u8db3\u8fd9\u4e00\u8981\u6c42\uff0cC++11 \u65b0\u6807\u51c6\u5f15\u5165\u4e86\u7c7b\u578b\u8bf4\u660e\u7b26 decltype \uff0c\u5b83\u7684\u4f5c\u7528\u662f\u9009\u62e9\u5e76\u8fd4\u56de\u64cd\u4f5c\u6570\u7684\u6570\u636e\u7c7b\u578b\u3002</p> <p>\u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u7f16\u8bd1\u5668\u5206\u6790\u8868\u8fbe\u5f0f\u5e76\u5f97\u5230\u5b83\u7684\u7c7b\u578b\uff0c\u5374\u4e0d\u5b9e\u9645\u8ba1\u7b97\u8868\u8fbe\u5f0f\u7684\u503c\u3002</p> <pre><code>int f(){\n    return 1;\n}\n\nint main(){\n    int x = 2;\n    decltype(f()) sum = x;\n    return 0;\n}\n</code></pre> <p>\u5982\u4e0a\u4ee3\u7801\u6240\u793a\uff0c\u7f16\u8bd1\u5668\u5e76\u4e0d\u5b9e\u9645\u8c03\u7528\u51fd\u6570 f \uff0c\u800c\u662f\u4f7f\u7528\u5f53\u8c03\u7528\u53d1\u751f\u65f6 f \u7684\u8fd4\u56de\u503c\u7c7b\u578b\u4f5c\u4e3a sum \u7684\u7c7b\u578b\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u7f16\u8bd1\u5668\u4e3a sum \u6307\u5b9a\u7684\u7c7b\u578b\u5c31\u662f f \u88ab\u8c03\u7528\u65f6\u8fd4\u56de\u7684\u90a3\u4e2a\u7c7b\u578b\u3002</p> <p>\u5982\u679c decltype \u4f7f\u7528\u7684\u8868\u8fbe\u5f0f\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u5219 decltype \u8fd4\u56de\u8be5\u53d8\u91cf\u7684\u7c7b\u578b\uff08\u5305\u62ec\u9876\u5c42 const \u548c\u5f15\u7528\u5728\u5185\uff09\u3002</p> <pre><code>const int ci = 0, &amp;cj = ci;\ndecltype(ci) x = 0;         // x \u7684\u7c7b\u578b\u662f const int\ndecltype(cj) y = x;         // y \u7684\u7c7b\u578b\u662f const int &amp; ,y \u7ed1\u5b9a\u5230\u53d8\u91cf x\ndecltype(cj) z;             // z \u662f\u4e00\u4e2a\u5f15\u7528\uff0c\u5fc5\u987b\u521d\u59cb\u5316\n</code></pre> <p>\u5982\u679c decltype \u8fd4\u56de\u7684\u53d8\u91cf\u7c7b\u578b\u662f\u4e00\u4e2a\u5f15\u7528\uff0c\u90a3\u4e48\u5bf9\u5e94\u7684\u53d8\u91cf\u5c31\u5fc5\u987b\u521d\u59cb\u5316\u624d\u884c\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c decltype \u4f7f\u7528\u7684\u8868\u8fbe\u5f0f\u4e0d\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u5219 decltype \u8fd4\u56de\u8868\u8fbe\u5f0f\u7ed3\u679c\u5bf9\u5e94\u7684\u7c7b\u578b\u3002</p> <p>\u6709\u7684\u8868\u8fbe\u5f0f\u5c06\u5411 decltype \u8fd4\u56de\u4e00\u4e2a\u5f15\u7528\u7c7b\u578b\u3002\u4e00\u822c\u6765\u8bf4\u5f53\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\u65f6\uff0c\u610f\u5473\u7740\u8be5\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u5bf9\u8c61\u80fd\u4f5c\u4e3a\u4e00\u6761\u8d4b\u503c\u8bed\u53e5\u7684\u5de6\u503c\u3002</p> <pre><code>int i = 42,*p = &amp;i, &amp;r = i;\ndecltype(r + 0) b;      //\u6b63\u786e\uff1a\u52a0\u6cd5\u7684\u7ed3\u679c\u662f int\uff0c\u56e0\u6b64 b \u662f\u4e00\u4e2a\u672a\u521d\u59cb\u5316\u7684 int\ndecltype(*p) c;         //\u9519\u8bef\uff1ac \u662f int&amp;,\u5fc5\u987b\u521d\u59cb\u5316\n</code></pre> <p>\u56e0\u4e3a r \u662f\u4e00\u4e2a\u5f15\u7528\uff0c\u56e0\u6b64 decltype\u00ae \u5fc5\u7136\u662f\u5f15\u7528\u7c7b\u578b\u3002\u5982\u679c\u60f3\u8ba9\u7ed3\u679c\u662f r \u6240\u6307\u7684\u7c7b\u578b\uff0c\u53ef\u4ee5\u628a r \u4f5c\u4e3a\u8868\u8fbe\u5f0f\u7684\u4e00\u90e8\u5206\uff0c\u5982 r+0 \uff0c\u663e\u7136\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u5c06\u662f\u4e00\u4e2a\u5177\u4f53\u6307\u800c\u975e\u4e00\u4e2a\u5f15\u7528\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c\u4e00\u4e2a\u8868\u8fbe\u5f0f\u7684\u5185\u5bb9\u662f\u89e3\u5f15\u7528\u64cd\u4f5c\uff0c\u5219 decltype \u5c06\u5f97\u5230\u5f15\u7528\u7c7b\u578b\u3002\u56e0\u4e3a\uff0c\u89e3\u5f15\u7528\u6307\u9488\u53ef\u4ee5\u5f97\u5230\u6307\u9488\u6240\u6307\u7684\u5bf9\u8c61\uff0c\u800c\u4e14\u8fd8\u80fd\u7ed9\u8fd9\u4e2a\u5bf9\u8c61\u8d4b\u503c\u3002\u56e0\u6b64\uff0cdecltype(*p) \u7684\u7ed3\u679c\u5c31\u662f int&amp; ,\u800c\u975e int \u3002</p> <p>\u53e6\u5916\uff0c\u5bf9\u4e8e decltype \u6240\u7528\u7684\u8868\u8fbe\u5f0f\u6765\u8bf4\uff0c\u5982\u679c\u53d8\u91cf\u540d\u52a0\u4e0a\u4e86\u4e00\u5bf9\u62ec\u53f7\uff0c\u5219\u5f97\u5230\u7684\u7c7b\u578b\u4e0e\u4e0d\u52a0\u62ec\u53f7\u65f6\u4f1a\u6709\u4e0d\u540c\u3002</p> <p>\u5982\u679c decltype \u4f7f\u7528\u7684\u662f\u4e00\u4e2a\u4e0d\u52a0\u62ec\u53f7\u7684\u53d8\u91cf\uff0c\u5219\u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662f\u8be5\u53d8\u91cf\u7684\u7c7b\u578b\u3002\u5982\u679c\u7ed9\u53d8\u91cf\u52a0\u4e0a\u4e86\u4e00\u5c42\u6216\u591a\u5c42\u62ec\u53f7\uff0c\u7f16\u8bd1\u5668\u4f1a\u628a\u5b83\u5f53\u6210\u4e00\u4e2a\u8868\u8fbe\u5f0f\uff0c\u800c\u53d8\u91cf\u662f\u4e00\u79cd\u53ef\u4ee5\u4f5c\u4e3a\u8d4b\u503c\u8bed\u53e5\u5de6\u503c\u7684\u7279\u6b8a\u8868\u8fbe\u5f0f\uff0c\u8fd9\u662f decltype \u5c31\u4f1a\u5f97\u5230\u5f15\u7528\u7c7b\u578b\u3002</p> <pre><code>decltype((i)) d;  // \u9519\u8bef\uff0cd \u662f\u5f15\u7528\u7c7b\u578b\uff0c int&amp; ,\u5fc5\u987b\u8981\u521d\u59cb\u5316\ndecltype(i) e;      //\u6b63\u786e\uff0ce \u662f\u672a\u521d\u59cb\u5316\u7684 int \n</code></pre>","tags":["C++"]},{"location":"code/c%2B%2B-template-7/#_1","title":"\u5c3e\u7f6e\u8fd4\u56de\u5143\u7d20\u4e3a\u503c\u800c\u975e\u5f15\u7528","text":"<p>\u5728\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u8fd4\u56de\u7684\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u4f46\u662f\u6709\u65f6\u5019\u5e0c\u671b\u8fd4\u56de\u4e00\u4e2a\u5143\u7d20\u7684\u503c\uff0c\u800c\u975e\u5f15\u7528\u3002</p> <pre><code>template&lt;typename It&gt;\nauto fcn(It beg,It end) -&gt; decltype(*beg){\n    return *beg;\n}\n</code></pre> <p>\u4f46\u95ee\u9898\u5728\u4e8e\uff0c\u65e0\u6cd5\u77e5\u9053\u4f20\u9012\u7684\u53c2\u6570\u7c7b\u578b\uff0c\u552f\u4e00\u53ef\u4ee5\u4f7f\u7528\u7684\u64cd\u4f5c\u662f\u8fed\u4ee3\u5668\u64cd\u4f5c\uff0c\u800c\u6240\u6709\u8fed\u4ee3\u5668\u64cd\u4f5c\u90fd\u4e0d\u4f1a\u751f\u6210\u5143\u7d20\uff0c\u53ea\u80fd\u751f\u6210\u5143\u7d20\u7684\u5f15\u7528\u3002</p> <p>\u4e3a\u4e86\u83b7\u5f97\u5143\u7d20\u7c7b\u578b\uff0c\u8981\u4f7f\u7528\u6807\u51c6\u5e93\u7684<code>\u7c7b\u578b\u8f6c\u6362\u6a21\u677f</code>\u3002</p> <p>\u8fd9\u4e9b\u6a21\u677f\u5b9a\u4e49\u5728\u5934\u6587\u4ef6 type_traits \u4e2d\uff0c\u4e3b\u8981\u662f\u7528\u4e8e\u6a21\u677f\u5143\u7f16\u7a0b\u8bbe\u8ba1\u7684\uff0c\u8fd9\u6b21\u4e3b\u8981\u7528\u5230 remove_reference \u6a21\u677f\uff0c\u5b83\u7684\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>template &lt;class _Tp&gt; struct _LIBCPP_TEMPLATE_VIS remove_reference        {typedef _LIBCPP_NODEBUG_TYPE _Tp type;};\n</code></pre> <p>\u5982\u540c\u5b83\u7684\u540d\u5b57\u4e00\u6837\uff0c\u5c31\u662f\u79fb\u9664\u5f15\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u6765\u83b7\u5f97\u5143\u7d20\u7c7b\u578b\u3002remove_reference \u6a21\u677f\u6709\u4e00\u4e2a\u6a21\u677f\u7c7b\u578b\u53c2\u6570\u548c\u4e00\u4e2a\u540d\u4e3a type \u7684\u7c7b\u578b\u6210\u5458\u3002</p> <p>\u5982\u679c\u7528\u4e00\u4e2a\u5f15\u7528\u7c7b\u578b\u5b9e\u4f8b\u5316 remove_reference\uff0c\u5219 type \u5c06\u8868\u793a\u88ab\u5f15\u7528\u7684\u7c7b\u578b\u3002</p> <p>\u4f8b\u5982\uff0c\u5b9e\u4f8b\u5316 remove_reference \uff0c\u5219 type \u6210\u5458\u5c06\u662f int \u3002\u7c7b\u4f3c\uff0c\u5982\u679c\u5b9e\u4f8b\u5316 remove_reference \uff0c\u5219 type \u6210\u5458\u5c06\u662f string \u3002 <p>\u5982\u679c\u7ed9\u5b9a\u4e00\u4e2a\u8fed\u4ee3\u5668 beg: </p> <pre><code>remove_reference&lt;decltype(*beg)&gt;::type\n</code></pre> <p>\u5c06\u83b7\u5f97 beg \u5f15\u7528\u7684\u5143\u7d20\u7684\u7c7b\u578b\uff1adecltype(*beg) \u8fd4\u56de\u5143\u7d20\u7c7b\u578b\u7684\u5f15\u7528\u7c7b\u578b\uff0cremove_reference::type \u8131\u53bb\u5f15\u7528\uff0c\u5269\u4e0b\u5143\u7d20\u7c7b\u578b\u672c\u8eab\u3002</p> <p>\u7ec4\u5408\u4f7f\u7528 remove_reference\u3001\u5c3e\u7f6e\u8fd4\u56de\u4ee5\u53ca decltype \uff0c\u5c31\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u8fd4\u56de\u5143\u7d20\u503c\u7684\u62f7\u8d1d\u3002</p> <pre><code>template&lt;typename It&gt;\nauto fcn2(It beg,It end) -&gt; typename remove_reference&lt;decltype(*beg)&gt;::type{\n    return *beg; // \u8fd4\u56de\u5e8f\u5217\u4e2d\u4e00\u4e2a\u5143\u7d20\u7684\u62f7\u8d1d\n}\n</code></pre> <p>\u8981\u6ce8\u610f\u7684\u662f\uff0ctype \u662f\u4e00\u4e2a\u7c7b\u7684\u6210\u5458\uff0c\u800c\u8be5\u7c7b\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u6a21\u677f\u53c2\u6570\u3002\u56e0\u6b64\uff0c\u8981\u5728\u8fd4\u56de\u7c7b\u578b\u7684\u58f0\u660e\u4e2d\u4f7f\u7528 typename \u6765\u544a\u77e5\u7f16\u8bd1\u5668\uff0ctype \u8868\u793a\u4e00\u4e2a\u7c7b\u578b\uff0c\u5173\u4e8e\u8fd9\u4e2a\u77e5\u8bc6\u70b9\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\u63d0\u5230\u8fc7\u4e86\uff0c\u53c2\u89c1\uff1aC++ \u6a21\u677f\u7cfb\u5217\u5c0f\u7ed303-\u5728\u6a21\u677f\u4e2d\u6307\u5b9a\u53d8\u91cf\u7c7b\u578b \u3002</p>","tags":["C++"]},{"location":"code/c%2B%2B-template-7/#_2","title":"\u5c0f\u7ed3","text":"<p>\u5c3e\u7f6e\u8fd4\u56de\u7c7b\u578b\u4e3b\u8981\u8fd8\u662f decltype \u7684\u4f7f\u7528\u4e86\uff0c\u800c decltype \u8981\u6ce8\u610f\u7684\u662f\u8fd4\u56de\u7684\u7c7b\u578b\u662f\u5143\u7d20\u7684\u7c7b\u578b\uff0c\u8fd8\u662f\u5f15\u7528\u7c7b\u578b\u4e86\uff0c\u5728\u4e0d\u540c\u573a\u666f\u4e0b\u6ce8\u610f\u533a\u5206\u3002</p>","tags":["C++"]},{"location":"code/java-multithread-overview/","title":"Java \u663e\u5f0f\u9501 Lock \u4e0e\u6761\u4ef6\u961f\u5217","text":"<p>\u5728 Java 5.0 \u4e4b\u524d\uff0c\u5728\u534f\u8c03\u5bf9\u5171\u4eab\u5bf9\u8c61\u7684\u8bbf\u95ee\u65f6\u53ef\u4ee5\u4f7f\u7528\u7684\u673a\u5236\u53ea\u6709 <code>synchronized</code> \u5185\u7f6e\u9501\u548c <code>volatile</code> \u5173\u952e\u5b57\u3002</p> <p>Java 5.0 \u589e\u52a0\u4e86\u4e00\u79cd\u65b0\u7684\u673a\u5236\uff1a<code>Lock</code>  \u663e\u5f0f\u9501\uff0c\u5f53\u5185\u7f6e\u9501 <code>synchronized</code> \u4e0d\u9002\u7528\u65f6\uff0c\u5b83\u5c31\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u79cd\u65b0\u7684\u9009\u62e9\u3002</p> <p>\u56de\u987e\u4e00\u4e0b\u5185\u7f6e\u9501 synchronized \u7684\u4f7f\u7528\uff1a</p> <pre><code>// synchronized\u5173\u952e\u5b57\u7528\u6cd5\u793a\u4f8b\npublic synchronized void add(int t){// \u540c\u6b65\u65b9\u6cd5\n    this.v += t;\n}\n\npublic static synchronized void sub(int t){// \u540c\u6b65\u9759\u6001\u65b9\u6cd5\n    value -= t;\n}\npublic int decrementAndGet(){\n    synchronized(obj){// \u540c\u6b65\u4ee3\u7801\u5757\n        return --v;\n    }\n}\n</code></pre> <p>\u5185\u7f6e\u9501\u4e0d\u9700\u8981\u663e\u5f0f\u7684\u83b7\u53d6\u548c\u91ca\u653e\uff0c\u4efb\u4f55\u4e00\u4e2a\u5bf9\u8c61\u90fd\u80fd\u4f5c\u4e3a\u4e00\u628a\u5185\u7f6e\u9501\u3002</p> <ul> <li>\u5f53 synchronized \u4f5c\u7528\u4e8e\u666e\u901a\u65b9\u6cd5\u65f6\uff0c\u9501\u5bf9\u8c61\u662f this \u3002</li> <li>\u5f53 synchronized \u4f5c\u7528\u4e8e\u9759\u6001\u65b9\u6cd5\u65f6\uff0c\u9501\u5bf9\u8c61\u662f\u5f53\u524d\u7c7b\u7684 Class \u5bf9\u8c61\u3002</li> <li>\u5f53 synchronized \u4f5c\u7528\u4e8e\u4ee3\u7801\u5757\u65f6\uff0c\u9501\u5bf9\u8c61\u662f synchronized(obj) \u4e2d\u7684\u8fd9\u4e2a obj \u5bf9\u8c61\u3002</li> </ul>","tags":["Java"]},{"location":"code/java-multithread-overview/#lock","title":"\u663e\u5f0f\u9501 Lock","text":"<p><code>ReentrantLock</code> \u5b9e\u73b0\u4e86 <code>Lock</code> \u63a5\u53e3\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u7ec4\u62bd\u8c61\u7684\u52a0\u9501\u65b9\u6cd5\u3002</p> <pre><code>    public interface Lock{\n        // \u963b\u585e\u76f4\u5230\u83b7\u5f97\u9501\u6216\u8005\u4e2d\u65ad\n        void lock();\n        // \u963b\u585e\u76f4\u5230\u83b7\u5f97\u9501\u6216\u8005\u4e2d\u65ad\u5f02\u5e38\n        void lockInterruptibly() throws InterruptedException;\n        // \u53ea\u6709\u9501\u53ef\u7528\u65f6\u624d\u83b7\u5f97\uff0c\u5426\u5219\u76f4\u63a5\u8fd4\u56de\n        boolean tryLock();\n        // \u53ea\u6709\u9501\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u53ef\u7528\u624d\u83b7\u5f97\uff0c\u5426\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u4e2d\u65ad\u65f6\u629b\u5f02\u5e38\n        boolean tryLock(long time, TimeUnit unit) throws InterruptedException;\n        // \u91ca\u653e\u9501\n        void unlock();\n        // \u8fd4\u56de\u4e00\u4e2a\u7ed1\u5b9a\u5728\u8fd9\u4e2a\u9501\u4e0a\u7684\u6761\u4ef6\n        Condition newCondition();\n    }   \n</code></pre> <p>\u4e0e\u5185\u7f6e\u9501\u4e0d\u540c\uff0cLock \u63d0\u4f9b\u7684\u9501\u6709\u5982\u4e0b\u7279\u6027\uff1a</p> <ul> <li>\u65e0\u6761\u4ef6\u7684</li> <li>\u53ef\u8f6e\u8be2\u7684</li> <li>\u53ef\u5b9a\u65f6\u7684</li> <li>\u53ef\u4e2d\u65ad\u7684</li> </ul> <p>\u5e76\u4e14\u52a0\u9501\u548c\u89e3\u9501\u7684\u65b9\u6cd5\u90fd\u662f\u663e\u5f0f\u7684\uff0c\u800c\u5185\u7f6e\u9501\u5c31\u9690\u5f0f\u8c03\u7528\u7684\u3002</p> <p>Lock \u6709\u8fd9\u4e9b\u65b0\u7684\u7279\u6027\uff0c\u5bf9\u6bd4\u7684\u90fd\u662f\u5185\u7f6e\u9501\u7684\u75db\u70b9\uff0c\u901a\u8fc7 synchronized \u6765\u83b7\u5f97\u9501\uff0c\u5982\u679c\u5f97\u4e0d\u5230\uff0c\u5c31\u4f1a\u4e00\u76f4\u963b\u585e\uff0c\u65e2\u6ca1\u6709\u8d85\u65f6\u673a\u5236\uff0c\u4e5f\u4e0d\u80fd\u901a\u8fc7\u4e2d\u65ad\u6765\u53d6\u6d88\u3002</p> <p>Lock \u63a5\u53e3\u7684\u6807\u51c6\u4f7f\u7528\u5f62\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>        Lock lock = new ReentrantLock();\n        lock.lock();\n        try {\n            // \u66f4\u65b0\u5bf9\u8c61\u72b6\u6001\n            // \u6355\u83b7\u5f02\u5e38\uff0c\u5e76\u5728\u5fc5\u8981\u65f6\u6062\u590d\u4e0d\u53d8\u6027\u6761\u4ef6\n        } finally {\n            lock.unlock();\n        }\n</code></pre> <p>Lock \u7684\u4f7f\u7528\u5fc5\u987b\u5728 finally \u5757\u4e2d\u91ca\u653e\u9501\uff0c\u5426\u5219\uff0c\u5982\u679c\u5728\u88ab\u4fdd\u62a4\u7684\u4ee3\u7801\u4e2d\u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u90a3\u4e48\u8fd9\u4e2a\u9501\u6c38\u8fdc\u90fd\u65e0\u6cd5\u91ca\u653e\u3002</p> <p>\u5f53\u4f7f\u7528\u52a0\u9501\u65f6\uff0c\u8fd8\u5fc5\u987b\u8003\u8651\u5728 try \u5757\u4e2d\u629b\u51fa\u5f02\u5e38\u7684\u60c5\u51b5\uff0c\u5982\u679c\u53ef\u80fd\u4f7f\u5bf9\u8c61\u5904\u4e8e\u67d0\u79cd\u4e0d\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u66f4\u591a\u7684 try-catch \u6216\u8005 try-finally \u4ee3\u7801\u5757\u3002</p> <p>Lock \u63a5\u53e3\u63d0\u4f9b\u7684\u4e0d\u540c\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0a\u5c31\u5bf9\u5e94\u4e86\u4e0d\u540c\u7684\u7279\u6027\u3002</p>","tags":["Java"]},{"location":"code/java-multithread-overview/#lock_1","title":"Lock \u9501\u7684\u53ef\u8f6e\u8be2\u7279\u6027","text":"<p>Lock \u7684 <code>tryLock()</code> \u65b9\u6cd5\u5bf9\u5e94\u7740\u53ef\u8f6e\u8be2\u7684\u7279\u6027\u3002</p> <p><code>tryLock</code> \u65b9\u6cd5\u987e\u540d\u601d\u4e49\u5c31\u662f\u53bb\u5c1d\u8bd5\u83b7\u5f97\u9501\uff0c\u5e76\u4e14\u5177\u6709\u8fd4\u56de\u503c\uff0c\u5982\u679c\u9501\u53ef\u7528\uff0c\u5219\u83b7\u53d6\u9501\uff0c\u5e76\u7acb\u5373\u8fd4\u56de true \uff0c\u82e5\u4e0d\u53ef\u7528\uff0c\u7acb\u5373\u8fd4\u56de false \u3002</p> <p>\u5229\u7528\u6b64\u7279\u6027\u53ef\u4ee5\u5b9e\u73b0\u53ef\u8f6e\u8be2\u5730\u83b7\u53d6\u9501\uff1a</p> <pre><code>    public boolean lockUse(final Runnable task){\n\n        Lock lock1 = new ReentrantLock();\n        Lock lock2 = new ReentrantLock();\n        // \u8d85\u65f6\u65f6\u95f4\n        long stopTime = System.nanoTime() + TimeUnit.MILLISECONDS.toNanos(100);\n        while (true){\n            if (lock1.tryLock()){\n                try {\n                    if (lock2.tryLock()){\n                        try {\n                            task.run();\n                            return true;\n                        }finally {\n                            lock2.unlock();\n                        }\n                    }\n                }finally {\n                    lock1.unlock();\n                }\n            }\n            // \u5728\n            if (System.nanoTime() &lt; stopTime){\n                return false;\n            }\n        }\n    }\n</code></pre>","tags":["Java"]},{"location":"code/java-multithread-overview/#lock_2","title":"Lock \u9501\u7684\u53ef\u5b9a\u65f6\u7279\u6027","text":"<p>Lock \u7684 <code>tryLock(long time, TimeUnit unit)</code> \u65b9\u6cd5\u5bf9\u5e94\u7740\u53ef\u8f6e\u8be2\u7684\u7279\u6027\u3002</p> <p>\u5e26\u53c2\u6570\u7684 <code>tryLock</code> \u65b9\u6cd5\u4f1a\u5728\u4e00\u5b9a\u65f6\u95f4\u8303\u56f4\u5185\u53bb\u5c1d\u8bd5\u83b7\u5f97\u9501\uff0c\u5982\u679c\u9501\u53ef\u7528\uff0c\u5219\u83b7\u53d6\u9501\uff0c\u5e76\u7acb\u5373\u8fd4\u56de true \uff0c\u82e5\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u8d85\u51fa\u4e86\u7b49\u5f85\u65f6\u95f4\u5c31\u4f1a\u8fd4\u56de false \u3002 </p> <pre><code>public boolean lockUse2(int time,final Runnable task) throws InterruptedException {\n        Lock lock1 = new ReentrantLock();\n        if (!lock1.tryLock(time,TimeUnit.MICROSECONDS)){\n            return false;\n        }\n        try {\n            task.run();\n            return true;\n        }finally {\n            lock1.unlock();\n        }\n    }\n</code></pre>","tags":["Java"]},{"location":"code/java-multithread-overview/#lock_3","title":"Lock \u9501\u7684\u53ef\u4e2d\u65ad\u7279\u6027","text":"<p>Lock \u7684 <code>lockInterruptibly()</code> \u65b9\u6cd5\u5bf9\u5e94\u7740\u53ef\u4e2d\u65ad\u7684\u7279\u6027\u3002</p> <p>\u5f53\u901a\u8fc7 <code>lockInterruptibly</code> \u65b9\u6cd5\u53bb\u83b7\u5f97\u9501\u65f6\uff0c\u5982\u679c\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\u7684\u8fc7\u7a0b\u4e2d\uff0c\u90a3\u4e48 <code>Thread.interrupt()</code> \u65b9\u6cd5\u53ef\u4ee5\u4e2d\u65ad\u7b49\u5f85\u72b6\u6001\u3002</p> <p>\u800c synchronized \u5185\u7f6e\u9501\uff0c\u5f53\u7ebf\u7a0b\u5904\u4e8e\u7b49\u5f85\u67d0\u4e2a\u9501\u7684\u72b6\u6001\u65f6\u662f\u65e0\u6cd5\u88ab\u4e2d\u65ad\u7684\uff0c\u53ea\u6709\u4e00\u76f4\u7b49\u5f85\u4e0b\u53bb\u3002</p> <pre><code>    public boolean lockUse3(int time,final Runnable task) throws InterruptedException {\n\n        Lock lock1 = new ReentrantLock();\n\n        lock1.lockInterruptibly();\n        try {\n            task.run();\n            return true;\n        }finally {\n            lock1.unlock();\n        }\n    }\n</code></pre>","tags":["Java"]},{"location":"code/java-multithread-overview/#reentrantlock","title":"\u53ef\u91cd\u5165\u9501 ReentrantLock","text":"<p>\u53ef\u91cd\u5165\u9501 ReentrantLock \u7c7b\u5b9e\u73b0\u4e86 Lock \u63a5\u53e3\uff0c\u5e76\u4e14\u5177\u6709\u53ef\u91cd\u5165\u7684\u7279\u6027\uff0c\u53e6\u5916\uff0csynchronized \u7684\u5185\u7f6e\u9501\u4e5f\u5177\u6709\u53ef\u91cd\u5165\u7684\u7279\u6027\u3002</p> <p>\u53ef\u91cd\u5165\u7279\u6027\u6307\u7684\u662f\u540c\u4e00\u7ebf\u7a0b\u7684\u5916\u5c42\u51fd\u6570\u83b7\u5f97\u9501\u4e4b\u540e\uff0c\u5185\u5c42\u9012\u5f52\u51fd\u6570\u4ecd\u7136\u80fd\u591f\u83b7\u53d6\u8be5\u9501\uff0c\u4e0d\u53d7\u5f71\u54cd\u3002</p> <p>\u53ef\u91cd\u5165\u9501\u80fd\u591f\u907f\u514d\u6b7b\u9501\uff0c\u6bd4\u5982\uff1a</p> <pre><code>public class ReentrantLockTest implements Runnable{\n\n    ReentrantLock lock = new ReentrantLock();\n\n    public void get(){\n        lock.lock();\n        System.out.println(\"get do something\");\n        set();\n        lock.unlock();\n    }\n\n    public void set(){\n        lock.lock();\n        System.out.println(\"set do something\");\n        lock.unlock();\n    }\n\n    @Override\n    public void run() {\n        get();\n    }\n\n    public static void main(String[] args) {\n        ReentrantLockTest test = new ReentrantLockTest();\n        new Thread(test).start();\n        new Thread(test).start();\n        new Thread(test).start();\n    }\n}\n</code></pre> <p>\u5728 get \u65b9\u6cd5\u4e2d\u8c03\u7528 set \u65b9\u6cd5\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u4f1a\u76f8\u540c\u9501\u7684 <code>lock</code> \u65b9\u6cd5\u3002\u5982\u679c ReentrantLock \u4e0d\u5177\u5907\u53ef\u91cd\u5165\u7279\u6027\uff0c\u90a3\u4e48 set \u65b9\u6cd5\u4e2d\u7684 lock \u8c03\u7528\u5c31\u4f1a\u963b\u585e\uff0c\u5bfc\u81f4 get \u65b9\u6cd5\u4e0d\u80fd\u6267\u884c\u5230\u91ca\u653e\u9501\u7684\u6b65\u9aa4\uff0c\u4ece\u800c\u6b7b\u9501\u4e86\u3002</p>","tags":["Java"]},{"location":"code/java-multithread-overview/#_1","title":"\u516c\u5e73\u9501\u4e0e\u975e\u516c\u5e73\u9501","text":"<p>ReentrantLock \u6839\u636e\u6784\u9020\u53c2\u6570\u7684\u4e0d\u540c\u53ef\u4ee5\u5b9e\u73b0\u516c\u5e73\u9501\u4e0e\u975e\u516c\u5e73\u9501\uff0c\u6784\u9020\u51fd\u6570\u4f20\u5165 true \u5c31\u662f\u516c\u5e73\u9501\uff0cfalse \u5c31\u662f\u975e\u516c\u5e73\u9501\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cReentrantLock \u662f\u975e\u516c\u5e73\u7684\u9501\u3002\u5728\u516c\u5e73\u7684\u9501\u4e0a\uff0c\u7ebf\u7a0b\u5c06\u6309\u7167\u5b83\u4eec\u53d1\u51fa\u8bf7\u6c42\u7684\u987a\u5e8f\u6765\u83b7\u5f97\u9501\uff0c\u4f46\u5728\u975e\u516c\u5e73\u7684\u9501\u4e0a\uff0c\u5219\u5141\u8bb8 <code>\u63d2\u961f</code> :</p> <p>\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u8bf7\u6c42\u975e\u516c\u5e73\u7684\u9501\u65f6\uff0c\u5982\u679c\u5728\u53d1\u51fa\u8bf7\u6c42\u7684\u540c\u65f6\u8be5\u9501\u7684\u72b6\u6001\u53d8\u4e3a\u53ef\u7528\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7ebf\u7a0b\u5c06\u8df3\u8fc7\u961f\u5217\u4e2d\u6240\u6709\u7684\u7b49\u5f85\u7ebf\u7a0b\u5e76\u83b7\u5f97\u8fd9\u4e2a\u9501\u3002</p> <p>\u975e\u516c\u5e73\u7684 ReentrantLock \u5e76\u4e0d\u63d0\u5021 <code>\u63d2\u961f</code> \u884c\u4e3a\uff0c\u4f46\u65e0\u6cd5\u9632\u6b62\u67d0\u4e2a\u7ebf\u7a0b\u5728\u5408\u9002\u7684\u65f6\u5019\u8fdb\u884c\u63d2\u961f\u3002</p> <p>\u5728\u516c\u5e73\u7684\u9501\u4e2d\uff0c\u5982\u679c\u6709\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709\u8fd9\u4e2a\u9501\u6216\u8005\u6709\u5176\u4ed6\u7ebf\u7a0b\u5728\u961f\u5217\u4e2d\u7b49\u5f85\u8fd9\u4e2a\u9501\uff0c\u90a3\u4e48\u65b0\u53d1\u51fa\u8bf7\u6c42\u7684\u7ebf\u7a0b\u5c06\u88ab\u653e\u5165\u961f\u5217\u4e2d\u3002\u5728\u975e\u516c\u5e73\u7684\u9501\u4e2d\uff0c\u53ea\u6709\u5f53\u9501\u88ab\u67d0\u4e2a\u7ebf\u7a0b\u6301\u6709\u65f6\uff0c\u65b0\u53d1\u51fa\u8bf7\u6c42\u7684\u7ebf\u7a0b\u624d\u4f1a\u88ab\u653e\u5165\u961f\u5217\u4e2d\u3002</p>","tags":["Java"]},{"location":"code/java-multithread-overview/#synchronized-reentrantlock","title":"synchronized \u4e0e ReentrantLock \u4e4b\u95f4\u7684\u9009\u62e9","text":"<p>ReentrantLock \u5728\u52a0\u9501\u548c\u5185\u5b58\u4e0a\u63d0\u4f9b\u7684\u8bed\u4e49\u4e0e\u5185\u7f6e\u9501\u76f8\u540c\uff0c\u6b64\u5916\u5b83\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5176\u4ed6\u529f\u80fd\uff0c\u5305\u62ec\u5b9a\u65f6\u7684\u9501\u7b49\u5f85\u3001\u53ef\u4e2d\u65ad\u7684\u9501\u7b49\u5f85\u3001\u516c\u5e73\u6027\u7b49\uff0c\u5728\u6027\u80fd\u4e0a\uff0cReentrantLock \u4f3c\u4e4e\u4f18\u4e8e\u5185\u7f6e\u9501\u3002</p> <p>\u4f46\u4e0e\u663e\u793a\u9501\u76f8\u6bd4\uff0c\u5185\u7f6e\u9501\u4ecd\u7136\u5177\u6709\u5f88\u5927\u7684\u4f18\u52bf\u3002\u5185\u7f6e\u9501\u66f4\u88ab\u4eba\u6240\u719f\u6089\uff0c\u5e76\u4e14\u7b80\u6d01\u7d27\u51d1\uff0cJVM \u4e5f\u4f1a\u5bf9\u5185\u7f6e\u8fdb\u884c\u4f18\u5316\u3002</p> <p>\u5728\u4e00\u4e9b\u5185\u7f6e\u9501\u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42\u7684\u60c5\u51b5\u4e0b\uff0cReentrantLock \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u79cd\u9ad8\u7ea7\u5de5\u5177\u6765\u4f7f\u7528\u3002\u6216\u8005\u5f53\u9700\u8981\u4f7f\u7528 ReentrantLock \u7684\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\u65f6\uff0c\u5426\u5219\uff0c\u8fd8\u662f\u5e94\u8be5\u4f18\u5148\u4f7f\u7528 synchronized \u3002</p>","tags":["Java"]},{"location":"code/java-multithread-overview/#readwritelock","title":"\u8bfb\u5199\u9501 ReadWriteLock","text":"<p>ReentrantLock \u5b9e\u73b0\u4e86\u4e00\u79cd\u6807\u51c6\u7684\u4e92\u65a5\u9501\uff1a</p> <p>\u6bcf\u6b21\u6700\u591a\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u80fd\u6301\u6709 ReentrantLock \u3002</p> <p>\u5bf9\u4e8e\u7ef4\u62a4\u6570\u636e\u7684\u5b8c\u6574\u6027\u6765\u8bf4\uff0c\u4e92\u65a5\u901a\u5e38\u662f\u4e00\u79cd\u8fc7\u4e8e\u5f3a\u786c\u7684\u52a0\u9501\u89c4\u5219\uff0c\u56e0\u6b64\u4e5f\u5c31\u4e0d\u5fc5\u8981\u5730\u9650\u5236\u4e86\u5e76\u53d1\u6027\u3002</p> <p>\u4e92\u65a5\u662f\u4e00\u79cd\u4fdd\u5b88\u7684\u52a0\u9501\u7b56\u7565\uff0c\u867d\u7136\u53ef\u4ee5\u907f\u514d <code>\u5199 / \u5199</code> \u51b2\u7a81\u548c <code>\u5199 / \u8bfb</code> \u51b2\u7a81\uff0c\u4f46\u540c\u6837\u4e5f\u907f\u514d\u4e86 <code>\u8bfb / \u8bfb</code> \u51b2\u7a81\u3002</p> <p>\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u7ed3\u6784\u4e0a\u7684\u64cd\u4f5c\u90fd\u662f <code>\u8bfb\u64cd\u4f5c</code> \uff0c\u867d\u7136\u5b83\u4eec\u4e5f\u662f\u53ef\u53d8\u7684\u5e76\u4e14\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u88ab\u4fee\u6539\uff0c\u4f46\u5176\u4e2d\u5927\u591a\u6570\u8bbf\u95ee\u64cd\u4f5c\u90fd\u662f\u8bfb\u64cd\u4f5c\u3002\u5982\u679c\u6b64\u65f6\u80fd\u591f\u653e\u5bbd\u52a0\u9501\u9700\u6c42\uff0c\u5141\u8bb8\u591a\u4e2a\u6267\u884c\u8bfb\u64cd\u4f5c\u7684\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u6570\u636e\u7ed3\u6784\uff0c\u90a3\u4e48\u5c06\u63d0\u5347\u7a0b\u5e8f\u7684\u6027\u80fd\u3002</p> <p>\u53ea\u8981\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u80fd\u786e\u4fdd\u8bfb\u53d6\u5230\u6700\u65b0\u7684\u6570\u636e\uff0c\u5e76\u4e14\u5728\u8bfb\u53d6\u6570\u636e\u65f6\u4e0d\u4f1a\u6709\u5176\u4ed6\u7ebf\u7a0b\u4fee\u6539\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u53d1\u751f\u95ee\u9898\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u53ef\u4ee5\u4f7f\u7528 \u8bfb / \u5199\u9501\uff1a<code>ReadWriteLock</code> \u3002</p> <p>\u4e00\u4e2a\u8d44\u6e90\u53ef\u4ee5\u88ab\u591a\u4e2a\u8bfb\u64cd\u4f5c\u8bbf\u95ee\uff0c\u6216\u8005\u88ab\u4e00\u4e2a\u5199\u64cd\u4f5c\u8bbf\u95ee\uff0c\u4f46\u4e24\u8005\u4e0d\u80fd\u540c\u65f6\u8fdb\u884c\u3002</p> <pre><code>public interface ReadWriteLock {\n    Lock readLock();\n    Lock writeLock();\n}\n</code></pre> <p>\u5728\u8bfb / \u5199\u9501\u5b9e\u73b0\u7684\u52a0\u9501\u7b56\u7565\u4e2d\uff0c\u5141\u8bb8\u591a\u4e2a\u8bfb\u64cd\u4f5c\u540c\u65f6\u8fdb\u884c\uff0c\u4f46\u6bcf\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u5199\u64cd\u4f5c\u3002</p> <p>\u4e0e Lock \u63a5\u53e3\u4e00\u6837\uff0cReadWriteLock \u4e5f\u6709\u591a\u79cd\u4e0d\u540c\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002</p> <p><code>ReentrantReadWriteLock</code> \u7c7b\u5b9e\u73b0\u4e86 ReadWriteLock \u63a5\u53e3\uff0c\u5b83\u4e3a\u8bfb\u53d6\u9501\u548c\u5199\u5165\u9501\u90fd\u63d0\u4f9b\u4e86\u53ef\u91cd\u5165\u7684\u52a0\u9501\u8bed\u4e49\u3002</p> <p>\u4e0e ReentrantLock \u7c7b\u4f3c\uff0cReentrantReadWriteLock \u5728\u6784\u9020\u65f6\u4e5f\u53ef\u4ee5\u9009\u62e9\u662f\u4e00\u4e2a\u975e\u516c\u5e73\u7684\u9501\uff08\u9ed8\u8ba4\uff09\u8fd8\u662f\u4e00\u4e2a\u516c\u5e73\u7684\u9501\u3002</p> <p>\u5728\u516c\u5e73\u7684\u9501\u4e2d\uff0c\u7b49\u5f85\u65f6\u95f4\u6700\u957f\u7684\u7ebf\u7a0b\u5c06\u4f18\u5148\u83b7\u5f97\u9501\uff0c\u5982\u679c\u8fd9\u4e2a\u9501\u7531\u8bfb\u7ebf\u7a0b\u6301\u6709\uff0c\u800c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8bf7\u6c42\u5199\u5165\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u8bfb\u7ebf\u7a0b\u90fd\u4e0d\u80fd\u83b7\u53d6\u8bfb\u53d6\u9501\uff0c\u76f4\u5230\u5199\u7ebf\u7a0b\u4f7f\u7528\u5b8c\u5e76\u4e14\u91ca\u653e\u4e86\u5199\u5165\u9501\u3002</p> <p>\u5728\u975e\u516c\u5e73\u7684\u9501\u4e2d\uff0c\u7ebf\u7a0b\u83b7\u5f97\u8bbf\u95ee\u8bb8\u53ef\u7684\u987a\u5e8f\u662f\u4e0d\u786e\u5b9a\u7684\u3002\u5199\u7ebf\u7a0b\u964d\u7ea7\u4e3a\u8bfb\u7ebf\u7a0b\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u4ece\u8bfb\u7ebf\u7a0b\u5347\u7ea7\u4e3a\u5199\u7ebf\u7a0b\u5219\u662f\u4e0d\u53ef\u4ee5\u7684\uff0c\u4f1a\u5bfc\u81f4\u6b7b\u9501\u3002</p>","tags":["Java"]},{"location":"code/java-multithread-overview/#_2","title":"\u8bfb\u5199\u9501 \u4e0e \u72ec\u5360\u9501\u4e4b\u95f4\u7684\u9009\u62e9","text":"<p>\u8bfb / \u5199\u9501\u662f\u4e00\u79cd\u6027\u80fd\u4f18\u5316\u63aa\u65bd\uff0c\u5728\u4e00\u4e9b\u7279\u5b9a\u7684\u60c5\u51b5\u4e0b\u80fd\u591f\u5b9e\u73b0\u66f4\u9ad8\u7684\u5e76\u53d1\u6027\u3002</p> <p>\u5728\u5b9e\u9645\u60c5\u51b5\u4e2d\uff0c\u5bf9\u4e8e\u5728\u591a\u5904\u7406\u5668\u7cfb\u7edf\u4e0a\u88ab\u9891\u7e41\u8bfb\u53d6\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8bfb / \u5199\u9501\u80fd\u591f\u63d0\u9ad8\u6027\u80fd\u3002\u800c\u5728\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u8bfb / \u5199\u9501\u7684\u6027\u80fd\u6bd4\u72ec\u5360\u9501\u7684\u6027\u80fd\u8981\u7565\u5dee\u4e00\u70b9\uff0c\u8fd9\u662f\u56e0\u4e3a\u5b83\u4eec\u7684\u590d\u6742\u6027\u66f4\u9ad8\u3002</p> <p>\u5728\u8bfb / \u5199\u9501 \u548c \u72ec\u5360\u9501\u4e4b\u95f4\u505a\u9009\u62e9\u65f6\uff0c\u6700\u597d\u5148\u5bf9\u7a0b\u5e8f\u8fdb\u884c\u5206\u6790\uff0c\u5982\u679c\u8bfb / \u5199\u5e76\u6ca1\u6709\u63d0\u9ad8\u6027\u80fd\uff0c\u90a3\u4e48\u4f7f\u7528\u72ec\u5360\u9501\u4e5f\u53ef\u4ee5\u3002 </p> <p>\u4e0b\u9762\u662f\u4f7f\u7528 <code>ReentrantReadWriteLock</code> \u6765\u5305\u88c5\u4e00 Map \uff0c\u8ba9\u5b83\u80fd\u591f\u5728\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u88ab\u5b89\u5168\u5730\u5171\u4eab\uff0c\u5e76\u4e14\u4ecd\u80fd\u591f\u907f\u514d \u8bfb / \u5199 \u6216 \u5199 / \u5199\u51b2\u7a81\u3002</p> <pre><code>public class ReadWriteMap&lt;K,V&gt; {\n    private final Map&lt;K,V&gt; map;\n    private final ReadWriteLock lock = new ReentrantReadWriteLock();\n    private final Lock r = lock.readLock();\n    private final Lock w = lock.writeLock();\n\n    public ReadWriteMap(Map&lt;K,V&gt; map){\n        this.map = map;\n    }\n\n    public V put(K key,V value){\n        w.lock();\n        try {\n            return map.put(key,value);\n        } finally {\n          w.unlock();\n        }\n    }\n\n    public V get(Object key){\n        r.lock();\n        try {\n            return map.get(key);\n        } finally {\n            r.unlock();\n        }\n    }\n}\n</code></pre>","tags":["Java"]},{"location":"code/java-multithread-overview/#_3","title":"\u5c0f\u7ed3","text":"<p>\u4e0e\u5185\u7f6e\u9501\u76f8\u6bd4\uff0c\u663e\u793a\u7684 Lock \u63d0\u4f9b\u4e86\u4e00\u4e9b\u62d3\u5c55\u529f\u80fd\uff0c\u5728\u5904\u7406\u9501\u7684\u4e0d\u53ef\u7528\u6027\u65b9\u9762\u6709\u7740\u66f4\u9ad8\u7684\u7075\u6d3b\u6027\uff0c\u5e76\u4e14\u5bf9\u961f\u5217\u6709\u7740\u66f4\u597d\u7684\u63a7\u5236\u3002\u4f46 ReentrantLock \u4e0d\u80fd\u5b8c\u5168\u66ff\u4ee3 synchronized \uff0c\u53ea\u6709\u5728 synchronized \u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42\u65f6\uff0c\u624d\u5e94\u8be5\u4f7f\u7528\u5b83\u3002</p> <p>\u8bfb / \u5199\u9501\u5141\u8bb8\u591a\u4e2a\u7ebf\u7a0b\u5e76\u53d1\u5730\u8bbf\u95ee\u88ab\u4fdd\u62a4\u7684\u5bf9\u8c61\uff0c\u5f53\u8bbf\u95ee\u4ee5\u8bfb\u53d6\u64cd\u4f5c\u4e3a\u4e3b\u7684\u6570\u636e\u7ed3\u6784\u65f6\uff0c\u5b83\u80fd\u591f\u63d0\u9ad8\u7a0b\u5e8f\u7684\u53ef\u4f38\u7f29\u6027\u3002</p>","tags":["Java"]},{"location":"code/java-multithread-overview/#_4","title":"\u6761\u4ef6\u8c13\u8bcd\u4e0e\u6761\u4ef6\u961f\u5217","text":"<p>\u6761\u4ef6\u8c13\u8bcd\u548c\u6761\u4ef6\u961f\u5217\u662f\u5e73\u65f6\u63a5\u89e6\u6bd4\u8f83\u5c11\u7684\u5185\u5bb9\uff0c\u8fd9\u91cc\u4e5f\u4e00\u5e76\u8bb0\u5f55\u4e0b\u3002</p>","tags":["Java"]},{"location":"code/java-multithread-overview/#_5","title":"\u72b6\u6001\u4f9d\u8d56\u6027\u7684\u7ba1\u7406","text":"<p>\u4f9d\u8d56\u72b6\u6001\u7684\u64cd\u4f5c\u53ef\u4ee5\u4e00\u76f4\u963b\u585e\u76f4\u5230\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\uff0c\u8fd9\u6bd4\u4f7f\u5b83\u4eec\u5148\u5931\u8d25\u518d\u5b9e\u73b0\u8d77\u6765\u66f4\u4e3a\u65b9\u4fbf\u4e14\u4e0d\u5b9c\u51fa\u9519\u3002</p> <p>\u5185\u7f6e\u7684\u6761\u4ef6\u961f\u5217\u53ef\u4ee5\u4f7f\u7ebf\u7a0b\u4e00\u76f4\u963b\u585e\uff0c\u76f4\u5230\u5bf9\u8c61\u8fdb\u5165\u67d0\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u5f53\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c\u65f6\u518d\u5524\u9192\u5b83\u4eec\u3002</p> <p><code>\u6761\u4ef6\u961f\u5217</code> \u6765\u6e90\u4e8e\uff1a\u5b83\u4f7f\u5f97\u4e00\u7ec4\u7ebf\u7a0b\uff08\u79f0\u4e4b\u4e3a\u7b49\u5f85\u7ebf\u7a0b\u96c6\u5408\uff09\u80fd\u591f\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\u6765\u7b49\u5f85\u7279\u5b9a\u7684\u6761\u4ef6\u53d8\u6210\u771f\u3002\u4f20\u7edf\u961f\u5217\u7684\u5143\u7d20\u662f\u4e00\u4e2a\u4e2a\u6570\u636e\uff0c\u800c\u4e0e\u4e4b\u4e0d\u540c\u7684\u662f\uff0c\u6761\u4ef6\u961f\u5217\u4e2d\u7684\u5143\u7d20\u662f\u4e00\u4e2a\u4e2a\u6b63\u5728\u7b49\u5f85\u76f8\u5173\u6761\u4ef6\u7684\u7ebf\u7a0b\u3002</p> <p>\u6b63\u5982\u6bcf\u4e2a Java \u5bf9\u8c61\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u9501\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u540c\u6837\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u6761\u4ef6\u961f\u5217\uff0c\u5e76\u4e14 Object \u4e2d\u7684 wait\u3001notify \u548c notifyAll \u65b9\u6cd5\u5c31\u6784\u6210\u4e86\u5185\u90e8\u6761\u4ef6\u961f\u5217\u7684 API \u3002</p> <p>\u5bf9\u8c61\u7684\u5185\u7f6e\u9501\u4e0e\u5176\u5185\u90e8\u6761\u4ef6\u961f\u5217\u662f\u76f8\u4e92\u5173\u8054\u7684\uff0c\u8981\u8c03\u7528\u5bf9\u8c61 X \u4e2d\u6761\u4ef6\u961f\u5217\u7684\u4efb\u4f55\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5fc5\u987b\u6301\u6709\u5bf9\u8c61 X \u4e0a\u7684\u9501\u3002\u8fd9\u662f\u56e0\u4e3a \u201c\u7b49\u5f85\u7531\u72b6\u6001\u6784\u6210\u7684\u6761\u4ef6\u201d \u4e0e  \u201c\u7ef4\u62a4\u72b6\u6001\u4e00\u81f4\u6027\u201d \u8fd9\u4e24\u79cd\u673a\u5236\u5fc5\u987b\u88ab\u7d27\u5bc6\u7ed1\u5b9a\u5728\u4e00\u8d77\uff1a\u53ea\u6709\u80fd\u5bf9\u72b6\u6001\u8fdb\u884c\u68c0\u67e5\u65f6\uff0c\u624d\u80fd\u5728\u67d0\u4e2a\u6761\u4ef6\u4e0a\u7b49\u5f85\uff0c\u5e76\u4e14\u53ea\u6709\u80fd\u4fee\u6539\u72b6\u6001\u65f6\uff0c\u624d\u80fd\u4ece\u6761\u4ef6\u7b49\u5f85\u4e2d\u91ca\u653e\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u3002</p> <p>\u6761\u4ef6\u961f\u5217\u4f7f\u6784\u5efa\u9ad8\u6548\u4ee5\u53ca\u9ad8\u53ef\u54cd\u5e94\u6027\u7684\u72b6\u6001\u4f9d\u8d56\u7c7b\u53d8\u5f97\u66f4\u5bb9\u6613\uff0c\u4f46\u540c\u65f6\u4e5f\u5f88\u5bb9\u6613\u88ab\u4e0d\u6b63\u786e\u5730\u4f7f\u7528\u3002</p> <p>\u5728\u6761\u4ef6\u7b49\u5f85\u4e2d\u5b58\u5728\u4e00\u79cd\u91cd\u8981\u7684\u4e09\u5143\u5173\u7cfb\uff0c\u5305\u62ec\u52a0\u9501\u3001wait \u65b9\u6cd5\u548c\u4e00\u4e2a\u6761\u4ef6\u8c13\u8bcd\u3002\u5728\u6761\u4ef6\u8c13\u8bcd\u4e2d\u5305\u542b\u591a\u4e2a\u72b6\u6001\u53d8\u91cf\uff0c\u800c\u72b6\u6001\u53d8\u91cf\u7531\u4e00\u4e2a\u9501\u6765\u4fdd\u62a4\uff0c\u56e0\u6b64\u5728\u6d4b\u8bd5\u6761\u4ef6\u8c13\u8bcd\u4e4b\u524d\u5fc5\u987b\u5148\u6301\u6709\u8fd9\u4e2a\u9501\u3002\u9501\u5bf9\u8c61\u548c\u6761\u4ef6\u961f\u5217\u5bf9\u8c61\uff08\u5373\u8c03\u7528 wait \u548c notify \u7b49\u65b9\u6cd5\u6240\u5728\u7684\u5bf9\u8c61\uff09\u5fc5\u987b\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002</p> <p>\u6bcf\u4e00\u6b21 wait \u8c03\u7528\u90fd\u4f1a\u9690\u5f0f\u5730\u4e0e\u7279\u5b9a\u7684\u6761\u4ef6\u8c13\u8bcd\u5173\u8054\u8d77\u6765\u3002\u5f53\u8c03\u7528\u67d0\u4e2a\u7279\u5b9a\u6761\u4ef6\u8c13\u8bcd\u7684 wait \u65f6\uff0c\u8c03\u7528\u8005\u5fc5\u987b\u5df2\u7ecf\u6301\u6709\u4e0e\u6761\u4ef6\u961f\u5217\u76f8\u5173\u7684\u9501\uff0c\u5e76\u4e14\u8fd9\u4e2a\u9501\u5fc5\u987b\u4fdd\u62a4\u7740\u6784\u6210\u6761\u4ef6\u8c13\u8bcd\u7684\u72b6\u6001\u53d8\u91cf\u3002</p> <p>\u907f\u514d\u8fc7\u65e9\u5524\u9192\uff0c\u6216\u8005\u5524\u9192\u4e4b\u540e\uff0c\u6761\u4ef6\u8c13\u8bcd\u5e76\u4e0d\u4e3a\u771f\uff0c\u4f7f\u7528 while \u5faa\u73af\u5728\u8c03\u7528 wait \u65b9\u6cd5\u3002</p> <p>\u7ebf\u7a0b\u5728\u6761\u4ef6\u8c13\u8bcd\u4e0d\u4e3a\u771f\u7684\u60c5\u51b5\u4e0b\u4e5f\u53ef\u4ee5\u53cd\u590d\u5730\u9192\u6765\uff0c\u56e0\u6b64\u5fc5\u987b\u5728\u4e00\u4e2a\u5faa\u73af\u4e2d\u8c03\u7528 wait \uff0c\u5e76\u5728\u6bcf\u6b21\u8fed\u4ee3\u4e2d\u90fd\u68c0\u6d4b\u6761\u4ef6\u8c13\u8bcd\u3002</p>","tags":["Java"]},{"location":"code/java-multithread-overview/#_6","title":"\u901a\u77e5","text":"<p>\u6bcf\u5f53\u5728\u7b49\u5f85\u4e00\u4e2a\u6761\u4ef6\u65f6\uff0c\u4e00\u5b9a\u8981\u786e\u4fdd\u5728\u6761\u4ef6\u8c13\u8bcd\u53d8\u4e3a\u771f\u65f6\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\u53d1\u51fa\u901a\u77e5\u3002</p> <p>\u4f18\u5148\u4f7f\u7528 notifyAll \u800c\u4e0d\u662f notify \u3002</p> <p>\u53ea\u6709\u540c\u65f6\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u4e2a\u6761\u4ef6\u65f6\uff0c\u624d\u80fd\u7528\u5355\u4e00\u7684 notify \u800c\u4e0d\u662f notifyAll \u3002</p> <ul> <li>\u6240\u6709\u7b49\u5f85\u7ebf\u7a0b\u7684\u7c7b\u578b\u90fd\u76f8\u540c\u3002\u53ea\u6709\u4e00\u4e2a\u6761\u4ef6\u8c13\u8bcd\u4e0e\u6761\u4ef6\u961f\u5217\u76f8\u5173\uff0c\u5e76\u4e14\u6bcf\u4e2a\u7ebf\u7a0b\u5728\u4ece wait \u8fd4\u56de\u540e\u5c06\u6267\u884c\u76f8\u540c\u7684\u64cd\u4f5c\u3002</li> <li>\u5355\u8fdb\u5355\u51fa\u3002\u5728\u6761\u4ef6\u53d8\u91cf\u4e0a\u7684\u6bcf\u6b21\u901a\u77e5\uff0c\u6700\u591a\u53ea\u80fd\u5524\u9192\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6267\u884c\u3002</li> </ul>","tags":["Java"]},{"location":"code/java-multithread-overview/#condition","title":"\u663e\u5f0f\u7684 Condition \u5bf9\u8c61","text":"<p>\u5185\u7f6e\u6761\u4ef6\u961f\u5217\u5b58\u5728\u4e00\u4e9b\u7f3a\u9677\u3002\u6bcf\u4e2a\u5185\u7f6e\u9501\u90fd\u53ea\u80fd\u6709\u4e00\u4e2a\u76f8\u5173\u8054\u7684\u6761\u4ef6\u961f\u5217\uff0c\u56e0\u800c\u5b58\u5728\u591a\u4e2a\u7ebf\u7a0b\u53ef\u80fd\u5728\u540c\u4e00\u4e2a\u6761\u4ef6\u961f\u5217\u4e0a\u7b49\u5f85\u4e0d\u540c\u7684\u6761\u4ef6\u8c13\u8bcd\uff0c\u5e76\u4e14\u5728\u6700\u5e38\u89c1\u7684\u52a0\u9501\u6a21\u5f0f\u4e0b\u516c\u5f00\u6761\u4ef6\u961f\u5217\u5bf9\u8c61\u3002</p> <p>\u8fd9\u4e9b\u56e0\u7d20\u90fd\u4f7f\u5f97\u65e0\u6cd5\u6ee1\u8db3\u5728\u4f7f\u7528 notifyAll \u65f6\u6240\u6709\u7b49\u5f85\u7ebf\u7a0b\u4e3a\u540c\u4e00\u7c7b\u578b\u7684\u9700\u6c42\u3002</p> <p>\u5982\u679c\u60f3\u7f16\u5199\u4e00\u4e2a\u5e26\u6709\u591a\u4e2a\u6761\u4ef6\u8c13\u8bcd\u7684\u5e76\u53d1\u5bf9\u8c61\uff0c\u6216\u8005\u60f3\u83b7\u5f97\u9664\u4e86\u6761\u4ef6\u961f\u5217\u53ef\u89c1\u6027\u4e4b\u5916\u7684\u66f4\u591a\u63a7\u5236\u6743\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u663e\u793a\u7684 Lock \u548c Condition \u800c\u4e0d\u662f\u5185\u7f6e\u9501\u548c\u6761\u4ef6\u961f\u5217\u3002</p> <p>\u4e00\u4e2a Condition \u548c\u4e00\u4e2a Lock \u5173\u8054\u5728\u4e00\u8d77\uff0c\u5c31\u50cf\u4e00\u4e2a\u6761\u4ef6\u961f\u5217\u548c\u4e00\u4e2a\u5185\u7f6e\u9501\u76f8\u5173\u8054\u4e00\u6837\u3002\u8981\u521b\u5efa\u4e00\u4e2a Condition\uff0c\u53ef\u4ee5\u5728\u76f8\u5173\u8054\u7684 Lock \u4e0a\u8c03\u7528 Lock.newCondition \u65b9\u6cd5\u3002\u6b63\u5982 Lock \u6bd4\u5185\u7f6e\u52a0\u9501\u63d0\u4f9b\u4e86\u66f4\u4e3a\u4e30\u5bcc\u7684\u529f\u80fd\uff0cCondition \u540c\u6837\u6bd4\u5185\u7f6e\u6761\u4ef6\u961f\u5217\u63d0\u4f9b\u4e86\u66f4\u4e3a\u4e30\u5bcc\u7684\u529f\u80fd\uff1a</p> <p>\u5728\u6bcf\u4e2a\u9501\u4e0a\u53ef\u5b58\u5728\u591a\u4e2a\u7b49\u5f85\u3001\u6761\u4ef6\u7b49\u5f85\u53ef\u4ee5\u662f\u53ef\u4e2d\u65ad\u7684\u6216\u4e0d\u53ef\u4e2d\u65ad\u7684\u3001\u57fa\u4e8e\u65f6\u9650\u7684\u7b49\u5f85\uff0c\u4ee5\u53ca\u516c\u5e73\u7684\u6216\u975e\u516c\u5e73\u7684\u961f\u5217\u64cd\u4f5c\u3002</p> <p>\u4e0e\u5185\u7f6e\u6761\u4ef6\u961f\u5217\u4e0d\u540c\u7684\u662f\uff0c\u5bf9\u4e8e\u6bcf\u4e2a Lock \uff0c\u53ef\u4ee5\u6709\u4efb\u610f\u6570\u91cf\u7684 Condition \u5bf9\u8c61\u3002Condition \u5bf9\u8c61\u7ee7\u627f\u4e86\u76f8\u5173\u7684 Lock \u5bf9\u8c61\u7684\u516c\u5e73\u6027\uff0c\u5bf9\u4e8e\u516c\u5e73\u7684\u9501\uff0c\u7ebf\u7a0b\u4f1a\u4f9d\u7167 FIFO \u987a\u5e8f\u4ece Condition.await \u4e2d\u91ca\u653e\u3002</p> <p>\u5728 Condition \u5bf9\u8c61\u4e2d\uff0c\u4e0e wait\u3001notify \u548c notifyAll \u65b9\u6cd5\u5bf9\u5e94\u7684\u5206\u522b\u662f await\u3001signal \u548c signalAll \u3002\u4f46\u662f\uff0cCondition \u5bf9 Object \u8fdb\u884c\u4e86\u62d3\u5c55\uff0c\u56e0\u800c\u5b83\u4e5f\u5305\u542b wait \u548c notify \u65b9\u6cd5\u3002\u4e00\u5b9a\u8981\u786e\u4fdd\u4f7f\u7528\u6b63\u786e\u7684\u7248\u672c --- await \u548c signal \u3002</p> <pre><code>public class ConditionBoundBuffer&lt;T&gt; {\n\n    protected final Lock lock = new ReentrantLock();\n    // \u6761\u4ef6\u8c13\u8bcd\uff1a notFull (count &lt; items.length)\n    private final Condition notFull= lock.newCondition();\n    // \u6761\u4ef6\u8c13\u8bcd\uff1a notEmpty (count &gt; 0)\n    private final Condition notEmpty = lock.newCondition();\n    private final T[] items = (T[]) new Object[10];\n    private int tail,head,count;\n\n    // \u963b\u585e\u5e76\u76f4\u5230\uff1anotFull\n    public void put(T x) throws InterruptedException {\n        lock.lock();\n        try {\n            while (count == items.length) {\n                notFull.await();\n            }\n                items[tail] = x;\n                if (++tail == items.length){\n                    tail=0;\n                }\n                ++count;\n                notEmpty.signal();\n\n        }finally {\n            lock.unlock();\n        }\n    }\n\n    // \u963b\u585e\u5e76\u76f4\u5230\uff1anotEmpty\n    public T take() throws InterruptedException {\n        lock.lock();\n        try {\n            while (count == 0){\n                notEmpty.await();\n            }\n            T x = items[head];\n            items[head] = null;\n            if (++head == items.length){\n                head=0;\n            }\n            --count;\n            notFull.signal();\n            return x;\n        }finally {\n            lock.lock();\n        }\n    }\n}\n</code></pre>","tags":["Java"]},{"location":"code/java-multithread-overview/#_7","title":"\u53c2\u8003","text":"<ol> <li>\u300aJava \u5e76\u53d1\u7f16\u7a0b\u5b9e\u6218\u300b</li> <li>https://www.cnblogs.com/CarpenterLee/p/7896361.html</li> <li>https://blog.csdn.net/justloveyou_/article/details/54972105</li> </ol>","tags":["Java"]},{"location":"ffmpeg/007-parse-mp4-info/","title":"007 | \u64ad\u653e\u5668\u7cfb\u5217\u4e13\u680f-\u89e3\u6790 MP4 \u6587\u4ef6\u8bfb\u53d6\u4fe1\u606f","text":"<p>\u5728\u4e4b\u524d\u6587\u7ae0\u4e2d\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u4e86 MP4 \u6807\u51c6\u7684\u6765\u6e90\u4ee5\u53ca\u5b83\u7684\u683c\u5f0f\u5b9a\u4e49\uff0c\u57fa\u672c\u4e0a\u5c31\u662f\u7531\u4e00\u4e2a\u4e2a Box \u7ec4\u6210\u7684\uff0c\u5927\u81f4\u7684\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>ftyp\nmoov\n    mvhd\n    trak\n        tkhd\n        mdia\n    trak\n        tkhd\n        mdia\nmdat\n</code></pre> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u53bb\u624b\u52a8\u89e3\u6790 MP4 \u6587\u4ef6\uff0c\u6ce8\u610f\u8fd9\u53ef\u4e0d\u662f\u7528 FFmpeg \u6765\u89e3\u5c01\u88c5\uff0c\u800c\u662f\u4ece MP4 \u6587\u4ef6\u4e2d\u4e00\u4e2a\u4e00\u4e2a\u5b57\u8282\u8bfb\u53d6\u4fe1\u606f\u5e76\u89e3\u6790\u5b83\u7684\u542b\u4e49\u83b7\u5f97\u60f3\u8981\u7684\u5185\u5bb9\u3002</p> <p>\u5e73\u5e38\u4e00\u770b\u5230\u540e\u7f00\u662f <code>.mp4</code> \u7684\u6587\u4ef6\uff0c\u8111\u6d77\u91cc\u4e00\u60f3\u5230\u7684\u5c31\u662f\u89c6\u9891\uff0c\u4f46\u5176\u5b9e\u4e0d\u7ba1\u540e\u7f00\u5982\u4f55\uff0c\u5b83\u4e5f\u8fd8\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u53ef\u4ee5\u6309\u7167\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u8fdb\u884c\u8bfb\u53d6\u548c\u5199\u5165\u3002</p>","tags":["Player"]},{"location":"ffmpeg/007-parse-mp4-info/#mp4","title":"\u89e3\u6790 MP4 \u6587\u4ef6\u83b7\u53d6\u4fe1\u606f","text":"<p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728 Mac \u4e0a\u7528 <code>010 Editor</code> \u8f6f\u4ef6\u53bb\u67e5\u770b\u4e00\u4e2a MP4 \u6587\u4ef6\uff0c\u4ee5 16 \u8fdb\u5236\u663e\u793a\uff0c\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece\u56fe\u4e2d\u7bad\u5934\u6307\u793a\u5904\u53ef\u4ee5\u770b\u5230 <code>ftyp</code> \u548c <code>mvhd</code> \u4e24\u4e2a Box \u7c7b\u578b\uff0c\u53e6\u5916\u4e5f\u8fd8\u6709 <code>moov</code> \u548c <code>tkhd</code> \u8fd9\u4e9b Box \u7c7b\u578b\u3002</p> <p>\u4e4b\u6240\u4ee5\u80fd\u591f\u663e\u793a\u51fa Box \u7c7b\u578b\u7684\u5b57\u7b26\u4e32\uff0c\u662f\u56e0\u4e3a\u628a\u5341\u516d\u8fdb\u5236\u6570\u636e\u8f6c\u6362\u6210 ASCII \u7801\u4e86\uff0c\u6bd4\u5982 61 \u5bf9\u5e94\u5c31\u662f\u5b57\u6bcd a \uff0c\u8fd9\u5e94\u8be5\u5728\u8ba1\u7b97\u673a\u57fa\u7840\u4e66\u4e2d\u90fd\u6709\u8bb2\u8fc7\u7684\u3002</p> <p>\u5728 <code>mvhd</code> Box\u4e2d\u5b58\u50a8\u7740\u89c6\u9891\u6587\u4ef6\u7684\u65f6\u957f\u4fe1\u606f\uff0c\u60f3\u8981\u83b7\u53d6\u5230\u8fd9\u4e2a\u4fe1\u606f\uff0c\u76f4\u63a5\u4ece Box \u4e2d\u8bfb\u53d6\u5c31\u597d\uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\uff0c\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0a\u56fe\u5c55\u793a\u4e86 mvhd Box \u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u7ee7\u627f\u81ea FullBox\uff0c\u5728\u8bfb\u53d6\u65f6\u5148\u8bfb\u53d6 FullBox \u7684\u5b57\u6bb5\uff0c\u7136\u540e\u5728\u8bfb\u53d6 mvhd Box \u81ea\u5df1\u7684\uff08\u53d6 version == 0 \u65f6\u7684\u6570\u636e\u7ed3\u6784\u6392\u5e03\uff09\u3002</p> <p></p> <p>\u5173\u4e8e mvhd box \u548c full box \u7684\u6570\u636e\u7ed3\u6784\u6587\u6863\u4ee5\u53ca MP4 \u4e2d\u6240\u6709 Box \u7684\u7c7b\u578b\u8d44\u6599\uff0c\u5df2\u7ecf\u5728\u77e5\u8bc6\u661f\u7403\u4e2d\u7ed9\u51fa\u4e86\uff0c\u53ef\u4ee5\u52a0\u5165\u661f\u7403\u5728\u8d44\u6599\u4e2d\u627e\u5230\u3002</p> <p>FullBox \u7684\u6570\u636e\u7ed3\u6784\u5982\u4e0a\u6240\u793a\uff0c\u7531\u5b57\u8282\u4f4d\u6570\u53ef\u4ee5\u7b97\u51fa\uff0c\u5728 box type \u4e4b\u540e\u504f\u79fb 12 \u5b57\u8282\u53ef\u4ee5\u5f97\u5230 timescale \u5b57\u6bb5\u5185\u5bb9\uff0c\u504f\u79fb 16 \u5b57\u8282\u53ef\u4ee5\u5f97\u5230 duration \u5b57\u6bb5\u5185\u5bb9\u3002</p> <p>\u5176\u4e2d timescale \u4e3a 0x000003E8\uff0c\u5bf9\u5e94\u5341\u8fdb\u5236\u6570\u636e 1000 \u3002</p> <p>duration \u4e3a 0x000086E6\uff0c\u5bf9\u5e94\u5341\u8fdb\u5236\u6570\u636e 34534\u3002</p> <p>\u7528 duration \u9664\u4ee5 timescale \u5c31\u662f\u89c6\u9891\u7684\u65f6\u957f\u4e86\uff0c\u5341\u516d\u8fdb\u5236\u76f8\u9664\u540e\u7684\u7ed3\u679c\u662f 0x22\uff0c\u8f6c\u6362\u6210\u5341\u8fdb\u5236\u5c31\u662f 34\uff0c\u548c\u7528\u5341\u8fdb\u5236\u6570\u636e\u76f8\u9664\u5f97\u5230\u7684 34.534 \u57fa\u672c\u4e00\u81f4\u4e86\uff08\u65f6\u957f\u5355\u4f4d\u662f\u79d2\uff09\u3002</p> <p>\u4ee5\u4e0a\u53ea\u662f\u4e2a\u7b80\u5355\u4f8b\u5b50\uff0c\u8bf4\u660e\u5b8c\u5168\u53ef\u4ee5\u53bb\u624b\u52a8\u89e3\u6790 MP4 \u6587\u4ef6\u83b7\u53d6\u5b83\u7684\u683c\u5f0f\u4fe1\u606f\u3002</p> <p>\u800c\u4e14\u5728\u8fd9\u4e2a\u5c42\u9762\u4e0a\u8fd8\u6709\u4e00\u4e9b\u72ec\u7279\u7684\u7528\u6cd5\uff1a\u6bd4\u5982\u6211\u4eec\u8981\u60f3\u63d0\u53d6\u89c6\u9891\u4e2d\u7684\u67d0\u4e2a Box \u4fe1\u606f\uff0c\u6216\u8005\u60f3\u8981\u586b\u5145\u81ea\u5b9a\u4e49\u7684 Box \u683c\u5f0f\uff0c\u643a\u5e26\u4e00\u4e9b\u79c1\u6709\u6570\u636e\uff0c\u5728\u64ad\u653e\u65f6\u518d\u628a\u5b83\u89e3\u6790\u51fa\u6765\u505a\u5904\u7406\u3002</p> <p>\u5728\u63a5\u4e0b\u6765\u7684\u6587\u7ae0\uff0c\u6211\u4eec\u5c31\u4f1a\u53bb\u5b9e\u8df5\u624b\u52a8\u89e3\u6790 MP4 \u6587\u4ef6\uff0c\u9010\u4e00\u62c6\u89e3\u6bcf\u4e2a Box \u683c\u5f0f\uff0c\u53d1\u6398\u5176\u80cc\u540e\u7684\u53e6\u4e00\u79cd\u7528\u6cd5\uff0c\u52a0\u5f3a\u5bf9\u97f3\u89c6\u9891\u7684\u5904\u7406\u80fd\u529b\u3002</p>","tags":["Player"]},{"location":"ffmpeg/av-beginner-010/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-010\u3011\u7b2c\u4e8c\u5b63 FFmpeg \u65e5\u5fd7\u6253\u5370","text":"<p>\u97f3\u89c6\u9891\u8fde\u8f7d\u7cfb\u5217\u5df2\u7ecf\u505c\u66f4\u4e00\u6bb5\u65f6\u95f4\uff0c\u518d\u8fd9\u4e48\u505c\u4e0b\u53bb\u4f30\u8ba1\u5c31\u8981\u6389\u7c89\u4e86\uff0c\u6361\u8d77\u6765\u7ee7\u7eed\u66f4\u65b0<sub>~</sub></p> <p>\u63a5\u4e0b\u6765\u4e3b\u8981\u662f\u8bb2\u89e3 FFmpeg \u76f8\u5173\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u8fd9\u7bc7\u5c31\u4ece\u7b80\u5355\u7684\u65e5\u5fd7\u6253\u5370\u5f00\u59cb\u8bf4\u8d77\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/av-beginner-010/#_1","title":"\u65e5\u5fd7\u6253\u5370\u57fa\u7840\u4f7f\u7528","text":"<p>\u5728 FFmpeg \u4e2d\u63d0\u4f9b\u4e86 av_log() \u65b9\u6cd5\u53bb\u6253\u5370\u65e5\u5fd7\uff0c\u5b83\u7684\u51fd\u6570\u58f0\u660e\u5982\u4e0b\uff1a</p> <pre><code>void av_log(void *avcl, int level, const char *fmt, ...)\n</code></pre> <p>\u5176\u4e2d <code>level</code> \u53c2\u6570\u6307\u7684\u662f\u65e5\u5fd7\u7ea7\u522b\uff0c\u540e\u9762\u7684 <code>fmt</code> \u548c <code>...</code> \u4ee3\u8868\u65e5\u5fd7\u5185\u5bb9\uff0c\u548c\u8c03\u7528 <code>print</code> \u6253\u5370\u4fe1\u606f\u4e00\u6837\u3002</p> <p>\u5177\u4f53\u4f7f\u7528\u5982\u4e0b\uff1a</p> <pre><code>av_log(nullptr,AV_LOG_INFO,\"this is INFO log color\");\nav_log(nullptr,AV_LOG_DEBUG,\"this is DEBUG log color\");\nav_log(nullptr,AV_LOG_WARNING,\"this is WARNING log color\");\nav_log(nullptr,AV_LOG_ERROR,\"this is ERROR log color\");\n</code></pre> <p>\u4e0e Android \u65e5\u5fd7\u7c7b\u4f3c\uff0cFFmpeg \u4e5f\u6709\u591a\u79cd\u7ea7\u522b\u7684\u65e5\u5fd7\u3002</p> <pre><code>#define AV_LOG_FATAL     8\n#define AV_LOG_ERROR    16\n#define AV_LOG_WARNING  24\n#define AV_LOG_INFO     32\n#define AV_LOG_VERBOSE  40\n#define AV_LOG_DEBUG    48\n#define AV_LOG_TRACE    56\n</code></pre> <p>\u770b\u5230 <code>INFO</code>\u3001<code>DEBUG</code>\u3001<code>ERROR</code> \u8fd9\u4e9b\u7ea7\u522b\u662f\u4e0d\u662f\u6709\u4f3c\u66fe\u76f8\u8bc6\u7684\u611f\u89c9\u3002</p> <p>\u8fd9\u4e9b\u6570\u503c\u90fd\u662f 8 \u7684\u500d\u6570\uff0c\u6309\u7167\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u9012\u589e\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/av-beginner-010/#_2","title":"\u65e5\u5fd7\u6253\u5370\u7ea7\u522b\u8bbe\u7f6e","text":"<p>\u5728 FFmpeg \u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u548c\u83b7\u53d6\u5f53\u524d\u65e5\u5fd7\u6253\u5370\u7684\u7ea7\u522b\u3002</p> <pre><code>// \u8bbe\u7f6e\u65e5\u5fd7\u6253\u5370\u7ea7\u522b\nvoid av_log_set_level(int level);\n// \u83b7\u53d6\u65e5\u5fd7\u6253\u5370\u7ea7\u522b\nint av_log_get_level(void);\n</code></pre> <p>\u6bd4\u5982\u8bbe\u7f6e\u4e86\u5f53\u524d\u7ea7\u522b\u662f <code>AV_LOG_INFO</code> \uff0c\u90a3\u4e48\u51e1\u662f\u7ea7\u522b\u4f4e\u4e8e\u5b83\u7684\u90fd\u4e0d\u4f1a\u6253\u5370\u51fa\u6765\u4e86\u3002</p> <p>\u90a3\u4e48\u4ec0\u4e48\u7ea7\u522b\u7b97\u662f\u66f4\u4f4e\u7684\u5462\uff1f\u6570\u5b57\u8d8a\u5c0f\u7684\u7ea7\u522b\u8d8a\u9ad8\uff0c\u6570\u5b57\u8d8a\u5927\u7684\u7ea7\u522b\u8d8a\u4f4e\u3002</p> <p>\u6bd4\u5982\u8bbe\u7f6e\u4e86 <code>AV_LOG_INFO</code> \u7ea7\u522b\uff0c\u5b83\u7684\u503c\u662f 32 \uff0c\u90a3\u4e48 <code>AV_LOG_DEBUG</code> \u7ea7\u522b\u7684\u65e5\u5fd7\u5c31\u4e0d\u4f1a\u6253\u5370\uff0c\u5b83\u7684\u503c\u662f 48 \uff0c\u7ea7\u522b\u66f4\u4f4e\u3002\u800c <code>AV_LOG_ERROR</code> \u5c31\u4f1a\u88ab\u6253\u5370\uff0c\u5b83\u7684\u503c\u662f 16 \uff0c\u7ea7\u522b\u66f4\u9ad8\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/av-beginner-010/#_3","title":"\u81ea\u5b9a\u4e49\u65e5\u5fd7\u6253\u5370","text":"<p>\u5728 FFmpeg \u4e2d\u53ef\u4ee5\u901a\u8fc7 <code>av_log_set_callback</code> \u51fd\u6570\u6765\u6ce8\u518c\u4e00\u4e2a\u65e5\u5fd7\u56de\u8c03\uff0c\u5728\u56de\u8c03\u4e2d\u81ea\u5b9a\u4e49\u65e5\u5fd7\u6253\u5370\u65b9\u5f0f\u3002</p> <p><code>av_log_set_callback</code> \u7684\u51fd\u6570\u58f0\u660e\u5982\u4e0b\uff1a</p> <pre><code>void av_log_set_callback(void (*callback)(void*, int level, const char* fmt, va_list));\n</code></pre> <p>\u5b83\u7684\u53c2\u6570\u662f\u4f20\u4e00\u4e2a\u51fd\u6570\u6307\u9488\uff0c\u5176\u4e2d <code>level</code> \u6307\u5b9a\u4e86\u65e5\u5fd7\u56de\u8c03\u7684\u7ea7\u522b\uff0c\u6839\u636e\u4e0d\u540c\u7ea7\u522b\u505a\u4e0d\u540c\u64cd\u4f5c\uff0c<code>fmt</code> \u548c <code>va_list</code> \u5c31\u662f\u56de\u8c03\u7684\u65e5\u5fd7\u5185\u5bb9\u4e86\uff0c\u548c <code>print</code> \u51fd\u6570\u76f8\u4f3c\u3002</p> <p>\u4ee5\u4e0b\u5c31\u662f\u5177\u4f53\u7684\u64cd\u4f5c\uff1a</p> <pre><code>static void log_callback(void *ptr, int level, const char *fmt, va_list vaList) {\n    switch (level) {\n        case AV_LOG_DEBUG:\n            logD(fmt, vaList);\n            break;\n        case AV_LOG_VERBOSE:\n            logV(LOG_MAGENTA, fmt, vaList);\n            break;\n        case AV_LOG_INFO:\n            logI(fmt, vaList);\n            break;\n        case AV_LOG_WARNING:\n            logW(fmt, vaList);\n            break;\n        case AV_LOG_ERROR:\n            logE(fmt, vaList);\n            break;\n        default:\n            log(fmt, vaList);\n            break;\n    }\n}\n</code></pre> <p>\u5728 <code>switch</code> \u505a\u65e5\u5fd7\u7ea7\u522b\u7684\u5206\u53d1\u5904\u7406\uff0c\u5177\u4f53\u7684\u6253\u5370\u65b9\u6cd5\u6559\u7ed9\u5b8f\u5b9a\u4e49\u7684\u51fd\u6570\u3002</p> <p>\u5728\u8fd9\u91cc\u4e3b\u8981\u662f\u6839\u636e\u4e0d\u540c\u7ea7\u522b\uff0c\u8c03\u6574\u65e5\u5fd7\u6253\u5370\u8f93\u51fa\u7684\u989c\u8272\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u6ce8\u518c\u4e86\u81ea\u5b9a\u4e49\u65e5\u5fd7\u6253\u5370\uff0c\u90a3\u4e48\u9664\u4e86\u6211\u4eec\u8c03\u7528 <code>av_log</code> \u65b9\u6cd5\u4f1a\u6253\u5370\u65e5\u5fd7\u4e4b\u5916\uff0cFFmpeg \u5185\u90e8\u7684\u4e00\u4e9b\u65e5\u5fd7\u4fe1\u606f\u4e5f\u4f1a\u901a\u8fc7\u81ea\u5b9a\u4e49\u7684\u65b9\u6cd5\u6253\u5370\u51fa\u6765\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/av-beginner-010/#_4","title":"\u81ea\u5b9a\u4e49\u65e5\u5fd7\u6253\u5370\u989c\u8272","text":"<p>\u4e00\u822c\u6765\u8bf4\uff0c\u65e5\u5fd7\u6253\u5370\u90fd\u662f\u901a\u8fc7\u5b8f\u51fd\u6570\u6765\u5b9a\u4e49\u7684\u3002</p> <pre><code>#define logD(format,...)        \\\nlogging(LOG_GREEN,format,##__VA_ARGS__)     \n</code></pre> <p>\u5176\u4e2d <code>##__VA_ARGS__</code> \u610f\u601d\u5c31\u662f\u53ef\u53d8\u53c2\u6570\u5b8f\uff0c\u5bf9\u5e94\u51fd\u6570\u91cc\u9762\u7684\u4e09\u4e2a\u70b9\u53ef\u53d8\u53c2\u6570 <code>...</code> \u3002</p> <p>\u5177\u4f53\u7684\u51fd\u6570\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <pre><code>static void logging(const char * color ,const char *fmt, va_list vaList)\n{\n    // \u8bbe\u7f6e\u65e5\u5fd7\u6253\u5370\u989c\u8272\n    printf(\"%s [av-beginner]: \",color);\n    // \u6253\u5370\u5185\u5bb9\n    vprintf( fmt, vaList );\n    // \u7ed3\u675f\u65e5\u5fd7\u989c\u8272\u8bbe\u5b9a\n    printf(LOG_NONE \"\\n\" );\n}\n\nstatic void logging(const char * color ,const char *fmt, ...)\n{\n    va_list vaList;\n    va_start( vaList, fmt );\n    logging(color,fmt,vaList);\n    va_end(vaList);\n}\n</code></pre> <p>\u8fd9\u91cc\u9762\u6d89\u53ca\u5230\u53ef\u53d8\u53c2\u6570\u4ee5\u53ca\u65e5\u5fd7\u989c\u8272\u6253\u5370\u7684\u5185\u5bb9\uff0c\u5c55\u5f00\u8bf4\u4e00\u4e0b\u65e5\u5fd7\u989c\u8272\u6253\u5370\u3002</p> <p>\u5728\u7ec8\u7aef\u7684\u5b57\u7b26\u989c\u8272\u662f\u7531\u8f6c\u4e49\u5e8f\u5217\u63a7\u5236\u7684\uff0c\u6bd4\u5982\u7ec8\u7aef\u4e2d\u8981\u6362\u884c\uff0c\u90a3\u4e48\u8f6c\u4e49\u5e8f\u5217\u5c31\u662f <code>\\n</code> \u64cd\u4f5c\uff0c\u5bf9\u4e8e\u989c\u8272\u63a7\u5236\u540c\u6837\u5982\u6b64\u3002</p> <p>\u5177\u4f53\u7684\u663e\u793a\u683c\u5f0f\u5982\u4e0b\uff1a</p> <p>\\033[\u663e\u793a\u65b9\u5f0f;\u524d\u666f\u8272;\u80cc\u666f\u8272m\u8f93\u51fa\u5b57\u7b26\u4e32\\033[0m</p> <p>\u6216</p> <p>\\e[\u663e\u793a\u65b9\u5f0f;\u524d\u666f\u8272;\u80cc\u666f\u8272m\u8f93\u51fa\u5b57\u7b26\u4e32\\e[0m</p> <p>\u5728\u8c03\u7528 print \u51fd\u6570\u6253\u5370\u4fe1\u606f\u65f6\uff0c\u5c31\u6309\u7167\u4ee5\u4e0a\u7684\u65b9\u5f0f\u5373\u53ef\uff0c\u6bd4\u5982\uff1a</p> <pre><code>// \u6253\u5370\u7ea2\u8272\u7684\u65e5\u5fd7\u5185\u5bb9\nprintf(\"\\033[0;31m print red color log \\033[0m\\n\") ;\n</code></pre> <p>\u4ee5\u4e0a\u5c31\u53ef\u4ee5\u6253\u5370\u51fa\u7ea2\u8272\u7684\u65e5\u5fd7\u4fe1\u606f\uff0c\u5177\u4f53\u7684\u5173\u4e8e\u663e\u793a\u65b9\u5f0f\u3001\u524d\u666f\u8272\u3001\u80cc\u666f\u8272\u8fd9\u4e9b\u5185\u5bb9\uff0c\u540e\u7eed\u7684\u6587\u7ae0\u518d\u63a5\u7740\u8bf4\u4e86\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/av-beginner-010/#_5","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u8fde\u8f7d\u7684 010 \u7bc7\u3002</p> <p>\u7b80\u5355\u8bb2\u89e3\u4e86 FFmpeg \u4e2d\u7684\u65e5\u5fd7\u6253\u5370\u5185\u5bb9\uff0c\u672c\u6587\u5177\u4f53\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u4ed3\u5e93\u7684\u4ee3\u7801\u4f1a\u6bd4\u6587\u7ae0\u63d0\u524d\u66f4\u65b0\uff0c\u60f3\u8981\u62a2\u5148\u77e5\u9053\u540e\u7eed\u5185\u5bb9\uff0c\u5c31\u5173\u6ce8\u4ee3\u7801\u5427\uff0c\u6b22\u8fce star \u3002</p> <p>\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4e0d\u5bf9\u4e4b\u5904\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u8fdb\u884c\u4ea4\u6d41~~</p>","tags":["FFmpeg"]},{"location":"ffmpeg/encode-and-decode-summary/","title":"\u97f3\u89c6\u9891\u7f16\u89e3\u7801\u7684\u90a3\u4e9b\u57fa\u7840\u7406\u8bba","text":"<p>\u6700\u8fd1\u5728\u7814\u7a76\u5b66\u4e60 FFmpeg\uff0c\u4ece\u7f51\u4e0a\u53c2\u8003\u4e86\u597d\u591a\u8d44\u6599\uff0c\u5176\u4e2d\u6700\u4e86\u4e0d\u8d77\u7684\u5c31\u5f53\u5c5e\u2014\u2014\u96f7\u9704\u9a85\u5927\u795e\u4e86\uff0c\u82e5\u6ca1\u6709\u4ed6\u7684\u535a\u6587\uff0c\u522b\u8bf4\u5165\u95e8\u4e86\uff0c\u53ef\u80fd\u8fde\u95e8\u5728\u54ea\u91cc\u90fd\u4e0d\u77e5\u9053\uff0c\u5728\u6b64\u8fd8\u662f\u8981\u8868\u8fbe\u4e00\u4e0b\u5bf9\u96f7\u795e\u7684\u656c\u4f69\u548c\u656c\u4ef0\u3002</p> <p>\u672c\u6587\u4e3b\u8981\u8bb2\u7684\u662f\u89c6\u9891\u6587\u4ef6\u7684\u89e3\u7801\uff0c\u4ece\u89c6\u9891\u6587\u4ef6\u7684\u5c01\u88c5\u683c\u5f0f\u89e3\u7801\u5230\u539f\u59cb\u6570\u636e\u683c\u5f0f\uff0c\u901a\u8fc7\u8bb2\u89e3\u6d89\u53ca\u5230\u7684\u5404\u79cd\u6982\u5ff5\uff0c\u4ece\u800c\u7406\u6e05\u6574\u4e2a\u601d\u8def\u548c\u6d41\u7a0b\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/encode-and-decode-summary/#_1","title":"\u4e3a\u4f55\u5c01\u88c5\u683c\u5f0f\uff1f","text":"<p>\u5728\u6211\u4eec\u5e73\u65f6\u63a5\u89e6\u5230\u7684\u89c6\u9891\u6587\u4ef6\uff0c\u5927\u90fd\u662f\u4ee5<code>.mp4</code>\u3001<code>.flv</code>\u3001<code>.avi</code>\u3001<code>.rmvb</code>\u540e\u7f00\u7ed3\u5c3e\u7684\u3002</p> <p>\u7136\u800c\uff0c\u4e8b\u60c5\u5e76\u4e0d\u662f\u8fd9\u4e48\u7b80\u5355\uff0c\u8fd9\u4e9b\u540e\u7f00\u540d\u5176\u5b9e\u8fd8\u4ee3\u8868\u7740\u4e00\u79cd\u5c01\u88c5\u683c\u5f0f\uff0c\u4e00\u79cd\u628a\u97f3\u9891\u6570\u636e\u548c\u89c6\u9891\u6570\u636e\u6253\u5305\u6210\u4e00\u4e2a\u6587\u4ef6\u7684\u683c\u5f0f\u89c4\u8303\u3002</p> <p>\u914d\u56fe\u4e00\u5f20\uff0c\u4ee5 <code>.xxx</code> \u540e\u7f00\u7684\u89c6\u9891\u6587\u4ef6\u5927\u6982\u5305\u542b\u5982\u4e0b\u5185\u5bb9\uff1a</p> <p></p> <p>\u7531\u6b64\u53ef\u89c1\uff0c\u6211\u4eec\u5e73\u65f6\u63a5\u89e6\u7684<code>.avi</code>\u5305\u542b\u7684\u4e1c\u897f\u8fd8\u662f\u633a\u591a\u7684\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/encode-and-decode-summary/#_2","title":"\u5c01\u88c5\u683c\u5f0f\u7684\u7f16\u89e3\u7801","text":"<p>\u5728\u4e0a\u9762\u6709\u8bb2\u5230\uff0c\u89c6\u9891\u6587\u4ef6\u5176\u5b9e\u5305\u542b\u7740\u97f3\u9891\u6570\u636e\u548c\u89c6\u9891\u6570\u636e\uff0c\u90a3\u4e48\u8fd9\u4e9b\u97f3\u9891\u6570\u636e\u548c\u89c6\u9891\u6570\u636e\u53c8\u662f\u5982\u4f55\u5f62\u6210\u5c01\u88c5\u683c\u5f0f\u7684\u5462\uff1f</p> <p>\u8fd9\u91cc\u5c31\u6d89\u53ca\u5230\u7f16\u89e3\u7801\u7684\u77e5\u8bc6\u4e86\uff0c\u539f\u59cb\u7684\u97f3\u9891\u6216\u8005\u89c6\u9891\u6570\u636e\u662f\u5f88\u5927\u7684\u3002\u6bd4\u5982\uff0c\u5982\u679c\u4e0d\u8fdb\u884c\u538b\u7f29\u6216\u8005\u7f16\u7801\u5904\u7406\uff0c\u7528\u624b\u673a\u968f\u4fbf\u5f55\u4e00\u6bb5\u89c6\u9891\u53ef\u80fd\u5c31\u6709\u51e0\u767eM\u4e86\uff0c\u800c\u6709\u65f6\u5019\u770b\u90e8\u4e00\u4e2a\u5c0f\u65f6\u7684\u7535\u5f71\u4e5f\u5c31\u624d\u51e0\u767eM\uff0c\u8fd9\u5c31\u662f\u5bf9\u539f\u59cb\u6570\u636e\u5904\u7406\u65b9\u5f0f\u4e0d\u540c\u7684\u7ed3\u679c\u3002</p> <p>\u800c\u6211\u4eec\u7684\u97f3\u9891\u6216\u8005\u89c6\u9891\u6570\u636e\uff0c\u4e5f\u662f\u8981\u901a\u8fc7<code>\u7f16\u7801</code>\u5904\u7406\u8fdb\u884c\u538b\u7f29\uff0c\u5bf9\u4ed6\u4eec\u8fdb\u884c\u7f16\u7801\u5904\u7406\u540e\uff0c\u4f53\u79ef\u90fd\u4f1a\u53d8\u5c0f\uff0c\u8fd9\u6837\u624d\u80fd\u5408\u5e76\u6210\u5177\u4f53\u7684\u67d0\u79cd\u5c01\u88c5\u683c\u5f0f\u3002</p> <p>\u540c\u65f6\uff0c\u5f53\u6211\u4eec\u8981\u64ad\u653e\u89c6\u9891\u6216\u8005\u97f3\u9891\u65f6\uff0c\u8fd8\u9700\u8981\u5bf9\u7f16\u7801\u538b\u7f29\u540e\u7684\u6570\u636e\u8fdb\u884c<code>\u89e3\u7801</code>\uff0c\u4ece\u538b\u7f29\u7684\u6570\u636e\u89e3\u7801\u5230\u539f\u59cb\u6570\u636e\uff0c\u5e76\u5c06\u539f\u59cb\u6570\u636e\u9001\u5230\u5bf9\u5e94\u7684\u8bbe\u5907\uff0c\u6bd4\u5982\u663e\u5361\u6216\u8005\u58f0\u5361\u8fdb\u884c\u64ad\u653e\u3002\u8fd9\u5c31\u662f\u4e00\u4e2a<code>\u89e3\u5c01\u88c5</code>\u7684\u8fc7\u7a0b\u3002</p> <p>\u4e0d\u540c\u7684\u5c01\u88c5\u683c\u5f0f\u652f\u6301\u7684\u97f3\u89c6\u9891\u7f16\u89e3\u7801\u6807\u51c6\u4e0d\u4e00\u6837\uff0c\u8d8a\u662f\u4f18\u8d8a\u7684\u5c01\u88c5\u683c\u5f0f\uff0c\u652f\u6301\u7684\u7f16\u7801\u6807\u51c6\u8d8a\u591a\uff0c\u6bd4\u5982\uff1a<code>MKV</code>\u5c01\u88c5\u683c\u5f0f\uff0c\u800c<code>RMVB</code>\u5c01\u88c5\u683c\u5f0f\u5c31\u7b97\u843d\u540e\u7684\uff0c\u652f\u6301\u7684\u97f3\u89c6\u9891\u6807\u51c6\u6709\u9650\u3002</p> <p>\u8fd9\u91cc\uff0c\u8fd8\u662f\u501f\u96f7\u795e\u7684\u56fe\u4e00\u5f20\uff0c\u5f88\u5f62\u8c61\u7684\u89e3\u91ca\u4e86\u97f3\u9891\u6587\u4ef6\u89e3\u7801\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002</p> <ul> <li>\u89e3\u534f\u8bae-&gt;\u5c01\u88c5\u683c\u5f0f\u6570\u636e</li> <li>\u89e3\u5c01\u88c5-&gt;\u97f3\u9891\u6570\u636e\u548c\u89c6\u9891\u6570\u636e<ul> <li>\u97f3\u9891\u89e3\u7801-&gt;\u8bbe\u5907\u8f93\u51fa</li> <li>\u89c6\u9891\u89e3\u7801-&gt;\u8bbe\u5907\u8f93\u51fa</li> </ul> </li> </ul> <p></p>","tags":["FFmpeg"]},{"location":"ffmpeg/encode-and-decode-summary/#_3","title":"\u97f3\u89c6\u9891\u7684\u539f\u59cb\u6570\u636e\u683c\u5f0f\u548c\u7f16\u89e3\u7801\u6807\u51c6","text":"<p>\u5728\u4e0a\u9762\u6709\u8bb2\u5230\uff0c\u5c01\u88c5\u683c\u5f0f\u5176\u5b9e\u5c31\u662f\u97f3\u9891\u6216\u8005\u89c6\u9891\u7684\u539f\u59cb\u6570\u636e\u8fdb\u884c\u7f16\u7801\u538b\u7f29\u5f97\u5230\u7684\u3002\u800c\u4e14\uff0c\u97f3\u9891\u548c\u89c6\u9891\u5bf9\u5e94\u7684\u539f\u59cb\u6570\u636e\u683c\u5f0f\u548c\u7f16\u89e3\u7801\u6807\u51c6\u90fd\u4e0d\u4e00\u6837\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/encode-and-decode-summary/#_4","title":"\u97f3\u9891\u7684\u539f\u59cb\u6570\u636e\u683c\u5f0f\u548c\u7f16\u89e3\u7801\u6807\u51c6","text":"<p>\u97f3\u9891\u7684\u539f\u59cb\u6570\u636e\u683c\u5f0f\u4e3b\u8981\u6709\u5982\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>PCM \u683c\u5f0f</li> </ul> <p>\u97f3\u9891\u7684\u7f16\u89e3\u7801\u6807\u51c6\u4e3b\u8981\u6709\u5982\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>MP3 </li> <li>AAC</li> <li>AC-3</li> </ul>","tags":["FFmpeg"]},{"location":"ffmpeg/encode-and-decode-summary/#_5","title":"\u89c6\u9891\u7684\u539f\u59cb\u6570\u636e\u683c\u5f0f\u548c\u7f16\u89e3\u7801\u6807\u51c6","text":"<p>\u89c6\u9891\u7684\u539f\u59cb\u6570\u636e\u683c\u5f0f\u4e3b\u8981\u6709\u5982\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>YUV \u683c\u5f0f</li> <li>RGB \u683c\u5f0f</li> </ul> <p>\u89c6\u9891\u7684\u7f16\u89e3\u7801\u6807\u51c6\u4e3b\u8981\u6709\u5982\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>H.264</li> <li>H.265</li> <li>MPEG2</li> </ul> <p>\u8fd9\u4e9b\u539f\u59cb\u6570\u636e\u683c\u5f0f\u548c\u7f16\u89e3\u7801\u6807\u51c6\u521d\u6b21\u770b\u662f\u6709\u70b9\u964c\u751f\uff0c\u4f46\u63a5\u89e6\u591a\u4e86\uff0c\u4e5f\u5c31\u9010\u6e10\u719f\u6089\u4e86\uff0c\u5148\u4ee5\u638c\u63e1\u4e3b\u6d41\u7684\u7f16\u89e3\u7801\u6807\u51c6\u4e3a\u4e3b\uff0c\u8fd9\u91cc\u4e5f\u53ea\u662f\u5217\u51fa\u4e86\u5176\u4e2d\u4e00\u90e8\u5206\u800c\u5df2\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/encode-and-decode-summary/#mepg-pcm","title":"MEPG-&gt;PCM \u7684\u89e3\u6790","text":"<p>\u6709\u4e86\u4ee5\u4e0a\u7684\u7406\u8bba\u57fa\u7840\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u6211\u4eec\u7684\u89e3\u6790\u5de5\u4f5c\u4e86\u3002</p> <p>\u4f7f\u7528 FFmpeg 3.x \u7684\u7248\u672c\uff08\u4e0e 2.x \u7248\u672c\u76f8\u6bd4\u63a5\u53e3\u6709\u4e86\u8f83\u5927\u53d8\u5316\uff09\u5c06 MEPG \u7684\u89c6\u9891\u6587\u4ef6\u89e3\u7801\u5230 PCM \u7684\u539f\u751f\u6570\u636e\u683c\u5f0f\u3002</p> <p>\u8fd9\u91cc\u7684\u6848\u4f8b\u53c2\u8003\u7684\u662f FFmpeg \u5b98\u7f51\u7684\u4f8b\u5b50\uff0c\u5730\u5740\u5728\u6b64\uff1ahttp://ffmpeg.org/doxygen/trunk/examples.html\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/encode-and-decode-summary/#_6","title":"\u53c2\u8003","text":"<ol> <li>http://blog.csdn.net/leixiaohua1020/article/details/15811977</li> <li>http://ffmpeg.org/doxygen/trunk/examples.html</li> </ol>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-call-android-mediacodec/","title":"FFmpeg \u8c03\u7528 Android MediaCodec \u8fdb\u884c\u786c\u89e3\u7801\uff08\u9644\u6e90\u7801\uff09","text":"<p>\u6587\u7ae0\u539f\u521b\u9996\u53d1\u516c\u4f17\u53f7\uff1a\u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636\u3002\u94fe\u63a5\u5730\u5740\uff1ahttps://mp.weixin.qq.com/s/S8NwQnY4uyQulfZnRF7t_A</p> <p>FFmpeg \u5728 3.1 \u7248\u672c\u4e4b\u540e\u652f\u6301\u8c03\u7528\u5e73\u53f0\u786c\u4ef6\u8fdb\u884c\u89e3\u7801\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u901a\u8fc7 FFmpeg \u7684 C \u4ee3\u7801\u53bb\u8c03\u7528 Android \u4e0a\u7684 MediaCodec \u4e86\u3002</p> <p>\u5728\u5b98\u7f51\u4e0a\u6709\u5bf9\u5e94\u8bf4\u660e\uff0c\u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://trac.ffmpeg.org/wiki/HWAccelIntro</p> <p></p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u4e0d\u4ec5\u4ec5\u662f Android \u4e0a\u652f\u6301 MediaCodec\uff0ciOS \u4e0a\u4e5f\u652f\u6301 VideoToolbox\uff0c\u8fde Windows \u4e0a\u7684 Direct3D 11 \u90fd\u6709\u652f\u6301\u4e86\u3002</p> <p>\u6ce8\u610f\uff1aAndroid MediaCodec \u76ee\u524d\u4ec5\u652f\u6301\u89e3\u7801\uff0c\u8fd8\u4e0d\u652f\u6301\u7f16\u7801\u5462\u3002</p> <p>\u4e0d\u8fc7\uff0c\u4e3a\u4e86\u9a8c\u8bc1\u662f\u5426\u53ef\u884c\uff0c\u505a\u4e2a\u7b80\u5355\u7684\u6f14\u793a\uff0c\u6700\u540e\u4f1a\u6709\u5b8c\u6574\u7684\u7684\u4ee3\u7801\u7ed9\u51fa\u3002</p> <p>\u9996\u5148\u662f FFmpeg \u7684\u7f16\u8bd1\u3002\u5b83\u7684\u7f16\u8bd1\u6709\u5f88\u591a\u5f00\u5173\u9009\u9879\uff0c\u8981\u786e\u4fdd\u6253\u5f00\u4e86 mediacodec \u76f8\u5173\u7684\u9009\u9879\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <pre><code>--enable-mediacodec\n--enable-decoder=h264_mediacodec\n--enable-decoder=hevc_mediacodec\n--enable-decoder=mpeg4_mediacodec\n--enable-hwaccel=h264_mediacodec\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa mediacodec \u652f\u6301\u7684\u7f16\u7801\u683c\u5f0f\u6709 h264\u3001hevc\u3001mpeg4 \u4e09\u79cd\u53ef\u9009\uff0c\u4e0d\u5728\u8303\u56f4\u5185\u7684\u5c31\u8fd8\u662f\u8003\u8651\u8f6f\u89e3\u5427\u3002</p> <p>\u5173\u4e8e\u5982\u4f55\u7f16\u8bd1\uff0c\u5c31\u4e0d\u8be6\u7ec6\u9610\u8ff0\u4e86\uff0c\u540e\u9762\u518d\u4e13\u95e8\u5199\u4e00\u7bc7\u6765\u4ecb\u7ecd\u3002</p> <p>\u7f16\u8bd1\u51fa\u5bf9\u5e94\u7684 so \u4e4b\u540e\uff0c\u53ef\u4ee5\u6253\u5370\u4e00\u4e0b AVCodec \u652f\u6301\u7684\u683c\u5f0f\u5217\u8868\uff0c\u770b\u770b\u6709\u6ca1\u6709 mediacodec \u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>char info[40000] = {0};\n\nAVCodec *c_temp = av_codec_next(NULL);\nwhile (c_temp != NULL) {\n    if (c_temp-&gt;decode != NULL) {\n        sprintf(info, \"%s[Dec]\", info);\n    } else {\n        sprintf(info, \"%s[Enc]\", info);\n    }\n\n    switch (c_temp-&gt;type) {\n        case AVMEDIA_TYPE_VIDEO:\n            sprintf(info, \"%s[Video]\", info);\n            break;\n        case AVMEDIA_TYPE_AUDIO:\n            sprintf(info, \"%s[Audio]\", info);\n            break;\n        default:\n            sprintf(info, \"%s[Other]\", info);\n            break;\n    }\n    sprintf(info, \"%s %10s\\n\", info, c_temp-&gt;name);\n    c_temp = c_temp-&gt;next;\n}\n</code></pre> <p>\u901a\u8fc7 AVCodec \u7684 next \u6307\u9488\u8fdb\u884c\u904d\u5386\uff0c\u7136\u540e\u6253\u5370\u51fa\u7ed3\u679c\uff0c\u770b\u5230\u4e0b\u9762\u7684\u5185\u5bb9\u8bf4\u660e\u7f16\u8bd1\u6210\u529f\u4e86\u3002</p> <p></p> <p>\u652f\u6301\u7684\u683c\u5f0f\u91cc\u9762\u5df2\u7ecf\u6709\u4e86 h264_mediacodec \u548c mpeg4_mediacodec \u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u8fdb\u884c\u89e3\u7801\u4e86\u3002\u5173\u4e8e FFmpeg \u89e3\u7801\u7684 API \u8c03\u7528\uff0c\u5728\u516c\u4f17\u53f7\u4ee5\u524d\u53d1\u5e03\u7684\u6587\u7ae0\u4e2d\u8bf4\u8fc7\u591a\u6b21\uff0c\u5c31\u4e0d\u8be6\u7ec6\u8bb2\u89e3\u6d41\u7a0b\u4e86\uff0c\u7b80\u5355\u6982\u51b5\u4e00\u4e0b\uff1a</p> <ol> <li>\u9996\u5148\u901a\u8fc7 avformat_open_input \u65b9\u6cd5\u6253\u5f00\u6587\u4ef6\uff0c\u5f97\u5230 AVFormatContext \u3002</li> <li>\u7136\u540e\u901a\u8fc7 avformat_find_stream_info \u67e5\u627e\u6587\u4ef6\u7684\u89c6\u9891\u6d41\u4fe1\u606f\u3002</li> <li>\u5f97\u5230\u6587\u4ef6\u76f8\u5173\u4fe1\u606f\u548c\u89c6\u9891\u6d41\u4fe1\u606f\uff0c\u4e3b\u8981\u8fd8\u662f\u4e3a\u4e86\u5f97\u5230\u7f16\u7801\u683c\u5f0f\u4fe1\u606f\uff0c\u7136\u540e\u597d\u627e\u5230\u5bf9\u5e94\u7684\u89e3\u7801\u5668\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7 avcodec_find_decoder_by_name \u65b9\u6cd5\u76f4\u63a5\u627e\u5177\u4f53\u7684\u89e3\u7801\u5668\u3002</li> <li>\u6709\u4e86\u89e3\u7801\u5668\u5c31\u53ef\u4ee5\u521b\u5efa\u89e3\u7801\u4e0a\u4e0b\u6587 AVCodecContext\uff0c\u5e76\u901a\u8fc7 avcodec_open2 \u65b9\u6cd5\u6253\u5f00\u89e3\u7801\u5668</li> <li>\u7136\u540e\u901a\u8fc7 av_read_frame \u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\u597d\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u89e3\u7801\u3002</li> <li>\u63a5\u4e0b\u6765\u5c31\u662f\u719f\u6089\u7684 avcodec_send_packet \u53d1\u9001\u7ed9\u89e3\u7801\u5668\uff0cavcodec_receive_frame \u4ece\u89e3\u7801\u5668\u53d6\u56de\u89e3\u7801\u540e\u7684\u6570\u636e\u3002</li> </ol> <p>\u91cd\u70b9\u8bb2\u89e3\u4e00\u4e0b\u8c03\u7528\u786c\u4ef6\u89e3\u7801\u548c\u666e\u901a\u89e3\u7801\u7684\u4e00\u4e9b\u533a\u522b\uff1a</p> <p>\u7b2c\u4e00\u6b65\u662f\u8981\u5728 so \u52a0\u8f7d\u7684 JNI_OnLoad \u65b9\u6cd5\u4e2d\u5c06 JavaVM \u8bbe\u7f6e\u7ed9 FFmpeg \u3002</p> <pre><code>jint JNI_OnLoad(JavaVM *vm, void *res) {\n    av_jni_set_java_vm(vm, 0);\n    return JNI_VERSION_1_4;\n}\n</code></pre> <p>\u7f3a\u5c11\u8fd9\u4e00\u6b65\u5c31\u4e0d\u80fd\u53cd\u5c04\u8c03\u7528 Java \u65b9\u6cd5\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u8fd8\u662f\u5224\u65ad\u786c\u4ef6\u89e3\u7801\u7c7b\u578b\u652f\u4e0d\u652f\u6301\uff0c\u4e0a\u9762\u662f\u901a\u8fc7 AVCodec \u6765\u5224\u65ad\u7684\uff0c\u5b9e\u9645\u4e0a FFmpeg \u90fd\u7ed9\u51fa\u4e86\u786c\u4ef6\u7c7b\u578b\u7684\u5b9a\u4e49\uff0c\u5728 AVHWDeviceType \u679a\u4e3e\u53d8\u91cf\u4e2d\u3002</p> <pre><code>enum AVHWDeviceType {\n    AV_HWDEVICE_TYPE_NONE,\n    AV_HWDEVICE_TYPE_VDPAU,\n    AV_HWDEVICE_TYPE_CUDA,\n    AV_HWDEVICE_TYPE_VAAPI,\n    AV_HWDEVICE_TYPE_DXVA2,\n    AV_HWDEVICE_TYPE_QSV,\n    AV_HWDEVICE_TYPE_VIDEOTOOLBOX,\n    AV_HWDEVICE_TYPE_D3D11VA,\n    AV_HWDEVICE_TYPE_DRM,\n    AV_HWDEVICE_TYPE_OPENCL,\n    AV_HWDEVICE_TYPE_MEDIACODEC,\n    AV_HWDEVICE_TYPE_VULKAN,\n};\n</code></pre> <p>\u901a\u8fc7 av_hwdevice_get_type_name \u65b9\u6cd5\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u679a\u4e3e\u503c\u8f6c\u6362\u6210\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\uff0c\u6bd4\u5982 AV_HWDEVICE_TYPE_MEDIACODEC \u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\u5c31\u662f mediacodec \uff0c\u5176\u5b9e\u5728\u6e90\u7801\u91cc\u9762\u4e5f\u662f\u6709\u7684\uff1a</p> <pre><code>static const char *const hw_type_names[] = {\n    [AV_HWDEVICE_TYPE_CUDA]   = \"cuda\",\n    [AV_HWDEVICE_TYPE_DRM]    = \"drm\",\n    [AV_HWDEVICE_TYPE_DXVA2]  = \"dxva2\",\n    [AV_HWDEVICE_TYPE_D3D11VA] = \"d3d11va\",\n    [AV_HWDEVICE_TYPE_OPENCL] = \"opencl\",\n    [AV_HWDEVICE_TYPE_QSV]    = \"qsv\",\n    [AV_HWDEVICE_TYPE_VAAPI]  = \"vaapi\",\n    [AV_HWDEVICE_TYPE_VDPAU]  = \"vdpau\",\n    [AV_HWDEVICE_TYPE_VIDEOTOOLBOX] = \"videotoolbox\",\n    [AV_HWDEVICE_TYPE_MEDIACODEC] = \"mediacodec\",\n    [AV_HWDEVICE_TYPE_VULKAN] = \"vulkan\",\n};\n</code></pre> <p>\u548c\u904d\u5386 AVCodec \u4e00\u6837\uff0c\u4e5f\u8981\u904d\u5386 FFmpeg \u662f\u5426\u652f\u6301 mediacodec \u3002</p> <pre><code>type = av_hwdevice_find_type_by_name(mediacodec);\nif (type == AV_HWDEVICE_TYPE_NONE) {\n    LOGE(\"Device type %s is not supported.\\n\", mediacodec);\n    LOGE(\"Available device types:\");\n    while((type = av_hwdevice_iterate_types(type)) != AV_HWDEVICE_TYPE_NONE)\n        LOGE(\" %s\", av_hwdevice_get_type_name(type));\n    LOGE(\"\\n\");\n    return -1;\n}\n</code></pre> <p>\u786e\u5b9a\u652f\u6301 mediacodec \uff0c\u90a3\u4e48\u89e3\u7801\u5c31\u53ef\u4ee5\u7528\u4e86\u3002\u524d\u9762\u63d0\u5230\uff0c\u83b7\u53d6\u6587\u4ef6\u4fe1\u606f\u4e3b\u8981\u662f\u4e3a\u4e86\u6253\u5f00\u89e3\u7801\u5668\u7684\uff0c\u4f46\u6bd4\u5982\u6587\u4ef6\u7f16\u7801\u683c\u5f0f\u7684 H.264 \uff0c\u800c\u652f\u6301 H.264 \u7684\u89e3\u7801\u5668\u9664\u4e86\u8f6f\u89e3\uff0c\u8fd8\u6709 mediacodec \u8981\u600e\u4e48\u9009\u62e9\u5462\uff1f </p> <p>\u4e3a\u4e86\u65b9\u4fbf\uff0c\u76f4\u63a5 avcodec_find_decoder_by_name \u627e\u5230 mediacodec \u7684\u89e3\u7801\u5668\u5c31\u884c\u3002</p> <pre><code>if (!(decoder = avcodec_find_decoder_by_name(\"h264_mediacodec\"))) {\n    LOGE(\"avcodec_find_decoder_by_name failed.\\n\");\n    return -1;\n}\n</code></pre> <p>\u627e\u5230\u89e3\u7801\u5668\u4e4b\u540e\uff0c\u8fd8\u8981\u5f97\u5230\u8be5\u89e3\u7801\u5668\u7684\u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f\uff0c\u6bd4\u5982\u89e3\u7801\u51fa\u7684\u683c\u5f0f\u662f\u4ec0\u4e48\u6837\u5b50\u7684\uff1fmediacodec \u89e3\u7801\u5c31\u662f NV21 \u8fd9\u79cd\u3002</p> <pre><code>for (i = 0;; i++) {\n    // \u89e3\u7801\u5668\u7684\u914d\u7f6e\n    const AVCodecHWConfig *config = avcodec_get_hw_config(decoder, i);\n    if (!config) {\n        LOGE(\"Decoder %s does not support device type %s.\\n\",\n                decoder-&gt;name, av_hwdevice_get_type_name(type));\n        return -1;\n    }\n    if (config-&gt;methods &amp; AV_CODEC_HW_CONFIG_METHOD_HW_DEVICE_CTX &amp;&amp;\n        config-&gt;device_type == type) {\n        // \u786c\u89e3\u7684\u683c\u5f0f\n        hw_pix_fmt = config-&gt;pix_fmt;\n        break;\n    }\n}\n</code></pre> <p>\u76ee\u524d mediacodec \u89e3\u7801\u8fd8\u53ea\u6709 buffer \u6a21\u5f0f\uff0c\u6ca1\u6709\u76f4\u63a5\u89e3\u7eb9\u7406\u7684\u90a3\u79cd\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7ed9\u89e3\u7801\u4e0a\u4e0b\u6587 AVCodecContext \u6dfb\u52a0\u4e00\u4e9b\u786c\u4ef6\u89e3\u7801\u7684\u4e0a\u4e0b\u6587\u3002</p> <pre><code>static int hw_decoder_init(AVCodecContext *ctx, const enum AVHWDeviceType type)\n{\n    int err = 0;\n    if ((err = av_hwdevice_ctx_create(&amp;hw_device_ctx, type,\n                                      NULL, NULL, 0)) &lt; 0) {\n        LOGE(\"Failed to create specified HW device.\\n\");\n        return err;\n    }\n    // \u786c\u89e3\u89e3\u7801\u7684\u4e0a\u4e0b\u6587\n    ctx-&gt;hw_device_ctx = av_buffer_ref(hw_device_ctx);\n    return err;\n}\n</code></pre> <p>\u5b8c\u6210\u4e86\u8fd9\u4e00\u7cfb\u5217\u64cd\u4f5c\u4e4b\u540e\uff0c\u5c31\u662f\u6b63\u5e38\u7684\u89e3\u7801\u4e86\uff0c\u62ff\u5230\u89e3\u7801\u540e\u7684 AVFrame \u5185\u5bb9\u3002</p> <p>\u5982\u679c AVFrame \u683c\u5f0f\u548c\u786c\u4ef6\u89e3\u7801\u7684\u914d\u7f6e\u683c\u5f0f\u4e00\u6837\uff0c\u90a3\u4e48\u8981\u7528 av_hwframe_transfer_data \u65b9\u6cd5\u5c06\u5b83\u505a\u4e00\u4e0b\u8f6c\u6362\uff0c\u8f6c\u6210\u6b63\u5e38\u7684 YUV \u683c\u5f0f\u3002</p> <pre><code>if (frame-&gt;format == hw_pix_fmt) {\n    /* retrieve data from GPU to CPU */\n    if ((ret = av_hwframe_transfer_data(sw_frame, frame, 0)) &lt; 0) {\n        LOGE(\"Error transferring the data to system memory\\n\");\n        goto fail;\n    }\n    tmp_frame = sw_frame;\n} else\n    tmp_frame = frame;\n</code></pre> <p>\u7b49\u5b8c\u6210\u8fd9\u4e00\u4e9b\u64cd\u4f5c\u4e4b\u540e\uff0c\u5c31\u5df2\u7ecf\u89e3\u7801\u6210\u529f\u4e86\uff0c\u5b9e\u9645\u8fd0\u884c\u4e5f\u662f OK \u7684\u3002</p> <p>\u83b7\u53d6\u5b8c\u6574\u6e90\u7801\u7684\u8bdd\uff0c\u53ef\u4ee5\u5173\u6ce8\u5fae\u4fe1\u516c\u4f17\u53f7\uff1a\u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636\uff0c\u56de\u590d 1019 \u83b7\u53d6\u4e0b\u8f7d\u5730\u5740\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-call-mediacodec-deocde-to-surface/","title":"FFmpeg \u8c03\u7528 MediaCodec \u786c\u89e3\u7801\u5230 Surface \u4e0a","text":"<p>\u8fd9\u662f\u5173\u4e8e FFmpeg \u548c MediaCodec \u7231\u6068\u60c5\u4ec7\u7cfb\u5217\u7684\u7b2c\u4e09\u7bc7\u6587\u7ae0\u4e86\u3002</p> <p>\u4e4b\u524d\u5199\u4e86 FFmpeg \u8c03\u7528 MediaCodec \u8fdb\u884c\u786c\u89e3\u7801\u7684\u5185\u5bb9\u3002</p> <ul> <li>FFmpeg \u8c03\u7528 Android MediaCodec \u8fdb\u884c\u786c\u89e3\u7801</li> </ul> <p>\u53e6\u5916\u4e5f\u7ed9\u51fa\u4e86 FFmpeg \u7684\u7f16\u8bd1\u811a\u672c\uff0c\u8f7b\u677e\u641e\u5b9a\u7f16\u8bd1\u95ee\u9898\u3002</p> <ul> <li>\u8001\u751f\u5e38\u8c08-FFmpeg \u7684\u7f16\u8bd1\u95ee\u9898\u8f7b\u677e\u641e\u5b9a</li> </ul> <p>\u4f17\u6240\u5468\u77e5\uff0cMediaCodec \u7684\u89e3\u7801\u80fd\u529b\u4e0d\u4ec5\u53ef\u4ee5\u89e3\u7801\u51fa YUV \u6570\u636e\uff0c\u8fd8\u80fd\u76f4\u63a5\u89e3\u7801\u5230 Surface \u4e0a\u3002</p> <p>\u5728\u77ed\u89c6\u9891\u9886\u57df\u4e2d\uff0cMediaCodec \u89e3\u7801\u5230 Surface \u4e0a\u7684\u80fd\u529b\u53cd\u800c\u66f4\u52a0\u5e38\u7528\uff0c\u8fd9\u6837\u5c31\u80fd\u5c06\u753b\u9762\u8f6c\u5230 OES \u7eb9\u7406\u4e0a\uff0c\u4ece\u800c\u8fdb\u884c\u540e\u7eed\u5404\u79cd\u6e32\u67d3\u64cd\u4f5c\u3002</p> <p>\u4e4b\u524d\u4ecb\u7ecd\u7684 FFmpeg \u8c03\u7528 MediaCodec \u8fdb\u884c\u786c\u89e3\u7801\u53ea\u662f\u89e3\u7801\u51fa\u4e86 Buffer \u6570\u636e\uff0c\u6ca1\u6709\u628a\u89e3\u7801\u5230 Surface \u4e0a\u7684\u80fd\u529b\u7528\u8d77\u6765\u3002</p> <p>\u518d\u770b\u4e86\u66f4\u591a\u8d44\u6599\u4e4b\u540e\uff0c\u53d1\u73b0 FFmpeg \u8c03\u7528 MediaCodec \u5df2\u7ecf\u53ef\u4ee5\u89e3\u7801\u5230 Surface \u4e0a\u3002</p> <p>\u5177\u4f53\u53c2\u8003\u7684\u662f\u8fd9\u7bc7\u90ae\u4ef6\u5185\u5bb9\uff1a</p> <p>http://mplayerhq.hu/pipermail/ffmpeg-devel/2016-March/191700.html</p> <p>\u5728\u8fd9\u91cc\u9762\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u8fd9\u79cd\u80fd\u529b\uff0c\u6311\u91cd\u70b9\u622a\u56fe\u4e00\u4e0b\uff1a</p> <p></p> <p>\u56fe\u7247\u5185\u5bb9\u4ecb\u7ecd\u7684\u5f88\u8be6\u7ec6\uff0c\u6309\u7167\u6b65\u9aa4\u5b9e\u8df5\u5c31\u597d\u4e86\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-call-mediacodec-deocde-to-surface/#_1","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u5982\u679c\u719f\u6089\u4e86 FFmpeg \u8c03\u7528 MediaCodec \u89e3\u7801 Buffer \u6570\u636e\u7684\u6d41\u7a0b\uff0c\u90a3\u4e48\u89e3\u7801\u5230 Surface \u53ea\u662f\u5728\u6d41\u7a0b\u4e0a\u7a0d\u5fae\u6539\u52a8\u4e00\u70b9\u5c31\u884c\u3002</p> <p>\u9996\u5148\u8981\u51c6\u5907\u597d Surface \u5bf9\u8c61\uff0c\u5728 Java \u4e0a\u5c42\u6784\u5efa\u597d Surface \u5bf9\u8c61\u901a\u8fc7 NDK \u4f20\u5230 Native \u5c42\uff0c\u4f20\u4e0b\u6765\u7684\u662f\u4e00\u4e2a jobject \u5bf9\u8c61\u3002</p> <p>\u5982\u679c\u4e0d\u719f\u6089 NDK \u7684\u8bdd\uff0c\u53ef\u4ee5\u770b\u770b\u6211\u5728\u6155\u8bfe\u7f51\u4e0a\u7684\u5f55\u5236\u7684\u514d\u8d39\u8bfe\u7a0b\uff1a</p> <p>Android NDK \u514d\u8d39\u89c6\u9891\u5728\u7ebf\u5b66\u4e60\uff01\uff01\uff01</p> <p>\u5176\u6b21\u662f\u4e24\u4e2a\u65b0\u7684\u51fd\u6570\u65b9\u6cd5\uff1a</p> <p></p> <p>av_mediacodec_alloc_context \u548c av_mediacodec_default_init \u65b9\u6cd5\u5c31\u662f\u8ba9 Surface \u548c AVMediaCodecContext \u3001AVCodecContext \u4e09\u8005\u4e4b\u95f4\u4ea7\u751f\u5173\u8054\u3002</p> <p>\u5177\u4f53\u5c31\u662f AVCodecContext \u6301\u6709 AVMediaCodecContext \uff0cAVMediaCodecContext \u6301\u6709 Surface \u3002</p> <p>\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u5173\u8054\uff0c\u56e0\u4e3a\u5728 FFmpeg \u6e90\u7801\u91cc\u8981\u6839\u636e Surface \u662f\u5426\u4e3a nullptr \u5bf9 MediaCodec \u7684\u521d\u59cb\u5316\u548c\u89e3\u7801\u540e\u7684\u6570\u636e\u505a\u4e0d\u540c\u5904\u7406\u3002</p> <p>\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u9605\u8bfb\u8fd9\u5757\u7684\u6e90\u7801\uff0c\u5185\u5bb9\u4e0d\u591a\u901a\u4fd7\u6613\u61c2\u3002</p> <p>\u7b49\u5230\u89e3\u7801\u4e4b\u540e\uff0cFFmpeg \u540c\u6837\u4f1a\u8fd4\u56de\u4e00\u4e2a AVFrame \u6570\u636e\uff0c\u53ea\u4e0d\u8fc7\u5b83\u7684 data \u5b57\u6bb5\u4e0d\u518d\u662f Buffer \u5185\u5bb9\u4e86\u3002</p> <p>AVFrame \u7684\u683c\u5f0f\u4e0d\u518d\u662f NV12 \uff08\u89e3\u7801 Buffer \u6570\u636e\u7684\u8bdd\u5c31\u662f NV12\uff09\uff0c\u800c\u662f\u81ea\u5b9a\u4e49\u7684 AV_PIX_FMT_MEDIACODEC \uff0c\u4ee3\u8868\u8d70\u7684 Surface \u6a21\u5f0f\u3002</p> <pre><code>if (s-&gt;surface) {\n   // surface \u4e0d\u4e3a null \u7684\u60c5\u51b5\u4e0b\uff1a\n   // \u901a\u8fc7 mediacodec_wrap_hw_buffer \u5bf9\u6570\u636e\u8fdb\u884c\u5904\u7406\n\u00a0 if ((ret = mediacodec_wrap_hw_buffer(avctx, s, index, &amp;info, frame)) &lt; 0) {\n\u00a0   av_log(avctx, AV_LOG_ERROR, \"Failed to wrap MediaCodec buffer\\n\");\n\u00a0 \u00a0 \u00a0 \u00a0return ret;\n\u00a0 }\n}\n</code></pre> <p>Surface \u6a21\u5f0f\u4e0b\u5bf9\u6570\u636e\u7684\u5904\u7406\u662f mediacodec_wrap_hw_buffer \u51fd\u6570\uff0cBuffer \u6a21\u5f0f\u5c31\u662f mediacodec_wrap_sw_buffer \u51fd\u6570\u4e86\u3002</p> <p>\u540c\u65f6\uff0c\u771f\u6b63\u89e3\u7801\u540e\u7684\u6570\u636e\u5b58\u50a8\u5728 AVFrame-&gt;data[3] \u5b57\u6bb5\u4e0a\uff0c\u8fd9\u4e2a\u5b57\u6bb5\u662f\u4e2a\u8001\u5458\u5de5\u4e86\u3002</p> <p>\u4e00\u822c\u89e3\u7801\u975e Buffer \u6570\u636e\u7684\u60c5\u51b5\uff0c\u90fd\u4f1a\u5c06\u7279\u6b8a\u7684\u5185\u5bb9\u4fdd\u5b58\u5230 data[3] \u4e0a\uff0c\u6bd4\u5982 Window \u4e0a\u7684\u786c\u89e3\uff0c\u90e8\u5206\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>static int mediacodec_wrap_hw_buffer(AVCodecContext *avctx,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 MediaCodecDecContext *s,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ssize_t index,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 FFAMediaCodecBufferInfo *info,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 AVFrame *frame)\n// \u7701\u7565\u90e8\u5206\u6e90\u7801\n// \u521b\u5efa   AVMediaCodecBuffer \u5bf9\u8c61\nbuffer = av_mallocz(sizeof(AVMediaCodecBuffer));\nframe-&gt;buf[0] = av_buffer_create(NULL,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a00,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0mediacodec_buffer_release,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0buffer,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0AV_BUFFER_FLAG_READONLY);\n// buffer \u76f8\u5173\u5c5e\u6027\u8d4b\u503c\nbuffer-&gt;ctx = s;\nbuffer-&gt;serial = atomic_load(&amp;s-&gt;serial);\nif (s-&gt;delay_flush)\n\u00a0 \u00a0 ff_mediacodec_dec_ref(s);\n// index \u7d22\u5f15\uff0c\u4ee3\u8868 mediacodec \u4e2d buffer \u7684\u7d22\u5f15\nbuffer-&gt;index = index;\nbuffer-&gt;pts = info-&gt;presentationTimeUs;\n// \u5c06 buffer \u8d4b\u503c\u7ed9 data[3] \u5b57\u6bb5\nframe-&gt;data[3] = (uint8_t *)buffer;\n</code></pre> <p>\u6709\u4e86 AVFrame \u6570\u636e\u4e4b\u540e\uff0cSurface \u4e0a\u8fd8\u662f\u6ca1\u6709\u753b\u9762\u3002</p> <p>\u56de\u60f3\u4e00\u4e0b\uff0c\u5728 MediaCodec \u4e0a\u60f3\u8981\u6570\u636e\u6e32\u67d3\u5230 Surface \u8fd8\u5f97\u8c03\u7528\u4e00\u4e2a releaseOutputBuffer \u65b9\u6cd5\uff0c\u5176\u4e2d\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8981\u4f20 true \u624d\u53ef\u4ee5\u3002</p> <pre><code>public void releaseOutputBuffer (int index, boolean render)\n</code></pre> <p>\u540c\u6837\uff0c\u5728 FFmpeg \u4e2d\u4e5f\u6709\u8fd9\u4e48\u4e2a\u65b9\u6cd5\u3002</p> <pre><code>int av_mediacodec_release_buffer(AVMediaCodecBuffer *buffer, int render);\n</code></pre> <p>buffer \u5c31\u662f frame-&gt;data[3] \u7684\u5185\u5bb9\uff0crender \u7684\u542b\u4e49\u548c releaseOutputBuffer \u4e2d\u7684\u542b\u4e49\u4e00\u81f4\u3002</p> <p>\u53e6\u5916 releaseOutputBuffer \u65b9\u6cd5\u7b2c\u4e00\u4e2a\u53c2\u6570 index \u5176\u5b9e\u5c31\u5df2\u7ecf\u5728 buffer \u4e2d\u8d4b\u503c\u8fc7\u4e86\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u89e3\u7801\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u4e0a\u5c4f\u6e32\u67d3\u5c55\u793a\u5566\u3002</p> <pre><code> AVMediaCodecBuffer *buffer = (AVMediaCodecBuffer *) frame-&gt;data[3];\n av_mediacodec_release_buffer(buffer, 1);\n</code></pre> <p>\u5b8c\u6574\u4ee3\u7801\u5b9e\u8df5\u53ef\u4ee5\u5728\u516c\u4f17\u53f7 \u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636 \u56de\u590d 1019 \u83b7\u53d6\u3002</p> <p>\u7ecf\u8fc7\u6d4b\u8bd5\u9a8c\u8bc1\u786e\u5b9e\u53ef\u884c\uff0c\u4e0d\u8fc7\u76f4\u63a5\u4e0d\u65ad\u89e3\u7801\u4e0a\u5c4f\u7684\u901f\u5ea6\u662f\u5f88\u5feb\u7684\uff0c\u53ef\u4e0d\u6b62\u89c6\u9891\u64ad\u653e 30ms \u4e00\u5e27\u7684\u901f\u5ea6\u54e6\uff0c\u60f3\u8981\u6765\u505a\u64ad\u653e\u5668\u7684\u8bdd\uff0c\u8fd8\u5f97\u81ea\u5df1\u7ba1\u7406\u63a7\u5236\u4e00\u4e0b\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u5b8c\u6574\u4ee3\u7801\u6f14\u793a\u4e2d\u76f4\u63a5\u89e3\u7801\u5230\u4e86 SurfaceView \u7684 Surface \u4e0a\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u89e3\u7801\u5230 SurfaceTexture \u6784\u9020\u7684 Surface \u4e0a\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7528\u5230 SurfaceTexture \u7684 OnFrameAvailableListener \u56de\u8c03\u65b9\u6cd5\uff0c \u5e76\u4e14\u8fd8\u53ef\u4ee5\u7528 attachToGLContext \u65b9\u6cd5\u5173\u8054\u5230 OpenGL \u73af\u5883\u4e0a\uff0c\u6bcf\u6b21\u89e3\u7801\u65f6\u901a\u8fc7 updateTexImage \u66f4\u65b0\u753b\u9762\uff0c\u5b9e\u73b0\u89e3\u7801\u5230 OES \u7eb9\u7406\u7684\u76ee\u6807\uff0c\u5177\u4f53\u64cd\u4f5c\u8d77\u6765\u4e5f\u662f\u5f88\u5bb9\u6613\u65b9\u4fbf\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-convert-mpeg-to-pcm/","title":"FFmpeg 3.0 \u7248\u672c\u89c6\u9891\u89e3\u7801\u6d45\u6790","text":"<p>\u6709\u4e86\u4e0a\u4e00\u7bc7\u6587\u7ae0\u57fa\u7840\uff0c\u8fd9\u91cc\u5c31\u53ea\u5173\u6ce8 FFmpeg \u5982\u4f55\u89e3\u6790\u7684\u5177\u4f53\u5b9e\u8df5\u4e86\u3002 </p> <p>\u5728\u5f00\u59cb\u5de5\u7a0b\u4e4b\u524d\uff0c\u7b2c\u4e00\u6b65\u8981\u505a\u7684\u5c31\u662f\u7f16\u8bd1 FFmpeg \u6e90\u7801\uff0c\u751f\u6210 Android \u5e73\u53f0\u4e0a\u4f7f\u7528\u7684 so \u5e93\u3002</p> <p>\u5728\u751f\u6210\u5b8c\u4e86\u4e4b\u540e\uff0c\u5bfc\u5165 Android \u5de5\u7a0b\u9879\u76ee\u4e2d\uff0c\u5e76\u4e14\u914d\u7f6e CMake \u6587\u4ef6\uff0c\u6dfb\u52a0\u5bf9\u5e94\u7684\u5e93\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u5f00\u53d1\u4e86\u3002</p> <p>\u5982\u679c\u89c9\u5f97\u9ebb\u70e6\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f51\u4e0a\u627e\u4e00\u4e2a\u5de5\u7a0b\u4f7f\u7528\u73b0\u6210\u7684\u4e1c\u897f\uff0c\u4e5f\u53ef\u4ee5\u53c2\u8003\u7684\u6211\u7684\u5b66\u4e60\u9879\u76ee\uff1ahttps://github.com/glumes/FFMPEGLearn</p>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-convert-mpeg-to-pcm/#ffmpeg-30-20","title":"FFmpeg 3.0 \u4e0e 2.0 \u7684\u4e0d\u540c\u4e4b\u5904","text":"<p>\u5982\u679c\u662f\u521a\u5f00\u59cb\u5b66\u4e60\uff0c\u5b8c\u5168\u53ef\u4ee5\u53c2\u7167\u96f7\u795e\u7684\u535a\u5ba2\u6765\u5199\u4f8b\u5b50\uff0c\u800c\u4e14\u8fd8\u80fd\u8fd0\u884c\u6210\u529f\u3002\u4e0d\u8fc7\uff0c\u65e2\u7136 FFmpeg \u90fd\u51fa\u4e86 3.0 \u7248\u672c\u4e86\uff0c\u8fd8\u662f\u8981\u8ddf\u8fdb\u5b66\u4e60\u4e00\u4e0b\u3002</p> <p>FFmpeg 2.0 \u89e3\u7801\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a</p> <p></p> <p>\u800c FFmpeg 3.0 \u5c31\u5f00\u59cb\u6709\u70b9\u53d8\u5316\u4e86\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u5177\u4f53\u89e3\u6790\u64cd\u4f5c\u65f6\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u4e0d\u518d\u662f\u4e4b\u524d\u7684<code>avcodec_decode_video2</code>\u51fd\u6570\uff0c\u800c\u662f\u62c6\u5206\u6210\u4e86\u4e24\u4e2a\u51fd\u6570\uff0c<code>avcodec_send_packet</code>\u548c<code>avcodec_receive_frame</code>\u3002</p> <p><code>avcodec_send_packet</code>\u8d1f\u8d23\u53d1\u9001\u7f16\u7801\u538b\u7f29\u540e\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f Packet \u6570\u636e\uff0c\u800c<code>avcodec_receive_frame</code>\u8d1f\u8d23\u63a5\u6536\u89e3\u7801\u540e\u7684\u539f\u59cb\u6570\u636e\uff0c\u4e5f\u5c31\u662f Frame \u6570\u636e\uff0c\u8fd9\u4e48\u4e00\u6765\u4e00\u56de\u7684\u914d\u5408\uff0c\u6bcf\u6b21\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u4e00\u90e8\u5206\u5185\u5bb9\uff0c\u76f4\u5230\u5c06\u6574\u4e2a\u6587\u4ef6\u89e3\u7801\u5b8c\u6210\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-convert-mpeg-to-pcm/#_1","title":"\u89e3\u7801\u6d41\u7a0b\u4ee3\u7801","text":"<p>FFmpge \u7684\u89e3\u7801\u6d41\u7a0b\u5927\u90fd\u662f\u76f8\u540c\u7684\uff0c\u53ea\u662f\u5728\u7ec6\u8282\u5730\u65b9\u4f1a\u6709\u5dee\u5f02\uff0c\u4e3b\u4f53\u6d41\u7a0b\u8fd8\u662f\u6ca1\u53d8\uff0c\u770b\u4e86\u597d\u591a\u89e3\u7801\u7684\u4ee3\u7801\uff0c\u5927\u591a\u4e5f\u662f\u8fd9\u6837\u7684\uff0c\u53ea\u662f\u5728\u89e3\u7801\u6210\u5177\u4f53\u7684\u67d0\u4e9b\u683c\u5f0f\u65f6\uff0c\u5bf9\u539f\u59cb\u6570\u636e Frame \u7684\u64cd\u4f5c\u4f1a\u6709\u4e0d\u540c\u3002</p> <pre><code>// \u58f0\u660e\u4e00\u5806\u5f85\u4f1a\u8981\u7528\u5230\u7684\u53d8\u91cf\n    AVCodecContext *avCodecContext = nullptr;\n    AVCodec *avCodec = nullptr;\n    AVCodecParserContext *parserContext = nullptr;\n    AVPacket *packet;\n    AVFrame *frame;\n\n    // \u4e3a\u4e0a\u9762\u58f0\u660e\u7684\u53d8\u91cf\u5728\u8d4b\u503c\uff0c\u5e76\u4e14\u68c0\u67e5\u8d4b\u503c\u662f\u5426\u6210\u529f\n    avcodec_register_all()\n    // \u4e3a\u89e3\u7801\u5668\u8d4b\u503c\uff0c\u5e76\u5236\u5b9a\u89e3\u7801\u5668\u7c7b\u578b\n    avCodec = avcodec_find_decoder(AV_CODEC_ID_HEVC);\n    // \u4e3a AVCodecParserContext \u548c AVCodecContext \u8d4b\u503c\n    parserContext = av_parser_init(avCodec-&gt;id);\n    avCodecContext = avcodec_alloc_context3(avCodec);\n    // \u6253\u5f00\u89e3\u7801\u5668\n    avcodec_open2(avCodecContext, avCodec, nullptr);\n    // \u4e3a Packet \u548c Frame \u8d4b\u503c\n    frame = av_frame_alloc();\n    packet = av_packet_alloc();\n\n    while // \u5f00\u59cb\u4e00\u70b9\u70b9\u7684\u89e3\u7801\u6587\u4ef6\u5185\u5bb9\uff0c\u76f4\u5230\u6587\u4ef6\u672b\u5c3e\n        // \u89e3\u7801\u4ece while \u4e2d\u4e00\u6b21\u8bfb\u53d6\u5230\u7684\u5185\u5bb9\n        av_parser_parse2\n        // \u53d1\u9001\u8bfb\u53d6\u5230\u7684 packet\n        avcodec_send_packet\n        // \u63a5\u6536\u89e3\u6790\u5b8c\u7684 frame\n        avcodec_receive_frame\n        // \u5bf9\u539f\u751f\u6570\u636e\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\uff0c\u89e3\u7801\u6210\u4e0d\u540c\u6570\u636e\u683c\u5f0f\uff0c\u64cd\u4f5c\u4e0d\u540c\u3002\n        // todo\n\n    //\u6700\u540e\uff0c\u91ca\u653e\u4e0a\u9762\u58f0\u660e\u7684\u53d8\u91cf\n    av_frame_free\n    av_packet_free\n    avcodec_free_context\n    av_parser_close\n</code></pre>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-convert-mpeg-to-pcm/#mpeg-pcm","title":"MPEG-&gt;PCM \u7684\u89e3\u7801","text":"<p>\u5728\u4e86\u89e3\u89c6\u9891\u6587\u4ef6\u7684\u76f8\u5173\u57fa\u7840\u4ee5\u53ca FFmpeg \u89e3\u7801\u7684\u5927\u81f4\u6d41\u7a0b\u540e\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u8fdb\u884c MPEG-&gt;PCM\u7684\u89e3\u7801\u5de5\u4f5c\u4e86\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5728\u8fd9\u91cc\u8fd8\u662f\u5c11\u4e86\u4e24\u4e2a\u91cd\u8981\u7684\u6982\u5ff5\uff1a</p> <ol> <li>FFmpeg \u5404\u79cd\u7c7b\u4ee5\u53ca\u53d8\u91cf\u7684\u542b\u4e49\u3002</li> <li>\u5404\u79cd\u97f3\u89c6\u9891\u6587\u4ef6\u7684\u683c\u5f0f\u534f\u8bae\u3002</li> </ol> <p>\u524d\u534a\u90e8\u5206\u8fd8\u597d\uff0c\u5bf9\u7740\u96f7\u795e\u7684\u535a\u5ba2\u4e00\u70b9\u70b9\u7684\u770b\uff0c\u8fd8\u662f\u80fd\u770b\u61c2\u7684\u3002\u81f3\u4e8e\u5404\u79cd\u97f3\u89c6\u9891\u6587\u4ef6\u7684\u534f\u8bae\uff0c\u90a3\u5c31\u8981\u9760\u6162\u6162\u79ef\u7d2f\u4e86\u3002</p> <p>\u8fd9\u91cc\u5c31\u4e0d\u8d34\u4e0a\u5168\u90e8\u7684\u4ee3\u7801\u4e86\uff0c\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u4e24\u4e2a\u5730\u65b9\uff1a</p> <ol> <li>http://ffmpeg.org/doxygen/trunk/decode_video_8c-example.html</li> <li>https://github.com/glumes/FFMPEGLearn/blob/master/FFmpegLib/src/main/cpp/ffmpeg_examples/decode_video.cpp</li> </ol>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-convert-mpeg-to-pcm/#_2","title":"\u53c2\u8003","text":"<ol> <li>http://www.jianshu.com/p/7e96223ff329</li> <li>http://blog.csdn.net/leixiaohua1020/article/details/42181271</li> </ol>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-decode-drop-frame/","title":"\u767e\u500d\u53d8\u901f--\u89e3\u7801\u5230\u5e95\u80fd\u4e0d\u80fd\u4e22 \u975e\u53c2\u8003\u5e27 \uff1fFFmpeg \u6709\u8bdd\u8bf4\uff01\uff01\uff01","text":"<p>\u6628\u5929\u5468\u516d\uff0c\u7fa4\u91cc\u9762\u8fd8\u6709\u4eba\u5728\u6280\u672f\u4ea4\u6d41\uff01\uff01\u3002</p> <p>\u9ed8\u9ed8\u5410\u69fd\u4e00\u4e0b\uff1a\u8fd9\u4e9b\u4eba\u771f\u5377\u554a\uff0c\u5927\u5468\u672b\u8fd8\u641e\u6280\u672f\uff0c\u662f\u6e38\u620f\u4e0d\u597d\u73a9\u8fd8\u662f\u7535\u5f71\u4e0d\u597d\u770b\u3002</p> <p></p> <p>\u4e00\u5f00\u59cb\u662f\u8ba8\u8bba\u526a\u6620\u7684 100 \u53d8\u901f\u662f\u5982\u4f55\u5b9e\u73b0\uff0c\u7fa4\u4e3b\u4f5c\u4e3a\u76f8\u5173\u4eba\u58eb\u80af\u5b9a\u5c31\u4e0d\u65b9\u4fbf\u900f\u9732\u8fd9\u4e9b\u4e86\uff0c\u4e0d\u8fc7\u4e5f\u6709\u5176\u4ed6\u5927\u4f6c\u7ed9\u51fa\u4e86\u601d\u8def\u3002</p> <p>\u8ba8\u8bba\u7126\u70b9\u8fd8\u662f\u56f4\u7ed5\u5982\u4f55**\u4e22\u5e27**\u5c55\u5f00\u7684\u3002</p> <p>\u767e\u500d\u53d8\u901f\uff0c\u6bd4\u5982\u6b63\u5e38\u901f\u5ea6\u4e0b\u4e00\u5e27\u662f\u64ad\u653e\u7b2c 1s \u65f6\u523b\u7684\u5185\u5bb9\uff0c\u800c\u53d8\u901f\u540e\u8981\u64ad\u653e 100s \u65f6\u523b\u4e86\u3002</p> <p>\u6b64\u65f6\u7684\u903b\u8f91\u6709\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ol> <li>\u5982\u679c\u4e0b\u4e00\u4e2a\u64ad\u653e\u65f6\u523b\u8981\u8d85\u8fc7\u76ee\u524d GOP \u5927\u5c0f\u4e86\uff0c\u90a3\u4e48\u5c31\u53ca\u65f6 seek \u5230\u79bb\u76ee\u6807 pts \u6700\u8fd1\u7684\u5173\u952e\u5e27\uff0c\u6bd4\u5982\u4ece 1s \u53d8\u901f\u540e\u5230\u4e86 100s \uff0c\u90a3\u5c31 seek \u5230\u7b2c 98s \u3002</li> <li>\u5982\u679c\u4e0b\u4e00\u4e2a\u64ad\u653e\u65f6\u523b\u5728\u540c\u4e00 GOP \u5185\u4e86\uff0c\u90a3\u5c31\u7ee7\u7eed\u5f80\u4e0b\u89e3\u7801\uff0c\u5224\u65ad\u89e3\u7801\u540e\u7684\u5e27 pts \u4e0d\u9700\u8981\u663e\u793a\u5c31\u76f4\u63a5\u4e22\u5f03\u518d\u63a5\u7740\u5f80\u540e\u89e3 \uff0c\u76f4\u5230\u63a5\u8fd1\u4e86\u76ee\u6807\u65f6\u95f4\u70b9\u5c31\u663e\u793a\u3002</li> <li>seek \u540e\u7684\u65f6\u95f4\u70b9\u6ca1\u8fbe\u5230\u76ee\u6807\u65f6\u95f4\u70b9\u7684\u60c5\u51b5\uff0c\u9700\u8981\u7ee7\u7eed\u89e3\u7801\u7684\u53ef\u4ee5\u91cd\u590d\u7b2c\u4e8c\u6b65\u3002</li> </ol> <p>\u4ee5\u4e0a\u662f\u9488\u5bf9\u7fa4\u5185\u5927\u4f6c\u7684\u603b\u7ed3\uff0c\u62ff\u7740\u5c0f\u672c\u672c\u8d76\u7d27\u8bb0\u4e0b\u6765\u3002</p> <p>\u6b64\u65f6\uff0c\u8fd8\u6709\u5927\u4f6c\u5bf9\u89e3\u7801\u4e22\u5e27\u7ed9\u51fa\u4e86\u5176\u4ed6\u610f\u89c1\uff1a</p> <p></p> <p>\u4e3b\u8981\u662f\u9488\u5bf9\u975e\u53c2\u8003\u5e27\u7684\u4e22\u5e27\u5904\u7406\uff0c\u4e5f\u662f\u6587\u7ae0\u7684\u91cd\u70b9\u5185\u5bb9\u3002</p> <p>\u5f53\u6211\u4eec\u901a\u8fc7 av_read_frame \u5f97\u5230\u4e00\u4e2a AVPacket \u4e4b\u540e\uff0c\u53ef\u4ee5\u5224\u65ad\u5b83\u7684 nal_ref_idc \u503c\u6765\u51b3\u5b9a\u662f\u5426\u8981\u4e22\u5f03\u3002</p> <p>\u5982\u679c\u4e3a 0 \uff0c\u8bf4\u660e\u5176\u4ed6\u5e27\u4e0d\u9700\u8981\u53c2\u8003\u8be5\u5e27\uff0c\u53ef\u4ee5\u76f4\u63a5\u4e22\u5f03\u4e0d\u53d1\u9001\u7ed9\u89e3\u7801\u5668\uff0c\u800c\u4e0d\u662f\u89e3\u7801\u540e\u518d\u4e22\u5e27\u3002</p> <p>\u5982\u679c\u4f60\u4e0d\u6e05\u695a nal_ref_idc \u662f\u4ec0\u4e48\u610f\u601d \uff1f \u90a3\u4e48\u53ef\u4ee5\u4e86\u89e3\u4e00\u4e0b H.264 \u7801\u6d41 NALU \u7684\u6982\u5ff5\u3002</p> <p>H.264 \u7801\u6d41\u4f20\u8f93\u65f6\u4ee5 NALU \u7684\u5f62\u5f0f\u8fdb\u884c\uff0cNALU \u4e3b\u8981\u7531\u4e00\u4e2a\u5b57\u8282\u7684 HAL Header \u548c RBSP \u4e24\u90e8\u5206\u7ec4\u6210\u3002</p> <p>HAL Header \u7684\u7ec4\u6210\u5f62\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>HAL Header \u7684\u8ba1\u7b97\u5982\u4e0b\uff1a</p> <pre><code>forbidden_zero_bit(1bit) + nal_ref_idc(2bit) + nal_unit_type(5bit)\n</code></pre> <p>nal_unit_type \u4e0d\u540c\u7684\u503c\u4ee3\u8868\u4e0d\u540c\u7c7b\u578b\u7684\u5e27\uff0c\u89e3\u6790 AVPacket \u5b8c\u5168\u53ef\u4ee5\u5f97\u5230\u5982\u4e0a\u7684\u4fe1\u606f\uff0c\u540e\u9762\u5728\u516c\u4f17\u53f7\u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636\u7ee7\u7eed\u66f4\u65b0\u6587\u7ae0\u8be6\u89e3\u5982\u4f55\u8ba1\u7b97\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u89e3\u7801\u65f6\u5b8c\u5168\u662f\u53ef\u4ee5\u4e22\u5f03\u8fd9\u4e9b\u975e\u53c2\u8003\u5e27\u7684\uff0c\u653e\u5fc3\u5927\u80c6\u5730\u64cd\u4f5c\u5427\u3002</p> <p></p> <p>\u800c\u4e14\u4e22\u975e\u53c2\u8003\u5e27\u7684\u64cd\u4f5c\u4e5f\u662f\u7ecf\u8fc7\u4e86\u4ea7\u54c1\u4ebf\u7ea7\u68c0\u6d4b\u7684\uff0c\u8fd9\u4e00\u70b9\u6211\u786e\u5b9e\u53ef\u4ee5\u4f5c\u8bc1\uff01\uff01\uff01</p>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-decode-drop-frame/#ffmpeg","title":"FFmpeg \u4e2d\u7684\u4e22\u5e27","text":"<p>\u4ee5\u4e0a\u7684\u4e22\u5e27\u903b\u8f91\u662f\u6839\u636e H.264 \u89c4\u8303\u6765\u7684\uff0c\u90a3\u4e48\u5728 FFmpeg \u7684\u6e90\u7801\u4e2d\u6709\u6ca1\u6709\u9488\u5bf9\u8fd9\u4e00\u903b\u8f91\u505a\u5904\u7406\u5462\uff1f </p> <p>\u90a3\u5fc5\u7136\u662f\u6709\u7684\u554a\uff01\uff01\uff01</p> <p>\u5982\u679c\u4ed4\u7ec6\u770b ffplay \u7684\u6e90\u7801\uff0c\u5728\u6e90\u7801\u4e2d\u6709\u5982\u4e0b\u7684\u8c03\u7528\u65b9\u5f0f\uff1a</p> <p><pre><code>/* this thread gets the stream from the disk or the network */\nstatic int read_thread(void *arg)\n{\n    // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n\u00a0 \u00a0 for (i = 0; i &lt; ic-&gt;nb_streams; i++) {\n\u00a0 \u00a0 \u00a0 \u00a0 AVStream *st = ic-&gt;streams[i];\n\u00a0 \u00a0 \u00a0 \u00a0 enum AVMediaType type = st-&gt;codecpar-&gt;codec_type;\n        // AVDISCARD_ALL  \u629b\u5f03\u6240\u6709\u7684\u5e27\n\u00a0 \u00a0 \u00a0 \u00a0 st-&gt;discard = AVDISCARD_ALL;\n\u00a0 \u00a0 \u00a0 \u00a0 if (type &gt;= 0 &amp;&amp; wanted_stream_spec[type] &amp;&amp; st_index[type] == -1)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if (avformat_match_stream_specifier(ic, st, wanted_stream_spec[type]) &gt; 0)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 st_index[type] = i;\n\u00a0 \u00a0 }\n\n    // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n\u00a0 \u00a0 if (!video_disable)\n\u00a0 \u00a0 \u00a0 \u00a0 st_index[AVMEDIA_TYPE_VIDEO] =\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 av_find_best_stream(ic, AVMEDIA_TYPE_VIDEO,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 st_index[AVMEDIA_TYPE_VIDEO], -1, NULL, 0);\n\u00a0 \u00a0 if (!audio_disable)\n\u00a0 \u00a0 \u00a0 \u00a0 st_index[AVMEDIA_TYPE_AUDIO] =\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 av_find_best_stream(ic, AVMEDIA_TYPE_AUDIO,\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 st_index[AVMEDIA_TYPE_AUDIO],\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 st_index[AVMEDIA_TYPE_VIDEO],\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 NULL, 0);\n\n\u00a0 \u00a0 /* open the streams */\n\u00a0 \u00a0 if (st_index[AVMEDIA_TYPE_AUDIO] &gt;= 0) {\n        // \u5f00\u542f\u89e3\u7801\u7ebf\u7a0b\n\u00a0 \u00a0 \u00a0 \u00a0 stream_component_open(is, st_index[AVMEDIA_TYPE_AUDIO]);\n\u00a0 \u00a0 }\n\u00a0 \u00a0 ret = -1;\n\u00a0 \u00a0 if (st_index[AVMEDIA_TYPE_VIDEO] &gt;= 0) {\n       // \u5f00\u542f\u89e3\u7801\u7ebf\u7a0b\n\u00a0 \u00a0 \u00a0 \u00a0 ret = stream_component_open(is, st_index[AVMEDIA_TYPE_VIDEO]);\n\u00a0 \u00a0 }\n    // \u7701\u7565\u4ee3\u7801\n}\n</code></pre> read_thread \u65b9\u6cd5\u8fd0\u884c\u5728\u5355\u72ec\u7ebf\u7a0b\u4e0a\uff0c\u8be5\u65b9\u6cd5\u9996\u5148\u8fdb\u884c\u89e3\u5c01\u88c5\u64cd\u4f5c\uff0c\u7136\u540e\u5f00\u542f\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u89e3\u7801\uff0c\u63a5\u4e0b\u6765\u8c03\u7528 av_read_frame \u65b9\u6cd5\u8bfb\u53d6 AVPacket \u653e\u5230\u961f\u5217\u4e2d\u4f9b\u89e3\u7801\u7ebf\u7a0b\u4f7f\u7528\u3002</p> <p>\u5728 av_find_best_stream \u65b9\u6cd5\u4e4b\u524d\u5148\u5c06 discard \u7f6e\u4e3a AVDISCARD_ALL \uff0c\u8fc7\u6ee4\u6389 AVStream \u4e2d\u7684\u6570\u636e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f stream_component_open \u64cd\u4f5c\u3002</p> <p><pre><code>/* open a given stream. Return 0 if OK */\nstatic int stream_component_open(VideoState *is, int stream_index)\n{\n    // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n    // AVDISCARD_DEFAULT \u9ed8\u8ba4\u6a21\u5f0f\uff0c\u8fc7\u6ee4\u65e0\u6548\u6570\u636e\n\u00a0 \u00a0 ic-&gt;streams[stream_index]-&gt;discard = AVDISCARD_DEFAULT;\n\u00a0 \u00a0 switch (avctx-&gt;codec_type) {\n\u00a0 \u00a0 case AVMEDIA_TYPE_AUDIO:\n     // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n\u00a0 \u00a0 \u00a0 \u00a0 if ((ret = decoder_start(&amp;is-&gt;auddec, audio_thread, \"audio_decoder\", is)) &lt; 0)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 goto out;\n    // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n    case AVMEDIA_TYPE_VIDEO:\n     // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n\u00a0 \u00a0     if ((ret = decoder_start(&amp;is-&gt;viddec, video_thread, \"video_decoder\", is)) &lt; 0)\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 goto out;\n    // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n}\n</code></pre> stream_component_open \u65b9\u6cd5\u53c8\u5c06 discard \u7f6e\u4e3a\u4e86 AVDISCARD_DEFAULT \uff0c\u4ec5\u8fc7\u6ee4\u6389\u65e0\u6548\u6570\u636e\u3002</p> <p>\u7ee7\u7eed\u8ddf\u8fdb\u8fd9\u4e2a discard \u5b57\u6bb5\uff0c\u5c31\u4f1a\u6709\u65b0\u53d1\u73b0\u4e86\uff01</p> <p>\u5173\u4e8e discard \u7684\u6240\u6709\u7c7b\u578b\u503c\u548c\u4f7f\u7528\u65b9\u5f0f\uff0cFFmpeg \u4e2d\u6709\u5982\u4e0b\u5b9a\u4e49\uff1a</p> <pre><code>/**\n\u00a0* @ingroup lavc_decoding\n\u00a0*/\nenum AVDiscard{\n\u00a0 \u00a0 /* We leave some space between them for extensions (drop some\n\u00a0 \u00a0 \u00a0* keyframes for intra-only or drop just some bidir frames). */\n     // \u4e0d\u629b\u5f03\uff0c\u4e0d\u653e\u5f03\u4efb\u4f55\u6570\u636e\n\u00a0 \u00a0 AVDISCARD_NONE \u00a0 \u00a0=-16, ///&lt; discard nothing\n    //  \u4e22\u6389\u65e0\u7528\u7684\u6570\u636e\uff0c\u6bd4\u5982 size \u4e3a 0 \u8fd9\u79cd\n\u00a0 \u00a0 AVDISCARD_DEFAULT = \u00a00, ///&lt; discard useless packets like 0 size packets in avi\n    // \u4e22\u6389\u6240\u6709\u7684\u975e\u53c2\u8003\u5e27\n\u00a0 \u00a0 AVDISCARD_NONREF \u00a0= \u00a08, ///&lt; discard all non reference\n    // \u4e22\u6389\u6240\u6709\u7684\u53cc\u5411\u5e27\n\u00a0 \u00a0 AVDISCARD_BIDIR \u00a0 = 16, ///&lt; discard all bidirectional frames\n    // \u4e22\u6389\u6240\u6709\u7684\u975e\u5185\u5e27\n\u00a0 \u00a0 AVDISCARD_NONINTRA= 24, ///&lt; discard all non intra frames\n    // \u4e22\u6389\u6240\u6709\u7684\u975e\u5173\u952e\u5e27\n\u00a0 \u00a0 AVDISCARD_NONKEY \u00a0= 32, ///&lt; discard all frames except keyframes\n    // \u4e22\u6389\u6240\u6709\u5e27\n\u00a0 \u00a0 AVDISCARD_ALL \u00a0 \u00a0 = 48, ///&lt; discard all\n};\n</code></pre> <p>\u6240\u4ee5\uff0c\u5b8c\u5168\u53ef\u4ee5\u4f7f\u7528 discard \u5b57\u6bb5\u6765\u6807\u8bc6\u89e3\u7801\u65f6\u4e22\u5f03\u54ea\u4e9b\u5e27\u3002</p> <p>\u53e6\u5916\uff0c\u5728 avcodec_send_packet \u65b9\u6cd5\u6e90\u7801\u6ce8\u91ca\u4e2d\u4e5f\u63d0\u793a\u4e86\u53ef\u4ee5\u901a\u8fc7 AVCodecContext.skip_frame \u5b57\u6bb5\u6765\u51b3\u5b9a\u4e22\u5f03\u54ea\u4e9b\u5e27\u3002</p> <pre><code>/**\n\u00a0* Internally, this call will copy relevant AVCodecContext fields, which can\n\u00a0* influence decoding per-packet, and apply them when the packet is actually\n\u00a0* decoded. (For example AVCodecContext.skip_frame, which might direct the\n\u00a0* decoder to drop the frame contained by the packet sent with this function.)\n *  \u7701\u7565\u90e8\u5206\u6ce8\u91ca\n */\nint avcodec_send_packet(AVCodecContext *avctx, const AVPacket *avpkt);\n</code></pre> <p>\u6458\u5f55\u4e86\u90e8\u5206\u6ce8\u91ca\u5185\u5bb9\uff0c\u5199\u7684\u5c31\u5f88\u6e05\u695a\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u89e3\u7801\u65f6\u4e5f\u53ef\u4ee5\u4e0d\u7528\u81ea\u5df1\u89e3\u6790 AVPacket \u7684 nal_ref_idc \u5b57\u6bb5\u503c\uff0c\u76f4\u63a5\u901a\u8fc7 AVCodecContext.skip_frame \u5b9e\u73b0\u540c\u6837\u7684\u76ee\u7684\u3002</p> <p>\u4eb2\u6d4b\u6709\u6548\uff0c\u8fc7\u6ee4\u975e\u5173\u952e\u5e27\u4e4b\u540e\uff0c\u89e3\u7801\u51fa\u6765\u7684\u5168\u662f\u5173\u952e\u5e27\u4e86\u3002</p> <p>\u4ee5\u4e0a\uff0c\u5c31\u662f\u5173\u4e8e\u4e22\u5e27\u7684\u4e00\u4e9b\u5206\u4eab\uff0c\u6280\u672f\u4ea4\u6d41\u63a2\u8ba8\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u4ea4\u6d41\uff01\uff01\uff01</p>","tags":["FFmpeg"]},{"location":"ffmpeg/ffmpeg-vulkan-support/","title":"Vulkan \u5728 FFmpeg \u4e2d\u7684\u652f\u6301","text":"<p>\u5468\u672b\u65f6\u5019\u770b\u5230\u4e00\u7bc7\u63a8\u9001\u8bf4 FFmpeg \u5347\u7ea7\u5230 5.0 \u7248\u672c\u4e86\u3002</p> <p>\u5176\u4e2d\u63d0\u5230 FFmpeg \u5f15\u5165\u4e86 Vulkan \u9a71\u52a8\u7684\u65b0\u6ee4\u955c\uff0c\u7528\u4e8e\u89c6\u9891\u6c34\u5e73\u3001\u5782\u76f4\u7ffb\u8f6c\u3002</p> <p>\u770b\u5230 FFmpeg \u5f15\u5165\u4e86 Vulkan \uff0c\u60f3\u7740\u8fd9\u662f\u8981\u6709\u4ec0\u4e48\u5927\u52a8\u4f5c\u554a\uff0c\u76f4\u63a5\u5229\u597d Vulkan \u561b\uff1f</p> <p>\u540e\u6765\u53c8\u4ed4\u7ec6\u770b\u4e86\u4e0b FFmpeg \u7684 Changelog \uff0c\u539f\u6765\u65e9\u5728 4.3 \u7248\u672c\u5c31\u5df2\u7ecf\u5f00\u59cb\u652f\u6301 Vulkan \u4e86\u3002</p> <p></p> <p></p> <p>\u90a3\u65f6\u5019\u5c31\u5df2\u7ecf\u6709\u6ee4\u955c\u652f\u6301\u4e86\uff0c\u6bd4\u5982 scale_vulkan\u3001chromaber_vulkan \u7b49\u3002</p> <p>\u800c\u4e14\u8fd8\u652f\u6301\u5728 Linux \u5e73\u53f0\u4e0a\u901a\u8fc7 Vulkan \u4f7f\u7528 AMD \u7684\u9ad8\u7ea7\u5a92\u4f53\u6846\u67b6\uff08AMF\uff09\u5e93\uff0c\u53ef\u4ee5\u7528 GPU \u6765\u8fdb\u884c H.264/HEVC \u7684\u7f16\u7801\u3002\uff08Windows \u5e73\u53f0\u7528\u7684\u662f DirectX \u63a5\u53e3\uff09</p> <p>\u8fd9\u91cc\u63d0\u4e00\u4e0b AMF \u6846\u67b6\uff0c\u5b9e\u9645\u4e0a\u6211\u4e5f\u662f\u7b2c\u4e00\u6b21\u63a5\u89e6\u8fd9\u4e2a\u3002</p> <p>AMF \u5168\u79f0\u662f Advanced Media Framework \uff0c\u7ffb\u8bd1\u4e3a\u9ad8\u7ea7\u5a92\u4f53\u6846\u67b6\u3002\u5b83\u662f AMD \u516c\u53f8\u51fa\u54c1\u7684\uff0c\u4e3a\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u5bf9 GPU \u7684\u8bbf\u95ee\u4ee5\u8fdb\u884c\u591a\u5a92\u4f53\u5904\u7406\uff0c\u901a\u8fc7 AMF \u53ef\u4ee5\u8fdb\u884c\u89c6\u9891\u7f16\u89e3\u7801\u3001\u8f6c\u7801\u3001\u8272\u5f69\u7a7a\u95f4\u8f6c\u6362\u7b49\u529f\u80fd\u3002</p> <p>\u7b80\u5355\u8bf4\u5c31\u662f\u63d0\u4f9b\u4e86\u5bf9\u81ea\u5bb6\u663e\u5361\u4ea7\u54c1\u80fd\u529b\u7684\u8c03\u7528\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u505a\u7f16\u89e3\u7801\u7684\u5de5\u4f5c\u3002\u65e2\u7136 AMD \u6709\u4e86\uff0c\u90a3\u4e48\u76f8\u4fe1 NVIDIA \u4e5f\u6709\u7c7b\u4f3c\u7684\u4ea7\u54c1\u3002</p> <p>\u7531\u6b64\u53ef\u89c1\u540e\u9762\u7684\u8d8b\u52bf\uff1a\u6e32\u67d3 API \u4e0d\u4ec5\u4ec5\u662f\u7528\u6765\u505a\u6e32\u67d3\uff0c\u8fd8\u662f\u53ef\u4ee5\u7528\u505a\u7f16\u89e3\u7801\u7684\uff0c\u6bd5\u7adf\u5b83\u662f\u53ef\u4ee5\u76f4\u63a5\u7528 GPU \u6253\u4ea4\u9053\u7684\u3002</p> <p>\u6240\u4ee5 FFmpeg 5.0 \u4e2d\u5f15\u5165\u4e86 Vulkan \u65b0\u6ee4\u955c\u5e94\u8be5\u4e5f\u4e0d\u662f\u4ec0\u4e48\u5927\u65b0\u95fb\u4e86\uff0c\u6bd5\u7adf\u5728 4.3 \u7248\u672c\u5c31\u5df2\u7ecf\u6709\u4e86\u652f\u6301\uff0c\u53ea\u662f\u591a\u4e86\u51e0\u4e2a\u6ee4\u955c\uff0c\u6309\u7167\u5f00\u53d1\u4eba\u5458\u7684\u8bdd\u6765\u8bf4\uff0c\u5c31\u662f\u591a\u4e86\u51e0\u4e2a shader \u561b\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u770b\u770b\u8fd9\u51e0\u4e2a\u65b0\u589e\u7684 \u7ffb\u8f6cshader \u6709\u4f55\u4e0d\u540c\u4e4b\u5904\uff1a</p> <p>\u5982\u679c\u4e0d\u4e86\u89e3 Vulkan \u6d41\u7a0b\u7684\u8bdd\uff0c\u5efa\u8bae\u770b\u770b Vulkan \u76f8\u5173\u7684\u6587\u7ae0\uff0c\u6bd5\u7adf\u8fd9\u91cc\u9762\u6982\u5ff5\u633a\u591a\u7684\uff0c\u4f46\u5f88\u591a\u6d41\u7a0b\u8fd8\u662f\u56fa\u5b9a\u7684\uff0c\u53ea\u8981\u6293\u5230\u91cd\u70b9\u5c31\u597d\u4e86\u3002</p> <p>\u5927\u6982\u7684\u6d41\u7a0b\uff1aVulkan \u4f5c\u4e3a FFmpeg \u4e2d\u7684\u4e00\u4e2a\u6ee4\u955c\uff0c\u90a3\u4e48\u5b83\u80af\u5b9a\u8981\u63a5\u6536\u4ee3\u8868\u89e3\u7801\u540e\u7684 AVFrame \u6570\u636e\uff0c\u901a\u8fc7\u5c06 AVFrame \u6570\u636e\u8f6c\u6362\u4e3a\u5b83\u6e32\u67d3\u94fe\u7ed3\u6784\u7684\u8f93\u5165\uff0c\u7ecf\u8fc7\u6e32\u67d3\u540e\uff0c\u5c06\u6e32\u67d3\u7ed3\u679c\u8f6c\u6362\u4e3a AVFrame \u6570\u636e\u5e76\u5f80\u4e0b\u8fdb\u884c\u4f20\u9012\u3002</p> <p>\u7406\u89e3\u4e0a\u9762\u7684\u6d41\u7a0b\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u53bb\u7406\u89e3 Vulkan \u7684\u6e32\u67d3\u94fe\u4e86\u3002</p> <p>\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>static int process_frames(AVFilterContext *avctx, AVFrame *outframe, AVFrame *inframe)\n{\n    // \u7701\u7565\u8d77\u59cb\u4ee3\u7801\n    // \u5f97\u5230\u8f93\u5165\u6570\u636e\n    AVVkFrame *in = (AVVkFrame *)inframe-&gt;data[0];\n    AVVkFrame *out = (AVVkFrame *)outframe-&gt;data[0];\n    const int planes = av_pix_fmt_count_planes(s-&gt;vkctx.output_format);\n    const VkFormat *input_formats = av_vkfmt_from_pixfmt(s-&gt;vkctx.input_format);\n    const VkFormat *output_formats = av_vkfmt_from_pixfmt(s-&gt;vkctx.output_format);\n\n    ff_vk_start_exec_recording(vkctx, s-&gt;exec);\n    cmd_buf = ff_vk_get_exec_buf(s-&gt;exec);\n\n    for (int i = 0; i &lt; planes; i++) {\n        // \u5c06\u8f93\u5165\u6570\u636e\u7ed1\u5b9a\u5230 ImageView \u4e0a\n        RET(ff_vk_create_imageview(vkctx, s-&gt;exec,\n                                   &amp;s-&gt;input_images[i].imageView, in-&gt;img[i],\n                                   input_formats[i],\n                                   ff_comp_identity_map));\n\n        RET(ff_vk_create_imageview(vkctx, s-&gt;exec,\n                                   &amp;s-&gt;output_images[i].imageView, out-&gt;img[i],\n                                   output_formats[i],\n                                   ff_comp_identity_map));\n\n        s-&gt;input_images[i].imageLayout  = VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL;\n        s-&gt;output_images[i].imageLayout = VK_IMAGE_LAYOUT_GENERAL;\n    }\n    // \u7ed1\u5b9a\u8d44\u6e90\u63cf\u8ff0\u7b26\n    ff_vk_update_descriptor_set(vkctx, s-&gt;pl, 0);\n    // \u8bbe\u7f6e\u597d\u5185\u5b58\u5c4f\u969c\n    for (int i = 0; i &lt; planes; i++) {\n        // \u7701\u7565\u4e00\u5927\u4e32\u4ee3\u7801\n        vk-&gt;CmdPipelineBarrier(cmd_buf, VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT,\n                               VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT, 0,\n                               0, NULL, 0, NULL, FF_ARRAY_ELEMS(barriers), barriers);\n        // \u7701\u7565\u4e00\u5927\u4e32\u4ee3\u7801\n    }\n    // \u8bbe\u7f6e\u597d pipeline \u548c \u8d44\u6e90\u63cf\u8ff0\u7b26\u96c6 descriptorSet\n    ff_vk_bind_pipeline_exec(vkctx, s-&gt;exec, s-&gt;pl);\n    vk-&gt;CmdDispatch(cmd_buf, FFALIGN(s-&gt;vkctx.output_width, CGS)/CGS,\n                    s-&gt;vkctx.output_height, 1);\n\n    ff_vk_add_exec_dep(vkctx, s-&gt;exec, inframe, VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT);\n    ff_vk_add_exec_dep(vkctx, s-&gt;exec, outframe, VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT);\n    // \u63d0\u4ea4\u5230\u961f\u5217\n    err = ff_vk_submit_exec_queue(vkctx, s-&gt;exec);\n    if (err)\n        return err;\n    ff_vk_qf_rotate(&amp;s-&gt;qf);\n    return 0;\n}\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\u8981\u662f\u770b\u7684\u8d39\u52b2\u7684\u8bdd\uff0c\u8fd8\u662f\u53ea\u770b\u6838\u5fc3\u7684 shader \u90e8\u5206\u5427\uff1a</p> <p> </p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u505a\u6c34\u5e73\u6216\u8005\u5782\u76f4\u7ffb\u8f6c\u4e5f\u53ea\u662f\u66f4\u6539\u4e86 texture \u91c7\u6837\u5750\u6807\u800c\u5df2\uff0c\u5982\u679c\u4f60\u4f1a OpenGL \u7684\u8bdd\uff0c\u4e00\u6837\u53ef\u4ee5\u505a\u51fa\u7c7b\u4f3c\u7684 filter \u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/get-video-thumbnail/","title":"\u5e72\u8d27 | \u5feb\u901f\u62bd\u53d6\u7f29\u7565\u56fe\u662f\u600e\u4e48\u7ec3\u6210\u7684\uff1f","text":"<p>\u4eca\u5929\u7ee7\u7eed\u7ed9\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u77e5\u8bc6\u661f\u7403\u91cc\u9762\u7684\u5e72\u8d27\u3002</p> <p>\u521b\u5efa\u77e5\u8bc6\u661f\u7403\u81f3\u4eca\uff0c\u5df2\u7ecf\u79ef\u7d2f\u4e86\u4e0d\u5c11\u5e72\u8d27\uff0c\u4e3b\u8981\u5f97\u76ca\u4e8e\u661f\u7403\u91cc\u5927\u4f6c\u4eec\u7684\u5206\u4eab\u4ee5\u53ca\u5c0f\u4f19\u4f34\u7684\u63d0\u95ee\u3002</p> <p>\u661f\u7403\u91cc\u9762\u9080\u8bf7\u7684\u5927\u4f6c\u90fd\u662f\u5728\u5934\u6761\u3001\u5feb\u624b\u7b49\u77e5\u540d IT \u4f01\u4e1a\u4ece\u4e8b\u8fc7\u97f3\u89c6\u9891\u5f00\u53d1\u7684\uff0c\u5728\u4e13\u4e1a\u5ea6\u8fd9\u5757\u90a3\u662f\u76f8\u5f53\u6ca1\u95ee\u9898\uff0c\u800c\u4e14\u603b\u7ed3\u7684\u77e5\u8bc6\u4e5f\u975e\u5e38\u786c\u6838\u3002</p> <p>\u540c\u65f6\u5f97\u76ca\u4e8e\u5927\u5bb6\u7684\u5e7f\u6cdb\u63d0\u95ee\uff0c\u542f\u53d1\u7075\u611f\u6269\u5c55\u601d\u8def\uff0c\u628a\u65e5\u5e38\u5f00\u53d1\u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u90fd\u4e00\u5c42\u4e00\u5c42\u5265\u5f00\uff0c\u7531\u6d45\u5165\u6df1\uff0c\u6df1\u7a76\u5176\u80cc\u540e\u7684\u539f\u7406\u3002</p> <p>\u76ee\u524d\u77e5\u8bc6\u661f\u7403\u8fd8\u5728\u8ba9\u5229\u4e2d\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u767d\u83dc\u4ef7\u5373\u53ef\u52a0\u5165\uff0c\u6b22\u8fce\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60\u3002</p> <p>\u5728\u77e5\u8bc6\u661f\u7403\u91cc\u9762\u6709\u4e00\u4e2a\u540c\u5b66\u54a8\u8be2\u526a\u6620\u91cc\u9762\u7684\u7f29\u7565\u56fe\u662f\u5982\u4f55\u5feb\u901f\u62bd\u53d6\u7684\uff0c\u5173\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u7b14\u8005\u5e0c\u671b\u5206\u4eab\u4e0b\u5bf9\u8fd9\u4e2a\u95ee\u9898\u7684\u4e00\u4e9b\u7406\u89e3\u548c\u5206\u6790\u601d\u8def\uff0c\u540c\u65f6\u4e5f\u662f\u629b\u7816\u5f15\u7389\uff0c\u5982\u679c\u5404\u4f4d\u770b\u5b98\u6709\u5176\u4ed6\u7406\u89e3\u548c\u4e00\u4e9b\u81ea\u5df1\u7684\u770b\u6cd5\uff0c\u6b22\u8fce\u4ea4\u6d41\u3002</p> <p>\u4ee5\u4e0b\u662f\u661f\u7403\u5185\u7684\u63d0\u95ee\uff1a</p> <p>\u8fd8\u60f3\u63d0\u4e2a\u95ee\u9898\uff0c\u6211\u89c2\u5bdf\u526a\u6620app\uff0c\u89c6\u9891\u7f16\u8f91\uff0c\u5373\u4f7f\u662f\u4e00\u4e2a\u957f\u89c6\u9891\uff0c\u7f29\u7565\u56fe\u51fa\u6765\u7b80\u76f4\u662f\u6beb\u79d2\u7684\uff0c\u8fd9\u4e2a\u4e0d\u77e5\u9053\u662f\u4ece\u54ea\u65b9\u9762\u8fdb\u884c\u4e86\u4f18\u5316\u5462\uff0c\u6b63\u5e38\u89e3\u7801\u4e0d\u53ef\u80fd\u8fd9\u4e48\u5feb\u3002</p> <p>\u4ee5\u4e0b\u662f\u5206\u4eab\u539f\u6587\uff0c\u4f1a\u5e26\u4e0a\u6c34\u5370\uff0c\u4e3b\u8981\u662f\u9632\u6b62\u88ab\u65e0\u803b\u6284\u88ad\u4e86\uff0c\u661f\u7403\u5185\u7684\u670b\u53cb\u53ef\u4ee5\u5728 App \u770b\u9ad8\u6e05\u65e0\u6c34\u5370\u7248\u3002</p> <p></p>","tags":["FFmpeg"]},{"location":"ffmpeg/graphics-resources-for-spring-festival/","title":"\u97f3\u89c6\u9891\u6625\u8282\u5047\u671f\u5185\u5377\u6307\u5357\uff08\u5b9e\u64cd\uff09","text":"<p>\u9a6c\u4e0a\u5c31\u8981\u8fc7\u5e74\u4e86\uff0c\u65e9\u5df2\u65e0\u5fc3\u6478\u9c7c\uff0c\u53ea\u60f3\u653e\u5047\uff01\uff01!</p> <p>\u7136\u800c\u60a0\u95f2\u7684\u4eba\u53ca\u65f6\u884c\u4e50\uff0c\u52aa\u529b\u7684\u4eba\u773c\u4e2d\u53ea\u6709\u5b66\u4e60\u3002</p> <p>\u4fd7\u8bdd\u8bf4\uff1a\u5047\u671f\u5c31\u662f\u6700\u597d\u7684\u5145\u7535\u65f6\u673a\u3002</p> <p>\u4e3a\u6b64\u7279\u5730\u627e\u4e86\u4e00\u4e9b\u597d\u7684\u8d44\u6e90\u4f9b\u5927\u5bb6\u6625\u8282\u5728\u5bb6\u5145\u7535\u3002</p> <p>\u8003\u8651\u5230\u5728\u5bb6\u73af\u5883\u96be\u4ee5\u9759\u4e0b\u5fc3\u6765\u8ba4\u771f\u601d\u8003\uff0c\u6240\u4ee5\u8fd9\u4e9b\u8d44\u6e90\u8fd8\u662f\u4ee5\u89c6\u9891\u4e3a\u4e3b\uff0c\u4ee3\u7801\u9879\u76ee\u4e3a\u8f85\u3002</p> <p>\u53e6\u5916\u8bf4\u662f\u97f3\u89c6\u9891\uff0c\u5176\u5b9e\u8fd8\u662f\u4ee5\u56fe\u5f62\u5b66\u6e32\u67d3\u65b9\u9762\u7684\u5185\u5bb9\u4e3a\u4e3b\u3002\u6bd5\u7adf\u90fd\u8fc7\u5e74\u4e86\uff0c\u6ca1\u8c01\u60f3\u5927\u8fc7\u5e74\u7684\u8fd8 debug \u97f3\u89c6\u9891\u95ee\u9898\u5427\u3002</p> <p>\u800c\u4e14\u97f3\u89c6\u9891\u5de5\u7a0b\u843d\u5730\u65b9\u9762\u7684\u7406\u8bba\u5185\u5bb9\u6bd4\u8f83\u5c11\uff0c\u66f4\u591a\u662f\u9879\u76ee\u5b9e\u8df5\uff0c\u800c\u7f16\u89e3\u7801\u3001\u89c6\u9891\u7b97\u6cd5\u8fd9\u4e9b\u53c8\u592a\u9ad8\u6df1\u4e86\uff0c\u95e8\u69db\u8fc7\u9ad8\u3002</p> <p>\u76f8\u6bd4\u8d77\u6765\u56fe\u5f62\u5b66\u5c31\u6709\u8da3\u591a\u4e86\uff0c\u7406\u8bba\u77e5\u8bc6\u65b9\u9762\u5c31\u76f8\u5f53\u4e30\u5bcc\uff0c\u5f88\u5bb9\u6613\u505a\u5230\u5373\u65f6\u81ea\u6211\u6fc0\u52b1\uff0c\u770b\u4e00\u70b9\u5c31\u5b66\u5230\u4e00\u70b9\u65b0\u4e1c\u897f\uff0c\u8d8a\u770b\u5c31\u8d8a\u5e26\u52b2\uff0c\u6839\u672c\u505c\u4e0d\u4e0b\u6765\u3002</p> <p>\u5047\u671f\u5c31\u5e94\u8be5\u591a\u770b\u770b\u7406\u8bba\uff0c\u6269\u5c55\u81ea\u5df1\u7684\u77e5\u8bc6\u9762\uff0c\u672a\u6765\u5143\u5b87\u5b99\u7684\u53d1\u5c55\uff0c\u80af\u5b9a\u4e5f\u5c11\u4e0d\u4e86\u6e32\u67d3\u65b9\u9762\u7684\u8d21\u732e\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/graphics-resources-for-spring-festival/#games","title":"\u9996\u5148\u5fc5\u63a8 GAMES \u7cfb\u5217\u89c6\u9891\u4e86\u3002","text":"<p>GAMES \u7cfb\u5217\u89c6\u9891\u540d\u6c14\u4e4b\u5927\uff0c\u6211\u60f3\u90fd\u4e0d\u7528\u8fc7\u591a\u4ecb\u7ecd\uff0c\u641e\u6e32\u67d3\u7684\u57fa\u672c\u90fd\u770b\u8fc7\u4ed6\u4eec\u7684\u89c6\u9891\u6216\u8005\u77e5\u9053\u89c6\u9891\u7684\u4e3b\u8bb2\u4eba\u5427\u3002</p> <p>\u5728 B \u7ad9\u4e0a\u7684\u89c6\u9891\u5730\u5740\u5982\u4e0b\uff1a</p> <p>GAMES 101 \u7cfb\u5217\uff1a\u73b0\u4ee3\u8ba1\u7b97\u673a\u56fe\u5f62\u5b66\u5165\u95e8</p> <p>https://www.bilibili.com/video/BV1X7411F744</p> <p>GAMES 202 \u7cfb\u5217\uff1a\u9ad8\u8d28\u91cf\u5b9e\u65f6\u6e32\u67d3</p> <p>https://www.bilibili.com/video/BV1YK4y1T7yY</p> <p>\u8fd9\u4e24\u95e8\u8bfe\u90fd\u662f \u95eb\u4ee4\u742a \u5927\u4f6c\u4e3b\u8bb2\u7684\u3002\u4e3b\u8981\u8bb2\u4e86\u8ba1\u7b97\u673a\u56fe\u5f62\u6e32\u67d3\u7684\u7406\u8bba\uff0c\u8fd8\u6709\u5149\u7ebf\u8ffd\u8e2a\u548c PBR \u7269\u7406\u6e32\u67d3\u7b49\u90e8\u5206\uff0c\u53ef\u4ee5\u8bf4\u662f\u76f8\u5f53\u8010\u5fc3\uff0c\u628a\u4e00\u4e9b\u7406\u8bba\u77e5\u8bc6\u90fd\u8bb2\u900f\u4e86\u3002</p> <p>\u770b\u4e00\u904d\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u6709\u65f6\u95f4\u5c31\u8981\u591a\u770b\u51e0\u904d\u624d\u884c\u3002</p> <p>\u53e6\u5916\uff0c\u5bf9 PBR \u7269\u7406\u6e32\u67d3\u611f\u5174\u8da3\u7684\uff0c\u5173\u6ce8\u8fd9\u4f4d\u5927\u4f6c\u7684 github \u4e3b\u9875\uff0c\u6709\u7cbe\u5f69\u5728\u7b49\u4f60\u3002</p> <p>https://github.com/mmp</p> <p>\u6216\u8005\u8bbf\u95ee\u4ed6\u5199\u7684\u4e66 \u300aPhysically Based Rendering\u300b\u7f51\u7ad9\u4e3b\u9875\uff1a</p> <p>https://pbrt.org/</p> <p>\u5bf9\u5149\u8ffd\u611f\u5174\u8da3\u7684\uff0c\u53ef\u4ee5\u8bbf\u95ee\u6cb9\u7ba1\u4e0a\u8fd9\u4f4d\u5927\u4f6c\u5f55\u7684\u89c6\u9891\u8bfe\uff1a</p> <p>https://www.youtube.com/playlist?list=PLGmrMu-IwbgtMxMiV3x4IrHPlPmg7FD-P</p> <p>\u4e3b\u8bb2\u4e86 Ray Marching \u7684\u65b9\u5f0f\u505a\u5149\u8ffd\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728 ShaderToy \u4e0a\u8fd0\u884c\u8d77\u6765\u7684\u3002\u5728 B \u7ad9\u4e5f\u6709\u4eba\u642c\u8fd0\u4e86\u4ed6\u7684\u89c6\u9891\uff0c\u53ef\u4ee5\u53bb\u641c\u4e00\u4e0b\u3002</p> <p>\u4e0d\u61c2\u4ec0\u4e48\u662f ShaderToy \uff1f \u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7 \u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636 \uff0c\u5728\u91cc\u9762\u641c\u7d22\u4e00\u4e0b\u5c31\u660e\u767d\u5566\u3002\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/graphics-resources-for-spring-festival/#ue4","title":"\u5176\u6b21\u662f \u865a\u5e7b\u5f15\u64ce UE4 \u7684\u89c6\u9891\u6559\u7a0b\u3002","text":"<p>\u4e3a\u5565\u8981\u63d0\u865a\u5e7b\u5f15\u64ce UE4 \u5462\uff1f \u6700\u8fd1 QQ \u7684\u65b0\u7248\u5b89\u88c5\u5305\u4f53\u79ef\u66b4\u589e\uff0ciOS \u4e0a\u7684\u5b89\u88c5\u5305\u63a5\u8fd1\u4e00\u4e2a G \u4e86\uff0c\u539f\u56e0\u5c31\u662f\u5185\u7f6e\u4e86\u865a\u5e7b\u5f15\u64ce\uff0c\u5b9e\u73b0\u8d85\u7ea7 QQ \u79c0\u3002</p> <p>\u800c\u8d85\u7ea7 QQ \u79c0\u53ef\u80fd\u5c31\u662f\u8fdb\u5165\u5143\u5b87\u5b99\u7684\u95e8\u7968\u554a\uff0c\u8fde\u8fd9\u6837\u7684\u56fd\u6c11\u7ea7 App \u90fd\u5f00\u59cb\u642d\u4e0a\u865a\u5e7b\u5f15\u64ce\u4e86\uff0c\u8fd9\u4e0d\u5f88\u660e\u663e\u5c31\u662f\u8d8b\u52bf\u561b\u3002</p> <p>\u4f5c\u4e3a\u7a0b\u5e8f\u5458\u5c31\u662f\u8981\u4fdd\u6301\u884c\u4e1a\u654f\u611f\u5ea6\uff0c\u63d0\u524d\u5e03\u5c40\uff0c\u4e0d\u7136\u5929\u5929\u770b\u90a3\u4e9b\u79d1\u6280\u884c\u4e1a\u65b0\u95fb\u5374\u6ca1\u6709\u4efb\u4f55\u884c\u52a8\uff0c\u4f1a\u9519\u8fc7\u591a\u5c11\u6d6a\u6f6e\u673a\u4f1a\uff0c\u5927\u6982\u610f\u601d\u5c31\u548c\u4f60\u7092\u80a1\u5dee\u4e0d\u591a\uff0c\u81ea\u884c\u9886\u609f\u3002</p> <p>\u865a\u5e7b\u5f15\u64ce\u7684\u89c6\u9891\u6559\u7a0b\u6ca1\u6709 Unity \u7684\u89c6\u9891\u90a3\u6837\u591a\uff0c\u53ef\u80fd\u662f\u57f9\u8bad\u73ed\u8fd8\u6ca1\u6709\u628a\u91cd\u5fc3\u8f6c\u5230 UE4 \u6765\u5427\u3002</p> <p>\u4e0d\u8fc7 B \u7ad9\u4e0a\u8fd8\u662f\u6709\u597d\u89c6\u9891\u7684\uff0c\u6bd5\u7adf\u662f\u4e2a\u5b66\u4e60\u7f51\u7ad9\u561b\uff0c\u6bd4\u8f83\u63a8\u8350 \u8c0c\u5609\u8bda \u5927\u4f6c\u5f55\u5236\u7684\u7cfb\u5217\u89c6\u9891\u3002</p> <p>https://space.bilibili.com/31898841/channel/seriesdetail?sid=1880126</p> <p>\u4e3b\u8bb2\u4e86\u600e\u4e48\u4f7f\u7528\u865a\u5e7b\u5f15\u64ce\uff0c\u5305\u62ec\u5b83\u7684\u5404\u79cd\u529f\u80fd\u70b9\u4ee5\u53ca\u7b80\u5355\u9879\u76ee\u5b9e\u8df5\u3002</p> <p>\u4e0d\u6d89\u53ca\u5f88\u590d\u6742\u7684\u4ee3\u7801\u7f16\u5199\uff0c\u5f88\u591a\u529f\u80fd\u901a\u8fc7\u865a\u5e7b\u5f15\u64ce\u7684\u4e00\u4e9b\u914d\u7f6e\u9009\u9879\u5c31\u53ef\u4ee5\u5b8c\u6210\uff0c\u800c\u770b\u89c6\u9891\u7684\u4f5c\u7528\u5c31\u662f\u8ba9\u4f60\u77e5\u9053\u6709\u8fd9\u4e9b\u4e1c\u897f\u3002</p> <p>\u5e76\u4e14\uff0cUE4 \u63d0\u4f9b\u4e86\u84dd\u56fe\u529f\u80fd\uff0c\u901a\u8fc7\u84dd\u56fe\u8fde\u4e00\u4e9b\u70b9\u548c\u7ebf\u5c31\u80fd\u5b8c\u6210\u4e00\u4e9b\u5c0f\u529f\u80fd\uff0c\u592a\u9002\u5408\u5047\u671f\u641e\u4e00\u641e\u4e86\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/graphics-resources-for-spring-festival/#_1","title":"\u6700\u540e\u8fd8\u662f\u8981\u770b\u4e00\u70b9\u4ee3\u7801\u7684\u3002","text":"<p>\u4e0a\u9762\u7684\u7cfb\u5217\u89c6\u9891\u65f6\u957f\u52a0\u8d77\u6765\u90fd\u8981\u51e0\u5341\u4e2a\u5c0f\u65f6\u4e86\uff0c\u80fd\u628a\u4ed6\u4eec\u90fd\u770b\u5b8c\u4f30\u8ba1\u5c31\u70e7\u9ad8\u9999\u4e86\u3002</p> <p>\u4e0d\u8fc7\u6bd5\u7adf\u5047\u671f\u561b\uff0c\u6709\u7684\u662f\u65f6\u95f4\u6162\u6162\u770b\uff0c\u770b\u4e0d\u5b8c\u7559\u5728\u4e0a\u73ed\u540e\u7ee7\u7eed\u770b\u4e86\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u8fd8\u662f\u8981 \u89c6\u9891\u548c\u4ee3\u7801\u4e00\u8d77\u670d\u7528\uff0c\u6548\u679c\u4f1a\u66f4\u597d\u3002</p> <p>\u63a8\u8350\u4e24\u4e2a\u4ed3\u5e93\u5730\u5740\uff1a</p> <p>https://github.com/lettier/3d-game-shaders-for-beginners</p> <p>\u4e3b\u8bb2 Shader \u7684\uff0c\u6bd4\u8f83\u5168\u9762\u548c\u57fa\u7840\uff0c\u5176\u5b9e\u4e0d\u600e\u4e48\u9700\u8981\u4f60\u8fd0\u884c\uff0c\u4e3b\u8981\u8fd8\u662f\u7406\u89e3\u5176\u601d\u8def\u3002</p> <p>https://github.com/Rajawali/Rajawali</p> <p>\u5b89\u5353\u4e0a\u7684\u4e00\u4e2a OpenGL 2.0/3.0 \u5f15\u64ce\uff0c\u5c01\u88c5\u4e86\u5f88\u591a OpenGL \u529f\u80fd\uff0c\u503c\u5f97\u53c2\u8003\u4e00\u4e0b\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/graphics-resources-for-spring-festival/#_2","title":"\u6700\u540e\u7684\u6700\u540e\uff0c\u63a8\u8350\u4e2a\u81ea\u5df1\u7684\u89c6\u9891\u3002","text":"<p>\u5e7f\u544a\u65f6\u95f4\u53ef\u4e0d\u5f97\u7559\u7ed9\u81ea\u5df1\u5462\uff0c\u89c6\u9891\u6559\u7a0b\u6211\u4e5f\u662f\u5f55\u8fc7\u7684\u3002</p> <p>\u63a8\u8350\u6211\u5728\u6155\u8bfe\u7f51\u4e0a\u5f55\u5236\u7684\u514d\u8d39 NDK \u89c6\u9891\u6559\u7a0b\u3002</p> <p>http://www.imooc.com/learn/1212</p> <p>\u8fd9\u53ef\u662f\u5b89\u5353\u5f00\u53d1\u5e95\u5c42\u8fdb\u9636\u5fc5\u5907\u57fa\u7840\u554a\uff0c\u4e0d\u591a\u8bf4\uff0c\u61c2\u7684\u90fd\u61c2\uff01\uff01\uff01</p>","tags":["FFmpeg"]},{"location":"ffmpeg/how-to-compile-ffmpeg-library/","title":"\u8001\u751f\u5e38\u8c08-FFmpeg \u7684\u7f16\u8bd1\u95ee\u9898\u8f7b\u677e\u641e\u5b9a","text":"<p>\u524d\u51e0\u5929\u53d1\u4e86\u4e00\u7bc7 FFmpeg \u8c03\u7528 Android MediaCodec \u8fdb\u884c\u786c\u89e3\u7801 \u7684\u6587\u7ae0\uff0c\u8fd9\u91cc\u9762\u7684\u6280\u672f\u70b9\u4e0d\u7b97\u592a\u96be\uff0c\u4e5f\u8fd8\u662f\u8c03\u7528 FFmpeg \u7684\u5e38\u7528\u63a5\u53e3\u64cd\u4f5c\uff0c\u4f46\u91cd\u70b9\u5728\u4e8e FFmpeg \u7684\u7248\u672c\u9009\u62e9\u4ee5\u53ca\u7f16\u8bd1\u9009\u9879\u8981\u5f00\u542f MediaCodec \u624d\u884c\u3002</p> <p>\u5173\u4e8e FFmpeg \u7684\u7f16\u8bd1\uff0c\u662f\u4e2a\u8001\u751f\u5e38\u8c08\u7684\u8bdd\u9898\u4e86\uff0c\u5f88\u591a\u521d\u5b66\u8005\u90fd\u4f1a\u5361\u5728\u600e\u4e48\u7f16\u8bd1\u52a8\u6001\u5e93 so \u7684\u95ee\u9898\u4e0a\uff0c\u8fd9\u5176\u5b9e\u4e5f\u662f Android \u5f00\u53d1\u8f6c\u97f3\u89c6\u9891\u7684\u4e00\u5927\u62e6\u8def\u864e\uff0c\u4e00\u884c FFmpeg \u4ee3\u7801\u90fd\u6ca1\u6765\u5f97\u53ca\u5199\u5462\uff0c\u5c31\u5f97\u5148\u6298\u817e\u597d\u4e45\u7f16\u8bd1\u95ee\u9898\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u7f16\u8bd1\u9ebb\u70e6\u80af\u5b9a\u662f FFmpeg \u7684\u9505\u3002\u56e0\u4e3a\u5b83\u7684\u4e0d\u65ad\u5347\u7ea7\uff0c\u4ece\u65e9\u671f 2.x \u7248\u672c\u5230\u73b0\u5728\u7684 4.x \u7248\u672c\uff0c\u8c03\u7528\u63a5\u53e3\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u7f16\u8bd1\u9009\u9879\u4e5f\u8c03\u6574\u4e86\u4e0d\u5c11\uff0c\u4f46\u7f51\u4e0a\u7684\u5404\u79cd Android so \u52a8\u6001\u5e93\u7f16\u8bd1\u6587\u7ae0\u53ef\u6ca1\u6709\u5bf9\u5e94\u66f4\u65b0\u54e6\uff0c\u6709\u7684\u6559\u7a0b\u8fd8\u505c\u7559\u5728 2.x \u7248\u672c\u4e0a\uff0c\u5982\u679c\u4f60\u7167\u7740\u53bb\u7f16\u8bd1\u4e86\uff0c\u8fd9\u91cc\u9762\u80af\u5b9a\u4f1a\u6709\u517c\u5bb9\u6027\u95ee\u9898\u7684\u3002</p> <p>\u4e3e\u51e0\u4e2a\u4f8b\u5b50\uff1a</p> <ul> <li>FFmpeg \u6e90\u7801\u91cc\u9762\u7684\u6587\u4ef6\u8981\u4fee\u6539\u5417\uff1f</li> </ul> <p>\u65e9\u671f\u7684\u7f16\u8bd1\u7248\u672c\u8fd8\u8981\u5728 FFmpeg \u91cc\u9762\u4fee\u6539\u4e00\u4e9b\u6e90\u7801\u624d\u884c\uff0c\u6700\u5e38\u89c1\u7684\u5c31\u662f\u4e0b\u9762\u7684\u4ee3\u7801\uff1a</p> <pre><code>SLIBNAME_WITH_MAJOR='$(SLIBNAME).$(LIBMAJOR)'\nLIB_INSTALL_EXTRA_CMD='?(RANLIB)\"$(LIBDIR)/$(LIBNAME)\"'\nSLIB_INSTALL_NAME='$(SLIBNAME_WITH_VERSION)'\nSLIB_INSTALL_LINKS='$(SLIBNAME_WITH_MAJOR)$(SLIBNAME)'\n</code></pre> <p>\u4ee5\u524d\u9700\u8981\u4fee\u6539\u7f16\u8bd1\u540e\u5e93\u540d\u5b57\u7684\u8fde\u63a5\u65b9\u5f0f\uff0c\u4f46\u662f\u5728\u6700\u65b0\u7248\u672c\u4e2d\u662f\u4e0d\u7528\u4e86(\u6700\u65b0\u7248\u6307\u7684\u662f ffmpeg \u7684 release/4.4 \u5206\u652f\u7248\u672c)\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u5b9e\u9645\u7f16\u8bd1\u4e2d\u4e5f\u4e0d\u9700\u8981\u4fee\u6539\u4efb\u4f55 FFmpeg \u6e90\u7801\u7684\u3002</p> <ul> <li>Android NDK \u8981\u7528\u54ea\u4e2a\u7248\u672c\uff1f </li> </ul> <p>\u8fd9\u4e5f\u662f\u4e2a\u5e38\u89c1\u7684\u517c\u5bb9\u6027\u95ee\u9898\u3002</p> <p>\u9009\u62e9 NDK \u7248\u672c\u5b9e\u9645\u4e0a\u662f\u5728\u9009\u62e9\u7f16\u8bd1\u5668\uff0c\u65e9\u5148\u7f16\u8bd1\u53ef\u80fd\u7528\u7684\u662f GCC \u7f16\u8bd1\uff0c\u540e\u6765 Google \u5728 NDK r18b \u7248\u672c\u79fb\u9664\u4e86 GCC \u7f16\u8bd1\u5de5\u5177\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u5982\u4e0b\u94fe\u63a5\uff1a</p> <p>NDK \u4fee\u8ba2\u5386\u53f2\u8bb0\u5f55</p> <p>\u6240\u4ee5\u73b0\u5728\u6700\u65b0\u7684\u52a8\u6001\u5e93\u7f16\u8bd1\u90fd\u662f\u7528 Clang \u8fdb\u884c\u64cd\u4f5c\u7684\uff0c\u4e3a\u4e86\u8ddf\u4e0a\u65f6\u4ee3\u6b65\u4f10\uff0c\u4e5f\u5c31\u4e0d\u8981\u7528\u4e4b\u524d\u7684 NDK \u7248\u672c\u4e86\uff0c\u76f4\u63a5\u4e0a\u6700\u65b0\u7684\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u5927\u5bb6\u628a\u7cbe\u529b\u6d88\u8017\u5728 FFmpeg \u7684\u7f16\u8bd1\u4e0a\uff0c\u76f4\u63a5\u5c31\u7ed9\u51fa\u4e00\u4e2a Github Repo \uff0c\u5c06\u7f16\u8bd1\u811a\u672c\u90fd\u653e\u5728\u8fd9\u4e2a\u4ed3\u5e93\u4e0a\u4e86\u3002</p> <p>\u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://github.com/glumes/ffmpeg_android</p> <p></p> <p>\u5176\u4e2d FFmpeg \u6e90\u7801\u662f\u4f5c\u4e3a\u8be5\u4ed3\u5e93\u7684\u4e00\u4e2a\u5b50\u6a21\u5757 Submodules \u7684\u5f62\u5f0f\u52a0\u8f7d\u8fdb\u6765\u7684\uff0c\u5728\u4e0b\u8f7d\u65f6\u8981\u6ce8\u610f\u4e00\u4e0b\uff1a</p> <pre><code>git clone --recursive https://github.com/glumes/ffmpeg_android\n</code></pre> <p>\u4e0b\u8f7d\u540e\uff0c\u8fdb\u5165\u5230 build_android.sh \u6587\u4ef6\u4e2d\uff0c\u5c06 NDK \u66ff\u6362\u6210\u4f60\u81ea\u5df1\u7684\u8def\u5f84\uff0c\u6700\u597d\u4e5f\u7528 r20b \u7248\u672c\u7684\uff0c\u4fdd\u6301\u4e00\u81f4\u3002</p> <pre><code>#!/bin/bash\n\n#\u4f60\u7684NDK\u8def\u5f84\nNDK=/Users/glumes/Downloads/android-ndk-r20b\nTOOLCHAIN=$NDK/toolchains/llvm/prebuilt/darwin-x86_64\nAPI=21\n</code></pre> <p>\u66ff\u6362\u540e\uff0c\u7ed9\u811a\u672c\u53ef\u6267\u884c\u6743\u9650\u5c31\u80fd\u8fd0\u884c\u4e86\uff0c\u7f16\u8bd1\u540e\u7684\u52a8\u6001\u5e93\u5728 ffmpeg_library \u6587\u4ef6\u5939\u4e2d\uff0c\u76ee\u524d\u4ec5\u7f16\u8bd1\u4e86 armeabi-v7a \u67b6\u6784\u7684\u3002</p> <p>android \u6587\u4ef6\u5939\u5185\u5bf9\u5e94\u52a0\u8f7d so \u7684 Android \u5de5\u7a0b\uff0c\u4e5f\u662f FFmpeg \u8c03\u7528 Android MediaCodec \u7684\u6e90\u7801\u3002</p> <p>\u8fd9\u4e2a\u5de5\u7a0b\u76ee\u5f55\u4e5f\u662f\u4e0d\u9700\u8981\u4fee\u6539 FFmpeg \u7684\uff0c\u5e76\u4e14\u5173\u4e8e FFmpeg \u7684\u5f88\u591a\u7f16\u8bd1\u9009\u9879\u5f00\u5173\u653e\u5728\u4e86 config-env.sh \u76ee\u5f55\u4e2d\uff0c\u6709\u9700\u8981\u53ef\u4ee5\u5728\u6587\u4ef6\u5185\u505a\u4fee\u6539\uff0c\u4e0d\u5f71\u54cd\u4e3b\u7684\u7f16\u8bd1\u811a\u672c\u8fd0\u884c\u3002</p> <p>\u987a\u4fbf\u8d34\u4e00\u4e0b\u6e90\u7801\uff1a</p> <p>\u8fd9\u91cc\u662f\u5177\u4f53\u6267\u884c\u7f16\u8bd1\u7684\u51fd\u6570\uff0c\u51fd\u6570\u7528\u5230\u7684\u4e00\u4e9b\u53c2\u6570\u8981\u5728\u5916\u9762\u5b9a\u4e49\u597d\uff1a</p> <pre><code>function build_android\n{\necho \"Compiling FFmpeg for $CPU\"\n\n./configure \\\n    --prefix=$PREFIX \\\n    --libdir=$LIB_DIR \\\n    --enable-shared \\\n    --disable-static \\\n    --enable-jni \\\n    --disable-doc \\\n    --disable-symver \\\n    --disable-programs \\\n    --target-os=android \\\n    --arch=$ARCH \\\n    --cpu=$CPU \\\n    --cc=$CC \\\n    --cxx=$CXX \\\n    --enable-cross-compile \\\n    --sysroot=$SYSROOT \\\n    --extra-cflags=\"-Os -fpic $OPTIMIZE_CFLAGS\" \\\n    --extra-ldflags=\"$ADDI_LDFLAGS\" \\\n    --disable-asm \\\n    # \u8fd9\u4e9b\u7f16\u8bd1\u53c2\u6570\u5728 config-env.sh \u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86\n    $COMMON_FF_CFG_FLAGS\nmake clean\nmake -j8 # \u8fd9\u91cc\u662f\u5b9a\u4e49\u7528\u51e0\u4e2aCPU\u7f16\u8bd1\nmake install\necho \"The Compilation of FFmpeg for $CPU is completed\"\n}\n</code></pre> <p>\u63a5\u4e0b\u6765\u5b9a\u4e49\u597d\u76f8\u5173\u53c2\u6570\uff0c\u5c31\u53ef\u4ee5\u6267\u884c\u4e86\uff1a</p> <pre><code>// \u7f16\u8bd1\u7684 configure \u53ef\u6267\u884c\u6587\u4ef6\u5728 ffmpeg \u6e90\u7801\u76ee\u5f55\u4e2d\uff0c\u8981\u5148\u8fdb\u5165\u5230\u76ee\u5f55\u91cc\ncd ffmpeg\n\n// \u5b9a\u4e49\u597d\u7f16\u8bd1\u7684\u67b6\u6784\nOUTPUT_FOLDER=\"armeabi-v7a\"\nARCH=\"arm\"\nCPU=\"armv7-a\"\nTOOL_CPU_NAME=armv7a\nTOOL_PREFIX=\"$TOOLCHAIN/bin/arm-linux-androideabi\"\n\nCC=\"$TOOLCHAIN/bin/armv7a-linux-androideabi$API-clang\"\nCXX=\"$TOOLCHAIN/bin/armv7a-linux-androideabi$API-clang++\"\nSYSROOT=\"$NDK/toolchains/llvm/prebuilt/darwin-x86_64/sysroot\"\nPREFIX=\"${PWD}/../ffmpeg_library/android/$OUTPUT_FOLDER\"\nLIB_DIR=\"${PWD}/../ffmpeg_library/android/libs/$OUTPUT_FOLDER\"\nOPTIMIZE_CFLAGS=\"-march=$CPU\"\nbuild_android\n</code></pre> <p>\u7531\u4e8e\u6211\u4eec\u7684\u7f16\u8bd1\u811a\u672c\u4e0d\u653e\u5728 FFmpeg \u6e90\u7801\u76ee\u5f55\u4e2d\uff0c\u6240\u4ee5\u8981\u5bf9\u8def\u5f84\u505a\u4e00\u4e9b\u4fee\u6539\uff0c\u8fd9\u6837\u53ef\u4ee5\u7edd\u5bf9\u5730\u4e0d\u6539\u52a8\u4efb\u4f55 FFmpeg \u5185\u5bb9\u4e86\u3002</p> <p>\u901a\u8fc7\u4e0a\u8ff0\u7684\u53c2\u6570\u8bbe\u5b9a\uff0c\u5e94\u8be5\u5c31\u53ef\u4ee5\u7f16\u8bd1\u51fa\u6b63\u786e\u7684 Android \u52a8\u6001\u5e93\u4e86\uff0c\u5982\u679c\u4f60\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u8054\u7cfb\u6211\uff0c\u53ca\u65f6\u8c03\u6574\u4fdd\u8bc1\u8f7b\u677e\u641e\u5b9a\u7f16\u8bd1\u8fc7\u7a0b\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/how-to-scale-h264-video-file/","title":"H264\u89c6\u9891\u6587\u4ef6\u5982\u4f55\u7f29\u653e\u5206\u8fa8\u7387","text":"<p>\u524d\u51e0\u5929\u5728\u77e5\u8bc6\u661f\u7403\u91cc\u9762\u6709\u4f4d\u670b\u53cb\u8bf7\u6559\u95ee\u9898\uff1a\u5982\u4f55\u5c06 H264 \u89c6\u9891\u7f29\u653e\u5206\u8fa8\u7387\uff1f</p> <p>\u5177\u4f53\u7684\u95ee\u9898\u8be6\u60c5\u5982\u4e0b\uff1a</p> <p></p> <p>\u5c06 800x600 \u7684 H264 \u6587\u4ef6\u7f29\u653e\u6210 400x300 \u7684\uff0c\u5927\u6982\u7684\u6d41\u7a0b\u662f\u5148\u89e3\u7801\uff0c\u5f97\u5230 AVFrame \u540e\u5bf9\u5176\u505a\u7f29\u653e\u64cd\u4f5c\uff0c\u7136\u540e\u518d\u7f16\u7801\uff0c\u5f97\u5230 AVPacket \u540e\u5199\u5165\u6587\u4ef6\u5373\u53ef\u3002</p> <p>\u601d\u8def\u6ca1\u9519\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u770b\u770b\u8fd9\u4f4d\u540c\u5b66\u7684\u5199\u6cd5\u4e86\uff0c\u622a\u53d6\u90e8\u5206\u4ee3\u7801\uff1a</p> <p></p> <p>\u5927\u5bb6\u4e00\u8d77\u6765\u6311\u9519\uff0c\u770b\u770b\u9047\u5230\u95ee\u9898\u4e00\u822c\u89e3\u51b3\u601d\u8def\u662f\u4ec0\u4e48\u6837\u7684\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/how-to-scale-h264-video-file/#_1","title":"\u95ee\u9898\u4e00","text":"<p>\u9996\u5148\u63d0\u95ee\u8005\u4e00\u76f4\u5728 av_parser_parse2 \u51fd\u6570\u5904\u62a5\u9519\u3002</p> <p>\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\u4e0d\u8981\u614c\uff0c\u5fc5\u73b0\u7684\u95ee\u9898\u5148\u65ad\u70b9\u4e00\u4e0b\u770b\u770b\u8f93\u5165\u53c2\u6570\u662f\u5426\u6b63\u786e\u3002</p> <p>IDE \u7684\u65ad\u70b9\u8c03\u8bd5\u662f\u5e38\u89c1\u64cd\u4f5c\u4e86\uff0c\u5de5\u7a0b\u5e08\u8fdb\u9636\u5fc5\u5907\u3002</p> <p>\u6211\u6ca1\u6709\u8c03\u8bd5\u63d0\u95ee\u8005\u7684\u4ee3\u7801\uff0c\u4f46\u4e5f\u6000\u7591\u8f93\u5165\u53c2\u6570 pkt \u6709\u5f02\u5e38\uff0c\u987a\u7740\u4ee3\u7801\u5f80\u4e0b\u770b\uff0c\u679c\u7136\u5728\u51fd\u6570\u6700\u672b\u5c3e\u51e0\u884c\u8c03\u7528\u4e86 av_packet_free \u65b9\u6cd5\u3002</p> <p>\u4e00\u822c\u901a\u8fc7 av_packet_alloc \u53bb\u7533\u8bf7 AVPacket \uff0c\u800c av_packet_free \u5c31\u662f\u76f4\u63a5\u91ca\u653e\u5e76\u7f6e nullptr \uff0c\u8fd9\u6837\u4e0b\u6b21\u5728\u6267\u884c av_parser_parse2 \u65b9\u6cd5\u80af\u5b9a\u5c31\u6302\u4e86\u3002</p> <pre><code>void av_packet_free(AVPacket **pkt)\n{\n    if (!pkt || !*pkt)\n        return;\n\n    av_packet_unref(*pkt);\n    av_freep(pkt);\n}\n</code></pre> <p>\u6240\u4ee5\u8fd9\u91cc\u80af\u5b9a\u6709\u95ee\u9898\u5440\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/how-to-scale-h264-video-file/#_2","title":"\u95ee\u9898\u4e8c","text":"<p>\u63a5\u7740\u770b\u5176\u4ed6\u95ee\u9898\uff0c\u60f3\u8981\u7f29\u653e\u5206\u8fa8\u7387\uff0c\u53ef\u4ee5\u4ee3\u7801\u622a\u56fe\u4e2d\u5e76\u6ca1\u6709\u770b\u5230\u4efb\u4f55\u7f29\u653e\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u5c06\u89e3\u7801\u540e\u7684 AVFrame \u9001\u53bb\u7f16\u7801\u5c31\u53ef\u4ee5\u7f29\u653e\u5417\uff1f</p> <p>\u6211\u731c\u60f3\uff0c\u63d0\u95ee\u8005\u5e94\u8be5\u5728\u8bbe\u7f6e\u7f16\u7801\u7684 AVCodecContext \u65f6\u5c31\u5df2\u7ecf\u6307\u5b9a\u597d\u4e86\u7f29\u653e\u540e\u7684\u5206\u8fa8\u7387 400x300 \uff0c\u4f46\u9001\u53bb\u7f16\u7801\u7684 AVFrame \u8fd8\u662f 800x600 \u7684\uff0c\u8fd9\u6837\u7f16\u7801\u7684\u7ed3\u679c\u4f1a\u662f\u7f29\u653e\u7684\u5417\uff1f</p> <p>\u7ecf\u8fc7\u8bd5\u9a8c\u8bc1\u660e\uff0c\u7f16\u7801\u7684\u89c6\u9891\u786e\u5b9e\u662f 400x300 \u7684\uff0c\u4f46\u753b\u9762\u5374\u662f\u4ece 800x600 \u622a\u53d6\u7684\u4e00\u90e8\u5206\uff0c\u5e76\u6ca1\u6709\u663e\u793a\u5b8c\u5168\uff0c\u6240\u4ee5\u8fd9\u6837\u662f\u4e0d\u80fd\u8d77\u5230\u7f29\u653e\u6548\u679c\u7684\u3002</p> <p>\u8981\u7f29\u653e\u8fd8\u662f\u5f97\u7528 FFmpeg \u4e2d SwsContext \u63d0\u4f9b\u7684\u65b9\u6cd5\u3002</p> <pre><code>// \u521d\u59cb\u5316\nswsCtx = sws_getContext(800,600,AV_PIX_FMT_YUV420P,400,300,AV_PIX_FMT_YUV420P,SWS_BILINEAR, nullptr, nullptr,nullptr);\n// \u7f29\u653e\nsws_scale(swsCtx,decodeFrame-&gt;data,decodeFrame-&gt;linesize,0,decodeFrame-&gt;height,encodeFrame-&gt;data,encodeFrame-&gt;linesize);\n</code></pre> <p>\u5c06\u7f29\u653e\u540e\u7684 AVFrame \u9001\u53bb\u7f16\u7801\u5c31\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u6548\u679c\u4e86\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/how-to-scale-h264-video-file/#_3","title":"\u95ee\u9898\u4e09","text":"<p>\u518d\u4ed4\u7ec6\u770b\u63d0\u95ee\u8005\u7684\u4ee3\u7801\uff0c\u6709\u5fc5\u8981\u5728\u89e3\u7801 avcodec_receive_frame \u4e4b\u524d\u8c03\u7528 av_frame_make_writable \u5417\uff1f</p> <p>\u7531\u4e8e\u63d0\u95ee\u8005\u7684\u4ee3\u7801\u672c\u8eab\u4e0d\u5bf9\uff0c\u5176\u5b9e\u4e5f\u4e0d\u7528\u8c03\u7528 av_frame_make_writable \u7684\uff0c\u6b63\u5e38\u7684\u7f29\u653e\u5e94\u8be5\u8981\u4e24\u4e2a AVFrame \u7684\uff0c\u89e3\u7801\u7684 AVFrame \u4e0d\u9700\u8981\uff0c\u53cd\u800c\u7f16\u7801\u7684 AVFrame \u9700\u8981\u4fdd\u8bc1\u53ef\u5199\u3002</p> <p>\u4ee5\u4e0a\u5c31\u662f\u5173\u4e8e\u8fd9\u6b21\u63d0\u95ee\u7684\u4e00\u4e9b\u95ee\u9898\u53cd\u9988\u4e86\uff0c\u6211\u81ea\u5df1\u4e5f\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684 H264 \u89c6\u9891\u6587\u4ef6\u7f29\u653e\u5206\u8fa8\u7387\u7684\u4f8b\u5b50\uff0c\u5b8c\u6574\u7684\u4ee3\u7801\u5c31\u653e\u5728\u77e5\u8bc6\u661f\u7403\u91cc\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/mac-mp4-info/","title":"006 | \u64ad\u653e\u5668\u7cfb\u5217\u4e13\u680f-\u5728 Mac \u4e0a\u67e5\u770b MP4 \u683c\u5f0f\u4fe1\u606f","text":"<p>\u4e4b\u524d\u4ecb\u7ecd\u4e86\u5728 Windows \u4e0a\u67e5\u770b MP4 \u683c\u5f0f\u4fe1\u606f\uff0c\u4f7f\u7528\u7684\u662f Mp4 Explorer \u8f6f\u4ef6\uff0c\u5177\u4f53\u4f7f\u7528\u5982\u4e0b\uff1a</p> <p>005 | \u64ad\u653e\u5668\u7cfb\u5217\u4e13\u680f-\u5728 Windows \u4e0a\u67e5\u770b MP4 \u683c\u5f0f</p> <p>\u73b0\u5728\u8be5\u4ecb\u7ecd\u4e00\u4e0b MAC \u4e0a\u7528\u7684\u8f6f\u4ef6\u4e86\uff0c\u5b83\u5c31\u662f MediaInfo \u8f6f\u4ef6\uff0c\u5b98\u7f51\u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://mediaarea.net/MediaInfo</p> <p>\u4f7f\u7528\u8d77\u6765\u4e5f\u5f88\u7b80\u5355\uff0c\u6253\u5f00\u89c6\u9891\u6587\u4ef6\u5c31\u53ef\u4ee5\u770b\u5230\u4fe1\u606f\u4e86\u3002</p> <p>\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u73b0\u5728 MediaInfo \u4e5f\u8981\u6536\u8d39\u4f7f\u7528\u4e86\uff0c\u800c\u4e14\u8fd8\u4e0d\u80fd\u663e\u793a Box \u4fe1\u606f\uff0c\u5176\u5185\u5bb9\u548c FFmpeg \u547d\u4ee4\u663e\u793a\u5dee\u4e0d\u591a\u7684\uff0c\u6240\u4ee5\u5728 Mac \u4e0a\u8fd8\u662f\u5efa\u8bae\u76f4\u63a5\u7528 FFmpeg \u597d\u3002</p>","tags":["Player"]},{"location":"ffmpeg/mac-mp4-info/#bento4","title":"Bento4 \u4ecb\u7ecd","text":"<p>\u90a3\u4e48\u5982\u4f55\u5728 Mac \u4e0a\u663e\u793a MP4 \u7684 Box \u4fe1\u606f\u5462\uff1f\u7b54\u6848\u5c31\u662f\u7528 Bento4 \u8f6f\u4ef6\u3002</p> <p>Bento4 \u7684\u5b98\u7f51\u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://www.bento4.com/</p> <p>\u5b83\u7684 Github \u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://github.com/axiomatic-systems/Bento4</p> <p>Bento4 \u662f\u4e00\u6b3e\u5f00\u6e90\u8f6f\u4ef6\uff0c\u6709 C++\u3001Java\u3001Python \u4e09\u79cd\u5bf9\u5916\u63a5\u53e3\uff0c\u53ef\u4ee5\u7528\u6765\u5bf9 MP4 \u89c6\u9891\u8fdb\u884c\u5404\u79cd\u64cd\u4f5c\u3002</p> <p>\u6bd4\u5982\u663e\u793a Box \u7ed3\u6784\u3001\u52a0\u89e3\u5bc6\u89c6\u9891\u3001\u62bd\u53d6\u97f3\u89c6\u9891\u6d41\u7b49\uff0c\u8fd8\u53ef\u4ee5\u5c06 MP4 \u6587\u4ef6\u8f6c\u6362\u6210 TS \u6587\u4ef6\u6216\u8005 HLS \u6587\u4ef6\uff0c\u6216\u8005\u5c06 MP4 \u8f6c\u6362\u6210 Fragment MP4 \u683c\u5f0f\u3002</p> <p>\u8be6\u7ec6\u529f\u80fd\u5728 Github \u4e2d\u4ecb\u7ecd\u7684\u5f88\u5168\u9762\u4e86\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e2d\u6587\u7ffb\u8bd1\u7248\u672c\uff1a</p> <pre><code>mp4info         \u663e\u793a\u6709\u5173MP4\u6587\u4ef6\u7684\u9ad8\u7ea7\u4fe1\u606f\uff0c\u5305\u62ec\u6240\u6709tracks\u548ccodec\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\nmp4dump         \u663e\u793aMP4\u6587\u4ef6\u7684\u6574\u4e2aatom/box\u7ed3\u6784\u3002\nmp4edit         \u6dfb\u52a0/\u63d2\u5165/\u79fb\u9664/\u66ff\u6362 MP4\u6587\u4ef6\u7684atom/box\u9879\u3002\nmp4extract      \u4eceMP4\u6587\u4ef6\u4e2d\u63d0\u53d6atom/box\nmp4encrypt      \u52a0\u5bc6MP4\u6587\u4ef6\uff08\u652f\u6301\u591a\u79cd\u52a0\u5bc6\u65b9\u6848\uff09\nmp4decrypt      \u89e3\u5bc6MP4\u6587\u4ef6\uff08\u652f\u6301\u591a\u79cd\u52a0\u5bc6\u65b9\u6848\uff09\nmp4dcfpackager  \u5c06\u5a92\u4f53\u6587\u4ef6\u52a0\u5bc6\u4e3aOMA DCF\u6587\u4ef6\nmp4compact      \u5c06\u201cstsz\u201d\u8868\u8f6c\u6362\u4e3a\u201cstz2\u201d\u8868\u4ee5\u521b\u5efa\u66f4\u7d27\u51d1\u7684MP4\u6587\u4ef6\nmp4fragment     \u4ece\u975e\u788e\u7247\u5316\u7684MP4\u6587\u4ef6\u521b\u5efa\u788e\u7247\u5316MP4\u6587\u4ef6\u3002\nmp4split        \u5c06\u652f\u79bb\u7834\u788e\u7684MP4\u6587\u4ef6\u62c6\u5206\u4e3a\u79bb\u6563\u7684\u6587\u4ef6\nmp4tag          \u663e\u793a/\u7f16\u8f91MP4\u5143\u6570\u636e\uff08iTunes\u6837\u5f0f\u548c\u5176\u4ed6\u6837\u5f0f\uff09\nmp4mux          \u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u57fa\u672c\u6d41\uff08H264/AVC\u3001H265/HEVC\u3001AAC\uff09\u591a\u8def\u590d\u7528\u5230MP4\u6587\u4ef6\u4e2d\nmp42aac         \u4eceMP4\u6587\u4ef6\u4e2d\u63d0\u53d6\u539f\u59cbAAC\u57fa\u672c\u6d41\nmp42avc         \u4eceMP4\u6587\u4ef6\u4e2d\u63d0\u53d6\u539f\u59cbAVC/H.264\u57fa\u672c\u6d41\nmp42hls         \u5c06MP4\u6587\u4ef6\u8f6c\u6362\u4e3aHLS\uff08HTTP Live Streaming\uff09\u6f14\u793a\u6587\u7a3f\uff0c\u5305\u62ec\u751f\u6210\u7247\u6bb5\u548c.m3u8\u64ad\u653e\u5217\u8868\u4ee5\u53caAES-128\u548cSAMPLE-AES\uff08\u7528\u4e8e\u516c\u5e73\u64ad\u653e\uff09\u52a0\u5bc6\u3002\u8fd9\u53ef\u4ee5\u4f5c\u4e3a\u82f9\u679cmediafilesegmenter\u5de5\u5177\u7684\u66ff\u4ee3\u54c1\u3002\nmp42ts          \u5c06MP4\u6587\u4ef6\u8f6c\u6362\u4e3aMPEG2-TS\u6587\u4ef6\u3002\nmp4dash         \u4ece\u4e00\u4e2a\u6216\u591a\u4e2aMP4\u6587\u4ef6\uff08\u5305\u62ec\u52a0\u5bc6\uff09\u521b\u5efaMPEG\u7834\u6298\u53f7\u8f93\u51fa\u3002\u4f5c\u4e3a\u4e00\u79cd\u9009\u62e9\uff0c\u8fd8\u53ef\u4ee5\u540c\u65f6\u751f\u6210\u5e26\u6709MP4\u7247\u6bb5\u7684HLS\u64ad\u653e\u5217\u8868\uff0c\u5141\u8bb8\u5c06\u5355\u4e2a\u6d41\u7528\u4f5cDASH\u548cHLS\u3002\u8fd9\u662f\u4e00\u4e2a\u529f\u80fd\u9f50\u5168\u7684MPEG DASH/HLS\u6253\u5305\u673a\u3002\nmp4dashclone    \u521b\u5efa\u8fdc\u7a0b\u6216\u672c\u5730MPEG\u7834\u6298\u53f7\u6f14\u793a\u6587\u7a3f\u7684\u672c\u5730\u514b\u9686\uff0c\u5e76\u5728\u514b\u9686\u7247\u6bb5\u65f6\u5bf9\u5176\u8fdb\u884c\u52a0\u5bc6\u3002\nmp4hls          \u4ece\u4e00\u4e2a\u6216\u591a\u4e2aMP4\u6587\u4ef6\u521b\u5efa\u591a\u6bd4\u7279\u7387HLS\u4e3b\u64ad\u653e\u5217\u8868\uff0c\u5305\u62ec\u5bf9\u52a0\u5bc6\u548c\u4ec5I\u5e27\u64ad\u653e\u5217\u8868\u7684\u652f\u6301\u3002\u6b64\u5de5\u5177\u5728\u5185\u90e8\u4f7f\u7528\u201cmp42hls\u201d\u4f4e\u7ea7\u5de5\u5177\uff0c\u56e0\u6b64\u8be5\u4f4e\u7ea7\u5de5\u5177\u652f\u6301\u7684\u6240\u6709\u9009\u9879\u4e5f\u90fd\u53ef\u7528\u3002\u8fd9\u53ef\u4ee5\u4f5c\u4e3a\u82f9\u679cvariantplaylistcreator\u5de5\u5177\u7684\u66ff\u4ee3\u54c1\u3002\n</code></pre>","tags":["Player"]},{"location":"ffmpeg/mac-mp4-info/#bento4_1","title":"\u5b89\u88c5 Bento4","text":"<p>\u5b89\u88c5\u5f88\u7b80\u5355\uff0c\u4e00\u884c\u547d\u4ee4\u641e\u5b9a\uff1a</p> <pre><code>brew install bento4\n</code></pre> <p>\u7136\u540e\u5c31\u62e5\u6709\u4e86\u4e0a\u9762\u56fe\u7247\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u884c\u5de5\u5177\u3002</p>","tags":["Player"]},{"location":"ffmpeg/mac-mp4-info/#bento4_2","title":"Bento4 \u5de5\u5177\u4f7f\u7528","text":"<p>\u522b\u770b\u4e0a\u9762\u547d\u4ee4\u884c\u5de5\u5177\u5f88\u591a\uff0c\u4f7f\u7528\u8d77\u6765\u975e\u5e38\u7b80\u5355\u3002</p> <p></p> <p>\u76f4\u63a5\u8f93\u5165\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u4f7f\u7528\u63d0\u793a\u3002</p> <p>\u60f3\u8981\u67e5\u770b MP4 \u7684 Box \u4fe1\u606f\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>// \u6362\u6210\u4f60\u7684\u8def\u5f84\nmp4dump video-640x360.mp4\n</code></pre> <p>\u663e\u793a\u5982\u4e0b\uff1a</p> <p></p> <p>\u9664\u4e86\u663e\u793a Box \u4fe1\u606f\uff0c\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u5c06 MP4 \u8f6c\u6210 TS \u683c\u5f0f\u6587\u4ef6</p> <pre><code>mp42ts video-640x360.mp4 ideo-640x360.ts\n</code></pre> <p>\u53e6\u5916\u8fd8\u53ef\u4ee5\u5c06 MP4 \u6587\u4ef6\u8fdb\u884c\u5207\u7247\u652f\u6301 HLS \u6d41\u683c\u5f0f\uff0c\u4ece\u800c\u652f\u6301 m3u8 \u7684\u5f62\u5f0f\u8fdb\u884c\u64ad\u653e\u3002</p> <pre><code>mp42hls video-640x360.mp4\n</code></pre> <p>\u751f\u6210\u7684\u6587\u4ef6\u5982\u4e0b\uff1a</p> <p></p> <p>\u603b\u4e4b\uff0cBento4 \u7684\u529f\u80fd\u8fd8\u662f\u5f88\u5f3a\u5927\u7684\uff0c\u975e\u5e38\u503c\u5f97\u5b66\u4e60\u548c\u4f7f\u7528\u3002</p>","tags":["Player"]},{"location":"ffmpeg/multimedia-new-beginner/","title":"\u97f3\u89c6\u9891\u5f00\u53d1\u7cfb\u7edf\u5165\u95e8\u5927\u81f4\u8def\u7ebf","text":"<p>\u56fe\u7247\u52a0\u8f7d\u53ef\u80fd\u4f1a\u6bd4\u8f83\u6162\uff0c\u8bf7\u591a\u7b49\u5f85\uff01\uff01\uff01</p> <p></p>","tags":["FFmpeg"]},{"location":"ffmpeg/planet-player-project-configure-ffmpeg/","title":"002 | \u64ad\u653e\u5668\u7cfb\u5217\u4e13\u680f-FFmpeg\u4f9d\u8d56\u5e93\u7684\u914d\u7f6e","text":"<p>\u4e0a\u56de\u4e66\u8bf4\u9053\uff1a\u661f\u7403\u4e13\u4eab | \u5173\u4e8e\u64ad\u653e\u5668\u7684\u4e00\u6b21\u9879\u76ee\u5b9e\u8df5</p> <p>\u76ee\u524d\u5df2\u7ecf\u5b8c\u6210\u4e86\u9879\u76ee\u7684\u521b\u5efa\uff0c\u662f\u600e\u6837\u4e00\u4e2a\u9879\u76ee\u5462\uff1f</p> <p>\u9996\u5148\u662f\u64ad\u653e\u5668 SDK \uff0c\u4e5f\u662f\u9879\u76ee\u6700\u6838\u5fc3\u7684\u6a21\u5757\uff0c\u7136\u540e\u662f\u5bf9 SDK \u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\u7684\u6a21\u5757\uff0c\u6700\u540e\u662f\u4f7f\u7528 SDK \u505a\u64ad\u653e\u5668\u7684\u53ef\u89c6\u5316\u9879\u76ee\u6a21\u5757\u3002</p> <p>\u9879\u76ee\u5de5\u7a0b\u7684\u6bcf\u4e2a\u76ee\u5f55\u4ecb\u7ecd\u5df2\u7ecf\u5728\u4e0a\u7bc7\u6587\u7ae0\u4e2d\u8bb2\u8fc7\u4e86\uff0c\u8fd9\u91cc\u4f1a\u8bf4\u4e00\u4e0b\u5982\u4f55\u6253\u5f00\u9879\u76ee\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c1 \u548c 2 \u4ee3\u8868\u4e24\u4e2a CMakeLists.txt \u6587\u4ef6\uff0c\u5176\u4e2d 1 \u4ee3\u8868\u7684\u662f SDK \u5de5\u7a0b CMake \u914d\u7f6e\u6587\u4ef6\uff0c2 \u4ee3\u8868\u7684\u662f\u64ad\u653e\u5668\u5de5\u7a0b CMake \u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u56fe\u6807 3 \u4f5c\u4e3a\u65b0\u589e\u7684\u5e93\u6587\u4ef6\u76ee\u5f55\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecd\u3002</p> <p>\u9879\u76ee\u6839\u76ee\u5f55\u662f\u4f5c\u4e3a SDK \u7684\u76ee\u5f55\uff0c\u800c demo \u662f\u5728\u6839\u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u4e2d\uff0c\u540c\u65f6 demo \u4f9d\u8d56\u6839\u76ee\u5f55 SDK \u7684\u7f16\u8bd1\u7ed3\u679c\uff0c\u8fd9\u79cd\u9879\u76ee\u914d\u7f6e\u5728\u4e00\u4e9b\u5f00\u6e90\u9879\u76ee\u4e2d\u8fd8\u662f\u5f88\u5e38\u89c1\u7684\u3002</p> <p>\u5f53\u7528 CLion \u6253\u5f00\u5de5\u7a0b\u65f6\u5982\u679c\u9009\u62e9\u4e86\u6839\u76ee\u5f55\u4e0b\u7684 CMakeLists.txt \u5c31\u662f SDK \u5de5\u7a0b\u4e86\uff0c\u9009\u62e9\u4e86 demo \u76ee\u5f55\u4e0b\u7684\u5c31\u662f\u64ad\u653e\u5668\u9879\u76ee\u4e86\uff0c\u5dee\u522b\u5c31\u662f\u5728 CLion \u4e2d\u80fd\u5426\u6709 PlanetPlayerDemo \u8fd9\u4e2a\u6784\u5efa\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u9009\u62e9 SDK \u5de5\u7a0b\u6253\u5f00\u65b9\u5f0f\u65f6\u5c31\u53ea\u6709 2 \u548c 3 \u7684\u9009\u9879\u4e86\uff0c\u5176\u4e2d 2 \u662f SDK \u7684\u6784\u5efa\uff0c3 \u662f\u5355\u6d4b\u7684\u6784\u5efa\uff0c\u800c 1 \u662f\u64ad\u653e\u5668\u6253\u5f00\u65b9\u5f0f\u624d\u6709\u7684\uff0c\u524d\u671f\u5f88\u591a\u65f6\u5019\u90fd\u53ea\u8981 SDK \u6253\u5f00\u65b9\u5f0f\u5c31\u884c\u4e86\u3002</p> <p>\u6253\u5f00\u5de5\u7a0b\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u8981\u6dfb\u52a0 FFmpeg \u7684\u4f9d\u8d56\u4e86\u3002</p> <p>\u8fd9\u91cc\u5e76\u4e0d\u6253\u7b97\u8bb2\u8981\u5982\u4f55\u7f16\u8bd1 FFmpeg \uff0c\u56e0\u4e3a\u4e00\u5f00\u59cb\u5c31\u88ab\u7f16\u8bd1\u56f0\u4f4f\u4e86\uff0c\u5f88\u96be\u63a5\u4e0b\u6765\u7684\u5b66\u4e60\uff0c\u53cd\u800c\u6709\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u76f4\u63a5\u62ff\u7f16\u8bd1\u597d\u7684\u5e93\u5c31\u884c\u4e86\u3002</p> <p>\u5982\u679c\u662f Mac \u7535\u8111\u7684\u8bdd\uff0c\u4f7f\u7528 brew \u5b89\u88c5 ffmepg \uff0c\u7535\u8111\u4e0a\u5c31\u5df2\u7ecf\u6709\u7f16\u8bd1\u597d\u7684\u5e93\u4e86\uff0c\u800c\u4e14\u8fd8\u5f88\u5168\u9762\u3002</p> <pre><code>brew install ffmpeg\n</code></pre> <p>\u4f17\u6240\u5468\u77e5\uff0cFFmpeg \u662f\u6709\u5f88\u591a\u7f16\u8bd1\u9009\u9879\u548c\u4f9d\u8d56\u9009\u9879\u7684\uff0c\u90a3\u4e48\u4e0a\u9762\u7684\u547d\u4ee4\u5230\u5e95\u6307\u5b9a\u4e86\u54ea\u4e9b\u4f9d\u8d56\u5462\uff1f</p> <p></p> <p>\u5982\u4e0a\u56fe\uff0c\u2705 \u548c \u274e \u8868\u793a\u7684\u610f\u601d\u5f88\u660e\u786e\u4e86\u3002</p> <p>\u53e6\u5916\u7bad\u5934\u6240\u6307\u7684 url \u5730\u5740\u5176\u5b9e\u5c31\u662f brew \u5b89\u88c5 ffmpeg \u7684\u7f16\u8bd1\u811a\u672c\u4e86\uff0c\u91cc\u9762\u6307\u5b9a\u4e86\u54ea\u4e9b\u4f9d\u8d56\u5185\u5bb9\uff0c\u6bd4\u5982\u6d89\u53ca\u7684 x264\u3001x265 \u5c31\u5305\u542b\u5728\u5185\u4e86\u3002</p> <p>\u6211\u4eec\u7684\u64ad\u653e\u5668\u9879\u76ee\u5c31\u662f\u5728 Mac \u4e0a\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u5b8c\u5168\u53ef\u4ee5\u76f4\u63a5\u7528 brew \u5b89\u88c5\u597d\u7684 ffmpeg \u5e93\u3002</p> <p></p> <p>\u5982\u4e0a\u547d\u4ee4\uff0c\u5728 finder \u4e2d\u6253\u5f00 ffmpeg \u7684\u5b89\u88c5\u76ee\u5f55\u3002</p> <p></p> <p>\u5176\u4e2d include \u76ee\u5f55\u5c31\u662f\u5934\u6587\u4ef6\u76ee\u5f55\uff0clib \u76ee\u5f55\u91cc\u9762\u653e\u7740 ffmpeg \u7684\u52a8\u6001\u5e93\u548c\u9759\u6001\u5e93\u3002</p> <p>\u6211\u4eec\u8981\u7684\u5c31\u662f\u8fd9\u4e24\u4e2a\u76ee\u5f55\u91cc\u7684\u4e1c\u897f\uff0c\u76f4\u63a5\u62f7\u51fa\u6765\u7528\uff0c\u4e3a\u6b64\u6211\u5efa\u7acb\u4e86\u4e00\u4e2a\u4ed3\u5e93\uff0c\u5355\u72ec\u5b58\u653e\u8fd9\u4e9b\u7f16\u8bd1\u597d\u7684\u5e93\u6587\u4ef6\uff08\u53ea\u7528\u9759\u6001\u5e93\u5c31\u884c\uff09\u3002</p> <p>https://github.com/glumes/lib</p> <p>\u8fd9\u4e2a\u4ed3\u5e93\u6b63\u597d\u5bf9\u5e94\u4e4b\u524d\u63d0\u7684\u56fe\u6807 3 \u7684\u76ee\u5f55\u3002 </p> <p>\u6e29\u99a8\u63d0\u793a\uff1a\u7531\u4e8e\u6211\u5728\u5bb6\u7528\u7684 M1 Pro \u5bf9\u5e94 arm64 \u67b6\u6784\uff0c\u6240\u4ee5\u62ff\u51fa\u6765\u7684\u5e93\u4e5f\u662f arm64 \u67b6\u6784\u7684\uff0c\u5982\u679c\u4f60\u7528\u7684\u975e M1 \u5bf9\u5e94\u7684\u5c31\u662f x86_64 \u67b6\u6784\uff0c\u8fd9\u5757\u7b49\u6211\u56de\u516c\u53f8\u4e86\u8865\u4e0a\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u8865\u4e0a\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u8981\u5728\u5de5\u7a0b\u4e2d\u94fe\u63a5 FFmpeg \u5e93\u4e86\u3002</p> <p>\u9996\u5148\u65b0\u5efa\u4e86\u4e00\u4e2a vendor.cmake \u4f5c\u8f85\u52a9\uff0c\u5224\u65ad\u5f53\u524d\u7cfb\u7edf\u662f\u4ec0\u4e48\u5e73\u53f0\u548c\u67b6\u6784\u7684\uff1a</p> <pre><code>if (CMAKE_SYSTEM_PROCESSOR STREQUAL \"arm64\")\n    set(arch arm64)\nelseif (CMAKE_SYSTEM_PROCESSOR STREQUAL \"x86_64\")\n    set(arch x64)\nendif ()\n\nif (WIN32)\n    set(platform win)\nelseif (APPLE)\n    set(platform mac)\nelse ()\n    message(FATAL_ERROR \"not support current platform\")\nendif ()\n</code></pre> <p>\u7136\u540e\u6dfb\u52a0\u94fe\u63a5 FFmpeg \u5e93\u7684\u65b9\u6cd5\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u94fe\u63a5\u5e93\u65f6\u7528\u5230\u4e86\u4e0a\u9762\u6307\u5b9a\u7684\u5e73\u53f0\u548c\u67b6\u6784\u4fe1\u606f\uff0c\u8fd9\u548c\u6211\u4eec\u7684\u76ee\u5f55\u7ed3\u6784\u662f\u76f8\u4e92\u4f9d\u8d56\u7684\u3002</p> <p></p> <p>\u6709\u4e86\u8fd9\u4e24\u4e2a\u65b9\u6cd5\uff0c\u5728 SDK \u5de5\u7a0b\u548c\u64ad\u653e\u5668\u5de5\u7a0b\u90fd\u53ef\u4ee5\u590d\u7528\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5728 SDK \u5de5\u7a0b\u4e2d\u7684\u914d\u7f6e\u5c31\u548c\u5e73\u5e38\u914d\u7f6e\u4e00\u6837\u4e86\uff0c\u4f9d\u8d56\u597d ffmpeg \u7684\u5e93\u3002</p> <pre><code>set(path ${CMAKE_CURRENT_SOURCE_DIR})\n\n# SDK \u7684\u5934\u6587\u4ef6\nset(PLANET_INCLUDES ./ include src)\n\ninclude(${CMAKE_CURRENT_SOURCE_DIR}/vendor.cmake)\n\n# \u6a21\u62df\u7b2c\u4e09\u65b9\u5e93\u4f9d\u8d56\nadd_subdirectory(3rdparty/test1)\nlist(APPEND PLANET_INCLUDES 3rdparty/test1/src)\n\nadd_subdirectory(3rdparty/test2)\nlist(APPEND PLANET_INCLUDES 3rdparty/test2/src)\n\n# \u6dfb\u52a0 FFmpeg \u5934\u6587\u4ef6\u7684\u4f9d\u8d56\nlist(APPEND PLANET_INCLUDES ${path}/lib/ffmpeg/${platform}/${arch}/include)\n# \u81ea\u5b9a\u4e49\u65b9\u6cd5 \u94fe\u63a5 ffmpeg \u5e93\u76ee\u5f55\nlink_ffmpeg_directory(${path})\n\n# SDK \u7684\u6e90\u6587\u4ef6\nfile(GLOB_RECURSE PLANET_FILES\n        src/*.*)\n\n# \u7f16\u8bd1 SDK \u7684\u9759\u6001\u5e93\nadd_library(PlanetPlayer STATIC ${PLANET_FILES})\n\n# \u5305\u542b\u5934\u6587\u4ef6\u5185\u5bb9\ntarget_include_directories(PlanetPlayer PUBLIC ${PLANET_INCLUDES})\n\n# \u94fe\u63a5\u4e09\u65b9\u5e93\ntarget_link_libraries(PlanetPlayer  gtest TEST1 TEST2)\n\n# \u81ea\u5b9a\u4e49\u65b9\u6cd5 \u94fe\u63a5 ffmpeg\nlink_ffmpeg_library(PlanetPlayer ${path})\n</code></pre> <p>\u540c\u6837\u5728\u64ad\u653e\u5668\u9879\u76ee\u4e2d\u4e5f\u8981\u505a\u914d\u7f6e\uff0c\u4f9d\u8d56 SDK \u4ee5\u53ca ffmpeg \u7684\u5e93\u3002</p> <pre><code># \u8bbe\u7f6e SDK \u7684\u6839\u76ee\u5f55\nset(ProjectPath ${CMAKE_CURRENT_SOURCE_DIR}/../../PlanetPlayer)\n\n# \u81ea\u5b9a\u4e49\u65b9\u6cd5 \u94fe\u63a5 ffmpeg \u5e93\u76ee\u5f55\nlink_ffmpeg_directory(${path})\n\n# \u64ad\u653e\u5668\u9879\u76ee\u7684\u5934\u6587\u4ef6\nset(DEMO_INCLUDES ${CMAKE_CURRENT_SOURCE_DIR}/src)\n\n# SDK \u63d0\u4f9b\u7684\u5934\u6587\u4ef6\nlist(APPEND DEMO_INCLUDES ${ProjectPath}/include)\n\n# \u64ad\u653e\u5668\u9879\u76ee\u7684\u6e90\u6587\u4ef6\nfile(GLOB_RECURSE DEMO_SOURCE_FILES ${CMAKE_CURRENT_SOURCE_DIR}/src/*.*)\n\n# \u6dfb\u52a0 SDK \u7684\u76ee\u5f55\nadd_subdirectory(${ProjectPath}/ PlanetPlayer)\n\n# \u64ad\u653e\u5668\u9879\u76ee\nadd_executable(PlanetPlayerDemo ${DEMO_SOURCE_FILES})\n\n# \u5305\u542b\u5934\u6587\u4ef6\u5185\u5bb9\ntarget_include_directories(PlanetPlayerDemo PUBLIC ${DEMO_INCLUDES})\n\n# \u94fe\u63a5\u4e09\u65b9\u5e93\ntarget_link_libraries(PlanetPlayerDemo PlanetPlayer)\n\n# \u81ea\u5b9a\u4e49\u65b9\u6cd5 \u94fe\u63a5 ffmpeg\nlink_ffmpeg_library(PlanetPlayerDemo ${path})\n</code></pre> <p>\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u65e2\u7136 SDK \u4f9d\u8d56\u4e86 ffmepg \uff0c\u64ad\u653e\u5668\u4f9d\u8d56\u4e86 SDK \uff0c\u4e3a\u4ec0\u4e48\u64ad\u653e\u5668\u8fd8\u6709\u4f9d\u8d56 ffmpeg \uff1f</p> <p>\u8fd9\u662f\u56e0\u4e3a\u7f16\u8bd1\u7684 SDK \u662f\u4e2a\u9759\u6001\u5e93\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u628a ffmpeg \u7684\u9759\u6001\u5e93\u5408\u5e76\u8fdb\u6765\uff0c\u5bfc\u81f4\u64ad\u653e\u5668\u4ec5\u94fe\u63a5\u4e86 SDK \u7684\u5e93\u4f1a\u627e\u4e0d\u5230 ffmpeg \u51fd\u6570\u7684\u7b26\u53f7\u8868\uff0c\u540e\u7eed\u518d\u628a\u8fd9\u4e2a\u529f\u80fd\u8865\u4e0a\u3002</p> <p>\u53e6\u5916\u4e5f\u8bf4\u660e\u4e86\uff0c\u97f3\u89c6\u9891\u505a\u5de5\u7a0b\u642d\u5efa\u4e5f\u662f\u6709\u5f88\u591a\u5b66\u95ee\u7684\u3002</p> <p>\u4ee5\u4e0a\u5c31\u662f\u672c\u7bc7\u6587\u7ae0\u7684\u5185\u5bb9\u4e86\uff0c\u641e\u5b9a\u4e86\u5e93\u4f9d\u8d56\u5c31\u53ef\u4ee5\u5f00\u59cb\u64b8\u4ee3\u7801\u5566\uff01\uff01\uff01</p> <p>\u5173\u4e8e\u64ad\u653e\u5668\u5b9e\u8df5\u7684\u4e13\u680f\uff0c\u540e\u7eed\u5927\u90e8\u5206\u8fdb\u5c55\u90fd\u4f1a\u653e\u5728\u77e5\u8bc6\u661f\u7403\u91cc\u9762\u4e86\uff0c\u5c24\u5176\u662f\u6e90\u7801\u4f1a\u5728\u661f\u7403\u5185\u540c\u6b65\u66f4\u65b0\uff0c\u5f53\u7136\u4e5f\u4f1a\u6311\u4e00\u4e9b\u5e72\u8d27\u5728\u516c\u4f17\u53f7\u540c\u6b65\u3002</p> <p>\u76ee\u524d \u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636\u77e5\u8bc6\u661f\u7403 \u8fd8\u5728\u8ba9\u5229\u4e2d\uff0c\u975e\u5e38\u4f4e\u7684\u4ef7\u683c\u5c31\u53ef\u4ee5\u83b7\u5f97\u4e1a\u5185\u4e00\u7ebf\u5f00\u53d1\u4eba\u5458\u7684\u7b54\u7591\u89e3\u60d1\u3002</p> <p>\u4e0e\u5176\u5728\u7fa4\u91cc\u9762\u63d0\u95ee\u77f3\u6c89\u5927\u6d77\uff0c\u4e0d\u5982\u6765\u661f\u7403\u6709\u95ee\u5fc5\u7b54\uff0c\u800c\u4e14\u8fd9\u4e2a\u4ef7\u683c\u8fd8\u662f\u7ba1\u4e00\u5e74\u7684\u54e6\uff0c\u4e00\u5e74\u7684\u65f6\u95f4\u53ef\u4ee5\u8bf4\u662f\u76f8\u5f53\u5212\u7b97\u4e86\u3002</p> <p>\u540c\u65f6\u661f\u7403\u5185\u975e\u5e38\u6b22\u8fce\u5927\u5bb6\u63d0\u95ee\uff0c\u5c24\u5176\u662f\u6211\u4e0d\u4f1a\u7684\u95ee\u9898\uff0c\u6211\u4f1a\u53bb\u627e\u4e1a\u5185\u597d\u670b\u53cb\u8bf7\u6559\uff0c\u65e2\u56de\u7b54\u4e86\u4f60\u7684\u95ee\u9898\u53c8\u5e2e\u52a9\u4e86\u6211\u63d0\u9ad8\u3002</p> <p>\u60f3\u8981\u52a0\u5165\u7684\u53ef\u4ee5\u901a\u8fc7\u626b\u5982\u4e0b\u4e8c\u7ef4\u7801\u8fdb\u661f\u7403\u54e6\uff0ciPhone \u7528\u6237\u5982\u679c\u4e0d\u80fd\u8bbf\u95ee\u5c0f\u7a0b\u5e8f\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u52a0\u6211\u5fae\u4fe1 ezglumes \u62c9\u4f60\u8fdb\u661f\u7403\u3002</p>","tags":["Player"]},{"location":"ffmpeg/planet-player-project/","title":"001 | \u64ad\u653e\u5668\u7cfb\u5217\u4e13\u680f-\u5173\u4e8e\u64ad\u653e\u5668\u9879\u76ee\u7684\u4e00\u4e2a\u5c0f\u5b9e\u8df5","text":"<p>\u4f17\u6240\u5468\u77e5\uff0c\u524d\u6bb5\u65f6\u95f4\u5f00\u901a\u4e86\u77e5\u8bc6\u661f\u7403\uff0c\u65e8\u5728\u4e3a\u97f3\u89c6\u9891\u7684\u5f00\u53d1\u548c\u5b66\u4e60\u63d0\u4f9b\u66f4\u4e13\u4e1a\u7684\u95ee\u7b54\u6c1b\u56f4\u3002</p> <p>\u540c\u65f6\u4e5f\u8003\u8651\u5728\u661f\u7403\u5185\u51fa\u4e00\u4e9b\u5e72\u8d27\u6559\u7a0b\uff0c\u56de\u9988\u5927\u5bb6\u7684\u4fe1\u4efb\uff0c\u4e00\u756a\u601d\u7d22\u4e4b\u540e\uff0c\u51b3\u5b9a\u5728\u661f\u7403\u5185\u51fa\u4e00\u4e2a**\u64ad\u653e\u5668\u7684\u9879\u76ee\u5b9e\u8df5**\u3002</p>","tags":["Player"]},{"location":"ffmpeg/planet-player-project/#_1","title":"\u4e3a\u4ec0\u4e48\u4f1a\u9009\u62e9\u505a\u64ad\u653e\u5668\u5462\uff1f","text":"<p>\u5728\u661f\u7403\u5185\u4e5f\u6709\u5f88\u591a\u670b\u53cb\u54a8\u8be2\u4ece\u4e8b\u97f3\u89c6\u9891\u5f00\u53d1\u8981\u5982\u4f55\u5165\u624b\uff1f\u5176\u5b9e\u97f3\u89c6\u9891\u5f00\u53d1\u6839\u636e\u4e1a\u52a1\u5f62\u6001\u7684\u4e0d\u540c\u4e5f\u4f1a\u6709\u4e0d\u540c\u7684\u4fa7\u91cd\u70b9\u3002</p> <p>\u6bd4\u5982\u6211\u505a\u77ed\u89c6\u9891 SDK \u7684\uff0c\u9a6c\u4e0a\u53bb\u505a\u7f51\u7edc\u901a\u8bdd\u7684\u4f18\u5316\uff0c\u4f30\u8ba1\u5c31\u8981\u88ab\u4f18\u5316\u4e86\u3002\u540c\u6837\uff0c\u505a\u97f3\u89c6\u9891\u7b97\u6cd5\u7684\u6765\u641e\u5de5\u7a0b\u642d\u5efa\u4e00\u65f6\u534a\u4f1a\u4e5f\u4e0d\u89c1\u5f97\u80fd\u641e\u5b9a\u3002</p> <p>\u5c3d\u7ba1\u5de5\u4f5c\u5185\u5bb9\u4e0d\u540c\uff0c\u4f46\u6211\u4eec\u90fd\u8fd8\u5c5e\u4e8e\u97f3\u89c6\u9891\u5f00\u53d1\u8303\u56f4\u5185\uff0c\u6240\u4ee5\u8bf4\u97f3\u89c6\u9891\u4e5f\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u65b9\u5411\u4e86\u3002</p> <p>\u800c\u6211\u4e2a\u4eba\u89c9\u5f97\u64ad\u653e\u5668\u4f1a\u662f\u97f3\u89c6\u9891\u5927\u65b9\u5411\u4e0b\u7684\u4e00\u4e2a\u5f88\u597d\u5165\u95e8\u5207\u5165\u70b9\u3002</p> <p>\u5173\u4e8e\u97f3\u89c6\u9891\u7684\u6982\u5ff5\u6709\u5f88\u591a\uff0c\u6bd4\u5982 I\u3001B\u3001P \u5e27\u3001\u5bb9\u5668\u683c\u5f0f\u3001H.264 \u7801\u6d41\u3001\u7f16\u89e3\u7801\u5668\u7b49\u7b49\uff0c\u8fd9\u4e9b\u6982\u5ff5\u90fd\u662f\u57fa\u7840\u5fc5\u987b\u77e5\u9053\u7684\uff0c\u4f46\u5982\u4f55\u5728\u9879\u76ee\u5b9e\u8df5\u4e2d\u53bb\u771f\u6b63\u8c03\u8bd5\u4f7f\u7528\u5b83\u5462\uff1f\u8bf4\u7684\u518d\u591a\u4e5f\u4e0d\u5982\u5b9e\u64cd\u4e00\u904d\u3002</p> <p>\u800c\u505a\u4e00\u4e2a\u64ad\u653e\u5668\u662f\u80fd\u591f\u5c06\u8fd9\u4e9b\u6982\u5ff5\u878d\u4f1a\u8d2f\u901a\u7684\uff0c\u5728\u89e3\u7801\u65f6\u53bb\u4f53\u9a8c\u6bcf\u4e00\u5e27\u7684\u4e0d\u540c\uff0c\u5728\u6e32\u67d3\u65f6\u53bb\u611f\u53d7 YUV \u7684\u683c\u5f0f\u5dee\u5f02\uff0c\u5728\u97f3\u89c6\u9891\u5bf9\u9f50\u65f6\u53bb\u9886\u609f\u97f3\u753b\u540c\u6b65\u7684\u771f\u8c1b\u3002</p> <p>\u8981\u5982\u4f55\u53bb\u505a\u4e00\u4e2a\u64ad\u653e\u5668\u5462\uff1f</p> <p>\u4e00\u4e2a\u64ad\u653e\u5668\u53ef\u4ee5\u5f88\u7b80\u5355\uff0c\u4e5f\u53ef\u4ee5\u5f88\u590d\u6742\uff0c\u4f46\u8fd9\u4e0d\u91cd\u8981\u3002</p> <p>\u505a\u64ad\u653e\u5668\u4e0d\u662f\u6211\u4eec\u7684\u76ee\u7684\uff0c\u6700\u7ec8\u662f\u4e3a\u4e86\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u638c\u63e1\u97f3\u89c6\u9891\u5f00\u53d1\u3001\u8c03\u8bd5\u7ecf\u9a8c\uff0c\u5e76\u4e14\u719f\u6089 C++\u3001FFmpeg \u7684\u7528\u6cd5\uff0c\u5efa\u7acb\u8d77\u7cfb\u7edf\u800c\u5b8c\u5584\u7684\u6982\u5ff5\u3002</p> <p>\u76ee\u524d\u6211\u5df2\u7ecf\u5b8c\u6210\u4e86\u6574\u4e2a\u9879\u76ee\u7684\u521d\u6b65\u642d\u5efa\uff0cGithub \u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://github.com/glumes/PlanetPlayer</p> <p>\u8bbe\u60f3\u6309\u7167\u5177\u4f53\u7684\u4e1a\u52a1\u5b9e\u9645\u6765\u5f00\u53d1\uff0c\u6838\u5fc3\u662f\u5f00\u53d1\u64ad\u653e\u5668 SDK \uff0c\u5bf9\u5916\u63d0\u4f9b SDK \u7684\u80fd\u529b\uff0c\u4e1a\u52a1\u5de5\u7a0b\u53bb\u4f9d\u8d56 SDK \uff0c\u8fd9\u5c31\u548c\u76ee\u524d\u7684\u77ed\u89c6\u9891 SDK \u5f00\u53d1\u63a5\u5165\u6d41\u7a0b\u4e00\u6837\u4e86\u3002</p> <p>\u7406\u60f3\u60c5\u51b5\u662f\u505a\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u64ad\u653e\u5668 SDK \uff0c\u56e0\u4e3a\u5199\u7684\u662f C++ \u4ee3\u7801\uff0c\u5929\u7136\u5c31\u6709\u8de8\u5e73\u53f0\u7684\u57fa\u56e0\u3002</p> <p>\u4f46\u524d\u671f\u7684\u8fd0\u884c\u90fd\u662f\u5728\u7535\u8111\u4e0a\u6d4b\u8bd5\u901a\u8fc7\u7684\uff0c\u5148\u4fdd\u8bc1\u81ea\u5df1\u7535\u8111\u4e0a\u7684\u64ad\u653e\u5668\u9879\u76ee\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff0c\u7136\u540e\u518d\u53bb\u505a\u79fb\u52a8\u7aef\u4e0a\u7684\u9002\u914d\u3002</p> <p>\u53e6\u5916\uff0c\u6574\u4e2a SDK \u8fd8\u5f15\u5165\u4e86 Google Test \u505a\u5355\u5143\u6d4b\u8bd5\uff0c\u4fdd\u8bc1\u6bcf\u4e2a\u63a5\u53e3\u90fd\u53ef\u4ee5\u6d4b\u8bd5\u901a\u8fc7\uff0c\u8fd9\u4e5f\u662f\u73b0\u4ee3\u8f6f\u4ef6\u5f00\u53d1\u6d41\u7a0b\u4e2d\u5fc5\u5907\u7684\u4e86\u3002\u800c\u4e14\u5173\u4e8e FFmpeg \u7684\u4e00\u4e9b\u77e5\u8bc6\u6280\u5de7\uff0c\u5728\u64ad\u653e\u5668\u7684\u6b63\u5f0f\u4ee3\u7801\u4e2d\u4e0d\u4e00\u5b9a\u9700\u8981\uff0c\u5c31\u53ef\u4ee5\u653e\u5230\u5355\u6d4b\u4e2d\u505a\u603b\u7ed3\u4e86\uff0c\u5b58\u50a8\u4e00\u4e9b\u4ee3\u7801\u4ee5\u540e\u7528\u5f97\u4e0a\u3002</p> <p>\u6574\u4e2a\u9879\u76ee\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u5939\u5185\u5bb9\u7684\u5177\u4f53\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ol> <li>\u4f9d\u8d56\u7b2c\u4e09\u65b9\u5e93\u4ee3\u7801\uff0c\u6bd4\u5982 FFmpeg \u7b49\uff0c\u76ee\u524d\u7528\u4e34\u65f6\u4ee3\u7801\u6a21\u62df\u9876\u66ff\u4e00\u4e0b\uff0c\u540e\u9762\u4f1a\u8bb2\u5982\u4f55\u63a5\u5165 FFmpeg\u3002</li> <li>Demo \u5de5\u7a0b\uff0c\u6f14\u793a\u5982\u4f55\u63a5\u5165 SDK \u7684\u5177\u4f53\u5de5\u7a0b\u4ee3\u7801\uff0c\u4e5f\u662f\u901a\u8fc7\u8fd9\u4e2a Demo \u5de5\u7a0b\u6765\u64ad\u653e\u89c6\u9891\u7684\u3002</li> <li>SDK \u7684\u63a5\u53e3\u5934\u6587\u4ef6\u4ee3\u7801\uff0c\u5bf9\u5916\u66b4\u9732 include \u91cc\u9762\u7684\u63a5\u53e3\u5c31\u884c\u4e86</li> <li>SDK \u7684\u5177\u4f53\u5b9e\u73b0\u4ee3\u7801\uff0c\u4e5f\u662f\u540e\u9762\u7684\u6838\u5fc3\u4ee3\u7801\u4e86</li> <li>\u5355\u6d4b\u76ee\u5f55\uff0cGoogle Test \u7684\u5355\u6d4b\u5185\u5bb9\u90fd\u5728\u8fd9\u91cc\u4e86\u3002</li> </ol> <p>\u540e\u7eed\u7684\u8fdb\u5c55</p> <p>\u76ee\u524d\u8fd8\u53ea\u662f\u5b8c\u6210\u4e86\u5de5\u7a0b\u7684\u642d\u5efa\uff0c \u5199\u4e86\u4e00\u4e22\u4e22\u7684\u4ee3\u7801\u3002</p> <p></p> <p>\u6211\u662f\u7528 CLion \u505a\u5f00\u53d1\u7684\uff0cIDE \u8fd8\u662f\u597d\u7528\u5f88\u591a\uff0c\u4f46\u7531\u4e8e\u5b83\u662f\u4ed8\u8d39\u7684\uff0c\u661f\u7403\u5185\u4e0d\u4e00\u5b9a\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u56e0\u6b64\u6211\u7279\u610f\u914d\u7f6e\u4e86\u4e00\u4e0b VSCode \u4e0a\u7684\u5f00\u53d1\u73af\u5883\uff0c\u6363\u9f13\u4e86 launch.json \u7684\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u4ee3\u7801\u4e86\uff0c\u4f46\u5efa\u8bae\u8fd8\u662f\u4f7f\u7528 CLion \u6765\u5f00\u53d1\uff0c\u6bd5\u7adf VSCode \u53ea\u662f\u4e00\u4e2a\u7f16\u8f91\u5668\uff0c\u548c\u5f3a\u5927\u7684 IDE \u6bd4\u8fd8\u662f\u5c11\u4e86\u4e0d\u5c11\u529f\u80fd\u3002</p> <p></p> <p>\u91cd\u70b9\uff1a</p> <p>\u8bf4\u4e86\u90a3\u4e48\u591a\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u91cd\u70b9\u90e8\u5206\u4e86\u3002</p> <p>\u5173\u4e8e\u64ad\u653e\u5668\u5b9e\u8df5\u7684\u4e13\u680f\uff0c\u540e\u7eed\u5927\u90e8\u5206\u8fdb\u5c55\u90fd\u4f1a\u653e\u5728\u77e5\u8bc6\u661f\u7403\u91cc\u9762\u4e86\uff0c\u5c24\u5176\u662f\u6e90\u7801\u4f1a\u5728\u661f\u7403\u5185\u540c\u6b65\u66f4\u65b0\uff0c\u5f53\u7136\u4e5f\u4f1a\u6311\u4e00\u4e9b\u5e72\u8d27\u5728\u516c\u4f17\u53f7\u540c\u6b65\u3002</p> <p>\u76ee\u524d \u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636\u77e5\u8bc6\u661f\u7403 \u8fd8\u5728\u8ba9\u5229\u4e2d\uff0c\u975e\u5e38\u4f4e\u7684\u4ef7\u683c\u5c31\u53ef\u4ee5\u83b7\u5f97\u4e1a\u5185\u4e00\u7ebf\u5f00\u53d1\u4eba\u5458\u7684\u7b54\u7591\u89e3\u60d1\u3002</p> <p>\u4e0e\u5176\u5728\u7fa4\u91cc\u9762\u63d0\u95ee\u77f3\u6c89\u5927\u6d77\uff0c\u4e0d\u5982\u6765\u661f\u7403\u6709\u95ee\u5fc5\u7b54\uff0c\u800c\u4e14\u8fd9\u4e2a\u4ef7\u683c\u8fd8\u662f\u7ba1\u4e00\u5e74\u7684\u54e6\uff0c\u4e00\u5e74\u7684\u65f6\u95f4\u53ef\u4ee5\u8bf4\u662f\u76f8\u5f53\u5212\u7b97\u4e86\u3002</p> <p>\u540c\u65f6\u661f\u7403\u5185\u975e\u5e38\u6b22\u8fce\u5927\u5bb6\u63d0\u95ee\uff0c\u5c24\u5176\u662f\u6211\u4e0d\u4f1a\u7684\u95ee\u9898\uff0c\u6211\u4f1a\u53bb\u627e\u4e1a\u5185\u597d\u670b\u53cb\u8bf7\u6559\uff0c\u65e2\u56de\u7b54\u4e86\u4f60\u7684\u95ee\u9898\u53c8\u5e2e\u52a9\u4e86\u6211\u63d0\u9ad8\u3002</p> <p>\u60f3\u8981\u52a0\u5165\u7684\u53ef\u4ee5\u901a\u8fc7\u626b\u5982\u4e0b\u4e8c\u7ef4\u7801\u8fdb\u661f\u7403\u54e6\uff0ciPhone \u7528\u6237\u5982\u679c\u4e0d\u80fd\u8bbf\u95ee\u5c0f\u7a0b\u5e8f\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u52a0\u6211\u5fae\u4fe1 ezglumes \u62c9\u4f60\u8fdb\u661f\u7403\u3002</p>","tags":["Player"]},{"location":"ffmpeg/understand-yuv-format/","title":"\u4e00\u6587\u8bfb\u61c2 YUV \u7684\u91c7\u6837\u4e0e\u683c\u5f0f","text":"<p>\u9632\u6b62\u56fe\u7247\u94fe\u63a5\u4e22\u5931\uff0c\u5efa\u8bae\u89c2\u770b\u5fae\u4fe1\u539f\u6587\uff0c\u83b7\u5f97\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1a</p> <p>\u4e00\u6587\u8bfb\u61c2 YUV \u7684\u91c7\u6837\u4e0e\u683c\u5f0f</p> <p>YUV \u662f\u4e00\u79cd\u989c\u8272\u7f16\u7801\u65b9\u6cd5\uff0c\u548c\u5b83\u7b49\u540c\u7684\u8fd8\u6709 RGB \u989c\u8272\u7f16\u7801\u65b9\u6cd5\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#rgb","title":"RGB \u989c\u8272\u7f16\u7801","text":"<p>RGB \u4e09\u4e2a\u5b57\u6bcd\u5206\u522b\u4ee3\u8868\u4e86 \u7ea2\uff08Red\uff09\u3001\u7eff\uff08Green\uff09\u3001\u84dd\uff08Blue\uff09\uff0c\u8fd9\u4e09\u79cd\u989c\u8272\u79f0\u4e3a \u4e09\u539f\u8272\uff0c\u5c06\u5b83\u4eec\u4ee5\u4e0d\u540c\u7684\u6bd4\u4f8b\u76f8\u52a0\uff0c\u53ef\u4ee5\u4ea7\u751f\u591a\u79cd\u591a\u6837\u7684\u989c\u8272\u3002</p> <p>\u5728\u56fe\u50cf\u663e\u793a\u4e2d\uff0c\u4e00\u5f20 1280 * 720 \u5927\u5c0f\u7684\u56fe\u7247\uff0c\u5c31\u4ee3\u8868\u7740\u5b83\u6709 1280 * 720 \u4e2a\u50cf\u7d20\u70b9\u3002\u5176\u4e2d\u6bcf\u4e00\u4e2a\u50cf\u7d20\u70b9\u7684\u989c\u8272\u663e\u793a\u90fd\u91c7\u7528 RGB \u7f16\u7801\u65b9\u6cd5\uff0c\u5c06 RGB \u5206\u522b\u53d6\u4e0d\u540c\u7684\u503c\uff0c\u5c31\u4f1a\u5c55\u793a\u4e0d\u540c\u7684\u989c\u8272\u3002</p> <p></p> <p>RGB \u56fe\u50cf\u4e2d\uff0c\u6bcf\u4e2a\u50cf\u7d20\u70b9\u90fd\u6709\u7ea2\u3001\u7eff\u3001\u84dd\u4e09\u4e2a\u539f\u8272\uff0c\u5176\u4e2d\u6bcf\u79cd\u539f\u8272\u90fd\u5360\u7528 8 bit\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u5b57\u8282\uff0c\u90a3\u4e48\u4e00\u4e2a\u50cf\u7d20\u70b9\u4e5f\u5c31\u5360\u7528 24 bit\uff0c\u4e5f\u5c31\u662f\u4e09\u4e2a\u5b57\u8282\u3002</p> <p>\u4e00\u5f20 1280 * 720 \u5927\u5c0f\u7684\u56fe\u7247\uff0c\u5c31\u5360\u7528 1280 * 720 * 3 / 1024 / 1024 = 2.63 MB \u5b58\u50a8\u7a7a\u95f4\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv","title":"YUV \u989c\u8272\u7f16\u7801","text":"<p>YUV \u989c\u8272\u7f16\u7801\u91c7\u7528\u7684\u662f \u660e\u4eae\u5ea6 \u548c \u8272\u5ea6 \u6765\u6307\u5b9a\u50cf\u7d20\u7684\u989c\u8272\u3002</p> <p>\u5176\u4e2d\uff0cY \u8868\u793a\u660e\u4eae\u5ea6\uff08Luminance\u3001Luma\uff09\uff0c\u800c U \u548c V \u8868\u793a\u8272\u5ea6\uff08Chrominance\u3001Chroma\uff09\u3002</p> <p>\u800c\u8272\u5ea6\u53c8\u5b9a\u4e49\u4e86\u989c\u8272\u7684\u4e24\u4e2a\u65b9\u9762\uff1a\u8272\u8c03\u548c\u9971\u548c\u5ea6\u3002</p> <p>\u4f7f\u7528 YUV \u989c\u8272\u7f16\u7801\u8868\u793a\u4e00\u5e45\u56fe\u50cf\uff0c\u5b83\u5e94\u8be5\u4e0b\u9762\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u548c RGB \u8868\u793a\u56fe\u50cf\u7c7b\u4f3c\uff0c\u6bcf\u4e2a\u50cf\u7d20\u70b9\u90fd\u5305\u542b Y\u3001U\u3001V \u5206\u91cf\u3002\u4f46\u662f\u5b83\u7684 Y \u548c UV \u5206\u91cf\u662f\u53ef\u4ee5\u5206\u79bb\u7684\uff0c\u5982\u679c\u6ca1\u6709 UV \u5206\u91cf\u4e00\u6837\u53ef\u4ee5\u663e\u793a\u5b8c\u6574\u7684\u56fe\u50cf\uff0c\u53ea\u4e0d\u8fc7\u662f\u9ed1\u767d\u7684\u3002</p> <p>\u5bf9\u4e8e YUV \u56fe\u50cf\u6765\u8bf4\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e2a\u50cf\u7d20\u70b9\u90fd\u9700\u8981\u5305\u542b\u4e86 Y\u3001U\u3001V \u4e09\u4e2a\u5206\u91cf\uff0c\u6839\u636e\u4e0d\u540c\u7684\u91c7\u6837\u683c\u5f0f\uff0c\u53ef\u4ee5\u6bcf\u4e2a Y \u5206\u91cf\u90fd\u5bf9\u5e94\u81ea\u5df1\u7684 UV \u5206\u91cf\uff0c\u4e5f\u53ef\u4ee5\u51e0\u4e2a Y \u5206\u91cf\u5171\u7528 UV \u5206\u91cf\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#rgb-yuv","title":"RGB \u5230 YUV \u7684\u8f6c\u6362","text":"<p>\u5bf9\u4e8e\u56fe\u50cf\u663e\u793a\u5668\u6765\u8bf4\uff0c\u5b83\u662f\u901a\u8fc7 RGB \u6a21\u578b\u6765\u663e\u793a\u56fe\u50cf\u7684\uff0c\u800c\u5728\u4f20\u8f93\u56fe\u50cf\u6570\u636e\u65f6\u53c8\u662f\u4f7f\u7528 YUV \u6a21\u578b\uff0c\u8fd9\u662f\u56e0\u4e3a YUV \u6a21\u578b\u53ef\u4ee5\u8282\u7701\u5e26\u5bbd\u3002\u56e0\u6b64\u5c31\u9700\u8981\u91c7\u96c6\u56fe\u50cf\u65f6\u5c06 RGB \u6a21\u578b\u8f6c\u6362\u5230 YUV \u6a21\u578b\uff0c\u663e\u793a\u65f6\u518d\u5c06 YUV \u6a21\u578b\u8f6c\u6362\u4e3a RGB \u6a21\u578b\u3002</p> <p>RGB \u5230 YUV \u7684\u8f6c\u6362\uff0c\u5c31\u662f\u5c06\u56fe\u50cf\u6240\u6709\u50cf\u7d20\u70b9\u7684 R\u3001G\u3001B \u5206\u91cf\u8f6c\u6362\u5230 Y\u3001U\u3001V \u5206\u91cf\u3002</p> <p>\u6709\u5982\u4e0b\u516c\u5f0f\u8fdb\u884c\u8f6c\u6362\uff1a</p> <p></p> <p> \u6b64\u65f6\u7684\u8f6c\u6362\u7ed3\u675f\u540e\uff0c\u6bcf\u4e2a\u50cf\u7d20\u70b9\u90fd\u6709\u5b8c\u6574\u7684 Y\u3001U\u3001V \u5206\u91cf\u3002\u800c\u4e4b\u524d\u63d0\u5230 Y \u548c UV \u5206\u91cf\u662f\u53ef\u4ee5\u5206\u79bb\u7684\uff0c\u63a5\u4e0b\u6765\u901a\u8fc7\u4e0d\u540c\u7684\u91c7\u6837\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5c06\u56fe\u50cf\u7684 Y\u3001U\u3001V \u5206\u91cf\u91cd\u65b0\u7ec4\u5408\u3002</p> <p>\u63a5\u4e0b\u6765\u7684\u4e0d\u540c\u91c7\u6837\u683c\u5f0f\u90fd\u662f\u5728\u4e00\u5f20\u56fe\u50cf\u6240\u6709\u50cf\u7d20\u7684 RGB \u8f6c\u6362\u5230 YUV \u57fa\u7840\u4e0a\u8fdb\u884c\u7684\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv_1","title":"YUV \u91c7\u6837\u683c\u5f0f","text":"<p>YUV \u56fe\u50cf\u7684\u4e3b\u6d41\u91c7\u6837\u65b9\u5f0f\u6709\u5982\u4e0b\u4e09\u79cd\uff1a</p> <ul> <li>YUV 4:4:4 \u91c7\u6837</li> <li>YUV 4:2:2 \u91c7\u6837</li> <li>YUV 4:2:0 \u91c7\u6837</li> </ul>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv-444","title":"YUV 4:4:4 \u91c7\u6837","text":"<p>YUV 4:4:4 \u91c7\u6837\uff0c\u610f\u5473\u7740 Y\u3001U\u3001V \u4e09\u4e2a\u5206\u91cf\u7684\u91c7\u6837\u6bd4\u4f8b\u76f8\u540c\uff0c\u56e0\u6b64\u5728\u751f\u6210\u7684\u56fe\u50cf\u91cc\uff0c\u6bcf\u4e2a\u50cf\u7d20\u7684\u4e09\u4e2a\u5206\u91cf\u4fe1\u606f\u5b8c\u6574\uff0c\u90fd\u662f 8 bit\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u5b57\u8282\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5176\u4e2d\uff0cY \u5206\u91cf\u7528\u53c9\u8868\u793a\uff0cUV \u5206\u91cf\u7528\u5706\u5708\u8868\u793a\u3002</p> <pre><code>\u4e3e\u4e2a\u4f8b\u5b50 \uff1a\n\n\u5047\u5982\u56fe\u50cf\u50cf\u7d20\u4e3a\uff1a[Y0 U0 V0]\u3001[Y1 U1 V1]\u3001[Y2 U2 V2]\u3001[Y3 U3 V3]\n\n\u90a3\u4e48\u91c7\u6837\u7684\u7801\u6d41\u4e3a\uff1aY0 U0 V0 Y1 U1 V1 Y2 U2 V2 Y3 U3 V3 \n\n\u6700\u540e\u6620\u5c04\u51fa\u7684\u50cf\u7d20\u70b9\u4f9d\u65e7\u4e3a [Y0 U0 V0]\u3001[Y1 U1 V1]\u3001[Y2 U2 V2]\u3001[Y3 U3 V3] \n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u79cd\u91c7\u6837\u65b9\u5f0f\u7684\u56fe\u50cf\u548c RGB \u989c\u8272\u6a21\u578b\u7684\u56fe\u50cf\u5927\u5c0f\u662f\u4e00\u6837\uff0c\u5e76\u6ca1\u6709\u8fbe\u5230\u8282\u7701\u5e26\u5bbd\u7684\u76ee\u7684\uff0c\u5f53\u5c06 RGB \u56fe\u50cf\u8f6c\u6362\u4e3a YUV \u56fe\u50cf\u65f6\uff0c\u4e5f\u662f\u5148\u8f6c\u6362\u4e3a YUV 4:4:4 \u91c7\u6837\u7684\u56fe\u50cf\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv-422","title":"YUV 4:2:2 \u91c7\u6837","text":"<p>YUV 4:2:2 \u91c7\u6837\uff0c\u610f\u5473\u7740 UV \u5206\u91cf\u662f Y \u5206\u91cf\u91c7\u6837\u7684\u4e00\u534a\uff0cY \u5206\u91cf\u548c UV \u5206\u91cf\u6309\u7167 2 : 1 \u7684\u6bd4\u4f8b\u91c7\u6837\u3002\u5982\u679c\u6c34\u5e73\u65b9\u5411\u6709 10 \u4e2a\u50cf\u7d20\u70b9\uff0c\u90a3\u4e48\u91c7\u6837\u4e86 10 \u4e2a Y \u5206\u91cf\uff0c\u800c\u53ea\u91c7\u6837\u4e86 5 \u4e2a UV \u5206\u91cf\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5176\u4e2d\uff0cY \u5206\u91cf\u7528\u53c9\u8868\u793a\uff0cUV \u5206\u91cf\u7528\u5706\u5708\u8868\u793a\u3002</p> <pre><code> \u4e3e\u4e2a\u4f8b\u5b50 \uff1a\n\n \u5047\u5982\u56fe\u50cf\u50cf\u7d20\u4e3a\uff1a[Y0 U0 V0]\u3001[Y1 U1 V1]\u3001[Y2 U2 V2]\u3001[Y3 U3 V3]\n\n \u90a3\u4e48\u91c7\u6837\u7684\u7801\u6d41\u4e3a\uff1aY0 U0 Y1 V1 Y2 U2 Y3 V3 \n\n \u5176\u4e2d\uff0c\u6bcf\u91c7\u6837\u8fc7\u4e00\u4e2a\u50cf\u7d20\u70b9\uff0c\u90fd\u4f1a\u91c7\u6837\u5176 Y \u5206\u91cf\uff0c\u800c U\u3001V \u5206\u91cf\u5c31\u4f1a\u95f4\u9694\u4e00\u4e2a\u91c7\u96c6\u4e00\u4e2a\u3002\n\n \u6700\u540e\u6620\u5c04\u51fa\u7684\u50cf\u7d20\u70b9\u4e3a [Y0 U0 V1]\u3001[Y1 U0 V1]\u3001[Y2 U2 V3]\u3001[Y3 U2 V3]\n</code></pre> <p>\u91c7\u6837\u7684\u7801\u6d41\u6620\u5c04\u4e3a\u50cf\u7d20\u70b9\uff0c\u8fd8\u662f\u8981\u6ee1\u8db3\u6bcf\u4e2a\u50cf\u7d20\u70b9\u6709 Y\u3001U\u3001V \u4e09\u4e2a\u5206\u91cf\u3002\u4f46\u662f\u53ef\u4ee5\u770b\u5230\uff0c\u7b2c\u4e00\u548c\u7b2c\u4e8c\u50cf\u7d20\u70b9\u516c\u7528\u4e86 U0\u3001V1 \u5206\u91cf\uff0c\u7b2c\u4e09\u548c\u7b2c\u56db\u4e2a\u50cf\u7d20\u70b9\u516c\u7528\u4e86 U2\u3001V3 \u5206\u91cf\uff0c\u8fd9\u6837\u5c31\u8282\u7701\u4e86\u56fe\u50cf\u7a7a\u95f4\u3002</p> <p>\u4e00\u5f20 1280 * 720 \u5927\u5c0f\u7684\u56fe\u7247\uff0c\u5728 YUV 4:2:2 \u91c7\u6837\u65f6\u7684\u5927\u5c0f\u4e3a\uff1a</p> <p>\uff081280 * 720 * 8 + 1280 * 720 * 0.5 * 8 * 2\uff09/ 8 / 1024 / 1024 = 1.76 MB \u3002</p> <p>\u53ef\u4ee5\u770b\u5230 YUV 4:2:2 \u91c7\u6837\u7684\u56fe\u50cf\u6bd4 RGB \u6a21\u578b\u56fe\u50cf\u8282\u7701\u4e86\u4e09\u5206\u4e4b\u4e00\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u5728\u4f20\u8f93\u65f6\u5360\u7528\u7684\u5e26\u5bbd\u4e5f\u4f1a\u968f\u4e4b\u51cf\u5c11\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv-420","title":"YUV 4:2:0 \u91c7\u6837","text":"<p>YUV 4:2:0 \u91c7\u6837\uff0c\u5e76\u4e0d\u662f\u6307\u53ea\u91c7\u6837 U \u5206\u91cf\u800c\u4e0d\u91c7\u6837 V \u5206\u91cf\u3002\u800c\u662f\u6307\uff0c\u5728\u6bcf\u4e00\u884c\u626b\u63cf\u65f6\uff0c\u53ea\u626b\u63cf\u4e00\u79cd\u8272\u5ea6\u5206\u91cf\uff08U \u6216\u8005 V\uff09\uff0c\u548c Y \u5206\u91cf\u6309\u7167 2 : 1 \u7684\u65b9\u5f0f\u91c7\u6837\u3002\u6bd4\u5982\uff0c\u7b2c\u4e00\u884c\u626b\u63cf\u65f6\uff0cYU \u6309\u7167 2 : 1 \u7684\u65b9\u5f0f\u91c7\u6837\uff0c\u90a3\u4e48\u7b2c\u4e8c\u884c\u626b\u63cf\u65f6\uff0cYV \u5206\u91cf\u6309\u7167 2:1 \u7684\u65b9\u5f0f\u91c7\u6837\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8272\u5ea6\u5206\u91cf\u6765\u8bf4\uff0c\u5b83\u7684\u6c34\u5e73\u65b9\u5411\u548c\u7ad6\u76f4\u65b9\u5411\u7684\u91c7\u6837\u548c Y \u5206\u91cf\u76f8\u6bd4\u90fd\u662f 2:1 \u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5176\u4e2d\uff0cY \u5206\u91cf\u7528\u53c9\u8868\u793a\uff0cUV \u5206\u91cf\u7528\u5706\u5708\u8868\u793a\u3002</p> <p>\u5047\u8bbe\u7b2c\u4e00\u884c\u626b\u63cf\u4e86 U \u5206\u91cf\uff0c\u7b2c\u4e8c\u884c\u626b\u63cf\u4e86 V \u5206\u91cf\uff0c\u90a3\u4e48\u9700\u8981\u626b\u63cf\u4e24\u884c\u624d\u80fd\u591f\u7ec4\u6210\u5b8c\u6574\u7684 UV \u5206\u91cf\u3002</p> <pre><code>\u4e3e\u4e2a\u4f8b\u5b50 \uff1a\n\n\u5047\u8bbe\u56fe\u50cf\u50cf\u7d20\u4e3a\uff1a\n\n[Y0 U0 V0]\u3001[Y1 U1 V1]\u3001 [Y2 U2 V2]\u3001 [Y3 U3 V3]\n[Y5 U5 V5]\u3001[Y6 U6 V6]\u3001 [Y7 U7 V7] \u3001[Y8 U8 V8]\n\n\u90a3\u4e48\u91c7\u6837\u7684\u7801\u6d41\u4e3a\uff1aY0 U0 Y1 Y2 U2 Y3 Y5 V5 Y6 Y7 V7 Y8\n\n\u5176\u4e2d\uff0c\u6bcf\u91c7\u6837\u8fc7\u4e00\u4e2a\u50cf\u7d20\u70b9\uff0c\u90fd\u4f1a\u91c7\u6837\u5176 Y \u5206\u91cf\uff0c\u800c U\u3001V \u5206\u91cf\u5c31\u4f1a\u95f4\u9694\u4e00\u884c\u6309\u7167 2 : 1 \u8fdb\u884c\u91c7\u6837\u3002\n\n\u6700\u540e\u6620\u5c04\u51fa\u7684\u50cf\u7d20\u70b9\u4e3a\uff1a\n\n[Y0 U0 V5]\u3001[Y1 U0 V5]\u3001[Y2 U2 V7]\u3001[Y3 U2 V7]\n[Y5 U0 V5]\u3001[Y6 U0 V5]\u3001[Y7 U2 V7]\u3001[Y8 U2 V7]\n</code></pre> <p>\u4ece\u6620\u5c04\u51fa\u7684\u50cf\u7d20\u70b9\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u56db\u4e2a Y \u5206\u91cf\u662f\u5171\u7528\u4e86\u4e00\u5957 UV \u5206\u91cf\uff0c\u800c\u4e14\u662f\u6309\u7167 2*2 \u7684\u5c0f\u65b9\u683c\u7684\u5f62\u5f0f\u5206\u5e03\u7684\uff0c\u76f8\u6bd4 YUV 4:2:2 \u91c7\u6837\u4e2d\u4e24\u4e2a Y \u5206\u91cf\u5171\u7528\u4e00\u5957 UV \u5206\u91cf\uff0c\u8fd9\u6837\u66f4\u80fd\u591f\u8282\u7701\u7a7a\u95f4\u3002</p> <p>\u4e00\u5f20 1280 * 720 \u5927\u5c0f\u7684\u56fe\u7247\uff0c\u5728 YUV 4:2:0 \u91c7\u6837\u65f6\u7684\u5927\u5c0f\u4e3a\uff1a</p> <p>\uff081280 * 720 * 8 + 1280 * 720 * 0.25 * 8 * 2\uff09/ 8 / 1024 / 1024 = 1.32 MB \u3002</p> <p>\u53ef\u4ee5\u770b\u5230 YUV 4:2:0 \u91c7\u6837\u7684\u56fe\u50cf\u6bd4 RGB \u6a21\u578b\u56fe\u50cf\u8282\u7701\u4e86\u4e00\u534a\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u56e0\u6b64\u5b83\u4e5f\u662f\u6bd4\u8f83\u4e3b\u6d41\u7684\u91c7\u6837\u65b9\u5f0f\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv_2","title":"YUV \u5b58\u50a8\u683c\u5f0f","text":"<p>\u8bf4\u5b8c\u4e86\u91c7\u6837\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u5982\u4f55\u628a\u91c7\u6837\u7684\u6570\u636e\u5b58\u50a8\u8d77\u6765\u3002</p> <p>YUV \u7684\u5b58\u50a8\u683c\u5f0f\uff0c\u6709\u4e24\u79cd\uff1a</p> <ul> <li>planar  \u5e73\u9762\u683c\u5f0f<ul> <li>\u6307\u5148\u8fde\u7eed\u5b58\u50a8\u6240\u6709\u50cf\u7d20\u70b9\u7684 Y \u5206\u91cf\uff0c\u7136\u540e\u5b58\u50a8 U \u5206\u91cf\uff0c\u6700\u540e\u662f V \u5206\u91cf\u3002</li> </ul> </li> <li>packed  \u6253\u5305\u6a21\u5f0f<ul> <li>\u6307\u6bcf\u4e2a\u50cf\u7d20\u70b9\u7684 Y\u3001U\u3001V \u5206\u91cf\u662f\u8fde\u7eed\u4ea4\u66ff\u5b58\u50a8\u7684\u3002</li> </ul> </li> </ul> <p>\u6839\u636e\u91c7\u6837\u65b9\u5f0f\u548c\u5b58\u50a8\u683c\u5f0f\u7684\u4e0d\u540c\uff0c\u5c31\u6709\u4e86\u591a\u79cd YUV \u683c\u5f0f\u3002\u8fd9\u4e9b\u683c\u5f0f\u4e3b\u8981\u662f\u57fa\u4e8e YUV 4:2:2 \u548c YUV 4:2:0 \u91c7\u6837\u3002</p> <p>\u5e38\u89c1\u7684\u57fa\u4e8e YUV 4:2:2 \u91c7\u6837\u7684\u683c\u5f0f\u5982\u4e0b\u8868\uff1a</p> YUV 4:2:2 \u91c7\u6837 YUYV \u683c\u5f0f UYVY \u683c\u5f0f YUV 422P \u683c\u5f0f <p>\u5e38\u89c1\u7684\u57fa\u4e8e YUV 4:2:0 \u91c7\u6837\u7684\u683c\u5f0f\u5982\u4e0b\u8868\uff1a</p> YUV 4:2:0 \u91c7\u6837 YUV 4:2:0 \u91c7\u6837 YUV 420P \u7c7b\u578b YV12 \u683c\u5f0f YU12 \u683c\u5f0f YUV 420SP \u7c7b\u578b NV12 \u683c\u5f0f NV21 \u683c\u5f0f <p>\u66f4\u591a\u7684 YUV \u683c\u5f0f\u4fe1\u606f\u53c2\u8003\u8fd9\u91cc\uff1aYUV pixel formats</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv-422_1","title":"\u57fa\u4e8e YUV 4:2:2  \u91c7\u6837\u7684\u683c\u5f0f","text":"<p>YUV 4:2:2 \u91c7\u6837\u89c4\u5b9a\u4e86 Y \u548c UV \u5206\u91cf\u6309\u7167 2: 1 \u7684\u6bd4\u4f8b\u91c7\u6837\uff0c\u4e24\u4e2a Y \u5206\u91cf\u516c\u7528\u4e00\u7ec4 UV \u5206\u91cf\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuyv","title":"YUYV \u683c\u5f0f","text":"<p>YUYV \u683c\u5f0f\u662f\u91c7\u7528\u6253\u5305\u683c\u5f0f\u8fdb\u884c\u5b58\u50a8\u7684\uff0c\u6307\u6bcf\u4e2a\u50cf\u7d20\u70b9\u90fd\u91c7\u7528 Y \u5206\u91cf\uff0c\u4f46\u662f\u6bcf\u9694\u4e00\u4e2a\u50cf\u7d20\u91c7\u6837\u5b83\u7684 UV \u5206\u91cf\uff0c\u6392\u5217\u987a\u5e8f\u5982\u4e0b\uff1a</p> <p>Y0 UO Y1 V0  Y2 U2 Y3 V2  </p> <p>Y0 \u548c Y1 \u516c\u7528 U0 V0 \u5206\u91cf\uff0cY2 \u548c Y3 \u516c\u7528 U2 V2 \u5206\u91cf....</p> <p></p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#uyvy","title":"UYVY \u683c\u5f0f","text":"<p>UYVY \u683c\u5f0f\u4e5f\u662f\u91c7\u7528\u6253\u5305\u683c\u5f0f\u8fdb\u884c\u5b58\u50a8\uff0c\u5b83\u7684\u987a\u5e8f\u548c YUYV \u76f8\u53cd\uff0c\u5148\u91c7\u7528 U \u5206\u91cf\u518d\u91c7\u6837 Y \u5206\u91cf\uff0c\u6392\u5217\u987a\u5e8f\u5982\u4e0b\uff1a</p> <p>U0 Y0 V0 Y1 U2 Y2 V2 Y3</p> <p>Y0 \u548c Y1 \u516c\u7528 U0 V0 \u5206\u91cf\uff0cY2 \u548c Y3 \u516c\u7528 U2 V2 \u5206\u91cf....</p> <p>\u6839\u636e UV \u548c Y \u7684\u987a\u5e8f\u8fd8\u6709\u5176\u4ed6\u683c\u5f0f\uff0c\u6bd4\u5982\uff0cYVYU \u683c\u5f0f\uff0cVYUY \u683c\u5f0f\u7b49\u7b49\uff0c\u539f\u7406\u5927\u81f4\u4e00\u6837\u4e86\u3002</p> <p></p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv-422p","title":"YUV 422P \u683c\u5f0f","text":"<p>YUV 422P \u683c\u5f0f\uff0c\u53c8\u53eb\u505a I422\uff0c\u91c7\u7528\u7684\u662f\u5e73\u9762\u683c\u5f0f\u8fdb\u884c\u5b58\u50a8\uff0c\u5148\u5b58\u50a8\u6240\u6709\u7684 Y \u5206\u91cf\uff0c\u518d\u5b58\u50a8\u6240\u6709\u7684 U \u5206\u91cf\uff0c\u518d\u5b58\u50a8\u6240\u6709\u7684 V \u5206\u91cf\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yuv-420_1","title":"\u57fa\u4e8e YUV 4:2:0  \u91c7\u6837\u7684\u683c\u5f0f","text":"<p>\u57fa\u4e8e YUV 4:2:0 \u91c7\u6837\u7684\u683c\u5f0f\u4e3b\u8981\u6709 YUV 420P \u548c YUV 420SP \u4e24\u79cd\u7c7b\u578b\uff0c\u6bcf\u4e2a\u7c7b\u578b\u53c8\u5bf9\u5e94\u5176\u4ed6\u5177\u4f53\u683c\u5f0f\u3002</p> <ul> <li>YUV 420P \u7c7b\u578b<ul> <li>YU12 \u683c\u5f0f</li> <li>YV12 \u683c\u5f0f</li> </ul> </li> <li>YUV 420SP \u7c7b\u578b<ul> <li>NV12 \u683c\u5f0f</li> <li>NV21 \u683c\u5f0f</li> </ul> </li> </ul> <p>YUV 420P \u548c YUV 420SP \u90fd\u662f\u57fa\u4e8e  Planar \u5e73\u9762\u6a21\u5f0f \u8fdb\u884c\u5b58\u50a8\u7684\uff0c\u5148\u5b58\u50a8\u6240\u6709\u7684 Y \u5206\u91cf\u540e\uff0c YUV420P \u7c7b\u578b\u5c31\u4f1a\u5148\u5b58\u50a8\u6240\u6709\u7684 U \u5206\u91cf\u6216\u8005 V \u5206\u91cf\uff0c\u800c YUV420SP \u5219\u662f\u6309\u7167 UV \u6216\u8005 VU \u7684\u4ea4\u66ff\u987a\u5e8f\u8fdb\u884c\u5b58\u50a8\u4e86\uff0c\u5177\u4f53\u67e5\u770b\u770b\u4e0b\u56fe\uff1a</p> <p>YUV420SP \u7684\u683c\u5f0f\uff1a</p> <p></p> <p>YUV420P \u7684\u683c\u5f0f\uff1a</p> <p></p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#yu12-yv12","title":"YU12 \u548c YV12 \u683c\u5f0f","text":"<p>YU12 \u548c YV12 \u683c\u5f0f\u90fd\u5c5e\u4e8e YUV 420P \u7c7b\u578b\uff0c\u5373\u5148\u5b58\u50a8 Y \u5206\u91cf\uff0c\u518d\u5b58\u50a8 U\u3001V \u5206\u91cf\uff0c\u533a\u522b\u5728\u4e8e\uff1aYU12 \u662f\u5148 Y \u518d U \u540e V\uff0c\u800c YV12 \u662f\u5148 Y \u518d V \u540e U \u3002</p> <p>YV 12 \u7684\u5b58\u50a8\u683c\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>YU 12 \u53c8\u79f0\u4f5c I420 \u683c\u5f0f\uff0c\u5b83\u7684\u5b58\u50a8\u683c\u5f0f\u5c31\u662f\u628a V \u548c U \u53cd\u8fc7\u6765\u4e86\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#nv12-nv21","title":"NV12 \u548c NV21 \u683c\u5f0f","text":"<p>NV12 \u548c NV21 \u683c\u5f0f\u90fd\u5c5e\u4e8e YUV420SP \u7c7b\u578b\u3002\u5b83\u4e5f\u662f\u5148\u5b58\u50a8\u4e86 Y \u5206\u91cf\uff0c\u4f46\u63a5\u4e0b\u6765\u5e76\u4e0d\u662f\u518d\u5b58\u50a8\u6240\u6709\u7684 U \u6216\u8005 V \u5206\u91cf\uff0c\u800c\u662f\u628a UV \u5206\u91cf\u4ea4\u66ff\u8fde\u7eed\u5b58\u50a8\u3002</p> <p>NV12 \u662f IOS \u4e2d\u6709\u7684\u6a21\u5f0f\uff0c\u5b83\u7684\u5b58\u50a8\u987a\u5e8f\u662f\u5148\u5b58 Y \u5206\u91cf\uff0c\u518d UV \u8fdb\u884c\u4ea4\u66ff\u5b58\u50a8\u3002</p> <p></p> <p>NV21 \u662f \u5b89\u5353 \u4e2d\u6709\u7684\u6a21\u5f0f\uff0c\u5b83\u7684\u5b58\u50a8\u987a\u5e8f\u662f\u5148\u5b58 Y \u5206\u91cf\uff0c\u5728 VU \u4ea4\u66ff\u5b58\u50a8\u3002</p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#_1","title":"\u5c0f\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u5173\u4e8e YUV \u7684\u77e5\u8bc6\u603b\u7ed3\uff0c\u4f60\u6709\u770b\u660e\u767d\u4e86\u561b\uff1f\u7528\u4e00\u5f20\u56fe\u4f5c\u4e3a\u603b\u7ed3\u5427~~</p> <p></p>","tags":["YUV","RGB"]},{"location":"ffmpeg/understand-yuv-format/#_2","title":"\u53c2\u8003","text":"<ol> <li>https://blog.csdn.net/grow_mature/article/details/9004548</li> <li>http://www.cnblogs.com/azraelly/archive/2013/01/01/2841269.html</li> <li>https://blog.csdn.net/MrJonathan/article/details/17718761</li> <li>https://blog.csdn.net/wudebao5220150/article/details/13295603</li> <li>https://msdn.microsoft.com/zh-cn/library/ms867704.aspx</li> <li>https://www.fourcc.org/yuv.php</li> </ol>","tags":["YUV","RGB"]},{"location":"ffmpeg/video-green-black-screen/","title":"\u5c06\u97f3\u89c6\u9891\u4e2d\u7684\u82b1\u5c4f\u3001\u7eff\u5c4f\u3001\u9ed1\u5c4f\u95ee\u9898\u4e00\u7f51\u6253\u5c3d","text":"<p>\u4eca\u5929\u7ee7\u7eed\u7ed9\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u77e5\u8bc6\u661f\u7403\u91cc\u9762\u7684\u5e72\u8d27\u3002</p> <p>\u521b\u5efa\u77e5\u8bc6\u661f\u7403\u5feb\u4e24\u4e2a\u6708\u4e86\uff0c\u76ee\u524d\u5df2\u7ecf\u79ef\u7d2f\u4e86\u4e0d\u5c11\u5e72\u8d27\uff0c\u4e3b\u8981\u5f97\u76ca\u4e8e\u661f\u7403\u91cc\u5927\u4f6c\u4eec\u7684\u5206\u4eab\u4ee5\u53ca\u5c0f\u4f19\u4f34\u7684\u63d0\u95ee\u3002</p> <p>\u661f\u7403\u91cc\u9762\u9080\u8bf7\u7684\u5927\u4f6c\u90fd\u662f\u5728\u5934\u6761\u3001\u5feb\u624b\u7b49\u77e5\u540d IT \u4f01\u4e1a\u4ece\u4e8b\u8fc7\u97f3\u89c6\u9891\u5f00\u53d1\u7684\uff0c\u5728\u4e13\u4e1a\u5ea6\u8fd9\u5757\u90a3\u662f\u76f8\u5f53\u6ca1\u95ee\u9898\uff0c\u800c\u4e14\u603b\u7ed3\u7684\u77e5\u8bc6\u4e5f\u975e\u5e38\u786c\u6838\u3002</p> <p>\u540c\u65f6\u5f97\u76ca\u4e8e\u5927\u5bb6\u7684\u5e7f\u6cdb\u63d0\u95ee\uff0c\u542f\u53d1\u7075\u611f\u6269\u5c55\u601d\u8def\uff0c\u628a\u65e5\u5e38\u5f00\u53d1\u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u90fd\u4e00\u5c42\u4e00\u5c42\u5265\u5f00\uff0c\u7531\u6d45\u5165\u6df1\uff0c\u6df1\u7a76\u5176\u80cc\u540e\u7684\u539f\u7406\u3002</p> <p>\u76ee\u524d\u77e5\u8bc6\u661f\u7403\u8fd8\u5728\u8ba9\u5229\u4e2d\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u767d\u83dc\u4ef7\u5373\u53ef\u52a0\u5165\uff0c\u6b22\u8fce\u4e00\u8d77\u4ea4\u6d41\u5b66\u4e60\uff01\uff01\uff01</p> <p>\u63a5\u4e0b\u6765\u7ed9\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u5173\u4e8e\u97f3\u89c6\u9891\u4e2d\u7684\u9ed1\u5c4f\u3001\u82b1\u5c4f\u3001\u7eff\u5c4f\u95ee\u9898\uff0c\u8fd9\u4e5f\u662f\u5404\u5927\u5fae\u4fe1\u7fa4\u91cc\u7ecf\u5e38\u95ee\u7684\u95ee\u9898\uff0c\u8fd9\u6b21\u4e89\u53d6\u5c06\u4ed6\u4eec\u4e00\u7f51\u6253\u5c3d\uff0c\u5f7b\u5e95\u89e3\u51b3\u4e86\u3002</p> <p>\u4ee5\u4e0b\u662f\u5206\u4eab\u539f\u6587\uff0c\u4f1a\u5e26\u4e0a\u6c34\u5370\uff0c\u4e3b\u8981\u662f\u9632\u6b62\u88ab\u65e0\u803b\u6284\u88ad\u4e86\uff0c\u661f\u7403\u5185\u7684\u670b\u53cb\u53ef\u4ee5\u5728 App \u770b\u9ad8\u6e05\u65e0\u6c34\u5370\u7248\u3002</p> <p></p> <p></p> <p></p> <p>\u4ee5\u4e0a\u5c31\u662f\u539f\u6587\u5185\u5bb9\uff0c\u5e0c\u671b\u5bf9\u4f60\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\u6709\u5e2e\u52a9\uff0c\u4e5f\u6b22\u8fce\u7559\u8a00\u56de\u590d\uff0c\u4ea4\u6d41\u8ba8\u8bba\uff01\uff01\uff01</p>","tags":["FFmpeg"]},{"location":"ffmpeg/video-render-rate-and-decode-rate/","title":"\u5173\u4e8e\u97f3\u89c6\u9891\u91cc\u9762\u7684\u89e3\u7801\u5e27\u7387\u548c\u6e32\u67d3\u5e27\u7387","text":"<p>\u5728\u77e5\u8bc6\u661f\u7403\u91cc\u9762\u6709\u4f4d PM \u540c\u5b66\uff0c\u54a8\u8be2\u5173\u4e8e\u97f3\u89c6\u9891\u91cc\u9762\u7684\u89e3\u7801\u5e27\u7387\u548c\u6e32\u67d3\u5e27\u7387\uff0c\u5173\u4e8e\u8fd9\u4e24\u4e2a\u6982\u5ff5\u5176\u5b9e\u633a\u7ed5\u7684\uff0c\u4e0d\u540c\u7684\u4eba\u53ef\u80fd\u8fd8\u6709\u4e0d\u540c\u7684\u770b\u6cd5\uff0c\u6240\u4ee5\u4e5f\u8ba9\u5927\u5bb6\u4e00\u8d77\u6765\u8bc4\u4f30\u4e00\u4e0b\u89e3\u8bfb\u662f\u5426\u6b63\u786e\uff01\uff01</p> <p>\u4ee5\u4e0b\u662f\u661f\u7403\u5185\u7684\u63d0\u95ee\uff1a</p> <p>\u5404\u4f4d\u5f00\u53d1\u5927\u4f6c\u597d\uff0c\u4e0d\u77e5\u9053\u6709\u6ca1\u6709\u540c\u5b66\u8ddf\u6211\u4e00\u6837\u662f PM\u5472\u7259\uff0c\u56e0\u4e3a\u4ece\u4e8b\u89c6\u9891\u4f1a\u8bae\u8fd9\u4e2a\u884c\u4e1a\uff0c\u5728\u6df1\u8015\u4e1a\u52a1\u7684\u540c\u65f6\uff0c\u5e0c\u671b\u5bf9\u5e95\u5c42\u6280\u672f\u6709\u66f4\u591a\u7684\u4e86\u89e3\u3002</p> <p>\u4eca\u5929\u60f3\u8bf7\u6559\u4e0b\uff0c\u4e00\u822c\u5bf9\u4e8e\u5b9e\u65f6\u97f3\u89c6\u9891\u4f1a\u8bae\u5382\u5546\u4f1a\u6709\u901a\u8bdd\u7edf\u8ba1\uff0c\u90a3\u6570\u636e\u4e2d\u5c55\u793a\u7684\u5e27\u7387\u662f\u89e3\u7801\u5e27\u7387\u8fd8\u662f\u6e32\u67d3\u5e27\u7387\u5462\uff1f\u4e24\u8005\u662f\u4e00\u6837\u7684\u561b\uff1f\u5982\u679c\u4e0d\u4e00\u6837\uff0c\u89e3\u7801\u5230\u6e32\u67d3\u4e4b\u95f4\u4f1a\u505a\u4e00\u4e9b\u8865\u507f\u561b</p> <p>\u4e0b\u9762\u662f\u661f\u7403\u5185\u5927\u4f6c\u7684\u56de\u590d\uff1a</p> <p></p> <p>\u4ee5\u4e0a\u5c31\u662f\u5173\u4e8e\u97f3\u89c6\u9891\u91cc\u9762\u7684\u89e3\u7801\u5e27\u7387\u548c\u6e32\u67d3\u5e27\u7387\u7684\u4e00\u4e9b\u89e3\u8bfb\uff0c\u4e0d\u77e5\u9053\u5728\u8bfb\u7684\u4f60\u6709\u4ec0\u4e48\u4e0d\u540c\u7684\u770b\u6cd5\u5417\uff1f\u6b22\u8fce\u7559\u8a00\u56de\u590d\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/video-seek-with-b-frame/","title":"Seek\u7b56\u7565\u4ee5\u53ca\u5728\u6709B\u5e27\u60c5\u51b5\u4e0b\u7684\u5904\u7406","text":"<p>\u6700\u8fd1\u5728\u505a Seek \u76f8\u5173\u529f\u80fd\u65f6\u9047\u5230\u7684\u95ee\u9898\u6392\u67e5\uff0c\u987a\u4fbf\u4e5f\u5b66\u5230\u4e86\u4e00\u4e9b\u65b0\u7684\u4e1c\u897f\uff0c\u548c\u5927\u5bb6\u5206\u4eab\u4e0b\u3002</p> <p>\u5728\u89c6\u9891\u64ad\u653e\u65f6\u6267\u884c Seek \u5230\u4efb\u610f\u70b9\u7684\u64cd\u4f5c\uff0c\u4e00\u822c\u90fd\u662f Seek \u5230\u4efb\u610f\u70b9\u5f80\u524d\u6700\u8fd1\u7684 I \u5e27\uff0c\u7136\u540e\u518d\u9010\u5e27\u89e3\u7801\u5230\u6307\u5b9a\u65f6\u95f4\u70b9\u3002</p> <p>\u8fd9\u91cc\u53ef\u4ee5\u4f18\u5316\uff0c\u5047\u8bbe\u5f53\u524d\u65f6\u95f4\u548c\u6307\u5b9a\u65f6\u95f4\u5728\u4e00\u4e2a GOP \u5185\uff0c\u5c31\u53ef\u4ee5\u4e0d\u7528 seek \uff0c\u76f4\u63a5\u987a\u5e8f\u5411\u4e0b\u89e3\u7801\u5c31\u597d\u3002</p> <p>\u800c\u6b63\u662f\u8fd9\u4e2a\u4f18\u5316\u51fa\u73b0\u4e86\u4e00\u70b9\u95ee\u9898\uff0c\u73b0\u8c61\u5982\u4e0b\uff1a</p> <p>\u5df2\u7ecf\u5224\u65ad\u64ad\u653e\u70b9 A \u548c Seek \u70b9 B \u4e0d\u5728\u4e00\u4e2a GOP \u5185\uff0c\u7136\u540e\u6267\u884c av_seek_frame \u65b9\u6cd5\u8fd8\u662f\u628a\u65f6\u95f4\u70b9 A \u6240\u5728 GOP \u5168\u90e8\u89e3\u7801\u4e86\uff0c\u5bfc\u81f4\u64ad\u653e\u4e0a\u51fa\u73b0\u4e86\u5361\u987f\u3002</p> <p>\u8fd9\u91cc\u5c31\u5f88\u5947\u602a\u4e86\uff0c\u660e\u660e\u5224\u65ad\u4e0d\u5728\u4e00\u4e2a GOP \uff0c\u90a3 Seek \u65f6\u5c31\u5e94\u8be5\u4ece\u65f6\u95f4\u70b9 B \u6240\u5728 GOP \u7684 I \u5e27\u5f00\u59cb\u89e3\u7801\uff0c \u4f46\u6267\u884c\u65f6\u8fd8\u662f\u89e3\u7801\u4e86\u4e0a\u4e00\u4e2a GOP \u7684\u5185\u5bb9\u3002</p> <p>\u5230\u5e95\u662f\u5224\u65ad\u662f\u5426\u540c\u4e00\u4e2a GOP \u7684\u51fd\u6570\u51fa\u95ee\u9898\u4e86\u8fd8\u662f Seek \u65b9\u6cd5\u6709\u95ee\u9898\u5462\uff1f</p> <p>\u5e26\u7740\u7591\u95ee\u5f00\u59cb\u6df1\u5165\u6e90\u7801\u63a2\u7d22\u3002</p> <p>FFmpeg \u6ca1\u6709\u76f4\u63a5\u63d0\u4f9b\u5224\u65ad\u4e24\u5e27\u662f\u5426\u540c\u4e00\u4e2a GOP \u7684\u65b9\u6cd5\uff0c\u6240\u4ee5\u901a\u8fc7 av_index_search_timestamp \u65b9\u6cd5\u5f97\u5230\u4f20\u5165\u65f6\u95f4\u70b9\u6700\u8fd1\u7684 I \u5e27\u7684 index \u7d22\u5f15\uff0c\u5982\u679c\u4e24\u4e2a\u65f6\u95f4\u70b9\u7684\u7d22\u5f15\u76f8\u540c\u5219\u8868\u793a\u4e3a\u540c\u4e00\u4e2a GOP \u5185\uff0c\u56e0\u4e3a\u6700\u8fd1\u7684 I \u5e27\u76f8\u540c\u3002</p> <p>\u7136\u800c av_index_search_timestamp \u65b9\u6cd5\u662f\u901a\u8fc7 AVIndexEntry \u4e2d\u7684 timestamp \u6765\u5224\u65ad\u7684\uff0c\u5b83\u662f\u4e00\u4e2a DTS \u503c\uff0c\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u5f97\u5230\u6700\u8fd1\u7684\u7d22\u5f15\u3002</p> <p>\u5728\u6ca1\u6709 B \u5e27\u7684\u60c5\u51b5\u4e0b\uff0cI \u5e27\u7684 PTS \u7b49\u4e8e DTS \uff0c\u6240\u4ee5\u5224\u65ad\u4e0d\u4f1a\u51fa\u95ee\u9898\u3002\u7136\u800c\u6b63\u662f\u6709\u4e86 B \u5e27\uff0c\u5982\u679c I \u5e27\u7684 PTS \u548c DTS \u4e0d\u76f8\u7b49\u7684\u8bdd\uff0c\u90a3\u4e48\u4e0a\u9762\u7684\u5224\u65ad\u76f8\u5f53\u4e8e\u662f\u62ff\u4e00\u4e2a PTS \u503c\u548c I \u5e27\u7684 DTS \u6bd4\u8f83\u662f\u5426\u540c\u4e00\u4e2a GOP \u4e86\u3002</p> <p>\u5982\u679c\u5c06\u9519\u5c31\u9519\uff0c\u5224\u65ad GOP \u65f6\u5f97\u5230\u7ed3\u8bba\u662f\u975e\u540c\u4e00\u4e2a GOP \uff0c\u90a3\u4e48 Seek \u4e5f\u5e94\u8be5\u662f\u975e\u540c\u4e00\u4e2a GOP \uff0c\u4f46\u73b0\u5b9e\u6070\u6070\u76f8\u53cd\uff0cSeek \u5f53\u505a\u4e86\u540c\u4e00\u4e2a GOP \uff0c\u8fd9\u91cc\u9762\u80af\u5b9a\u6709\u8ba1\u7b97\u51fa\u95ee\u9898\u4e86\uff0c\u7ee7\u7eed\u6df1\u5165\u6e90\u7801\u3002</p> <p>\u901a\u8fc7\u5728 mov.c \u6e90\u7801\u4e2d\u770b\u5230\u4e86\u5982\u4e0b\u7684\u64cd\u4f5c\uff1a</p> <pre><code>static int mov_seek_stream(AVFormatContext *s, AVStream *st, int64_t timestamp, int flags)\n{\n\u00a0 \u00a0 MOVStreamContext *sc = st-&gt;priv_data;\n\u00a0 \u00a0 FFStream *const sti = ffstream(st);\n\u00a0 \u00a0 int sample, time_sample, ret;\n\u00a0 \u00a0 unsigned int i;\n\u00a0 \u00a0 // Here we consider timestamp to be PTS, hence try to offset it so that we\n\u00a0 \u00a0 // can search over the DTS timeline.\n\u00a0 \u00a0 timestamp -= (sc-&gt;min_corrected_pts + sc-&gt;dts_shift);\n\u00a0 \u00a0 ret = mov_seek_fragment(s, st, timestamp);\n\u00a0 \u00a0 if (ret &lt; 0)\n\u00a0 \u00a0 \u00a0 \u00a0 return ret;\n\u00a0 \u00a0 sample = av_index_search_timestamp(st, timestamp, flags);\n    av_log(s, AV_LOG_TRACE, \"stream %d, timestamp %\"PRId64\", sample %d\\n\", st-&gt;index, timestamp, sample);\n    // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n</code></pre> <p>\u6ce8\u610f\u5230\u5982\u4e0b\u4e00\u884c\u4ee3\u7801\uff1a</p> <pre><code>timestamp -= (sc-&gt;min_corrected_pts + sc-&gt;dts_shift);\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u4f20\u5165\u7684\u65f6\u95f4\u90fd\u4f1a\u88ab\u51cf\u4e0a\u4e00\u4e2a\u503c\uff0c\u7136\u540e\u518d\u6267\u884c av_index_search_timestamp \u65b9\u6cd5\uff0c\u800c\u8fd9\u4e2a\u503c\u5bfc\u81f4\u5224\u65ad GOP \u548c Seek \u4e4b\u95f4\u7684\u5173\u952e\u5e27\u7d22\u5f15\u51fa\u95ee\u9898\u4e86\u3002</p> <p>\u6b63\u5982\u4ee3\u7801\u4e2d\u7684\u6ce8\u91ca\u6240\u793a\uff0c\u5047\u8bbe\u4f20\u5165\u7684\u65f6\u95f4\u662f PTS \u503c\uff0c\u7136\u540e\u7ed9\u5b83\u51cf\u53bb\u504f\u79fb\u4ee5\u5f97\u5230 DTS \u503c\uff0c\u56e0\u4e3a av_index_search_timestamp \u65b9\u6cd5\u5c31\u901a\u8fc7 DTS \u8fdb\u884c\u6bd4\u8f83\u7684\u561b\u3002</p> <p>\u51fa\u73b0\u95ee\u9898\u7684\u539f\u56e0\u5c31\u662f seek \u7684\u65f6\u95f4\u70b9\u6b63\u597d\u5728 I \u5e27\u7684 PTS \u548c DTS \u8303\u56f4\u4e4b\u95f4\u4e86\uff0c\u6267\u884c seek \u65f6\u51cf\u53bb\u504f\u5dee\u503c\u5c31\u5c0f\u4e8e DTS \u4e86\uff0c\u6240\u4ee5\u53d8\u6210\u4e86\u540c\u4e00\u4e2a GOP \u3002</p> <p>\u73b0\u5728\u8981\u89e3\u51b3\u95ee\u9898\u5c31\u662f\u5982\u4f55\u5f97\u5230 sc-&gt;min_corrected_pts + sc-&gt;dts_shif \u4e4b\u548c\uff0c\u7136\u540e\u5224\u65ad GOP \u65f6\u51cf\u53bb\u5b83\u4ee5\u4fee\u6b63\u5f97\u5230 DTS \u503c\u3002</p> <p>\u8fd8\u597d\u901a\u8fc7\u904d\u5386\u6e90\u7801\u53d1\u73b0\u5b83\u7684\u503c\u662f\u4e0d\u4f1a\u8fd0\u884c\u65f6\u6539\u53d8\u7684\uff0c\u4e00\u65e6\u51b3\u5b9a\u4e86\u5c31\u5b9a\u4e0b\u6765\u4e86\u3002\u53e6\u5916\u6211\u4eec\u53ef\u4ee5\u7528\u7b2c\u4e00\u4e2a I \u5e27\u7684 DTS \u503c\u4f5c\u4e3a\u504f\u79fb\u503c\u3002</p> <pre><code>  auto indexEntry = avStream-&gt;index_entries;\n  auto nbIndexEntry = avStream-&gt;nb_index_entries;\n  for (int i = 0; i &lt; nbIndexEntry; ++i) {\n    if (indexEntry[i].flags == AVINDEX_KEYFRAME) {\n      DTSOffset = indexEntry[i].timestamp;\n      return;\n    }\n  }\n</code></pre> <p>\u5982\u679c\u6ca1\u6709 B \u5e27\uff0cDTS \u503c\u4e3a 0 \uff0c\u6709 B \u5e27\uff0c\u90a3\u4e48\u9996\u5e27\u7684 DTS \u503c\u5c31\u53ef\u4ee5\u7528\u6765\u505a\u504f\u5dee\u503c\u8fdb\u884c\u8ba1\u7b97\u4e86\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/webrtc-and-ffmepg/","title":"\u5173\u4e8e\u76f4\u64ad\u3001WebRTC\u3001FFmpeg \u7684\u90a3\u4e9b\u4e8b","text":"<p>\u5728\u77e5\u8bc6\u661f\u7403\u4e2d\u6709\u4f4d\u540c\u5b66\u54a8\u8be2\u4e86\u5173\u4e8e\u76f4\u64ad\u3001webrtc\u3001FFmpeg\u7684\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u8fd9\u4e9b\u95ee\u9898\u90fd\u662f\u5927\u5bb6\u5e73\u65f6\u5173\u6ce8\u7684\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u8ba9\u5927\u5bb6\u5728\u4ece\u4e8b\u97f3\u89c6\u9891\u4e4b\u524d\u80fd\u5bf9\u76f8\u5173\u6982\u5ff5\u6709\u4e00\u4e2a\u6e05\u6670\u7684\u7406\u89e3\uff0c\u6b64\u524d\u5bf9\u8fd9\u4e9b\u95ee\u9898\u505a\u4e86\u7cfb\u7edf\u6027\u7684\u56de\u590d\uff0c\u8fd9\u4e9b\u7b54\u6848\u4e5f\u8bb8\u4f1a\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u4e5f\u7b97\u662f\u629b\u7816\u5f15\u7389\uff0c\u6b22\u8fce\u5927\u5bb6\u4e00\u8d77\u4ea4\u6d41\u3002</p> <p>\u4ee5\u4e0b\u662f\u661f\u7403\u5185\u7684\u63d0\u95ee\uff1a</p> <p>\u661f\u4e3b\u597d\uff0c\u672c\u4eba\u521d\u5b66\u8005\uff0c\u6709\u4e2a\u7591\u95ee\u60f3\u95ee\u4e0b\u3002</p> <p>\u76ee\u524d\u7684webRTC\uff0c\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5305\u62ec\u7f16\u89e3\u7801\u7b49\u6574\u4e2a\u6d41\u7a0b\u6846\u67b6\u3002\u6240\u4ee5\uff1a</p> <p>1\u3001\u9488\u5bf9\u5728\u5b9e\u65f6\u89c6\u9891\u901a\u8bdd/\u76f4\u64ad\u8fd9\u4e2a\u9886\u57df\uff0c\u662f\u5426FFmpeg\u5c31\u6ca1\u6709\u5b58\u5728\u7684\u5fc5\u8981\u4e86\uff0c\u662f\u5426webRTC\u5c31\u80fd\u5b8c\u5168\u6ee1\u8db3\uff1f</p> <p>2\u3001FFmpeg+rtmp\u6d41\uff0c\u8fd9\u4e2a\u5728\u4eca\u540e\uff0c\u8fd8\u4f1a\u6709\u5e94\u7528\u573a\u666f\u5417\uff1f</p> <p>3\u3001FFmpeg\u8fd8\u5728\u54ea\u4e9b\u9886\u57df\uff0c\u548c\u4f7f\u7528\u573a\u666f\u662f\u5176\u4ed6\u6280\u672f\u4e0d\u53ef\u66ff\u4ee3\u7684\uff1f</p> <p>\u4e0b\u9762\u662f\u6211\u7684\u7b54\u590d\uff1a</p> <p></p> <p>\u4ee5\u4e0a\u5c31\u662f\u539f\u6587\u5185\u5bb9\uff0c\u5e0c\u671b\u5bf9\u4f60\u89e3\u51b3\u6b64\u7c7b\u95ee\u9898\u6709\u5e2e\u52a9\uff0c\u4e5f\u6b22\u8fce\u7559\u8a00\u56de\u590d\uff0c\u4ea4\u6d41\u8ba8\u8bba\uff01\uff01\uff01</p>","tags":["FFmpeg"]},{"location":"ffmpeg/what-is-mp4-1/","title":"003 | \u64ad\u653e\u5668\u7cfb\u5217\u4e13\u680f-\u8ba4\u8bc6MP4\u89c6\u9891\uff08\u4e0a\uff09","text":"<p>\u5728\u5f00\u59cb\u64ad\u653e\u5668\u5b9e\u8df5\u4e4b\u524d\uff0c\u6211\u4eec\u8981\u5148\u77e5\u9053\u64ad\u653e\u7684\u5185\u5bb9\u662f\u4ec0\u4e48\uff1a\u8ba4\u8bc6\u4e00\u4e0b MP4 \u89c6\u9891\u3002</p> <p>\u6839\u636e\u7ef4\u57fa\u767e\u79d1\u7684\u4ecb\u7ecd\uff0cMP4 \u6216\u79f0 MPEG-4 \u7b2c14\u90e8\u5206\uff08\u82f1\u8bed\uff1aMPEG-4 Part 14\uff09\u662f\u4e00\u79cd\u6807\u51c6\u7684\u6570\u5b57\u591a\u5a92\u4f53\u5bb9\u5668\u683c\u5f0f\u3002</p> <p>MPEG-4 \u7b2c14\u90e8\u5206\u7684\u6269\u5c55\u540d\u4e3a.mp4\uff0c\u4ee5\u5b58\u50a8\u6570\u5b57\u97f3\u9891\u53ca\u6570\u5b57\u89c6\u9891\u4e3a\u4e3b\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5b58\u50a8\u5b57\u5e55\u548c\u9759\u6b62\u56fe\u50cf\u3002</p> <p>\u5b57\u9762\u610f\u601d\u5f88\u5bb9\u6613\u7406\u89e3\uff0cMP4 \u5176\u5b9e\u662f\u4e00\u79cd\u5bb9\u5668\uff0c\u53ef\u4ee5\u5b58\u97f3\u9891\u548c\u89c6\u9891\u5185\u5bb9\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u65e2\u7136\u8bf4 MP4 \u662f MPEG-4 \u7b2c14\u90e8\u5206\uff0c\u90a3\u5176\u4ed6\u90e8\u5206\u662f\u4ec0\u4e48\u5462\uff1f\u6709\u6ca1\u6709 MPEG \u7684 1\u30012\u30013 \u751a\u81f3 5\u30016\u30017 \u5462\uff1f</p>","tags":["Player"]},{"location":"ffmpeg/what-is-mp4-1/#mp4","title":"\u8fd9\u91cc\u5c31\u6d89\u53ca\u5230 MP4 \u6807\u51c6\u7684\u5236\u5b9a\u4e86\u3002","text":"<p>\u9996\u5148\u9700\u8981\u77e5\u9053\u56fd\u9645\u4e0a\u6709\u4e00\u4e2a\u7ec4\u7ec7\u53eb\u505a MEPG (Moving Picture Experts Group\uff0c\u52a8\u6001\u56fe\u50cf\u4e13\u5bb6\u7ec4)\u3002</p> <p>\u5b83\u662f ISO\uff08International Standardization Organization\uff0c\u56fd\u9645\u6807\u51c6\u5316\u7ec4\u7ec7\uff09\u4e0eIEC\uff08International Electrotechnical Commission\uff0c\u56fd\u9645\u7535\u5de5\u59d4\u5458\u4f1a\uff09\u4e8e1988\u5e74\u6210\u7acb\u7684\u4e13\u95e8\u9488\u5bf9\u8fd0\u52a8\u56fe\u50cf\u548c\u8bed\u97f3\u538b\u7f29\u5236\u5b9a\u56fd\u9645\u6807\u51c6\u7684\u7ec4\u7ec7\u3002 </p> <p>\u8fd9\u91cc\u7ec4\u7ec7\u540d\u5b57\u6bd4\u8f83\u591a\uff0c\u5c31\u4e0d\u8d58\u8ff0\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u53bb\u767e\u5ea6\u4e00\u4e0b\u3002</p> <p>\u5927\u610f\u5c31\u662f\u4e24\u4e2a\u5927\u7ec4\u7ec7 ISO \u548c IEC \u6210\u7acb\u4e86\u4e00\u4e2a\u5c0f\u7ec4\u7ec7 MEPG \u6765\u5236\u5b9a\u8fd0\u52a8\u56fe\u50cf\u548c\u8bed\u97f3\u538b\u7f29\u7684\u6807\u51c6\uff0c\u5176\u5b9e\u5c31\u662f\u5236\u5b9a\u89c6\u9891\u548c\u97f3\u9891\u65b9\u9762\u7684\u6807\u51c6\uff0c\u53ef\u80fd\u90a3\u4e2a\u5e74\u4ee3\u628a\u89c6\u9891\u53eb\u505a\u8fd0\u52a8\u56fe\u50cf\u5427\u3002</p> <p>\u800c MEPG \u7ec4\u7ec7\u7684\u4ea7\u51fa\u5c31\u662f\u4e00\u7cfb\u5217\u6807\u51c6\uff0c\u5e76\u4e14\u547d\u540d\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f MPEG-1 \u6807\u51c6\u3001MPEG-2 \u6807\u51c6\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <p>\u4e0d\u8fc7\uff0c\u8981\u6ce8\u610f MPEG \u6807\u51c6\u540e\u9762\u7684\u6570\u5b57\u53ef\u4e0d\u662f\u4f9d\u6b21\u9012\u589e\u7684\u54e6\uff0c\u6bd4\u5982 MPEG-3\u3001MPEG-5\u3001MPEG-6 \u5c31\u4e0d\u5b58\u5728\u7684\uff0c\u5c31\u597d\u6bd4 Windows \u7535\u8111\u76f4\u63a5\u4ece Win8 \u8df3\u5230 Win10 \uff0c\u4e5f\u6ca1\u6709 Win9 \u4e86\uff0c\u8fd9\u4e5f\u56de\u7b54\u4e86\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e2a\u6570\u5b57\u4ee3\u8868\u7684\u6807\u51c6\u90fd\u6709\u7684\u3002</p>","tags":["Player"]},{"location":"ffmpeg/what-is-mp4-1/#mp4-mpeg-4-14","title":"\u53e6\u5916\uff0c\u4e3a\u4ec0\u4e48\u8bf4 MP4 \u662f MPEG-4 \u7684\u7b2c14\u90e8\u5206\u5462\uff1f","text":"<p>\u56e0\u4e3a MPEG-4 \u6807\u51c6\u5f88\u5927\uff0c\u5305\u62ec\u4e86 27 \u4e2a\u90e8\u5206\uff0c\u8be6\u7ec6\u7684 27 \u4e2a\u90e8\u5206\u5185\u5bb9\u53ef\u4ee5\u5728\u7f51\u7edc\u4e0a\u641c\u7d22\u5230\uff0c\u8d34\u4e2a\u56fe\uff1a</p> <p></p> <p>\u6bd4\u5982\u5e38\u89c1\u7684 H.264 \u5c31\u662f MPEG-4 \u7b2c 10 \u90e8\u5206\uff0c\u6240\u4ee5\u4ecb\u7ecd H.264 \u7684\u65f6\u5019\u4e5f\u53ef\u4ee5\u8bf4\u662f MPEG-4 \u7b2c 10 \u90e8\u5206\u3002</p> <p>\u8fd9\u91cc\u9762\u7684\u6bcf\u4e2a\u90e8\u5206\u591a\u591a\u5c11\u5c11\u90fd\u5f71\u54cd\u7740\u6211\u4eec\u7684\u751f\u6d3b\u4e86\uff0c\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u6765\u8bf4\uff0c\u8fd8\u662f\u9700\u8981\u4e86\u89e3\u4e00\u4e9b\u5173\u952e\u90e8\u5206\u7684\u5185\u5bb9\u3002</p> <p>\u6211\u5df2\u7ecf\u628a MP4 \u76f8\u5173\u7684 MPEG-4 \u7b2c14 \u90e8\u5206\u6587\u6863\u4e0b\u8f7d\u597d\u4e86\uff0c\u6587\u4ef6\u4f1a\u540c\u6b65\u5230\u77e5\u8bc6\u661f\u7403\u91cc\u9762\uff0c\u6709\u9700\u8981\u7684\u53ef\u4ee5\u81ea\u884c\u4e0b\u8f7d\uff0c\u622a\u4e2a\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u6587\u6863\u5185\u5bb9\u4e0d\u591a\uff0c\u5c31\u5341\u51e0\u9875\uff0c\u4e3b\u8981\u5c31\u662f\u8bb2\u4e86 MP4 \u6587\u4ef6\u683c\u5f0f\u7684\u5b9a\u4e49\u548c\u76f8\u5173\u8bed\u6cd5\u3002</p> <p></p> <p>\u540e\u9762\u6211\u4eec\u4e5f\u4f1a\u53bb\u89e3\u8bfb\u4e00\u4e0b MP4 \u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u8fd9\u6b21\u5c31\u5148\u5230\u8fd9\u91cc\uff0c\u4e0b\u6b21\u89c1\u4e86\uff01\uff01\uff01</p>","tags":["Player"]},{"location":"ffmpeg/what-is-mp4-2/","title":"004 | \u64ad\u653e\u5668\u7cfb\u5217\u4e13\u680f-\u8ba4\u8bc6MP4\u89c6\u9891\uff08\u4e0b\uff09","text":"<p>\u5728\u524d\u6587\u4ecb\u7ecd\u4e86 MP4 \u6807\u51c6\u7684\u7f18\u6765\uff0c\u73b0\u5728\u8981\u8be6\u7ec6\u4e86\u89e3\u4e00\u4e0b\u5b83\u7684\u683c\u5f0f\u3002</p> <p>\u8fd8\u662f\u56de\u5230\u8fd9\u5f20\u56fe\uff1a</p> <p></p> <p>\u91cd\u70b9\u770b\u8fd9\u91cc\uff1a</p> <p>\u7b2c\u5341\u56db\u90e8\u5206\uff08ISO/IEC 14496-14\uff09\uff1aMPEG-4\uff08\u5373MP4\uff09\u6587\u4ef6\u683c\u5f0f\uff1a\u5b9a\u4e49\u57fa\u4e8e\u7b2c\u5341\u4e8c\u90e8\u5206\u7684\u7528\u4e8e\u5b58\u50a8MPEG-4\u5185\u5bb9\u7684\u89c6\u9891\u6587\u6863\u683c\u5f0f\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4 MP4 \u6587\u4ef6\u683c\u5f0f\u662f\u5b9a\u4e49\u5728 MPEG-4 \u7b2c 12 \u90e8\u5206\u57fa\u7840\u4e4b\u4e0a\u7684\uff0c\u800c\u7b2c 12 \u90e8\u5206\u7684\u5185\u5bb9\u63cf\u8ff0\u5982\u4e0b\uff1a</p> <p>\u7b2c\u5341\u4e8c\u90e8\u5206\uff08ISO/IEC 14496-12\uff09\uff1a\u57fa\u4e8eISO\u7684\u5a92\u4f53\u6587\u4ef6\u683c\u5f0f\uff1a\u5b9a\u4e49\u4e00\u4e2a\u5b58\u50a8\u5a92\u4f53\u5185\u5bb9\u7684\u6587\u4ef6\u683c\u5f0f\u3002</p> <p>\u6240\u4ee5\uff0c\u8981\u5b66\u4e60 MP4 \u6587\u4ef6\u683c\u5f0f\uff0c\u8981\u5148\u4e86\u89e3 \u7b2c 12 \u90e8\u5206\u7684\u5185\u5bb9\uff0c\u5173\u4e8e MPEG-4 \u7b2c 12 \u90e8\u5206\u7684\u6587\u6863\uff0c\u6211\u4e5f\u540c\u6b65\u653e\u5728\u77e5\u8bc6\u661f\u7403\u91cc\u9762\u4e86\uff0c\u6709\u9700\u8981\u7684\u53ef\u4ee5\u53bb\u4e0b\u8f7d\u3002</p> <p></p> <p>\u7f51\u4e0a\u5173\u4e8e MP4 \u6587\u4ef6\u683c\u5f0f\u7684\u6587\u7ae0\u5185\u5bb9\uff0c\u57fa\u672c\u90fd\u53ef\u4ee5\u5728\u7b2c 12 \u90e8\u5206\u4e2d\u627e\u5230\uff0c\u53ef\u4ee5\u8bf4\u5b83\u624d\u662f\u5b66\u4e60\u77e5\u8bc6\u7684\u6e90\u5934\uff0c\u5f53\u505a\u6559\u79d1\u4e66\u6765\u5b66\u80af\u5b9a\u6ca1\u95ee\u9898\u3002</p> <p>\u6709\u5b98\u65b9\u6587\u6863\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5c3d\u91cf\u6839\u636e\u6587\u6863\u6765\u5b66\u4e60\uff0c\u800c\u4e0d\u662f\u76f2\u76ee\u7684\u53c2\u8003\u7f51\u7edc\u535a\u5ba2\uff0c\u90a3\u6837\u5f97\u5230\u7684\u77e5\u8bc6\u4f53\u7cfb\u592a\u96f6\u6563\u4e86\u3002</p> <p></p>","tags":["Player"]},{"location":"ffmpeg/windows-compile-ffmpeg-with-libx264/","title":"Windows \u4e0b FFmpeg \u548c LibX264 \u7684\u7f16\u8bd1\u548c\u914d\u7f6e","text":"<p>\u5468\u672b\u5728\u5bb6\u6298\u817e Windows \u5e73\u53f0\u4e0b FFmepg \u548c LibX264 \u5e93\u7684\u7f16\u8bd1\uff0c\u957f\u671f\u4ee5\u6765\u90fd\u662f\u5728 Mac \u5e73\u53f0\u4e0b\u505a\u5f00\u53d1\uff0c\u5207\u6362\u5230 Windows \u5e73\u53f0\u4e0b\u8fd8\u662f\u8e29\u4e86\u4e0d\u5c11\u5751\u3002</p> <p>\u53c2\u8003\u4e86\u7f51\u4e0a\u5f88\u591a\u7f16\u8bd1\u6587\u7ae0\uff0c\u8d28\u91cf\u4e5f\u662f\u53c2\u5dee\u4e0d\u9f50\uff0c\u7248\u672c\u4e5f\u662f\u4e94\u82b1\u516b\u95e8\uff0c\u4f46\u5f52\u6839\u5230\u5e95\u8fd8\u662f Window \u4e0b\u7f16\u8bd1\u73af\u5883\u592a\u5751\u7239\u4e86\u3002</p> <p>\u7531\u4e8e Windows \u4e0a\u7684\u547d\u4ee4\u884c\u5de5\u5177\u4e0d\u597d\u7528\uff0c\u6240\u4ee5\u9700\u8981\u5b89\u88c5 MSYS \u6216\u8005 Cygwin \u8fd9\u6837\u7684\u8f6f\u4ef6\uff0c\u5b83\u4eec\u7684\u4f5c\u7528\u5c31\u662f\u6a21\u62df Linux \u73af\u5883\uff0c\u5176\u4e2d MSYS \u8fd8\u5206 1.0 \u548c 2.0 \u7248\u672c\uff0c\u6709\u7684\u535a\u5ba2\u6587\u7ae0\u6bd4\u8f83\u4e45\u8fdc\uff0c\u8fd8\u4f7f\u7528\u7684 1.0 \u7248\u672c\u4e86\u3002</p> <p>\u673a\u667a\u5730\u6ca1\u6709\u9009\u62e9\u8d70 Cygwin \u8fd9\u6761\u8def\u7ebf\uff0c\u8282\u7701\u4e86\u4e0d\u5c11\u65f6\u95f4\uff0c\u4f46\u8fd8\u662f\u8e29\u4e86 MSYS 1.0 \u7248\u672c\u7684\u5751\u3002</p> <p>\u5982\u679c\u4f60\u770b\u5230\u7684\u6587\u7ae0\u662f\u5b89\u88c5  MSYS 1.0 \u7248\u672c\uff0c\u5e76\u4e14\u8fd8\u9700\u8981\u989d\u5916\u5b89\u88c5 MinGW \u8f6f\u4ef6\uff0c\u90a3\u4e48\u8bf7\u9000\u51fa\u6765\uff0c\u91cd\u65b0\u627e\u4e2a MSYS 2.0 \u7248\u672c\u7684\u6587\u7ae0\u5427\uff0c\u8fd9\u6837\u8fd8\u80fd\u7ed5\u8fc7 MinGW \u5355\u72ec\u4e0b\u8f7d\u592a\u6162\u7684\u95ee\u9898\uff08\u522b\u95ee\u4e3a\u4ec0\u4e48\u6211\u77e5\u9053\uff0c\u4f60\u61c2\u7684\uff09\u3002</p> <p>\u4f7f\u7528 MSYS 2.0 \u7248\u672c\uff0c\u5c31\u4e0d\u9700\u8981\u989d\u5916\u5b89\u88c5 MinGW \u8f6f\u4ef6\u4e86\uff0c\u5b83\u63d0\u4f9b\u4e86 pacman \u8f6f\u4ef6\u7ba1\u7406\u5668\uff0c\u901a\u8fc7\u5b83\u6765\u5b89\u88c5\u4f9d\u8d56\u7684\u8f6f\u4ef6\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1ahttps://www.msys2.org/</p> <p>MSYS 2.0 \u5b89\u88c5\u8f6f\u4ef6\u7684\u65f6\u5019\uff0c\u5982\u679c\u7f51\u901f\u5f88\u6162\uff0c\u53ef\u4ee5\u8003\u8651\u66f4\u65b0\u955c\u50cf\u6e90\uff0c\u4f7f\u7528\u56fd\u5185\u7684\u6e90\u3002</p> <p>\u641e\u5b9a\u8f6f\u4ef6\u4e4b\u540e\uff0c\u5148\u7f16\u8bd1 libx264 \uff0c\u5728\u7f16\u8bd1 FFmpeg \u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/windows-compile-ffmpeg-with-libx264/#mingw-msvc","title":"MinGW \u548c MSVC \u7684\u4f5c\u7528","text":"<p>\u5728\u5b9e\u9645\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e5f\u662f\u7528\u4e0d\u4e0a MinGW \u7684\uff0c\u770b\u4e86\u4e00\u4e9b\u6587\u7ae0\u7528 MinGW \u6765\u7f16\u8bd1\uff0c\u6700\u540e\u7f16\u8bd1\u51fa\u6765\u7684\u9759\u6001\u5e93\u662f\u4e2a .a \u7684\u5f62\u5f0f\u3002</p> <p>\u4e00\u5f00\u59cb\u8fd8\u6ca1\u53cd\u5e94\u8fc7\u6765\uff0cWindows \u4e0b\u7684\u9759\u6001\u5e93\u4e0d\u662f .lib \u561b\uff0c\u76f4\u63a5\u7528 CMake \u53bb\u94fe\u63a5 .a \u5e93\u80af\u5b9a\u4e0d\u884c\u554a\u3002</p> <p>\u8fd8\u770b\u5230\u4e00\u4e9b\u6587\u7ae0\u8bf4\u5148\u628a .a \u5e93\u8f6c\u6210 .def \u6587\u4ef6\uff0c\u7136\u540e\u518d\u628a .def \u6587\u4ef6\u8f6c\u6210 .lib \u6587\u4ef6\uff0c\u751a\u81f3\u518d\u628a .lib \u6587\u4ef6\u8f6c\u6210 .dll \u7684\u52a8\u6001\u5e93\uff0c\u8fd9\u4e48\u6765\u56de\u6298\u817e\u4e00\u4e0b\u53c8\u662f\u5927\u5751\uff0c\u8fd8\u597d\u6ca1\u8df3\u8fdb\u53bb\u3002</p> <p>\u8f6c\u5ff5\u4e00\u60f3\uff0c\u6211\u8981\u7528 CLion \u5f00\u53d1\u5de5\u7a0b\uff0c\u7f16\u8f91\u5668\u76f4\u63a5\u7528 MSVC \u5c31\u597d\u4e86\uff0c\u4e5f\u7528\u4e0d\u4e0a gcc \u6765\u7f16\u8bd1\u4ee3\u7801\uff0c\u5e72\u561b\u7528 MinGW \u53bb\u7f16\u8bd1\u4e2a .a \u5e93\u5462\uff0c\u76f4\u63a5\u7f16\u8bd1\u51fa .lib \u4e0d\u597d\u561b\u3002</p> <p>\u77ac\u95f4\u601d\u8def\u5c31\u6253\u5f00\u4e86\uff0c\u8c03\u6574\u65b9\u5411\uff0c\u8c37\u6b4c\u76f4\u63a5\u641c\u7d22 compile ffmpeg with msvc \uff0c\u5f88\u5feb\u5c31\u627e\u5230\u4e86\u7b54\u6848\uff08\u8c37\u6b4c\u641c\u82f1\u6587\u4f1a\u8fc7\u6ee4\u6389\u5f88\u591a\u7f51\u4e0a\u5404\u79cd\u6284\u88ad\u590d\u5236\u7684\u65e0\u6548\u6587\u7ae0\uff09\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/windows-compile-ffmpeg-with-libx264/#libx264","title":"LibX264 \u7f16\u8bd1","text":"<p>\u9996\u5148\u4e0b\u8f7d\u597d LibX264 \u6e90\u7801\u3002</p> <p>\u7136\u540e\u5728\u5f00\u59cb\u83dc\u5355\u4e2d\u627e\u5230\u5e76\u6253\u5f00 x64 Native Tools Command Prompt for VS 2019 \uff1a</p> <p></p> <p>\u5728\u6253\u5f00\u7684\u547d\u4ee4\u884c\u7ec8\u7aef\u4e2d\uff0c\u8fdb\u5165\u5230 MSYS \u5b89\u88c5\u76ee\u5f55\uff0c\u6253\u5f00 msys2_shell.cmd \uff0c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <p></p> <p>\u6ce8\u610f\u540e\u7f00\u6709\u4e2a -use-full-path \u3002</p> <p>\u8fd9\u65f6\u4f1a\u6253\u5f00 MSYS \u7684\u65b0\u7a97\u53e3\uff0c\u5148\u628a\u4e00\u4e9b\u6c47\u7f16\u4f9d\u8d56\u5b89\u88c5\u597d\uff1a</p> <pre><code>pacman -Syu\npacman -S make\npacman -S diffutils\npacman -S yasm\npacman -S nasm\n</code></pre> <p>\u7136\u540e\uff0c\u5728\u8be5\u7a97\u53e3\u4e2d\u8fdb\u5165\u5230 LibX264 \u7684\u6e90\u7801\u76ee\u5f55\u4e0b\uff0c\u628a\u5982\u4e0b\u4ee3\u7801\u4fdd\u5b58\u6210 .sh \u6587\u4ef6\u5e76\u6267\u884c\uff1a</p> <pre><code>OPTIONS=\"--enable-shared\"\n\nCC=cl ./configure $OPTIONS --enable-shared --prefix=$BUILD_DIR/\n\nmake -j 16\nmake install\nmake clean\n</code></pre> <p>\u6267\u884c\u540e\u5c31\u5f00\u59cb\u7f16\u8bd1\u4e86\uff0c\u6ce8\u610f configure \u547d\u4ee4\u524d\u7f00\u6709\u4e2a CC=cl \uff0c\u4ee3\u8868\u4f7f\u7528 MSVC \u6765\u7f16\u8bd1\u4e86\u3002</p> <p>\u7f16\u8bd1\u540e\u5185\u5bb9\u5982\u4e0b\uff1a</p> <p></p> <p>\u5c06\u7f16\u8bd1\u540e\u7684 libx264.dll.lib \u6539\u6210 libx264.lib\uff0c\u8fd9\u5c31\u662f\u9759\u6001\u5e93\u4e86\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/windows-compile-ffmpeg-with-libx264/#ffmpeg","title":"FFmpeg \u7f16\u8bd1","text":"<p>\u7ee7\u7eed\u5728 MSYS 2.0 \u7a97\u53e3\u4e2d\u8fdb\u5165\u5230\u4e0b\u8f7d\u597d FFmpeg \u7684\u6e90\u7801\u76ee\u5f55\uff0c\u5c06\u5982\u4e0b\u4ee3\u7801\u4fdd\u5b58\u6210 .sh \u6587\u4ef6\u5e76\u6267\u884c\uff1a</p> <pre><code>OPTIONS=\"--toolchain=msvc \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--arch=x86_64 \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--enable-yasm \u00a0\\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--enable-asm \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--enable-shared \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--disable-static \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--disable-programs \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--enable-swresample \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--enable-swscale \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--enable-libx264 \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0--enable-gpl \\\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0\"\nX264_INCLUDE=$libx264_path/include\nX264_LIB=$libx264_path/lib\n\nCC=cl ./configure $OPTIONS --extra-cflags=\"-I$X264_INCLUDE\" --extra-ldflags=\"-LIBPATH:$X264_LIB\" --prefix=$BUILD_DIR/\nmake -j 16\nmake install\nmake clean\n</code></pre> <p>\u8981\u5c06\u4ee3\u7801\u4e2d\u7684 libx264_path \u8def\u5f84\u6539\u6210\u4e0a\u9762\u7f16\u8bd1\u7684 libx264 \u8def\u5f84\uff0cFFmpeg \u7684\u7f16\u8bd1\u9700\u8981\u4f9d\u8d56 libx264 \u7684\u5e93\u3002</p> <p>\u4e00\u756a\u7b49\u5f85\u540e\uff0c\u5c31\u7f16\u8bd1\u51fa\u4e86\u52a8\u6001\u5e93\uff1a</p> <p></p>","tags":["FFmpeg"]},{"location":"ffmpeg/windows-compile-ffmpeg-with-libx264/#cmake-ffmpeg-libx264","title":"CMake \u4f9d\u8d56 FFmpeg \u548c LibX264","text":"<p>\u6700\u540e\u5c31\u662f\u5728 Clion \u4e2d\u4f7f\u7528 CMake \u53bb\u4f9d\u8d56 FFmpeg \u548c LibX264 \u4e86\u3002</p> <p>\u5b9a\u4e49\u4e86\u4e24\u4e2a\u5b8f\u51fd\u6570\u53bb\u94fe\u63a5\u5934\u6587\u4ef6\u548c\u5e93\u7684\u76ee\u5f55\uff1a</p> <pre><code>macro(link_ffmpeg)\n\u00a0 \u00a0 include_directories(${ffmpeg}/${platform}/${arch}/include)\n\u00a0 \u00a0 link_directories(${ffmpeg}/${platform}/${arch}/bin)\nendmacro()\n\nmacro(link_libx264)\n\u00a0 \u00a0 include_directories(${libx264}/${platform}/${arch}/include)\n\u00a0 \u00a0 link_directories(${libx264}/${platform}/${arch}/lib)\nendmacro()\n</code></pre> <p>\u6ce8\u610f\uff0cFFmpeg \u94fe\u63a5\u5e93\u7528\u7684\u662f bin \u76ee\u5f55\u4e0b\u7684\uff0clibx264 \u7528\u7684\u662f lib \u76ee\u5f55\u4e0b\u7684\u3002</p> <p>\u5728\u6700\u540e\u8fd9\u4e00\u6b65\u53cd\u800c\u5361\u4e3b\u4e86\uff1a</p> <pre><code>target_link_libraries(demo libx264 avcodec avformat)\n</code></pre> <p>\u8981\u4e48\u63d0\u793a\u627e\u4e0d\u5230 libx264\uff0c\u8981\u4e48\u627e\u4e0d\u5230 avcodec-59\uff0c\u8fd9\u4e2a\u65f6\u5019\u8fd8\u9700**\u628a ffmpeg \u7f16\u8bd1\u7ed3\u679c\u7684 bin \u76ee\u5f55\u6dfb\u52a0\u5230\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u4e2d**\uff0c\u4e3a\u4e86\u4fdd\u9669\u8d77\u89c1\uff0c\u628a libx264 \u7684 bin \u76ee\u5f55\u4e5f\u6dfb\u52a0\u4e86\u3002</p> <p>\u52a0\u5b8c\u4e4b\u540e\uff0c\u8dd1\u4e00\u6bb5\u4ee3\u7801\u6d4b\u8bd5\u4e00\u4e0b\uff1a</p> <pre><code>#include &lt;iostream&gt;\n\nextern \"C\"{\n#include \"libavformat/avformat.h\"\n#include \"libavcodec/avcodec.h\"\n#include \"x264.h\"\n}\n\nint main() {\n\u00a0 \u00a0 x264_param_t param;\n\u00a0 \u00a0 x264_param_default(&amp;param);\n\u00a0 \u00a0 auto codec = avcodec_find_encoder(AV_CODEC_ID_H264);\n\u00a0 \u00a0 if (codec){\n\u00a0 \u00a0 \u00a0 \u00a0 std::cout &lt;&lt; \"success!!!\" &lt;&lt; std::endl;\n\u00a0 \u00a0 }\n\u00a0 \u00a0 return 0;\n}\n</code></pre> <p>\u679c\u7136\u5c31\u6210\u529f\u4e86\uff0c\u8fd9\u4e0b\u53ef\u4ee5\u5728 Windows \u4e0a\u5f00\u53d1\u5b66\u4e60 FFmpeg \u4e86\u3002</p>","tags":["FFmpeg"]},{"location":"ffmpeg/windows-compile-ffmpeg-with-libx264/#_1","title":"\u53c2\u8003","text":"<ol> <li>https://www.cnblogs.com/wswind/p/10650126.html</li> <li>https://blog.csdn.net/qq_18453581/article/details/120005712</li> <li>https://www.roxlu.com/2016/057/compiling-x264-on-windows-with-msvc</li> <li>https://www.roxlu.com/2019/062/compiling-ffmpeg-with-x264-on-windows-10-using-msvc</li> </ol>","tags":["FFmpeg"]},{"location":"ffmpeg/windows-mp4-info/","title":"005 | \u64ad\u653e\u5668\u7cfb\u5217\u4e13\u680f-\u5728 Windows \u4e0a\u67e5\u770b MP4 \u683c\u5f0f\u4fe1\u606f","text":"<p>\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\u6211\u4eec\u5df2\u7ecf\u8ba4\u8bc6\u4e86 MP4 \u89c6\u9891\uff0c\u77e5\u9053\u4e86\u5b83\u662f\u97f3\u9891\u548c\u89c6\u9891\u7684\u5bb9\u5668\uff0c\u5e76\u4e14\u7531\u4e00\u7cfb\u5217 Box \u7ec4\u6210\u3002</p> <p>\u5728\u524d\u6587\u7684\u9644\u4ef6\u4e2d\uff0c\u6211\u4eec\u4e5f\u7ed9\u51fa\u4e86\u5bf9\u5e94\u7684\u8d44\u6599\uff0c\u5305\u62ec MP4 \u683c\u5f0f\u7684\u5b98\u65b9\u5b9a\u4e49\u4ee5\u53ca\u5404\u79cd Box \u7c7b\u578b\u7684\u63cf\u8ff0\u3002</p> <p>\u4f46\u662f\u7eb8\u4e0a\u5f97\u6765\u7ec8\u89c9\u6d45\uff0c\u7edd\u77e5\u6b64\u4e8b\u8981\u8eac\u884c\uff0c\u5149\u662f\u7406\u8bba\u4e0a\u77e5\u9053\u4e86\u8fd8\u4e0d\u884c\uff0c\u9700\u8981\u4eb2\u81ea\u5b9e\u8df5\u52a0\u6df1\u5370\u8c61\u3002</p> <p>\u8fd9\u6b21\u4f1a\u5728 Windows \u5e73\u53f0\u4e0a\u7528\u5de5\u5177\u89e3\u6790\u67e5\u770b MP4 \u683c\u5f0f\u4fe1\u606f\uff0c\u63a8\u8350\u7684\u5de5\u5177\u5c31\u662f Mp4 Explorer\u3002</p> <p>Mp4 Explorer \u7684\u4e0b\u8f7d\u5730\u5740\u5982\u4e0b\uff0c\u76ee\u524d\u53ea\u6709 Windows \u5e73\u53f0\u63d0\u4f9b\u4e0b\u8f7d\u3002</p> <p>https://mp4-explorer.apponic.com/</p> <p></p> <p>Mp4 Explorer \u5b89\u88c5\u540e\u6253\u5f00\u7684\u754c\u9762\u4e5f\u5f88\u7b80\u5355\uff0c\u6ca1\u5565\u82b1\u54e8\u529f\u80fd\uff0c\u5c31\u5355\u7eaf\u5730\u89e3\u6790 MP4 \u3002</p> <p></p> <p>\u9009\u53d6\u89c6\u9891\uff0c\u76f4\u63a5\u6253\u5f00\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u754c\u9762\uff0c\u5de6\u4fa7\u5c31\u662f Box \u7c7b\u578b\uff0c\u53f3\u4fa7\u5c31\u662f\u5bf9\u5e94\u4fe1\u606f\u3002</p> <p></p> <p>\u5de6\u4fa7 Box \u7684\u5c42\u7ea7\u7ed3\u6784\u5c31\u548c\u4e4b\u524d\u6587\u7ae0\u63cf\u8ff0\u4e00\u6837\uff0cBox \u662f\u7531 Header \u548c Data \u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u800c Data \u53ef\u4ee5\u662f\u5355\u7eaf\u7684\u6570\u636e\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u7684\u5b50 Box \uff0c\u6b64\u65f6\u8fd9\u79cd Box \u53c8\u53eb\u505a Container Box \u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0cmoov\u3001track\u3001edts\u3001mdia \u90fd\u662f Container Box \u3002</p> <p>\u5de6\u4fa7\u7684\u6574\u4f53\u7ed3\u6784\u548c MPEG-4 \u7b2c 12 \u90e8\u5206\u6587\u6863\u63cf\u8ff0\u7684\u5927\u81f4\u76f8\u540c\uff1a</p> <p></p> <p>\u4e00\u4e2a MP4 Box \u5c42\u7ea7\u5927\u81f4\u7684\u7ed3\u6784\u90fd\u662f\u8fd9\u6837\uff1a</p> <pre><code>ftyp\nmoov\n    mvhd\n    trak\n        tkhd\n        mdia\n    trak\n        tkhd\n        mdia\nmdat\n</code></pre> <p>\u5f53\u7136\uff0c\u4e0d\u662f\u6240\u6709\u7684 Box \u7c7b\u578b\u90fd\u4f1a\u51fa\u73b0\u5728\u540c\u4e00\u4e2a MP4 \u89c6\u9891\u4e0a\u7684\uff0c\u6709\u4e9b\u4e0d\u91cd\u8981\u7684 Box \u7c7b\u578b\u53ef\u4ee5\u7701\u7565\uff0c\u6211\u4eec\u53ea\u8981\u77e5\u9053\u90a3\u4e9b\u5e38\u89c1\u7684 Box \u5c31\u597d\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u5de5\u5177\u89e3\u6790\u4e5f\u4f1a\u5b58\u5728\u4e00\u4e9b\u8bef\u5dee\uff0c\u6709\u65f6\u5019\u53d1\u73b0 MP4 Box \u7c7b\u578b\u6216\u8005\u6570\u636e\u5bf9\u4e0d\u4e0a\u4e86\uff0c\u4e5f\u4e0d\u80fd\u5168\u5355\u9760\u4e00\u4e2a\u5de5\u5177\uff0c\u53ef\u4ee5\u591a\u4e2a\u5de5\u5177\u9a8c\u8bc1 MP4 \u4fe1\u606f\u6216\u8005\u624b\u52a8\u89e3\u6790\u3002</p> <p>\u9664\u4e86 Mp4 Explorer \u4e4b\u5916\uff0c\u4e5f\u8fd8\u6709\u5176\u4ed6\u5de5\u5177\u53ef\u4ee5\u67e5\u770b\u89e3\u6790 MP4 Box \u6570\u636e\uff0c\u8fd9\u91cc\u5c31\u4e0d\u505a\u6f14\u793a\u4e86\uff0c\u4e3b\u8981\u662f\u8ba9\u5927\u5bb6\u5bf9 Box \u6709\u4e00\u4e2a\u66f4\u76f4\u89c2\u7684\u611f\u53d7\u3002</p> <p>\u5173\u4e8e\u6bcf\u4e2a Box \u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff0c\u5982\u4f55\u53bb\u89e3\u6790\uff0c\u6211\u4eec\u540e\u9762\u7ee7\u7eed\u8bb2\u89e3\uff0c\u5230\u65f6\u5019\u8fd8\u4f1a\u518d\u6765\u4f7f\u7528\u8fd9\u4e2a\u8f6f\u4ef6\u7684\u3002</p>","tags":["Player"]},{"location":"home/about/","title":"this is about","text":""},{"location":"opengl/01-what-is-render-engine/","title":"\u4ece\u96f6\u6253\u9020\u6e32\u67d3\u5f15\u64ce\u7cfb\u521701-\u4ec0\u4e48\u662f\u6e32\u67d3\u5f15\u64ce","text":"<p>\u524d\u60c5\u56de\u987e\uff1a2021 \u6280\u672f\u65b0\u756a - \u4ece\u96f6\u6253\u9020\u6e32\u67d3\u5f15\u64ce\u7cfb\u5217</p> <p>\u5728\u5f00\u59cb\u5199\u4ee3\u7801\u4e4b\u524d\uff0c\u8981\u5148\u660e\u786e\u6e32\u67d3\u5f15\u64ce\u5230\u5e95\u662f\u4ec0\u4e48\u4e1c\u897f\uff0c\u624d\u80fd\u77e5\u9053\u8981\u5199\u4ec0\u4e48\u4e1c\u897f\u3002</p> <p>\u5728 Google \u91cc\u9762\u641c\u7d22 \ud83d\udd0d \u6e32\u67d3\u5f15\u64ce\u5173\u952e\u5b57\uff0c\u51fa\u6765\u7684\u7ed3\u679c\u90fd\u662f\u5173\u4e8e\u6d4f\u89c8\u5668\u6e32\u67d3\u5f15\u64ce\u7684\u3002</p> <p></p> <p>\u6d4f\u89c8\u5668\u6e32\u67d3\u5f15\u64ce\u4e3b\u8981\u662f\u7528\u6765\u6e32\u67d3\u7f51\u9875\u5185\u5bb9\u7684\uff0c\u6bd4\u5982\u5185\u5bb9\u6392\u7248\u3001\u6587\u5b57\u6837\u5f0f\u90a3\u4e9b\uff0c\u663e\u7136\u8fd9\u4e0d\u662f\u6211\u60f3\u8981\u7684\u3002</p> <p>\u4e0d\u8fc7\uff0c\u4e00\u65b9\u9762\u80fd\u770b\u51fa\uff0c\u641c\u7d22\u5f15\u64ce\u5bf9\u4e8e\u6e32\u67d3\u5f15\u64ce\u7684\u5b9a\u4f4d\u66f4\u504f\u5411\u4e8e\u6d4f\u89c8\u5668\u6e32\u67d3\u4e86\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u662f\u6211\u4eec\u641c\u7d22\u7684\u5173\u952e\u5b57\u4e0d\u591f\u6e05\u6670\u51c6\u786e\u3002</p> <p>\u6362\u4e2a\u65b9\u5f0f\uff0c\u76f4\u63a5\u5728 Github \u91cc\u9762\u641c\u7d22 <code>renderengine</code> \u5173\u952e\u5b57\uff0c\u51fa\u6765\u4e86\u5927\u4e00\u5806\u9879\u76ee\uff0c\u770b\u6765\u5f88\u591a\u4eba\u90fd\u5199\u8fc7\u6b64\u7c7b\u5185\u5bb9\u4e86\u3002</p> <p></p> <p>\u4ee5 Google \u7684 filament \u9879\u76ee\u4e3a\u4f8b\uff0c\u5730\u5740\u5982\u4e0b</p> <p>https://github.com/google/filament</p> <p>filament \u662f\u4e00\u4e2a\u57fa\u4e8e\u7269\u7406\u7684\u5b9e\u65f6\u6e32\u67d3\u5f15\u64ce\uff0c\u5b83\u53ef\u4ee5\u8fd0\u884c\u5728 Android\u3001iOS\u3001Windows\u3001Linux\u3001macOS \u7b49\u7cfb\u7edf\u4e0a\u3002</p> <p>\u4ece README  \u4e0a\u53ef\u4ee5\u770b\u5230\u4e00\u4e9b\u4f8b\u5b50\u5c55\u793a\u5982\u4e0b\uff1a</p> <p></p> <p></p> <p>\u5728\u6211\u8fd8\u4e0d\u662f\u7279\u522b\u61c2\u6e32\u67d3\u5f15\u64ce\u7684\u65f6\u5019\uff0c\u770b\u5230\u8fd9\u4e9b\u56fe\u7247\u8fd8\u662f\u6709\u70b9\u61f5\u903c\u7684\uff0c\u5c24\u5176\u662f\u770b\u8fc7\u51e0\u4e2a\u7c7b\u4f3c\u9879\u76ee\u4e4b\u540e\u3002</p> <p>\u6211\u672c\u60f3\u77e5\u9053\u6e32\u67d3\u5f15\u64ce\u7528\u4ee3\u7801\u5199\u51fa\u6765\u4e4b\u540e\u8fd0\u884c\u8d77\u6765\u662f\u4e2a\u4ec0\u4e48\u6548\u679c\uff0c\u7ed3\u679c\u5c31\u6765\u51e0\u5f20\u56fe\u7247\uff0c\u6709\u70b9 <code>\u5f00\u5c40\u4e00\u5f20\u56fe\uff0c\u5185\u5bb9\u5168\u9760\u7f16</code> \u7684\u611f\u89c9\u3002</p> <p>\u540e\u6765\u6211\u624d\u77e5\u9053\uff0c\u539f\u6765\u8fd9\u4e9b\u56fe\u5c31\u662f\u7528\u6e32\u67d3\u5f15\u64ce\u6e32\u67d3\u51fa\u6765\u7684\u6548\u679c\u56fe\u3002</p> <p>\u56fe\u4e2d\u7684\u7269\u4f53\u662f\u901a\u8fc7\u52a0\u8f7d\u6a21\u578b\u5bfc\u5165\u7684\uff0c\u7136\u540e\u5728\u539f\u59cb\u6a21\u578b\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u6e32\u67d3\uff0c\u6dfb\u52a0\u989c\u8272\u3001\u5149\u7167\u3001\u9634\u5f71\u7b49\u5185\u5bb9\uff0c\u6700\u540e\u6e32\u67d3\u5230\u5c4f\u5e55\u4e0a\uff0c\u800c\u8fd9\u5c31\u662f\u6e32\u67d3\u5f15\u64ce\u7684\u5de5\u4f5c\u3002</p> <p>\u770b\u4f3c\u5f88\u7b80\u5355\uff0c\u4f46\u91cc\u9762\u6bcf\u4e2a\u7ec6\u8282\u90fd\u503c\u5f97\u8003\u7a76\u3002</p> <p>\u5982\u679c\u6e32\u67d3\u5f15\u64ce\u6e32\u67d3\u7684\u4e00\u5f20\u56fe\uff0c\u4f60\u770b\u7740\u5c31\u548c\u5728\u73b0\u5b9e\u4e2d\u7528\u76f8\u673a\u62cd\u7684\u56fe\u7247\u4e00\u6837\uff0c\u6839\u672c\u5206\u8fa8\u4e0d\u51fa\u662f\u73b0\u5b9e\u8fd8\u662f\u6a21\u62df\u7684\uff0c\u90a3\u8bf4\u660e\u8fd9\u6e32\u67d3\u5f15\u64ce\u9020\u8be3\u5f88\u65e9\uff0c\u6280\u672f\u4e0a\u5df2\u7ecf\u5f88\u903c\u771f\u4e86\u3002</p> <p>\u5c31\u597d\u6bd4\u4e0a\u9762\u7b2c\u4e00\u5f20\u56fe\uff0c\u90a3\u51e0\u4e2a\u7269\u4f53\u7684\u4f4d\u7f6e\u914d\u5408\u56fe\u7247\u7684\u80cc\u666f\uff0c\u5c31\u50cf\u6709\u4eba\u628a\u4e1c\u897f\u653e\u5728\u5730\u9762\u4e0a\u4e00\u6837\uff0c\u8ba9\u4eba\u50bb\u50bb\u5206\u4e0d\u6e05\u695a\u3002</p> <p>\u6e32\u67d3\u5f15\u64ce\u91cc\u9762\u6d89\u53ca\u5230\u5f88\u591a\u7684\u6e32\u67d3\u6280\u672f\uff0c\u53c2\u8003\u51e0\u4e2a Gihtub \u9879\u76ee\uff0c\u90fd\u4ecb\u7ecd\u5b83\u4eec\u5b9e\u73b0\u4e86\u54ea\u4e9b\u5185\u5bb9\uff0c\u5199\u7684\u8d8a\u591a\u8bf4\u660e\u8d8a\u6d41\u5f0a\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>HDR Lighting</li> <li>Deferered Rendering</li> <li>Depth of Field</li> <li>Screen Spacc grass</li> <li>Spot Lighting</li> <li>Directional Lighting</li> <li>...</li> </ul> <p>\u5217\u4e3e\u4e00\u70b9\u70b9\u505a\u4e2a\u53c2\u8003\uff0c\u91cc\u9762\u5927\u90e8\u5206\u6211\u4e5f\u4e0d\u4f1a\uff0c\u542c\u8bf4\u8fc7\u6982\u5ff5\uff0c\u540e\u9762\u7b49\u5f00\u59cb\u4ee3\u7801\u7f16\u5199\u4e86\u518d\u4e00\u4e00\u5b9e\u73b0\u4e00\u4e0b\u3002</p> <p>\u5230\u8fd9\u91cc\u53ef\u4ee5\u5c1d\u8bd5\u7ed9\u6e32\u67d3\u5f15\u64ce\u505a\u4e2a\u7b80\u5355\u5730\u5b9a\u4e49\uff1a\u5c31\u662f <code>\u5b9e\u73b0\u4e86</code> \u4e00\u7cfb\u5217\u6e32\u67d3\u6280\u672f\u7684 <code>\u6846\u67b6</code>\u3002</p> <p>\u6709\u4e24\u4e2a\u91cd\u70b9\uff0c\u4e00\u4e2a\u662f \u5b9e\u73b0\u4e86\uff0c\u4e00\u4e2a\u662f \u6846\u67b6 \u3002</p> <p>\u9996\u5148\u8981\u628a\u6e32\u67d3\u5f15\u64ce\u4f5c\u4e3a\u4e00\u4e2a\u6846\u67b6\uff0c\u6709\u7740\u5b8c\u6574\u7684\u67b6\u6784\u548c\u751f\u547d\u5468\u671f\uff0c\u53ef\u4ee5\u5bf9\u5916\u63d0\u4f9b\u5404\u9879\u80fd\u529b\uff1b\u5176\u6b21\u5c31\u662f\u5b9e\u73b0\u4e86\u5404\u9879\u6e32\u67d3\u80fd\u529b\uff0c\u80fd\u529b\u4e0d\u7528\u4e00\u6b21\u5230\u4f4d\uff0c\u5148\u6709\u518d\u9010\u6e10\u6dfb\u52a0\uff1b\u6700\u540e\u628a\u6e32\u67d3\u5f15\u64ce\u7528\u5230\u5b9e\u9645\u9879\u76ee\u5e94\u7528\u4e2d\uff0c\u5448\u73b0\u51fa\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9\u3002</p> <p>\u8bf4\u5230\u8fd9\u91cc\uff0c\u6709\u4eba\u4f1a\u89c9\u5f97\u8fd9\u6e32\u67d3\u5f15\u64ce\u548c\u6e38\u620f\u5f15\u64ce\u5f88\u7c7b\u4f3c\u3002\u662f\u7684\uff0c\u6e32\u67d3\u5f15\u64ce\u66f4\u50cf\u662f\u6e38\u620f\u5f15\u64ce\u7684\u5b50\u96c6\uff0c\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u5b50\u96c6\uff0c\u5728\u5b9e\u73b0\u7684\u65f6\u5019\u90fd\u4f1a\u53bb\u53c2\u8003\u6e38\u620f\u5f15\u64ce\u7684\u67b6\u6784\u8bbe\u8ba1\u3001\u529f\u80fd\u7279\u70b9\uff0c\u7b97\u662f\u6478\u7740\u6e38\u620f\u5f15\u64ce\u8fc7\u6cb3\u4e86\u3002</p> <p>\u50cf Unity\u3001Unreal\u3001Cocos \u8fd9\u4e9b\u6e38\u620f\u5f15\u64ce\uff0c\u6e32\u67d3\u80fd\u529b\u90fd\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u4e43\u662f\u91cd\u4e2d\u4e4b\u91cd\u5440\uff0c\u4f46\u9664\u6b64\u4e4b\u5916\uff0c\u6e38\u620f\u5f15\u64ce\u8fd8\u6709\u5176\u4ed6\u91cd\u8981\u529f\u80fd\uff0c\u6bd4\u5982\u97f3\u9891\u80fd\u529b\u3001\u7269\u4f53\u7cfb\u7edf\u3001\u811a\u672c\u7cfb\u7edf\u3001\u7f51\u7edc\u5f15\u64ce\u3001\u4eba\u5de5\u667a\u80fd\u3001\u573a\u666f\u7ba1\u7406\u7b49\u7b49\uff0c\u8fd9\u4e9b\u90fd\u662f\u6211\u4eec\u6682\u65f6\u7528\u4e0d\u5230\uff0c\u7b49\u6709\u9700\u8981\u7684\u65f6\u5019\u518d\u6765\u8be6\u7ec6\u5206\u6790\u3002</p> <p>\u5f04\u6e05\u4e86\u5565\u662f\u6e32\u67d3\u5f15\u64ce\uff0c\u540e\u9762\u5bf9\u8981\u5b9e\u73b0\u7684\u529f\u80fd\u5c31\u66f4\u6e05\u6670\u4e86\uff0c\u5e94\u7528 + \u6846\u67b6 + \u6e32\u67d3 \uff0c\u7f3a\u4e00\u4e0d\u53ef\u3002</p>","tags":["engine"]},{"location":"opengl/2021-render-engine/","title":"2021 \u6280\u672f\u65b0\u756a - \u4ece\u96f6\u6253\u9020\u6e32\u67d3\u5f15\u64ce\u7cfb\u5217","text":"<p>2021 \u5e74\u7684\u7b2c\u4e00\u6b21\u516c\u4f17\u53f7\u6587\u7ae0\u63a8\u9001\uff0c\u5b83\u4f1a\u8fdf\u5230\uff0c\u4f46\u7edd\u4e0d\u7f3a\u5e2d\uff01\uff01</p> <p>2020 \u5e74\u5df2\u7ecf\u6210\u4e3a\u8fc7\u53bb\uff0c\u65b0\u7684\u4e00\u5e74\u53c8\u8be5\u6709\u65b0\u7684\u89c4\u5212\u4e86\uff0c\u6c89\u601d\u826f\u4e45\u4e4b\u540e\u51b3\u5b9a\u5c31\u662f\u5b83\u5566~~</p> <p>\u4eca\u5e74\u7684\u53d1\u529b\u70b9\u5c31\u662f\u4ece\u96f6\u6253\u9020\u6e32\u67d3\u5f15\u64ce\u3002</p> <p>\u8bf4\u5b9e\u8bdd\uff0c\u5176\u5b9e\u6211\u90fd\u8fd8\u4e0d\u77e5\u9053\u6e32\u67d3\u5f15\u64ce\u8981\u600e\u4e48\u641e\u3002</p> <p>\u524d\u6bb5\u65f6\u95f4\u5728\u6cb9\u7ba1\u4e0a\u770b\u89c6\u9891\uff0c\u5237\u5230\u8fd9\u4f4d\u5c0f\u54e5\u7684\u5185\u5bb9\uff0c\u8ddf\u8fdb\u53bb\u770b\u4e86\u5f88\u591a\uff0c\u8bb2\u7684\u4e0d\u9519\uff0c\u8303\u56f4\u5e7f\uff0c\u5185\u5bb9\u5168\u3002</p> <p></p> <p>\u6b63\u597d\u4ed6\u8bb2\u7684\u5185\u5bb9\u4e5f\u662f\u6e32\u67d3\u5f15\u64ce\u76f8\u5173\u7684\uff0c\u8ddf\u7740\u5b66\u4e86\u4e00\u4e22\u4e22\uff0c\u77e5\u9053\u70b9\u76ae\u6bdb\uff0c\u6709\u4e2a\u5927\u6982\u6846\u67b6\u8109\u7edc\u4e86\u3002</p> <p>\u987a\u4fbf\u8bf4\u4e00\u4e0b\u6cb9\u7ba1\u4e0a\u7c7b\u4f3c\u7684\u89c6\u9891\u8fd8\u633a\u591a\u7684\uff0c\u611f\u89c9\u4ed6\u4eec\u662f\u4e00\u4e2a\u56e2\u4f19\u7684\uff0c\u5f55\u89c6\u9891\u5356\u4ee3\u7801\uff0c\u4e5f\u662f\u4e2a\u597d\u601d\u8def\u3002</p> <p>\u540e\u6765\u53c8\u5728 Github \u4e0a\u641c\u4e86\u5f88\u591a\u6e32\u67d3\u5f15\u64ce\u7684\u5f00\u6e90\u5e93\uff0c\u8ba4\u771f\u7814\u8bfb\u4e00\u756a\uff0c\u770b\u7684\u6bd4\u5199\u7684\u8fd8\u591a\uff0c\u60f3\u7684\u6bd4\u770b\u7684\u591a\u66f4\u591a\u3002</p> <p>\u60f3\u77e5\u9053\u6211\u770b\u4e86\u54ea\u4e9b\u5f00\u6e90\u5e93\uff0c\u4e0d\u59a8\u76f4\u63a5 follow \u6211\u7684 Github \u5730\u5740\uff0c\u5e26\u4f60 Star \u90a3\u4e9b\u4e0d\u9519\u7684\u97f3\u89c6\u9891\u9879\u76ee\u3002</p> <p>https://github.com/glumes</p> <p>\u4fd7\u8bdd\u8bf4\uff1a\u6ee1\u74f6\u4e0d\u54cd\uff0c\u534a\u74f6\u54a3\u5f53\u3002\u5b66\u4e86\u51e0\u62db\uff0c\u5dee\u4e0d\u591a\u6709\u4e86\u4e09\u811a\u732b\u529f\u592b\uff0c\u5c31\u53ef\u4ee5\u51fa\u6765\u88c5 X \u7acb Flag \u4e86\u3002</p> <p>\u5f53\u7136\uff0c\u76ee\u7684\u8fd8\u662f\u6bd4\u8f83\u76f4\u63a5\u7684\u3002\u6478\u7d22\u5c1d\u8bd5\u7740\u53bb\u505a\u4e00\u4e2a\u6e32\u67d3\u5f15\u64ce\uff0c\u4e0d\u65ad\u53d1\u5c55\uff0c\u52a8\u6001\u6f14\u53d8\uff0c\u540c\u65f6\u4e5f\u5b66\u4e60\u4e00\u6ce2\u4f18\u79c0\u5f15\u64ce\u7684\u4ee3\u7801\uff0c\u63d0\u9ad8\u773c\u754c\uff0c\u62d3\u5c55\u80fd\u529b\u8fb9\u754c\u3002</p> <p>\u53e6\u5916\uff0c\u65e2\u7136\u6807\u9898\u662f\u6280\u672f\u65b0\u756a\uff0c\u90a3\u4e48\u80af\u5b9a\u4e0d\u4f1a\u8349\u8349\u7ed3\u675f\u5566\uff0c\u5341\u51e0\u7bc7\u6587\u7ae0\u5c31\u5199\u5b8c\u4e86\uff0c\u592a\u5bf9\u4e0d\u8d77\u65b0\u756a\u8fd9\u4e2a\u79f0\u547c\u4e86\uff0c\u505a\u597d\u8ffd\u756a\u7684\u51c6\u5907\u5427\uff01</p> <p>\u5176\u5b9e\uff0c\u5728\u4e4b\u524d\u5c31\u5df2\u7ecf\u5c1d\u8bd5\u7740\u53bb\u5199\u8fc7\u4e86\u90e8\u5206\u4ee3\u7801\uff0c\u7528 XCode \u5199\u7684\uff0c\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>\u4e0d\u5f97\u4e0d\u8bf4\u7ed9 XCode \u8dea\u4e86\uff0c\u7f16\u8f91\u4f53\u9a8c\u5b9e\u5728\u592a\u5dee\u4e86\uff0c\u548c CLion \u7b80\u76f4\u6ca1\u6cd5\u6bd4\uff0c\u5728\u5e93\u4f9d\u8d56\u548c\u6784\u5efa\u4e0a\u4e5f\u5dee\u5f88\u591a\u3002</p> <p>\u4e00\u5f00\u59cb\u6211\u8fd8\u56fe XCode \u4e0a\u7684\u5de5\u5177\u597d\u7528\uff0c\u53ef\u4ee5\u68c0\u6d4b\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u907f\u514d\u6709\u6cc4\u6f0f\uff0cCLion \u8fd9\u65b9\u9762\u5c31\u6709\u6240\u6b20\u7f3a\u3002\u4f7f\u7528\u4e86\u4e00\u6bb5\u65f6\u95f4\u5c31\u653e\u5f03\u4e86\uff0c\u8fd8\u662f\u5207\u6362\u56de CLion \u5427\uff0c\u7528\u7740\u987a\u624b\uff0c\u4e0d\u60f3\u82b1\u5fc3\u601d\u6363\u9f13\u65e0\u5173\u7684\u4e86\u3002</p> <p>\u5982\u679c\u6709\u5fc3\u8ffd\u756a\uff0c\u5efa\u8bae\u4e0b\u8f7d\u597d CLion \uff0c\u6211\u5df2\u7ecf\u6084\u6084\u5730\u5199\u4e86\u4e0d\u5c11\u4ee3\u7801\u4e86\u3002</p> <p>\u9ed4\u9a74\u6280\u7a77\uff0c\u6ca1\u5565\u6280\u672f\u80fd\u62ff\u5f97\u51fa\u624b\u4e86\uff0c\u53ea\u80fd\u73b0\u5b66\u73b0\u5356\uff0c\u4e0d\u65ad\u7ed9\u5927\u5bb6\u5e26\u6765\u6709\u8da3\u7684\u65b0\u4e1c\u897f\u4e86 ~~~</p> <p>\u6700\u540e\uff0c2021 \u5e0c\u671b\u5404\u4f4d\u90fd\u53ef\u4ee5\u6280\u672f\u7206\u6808\uff0c\u80fd\u529b\u7a81\u98de\u731b\u8fdb\uff0c\u65e9\u65e5\u66b4\u5bcc<sub>~</sub></p>","tags":["engine"]},{"location":"opengl/libjpeg-turbo-compile-and-practice/","title":"\u56fe\u50cf\u5e93 libjpeg-turbo \u7f16\u8bd1\u4e0e\u5b9e\u8df5","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/x-dTLowXcqysnLxZ0BGA2g</p> <p>\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\u5df2\u7ecf\u9646\u7eed\u4ecb\u7ecd\u4e86 stb_image\u3001libpng \u7684\u4f7f\u7528\uff0c\u76f8\u5173\u94fe\u63a5\u5982\u4e0b\uff1a</p> <p>\u3010\u7b80\u5355\u6613\u7528\u7684\u56fe\u50cf\u89e3\u7801\u5e93\u4ecb\u7ecd \u2014\u2014 stb_image\u3011</p> <p>https://glumes.com/post/android/stb-image-introduce/</p> <p>\u3010\u56fe\u50cf\u5e93 libpng \u7f16\u8bd1\u4e0e\u5b9e\u8df5\u3011</p> <p>https://glumes.com/post/opengl/libpng-compile-and-practice/</p> <p>\u800c\u4eca\u5929\u7684\u4e3b\u9898\u5c31\u662f libjpeg-turbo \u3002</p> <p>\u5b83\u7684\u5b98\u7f51\u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://libjpeg-turbo.org/</p> <p>\u5b83\u7684 github \u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://github.com/libjpeg-turbo/libjpeg-turbo</p>","tags":["libjpeg-turbo","image"]},{"location":"opengl/libjpeg-turbo-compile-and-practice/#_1","title":"\u7f16\u8bd1","text":"<p>\u5728 libjpeg-turbo \u7684\u6e90\u7801\u4e2d\u5c31\u5df2\u7ecf\u6709\u4e86\u8bb2\u8ff0\u5982\u4f55\u7f16\u8bd1\u7684 BUILDING.md \u6587\u4ef6\uff0c\u8fd8\u662f\u4f7f\u7528 CMake \u8fdb\u884c\u7f16\u8bd1\uff0c\u5927\u4f53\u65b9\u6cd5\u548c\u53c2\u6570\u8bbe\u7f6e\u90fd\u5927\u540c\u5c0f\u5f02\u4e86\u3002</p> <p>\u53c2\u8003\u6e90\u7801\u7ed9\u51fa\u7684\u7f16\u8bd1\u4ee3\u7801\uff1a</p> <pre><code># Set these variables to suit your needs\n# \u8bbe\u7f6e\u4ea4\u53c9\u7f16\u8bd1\u7684\u53d8\u91cf\nNDK_PATH={full path to the NDK directory-- for example,\n  /opt/android/android-ndk-r16b}\nTOOLCHAIN={\"gcc\" or \"clang\"-- \"gcc\" must be used with NDK r16b and earlier,\n  and \"clang\" must be used with NDK r17c and later}\nANDROID_VERSION={the minimum version of Android to support-- for example,\n  \"16\", \"19\", etc.}\n\ncd {build_directory}\ncmake -G\"Unix Makefiles\" \\\n  -DANDROID_ABI=armeabi-v7a \\\n  -DANDROID_ARM_MODE=arm \\\n  -DANDROID_PLATFORM=android-${ANDROID_VERSION} \\\n  -DANDROID_TOOLCHAIN=${TOOLCHAIN} \\\n  -DCMAKE_ASM_FLAGS=\"--target=arm-linux-androideabi${ANDROID_VERSION}\" \\\n  -DCMAKE_TOOLCHAIN_FILE=${NDK_PATH}/build/cmake/android.toolchain.cmake \\\n  [additional CMake flags] {source_directory}\nmake\n</code></pre> <p>\u7531\u4e8e CMake \u8de8\u5e73\u53f0\u7f16\u8bd1\u7684\u7279\u6027\uff0c\u5728\u8fdb\u884c\u4ea4\u53c9\u7f16\u8bd1\u65f6\u8981\u8bbe\u7f6e\u5f88\u591a\u76f8\u5173\u53c2\u6570\uff0c\u6bd4\u5982\u7f16\u8bd1\u7684\u76ee\u6807\u7cfb\u7edf\u5e73\u53f0\u3001\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u3001NDK \u76ee\u5f55\u7b49\u3002</p> <p>\u8be6\u7ec6\u7684\u7f16\u8bd1\u811a\u672c\u53ef\u4ee5\u53c2\u8003\u9879\u76ee\u4e2d\u7684\uff1a</p> <p>https://github.com/glumes/InstantGLSL/tree/master/libjpeg_turbo_source/build_script</p> <p>\u8be5\u76ee\u5f55\u4e0b\u7ed9\u51fa\u4e86\u7f16\u8bd1 armeabi\u3001armeabi-v7a\u3001arm64-v8a\u3001x86\u3001x86_64 \u7b49\u5e73\u53f0\u7684\u7f16\u8bd1\u811a\u672c\u3002\u4fee\u6539\u4e00\u4e0b\u76f8\u5e94\u6587\u4ef6\u8def\u5f84\uff0c\u5c31\u80fd\u5728 MAC \u7cfb\u7edf\u4e0a\u7f16\u8bd1 so \u4e86\u3002</p> <p>\u53e6\u5916\u5982\u679c\u662f\u5728 Android Studio \u4e2d\u7528 CMake \u7f16\u8bd1 so\uff0c\u4f60\u4f1a\u53d1\u73b0\u5f88\u5c11\u8981\u8bbe\u7f6e\u90a3\u4e9b\u53c2\u6570\uff0c\u8fd9\u662f\u56e0\u4e3a Android Studio \u4e2d\u7684 CMake \u9ed8\u8ba4\u5c31\u8bbe\u7f6e\u597d\u4e86\u90a3\u4e9b\u53c2\u6570\u3002</p> <p>\u56e0\u6b64\u8fd8\u6709\u4e00\u79cd\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\u8fdb\u884c\u7f16\u8bd1\uff0c\u76f4\u63a5\u5c06 libjpeg-turbo \u6e90\u7801\u5185\u5bb9\u590d\u5236\u5230 Android Studio \u5de5\u7a0b\u76ee\u5f55\u7684 cpp \u6587\u4ef6\u5939\u4e0b\uff0c\u7136\u540e\u628a app \u7684 build.gradle \u4e2d cmake path \u6539\u6210 libjpeg-turbo \u7684 CMakeLists.txt \u8def\u5f84\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>    externalNativeBuild {\n        cmake {\n            path \"src/main/cpp/libjpeg_turbo_source/CMakeLists.txt\"\n//            path \"CMakeLists.txt\"\n        }\n    }\n</code></pre> <p>\u7136\u540e\u76f4\u63a5\u7f16\u8bd1\uff0c\u5728 build/intermediates/cmake \u8def\u5f84\u4e0b\u4f9d\u65e7\u53ef\u4ee5\u627e\u5230\u7f16\u8bd1\u597d\u7684 so \u6587\u4ef6\u3002</p> <p>\u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\u90fd\u53ef\u4ee5\u5b9e\u73b0 libjpeg-turbo \u7684\u7f16\u8bd1\uff0c\u770b\u4e2a\u4eba\u559c\u597d\u4e86\u3002\u800c\u4e14\u8fd9\u79cd\u5e93\u4e00\u65e6\u7f16\u8bd1\u597d\u4e86\uff0c\u4ee5\u540e\u4e5f\u5f88\u5c11\u53bb\u66f4\u6539\uff0c\u4e00\u52b3\u6c38\u9038<sub>~</sub></p>","tags":["libjpeg-turbo","image"]},{"location":"opengl/libjpeg-turbo-compile-and-practice/#_2","title":"\u5b9e\u8df5","text":"<p>\u5728 libjpeg-turbo \u7684\u6e90\u7801\u4e2d\u6709\u4e2a example.txt \u6587\u4ef6\uff0c\u8be6\u7ec6\u8bb2\u8ff0\u4e86\u5982\u4f55\u5229\u7528\u8be5\u5e93\u8fdb\u884c\u56fe\u7247\u538b\u7f29\u548c\u89e3\u538b\u7f29\u3002</p> <p>\u57fa\u672c\u4e0a\u7167\u7740\u6587\u4ef6\u5185\u5bb9\u770b\u4e00\u904d\u5c31\u61c2\u4e86\uff0c\u5728\u8fd9\u91cc\u8fd8\u4f1a\u5927\u6982\u8bb2\u8ff0\u4e0b\uff0c\u5e76\u4e14\u4f1a\u7528\u53e6\u4e00\u4e2a\u5b9e\u4f8b\u6765\u6f14\u793a\uff0c\u4e5f\u5c31\u662f\u4e4b\u524d\u5e38\u7528\u7684\uff0c\u83b7\u53d6 jpeg \u56fe\u50cf\u6587\u4ef6\u50cf\u7d20\u5185\u5bb9\u5e76\u4e14\u4e0a\u4f20\u7eb9\u7406\u3002</p>","tags":["libjpeg-turbo","image"]},{"location":"opengl/libjpeg-turbo-compile-and-practice/#_3","title":"\u538b\u7f29","text":"<p>\u5728 Android \u4e2d\u901a\u8fc7 Java \u65b9\u6cd5\u4e5f\u53ef\u4ee5\u5b9e\u73b0 Jpeg \u7684\u6587\u4ef6\uff0c\u56e0\u4e3a\u5e95\u5c42\u5c31\u662f\u57fa\u4e8e libjpeg \u7684\u3002\u800c libjpeg-turbo \u7684\u538b\u7f29\u901f\u5ea6\u4f1a\u6bd4 Android \u539f\u751f\u7684\u901f\u5ea6\u66f4\u5feb\u4e86\u3002</p> <p>Android \u4e2d Jpeg \u6587\u4ef6\u538b\u7f29\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>compress(CompressFormat format, int quality, OutputStream stream)\n</code></pre> <p>\u5176\u4e2d\u91cd\u8981\u7684\u53c2\u6570\u5c31\u662f quality \uff0c\u4ee3\u8868\u8981\u538b\u7f29\u7684\u8d28\u91cf\uff0c\u800c\u5728 libjpeg-turbo \u4e5f\u4f1a\u6709\u8fd9\u6837\u7684\u53c2\u6570\u8981\u8bbe\u7f6e\u3002</p> <p>libjpeg-turbo \u7684\u4f7f\u7528\u903b\u8f91\u548c libpng \u6709\u70b9\u7c7b\u4f3c\uff0c\u9996\u5148\u90fd\u662f\u8981\u8bbe\u7f6e\u4e00\u4e2a\u9519\u8bef\u8fd4\u56de\u70b9\uff0c\u5e76\u4e14\u6709\u4e00\u4e2a\u7ed3\u6784\u4f53\u6765\u5b58\u50a8\u4fe1\u606f\u3002</p> <p>\u5728 libjpeg-turbo \u8fdb\u884c\u538b\u7f29\u65f6\uff0c\u7528\u5230\u7684\u7ed3\u6784\u4f53\u662f <code>jpeg_compress_struct</code> \uff0c\u89e3\u538b\u5219\u662f <code>jpeg_decompress_struct</code>\uff0c\u4e24\u8005\u540d\u5b57\u4e0a\u6709\u7740\u5355\u8bcd\u7684\u4e0d\u540c\u3002 </p> <p>\u800c\u5728 libpng \u4e2d\uff0c\u521b\u5efa\u7ed3\u6784\u4f53\u7684\u65b9\u6cd5 <code>png_create_write_struct</code> \u548c <code>png_create_read_struct</code> \u76f8\u914d\u5bf9\uff0c\u4e00\u4e2a write\uff0c\u4e00\u4e2a read \u3002</p> <p>\u4f7f\u7528 libjpeg-turbo \u7684\u4e3b\u8981\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u8bbe\u7f6e\u538b\u7f29\u540e\u7684\u8f93\u51fa\u65b9\u5f0f\uff0c\u53ef\u4ee5\u7684\u662f\u6587\u4ef6\u7684\u5f62\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f\u5185\u5b58\u6570\u636e\u683c\u5f0f</li> <li>\u914d\u7f6e\u538b\u7f29\u7684\u76f8\u5173\u8bbe\u7f6e\u9879\uff0c\u6bd4\u5982\u538b\u7f29\u540e\u7684\u56fe\u50cf\u5bbd\u9ad8\u3001\u538b\u7f29\u8d28\u91cf\u7b49</li> <li>\u8fdb\u884c\u538b\u7f29\uff0c\u9010\u884c\u8bfb\u53d6\u6570\u636e\u6e90\u50cf\u7d20\u5185\u5bb9</li> <li>\u538b\u7f29\u7ed3\u675f\uff0c\u5f97\u5230\u538b\u7f29\u540e\u7684\u6570\u636e</li> </ol> <p>\u5bf9\u5e94\u5230\u4ee3\u7801\u7684\u903b\u8f91\u5982\u4e0b\uff1a</p> <pre><code>    struct jpeg_compress_struct jpegCompressStruct;\n    // \u521b\u5efa\u4ee3\u8868\u538b\u7f29\u7684\u7ed3\u6784\u4f53\n    jpeg_create_compress(&amp;jpegCompressStruct);\n\n    // \u6587\u4ef6\u65b9\u5f0f\u8f93\u51fa \u8fd8\u6709\u4e00\u79cd\u662f\u5185\u5b58\u65b9\u5f0f\n    jpeg_stdio_dest(&amp;jpegCompressStruct, fp);\n    // \u8bbe\u7f6e\u538b\u7f29\u7684\u76f8\u5173\u53c2\u6570\u4fe1\u606f\n    jpegCompressStruct.image_width = w;\n    jpegCompressStruct.image_height = h;\n    jpegCompressStruct.arith_code = false;\n    jpegCompressStruct.input_components = nComponent;\n    // \u8bbe\u7f6e\u89e3\u538b\u7684\u989c\u8272\n    jpegCompressStruct.in_color_space = JCS_RGB;\n    jpeg_set_defaults(&amp;jpegCompressStruct);\n    // \u538b\u7f29\u7684\u8d28\u91cf\n    jpegCompressStruct.optimize_coding = quality;\n    jpeg_set_quality(&amp;jpegCompressStruct, quality, true);\n</code></pre> <p>\u9996\u5148\u662f\u521b\u5efa\u7ed3\u6784\u4f53 jpeg_compress_struct \uff0c\u901a\u8fc7\u8be5\u7ed3\u6784\u4f53\u6765\u5b8c\u6210\u538b\u7f29\u6570\u636e\u8f93\u51fa\u3001\u914d\u7f6e\u538b\u7f29\u9009\u9879\u64cd\u4f5c\u3002</p> <p>\u538b\u7f29\u6570\u636e\u8f93\u51fa\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <pre><code>    // \u4ee5\u6587\u4ef6\u7684\u65b9\u5f0f\n    jpeg_stdio_dest(j_compress_ptr cinfo, FILE *outfile);\n    // \u4ee5\u5185\u5b58\u7684\u65b9\u5f0f\n    jpeg_mem_dest(j_compress_ptr cinfo, unsigned char **outbuffer,\n                           unsigned long *outsize)\n</code></pre> <p>\u53e6\u5916\uff0c\u538b\u7f29\u9009\u9879\u9664\u4e86\u5e38\u89c1\u7684\u5bbd\u9ad8\u4fe1\u606f\u3001\u989c\u8272\u7c7b\u578b\uff0c\u8fd8\u6709\u6700\u91cd\u8981\u7684\u56fe\u50cf\u8d28\u91cf\u53c2\u6570\uff0c\u901a\u8fc7\u4e13\u95e8\u7684\u65b9\u6cd5\u8fdb\u884c\u8bbe\u7f6e\u3002</p> <pre><code>    jpeg_set_quality(j_compress_ptr cinfo, int quality,\n                                boolean force_baseline)\n</code></pre> <p>\u8bbe\u7f6e\u5b8c\u8981\u538b\u7f29\u7684\u76f8\u5173\u4fe1\u606f\u540e\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u538b\u7f29\u4e86\u3002</p> <pre><code>    // \u5f00\u59cb\u538b\u7f29\n    jpeg_start_compress(&amp;jpegCompressStruct, true);\n    // JSAMPROW \u4ee3\u8868\u6bcf\u884c\u7684\u6570\u636e\n    JSAMPROW row_point[1];\n    int row_stride = jpegCompressStruct.image_width * nComponent;\n\n    while (jpegCompressStruct.next_scanline &lt; jpegCompressStruct.image_height) {\n        // data \u53c2\u6570\u5c31\u662f\u8981\u538b\u7f29\u7684\u6570\u636e\u6e90\n        // \u9010\u884c\u8bfb\u53d6\u50cf\u7d20\u5185\u5bb9\n        row_point[0] = &amp;data[jpegCompressStruct.next_scanline * row_stride];\n        // \u5199\u5165\u6570\u636e\n        jpeg_write_scanlines(&amp;jpegCompressStruct, row_point, 1);\n    }\n\n   // \u5b8c\u6210\u538b\u7f29 \n   jpeg_finish_compress(&amp;jpegCompressStruct);\n   // \u91ca\u653e\u76f8\u5e94\u7684\u7ed3\u6784\u4f53\n   jpeg_destroy_compress(&amp;jpegCompressStruct);\n</code></pre> <p>\u4e3b\u8981\u7684\u4ee3\u7801\u5c31\u5728\u4e8e while \u5faa\u73af\u4e2d\u3002</p> <p><code>next_scanline</code> \u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u72b6\u6001\u53d8\u91cf\uff0c\u9700\u8981\u9010\u884c\u53bb\u626b\u63cf\u56fe\u50cf\u5185\u5bb9\u5e76\u5199\u5165\uff0c\u6bcf\u6b21 jpeg_write_scanlines \u65b9\u6cd5\u4e4b\u540e\uff0c<code>next_scanline</code> \u5c31\u4f1a\u9012\u589e\uff0c\u76f4\u5230\u9000\u51fa\u5faa\u73af\u3002</p>","tags":["libjpeg-turbo","image"]},{"location":"opengl/libjpeg-turbo-compile-and-practice/#_4","title":"\u89e3\u538b\u7f29","text":"<p>\u89e3\u538b\u548c\u538b\u7f29\u7684\u4ee3\u7801\u7ed3\u6784\u5927\u81f4\u76f8\u540c\u4e86\u3002</p> <pre><code>    jpeg_create_decompress(&amp;cinfo);\n    // \u8bbe\u7f6e\u6570\u636e\u6e90\u6570\u636e\u65b9\u5f0f \u8fd9\u91cc\u4ee5\u6587\u4ef6\u7684\u65b9\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u4ee5\u5185\u5b58\u6570\u636e\u7684\u65b9\u5f0f\n    jpeg_stdio_src(&amp;cinfo, fp);\n    // \u8bfb\u53d6\u6587\u4ef6\u4fe1\u606f\uff0c\u6bd4\u5982\u5bbd\u9ad8\u4e4b\u7c7b\u7684\n    jpeg_read_header(&amp;cinfo, TRUE);\n</code></pre> <p>\u5176\u4e2d jpeg_read_header \u65b9\u6cd5\u53ef\u4ee5\u83b7\u53d6\u8981\u89e3\u538b\u7684\u6587\u4ef6\u76f8\u5173\u4fe1\u606f\u3002</p> <p>\u63a5\u4e0b\u6765\u8bbe\u7f6e\u89e3\u538b\u7684\u76f8\u5173\u53c2\u6570\uff1a</p> <pre><code>    jpeg_start_decompress(&amp;cinfo);\n    unsigned long width = cinfo.output_width;\n    unsigned long height = cinfo.output_height;\n    unsigned short depth = cinfo.output_components;\n    row_stride = cinfo.output_width * cinfo.output_components;\n</code></pre> <p>\u5b9a\u4e49\u76f8\u5173\u7684\u6570\u636e\u53d8\u91cf\uff0c\u6765\u4fdd\u5b58\u89e3\u538b\u7684\u6570\u636e\u3002</p> <pre><code>    // \u4fdd\u5b58\u6bcf\u884c\u89e3\u538b\u7684\u6570\u636e\u5185\u5bb9    \n    JSAMPARRAY buffer;\n    // \u521d\u59cb\u5316\n    buffer = (*cinfo.mem-&gt;alloc_sarray)((j_common_ptr) &amp;cinfo, JPOOL_IMAGE, row_stride, 1);\n\n    // \u4fdd\u5b58\u56fe\u50cf\u7684\u6240\u6709\u6570\u636e\n    unsigned char *src_buff;\n    // \u521d\u59cb\u5316\u5e76\u7f6e\u7a7a\n    src_buff = static_cast&lt;unsigned char *&gt;(malloc(width * height * depth));\n    memset(src_buff, 0, sizeof(unsigned char) * width * height * depth);\n</code></pre> <p>\u8fd9\u91cc\u4f7f\u7528\u7684\u662f <code>JSAMPARRAY</code> \u6765\u4fdd\u5b58\uff0c\u5728 libjpeg-turbo \u4e2d\u5176\u5b9e\u6709\u591a\u79cd\u7ed3\u6784\u6765\u8868\u793a\u56fe\u50cf\u6570\u636e\u7c7b\u578b\uff0c\u538b\u7f29\u4e2d\u7528\u5230\u7684\u5c31\u662f <code>JSAMPROW</code> \u3002</p> <pre><code>/* Data structures for images (arrays of samples and of DCT coefficients).\n */\ntypedef unsigned char JSAMPLE;\ntypedef JSAMPLE *JSAMPROW;      /* ptr to one image row of pixel samples. */\ntypedef JSAMPROW *JSAMPARRAY;   /* ptr to some rows (a 2-D sample array) */\ntypedef JSAMPARRAY *JSAMPIMAGE; /* a 3-D sample array: top index is color */\n</code></pre> <p>\u901a\u8fc7\u4e0a\u8ff0\u4ee3\u7801\u4e0d\u96be\u770b\u51fa\uff0c<code>JSAMPROW</code> \u5176\u5b9e\u5c31\u662f\u4e00\u7ef4\u6570\u7ec4\uff0c\u800c <code>JSAMPARRAY</code> \u5c31\u662f\u4e8c\u7ef4\u6570\u7ec4\u3002\u4ee5\u4e0b\u4e24\u884c\u4ee3\u7801\u53ef\u4ee5\u8bf4\u662f\u7b49\u4ef7\u7684\uff1a</p> <pre><code>    JSAMPARRAY buffer = nullptr;\n    JSAMPROW *row_pointer = nullptr;\n</code></pre> <p>\u56e0\u4e3a <code>JSAMPARRAY</code> \u7684\u5b9a\u4e49\u5c31\u662f <code>JSAMPROW *</code> \u3002</p> <p>\u5177\u4f53\u7528\u54ea\u4e2a\u66f4\u597d\uff0c\u8981\u770b\u8c03\u7528\u65b9\u6cd5\u9700\u8981\u7684\u53c2\u6570\u7c7b\u578b\u4e86\uff0c<code>jpeg_write_scanlines</code> \u548c <code>jpeg_read_scanlines</code> \u8fd9\u4e24\u4e2a\u65b9\u6cd5\u9700\u8981\u7684\u90fd\u662f <code>JSAMPARRAY</code> \u7c7b\u578b\u3002</p> <p>\u53e6\u5916\uff0c\u4ee3\u7801\u4e2d\u8fd8\u58f0\u660e\u5e76\u521d\u59cb\u5316\u4e86 <code>src_buff</code> \u53d8\u91cf\uff0c\u8be5\u53d8\u91cf\u5c31\u662f\u7528\u6765\u8868\u793a\u89e3\u538b\u540e\u7684\u56fe\u50cf\u6570\u636e\u3002</p> <p>\u5177\u4f53\u89e3\u538b\u7684\u903b\u8f91\u4e5f\u6bd4\u8f83\u6e05\u695a\u4e86\uff0c\u9010\u884c\u626b\u63cf\u56fe\u50cf\uff0c\u7528 <code>buffer</code> \u53d8\u91cf\u53bb\u5b58\u50a8\u56fe\u50cf\u6bcf\u884c\u89e3\u538b\u7684\u6570\u636e\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u6570\u636e\u7ed9\u5230 <code>src_buff</code> \u53d8\u91cf\uff0c\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>    unsigned char *point = src_buff;\n\n    while (cinfo.output_scanline &lt; height) {\n        jpeg_read_scanlines(&amp;cinfo, buffer, 1);\n        memcpy(point, *buffer, width * depth);\n        point += width * depth;\n    }\n\n    jpeg_finish_decompress(&amp;cinfo);\n    jpeg_destroy_decompress(&amp;cinfo);\n</code></pre> <p>\u8fd9\u91cc\u7528\u5230\u4e86 <code>point</code> \u8fd9\u6837\u7684\u4e34\u65f6\u53d8\u91cf\uff0c\u5b9e\u9645\u4e0a\uff0c\u8fd9\u6837\u7684\u7528\u6cd5\u5728 C++ \u5f00\u53d1\u4e2d\u5e94\u8be5\u7b97\u6bd4\u8f83\u5e38\u89c1\u7684\u3002</p> <p>\u56e0\u4e3a\u628a <code>buffer</code> \u7684\u6570\u636e\u4f20\u5230 <code>src_buff</code> \u540e\uff0c<code>src_buff</code> \u6307\u9488\u8981\u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a\u70b9\u53bb\u63a5\u6536\u6570\u636e\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6307\u9488\u6307\u5411\u7684\u4f4d\u7f6e\u5c31\u4e0d\u662f\u539f\u59cb\u4f4d\u7f6e\u4e86\uff0c\u6240\u4ee5\u624d\u9700\u8981\u4e34\u65f6\u53d8\u91cf\u53bb\u505a\u79fb\u52a8\u64cd\u4f5c\uff0c\u4fdd\u8bc1 <code>src_buff</code> \u6307\u5411\u7684\u4f4d\u7f6e\u4e3a\u8d77\u59cb\u70b9\u3002</p> <p>\u6700\u540e\uff0c\u522b\u5fd8\u4e86\u91ca\u653e\u76f8\u5e94\u7684\u53d8\u91cf\uff0c\u505a\u4e00\u4e9b\u6536\u5c3e\u5de5\u4f5c\uff0c\u89e3\u538b\u5c31\u5b8c\u6210\u4e86\u3002</p>","tags":["libjpeg-turbo","image"]},{"location":"opengl/libjpeg-turbo-compile-and-practice/#jpeg","title":"jpeg \u4e0a\u4f20\u7eb9\u7406\u6e32\u67d3","text":"<p>\u8bf4\u5b8c\u4e86\u538b\u7f29\u548c\u89e3\u538b\u7f29\uff0c\u6700\u540e\u4ee5\u4e00\u4e2a\u4f8b\u5b50\u6765\u5b9e\u9645\u5e94\u7528\uff0c\u4e5f\u662f\u4e4b\u524d\u6587\u7ae0\u4e2d\u5e38\u7528\u7684\u4f8b\u5b50\uff0c\u901a\u8fc7 libjpeg-turbo \u8bfb\u53d6 jpeg \u6587\u4ef6\u56fe\u50cf\u5185\u5bb9\u5e76\u4e0a\u4f20\u7eb9\u7406\u6e32\u67d3\u3002</p> <pre><code>    // \u5c01\u88c5 jpeg \u76f8\u5173\u64cd\u4f5c\n    JpegHelper jpegHelper;\n    // \u8bfb\u53d6\u7684\u56fe\u50cf\u5185\u5bb9\n    unsigned char *jpegData;\n    int jpegSize;\n    int jpegWidth;\n    int jpegHeight;\n    // \u8bfb\u53d6\u64cd\u4f5c\n    jpegHelper.read_jpeg_file(filePath, &amp;jpegData, &amp;jpegSize, &amp;jpegWidth, &amp;jpegHeight);\n</code></pre> <p>\u6700\u7ec8\u8981\u83b7\u53d6\u7684\u5c31\u662f <code>jpegData</code> \u56fe\u50cf\u5185\u5bb9\uff0c\u5e76\u901a\u8fc7 <code>glTexImage2D</code> \u7b49\u65b9\u6cd5\u6e32\u67d3\u5230\u7eb9\u7406\u4e0a\u3002</p> <p><code>read_jpeg_file</code> \u65b9\u6cd5\u7684\u58f0\u660e\u5982\u4e0b\uff1a</p> <pre><code>    int read_jpeg_file(const char *jpeg_file, unsigned char **rgb_buffer, \n                       int *size, int *width,int *height)\n</code></pre> <p><code>rgb_buffer</code> \u53c2\u6570\u7684\u6570\u636e\u7c7b\u578b\uff0c\u65e2\u53ef\u4ee5\u58f0\u660e\u6210 <code>unsigned char **</code> \u8fd9\u6837\u6307\u9488\u7684\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u58f0\u660e\u6210\u5f15\u7528 <code>unsigned char *&amp;</code> \uff0c\u5927\u540c\u5c0f\u5f02\u3002</p> <p>\u81f3\u4e8e\u5177\u4f53\u7684\u8bfb\u53d6\u64cd\u4f5c\uff0c\u548c\u4e0a\u9762\u7684\u89e3\u538b\u7f29\u8fc7\u7a0b\u5927\u81f4\u76f8\u540c\uff0c\u5c31\u4e0d\u5728\u9610\u8ff0\u4e00\u904d\u4e86\uff0c\u53ef\u4ee5\u67e5\u770b\u6211\u7684\u9879\u76ee\u4ee3\u7801\u5b9e\u8df5\uff1a</p> <p>https://github.com/glumes/InstantGLSL</p>","tags":["libjpeg-turbo","image"]},{"location":"opengl/libjpeg-turbo-compile-and-practice/#_5","title":"\u603b\u7ed3","text":"<p>\u81f3\u6b64\uff0c\u603b\u7ed3\u4e86\u5e38\u7528\u7684\u4e09\u79cd\u56fe\u50cf\u5e93\u7684\u7f16\u8bd1\u548c\u4f7f\u7528\u3002</p> <p>\u8fd9\u4e09\u79cd\u56fe\u50cf\u5e93\u5404\u6709\u7279\u70b9\uff0c\u8981\u6839\u636e\u5b9e\u9645\u9700\u8981\uff0c\u9009\u62e9\u6700\u5408\u9002\u7684\u3002\u4f46\u5b9e\u9645\u6211\u4eec\u7528\u5230\u7684\u65e0\u975e\u5c31\u662f\u56fe\u50cf\u7684\u8bfb\u5199\u64cd\u4f5c\u3002\u8bfb\u53d6\u7279\u5b9a\u683c\u5f0f\u56fe\u50cf\u7684\u50cf\u7d20\u5185\u5bb9\uff0c\u6216\u8005\u5c06\u50cf\u7d20\u5185\u5bb9\u5199\u5165\u7279\u5b9a\u683c\u5f0f\u6587\u4ef6\u3002</p> <p>\u5e73\u65f6\u5199 demo \uff0c\u8ffd\u6c42\u7b80\u5355\u65b9\u4fbf\u7684\uff0c\u5c31\u7528 <code>stb_image</code>\uff0c\u5bf9\u6027\u80fd\u6709\u8981\u6c42\u7684\uff0c\u9488\u5bf9\u7279\u5b9a\u683c\u5f0f\u7684\u9009\u62e9 <code>libpng</code> \u6216\u8005 <code>libjpeg-turbo</code>\u3002</p>","tags":["libjpeg-turbo","image"]},{"location":"opengl/libpng-compile-and-practice/","title":"\u56fe\u50cf\u5e93 libpng \u7f16\u8bd1\u4e0e\u5b9e\u8df5","text":"<p>\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\u4ecb\u7ecd\u4e86 <code>stb_image</code> \u56fe\u50cf\u5e93\uff0c\u8fd8\u987a\u5e26\u63d0\u5230\u4e86 libpng \u548c libjpeg \uff0c\u8fd9\u7bc7\u6587\u7ae0\u5c31\u662f\u4ecb\u7ecd\u5982\u4f55\u5728 Android \u5e73\u53f0\u4e0a\u7528 CMake \u7f16\u8bd1 libpng \u52a8\u6001\u5e93\u4ee5\u53ca libpng \u4f7f\u7528\u5b9e\u8df5\u3002</p> <p>\u3010\u7b80\u5355\u6613\u7528\u7684\u56fe\u50cf\u89e3\u7801\u5e93\u4ecb\u7ecd \u2014\u2014 stb_image\u3011</p> <p>https://glumes.com/post/android/stb-image-introduce/</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#libpng","title":"libpng \u4ecb\u7ecd","text":"<p>libpng \u7684\u5b98\u65b9\u4ecb\u7ecd\u7f51\u7ad9\u5982\u4e0b\uff1a</p> <p>http://www.libpng.org/pub/png/libpng.html</p> <p>\u4e0b\u8f7d\u5730\u5740\u7f51\u7ad9\u5982\u4e0b\uff1a</p> <p>https://sourceforge.net/projects/libpng/files/</p> <p>\u535a\u5ba2\u4e2d\u4f7f\u7528\u7684\u7248\u672c\u662f 1.6.37 \uff0c\u4e5f\u662f\u76ee\u524d\u6700\u65b0\u7684\u7248\u672c\u4e86\u3002</p> <p>\u5173\u4e8e libpng \u7684\u7f16\u8bd1\u7f51\u4e0a\u5df2\u7ecf\u6709\u4e0d\u5c11\u535a\u5ba2\u6559\u7a0b\u4e86\uff0c\u4f46\u6709\u7684\u662f\u57fa\u4e8e Linux\uff0c\u6709\u7684\u662f\u57fa\u4e8e Android.mk \u7684\uff0c\u672c\u6587\u4f1a\u4ecb\u7ecd\u5982\u4f55\u5728 Android Studio \u4e0a\u901a\u8fc7 CMake \u6765\u7f16\u8bd1 Android \u7684\u52a8\u6001\u5e93\u3002</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#cmake-libpng","title":"CMake \u7f16\u8bd1 libpng \u52a8\u6001\u5e93","text":"","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#neon","title":"neon \u76f8\u5173\u7f16\u8bd1","text":"<p>\u5728 libpng \u7684\u6e90\u4ee3\u7801\u4e2d\uff0c\u5c31\u63d0\u4f9b\u4e86 CMakeLists.txt \u6587\u4ef6\u7528\u4ee5\u8bf4\u660e\u5982\u4f55\u7f16\u8bd1\uff0c\u4f46\u662f\u5374\u4e0d\u80fd\u76f4\u63a5\u7528\u5728 Android \u5e73\u53f0\u4e0a\uff0c\u4e0d\u8fc7\u53ef\u4ee5\u501f\u9274\u5176\u6e90\u7801\u4f5c\u4e3a\u53c2\u8003\u3002</p> <p>\u7531\u4e8e CMake \u8de8\u5e73\u53f0\u7f16\u8bd1\u7684\u7279\u6027\uff0c\u4e00\u822c\u5927\u578b\u9879\u76ee\u4ee3\u7801\u7f16\u8bd1\u90fd\u4f1a\u9488\u5bf9\u5e73\u53f0\u505a\u9002\u914d\uff0c\u5e38\u89c1\u4ee3\u7801\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>    if (CMAKE_SYSTEM_PROCESSOR MATCHES \"^arm\" OR\n            CMAKE_SYSTEM_PROCESSOR MATCHES \"^aarch64\")\n        set(libpng_arm_sources\n                arm/arm_init.c\n                arm/filter_neon.S\n                arm/filter_neon_intrinsics.c\n                arm/palette_neon_intrinsics.c)\n        // \u5b9a\u4e49\u5b8f\n        add_definitions(-DPNG_ARM_NEON_OPT=2)\n    endif ()\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u5c31\u662f\u5224\u65ad\u7cfb\u7edf\u5904\u7406\u5668\u5e73\u53f0\uff0c\u4e0d\u540c\u5e73\u53f0\u6240\u9700\u8981\u7f16\u8bd1\u7684\u4ee3\u7801\u4e0d\u4e00\u6837\u3002\u800c libpng \u4f1a\u6709\u8fd9\u6837\u7684\u9002\u914d\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u5b83\u7528\u5230\u4e86 neon \u76f8\u5173\u4f18\u5316\uff0c\u8be5\u4f18\u5316\u4e3b\u8981\u662f\u7528\u5728 <code>filter</code> \u64cd\u4f5c\u65b9\u9762\u3002</p> <pre><code>// libpng \u4f7f\u7528 neon \u4f18\u5316\u52a0\u901f\u7684\u65b9\u6cd5\nvoid\npng_read_filter_row_up_neon(png_row_infop row_info, png_bytep row,\n   png_const_bytep prev_row)\n{\n   png_bytep rp = row;\n   png_bytep rp_stop = row + row_info-&gt;rowbytes;\n   png_const_bytep pp = prev_row;\n\n   png_debug(1, \"in png_read_filter_row_up_neon\");\n\n   for (; rp &lt; rp_stop; rp += 16, pp += 16)\n   {\n      uint8x16_t qrp, qpp;\n\n      qrp = vld1q_u8(rp);\n      qpp = vld1q_u8(pp);\n      qrp = vaddq_u8(qrp, qpp);\n      vst1q_u8(rp, qrp);\n   }\n}\n</code></pre> <p>\u901a\u8fc7\u67e5\u770b libpng \u6e90\u4ee3\u7801\uff0c\u8981\u542f\u7528 neon \u4f18\u5316\uff0c\u8fd8\u5fc5\u987b\u901a\u8fc7 add_definitions \u65b9\u6cd5\u5b9a\u4e49 DPNG_ARM_NEON_OPT \u5b8f\u7684\u503c\u4e3a 2 \uff0c\u5426\u5219\u5728\u6e90\u7801\u4e2d\u4f1a\u8ba4\u4e3a\u4e0d\u9700\u8981\u4f7f\u7528 neon \u3002</p> <p>\u8981\u4f7f\u7528 neon \u7f16\u8bd1\uff0c\u8fd8\u9700\u8981\u6307\u5b9a\u7f16\u8bd1\u5668\u76f8\u5173\u53c2\u6570\uff1a</p> <pre><code>set_property(SOURCE ${libpng_arm_sources}\n        APPEND_STRING PROPERTY COMPILE_FLAGS \" -mfpu=neon\")\n</code></pre> <p>\u4e0d\u8fc7\u770b\u5230\u7f51\u4e0a\u4e00\u4e9b libpng \u7f16\u8bd1\u6587\u7ae0\uff0c\u57fa\u672c\u6ca1\u63d0\u5230 neon \u76f8\u5173\u4e1c\u897f\uff0c\u4f30\u8ba1\u8fd9\u4e2a\u4f18\u5316\u52a0\u901f\u529f\u80fd\u7528\u4e0d\u4e0a\u5427\u3002</p> <p>\u4f46\u662f\uff0c\u53ef\u4ee5\u5728\u6211\u7684 Demo \u4e0a\u770b\u5230\u5982\u4f55\u542f\u7528 neon \u53bb\u7f16\u8bd1\uff0c\u4ee5\u540e\u4e5f\u4f1a\u5199\u4e13\u95e8\u7684\u6587\u7ae0\u6765\u4ecb\u7ecd neon \u7684\u4f7f\u7528~~</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#zlip","title":"zlip \u5e93\u4f9d\u8d56","text":"<p>libpng \u52a8\u6001\u5e93\u7f16\u8bd1\u8fd8\u4f9d\u8d56 zlip \u5e93\uff0c\u8981\u662f\u5728\u5176\u4ed6\u5e73\u53f0\u4e0a\u9700\u8981\u5355\u72ec\u4e0b\u8f7d\u8fd9\u4e2a\u5e93\uff0c\u4f46\u662f Android \u4e0a\u5c31\u4e0d\u9700\u8981\u4e86\uff0c\u56e0\u4e3a Android \u7f16\u8bd1\u73af\u5883\u672c\u8eab\u5c31\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u5e93\uff0c\u5c31\u50cf\u6211\u4eec\u4f7f\u7528 log \u5e93\u4e00\u6837\u3002</p> <pre><code>// \u6307\u5b9a\u8981\u7f16\u8bd1\u7684 so \u4f9d\u8d56\u54ea\u4e9b\u5176\u4ed6\u7684 so , z \u5c31\u662f zlib \u5e93\ntarget_link_libraries(png z log )\n</code></pre> <p>Android \u7f16\u8bd1\u73af\u5883\u4e2d <code>z</code> \u5c31\u662f zlip \u5e93\u4e86\u3002</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#_1","title":"\u6e90\u7801\u7f16\u8bd1","text":"<p>\u5176\u4ed6\u7684\u5c31\u662f\u6e90\u7801\u7f16\u8bd1\u4e86\uff0c\u4e3b\u8981\u662f add_library \u65b9\u6cd5\u7684\u4f7f\u7528\uff0c\u8981\u6307\u5b9a\u597d\u9700\u8981\u7f16\u8bd1\u7684\u6e90\u6587\u4ef6\u3002</p> <p>\u5177\u4f53\u6709\u54ea\u4e9b\u6e90\u6587\u4ef6\u9700\u8981\u6dfb\u52a0\u5230\u7f16\u8bd1\u4e2d\uff0c\u8fd8\u662f\u8bf7\u53c2\u8003\u5982\u4e0b\u94fe\u63a5\uff0c\u5c31\u4e0d\u8d34\u5177\u4f53\u4ee3\u7801\u4e86\uff0c\u51cf\u5c11\u6587\u7ae0\u7bc7\u5e45\u3002</p> <p>https://github.com/glumes/InstantGLSL/blob/master/instantglsl/src/main/cpp/libpng/CMakeLists.txt</p> <p>\u5b8c\u6210\u4e0a\u8ff0\u4e09\u4e2a\u8fc7\u7a0b\u540e\uff0c\u5c31\u80fd\u591f\u7f16\u8bd1\u51fa libpng \u7684\u52a8\u6001\u5e93\u4e86\uff0c\u5b9e\u9645\u7f16\u8bd1\u8fc7\u7a0b\u8fd8\u662f\u53c2\u8003\u9879\u76ee\u4ee3\u7801\u5427\u3002</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#libpng_1","title":"libpng \u7684\u4f7f\u7528\u5b9e\u8df5","text":"<p>\u7f16\u8bd1\u662f\u5c0f\u4e8b\uff0c\u91cd\u70b9\u5728\u4f7f\u7528<sub>~</sub></p> <p>\u4ee5\u89e3\u7801 png \u56fe\u7247\u83b7\u53d6\u50cf\u7d20\u5185\u5bb9\u4e3a\u4f8b\uff1a</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#linpng","title":"linpng \u521d\u59cb\u5316","text":"<p>\u9996\u5148\u662f\u521d\u59cb\u5316 libpng \uff0c\u5f97\u5230 <code>png_structp</code> \u7ed3\u6784\u4f53\u3002\u5b83\u53ef\u4ee5\u8bf4\u662f\u4ee3\u8868\u4e86 libpng \u4e0a\u4e0b\u6587\uff0c\u5728\u65b9\u6cd5\u8c03\u7528\u65f6\u90fd\u9700\u8981\u628a\u5b83\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\u3002</p> <pre><code>    // \u4f20 nullptr \u7684\u53c2\u6570\u662f\u7528\u6765\u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406\u7684\uff0c\u8fd9\u91cc\u4e0d\u9700\u8981\n    png_structp png = png_create_read_struct(PNG_LIBPNG_VER_STRING, nullptr, nullptr, nullptr);\n</code></pre> <p>\u7531\u4e8e\u662f\u8bfb\u53d6\uff0c\u65b9\u6cd5\u540d\u4e2d\u5e26\u6709 read ,\u5982\u679c\u662f\u5199\u5165\uff0c\u90a3\u5c31\u662f png_create_write_struct \u65b9\u6cd5\u4e86\u3002</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#_2","title":"\u8bbe\u7f6e\u9519\u8bef\u8fd4\u56de\u70b9","text":"<p>\u7531\u4e8e\u5728\u521b\u5efa png \u53d8\u91cf\u65f6\uff0c\u7528\u6765\u81ea\u5b9a\u4e49\u9519\u8bef\u5904\u7406\u7684\u53c2\u6570\u90fd\u4f20\u4e86 nullptr\uff0c\u6240\u4ee5\u9700\u8981\u8bbe\u7f6e\u9519\u8bef\u8fd4\u56de\u70b9\uff0c\u8fd9\u6837\u5f53 libpng \u53d1\u751f\u9519\u8bef\u65f6\uff0c\u7a0b\u5e8f\u5c06\u56de\u5230\u8fd9\u4e2a\u8c03\u7528\u70b9\uff0c\u8fd9\u65f6\u5019\u53ef\u4ee5\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff1a</p> <pre><code>    if (setjmp(png_jmpbuf(png))) {\n        png_destroy_read_struct(&amp;png, nullptr, nullptr);\n        fclose(fp);\n        return;\n    }\n</code></pre>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#png","title":"\u5224\u65ad\u6587\u4ef6\u662f\u5426\u662f png \u683c\u5f0f","text":"<p>libpng \u63d0\u4f9b\u4e86 png_sig_cmp \u65b9\u6cd5\u6765\u68c0\u67e5\u6587\u4ef6\u662f\u5426 png \u683c\u5f0f\u3002</p> <pre><code>    #define PNG_BYTES_TO_CHECK 4\n    char buf[PNG_BYTES_TO_CHECK];\n    // \u8bfb\u53d6 buffer\n    if (fread(buf, 1, PNG_BYTES_TO_CHECK, fp) != PNG_BYTES_TO_CHECK) {\n        return;\n    }\n    // \u5224\u65ad\n    if (!png_sig_cmp(reinterpret_cast&lt;png_const_bytep&gt;(buf), 0, PNG_BYTES_TO_CHECK)) {\n        // \u8fd4\u56de\u503c\u4e0d\u7b49\u4e8e 0 \u5219\u662f png \u6587\u4ef6\u683c\u5f0f\n    } \n</code></pre> <p>\u5982\u679c\u8c03\u7528\u4e86\u8be5\u65b9\u6cd5\uff0c\u9700\u8981\u901a\u8fc7 png_set_sig_bytes \u65b9\u6cd5\u544a\u8bc9 libpng \u8be5\u8df3\u8fc7\u76f8\u5e94\u7684\u6570\u636e\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u9ed1\u5c4f\uff0c\u6216\u8005\u901a\u8fc7 rewind \u65b9\u6cd5\u91cd\u7f6e\u6587\u4ef6\u6307\u9488\u3002</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#_3","title":"\u83b7\u53d6\u56fe\u50cf\u4fe1\u606f","text":"<p>\u9996\u5148\u521b\u5efa png_infop \u7ed3\u6784\u4f53\u6765\u4ee3\u8868\u56fe\u50cf\u4fe1\u606f\uff1a</p> <pre><code>    png_infop infop = png_create_info_struct(png);\n</code></pre> <p>\u7136\u540e\u662f\u8bbe\u7f6e\u56fe\u50cf\u7684\u6570\u636e\u6e90\uff0c\u524d\u63d0\u662f\u8981\u5f97\u5230\u6587\u4ef6\u8def\u5f84\uff1a</p> <pre><code>    // \u6839\u636e\u6587\u4ef6\u8def\u5f84\u6253\u5f00\u6587\u4ef6\n    FILE *fp = fopen(mFileName.c_str(), \"rb\");\n    // \u8bbe\u7f6e\u56fe\u50cf\u6570\u636e\u6e90\n    png_init_io(png, fp);\n</code></pre> <p>\u63a5\u4e0b\u6765\u662f\u8bfb\u53d6\u4fe1\u606f\uff1a</p> <pre><code>    png_read_png(png, infop,\n                 (PNG_TRANSFORM_STRIP_16 | PNG_TRANSFORM_PACKING | PNG_TRANSFORM_EXPAND),\n</code></pre> <p>\u901a\u8fc7\u5982\u4e0b\u65b9\u6cd5\uff0c\u80fd\u5f97\u5230\u56fe\u50cf\u5177\u4f53\u67d0\u65b9\u9762\u4fe1\u606f\uff1a</p> <pre><code>    mWidth = png_get_image_width(png, info);\n    mHeight = png_get_image_height(png, info);\n    mColorType = png_get_color_type(png, info);\n    mBitDepth = png_get_bit_depth(png, info);\n</code></pre> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7 png_get_IHDR \u65b9\u6cd5\u53bb\u83b7\u5f97\u4fe1\u606f</p> <pre><code>    png_get_IHDR(png, infop, &amp;mWidth, &amp;mHeight, &amp;mBitDepth, &amp;mColorType, &amp;mInterlaceType,\n                 &amp;mCompressionType, &amp;mFilterType);\n</code></pre>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#_4","title":"\u83b7\u53d6\u50cf\u7d20\u5185\u5bb9","text":"<p>\u901a\u8fc7 png_get_rows \u65b9\u6cd5\u6309\u884c\u83b7\u53d6\u6240\u6709\u7684\u6570\u636e\uff0c\u7136\u540e\u8d4b\u503c\u5230\u50cf\u7d20\u6307\u9488\u4e0a\u53bb\u3002</p> <pre><code>    // \u4ee3\u8868\u50cf\u7d20\u5185\u5bb9\u7684\u6307\u9488\n    unsigned char *mPixelData;\n    // \u83b7\u53d6\u6bcf\u884c\u7684\u5b57\u8282\u6570\u91cf\n    unsigned int row_bytes = png_get_rowbytes(png, infop);\n    mPixelData = new unsigned char[row_bytes * mHeight];\n    png_bytepp rows = png_get_rows(png, infop);\n    // \u9010\u884c\u8bfb\u53d6\uff0c\u5e76\u586b\u5145\u5230\u50cf\u7d20\u6307\u9488\u4e0a\u53bb\n    for (int i = 0; i &lt; mHeight; ++i) {\n        memcpy(mPixelData + (row_bytes * i), rows[i], row_bytes);\n    }\n</code></pre> <p>\u5176\u5b9e\u5728\u524d\u9762\u7684 png_read_png \u65b9\u6cd5\u4e2d\u5c31\u5df2\u7ecf\u5f97\u5230\u4e86\u6240\u6709\u7684\u50cf\u7d20\u5185\u5bb9\uff0c\u4fdd\u5b58\u5728 infop \u53d8\u91cf\u7684 row_pointers \u4e2d\uff0c\u5177\u4f53\u7684\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <p>\u901a\u8fc7 png_read_image \u65b9\u5f0f\u8bfb\u53d6\u50cf\u7d20\u5185\u5bb9\uff1a</p> <pre><code>    // row_pointers \u5f53\u6210\u4e86\u4e00\u7ef4\u6307\u9488\u6570\u7ec4\n    png_bytep *row_pointers;\n    row_pointers = (png_bytep *) malloc(sizeof(png_bytep) * mHeight);\n    for (int y = 0; y &lt; mHeight; y++) {\n        row_pointers[y] = (png_byte *) malloc(png_get_rowbytes(png, info));\n    }\n    png_read_image(png, row_pointers);\n</code></pre> <p>\u6700\u540e\uff0c\u522b\u5fd8\u4e86\u8c03\u7528 png_read_end \u65b9\u6cd5\u7ed3\u675f\u8bfb\u53d6\u3002</p> <p>\u6709\u4e86\u50cf\u7d20\u5185\u5bb9\uff0c\u5c31\u53ef\u4ee5\u505a\u4e00\u4e2a\u5e38\u89c1\u7684\u6e32\u67d3\u64cd\u4f5c\u4e86\uff0c\u5c06\u50cf\u7d20\u5185\u5bb9\u6e32\u67d3\u7ed8\u5236\u5230\u7eb9\u7406\u4e0a\u3002</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#_5","title":"\u4fdd\u5b58\u56fe\u7247","text":"<p>\u6700\u540e\u4ecb\u7ecd\u5982\u4f55\u6839\u636e\u50cf\u7d20\u5185\u5bb9\u53bb\u4fdd\u5b58\u56fe\u7247\uff0c\u5728 libpng \u4e2d\u4e5f\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684\u65b9\u6cd5\u8c03\u7528\uff0c\u6d41\u7a0b\u5c31\u662f\u5982\u4e0b\u65b9\u6cd5\uff1a</p> <pre><code>    png = png_create_write_struct()\n    infop = png_create_info_struct()\n    // \u5173\u8054\u6570\u636e\u6e90\uff0cpng \u548c\u8981\u5199\u5165\u7684\u6587\u4ef6\n    png_init_io(png,fp)\n    // \u8bbe\u7f6e infop \u76f8\u5173\u53c2\u6570\uff0c\u4ee3\u8868\u6700\u597d\u8981\u751f\u6210\u7684\u56fe\u7247\u6587\u4ef6\u76f8\u5173\u4fe1\u606f\n    png_set_IHDR()\n    // \u5199\u5165\u56fe\u7247\u4fe1\u606f\n    png_write_info(png, infop);\n    // \u5199\u5165\u56fe\u7247\u50cf\u7d20\u5185\u5bb9\n    png_write_image(png, row_pointers);\n    // \u7ed3\u675f\u5199\u5165\n    png_write_end(png, NULL);\n</code></pre> <p>\u6d41\u7a0b\u548c\u8bfb\u53d6\u50cf\u7d20\u5185\u5bb9\u6070\u597d\u76f8\u53cd\u3002</p> <p>\u5176\u4e2d png \u53d8\u91cf\u8981\u901a\u8fc7 png_create_write_struct \u521b\u5efa\u3002</p> <p>infop \u53d8\u91cf\u8fd8\u662f png_create_info_struct \u65b9\u6cd5\u521b\u5efa\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u8bbe\u7f6e\u56fe\u7247\u4fe1\u606f\uff0c\u5199\u5165\u56fe\u7247\u4fe1\u606f\uff0c\u5199\u5165\u50cf\u7d20\u5185\u5bb9\uff0c\u5177\u4f53\u7684\u4ee3\u7801\u5b9e\u8df5\u53ef\u4ee5\u53c2\u8003\u6211\u7684\u4ee3\u7801\u793a\u4f8b\u3002</p>","tags":["libpng","image"]},{"location":"opengl/libpng-compile-and-practice/#_6","title":"\u53c2\u8003","text":"<p>\u6700\u540e\uff0c\u5728 libpng \u7684\u6e90\u4ee3\u7801\u4e2d\uff0c\u4e5f\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u793a\u4f8b\uff0c\u4e00\u822c\u8fd9\u79cd\u5f00\u6e90\u5e93\u90fd\u4f1a\u63d0\u4f9b\u76f8\u5e94\u7684 test \u4ee3\u7801\uff0c\u901a\u8fc7 test \u4ee3\u7801\u57fa\u672c\u90fd\u80fd\u627e\u5230\u76f8\u5e94\u7684\u51fd\u6570\u8c03\u7528\u3002</p> <p>libpng \u7684\u5b98\u7f51\u793a\u4f8b\u5730\u5740\u5982\u4e0b\uff1a</p> <p>http://www.libpng.org/pub/png/libpng-manual.txt</p> <p>\u6709\u7591\u95ee\u7684\u8bdd\uff0c\u57fa\u672c\u90fd\u53ef\u4ee5\u5728\u8fd9\u4e2a\u4e0a\u9762\u627e\u5230\u7b54\u6848\u3002</p>","tags":["libpng","image"]},{"location":"opengl/load-texture-from-android-assets-by-ndk/","title":"Android NDK \u5f00\u53d1 \u2014\u2014 \u4ece Assets \u6587\u4ef6\u5939\u52a0\u8f7d\u56fe\u7247\u5e76\u4e0a\u4f20\u7eb9\u7406","text":"<p>\u5728 OpenGL \u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u8981\u6e32\u67d3\u4e00\u5f20\u56fe\u7247\uff0c\u901a\u5e38\u5148\u662f\u5f97\u5230\u4e00\u5f20\u56fe\u7247\u5bf9\u5e94\u7684 Bitmap ,\u7136\u540e\u5c06\u8be5 Bitmap \u4f5c\u4e3a\u7eb9\u7406\u4e0a\u4f20\u5230 OpenGL \u4e2d\u3002\u5728 Android \u4e2d\u6709\u5c01\u88c5\u597d\u7684 <code>GLUtils</code> \u7c7b\u7684 <code>texImage2D</code> \u65b9\u6cd5\u4f9b\u6211\u4eec\u8c03\u7528\u3002</p> <pre><code>    public static void texImage2D(int target, int level, int internalformat,\n            Bitmap bitmap, int type, int border)\n</code></pre> <p>\u8be5\u65b9\u6cd5\u7684\u5e95\u5c42\u539f\u7406\u5b9e\u9645\u4e0a\u4e5f\u662f\u89e3\u6790\u4e86\u8be5 Bitmap \uff0c\u5f97\u5230\u4e86 Bitmap \u6240\u6709\u7684\u50cf\u7d20\u6570\u636e\uff0c\u7c7b\u4f3c\u4e8e Android NDK \u5173\u4e8e Bitmap \u64cd\u4f5c\u7684 <code>AndroidBitmap_lockPixels</code> \u65b9\u6cd5\uff0c\u5982\u679c\u4f60\u4e0d\u592a\u4e86\u89e3\u8be5\u65b9\u6cd5\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1aAndroid JNI \u4e4b Bitmap \u64cd\u4f5c\u3002</p> <p>\u5f97\u5230\u4e86\u6240\u6709\u50cf\u7d20\u6570\u636e\u4e4b\u540e\uff0c\u5b9e\u9645\u6700\u7ec8\u8fd8\u662f\u8c03\u7528\u4e86 OpenGL \u7684 <code>glTexImage2D</code> \u6765\u5b9e\u73b0\u7eb9\u7406\u4e0a\u4f20\u3002\u5f53\u7136\uff0c\u5982\u679c\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u6240\u6709\u6570\u636e\uff0c\u4e5f\u4e0d\u9700\u8981\u8d70\u89e3\u6790 Bitmap \u8fd9\u4e00\u6b65\u4e86\uff0c\u8fd9\u79cd\u573a\u666f\u6700\u5e38\u89c1\u7684\u5c31\u662f\u628a\u76f8\u673a\u4f5c\u4e3a\u8f93\u5165\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u4f1a\u901a\u8fc7 Android NDK \u5f00\u53d1\u4e2d\u53bb\u6e32\u67d3\u4e00\u5f20\u56fe\u7247\uff0c\u6b65\u9aa4\u8fd8\u662f\u5982\u4e0a\uff0c\u4ece\u56fe\u50cf\u89e3\u6790\u5230\u7eb9\u7406\u4e0a\u4f20\uff0c\u4e0d\u540c\u7684\u662f\u6211\u4eec\u5c06\u4f1a\u89e3\u6790 Assets \u6587\u4ef6\u5939\u4e2d\u7684\u56fe\u7247\uff0c\u800c\u4e0d\u662f\u4e00\u5f20\u5df2\u7ecf\u4fdd\u5b58\u5728\u624b\u673a SDCard \u4e0a\u7684\u56fe\u7247\u3002</p> <p>\u76f8\u6bd4\u4e8e\u524d\u8005\uff0cSDCard \u4e0a\u7684\u56fe\u7247\u5df2\u7ecf\u6709\u4e86\u7edd\u5bf9\u5730\u5740\u4e86\uff0c\u76f4\u63a5\u628a\u5730\u5740\u4f20\u5230 <code>stb_image</code> \u5e93\u5c31\u53ef\u4ee5\u5b8c\u6210\u89e3\u6790\u4e86\uff08\u53c2\u8003\u4e4b\u524d\u7684\u6587\u7ae0 \uff09\uff0c\u800c <code>Assets</code> \u6587\u4ef6\u5939\u7684\u5185\u5bb9\u5728\u624b\u673a\u4e0a\u53ef\u6ca1\u6709\u7edd\u5bf9\u5730\u5740\u54e6\uff0c\u4e0d\u4fe1\u4f60\u4ed4\u7ec6\u56de\u60f3\uff0c\u53ef\u66fe\u5728\u770b\u5230\u8fc7 APK \u5b89\u88c5\u540e Assets \u6587\u4ef6\u5939\u5bf9\u5e94\u7684\u5185\u5bb9\uff1f</p> <p>\u4e00\u5f00\u59cb\u9677\u5165\u4e86\u8bef\u533a\uff0c\u60f3\u7740\u600e\u4e48\u53bb\u83b7\u5f97\u6587\u4ef6\u7684\u7edd\u5bf9\u5730\u5740\uff0c\u770b\u5230\u4e86 AssetManager \u7684 AAsset_openFileDescriptor \u65b9\u6cd5\u4ee5\u4e3a\u62ff\u5230\u6587\u4ef6\u63cf\u8ff0\u7b26\u5c31\u4e07\u4e8b\u5927\u5409\u4e86\uff0c\u7ed3\u679c\u6253\u5370\u7684\u5730\u5740\u662f\u8fd9\u6837\u7684 <code>/proc/9941/fd/79</code> \uff0c\u8fd9\u57fa\u672c\u7684\u4e0d\u53ef\u7528\u4e86\u3002</p> <p>\u6362\u4e2a\u601d\u8def\uff0c\u5728 Java \u4e2d\u53bb\u52a0\u8f7d Assets \u76ee\u5f55\u4e0b\u7684\u56fe\u7247\uff1a</p> <pre><code>InputStream is = getAssets().open(fileName); \n</code></pre> <p>\u901a\u8fc7 AssertManager \u7684 open \u65b9\u6cd5\u76f4\u63a5\u62ff\u5230\u6587\u4ef6\u7684\u8f93\u5165\u6d41\u4e86\u3002</p> <p>\u800c\u5728 NDK \u5f00\u53d1\u4e2d\u540c\u6837\u7684\u65b9\u5f0f\u662f\u884c\u4e0d\u901a\u7684\uff0c\u8fd9\u91cc\u8981\u91c7\u7528\u53e6\u5916\u4e00\u79cd\u65b9\u5f0f\uff0c\u4f46\u5176\u5b9e\u610f\u601d\u90fd\u5dee\u4e0d\u591a\u7684\uff1a</p> <pre><code>    // NDK \u4e2d\u662f AssetManager\n    AAssetManager *mgr = AAssetManager_fromJava(env, assetManager);\n    // \u6253\u5f00 Asset \u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6\n    AAsset *pathAsset = AAssetManager_open(mgr, assetPath, AASSET_MODE_UNKNOWN);\n    // \u5f97\u5230\u6587\u4ef6\u7684\u957f\u5ea6\n    off_t assetLength = AAsset_getLength(pathAsset);\n    // \u5f97\u5230\u6587\u4ef6\u5bf9\u5e94\u7684 Buffer\n    unsigned char *fileData = (unsigned char *) AAsset_getBuffer(pathAsset);\n    // stb_image \u7684\u65b9\u6cd5\uff0c\u4ece\u5185\u5b58\u4e2d\u52a0\u8f7d\u56fe\u7247\n    unsigned char *contnet = stbi_load_from_memory(fileData, assetLength, &amp;w, &amp;h, &amp;n, 0);\n</code></pre> <p>NDK \u4e2d\u53ef\u62ff\u4e0d\u5230\u50cf Java \u90a3\u6837\u7684\u8f93\u5165\u6d41\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7 AssetManager \u7684 AAsset_getBuffer \u6216\u8005\u662f AAsset_read \u65b9\u6cd5\u53bb\u83b7\u53d6\u6587\u4ef6\u5185\u5bb9\u3002</p> <p>\u770b\u5230\u4e0a\u9762\u90a3\u4e24\u4e2a API \u57fa\u672c\u5c31\u7a33\u4e86\uff0c\u518d\u914d\u5408 <code>stb_image</code> \u4ecb\u7ecd\u8fc7\u7684\u65b9\u6cd5\uff0c<code>stbi_load_from_memory</code> \u4ece\u5185\u5b58\u4e2d\u52a0\u8f7d\u56fe\u7247\u7684\u50cf\u7d20\u6570\u636e\uff0c\u6700\u540e\u5c31\u662f glTexImage2D \u65b9\u6cd5\u5b9e\u73b0\u7eb9\u7406\u4e0a\u4f20\u3002</p> <p>\u5177\u4f53\u7684\u4ee3\u7801\u5b9e\u8df5\u53c2\u8003\u9879\u76ee\uff1a</p> <p>https://github.com/glumes/InstantGLSL</p>","tags":["JNI"]},{"location":"opengl/opengl-axially-aligned-bounding-box/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b\u78b0\u649e\u68c0\u6d4b\u4e4b AABB \u5305\u56f4\u76d2","text":"<p>\u5728 OpenGL \u7684\u4e16\u754c\u6a21\u578b\u4e2d\uff0c\u540c\u65f6\u7ed8\u5236\u4e86\u591a\u4e2a\u7269\u4f53\uff0c\u90a3\u4e48\u600e\u4e48\u53bb\u68c0\u6d4b\u7269\u4f53\u4e4b\u95f4\u662f\u5426\u89e6\u78b0\u4e86\uff0c\u4e0d\u540c\u4e8e\u5728\u5e73\u9762\u4e4b\u95f4\u7684\u89e6\u78b0\uff0cOpenGL \u662f\u5728\u4e09\u7ef4\u4e16\u754c\u91cc\u9762\u7684\u89e6\u78b0\uff0c\u63a5\u4e0b\u6765\u5c31\u7ee7\u7eed\u6df1\u5165\u7406\u89e3 OpenGL \u4e2d\u7684\u78b0\u649e\u68c0\u6d4b\u76f8\u5173\u77e5\u8bc6<sub>~</sub></p>","tags":["OpenGL"]},{"location":"opengl/opengl-axially-aligned-bounding-box/#_1","title":"\u78b0\u649e\u68c0\u6d4b\u5b9e\u73b0\u539f\u7406","text":"<p>\u8fdb\u884c\u78b0\u649e\u68c0\u6d4b\u65f6\u6700\u76f4\u89c2\u548c\u6700\u7cbe\u786e\u7684\u65b9\u5f0f\u5c31\u662f\u91c7\u7528\u7ec4\u6210\u7269\u4f53\u7684\u4e09\u89d2\u5f62\u6765\u8fdb\u884c\uff0c\u5c06\u5f85\u68c0\u6d4b\u7684\u4e24\u4e2a\u7269\u4f53\u7684\u4e09\u89d2\u5f62\u7ec4\u4e2d\u7684\u4e09\u89d2\u5f62\u4e24\u4e24\u8fdb\u884c\u76f8\u4ea4\u6027\u68c0\u6d4b\uff0c\u82e5\u6709\u4efb\u610f\u4e00\u5bf9\u4e09\u89d2\u5f62\u76f8\u4ea4\u5219\u7269\u4f53\u6784\u6210\u78b0\u649e\uff0c\u5426\u5219\u7269\u4f53\u4e0d\u6784\u6210\u78b0\u649e\u3002</p> <p>\u8fd9\u6837\u7684\u601d\u8def\u5f88\u76f4\u89c2\uff0c\u4f46\u662f\u8ba1\u7b97\u91cf\u5927\uff0c\u5728\u4e00\u822c\u8bbe\u5907\u4e0a\u662f\u96be\u4ee5\u5b9e\u65bd\u7684\u3002</p> <p>\u901a\u8fc7\u4e00\u79cd\u7b80\u5316\u7684\u601d\u8def\u6765\u95f4\u63a5\u5b9e\u73b0\u78b0\u649e\u68c0\u6d4b\uff0c\u91c7\u7528 <code>AABB \uff08Axially Aligned Bounding Box\uff09</code>\u5305\u56f4\u76d2\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002</p> <p>AABB \u5305\u56f4\u76d2\u5c31\u662f\u91c7\u7528\u4e00\u4e2a\u957f\u65b9\u4f53\u5c06\u7269\u4f53\u5305\u88f9\u8d77\u6765\uff0c\u8fdb\u884c\u4e24\u4e2a\u7269\u4f53\u7684\u76f8\u4ea4\u6027\u68c0\u6d4b\u65f6\u4ec5\u68c0\u6d4b\u7269\u4f53\u5bf9\u5e94\u5305\u56f4\u76d2\uff08\u5305\u88f9\u7269\u4f53\u7684\u957f\u65b9\u4f53\uff09\u7684\u76f8\u4ea4\u6027\u3002</p> <p>\u53e6\u5916\uff0cAABB \u5305\u56f4\u76d2\u6709\u4e00\u4e2a\u91cd\u8981\u7279\u6027\uff0c\u90a3\u5c31\u662f\u5305\u56f4\u76d2\u5bf9\u5e94\u7684\u957f\u65b9\u4f53\u6bcf\u4e00\u4e2a\u9762\u90fd\u662f\u4e0e\u67d0\u4e2a\u5750\u6807\u8f74\u5e73\u9762\u5e73\u884c\u7684\uff0c\u56e0\u6b64\uff0cAABB \u5305\u56f4\u76d2\u53c8\u79f0\u4e86 <code>\u8f74\u5bf9\u9f50\u5305\u56f4\u76d2</code> \u3002</p> <p>\u5bf9\u4e8e\u4e0d\u540c\u7269\u4f53\u5305\u56f4\u76d2\u76f4\u63a5\u793a\u4f8b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6709\u4e86\u4e0a\u8ff0\u7ea6\u5b9a\u540e\uff0c\u786e\u5b9a AABB \u5305\u56f4\u76d2\u5c31\u7b80\u5355\u591a\u4e86\uff0c\u4ec5\u9700\u8981\u8bb0\u5f55 6 \u4e2a\u503c\u5373\u53ef\uff0c\u8fd9 6 \u4e2a\u503c\u5206\u522b\u4ee3\u8868\u5305\u56f4\u76d2\u5728\u6bcf\u4e2a\u5750\u6807\u8f74\u4e0a\u7684\u6700\u5c0f\u503c\u4e0e\u6700\u5927\u503c\uff0c\u5373 \\(x\\_{min}\\)\u3001\\(x\\_{max}\\)\u3001\\(y\\_{min}\\)\u3001\\(y\\_{max}\\)\u3001\\(z\\_{min}\\)\u3001\\(z\\_{max}\\)\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b9e\u9645\u7269\u4f53\u4e0a\u6240\u6709\u7684\u70b9\u90fd\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff1a</p> \\[ x\\_{min}  \\le x  \\le x\\_{max} $$ $$ y\\_{min}  \\le y  \\le y\\_{max} $$ $$ z\\_{min}  \\le z  \\le z\\_{max} \\] <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u5c06\u8868\u793a AABB \u5305\u56f4\u76d2\u7684 6 \u4e2a\u53c2\u6570\u5206\u4e3a\u4ee5\u4e0b\u4e24\u7ec4\uff1a</p> \\[P\\_{min} = [x\\_{min} , y\\_{min} , z\\_{min}]$$ $$P\\_{max} = [x\\_{max} , y\\_{max} , z\\_{max}]\\] <p>\u5176\u4e2d\uff0c\\(P\\_{min}\\) \u662f 3 \u4e2a\u8f74\u5750\u6807\u6700\u5c0f\u503c\u7684\u96c6\u5408\uff0c$P_{max} $ \u662f 3 \u4e2a\u8f74\u5750\u6807\u6700\u5927\u503c\u7684\u96c6\u5408\u3002</p> <p>\u77e5\u9053\u4e86\u8868\u793a AABB \u5305\u56f4\u76d2\u7684 6 \u4e2a\u53c2\u6570\u540e\u5c31\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u6c42\u5f97 AABB \u5305\u56f4\u76d2\u7684\u51e0\u4f55\u4e2d\u5fc3\uff0c\u516c\u5f0f\u5982\u4e0b\uff1a</p> \\[c=(P\\_{min} + P\\_{max})  /  2\\]","tags":["OpenGL"]},{"location":"opengl/opengl-axially-aligned-bounding-box/#aabb","title":"AABB \u5305\u56f4\u76d2\u8ba1\u7b97","text":"<p>\u4e86\u89e3\u4e86 AABB \u5305\u56f4\u76d2\u7684\u539f\u7406\u4e4b\u540e\uff0c\u6c42 AABB \u5305\u56f4\u76d2 6 \u4e2a\u53c2\u6570\u7684\u65b9\u6cd5\u5c31\u7b80\u5355\u591a\u4e86\uff0c\u53ea\u9700\u8981\u5bf9\u7269\u4f53\u4e2d\u7684\u6240\u6709\u9876\u70b9\u5750\u6807\u8fdb\u884c\u626b\u63cf\uff0c\u6c42\u51fa\u5404\u4e2a\u8f74\u5206\u91cf\u7684\u6700\u5927\u503c\u4e0e\u6700\u5c0f\u503c\u5373\u53ef\u3002</p> <p>\u9996\u5148\u5f15\u5165\u4e00\u4e2a\u8f85\u52a9\u7c7b <code>Vector3f</code>\uff0c\u5176\u5bf9\u8c61\u53ef\u4ee5\u8bb0\u5f55 3 \u4e2a\u6d6e\u70b9\u6570\u7ec4\u6210\u7684\u4e09\u5143\u7ec4\uff0c\u7528\u6765\u8868\u793a\u7269\u4f53\u7684\u4f4d\u7f6e\u3001\u901f\u5ea6\u7b49\u3002</p> <pre><code>public class Vector3f {\n    float x;//\u4e09\u7ef4\u53d8\u91cf\u4e2d\u7684x\u503c\n    float y;//\u4e09\u7ef4\u53d8\u91cf\u4e2d\u7684y\u503c\n    float z;//\u4e09\u7ef4\u53d8\u91cf\u4e2d\u7684z\u503c\n    public Vector3f(float x,float y,float z)\n    {\n        this.x=x;\n        this.y=y;\n        this.z=z;\n    }\n    public void add(Vector3f temp)\n    {\n        this.x+=temp.x;\n        this.y+=temp.y;\n        this.z+=temp.z;\n    }\n}\n</code></pre> <p>\u6709\u4e86\u6b64\u8f85\u52a9\u7c7b\u4e4b\u540e\uff0c\u7269\u4f53\u7684\u4f4d\u7f6e\u3001\u901f\u5ea6\u7b49\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u6b64\u7c7b\u7684\u5bf9\u8c61\u8868\u793a\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u8ba1\u7b97\u7269\u4f53\u7684 AABB \u5305\u56f4\u76d2\uff0c\u5b9a\u4e49\u4e00\u4e2a\u5bf9\u8c61 AABBBox \u6765\u8868\u793a\u5305\u56f4\u76d2\u3002</p> <pre><code>public class AABBBox {\n    float minX;//x\u8f74\u6700\u5c0f\u4f4d\u7f6e\n    float maxX;//x\u8f74\u6700\u5927\u4f4d\u7f6e\n    float minY;//y\u8f74\u6700\u5c0f\u4f4d\u7f6e\n    float maxY;//y\u8f74\u6700\u5927\u4f4d\u7f6e\n    float minZ;//z\u8f74\u6700\u5c0f\u4f4d\u7f6e\n    float maxZ;//z\u8f74\u6700\u5927\u4f4d\u7f6e\n\n    public AABBBox(float[] vertices)\n    {\n        init();\n        findMinAndMax(vertices);\n    }\n\n    public AABBBox(float minX,float maxX,float minY,float maxY,float minZ,float maxZ)\n    {\n        this.minX=minX;\n        this.maxX=maxX;\n        this.minY=minY;\n        this.maxY=maxY;\n        this.minZ=minZ;\n        this.maxZ=maxZ;\n    }\n    //\u521d\u59cb\u5316\u5305\u56f4\u76d2\u7684\u6700\u5c0f\u4ee5\u53ca\u6700\u5927\u9876\u70b9\u5750\u6807\n    public void init()\n    {\n        minX=Float.POSITIVE_INFINITY;\n        maxX=Float.NEGATIVE_INFINITY;\n        minY=Float.POSITIVE_INFINITY;\n        maxY=Float.NEGATIVE_INFINITY;\n        minZ=Float.POSITIVE_INFINITY;\n        maxZ=Float.NEGATIVE_INFINITY;\n    }\n    //\u83b7\u53d6\u5305\u56f4\u76d2\u7684\u5b9e\u9645\u6700\u5c0f\u4ee5\u53ca\u6700\u5927\u9876\u70b9\u5750\u6807\n    public void findMinAndMax(float[] vertices)\n    {\n        for(int i=0;i&lt;vertices.length/3;i++)\n        {\n            //\u5224\u65adX\u8f74\u7684\u6700\u5c0f\u548c\u6700\u5927\u4f4d\u7f6e\n            if(vertices[i*3]&lt;minX)\n            {\n                minX=vertices[i*3];\n            }\n            if(vertices[i*3]&gt;maxX)\n            {\n                maxX=vertices[i*3];\n            }\n            //\u5224\u65adY\u8f74\u7684\u6700\u5c0f\u548c\u6700\u5927\u4f4d\u7f6e\n            if(vertices[i*3+1]&lt;minY)\n            {\n                minY=vertices[i*3+1];\n            }\n            if(vertices[i*3+1]&gt;maxY)\n            {\n                maxY=vertices[i*3+1];\n            }\n            //\u5224\u65adZ\u8f74\u7684\u6700\u5c0f\u548c\u6700\u5927\u4f4d\u7f6e\n            if(vertices[i*3+2]&lt;minZ)\n            {\n                minZ=vertices[i*3+2];\n            }\n            if(vertices[i*3+2]&gt;maxZ)\n            {\n                maxZ=vertices[i*3+2];\n            }\n        }\n    }\n    //\u83b7\u5f97\u7269\u4f53\u5e73\u79fb\u540e\u7684AABB\u5305\u56f4\u76d2\n    public AABBBox getCurrAABBBox(Vector3f currPosition)\n    {\n        AABBBox result=new AABBBox\n                (\n                        this.minX+currPosition.x,\n                        this.maxX+currPosition.x,\n                        this.minY+currPosition.y,\n                        this.maxY+currPosition.y,\n                        this.minZ+currPosition.z,\n                        this.maxZ+currPosition.z\n                );\n        return result;\n    }\n}\n</code></pre> <p>\u5728 AABBBox \u7684\u6784\u9020\u51fd\u6570\u4e2d\u9700\u8981\u4f20\u5165\u7269\u4f53\u7684\u9876\u70b9\u5e8f\u5217\uff0c\u5728\u8fd9\u4e9b\u5e8f\u5217\u4e2d\u5206\u522b\u627e\u51fa x \u3001y\u3001z \u5750\u6807\u7684\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165\u5305\u56f4\u76d2\u7684 6 \u4e2a\u9876\u70b9\u53c2\u6570\u3002</p> <p>\u5982\u679c\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7269\u4f53\u53d1\u751f\u4e86\u79fb\u52a8\uff0c\u90a3\u5c31\u9700\u8981\u6839\u636e\u79fb\u52a8\u540e\u7684\u4f4d\u7f6e\u8ba1\u7b97\u4ea7\u751f\u65b0\u5305\u56f4\u76d2\u5bf9\u8c61\uff0c<code>getCurrAABBBox</code>\u65b9\u6cd5\u9700\u8981\u4f20\u9012\u7269\u4f53\u79fb\u52a8\u540e\u4f4d\u7f6e\u7684 3 \u4e2a\u5750\u6807\u5206\u91cf\uff0c\u7528\u4e8e\u4e0e\u539f\u59cb\u5305\u56f4\u76d2\u7684 6 \u4e2a \u53c2\u6570\u8fdb\u884c\u8fd0\u7b97\uff0c\u4ea7\u751f\u79fb\u52a8\u540e\u5305\u56f4\u76d2\u7684 6 \u4e2a\u53c2\u6570\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-axially-aligned-bounding-box/#aabb_1","title":"AABB \u5305\u56f4\u76d2\u7684\u78b0\u649e\u68c0\u6d4b","text":"<p>\u5728\u4e0a\u9762\u6c42\u5f97\u4e86\u7269\u4f53\u7684\u5305\u56f4\u76d2\uff0c\u6c42\u5305\u56f4\u76d2\u7684\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u7b80\u5316\u7269\u4f53\u8fd0\u52a8\u8fc7\u7a0b\u4e2d\u7684\u78b0\u649e\u68c0\u6d4b\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4ecb\u7ecd AABB \u5305\u56f4\u76d2\u78b0\u649e\u68c0\u6d4b\u7684\u7b56\u7565\uff0c\u539f\u7406\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7531\u4e8e\u4efb\u4f55\u4e00\u4e2a AABB \u5305\u56f4\u76d2\u7684\u5404\u4e2a\u9762\u90fd\u5e73\u884c\u4e8e\u5750\u6807\u5e73\u9762\uff0c\u56e0\u6b64\u5224\u65ad\u4e24\u4e2a AABB \u5305\u56f4\u76d2\u662f\u5426\u53d1\u751f\u78b0\u649e\u4ec5\u9700\u8981\u5206\u522b\u5224\u65ad 3 \u4e2a\u8f74\u65b9\u5411\u7684\u4ea4\u53e0\u90e8\u5206\u5927\u5c0f\u662f\u5426\u5927\u4e8e\u8bbe\u5b9a\u7684\u9608\u503c\uff0c\u82e5\u5927\u4e8e\u5219\u53d1\u751f\u4e86\u78b0\u649e\uff0c\u5426\u5219\u6ca1\u6709\u53d1\u751f\u78b0\u649e\u3002</p> <p>\u5177\u4f53\u78b0\u649e\u68c0\u6d4b\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>    public boolean check(RigidBody ra, RigidBody rb)//true\u4e3a\u649e\u4e0a\n    {\n        float[] over = calOverTotal\n                (\n                    // \u4e24\u4e2a\u7269\u4f53\u7684 AABB \u5305\u56f4\u76d2\n                        ra.collObject.getCurrAABBBox(ra.currLocation),\n                        rb.collObject.getCurrAABBBox(rb.currLocation)\n                );\n        // \u4e09\u4e2a\u65b9\u5411\u7684\u4ea4\u53e0\u503c\u4e0e\u8bbe\u5b9a\u7684\u9608\u503c\u8fdb\u884c\u6bd4\u8f83\n        return over[0] &gt; V_UNIT &amp;&amp; over[1] &gt; V_UNIT &amp;&amp; over[2] &gt; V_UNIT;\n    }\n\n    // \u4f20\u5165\u4e24\u4e2a\u7269\u4f53\u7684 AABB \u5305\u56f4\u76d2\n    public float[] calOverTotal(AABBBox a, AABBBox b) {\n        float xOver = calOverOne(a.maxX, a.minX, b.maxX, b.minX);\n        float yOver = calOverOne(a.maxY, a.minY, b.maxY, b.minY);\n        float zOver = calOverOne(a.maxZ, a.minZ, b.maxZ, b.minZ);\n        return new float[]{xOver, yOver, zOver};\n    }\n    // \u8ba1\u7b97\u6bcf\u4e2a\u8f74\u65b9\u5411\u7684\u4ea4\u53e0\u503c\n    public float calOverOne(float amax, float amin, float bmax, float bmin) {\n        float minMax = 0;\n        float maxMin = 0;\n        if (amax &lt; bmax)//a\u7269\u4f53\u5728b\u7269\u4f53\u5de6\u4fa7\n        {\n            minMax = amax;\n            maxMin = bmin;\n        } else //a\u7269\u4f53\u5728b\u7269\u4f53\u53f3\u4fa7\n        {\n            minMax = bmax;\n            maxMin = amin;\n        }\n\n        if (minMax &gt; maxMin) {\n            return minMax - maxMin;\n        } else {\n            return 0;\n        }\n    }\n</code></pre> <p>\u5728 calOverTotal \u65b9\u6cd5\u91cc\u9762\u8981\u4f20\u5165\u4e24\u4e2a\u7269\u4f53\u7684 AABB \u5305\u56f4\u76d2\u3002</p> <p>\u7136\u540e\u5728 calOverOne \u65b9\u6cd5\u91cc\u9762\u5206\u522b\u8ba1\u7b97\u4e24\u4e2a\u5305\u56f4\u76d2 3 \u4e2a\u8f74\u7684\u4ea4\u53e0\u503c\uff0c\u601d\u8def\u5c31\u662f\u5148\u6bd4\u8f83\u4e24\u4e2aAABB \u5305\u56f4\u76d2\u5728\u5bf9\u5e94\u8f74\u7684\u6700\u5927\u5206\u91cf\uff0c\u6b64\u6bd4\u8f83\u662f\u4e3a\u4e86\u5f97\u51fa\u4e24\u4e2a\u7269\u4f53\u7684\u65b9\u4f4d\uff0c\u54ea\u4e2a\u7269\u4f53\u5728\u6b64\u8f74\u7684\u6b63\u65b9\u5411\u90a3\u4e00\u4fa7\u3002\u7136\u540e\u7528\u5728\u8f74\u6b63\u65b9\u5411\u7684\u90a3\u4e00\u4fa7\u7269\u4f53\u7684\u5750\u6807\u6700\u5c0f\u503c\u51cf\u53bb\u5728\u8f74\u8d1f\u65b9\u5411\u90a3\u4e00\u4fa7\u7684\u7269\u4f53\u7684\u6700\u5927\u503c\uff0c\u5982\u679c\u4e3a\u8d1f\u6570\uff0c\u5219\u8bf4\u660e\u6ca1\u6709\u53d1\u751f\u4ea4\u53e0\uff0c\u5982\u679c\u5176\u503c\u4e3a\u6b63\u6570\uff0c\u5219\u8bf4\u660e\u4e24\u4e2a\u7269\u4f53\u53d1\u751f\u4e86\u4ea4\u53e0\uff0c\u4ea4\u53e0\u503c\u548c\u8bbe\u5b9a\u7684\u9608\u503c\u8fdb\u884c\u6bd4\u8f83\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-axially-aligned-bounding-box/#_2","title":"\u5b9e\u8df5","text":"<p>\u5177\u4f53\u7684\u5b9e\u8df5\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5728\u6548\u679c\u56fe\u4e2d\uff0c\u6709\u4e2a\u4e24\u4e2a\u9759\u6b62\u4e0d\u540c\u7684\u7269\u4f53\uff0c\u4e00\u4e2a\u6765\u56de\u8fd0\u52a8\u78b0\u649e\u7684\u7269\u4f53\u3002</p> <p>\u5728\u5f00\u53d1\u4e0a\u8ff0\u6548\u679c\u4e2d\uff0c\u4f1a\u5b9a\u4e49\u4e00\u4e2a RigidBody \u521a\u4f53\u7c7b\uff0c\u5b83\u7531\u4e24\u4e2a\u91cd\u8981\u7684\u6210\u5458\uff0c\u5c31\u662f\u6211\u4eec\u7684\u7ed8\u5236\u7269\u4f53\u548c\u5b83\u7684 AABB \u5305\u56f4\u76d2\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6e32\u67d3\u8005\u6307\u7684\u5c31\u662f\u7528\u6765\u6e32\u67d3\u7684\u7269\u4f53\uff0c\u78b0\u649e\u8005\u6307\u7684\u5c31\u662f\u7269\u4f53\u7684 AABB \u5305\u56f4\u76d2\uff0c\u5b83\u4eec\u5171\u540c\u7ec4\u6210\u4e86\u521a\u4f53 RigidBody \u3002</p> <p>RigidBody \u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public class RigidBody {\n    CollisionObject renderObject;//\u6e32\u67d3\u8005\n    AABBBox collObject;//\u78b0\u649e\u8005\n    boolean isStatic;//\u662f\u5426\u9759\u6b62\u7684\u6807\u5fd7\u4f4d\n    Vector3f currLocation;//\u4f4d\u7f6e\u4e09\u7ef4\u53d8\u91cf\n    Vector3f currV;//\u901f\u5ea6\u4e09\u7ef4\u53d8\u91cf\n    final float V_UNIT = 0.02f;//\u9608\u503c\n\n    public RigidBody(CollisionObject renderObject, boolean isStatic, Vector3f currLocation, Vector3f currV) {\n        this.renderObject = renderObject;\n        collObject = new AABBBox(renderObject.vertices);\n        this.isStatic = isStatic;\n        this.currLocation = currLocation;\n        this.currV = currV;\n    }\n\n    public void drawSelf() {\n        MatrixState.pushMatrix();//\u4fdd\u62a4\u73b0\u573a\n        MatrixState.translate(currLocation.x, currLocation.y, currLocation.z);\n        renderObject.drawSelf();//\u7ed8\u5236\u7269\u4f53\n        MatrixState.popMatrix();//\u6062\u590d\u73b0\u573a\n    }\n\n    public void go(ArrayList&lt;RigidBody&gt; al) {\n        if (isStatic) return;\n        currLocation.add(currV);\n        for (int i = 0; i &lt; al.size(); i++) {\n\n            RigidBody rb = al.get(i);\n            if (rb != this) {\n                if (check(this, rb))//\u68c0\u9a8c\u78b0\u649e\n                {\n                    this.currV.x = -this.currV.x;//\u54ea\u4e2a\u65b9\u5411\u7684\u6709\u901f\u5ea6\uff0c\u8be5\u65b9\u5411\u4e0a\u7684\u901f\u5ea6\u7f6e\u53cd\n                }\n            }\n        }\n    }\n// \u7701\u7565\u78b0\u649e\u68c0\u6d4b\u7684\u4ee3\u7801\uff0c\u5728\u4e0a\u9762\u5df2\u7ecf\u6709\u4e86\u3002\n}\n</code></pre> <p>\u5728 RigidBody \u7684\u6784\u9020\u51fd\u6570\u4e2d\uff0c\u9700\u8981\u4f20\u5165\u7528\u6765\u6e32\u67d3\u7684\u7269\u4f53\u5bf9\u8c61\uff0c\u4ee5\u53ca\u662f\u5426\u662f\u9759\u6b62\u7684\u6807\u5fd7\u4f4d\uff0c\u8fd8\u6709\u8868\u793a\u8be5\u7269\u4f53\u7684\u4f4d\u7f6e\u548c\u79fb\u52a8\u7684\u5411\u91cf\uff0c\u5411\u91cf\u7c7b\u578b\u90fd\u662f\u4e4b\u524d\u63d0\u5230\u7684 <code>Vector3f</code>\u3002</p> <p>\u5f53\u4f20\u5165\u8981\u7ed8\u5236\u7684\u5bf9\u8c61\u65f6\uff0c\u4f1a\u6839\u636e\u5b83\u7684\u9876\u70b9\u8ba1\u7b97\u5bf9\u5e94\u7684\u5305\u56f4\u76d2\uff0c\u5f53\u7269\u4f53\u79fb\u52a8\u540e\uff0c\u4e5f\u4f1a\u6839\u636e\u65b0\u7684\u5750\u6807\u4f4d\u7f6e\u91cd\u65b0\u8ba1\u7b97\u5305\u56f4\u76d2\u3002</p> <p>\u7269\u4f53\u53d1\u751f\u79fb\u52a8\u65f6\uff0c\u53ea\u9700\u8981\u5c06\u7269\u4f53\u7684\u4f4d\u7f6e\u5411\u91cf\u52a0\u4e0a\u7269\u4f53\u7684\u901f\u5ea6\u5411\u91cf\uff0c\u7136\u540e\u8c03\u7528 <code>Matrix.translateM</code> \u65b9\u6cd5\u5c31\u53ef\u4ee5\u6539\u53d8\u7269\u4f53\u4f4d\u7f6e\u4e86\u3002</p> <pre><code>    Vector3f currLocation;//\u4f4d\u7f6e\u4e09\u7ef4\u53d8\u91cf\n    Vector3f currV;//\u901f\u5ea6\u4e09\u7ef4\u53d8\u91cf\n    // \u4f4d\u7f6e\u5411\u91cf\u52a0\u4e0a\u901f\u5ea6\u5411\u91cf\uff0c\u5c31\u6539\u53d8\u4e86\u7269\u4f53\u7684\u4f4d\u7f6e\n    currLocation.add(currV);\n    // translate \u65b9\u6cd5\u8ba9\u6539\u53d8\u751f\u6548\n    MatrixState.translate(currLocation.x, currLocation.y, currLocation.z);\n</code></pre> <p>\u5982\u679c\u78b0\u649e\u53d1\u751f\u4e86\uff0c\u5e76\u4e14\u7269\u4f53\u8981\u53cd\u5411\u79fb\u52a8\uff0c\u90a3\u4e48\u5c31\u6539\u53d8\u901f\u5ea6\u5411\u91cf\u7684\u65b9\u5411\u5c31\u597d\u4e86\u3002</p> <pre><code>                if (check(this, rb))//\u68c0\u9a8c\u78b0\u649e\uff0c\u5982\u679c\u53d1\u751f\u78b0\u649e\u4e86\uff0c\u6539\u53d8\u65b9\u5411\n                {\n                    this.currV.x = -this.currV.x;//\u54ea\u4e2a\u65b9\u5411\u7684\u6709\u901f\u5ea6\uff0c\u8be5\u65b9\u5411\u4e0a\u7684\u901f\u5ea6\u7f6e\u53cd\n                }\n</code></pre> <p>\u5177\u4f53\u7ed8\u5236\u65f6\uff0c\u5728 GLSurfaceView.Renderer \u65b9\u6cd5\u91cc\u9762\u5c31\u91c7\u7528\u521a\u4f53 RigidBody \u7c7b\u6765\u7ed8\u5236\u5c31\u597d\u4e86\u3002</p> <pre><code>    var aList = ArrayList&lt;RigidBody&gt;() // \u5b9a\u4e49\u521a\u4f53\u96c6\u5408\n        // onSurfaceCreated \u65b9\u6cd5\u91cc\u9762\u6dfb\u52a0\u8981\u7ed8\u5236\u7684\u7269\u4f53\uff0c\n        override fun onSurfaceCreated(gl: GL10?, config: EGLConfig?) {\n            aList.add(RigidBody(ch, true, Vector3f(-13f, 0f, 0f), Vector3f(0f, 0f, 0f)))\n            aList.add(RigidBody(ch, true, Vector3f(13f, 0f, 0f), Vector3f(0f, 0f, 0f)))\n            aList.add(RigidBody(ch, false, Vector3f(0f, 0f, 0f), Vector3f(0.1f, 0f, 0f)))\n            // \u5f00\u542f\u4e00\u4e2a\u7ebf\u7a0b\u6765\u6539\u53d8\u521a\u4f53\u7684\u79fb\u52a8\n            lgt = LovoGoThread(aList)\n            lgt.start()\n        }\n        // \u7ed8\u5236\u521a\u4f53\n        override fun onDrawFrame(gl: GL10?) {\n            GLES30.glClear(GLES30.GL_DEPTH_BUFFER_BIT or GLES30.GL_COLOR_BUFFER_BIT)\n            for (it in 0 until aList.size) {\n                aList[it].drawSelf()\n            }\n            pm.drawSelf()\n        }\n</code></pre> <p>\u5728\u7269\u4f53\u79fb\u52a8\u65f6\uff0c\u5f00\u542f\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u6539\u53d8\u7269\u4f53\u7684\u5750\u6807\u3002</p> <pre><code>public class LovoGoThread extends Thread {\n    ArrayList&lt;RigidBody&gt; al;//\u63a7\u5236\u5217\u8868\n    boolean flag = true;//\u7ebf\u7a0b\u63a7\u5236\u6807\u5fd7\u4f4d\n    public LovoGoThread(ArrayList&lt;RigidBody&gt; al) {\n        this.al = al;\n    }\n    public void run() {\n        while (flag) {\n            int size = al.size();\n            for (int i = 0; i &lt; size; i++) {\n                al.get(i).go(al);\n            }\n            try {\n                sleep(20);\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n</code></pre> <p>\u5177\u4f53\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-axially-aligned-bounding-box/#_3","title":"\u6ce8\u610f\u70b9","text":"<p>AABB \u5305\u56f4\u76d2\u7684\u78b0\u649e\u68c0\u6d4b\u5176\u5b9e\u8fd8\u662f\u4e00\u79cd\u95f4\u63a5\u68c0\u6d4b\u65b9\u6848\uff0c\u6240\u4ee5\u80af\u5b9a\u8fd8\u662f\u4f1a\u6709\u8bef\u5dee\u7684\u3002</p> <p>AABB \u5305\u56f4\u76d2\u5bf9\u4e8e\u672c\u8eab\u6a2a\u5e73\u7ad6\u76f4\u7684\u7269\u4f53\u5728\u5e73\u884c\u4e8e\u5750\u6807\u8f74\u6446\u653e\u7684\u60c5\u51b5\u4e0b\u4e0b\uff0c\u8ba1\u7b97\u78b0\u649e\u68c0\u6d4b\u7684\u8bef\u5dee\u5f88\u5c0f\uff0c\u4f46\u5bf9\u4e8e\u4e0d\u89c4\u5219\u5f62\u72b6\u7684\u7269\u4f53\u6216\u672c\u8eab\u6a2a\u5e73\u7ad6\u76f4\u7684\u7269\u4f53\u5728\u968f\u610f\u503e\u659c\u6446\u653e\u65f6\uff0c\u8ba1\u7b97\u78b0\u649e\u68c0\u6d4b\u7684\u8bef\u5dee\u5c31\u4f1a\u6bd4\u8f83\u5927\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u5bf9\u4e8e\u540c\u4e00\u7269\u4f53\u5728\u4e0d\u540c\u59ff\u6001\u4e0b\u7684 AABB \u5305\u56f4\u76d2\u4ee5\u53ca\u4e0d\u540c\u5f62\u72b6\u7684\u7269\u4f53\u7684 AABB \u5305\u56f4\u76d2\uff0c\u5176\u7269\u4f53\u672c\u8eab\u533a\u57df\u5360 AABB \u5305\u56f4\u76d2\u533a\u57df\u7684\u6bd4\u4f8b\u662f\u5927\u4e0d\u76f8\u540c\u7684\u3002</p> <p>\u7269\u4f53\u672c\u8eab\u533a\u57df\u6240\u5360\u6bd4\u4f8b\u8d8a\u5927\uff0c\u5219\u78b0\u649e\u68c0\u6d4b\u7684\u8bef\u5dee\u8d8a\u5c0f\uff0c\u56e0\u6b64\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u5e94\u8be5\u5c3d\u91cf\u63d0\u9ad8\u7269\u4f53\u672c\u8eab\u533a\u57df\u6240\u5728\u7684\u6bd4\u4f8b\uff0c\u4ee5\u964d\u4f4e\u8ba1\u7b97\u8bef\u5dee\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-axially-aligned-bounding-box/#_4","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-cat-renderer/","title":"\u4ee3\u7801\u5438\u732b | \u7528 OpenGL \u56fe\u50cf\u6e32\u67d3\u7684\u517b\u732b\u8ba1\u5212","text":"<p>\u5728\u6398\u91d1\u4e0a\u770b\u5230\u6700\u8fd1\u7684\u65b0\u6d3b\u52a8 \"\u4ee3\u7801\u5438\u732b\"\uff0c\u6280\u672f\u7c7b\u6587\u7ae0\u53ea\u8981\u548c\u732b\u6709\u5173\u5c31\u884c\u3002</p> <p>\u5bf9\u4e8e\u6ca1\u6709\u517b\u732b\u7684\u7a0b\u5e8f\u5458\uff0c\u8fd9\u4e0d\u662f\u4e3a\u96be\u4eba\u561b\u3002</p> <p>\u4e0d\u8fc7\u6ca1\u5173\u7cfb\uff0c\u7528 OpenGL \u56fe\u50cf\u6e32\u67d3\u7ed9\u81ea\u5df1\u9020\u4e00\u53ea\u732b\u5427\uff01\uff01\uff01</p>","tags":["OpenGL"]},{"location":"opengl/opengl-cat-renderer/#_1","title":"\u6a21\u578b\u6784\u9020","text":"<p>\u9996\u5148\u9700\u8981\u6784\u9020\u51fa\u732b\u7684\u6a21\u578b\uff0c\u6709\u80fd\u529b\u7684\u8bdd\u53ef\u4ee5\u76f4\u63a5\u5728\u4e09\u7ef4\u8f6f\u4ef6\u91cc\u9762\u9020\u4e00\u4e2a\u3002</p> <p>\u6216\u8005\u50cf\u6211\u4e00\u6837\u76f4\u63a5\u4e0b\u8f7d\u514d\u8d39\u7684\u732b\u6a21\u578b\uff0c\u7136\u540e\u628a\u5b83\u5bfc\u5165 Blender 3D \u8f6f\u4ef6\u4e2d\u3002</p> <p></p> <p>\u5728 Blender \u4e2d\u53ef\u4ee5\u9884\u89c8\u732b\u6a21\u578b\uff0c\u6216\u8005\u5bf9\u5b83\u505a\u4e00\u4e0b\u8c03\u6574\uff0c\u6700\u540e\u5728\u628a\u8fd9\u4e2a\u6a21\u578b\u5bfc\u51fa\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-cat-renderer/#_2","title":"\u6a21\u578b\u52a0\u8f7d","text":"<p>\u5bfc\u51fa\u7684  obj \u6587\u4ef6\u91cc\u9762\u5c31\u8bb0\u5f55\u4e86\u6a21\u578b\u7684\u9876\u70b9\u4fe1\u606f\uff0c\u63a5\u4e0b\u6765\u5c31\u8981\u7528 OpenGL \u5c06\u5b83\u7ed8\u5236\u51fa\u6765\u3002</p> <p>\u8fd9\u91cc\u8981\u7528\u5230 assimp \u5f00\u6e90\u5e93\uff0c\u5b83\u652f\u6301\u591a\u79cd\u6a21\u578b\u6587\u4ef6\u7684\u89e3\u6790\u64cd\u4f5c\uff0c\u901a\u8fc7\u5b83\u5c06\u6a21\u578b\u89e3\u6790\u6210\u4e00\u4e2a\u4e2a Mesh \u3002</p> <p>Mesh \u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>class Mesh {\npublic:\n  /*  Mesh Data  */\n  vector&lt;Vertex&gt; vertices;\n  vector&lt;unsigned int&gt; indices;\n  vector&lt;Texture&gt; textures;\n  unsigned int VAO;\n  // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n}\n</code></pre> <p>Mesh \u76f8\u5f53\u4e8e\u7ed8\u5236\u6a21\u578b\u4e0a\u7684\u4e00\u4e2a\u4e2a\u7f51\u683c\u6216\u8005\u8bf4\u9762\u7247\uff0c\u5b83\u5305\u542b\u4e86\u8be5\u7f51\u683c\u7684\u9876\u70b9\u3001\u7eb9\u7406\u4fe1\u606f\u548c\u7ed8\u5236\u7d22\u5f15\u3002</p> <p>\u800c\u6a21\u578b Model \u5c31\u662f\u7531\u8fd9\u4e00\u7cfb\u5217\u7f51\u683c Mesh \u7ec4\u6210\u7684\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u732b\u6a21\u578b\u662f\u7531\u4e00\u4e2a\u4e2a\u5c0f\u77e9\u9635\u7ec4\u6210\u7684\uff0c\u5c0f\u77e9\u9635\u5c31\u53ef\u4ee5\u7406\u89e3\u6210 mesh \u7f51\u683c\u4e86\u3002</p> <p>Model \u7684\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>class Model\n{\npublic:\n  /*  Model Data */\n  vector&lt;Texture&gt; textures_loaded;    \n  vector&lt;Mesh&gt; meshes;\n  // \u7701\u7565\u90e8\u5206\u4ee3\u7801  \n}  \n</code></pre> <p>\u5728\u5b9e\u9645\u7ed8\u5236\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u7531\u4e00\u4e2a\u4e00\u4e2a Mesh \u6700\u7ec8\u7ed8\u5236\u6210\u7684\u3002</p> <pre><code>    // draws the model, and thus all its meshes\n void Draw(Shader shader)\n {\n   for(unsigned int i = 0; i &lt; meshes.size(); i++)\n     meshes[i].Draw(shader);\n }\n</code></pre> <p>\u4ece\u56fe\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c\u732b\u6a21\u578b\u7684\u7f51\u683c\u6570\u91cf\u662f\u5f88\u591a\u7684\uff0c\u5bfc\u81f4\u52a0\u8f7d\u7684\u65f6\u5019\u4f1a\u5f88\u5f88\u6162\u4e86\uff0c\u52a0\u8f7d\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>  void loadModel(string const &amp;path)\n  {\n    // \u4f7f\u7528 assimp \u5e93\u8fdb\u884c\u52a0\u8f7d\n    const aiScene* scene = importer.ReadFile(path, aiProcess_Triangulate | aiProcess_FlipUVs | aiProcess_CalcTangentSpace);\n    // \u68c0\u67e5\u662f\u5426\u6709\u9519\n    if(!scene || scene-&gt;mFlags &amp; AI_SCENE_FLAGS_INCOMPLETE || !scene-&gt;mRootNode) // if is Not Zero\n    {\n      cout &lt;&lt; \"ERROR::ASSIMP:: \" &lt;&lt; importer.GetErrorString() &lt;&lt; endl;\n      return;\n    }\n    // \u83b7\u53d6\u6a21\u578b\u6240\u5728\u6587\u4ef6\u5939\n    directory = path.substr(0, path.find_last_of('/'));\n\n    // \u4ece\u6839\u8282\u70b9\u4e00\u4e2a\u4e00\u4e2a\u8282\u70b9\u5f00\u59cb\u5904\u7406\n    processNode(scene-&gt;mRootNode, scene);\n  }\n</code></pre> <p>\u4f7f\u7528 assimp \u5904\u7406\u540e\u4f1a\u5f97\u5230\u4e00\u4e2a\u6839\u8282\u70b9\uff0c\u7136\u540e\u987a\u7740\u6839\u8282\u70b9\u4e00\u4e2a\u4e00\u4e2a\u5f80\u4e0b\u5904\u7406\u5c31\u597d\u4e86\u3002</p> <pre><code>\u00a0 void processNode(aiNode *node, const aiScene *scene)\n\u00a0 {\n\u00a0 \u00a0 for(unsigned int i = 0; i &lt; node-&gt;mNumMeshes; i++)\n\u00a0 \u00a0 {\n\u00a0 \u00a0 \u00a0 aiMesh* mesh = scene-&gt;mMeshes[node-&gt;mMeshes[i]];\n      // \u5904\u7406\u5f97\u5230\u7684 aiMesh \u5e76\u7ec4\u88c5\u6210\u5b9a\u4e49\u597d\u7684 Mesh \u6570\u636e\u7ed3\u6784 \n\u00a0 \u00a0 \u00a0 meshes.push_back(processMesh(mesh, scene));\n\u00a0 \u00a0 }\n    // \u5904\u7406\u5b50\u8282\u70b9\n\u00a0 \u00a0 for(unsigned int i = 0; i &lt; node-&gt;mNumChildren; i++)\n\u00a0 \u00a0 {\n\u00a0 \u00a0 \u00a0 processNode(node-&gt;mChildren[i], scene);\n\u00a0 \u00a0 }\n\u00a0 }\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5904\u7406\u8fc7\u7a0b\u5927\u91cf\u7684 for \u5faa\u73af\u64cd\u4f5c\uff0c\u6240\u4ee5\u540e\u7eed\u624d\u4f1a\u9488\u5bf9\u6a21\u578b\u6587\u4ef6\u7684\u4f18\u5316\uff0c\u52a0\u5feb\u5176\u52a0\u8f7d\u901f\u5ea6\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-cat-renderer/#_3","title":"\u6a21\u578b\u6e32\u67d3","text":"<p>\u5f97\u5230\u4e86\u6700\u7ec8\u7684 Model \u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5bf9\u5b83\u505a\u6e32\u67d3\u663e\u793a\u4e86\u3002</p> <pre><code>    // model \u77e9\u9635\u8c03\u6574\u6a21\u578b\u663e\u793a\u4f4d\u7f6e\u548c\u65b9\u5411\n\u00a0 \u00a0 glm::mat4 model = glm::mat4(1.0f);\n\u00a0 \u00a0 model = glm::translate(model, glm::vec3(tranx_x, tranx_y, tranx_z));\n\u00a0 \u00a0 model = glm::rotate(model,glm::radians(90.0f),glm::vec3(0.0,0.0,1.0));\n\u00a0 \u00a0 model = glm::scale(model, glm::vec3(0.5f, 0.5f, 0.5f)); \u00a0 \u00a0\n\u00a0 \u00a0 shader.setMatrix4fv(\"model\", glm::value_ptr(model));\n\u00a0 \u00a0 ourModel.Draw(shader);\n</code></pre> <p>\u7531\u4e8e\u6a21\u578b\u81ea\u8eab\u5c31\u5e26\u4e86\u4e00\u4e2a\u4f4d\u7f6e\u548c\u65b9\u5411\uff0c\u663e\u793a\u7684\u65f6\u5019\u4e0d\u4e00\u5b9a\u662f\u6211\u4eec\u60f3\u8981\u7684\u89c2\u5bdf\u65b9\u4f4d\uff0c\u6240\u4ee5\u8fd8\u662f\u8981\u8c03\u6574\u4e00\u4e2a\u6a21\u578b\u77e9\u9635\u3002</p> <p>\u6700\u540e\u6e32\u67d3\u5c31\u53ef\u4ee5\u770b\u5230 \u732b\u6a21\u578b \u6548\u679c\u5566\u3002</p> <p></p> <p></p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-cat-renderer/#_4","title":"\u5c0f\u7ed3","text":"<p>\u4e3a\u4e86\u4fbf\u4e8e\u89c2\u5bdf\uff0c\u53ef\u4ee5\u5904\u7406\u4e00\u4e0b\u952e\u76d8\u6216\u8005\u9f20\u6807\u4e8b\u4ef6\uff0c\u4fee\u6539\u6a21\u578b\u77e9\u9635\u7684\u503c\uff0c\u4ece\u4e0d\u540c\u89d2\u5ea6\u64b8\u732b\u3002</p> <p>\u76ee\u524d\u7684\u732b\u6a21\u578b\u8fd8\u53ea\u662f\u9759\u6001\u7684\uff0c\u8c03\u6574\u7684\u8bdd\u4e5f\u53ea\u80fd\u7528\u952e\u76d8\u8c03\u6574\uff0c\u800c\u4e14\u8fd8\u53ea\u662f\u6539\u4e86 \u79fb\u52a8\u3001\u7f29\u653e\u3001\u65cb\u8f6c\u8fd9\u4e9b\u5c5e\u6027\uff0c\u732b\u672c\u8eab\u662f\u6ca1\u6709\u52a8\u7684\u3002</p> <p>\u60f3\u8981\u732b\u81ea\u8eab\u80fd\u52a8\u7684\u8bdd\uff0c\u8fd8\u9700\u8981\u6a21\u578b\u91cc\u9762\u6709\u5bf9\u5e94\u7684\u9aa8\u9abc\u52a8\u753b\u624d\u53ef\u4ee5\u4e86\uff0c\u7b49\u540e\u9762\u6709\u4e86\u8fd9\u6837\u7684\u6a21\u578b\uff0c\u518d\u7ee7\u7eed\u8fed\u4ee3\u3002</p> <p>\u5173\u6ce8\u5fae\u4fe1\u516c\u4f17\u53f7 \u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636\uff0c\u770b\u66f4\u591a\u64b8\u732b\u540e\u7eed\u5185\u5bb9...</p>","tags":["OpenGL"]},{"location":"opengl/opengl-depth-test/","title":"OpenGL \u6df1\u5ea6\u6d4b\u8bd5\u4e0e\u7cbe\u5ea6\u503c\u7684\u90a3\u4e9b\u4e8b","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/PpLzxm7hPHDbaQLmAniCzQ</p> <p>\u5728 OpenGL \u4e16\u754c\u91cc\uff0c\u4f7f\u7528\u6df1\u5ea6\u6d4b\u8bd5\u53ef\u4ee5\u6765\u9632\u6b62\u88ab\u963b\u6321\u7684\u9762\u6e32\u67d3\u5230\u5176\u4ed6\u9762\u7684\u524d\u9762\u3002</p> <p>\u76f4\u63a5\u770b\u4e00\u4e2a\u6ca1\u6709\u4f7f\u7528\u6df1\u5ea6\u6d4b\u8bd5\u7684\u7ed8\u5236\uff1a</p> <p></p> <p>\u6309\u7167\u8ba1\u5212\u662f\u7ed8\u5236\u4e00\u4e2a\u5c01\u95ed\u7684\u7acb\u65b9\u4f53\uff0c\u516d\u4e2a\u9762\u90fd\u662f\u6709\u7684\uff0c\u53ef\u4ece\u4e0a\u9762\u7684\u6548\u679c\u6765\u770b\u5e76\u4e0d\u662f\uff0c\u7acb\u65b9\u4f53\u7684\u6709\u4e9b\u9762\u4e22\u5931\u4e86\uff0c\u53ea\u6709\u540e\u9762\u7684\u90a3\u4e2a\u9762\uff0c\u524d\u9762\u7684\u9762\u6ca1\u4e86\u3002</p> <p>\u8fd9\u5c31\u662f\u5728\u6ca1\u6709\u5f00\u542f\u6df1\u5ea6\u6d4b\u8bd5\u7684\u60c5\u51b5\u4e0b\uff0c\u672c\u6765\u5e94\u8be5\u88ab\u906e\u6321\u7684\uff0c\u7ed8\u5236\u5728\u540e\u9762\u7684\u9762\u5374\u7ed8\u5236\u5230\u4e86\u5176\u4ed6\u9762\u4e4b\u4e0a\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\uff0c\u5c31\u5f97\u4f7f\u7528\u6df1\u5ea6\u6d4b\u8bd5\u4e86\u3002</p> <p>\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff1a\u5728\u6ca1\u6709\u5f00\u542f\u6df1\u5ea6\u6d4b\u8bd5\u7684\u60c5\u51b5\u4e0b\uff0c\u5047\u8bbe\u7ed8\u5236\u4e86\u591a\u4e2a\u4e0d\u540c\u8fdc\u8fd1\u7684\u7269\u4f53\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6700\u540e\u7684\u666f\u8c61\u6765\u8bf4\uff0c\u54ea\u6015\u662f\u8ddd\u79bb\u6700\u8fdc\u7684\uff0c\u53ea\u8981\u5b83\u7684\u6700\u540e\u7ed8\u5236\u7684\uff0c\u90fd\u4f1a\u663e\u793a\u5728\u666f\u8c61\u7684\u524d\u9762\u3002</p> <p>\u5f53\u6df1\u5ea6\u6d4b\u8bd5\u88ab\u542f\u7528\u65f6\uff0cOpenGL \u4f1a\u5c06\u4e00\u4e2a\u7247\u6bb5\u7684\u6df1\u5ea6\u503c\u4e0e\u6df1\u5ea6\u7f13\u51b2\u7684\u5185\u5bb9\u8fdb\u884c\u5bf9\u6bd4\u3002OpenGL \u4f1a\u6267\u884c\u4e00\u4e2a\u6df1\u5ea6\u6d4b\u8bd5\uff0c\u5982\u679c\u8fd9\u4e2a\u6d4b\u8bd5\u901a\u8fc7\u4e86\u7684\u8bdd\uff0c\u6df1\u5ea6\u7f13\u51b2\u5c06\u4f1a\u66f4\u65b0\u4e3a\u65b0\u7684\u6df1\u5ea6\u503c\uff0c\u5982\u679c\u6df1\u5ea6\u6d4b\u8bd5\u5931\u8d25\u4e86\uff0c\u8be5\u7247\u6bb5\u5c06\u4f1a\u88ab\u4e22\u5f03\u3002</p> <p>\u6df1\u5ea6\u7f13\u51b2\u662f\u5728\u7247\u6bb5\u7740\u8272\u5668\u8fd0\u884c\u4e4b\u540e\uff0c\u5728\u5c4f\u5e55\u7a7a\u95f4\u4e2d\u8fd0\u884c\u7684\u3002\u5c4f\u5e55\u7a7a\u95f4\u5750\u6807\u4e0e\u901a\u8fc7 OpenGL \u7684 glViewport \u6240\u5b9a\u4e49\u7684\u89c6\u53e3\u5bc6\u5207\u76f8\u5173\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7 GLSL \u7684\u5185\u5efa\u53d8\u91cf <code>gl_FragCoord</code> \u4ece\u7247\u6bb5\u7740\u8272\u5668\u4e2d\u76f4\u63a5\u8bbf\u95ee\u3002</p> <p><code>gl_FragCoord</code> \u7684 x \u548c y \u5206\u91cf\u4ee3\u8868\u4e86\u7247\u6bb5\u7684\u5c4f\u5e55\u7a7a\u95f4\u5750\u6807\uff08\u5176\uff080\uff0c0\uff09\u4f4d\u4e8e\u5de6\u4e0b\u89d2\uff09\u3002<code>gl_FragCoord</code> \u4e2d\u4e5f\u5305\u542b\u4e86\u4e00\u4e2a z \u5206\u91cf\uff0c\u5b83\u5305\u542b\u4e86\u7247\u6bb5\u771f\u6b63\u7684\u6df1\u5ea6\u503c\u3002z \u503c\u5c31\u662f\u9700\u8981\u4e0e\u6df1\u5ea6\u7f13\u51b2\u5185\u5bb9\u6240\u5bf9\u6bd4\u7684\u90a3\u4e2a\u6c41\u3002</p> <p>\u6df1\u5ea6\u7f13\u51b2\u9ed8\u8ba4\u662f\u7981\u6b62\u7684\uff0c\u901a\u8fc7\u5982\u4e0b\u4ee3\u7801\u5f00\u542f\u5b83\uff1a</p> <pre><code>glEnable(GL_DEPTH_TEST);\n</code></pre> <p>\u5f00\u542f\u4e4b\u540e\uff0c\u5982\u679c\u4e00\u4e2a\u7247\u6bb5\u901a\u8fc7\u4e86\u6df1\u5ea6\u6d4b\u8bd5\u7684\u8bdd\uff0cOpenGL \u5c31\u4f1a\u5728\u6df1\u5ea6\u7f13\u51b2\u4e2d\u5b58\u50a8\u8be5\u7247\u6bb5\u7684 z \u503c\uff1b\u5982\u679c\u6ca1\u6709\u901a\u8fc7\u6df1\u5ea6\u7f13\u51b2\uff0c\u5219\u4e22\u5f03\u8be5\u7247\u6bb5\u3002</p> <p>\u5982\u679c\u5f00\u542f\u4e86\u6df1\u5ea6\u7f13\u51b2\uff0c\u5c31\u5e94\u8be5\u5728\u6bcf\u4e2a\u6e32\u67d3\u8fed\u4ee3\u4e4b\u524d\uff0c\u4e5f\u5c31\u662f onDrawFrame \u65b9\u6cd5\u4e2d\u6e05\u9664\u6df1\u5ea6\u7f13\u51b2\uff0c\u5426\u5219\u5c31\u4ecd\u5728\u4f7f\u7528\u4e0a\u4e00\u6b21\u6e32\u67d3\u8fed\u4ee3\u65f6\u5199\u5165\u7684\u6df1\u5ea6\u503c\u3002</p> <pre><code>// \u6e05\u9664\u6df1\u5ea6\u7f13\u51b2\nglClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);\n</code></pre> <p>\u5982\u679c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5bf9\u6240\u6709\u7684\u7247\u6bb5\u6267\u884c\u6df1\u5ea6\u6d4b\u8bd5\u5e76\u4e22\u5f03\u67d0\u4e9b\u7247\u6bb5\uff0c\u4f46\u662f\u53c8\u4e0d\u5e0c\u671b\u6df1\u5ea6\u7f13\u51b2\u88ab\u66f4\u65b0\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u4f7f\u7528\u4e00\u4e2a<code>\u53ea\u8bfb\u6df1\u5ea6\u7f13\u51b2</code>\u3002</p> <p>OpenGL \u8fd0\u884c\u6211\u4eec\u7981\u7528\u6df1\u5ea6\u7f13\u51b2\u7684\u5199\u5165\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u5b83\u7684\u6df1\u5ea6\u63a9\u7801\u4e3a <code>GL_FALSE</code> \u5373\u53ef\u3002</p> <pre><code>// \u8bbe\u7f6e\u53ea\u8bfb\u7684\u6df1\u5ea6\u7f13\u51b2\nglDepthMask(GL_FALSE);\n</code></pre>","tags":["OpenGL"]},{"location":"opengl/opengl-depth-test/#_1","title":"\u6df1\u5ea6\u6d4b\u8bd5\u51fd\u6570","text":"<p>OpenGL \u5141\u8bb8\u4fee\u6539\u6df1\u5ea6\u6d4b\u8bd5\u4e2d\u4f7f\u7528\u7684\u6bd4\u8f83\u8fd0\u7b97\u7b26\uff0c\u5141\u8bb8\u6211\u4eec\u63a7\u5236 OpenGL \u4ec0\u4e48\u65f6\u5019\u8be5\u901a\u8fc7\u6216\u4e22\u5f03\u4e00\u4e2a\u7247\u6bb5\uff0c\u4ec0\u4e48\u65f6\u5019\u66f4\u65b0\u6df1\u5ea6\u7f13\u51b2\u3002</p> <p>\u8c03\u7528 <code>glDepthFunc</code> \u51fd\u6570\u8bbe\u7f6e\u6bd4\u8f83\u8fd0\u7b97\u7b26\u3002</p> <pre><code>glDepthFunc(GL_LESS);\n</code></pre> \u51fd\u6570 \u63cf\u8ff0 GL_ALWAYS \u6c38\u8fdc\u901a\u8fc7\u6df1\u5ea6\u6d4b\u8bd5 GL_NEVER \u6c38\u8fdc\u4e0d\u901a\u8fc7\u6df1\u5ea6\u6d4b\u8bd5 GL_LESS \u5728\u7247\u6bb5\u6df1\u5ea6\u503c\u5c0f\u4e8e\u7f13\u51b2\u7684\u6df1\u5ea6\u503c\u65f6\u901a\u8fc7\u6d4b\u8bd5 GL_EQUAL \u5728\u7247\u6bb5\u6df1\u5ea6\u503c\u7b49\u4e8e\u7f13\u51b2\u533a\u7684\u6df1\u5ea6\u503c\u65f6\u901a\u8fc7\u6d4b\u8bd5 GL_LEQUAL \u5728\u7247\u6bb5\u6df1\u5ea6\u503c\u5c0f\u4e8e\u7b49\u4e8e\u7f13\u51b2\u533a\u7684\u6df1\u5ea6\u503c\u65f6\u901a\u8fc7\u6d4b\u8bd5 GL_GREATER \u5728\u7247\u6bb5\u6df1\u5ea6\u503c\u5927\u4e8e\u7f13\u51b2\u533a\u7684\u6df1\u5ea6\u503c\u65f6\u901a\u8fc7\u6d4b\u8bd5 GL_NOTEQUAL \u5728\u7247\u6bb5\u6df1\u5ea6\u503c\u4e0d\u7b49\u4e8e\u7f13\u51b2\u533a\u7684\u6df1\u5ea6\u503c\u65f6\u901a\u8fc7\u6d4b\u8bd5 GL_GEQUAL \u5728\u7247\u6bb5\u6df1\u5ea6\u503c\u5927\u4e8e\u7b49\u4e8e\u7f13\u51b2\u533a\u7684\u6df1\u5ea6\u503c\u65f6\u901a\u8fc7\u6d4b\u8bd5 <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528\u7684\u662f <code>GL_LESS</code>\uff0c\u5b83\u5c06\u4e22\u5f03\u6df1\u5ea6\u503c\u5927\u4e8e\u5f53\u524d\u6df1\u5ea6\u7f13\u51b2\u503c\u7684\u6240\u6709\u7247\u6bb5\u3002</p> <p>\u5bf9\u4e8e\u5982\u4e0b\u4ee3\u7801\u7684\u7ec4\u5408\uff1a</p> <pre><code>glEnable(GL_DEPTH_TEST);\nglDepthFunc(GL_ALWAYS);\n</code></pre> <p>\u5176\u6548\u679c\u7b49\u6548\u4e8e\u6ca1\u6709\u5f00\u542f\u6df1\u5ea6\u6d4b\u8bd5\u3002</p> <p>\u4f46\u6211\u4eec\u5f00\u542f\u6df1\u5ea6\u6d4b\u8bd5\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u6b63\u5e38\u7684\u7acb\u65b9\u4f53\u7ed8\u5236\u4e86\u3002</p> <p> </p>","tags":["OpenGL"]},{"location":"opengl/opengl-depth-test/#_2","title":"\u6df1\u5ea6\u503c\u7cbe\u5ea6","text":"<p>\u4e0a\u9762\u63d0\u5230\u7684\u4f5c\u4e3a\u6bd4\u8f83\u7684\u6df1\u5ea6\u7f13\u51b2\uff0c\u5b83\u662f\u4f4d\u4e8e 0.0 ~ 1.0 \u4e4b\u95f4\u7684\u6df1\u5ea6\u503c\uff0c\u5b83\u4f1a\u4e0e\u8981\u7ed8\u5236\u7684\u7269\u4f53\u7684 z \u503c\u8fdb\u884c\u6bd4\u8f83\u3002</p> <p>\u8981\u7ed8\u5236\u7269\u4f53\u7684 z \u503c\u5c31\u662f\u5728\u8fd0\u7528\u900f\u89c6\u6295\u5f71\u6216\u8005\u6b63\u4ea4\u6295\u5f71\u89c6\u65f6\uff0c\u4ecb\u4e8e\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762\u4e4b\u95f4\u7684\u4efb\u4f55\u503c\u3002</p> <p>\u8981\u628a\u8fd9\u4e2a z \u503c\u8f6c\u6362\u4e3a OpenGL \u4e2d\u7684\u6df1\u5ea6\u503c\uff0c\u4e5f\u5c31\u662f\u4ecb\u4e8e 0.0 \u548c 1.0 \u4e4b\u95f4\u7684\u503c\u3002</p> <p>\u6709\u516c\u5f0f\u5982\u4e0b\uff1a</p> \\[\\begin{equation} F_{depth} = \\frac{z - near}{far - near} \\end{equation}\\] <p>\u5bf9\u4e8e\u8fd9\u79cd\u8f6c\u6362\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u7269\u4f53\u975e\u5e38\u63a5\u8fd1\u8fd1\u5e73\u9762\u65f6\uff0c\u6df1\u5ea6\u503c\u4f1a\u63a5\u8fd1 0.0\uff0c\u5f53\u7269\u4f53\u975e\u5e38\u63a5\u8fd1\u8fdc\u5e73\u9762\u65f6\uff0c\u6df1\u5ea6\u503c\u4f1a\u63a5\u8fd1 1.0 \uff0c\u8fd9\u79cd\u8f6c\u6362\u662f\u4e00\u79cd\u7ebf\u6027\u7684\u6df1\u5ea6\u7f13\u51b2\u8f6c\u6362\u3002</p> <p></p> <p>\u800c\u5728\u5b9e\u8df5\u4e2d\uff0c\u51e0\u4e4e\u4e0d\u53ef\u80fd\u662f\u8fd9\u6837\u7684\u7ebf\u6027\u8f6c\u6362\u3002</p> <p>\u56e0\u4e3a\u5f53 z \u503c\u5f88\u5c0f\u7684\u65f6\u5019\uff0c\u975e\u5e38\u63a5\u8fd1\u8fd1\u5e73\u9762\uff0c\u6b64\u65f6\u6211\u4eec\u7684\u89c2\u5bdf\u4e5f\u4f1a\u66f4\u52a0\u7cbe\u7ec6\uff0c\u800c\u5bf9\u4e8e\u8f83\u8fdc\u7684\u7269\u4f53\uff0c\u63a5\u8fd1\u8fdc\u5e73\u9762\u4e86\uff0c\u5bf9\u4e8e\u5b83\u7684\u89c2\u5bdf\u4e5f\u4f1a\u6bd4\u8f83\u7c97\u7565\u3002</p> <p>\u8fd9\u5c31\u548c\u4eba\u773c\u4e00\u6837\uff0c\u8fd1\u5904\u7684\u7269\u4f53\u5f53\u7136\u770b\u5f97\u5f88\u6e05\u4e86\uff0c\u5982\u679c\u770b\u4e0d\u6e05\uff0c\u8d70\u8fd1\u4e00\u70b9\u5c31\u597d\u4e86\uff0c\u800c\u5bf9\u4e8e\u5f88\u8fdc\u7684\u7269\u4f53\uff0c\u8d70\u8fdc\u4e86\u548c\u8d70\u8fd1\u4e86\u770b\u5f97\u7684\u7ed3\u679c\u5dee\u522b\u4e0d\u5927\u3002</p> <p>\u6240\u4ee5\u5728\u5b9e\u9645\u5c06 z \u503c\u8f6c\u6362\u4e3a\u6df1\u5ea6\u7f13\u51b2\u503c\uff0c\u7528\u5230\u7684\u662f\u975e\u7ebf\u6027\u7684\u8f6c\u6362\u65b9\u7a0b\u3002</p> \\[\\begin{equation} F_{depth} = \\frac{1/z - 1/near}{1/far - 1/near} \\end{equation}\\] <p>\u5b83\u7684\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5728 z \u503c\u4f4d\u4e8e 1.0 \u548c 2.0 \u4e4b\u95f4\u65f6\uff0c\u5bf9\u5e94\u7684\u6df1\u5ea6\u503c\u4e3a 0.0 \u5230 0.5 \u7684\u533a\u95f4\uff0c\u8fd9\u5c31\u5360\u636e\u4e86\u6df1\u5ea6\u503c\u533a\u95f4\u8303\u56f4\u7684 50 %\u3002\u800c 2.0 \u4e4b\u540e\u7684\u8303\u56f4\u4e5f\u624d\u5360\u636e\u4e86 50 %\u3002</p> <p>\u8fd9\u5c31\u7ed9\u4e86\u8fd1\u5904\u7684\u7269\u4f53\u4e00\u4e2a\u5f88\u5927\u7684\u6df1\u5ea6\u7cbe\u5ea6\u3002</p> <p>\u5bf9\u4e8e\u6df1\u5ea6\u503c\u7684\u533a\u95f4 0.0 \u5230 1.0 \uff0c\u5176\u5b9e\u8fd9\u4e2a\u533a\u95f4\u7684\u524d\u534a\u90e8\u5206\u8fd8\u662f\u548c\u8fd1\u5e73\u9762\u975e\u5e38\u8fd1\u7684\uff0c\u4e0d\u8981\u4ee5\u4e3a\u6df1\u5ea6\u503c 0.5 \u5c31\u662f\u4f4d\u4e8e\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762\u4e4b\u95f4\u4e86\uff0c\u5176\u5b9e\u8fd8\u975e\u5e38\u63a5\u8fd1\u8fd1\u5e73\u9762\u5462\u3002</p> <p>\u5173\u4e8e\u6df1\u5ea6\u6d4b\u8bd5\uff0c\u5c31\u5148\u8bf4\u5230\u8fd9\u4e86\uff0c\u5982\u679c\u6709\u7ed8\u5236\u5e26\u6709\u6df1\u5ea6\u5c42\u6b21\u7684\u5185\u5bb9\uff0c\u53ef\u522b\u5fd8\u4e86\u5f00\u542f\u6df1\u5ea6\u6d4b\u8bd5\u54e6\u3002</p> <p>\u5173\u4e8e\u5177\u4f53\u7684\u4ee3\u7801\u5b9e\u73b0\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-depth-test/#_3","title":"\u53c2\u8003","text":"<ol> <li>https://learnopengl-cn.github.io/04%20Advanced%20OpenGL/01%20Depth%20testing/</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-draw-bezier-line/","title":"OpenGL \u5b9e\u8df5\u4e4b\u8d1d\u585e\u5c14\u66f2\u7ebf\u7ed8\u5236","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/m7BMF1dSiJ5BeHTU1etDqw</p> <p>\u8bf4\u5230\u8d1d\u585e\u5c14\u66f2\u7ebf\uff0c\u5927\u5bb6\u80af\u5b9a\u90fd\u4e0d\u964c\u751f\uff0c\u7f51\u4e0a\u6709\u5f88\u591a\u5173\u4e8e\u4ecb\u7ecd\u548c\u7406\u89e3\u8d1d\u585e\u5c14\u66f2\u7ebf\u7684\u4f18\u79c0\u6587\u7ae0\u548c\u52a8\u6001\u56fe\u3002</p> <p>\u4ee5\u4e0b\u4e24\u4e2a\u662f\u6bd4\u8f83\u7ecf\u5178\u7684\u52a8\u56fe\u4e86\u3002</p> <p>\u4e8c\u9636\u8d1d\u585e\u5c14\u66f2\u7ebf\uff1a</p> <p></p> <p>\u4e09\u9636\u8d1d\u585e\u5c14\u66f2\u7ebf\uff1a</p> <p></p> <p>\u7531\u4e8e\u5728\u5de5\u4f5c\u4e2d\u7ecf\u5e38\u8981\u548c\u8d1d\u585e\u5c14\u66f2\u7ebf\u6253\u4ea4\u9053\uff0c\u6240\u4ee5\u7b80\u5355\u8bf4\u4e00\u4e0b\u81ea\u5df1\u7684\u7406\u89e3\uff1a</p> <p>\u73b0\u5728\u5047\u8bbe\u6211\u4eec\u8981\u5728\u5750\u6807\u7cfb\u4e2d\u7ed8\u5236\u4e00\u6761\u76f4\u7ebf\uff0c\u76f4\u7ebf\u7684\u65b9\u7a0b\u5f88\u7b80\u5355\uff0c\u5c31\u662f <code>y=x</code> \uff0c\u5f88\u5bb9\u6613\u5f97\u5230\u4e0b\u56fe\uff1a</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u9650\u5236\u4e00\u4e0b x \u7684\u53d6\u503c\u8303\u56f4\u4e3a <code>0~1</code> \u7684\u95ed\u533a\u95f4\uff0c\u90a3\u4e48\u53ef\u4ee5\u5f97\u51fa y \u7684\u53d6\u503c\u8303\u56f4\u4e5f\u662f <code>0~1</code>\u3002</p> <p>\u800c\u5728 <code>0~1</code> \u7684\u533a\u95f4\u8303\u56f4\u5185\uff0cx \u80fd\u53d6\u7684\u6570\u6709\u591a\u5c11\u4e2a\u5462\uff1f\u7b54\u6848\u5f53\u7136\u662f\u65e0\u6570\u4e2a\u4e86\u3002</p> <p></p> <p>\u540c\u7406\uff0cy \u7684\u53d6\u503c\u4e2a\u6570\u4e5f\u662f\u6709\u65e0\u6570\u4e2a\u3002\u6bcf\u4e00\u4e2a x \u90fd\u6709\u552f\u4e00\u7684 y \u4e0e\u4e4b\u5bf9\u5e94\uff0c\u4e00\u4e2a (x,y) \u5728\u5750\u6807\u7cfb\u4e0a\u5c31\u662f\u4e00\u4e2a\u70b9\u3002</p> <p>\u6240\u4ee5\u6700\u7ec8\u5f97\u5230\u7684 <code>0~1</code> \u533a\u95f4\u7684\u7ebf\u6bb5\uff0c\u5b9e\u9645\u4e0a\u662f\u7531\u65e0\u6570\u7684\u70b9\u7ec4\u6210\u7684\u3002</p> <p>\u90a3\u4e48\u8fd9\u6761\u7ebf\u6bb5\u6709\u591a\u957f\u5462\uff1f\u957f\u5ea6\u662f\u7531 x \u7684\u53d6\u503c\u8303\u56f4\u6765\u51b3\u5b9a\u7684\uff0c\u82e5 x \u7684\u53d6\u503c\u4e3a <code>0~2</code>\uff0c\u90a3\u4e48\u7ebf\u6bb5\u5c31\u957f\u4e86\u4e00\u500d\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c x \u7684\u53d6\u503c\u8303\u56f4\u4e0d\u662f\u65e0\u6570\u4e2a\uff0c\u800c\u662f\u4ee5 0.05 \u7684\u95f4\u8ddd\u4ece 0 \u5230 1 \u4e4b\u95f4\u9012\u589e\uff0c\u90a3\u4e48\u5f97\u5230\u7684\u5c31\u662f\u4e00\u4e32\u70b9\u4e86\u3002</p> <p>\u7531\u4e8e \u70b9 \u662f\u4e00\u4e2a\u7406\u60f3\u72b6\u6001\u4e0b\u7684\u63cf\u8ff0\uff0c\u5728\u6570\u5b66\u4e0a\u70b9\u662f\u6ca1\u6709\u5bbd\u9ad8\u3001\u6ca1\u6709\u9762\u79ef\u7684\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u4f60\u5728\u8349\u7a3f\u7eb8\u4e0a\u7ed8\u5236\u4e00\u4e2a\u70b9\uff0c\u4e0d\u7ba1\u4f60\u7528\u5230\u662f\u94c5\u7b14\u3001\u6bdb\u7b14\u3001\u6c34\u7b14\u8fd8\u662f\u753b\u7b14\uff0c\u4e00\u4e2a\u70b9\u603b\u662f\u8981\u5360\u9762\u79ef\u7684\u3002</p> <p>\u6bdb\u7b14\u753b\u4e00\u4e2a\u70b9\u7684\u9762\u79ef\u53ef\u80fd\u9700\u8981\u94c5\u7b14\u753b\u51e0\u5341\u4e2a\u70b9\u4e86\u3002</p> <p>\u5728\u5b9e\u9645\u751f\u6d3b\u4e2d\uff0c\u5982\u679c\u8981\u4ee5 0.05 \u7684\u95f4\u8ddd\u5728\u7b2c\u4e00\u5e45\u5750\u6807\u7cfb\u56fe\u4e2d\u753b\u51fa x \u5728 <code>0~1</code> \u533a\u95f4\u7684\u4e00\u4e32\u70b9\uff0c\u6700\u7ec8\u7ed3\u679c\u5c31\u548c\u76f4\u63a5\u753b\u4e00\u6761\u7ebf\u6bb5\u6ca1\u5565\u5dee\u522b\u4e86\u3002</p> <p>\u8fd9\u5c31\u662f\u73b0\u5b9e\u548c\u7406\u60f3\u7684\u5dee\u522b\u4e86\u3002\u7406\u60f3\u4e00\u4e32\u70b9\uff0c\u73b0\u5b9e\u4e00\u6761\u7ebf\u3002</p> <p>\u6211\u4eec\u628a\u8fd9\u4e2a\u903b\u8f91\u653e\u5230\u624b\u673a\u5c4f\u5e55\u4e0a\u3002</p> <p>\u624b\u673a\u5c4f\u5e55\u4e0a\u7684\u6700\u5c0f\u663e\u793a\u5355\u4f4d\u5c31\u662f\u50cf\u7d20\u4e86\uff0c\u4e00\u4e2a 1920 * 1080 \u7684\u5c4f\u5e55\u6307\u7684\u5c31\u662f\u5404\u65b9\u5411\u4e0a\u50cf\u7d20\u70b9\u7684\u6570\u91cf\u3002</p> <p>\u5047\u5982\u7ed8\u5236\u4e00\u6761\u548c\u5c4f\u5e55\u4e00\u6837\u5bbd\u7684\u7ebf\u6bb5\uff0c\u4e00\u4e2a\u70b9\u6700\u5c0f\u5c31\u7b97\u4e00\u4e2a\u50cf\u7d20\uff0c\u6700\u591a\u4e5f\u5c31 1080 \u4e2a\u70b9\u4e86\u3002</p> <p>\u70b9\u5360\u7684\u50cf\u7d20\u8d8a\u591a\uff0c\u90a3\u4e48\u5b9e\u9645\u7ed8\u5236\u65f6\u9700\u8981\u7684\u70b9\u7684\u6570\u91cf\u8d8a\u5c11\uff0c\u8fd9\u4e5f\u7b97\u662f\u6f5c\u5728\u7684\u4f18\u5316\u9879\u4e86\u3002</p> <p>\u8bf4\u5b8c\u76f4\u7ebf\uff0c\u518d\u56de\u5230\u8d1d\u585e\u5c14\u66f2\u7ebf\u4e0a\u3002</p> <p>\u66f2\u7ebf\u548c\u76f4\u7ebf\u90fd\u6709\u4e00\u4e2a\u5171\u540c\u70b9\uff0c\u5b83\u4eec\u90fd\u6709\u5404\u81ea\u7279\u5b9a\u7684\u65b9\u7a0b\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u7528\u7684\u76f4\u7ebf\u4f8b\u5b50\u6bd4\u8f83\u7b80\u5355\uff0c\u65e2 <code>y = x</code> \uff0c\u4e00\u773c\u770b\u51fa\u8ba1\u7b97\u7ed3\u679c\u3002</p> <p>\u76f4\u7ebf\u65b9\u7a0b y = x\uff0c\u5728\u6570\u5b66\u4e0a\u53ef\u4ee5\u8fd9\u4e48\u63cf\u8ff0\uff1ay \u662f\u5173\u4e8e x \u7684\u51fd\u6570\uff0c\u65e2 <code>y = F(x)</code> \uff0c\u5176\u4e2d x \u7684\u53d6\u503c\u51b3\u5b9a\u4e86\u8be5\u76f4\u7ebf\u7684\u957f\u5ea6\u3002</p> <p>\u6839\u636e\u4e0a\u9762\u7684\u7406\u89e3\uff0c\u8fd9\u4e2a\u957f\u5ea6\u7684\u76f4\u7ebf\u5b9e\u9645\u53c8\u662f\u7531\u5728 x \u7684\u53d6\u503c\u8303\u56f4\u5185\u5bf9\u5e94\u7684\u65e0\u6570\u4e2a\u70b9\u7ec4\u6210\u7684\u3002</p> <p>\u53cd\u89c2\u8d1d\u585e\u5c14\u66f2\u7ebf\u65b9\u7a0b\u4ee5\u53ca\u5bf9\u5e94\u7684\u56fe\u5f62\u5982\u4e0b\uff1a</p> <ul> <li>\u4e8c\u9636\u8d1d\u585e\u5c14\u66f2\u7ebf\uff1a</li> </ul> <p> </p> <p>\u5176\u4e2d\uff0cP0 \u548c P2 \u662f\u8d77\u59cb\u70b9\uff0cP1 \u662f\u63a7\u5236\u70b9\u3002</p> <ul> <li>\u4e09\u9636\u8d1d\u585e\u5c14\u66f2\u7ebf</li> </ul> <p> </p> <p>\u5176\u4e2d\uff0cP0 \u548c P3 \u662f\u8d77\u59cb\u70b9\uff0cP1 \u548c P2 \u662f\u63a7\u5236\u70b9\u3002</p> <p>\u4e0d\u96be\u7406\u89e3\uff0c\u5047\u8bbe\u6211\u4eec\u8981\u7ed8\u5236\u4e00\u6761\u66f2\u7ebf\uff0c\u80af\u5b9a\u8981\u6709\u8d77\u59cb\u548c\u7ed3\u675f\u70b9\u6765\u6307\u5b9a\u66f2\u7ebf\u7684\u8303\u56f4\u66f2\u7ebf\u3002</p> <p>\u800c\u63a7\u5236\u70b9\u5c31\u662f\u6307\u5b9a\u8be5\u66f2\u7ebf\u7684\u5f27\u5ea6\uff0c\u6216\u8005\u8bf4\u6307\u5b9a\u8be5\u66f2\u7ebf\u7684\u5f2f\u66f2\u8d70\u5411\uff0c\u4e0d\u540c\u7684\u63a7\u5236\u70b9\u5f97\u51fa\u7684\u66f2\u7ebf\u7ed8\u5236\u7ed3\u679c\u662f\u4e0d\u4e00\u6837\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u89c2\u5bdf\u5230\uff0c\u65e0\u8bba\u662f\u51e0\u9636\u8d1d\u585e\u5c14\u66f2\u7ebf\uff0c\u90fd\u4f1a\u6709\u53c2\u6570 t \u4ee5\u53ca t \u7684\u53d6\u503c\u8303\u56f4\u9650\u5b9a\u3002</p> <p>t \u5728 0~1 \u8303\u56f4\u7684\u95ed\u533a\u95f4\u5185\uff0c\u90a3\u4e48 t \u7684\u53d6\u503c\u4e2a\u6570\u5b9e\u9645\u4e0a\u5c31\u6709\u65e0\u6570\u4e2a\u4e86\uff0c\u8fd9\u65f6\u7684 t \u5c31\u53ef\u4ee5\u7406\u89e3\u6210\u4e0a\u9762\u4ecb\u7ecd\u76f4\u7ebf\u4e2d\u8bb2\u5230\u7684 x \u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u53ef\u4ee5\u628a\u8d77\u59cb\u70b9\u3001\u63a7\u5236\u70b9\u5f53\u521d\u56fa\u5b9a\u53c2\u6570\uff0c\u90a3\u4e48\u8d1d\u585e\u5c14\u66f2\u7ebf\u8ba1\u7b97\u516c\u5f0f\u5c31\u6210\u4e86 B = F(t) \uff0cB \u662f\u5173\u4e8e t \u7684\u51fd\u6570\uff0c\u800c t \u7684\u53d6\u503c\u8303\u56f4\u4e3a 0~1 \u7684\u95ed\u533a\u95f4\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u8d1d\u585e\u5c14\u66f2\u7ebf\uff0c\u9009\u5b9a\u4e86\u8d77\u59cb\u70b9\u548c\u63a7\u5236\u70b9\uff0c\u7167\u6837\u53ef\u4ee5\u770b\u6210\u662f t \u5728 0~1 \u95ed\u533a\u95f4\u5185\u5bf9\u5e94\u7684\u65e0\u6570\u4e2a\u70b9\u6240\u7ec4\u6210\u7684\u3002</p> <p>\u6709\u4e86\u4e0a\u9762\u7684\u9610\u8ff0\uff0c\u5728\u5de5(ban)\u7a0b(zhuan)\u7684\u89d2\u5ea6\u4e0a\uff0c\u5c31\u4e0d\u96be\u7406\u89e3\u8d1d\u585e\u5c14\u66f2\u7ebf\u5230\u5e95\u600e\u4e48\u4f7f\u7528\u4e86\u3002</p>","tags":["oepngl","bezier"]},{"location":"opengl/opengl-draw-bezier-line/#android","title":"Android \u7ed8\u5236\u8d1d\u585e\u5c14\u66f2\u7ebf","text":"<p>Android \u81ea\u5e26\u8d1d\u585e\u5c14\u66f2\u7ebf\u7ed8\u5236 API \uff0c\u901a\u8fc7 Path \u7c7b\u7684 <code>quadTo</code> \u548c <code>cubicTo</code> \u65b9\u6cd5\u5c31\u53ef\u4ee5\u5b8c\u6210\u7ed8\u5236\u3002  </p> <pre><code>  // \u6784\u5efa path \u8def\u5f84\uff0c\u4e5f\u5c31\u662f\u9009\u53d6\n  path.reset();\n  path.moveTo(p0x, p0y);\n  // \u7ed8\u5236\u4e8c\u9636\u8d1d\u585e\u5c14\u66f2\u7ebf\n  path.quadTo(p1x, p1y, p2x, p2y);\n  path.moveTo(p0x, p0y);\n  path.close();\n\n  // \u6700\u540e\u7684\u7ed8\u5236\u64cd\u4f5c\n  canvas.drawPath(path, paint);\n</code></pre> <p>\u8fd9\u91cc\u7684\u7ed8\u5236\u5b9e\u9645\u4e0a\u5c31\u662f\u628a\u8d1d\u585e\u5c14\u66f2\u7ebf\u8ba1\u7b97\u7684\u65b9\u7a0b\u5f0f\u4ea4\u7ed9\u4e86 Android \u7cfb\u7edf\u5185\u90e8\u53bb\u5b8c\u6210\u4e86\uff0c\u53c2\u6570\u4f20\u9012\u4e0a\u53ea\u4f20\u9012\u4e86\u8d77\u59cb\u70b9\u548c\u63a7\u5236\u70b9\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u81ea\u5df1\u7684\u4ee3\u7801\u6765\u8ba1\u7b97\u8fd9\u4e2a\u65b9\u7a0b\u5f0f\u4ece\u800c\u5bf9\u903b\u8f91\u4e0a\u83b7\u5f97\u66f4\u591a\u63a7\u5236\u6743\uff0c\u4e5f\u5c31\u662f\u628a\u66f2\u7ebf\u62c6\u5206\u6210\u8bb8\u591a\u4e2a\u70b9\u7ec4\u6210\uff0c\u5982\u679c\u70b9\u7684\u5c3a\u5bf8\u6bd4\u8f83\u5927\uff0c\u751a\u81f3\u53ef\u4ee5\u51cf\u5c11\u70b9\u7684\u4e2a\u6570\u5b9e\u73b0\u540c\u6837\u7684\u6548\u679c\uff0c\u8fbe\u5230\u7ed8\u5236\u4f18\u5316\u7684\u76ee\u7684\u3002</p>","tags":["oepngl","bezier"]},{"location":"opengl/opengl-draw-bezier-line/#opengl","title":"OpenGL \u7ed8\u5236","text":"<p>\u901a\u8fc7 OpenGL \u53ef\u4ee5\u5b9e\u73b0\u6211\u4eec\u4e0a\u8ff0\u7684\u65b9\u6848\uff0c\u628a\u66f2\u7ebf\u62c6\u5206\u6210\u591a\u4e2a\u70b9\u7ec4\u6210\u3002\u8fd9\u79cd\u65b9\u6848\u8981\u6c42\u6211\u4eec\u5728 CPU \u4e0a\u53bb\u8ba1\u7b97\u8d1d\u585e\u5c14\u66f2\u7ebf\u65b9\u7a0b\uff0c\u6839\u636e t \u7684\u6bcf\u4e00\u4e2a\u53d6\u503c\uff0c\u8ba1\u7b97\u51fa\u4e00\u4e2a\u8d1d\u585e\u5c14\u70b9\uff0c\u7528 OpenGL \u53bb\u7ed8\u5236\u4e0a\u8fd9\u4e2a\u70b9\u3002</p> <p>\u8fd9\u4e2a\u70b9\u7684\u7ed8\u5236\u53ef\u4ee5\u91c7\u7528 OpenGL \u4e2d\u753b\u4e09\u89d2\u5f62 <code>GL_TRIANGLES</code> \u7684\u5f62\u5f0f\u53bb\u7ed8\u5236\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7ed9\u70b9\u5e26\u4e0a\u7eb9\u7406\u6548\u679c\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u9762\u7684\u5751\u7565\u591a\uff0c\u8d77\u59cb\u70b9\u548c\u63a7\u5236\u70b9\u90fd\u662f\u8fd0\u884c\u65f6\u52a8\u6001\u53ef\u53d8\u7684\u5b9e\u73b0\u96be\u5ea6\u4f1a\u5927\u4e8e\u56fa\u5b9a\u4e0d\u53d8\u7684\u3002</p> <p>\u8fd9\u91cc\u5148\u4ecb\u7ecd\u53e6\u4e00\u79cd\u65b9\u6848\uff0c\u8fd9\u79cd\u65b9\u6848\u5b9e\u73b0\u6bd4\u8f83\u7b80\u5355\u4e5f\u80fd\u8fbe\u5230\u4f18\u5316\u6548\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8d1d\u585e\u5c14\u66f2\u7ebf\u7684\u8ba1\u7b97\u65b9\u7a0b\u5f0f\u4ea4\u7ed9 GPU\uff0c \u5728 OpenGL Shader \u4e2d\u53bb\u5b8c\u6210\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u53ea\u8981\u7ed9\u5b9a\u8d77\u59cb\u70b9\u548c\u63a7\u5236\u70b9\uff0c\u4e2d\u95f4\u8ba1\u7b97\u8d1d\u585e\u5c14\u66f2\u7ebf\u53bb\u586b\u8865\u70b9\u7684\u8fc7\u7a0b\u5c31\u4ea4\u7ed9 Shader \u53bb\u5b8c\u6210\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u901a\u8fc7\u63a7\u5236 t \u7684\u6570\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u8d1d\u585e\u5c14\u70b9\u586b\u8865\u7684\u758f\u5bc6\u3002</p> <p>t \u8d8a\u5927\uff0c\u586b\u8865\u7684\u70b9\u8d8a\u591a\uff0c\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\u540e\uff0c\u4e0d\u4f1a\u5bf9\u7ed8\u5236\u6548\u679c\u6709\u63d0\u5347\uff0c\u53cd\u800c\u5f71\u54cd\u6027\u80fd\u3002</p> <p>t \u8d8a\u5c0f\uff0c\u90a3\u4e48\u8d1d\u585e\u5c14\u66f2\u7ebf\u5c31\u9000\u5316\u6210\u4e00\u4e32\u70b9\u7ec4\u6210\u4e86\u3002\u6240\u4ee5\u8bf4 t \u7684\u53d6\u503c\u8303\u56f4\u4e5f\u80fd\u5bf9\u7ed8\u5236\u8d77\u5230\u4f18\u5316\u4f5c\u7528\u3002</p> <p>\u7ed8\u5236\u6548\u679c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ee5\u4e0b\u5c31\u662f\u5b9e\u9645\u7684\u4ee3\u7801\u90e8\u5206\u4e86\uff0c\u5173\u4e8e OpenGL \u7684\u57fa\u7840\u7406\u8bba\u90e8\u5206\u53ef\u4ee5\u53c2\u8003\u4e4b\u524d\u5199\u8fc7\u7684\u6587\u7ae0\u548c\u516c\u4f17\u53f7\uff0c\u5c31\u4e0d\u518d\u9610\u8ff0\u4e86\u3002</p> <p>\u5728 Shader \u4e2d\u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\uff0c\u5b9e\u73b0\u8d1d\u585e\u5c14\u65b9\u7a0b\uff1a</p> <pre><code>vec2 fun(in vec2 p0, in vec2 p1, in vec2 p2, in vec2 p3, in float t){\n    float tt = (1.0 - t) * (1.0 -t);\n    return tt * (1.0 -t) *p0 \n            + 3.0 * t * tt * p1 \n            + 3.0 * t *t *(1.0 -t) *p2 \n            + t *t *t *p3;\n}\n</code></pre> <p>\u8be5\u65b9\u7a0b\u53ef\u4ee5\u5229\u7528 Shader \u4e2d\u81ea\u5e26\u7684\u51fd\u6570\u4f18\u5316\u4e00\u6ce2\uff1a</p> <pre><code>vec2 fun2(in vec2 p0, in vec2 p1, in vec2 p2, in vec2 p3, in float t)\n{\n    vec2 q0 = mix(p0, p1, t);\n    vec2 q1 = mix(p1, p2, t);\n    vec2 q2 = mix(p2, p3, t);\n    vec2 r0 = mix(q0, q1, t);\n    vec2 r1 = mix(q1, q2, t);\n    return mix(r0, r1, t);\n}\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u5177\u4f53\u7684\u9876\u70b9\u7740\u8272\u5668 shader \uff1a</p> <pre><code>// \u5bf9\u5e94 t \u6570\u636e\u7684\u4f20\u9012\nattribute float aData;\n// \u5bf9\u5e94\u8d77\u59cb\u70b9\u548c\u7ed3\u675f\u70b9\nuniform vec4 uStartEndData;\n// \u5bf9\u5e94\u63a7\u5236\u70b9\nuniform vec4 uControlData;\n// mvp \u77e9\u9635\nuniform mat4 u_MVPMatrix;\n\nvoid main() {\n    vec4 pos;\n    pos.w = 1.0;\n    // \u53d6\u51fa\u8d77\u59cb\u70b9\u3001\u7ed3\u675f\u70b9\u3001\u63a7\u5236\u70b9\n    vec2 p0 = uStartEndData.xy;\n    vec2 p3 = uStartEndData.zw;\n    vec2 p1 = uControlData.xy;\n    vec2 p2 = uControlData.zw;\n    // \u53d6\u51fa t \u7684\u503c\n    float t = aData;\n    // \u8ba1\u7b97\u8d1d\u585e\u5c14\u70b9\u7684\u51fd\u6570\u8c03\u7528\n    vec2 point = fun2(p0, p1, p2, p3, t);\n    // \u5b9a\u4e49\u70b9\u7684 x,y \u5750\u6807\n    pos.xy = point;\n    // \u8981\u7ed8\u5236\u7684\u4f4d\u7f6e\n    gl_Position = u_MVPMatrix * pos;\n    // \u5b9a\u4e49\u70b9\u7684\u5c3a\u5bf8\u5927\u5c0f\n    gl_PointSize = 20.0;\n}\n</code></pre> <p>\u4ee3\u7801\u4e2d\u7684 <code>uStartEndData</code> \u5bf9\u5e94\u8d77\u59cb\u70b9\u548c\u7ed3\u675f\u70b9\uff0c<code>uControlData</code> \u5bf9\u5e94\u4e24\u4e2a\u63a7\u5236\u70b9\u3002</p> <p>\u8fd9\u4e24\u4e2a\u53d8\u91cf\u7684\u6570\u636e\u4f20\u9012\u901a\u8fc7 <code>glUniform4f</code> \u65b9\u6cd5\u5c31\u597d\u4e86\uff1a</p> <pre><code>    mStartEndHandle = glGetUniformLocation(mProgram, \"uStartEndData\");\n    mControlHandle = glGetUniformLocation(mProgram, \"uControlData\");\n    // \u4f20\u9012\u6570\u636e\uff0c\u4f5c\u4e3a\u56fa\u5b9a\u503c\n    glUniform4f(mStartEndHandle,\n            mStartEndPoints[0],\n            mStartEndPoints[1],\n            mStartEndPoints[2],\n            mStartEndPoints[3]);\n    glUniform4f(mControlHandle,\n            mControlPoints[0],\n            mControlPoints[1],\n            mControlPoints[2],\n            mControlPoints[3]);  \n</code></pre> <p>\u53e6\u5916\u91cd\u8981\u7684\u53d8\u91cf\u5c31\u662f <code>aData</code> \u4e86\uff0c\u5b83\u5bf9\u5e94\u7684\u5c31\u662f t \u5728 0~1 \u95ed\u533a\u95f4\u7684\u5212\u5206\u7684\u6570\u91cf\u3002</p> <pre><code>    private float[] genTData() {\n        float[] tData = new float[Const.NUM_POINTS];\n        for (int i = 0; i &lt; tData.length; i ++) {\n            float t = (float) i / (float) tData.length;\n            tData[i] = t;\n        }\n        return tData;\n    }\n</code></pre> <p>\u4ee5\u4e0a\u51fd\u6570\u5c31\u662f\u628a t \u5728 0~1 \u95ed\u533a\u95f4\u5206\u6210 <code>Const.NUM_POINTS</code> \u4efd\uff0c\u6bcf\u4e00\u4efd\u7684\u503c\u90fd\u5b58\u5728 tData \u6570\u7ec4\u4e2d\uff0c\u6700\u540e\u901a\u8fc7 <code>glVertexAttribPointer</code> \u51fd\u6570\u4f20\u9012\u7ed9 Shader \u3002</p> <p>\u6700\u540e\u5b9e\u9645\u7ed8\u5236\u65f6\uff0c\u6211\u4eec\u91c7\u7528 <code>GL_POINTS</code> \u7684\u5f62\u5f0f\u7ed8\u5236\u5c31\u597d\u4e86\u3002</p> <pre><code>        GLES20.glDrawArrays(GLES20.GL_POINTS, 0, Const.NUM_POINTS );\n</code></pre> <p>\u4ee5\u4e0a\u5c31\u662f OpenGL \u7ed8\u5236\u8d1d\u585e\u5c14\u66f2\u7ebf\u7684\u5c0f\u5b9e\u8df5\u3002</p> <p>\u5177\u4f53\u7684\u4ee3\u7801\u90e8\u5206\u53ef\u4ee5\u53c2\u8003\u6211\u7684\u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p> <p>\u5728\u53c2\u8003\u4e2d\uff0c\u4e5f\u6709\u4e00\u4e2a OpenGL \u7ed8\u5236\u8d1d\u585e\u5c14\u66f2\u7ebf\u7684\u4f8b\u5b50\uff0c\u4e0d\u8fc7\u4ed6\u7ed8\u5236\u7684\u662f\u8d1d\u585e\u5c14\u66f2\u7ebf\u9762\uff0c\u91c7\u7528\u7684\u662f <code>GL_TRIANGLES</code> \u7684\u5f62\u5f0f\uff0c\u800c\u4e14\u5728 <code>tData</code> \u6570\u7ec4\u7684\u6784\u9020\u4e5f\u6709\u4e9b\u4e0d\u540c\uff0c\u4f46\u662f\u90fd\u5927\u540c\u5c0f\u5f02\u4e86\uff0c\u770b\u660e\u767d\u4e86\u672c\u6587\u7684\u4f8b\u5b50\u4e5f\u4e0d\u96be\u7406\u89e3\u53c2\u8003\u7684\u6587\u7ae0\u3002</p>","tags":["oepngl","bezier"]},{"location":"opengl/opengl-draw-bezier-line/#_1","title":"\u53c2\u8003","text":"<ol> <li>https://yalantis.com/blog/how-we-created-visualization-for-horizon-our-open-source-library-for-sound-visualization/</li> </ol>","tags":["oepngl","bezier"]},{"location":"opengl/opengl-draw-grid-optimize/","title":"Shader \u4f18\u5316 | OpenGL \u7ed8\u5236\u7f51\u683c\u6548\u679c","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/FmILdXuy3HMpv8H1Kz_fPw</p> <p>\u524d\u51e0\u5929\u53d1\u5e03\u4e86\u8fd9\u6837\u4e00\u7bc7\u6587\u7ae0\uff1a</p> <p>KodeLife | Shader \u5b9e\u65f6\u7f16\u8f91\u9884\u89c8\u7684\u5f3a\u5927\u5de5\u5177\u4f7f\u7528\u5b9e\u8df5</p> <p>\u9664\u4e86\u4ecb\u7ecd KodeLife \u7684\u4f7f\u7528\u4e4b\u5916\uff0c\u8fd8\u9644\u5e26\u4e86\u4e00\u4e2a Shader \u7ed8\u5236\u7f51\u683c\u6548\u679c\u7684\u4ee3\u7801\u3002</p> <p>\u628a\u8fd9\u7bc7\u6587\u7ae0\u53d1\u5230\u6280\u672f\u7fa4\u91cc\uff0c\u968f\u673a\u5c31\u6709\u5927\u4f6c\u6307\u51fa\u4e0d\u8db3\u4e4b\u5904\uff0c\u63d0\u793a\u8bf4\u4ee3\u7801\u8fd8\u53ef\u4ee5\u8fdb\u4e00\u6b65\u4f18\u5316\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u6e90\u7801\u5b66\u4e60\u3002</p> <p>\u53ef\u89c1\u52a0\u5165\u4e00\u4e2a\u9ad8\u8d28\u91cf\u7684\u6280\u672f\u7fa4\u662f\u591a\u4e48\u91cd\u8981\uff0c\u54ea\u6015\u5e73\u65f6\u4e0d\u8bf4\u8bdd\uff0c\u56f4\u89c2\u5927\u4f6c\u4eec\u804a\u5929\u90fd\u80fd\u5b66\u5230\u5f88\u591a\u3002</p> <p>\u73b0\u5728\u52a0\u5165\u8fd8\u6765\u5f97\u53ca\uff0c\u5c1a\u6709\u4f59\u4f4d\uff0c\u8be6\u60c5\u70b9\u51fb\u5982\u4e0b\u94fe\u63a5\uff1a</p> <p>\u79fb\u52a8\u7aef\u6280\u672f\u4ea4\u6d41\u558a\u4f60\u5165\u7fa4\u5566<sub>~</sub></p>","tags":["OpenGL"]},{"location":"opengl/opengl-draw-grid-optimize/#shader","title":"Shader \u8bb2\u89e3","text":"<p>\u5728\u6211\u7684 Shader \u4ee3\u7801\u4e2d\u662f\u8fd9\u6837\u7ed8\u5236\u7f51\u683c\u7684\uff1a</p> <pre><code>    vec2 fragcoord = vec2(gl_FragCoord.xy / u_resolution);\n    vec3 bgColor = vec3(1.0,1.0,1.0);\n    vec3 pixelColor = bgColor;\n    vec3 gridColor = vec3(0.5,0.5,0.5);\n\n    const float width = 0.1;\n    const float minWidth = 0.003;\n    for(float i = 0.0; i &lt; 1.0; i+=width){\n    if (mod(fragcoord.x,width) &lt; minWidth || mod(fragcoord.y,width) &lt; minWidth){\n            pixelColor = gridColor;\n        }\n    }\n    gl_FragColor = vec4(pixelColor,1.0);\n</code></pre> <p>\u9996\u5148\uff0c\u8bb2\u89e3\u51e0\u4e2a\u6982\u5ff5\uff1a</p> <p><code>gl_FragCoord</code> \u4ee3\u8868\u5f53\u524d\u50cf\u7d20\u76f8\u5bf9\u4e8e\u5c4f\u5e55\u7684\u5750\u6807\uff0c\u5c4f\u5e55\u5de6\u4e0b\u89d2\u4e3a\u539f\u70b9\u3002</p> <p><code>u_resolution</code> \u662f\u5f53\u524d\u56fe\u50cf\u7684\u5206\u8fa8\u7387\u3002</p> <p>\u7528 <code>gl_FragCoord</code> \u9664\u4ee5 <code>u_resolution</code> \u5f97\u5230\u7684\u7ed3\u679c <code>fragcoord</code> \u5c31\u662f\u5f52\u4e00\u5316\u7684\u5c4f\u5e55\u5750\u6807\u3002</p> <p>\u7531\u4e8e\u5df2\u7ecf\u5f52\u4e00\u5316\u4e86\u90a3\u4e48 <code>fragcoord</code> \u7684\u503c\u5c31\u5728 <code>[0,1]</code> \u7684\u95ed\u533a\u95f4\u5185\u3002</p> <p>\u540c\u65f6\u7528 <code>gridColor</code> \u4f5c\u4e3a\u7f51\u683c\u7684\u989c\u8272\uff0c<code>bgColor</code> \u4f5c\u4e3a\u80cc\u666f\u8272\uff0c\u4e5f\u662f\u9ed8\u8ba4\u7684\u989c\u8272\uff0c<code>pixelColor</code> \u4f5c\u4e3a\u6700\u540e\u8f93\u51fa\u7684\u989c\u8272\u3002</p> <p>\u90a3\u4e48\uff0c\u4ee3\u7801\u7684\u91cd\u70b9\u5c31\u5728\u4e8e <code>for</code> \u5faa\u73af\u91cc\u9762\u4e86\u3002</p> <p>\u7531\u4e8e <code>fragcoord</code> \u5f52\u4e00\u5316\u6709\u4e86\u786e\u5b9a\u7684\u503c\u57df\u8303\u56f4\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728 <code>for</code> \u5faa\u73af\u4e2d\u5c06\u5b83\u5341\u7b49\u5206\u3002</p> <p>\u53e6\u5916\uff0c\u56e0\u4e3a\u7247\u6bb5\u7740\u8272\u5668\u6bcf\u4e2a\u50cf\u7d20\u90fd\u4f1a\u6267\u884c\u4e00\u904d\uff0c\u6bcf\u6b21 <code>fragcoord</code> \u503c\u90fd\u662f\u53d8\u5316\u7684\uff0c\u4f46\u4e0d\u7ba1\u600e\u4e48\u53d8\u5316\uff0c\u5b83\u7684\u8303\u56f4\u90fd\u4f1a\u843d\u5728 <code>for</code> \u5faa\u73af\u7684\u5341\u7b49\u4efd\u91cc\u9762\u3002</p> <p>\u6bd4\u5982\u5176\u4e2d\u67d0\u4e00\u4efd\u7684\u8303\u56f4\u662f <code>[0.2,0.3)</code> \u7684\u5de6\u95ed\u53f3\u5f00\u533a\u95f4\uff0c\u5f53\u524d\u50cf\u7d20\u5c31\u843d\u5728\u8fd9\u4e2a\u8303\u56f4\u5185\u3002</p> <p>\u90a3\u4e48 <code>mod</code> \u53d6\u6a21\u51fd\u6570\u5c31\u4f1a\u5224\u65ad\u5f53\u524d\u503c\u8ddd\u79bb\u5de6\u533a\u95f4\u9608\u503c\u662f\u5426\u5728 <code>minWidth</code> \u8303\u56f4\u5185\uff0c\u5176\u4e2d <code>minWidth</code> \u76f8\u5f53\u4e8e\u662f\u6307\u5b9a\u7f51\u683c\u7ebf\u7684\u5bbd\u5ea6\u3002</p> <p>\u5982\u679c\u5728\u8303\u56f4\u5185\uff0c\u90a3\u4e48\u663e\u793a\u7684\u989c\u8272\u5c31\u662f\u7f51\u683c\u8272\uff0c\u5426\u5219\u5c31\u662f\u9ed8\u8ba4\u7684\u80cc\u666f\u8272\u3002</p> <p>\u4ee5\u4e0a\u7684\u8bb2\u89e3\u5bf9\u4e8e\u5750\u6807\u7684 <code>x</code> \u548c <code>y</code> \u503c\u662f\u4e00\u6837\u7684\u9053\u7406\u3002\u539f\u7406\u901a\u8fc7\u5224\u65ad\u8be5\u50cf\u7d20\u70b9\u7684\u5750\u6807\u662f\u5426\u4f4d\u4e8e\u4e34\u754c\u8303\u56f4\u5185\u6765\u9009\u62e9\u6027\u7740\u8272\u3002</p> <p>\u663e\u793a\u8fd9\u79cd\u7ed8\u5236\u65b9\u5f0f\u662f\u6709\u5b83\u7684\u5f0a\u7aef\uff0c\u56e0\u4e3a\u6bcf\u4e00\u4e2a\u50cf\u7d20\u6267\u884c\u7247\u6bb5\u7740\u8272\u5668\u7684\u65f6\u5019\uff0c\u90fd\u8981\u8fdb\u884c\u4e00\u6b21 <code>for</code> \u5faa\u73af\u5224\u65ad\u5b83\u5904\u4e8e\u54ea\u4e2a\u533a\u57df\u5185\u3002</p> <p>\u8fd9\u6837\u5c31\u6709\u4e86\u592a\u591a\u4e0d\u5fc5\u8981\u7684\u8ba1\u7b97\u6d41\u7a0b\uff0c\u5c24\u5176\u662f <code>for</code> \u5faa\u73af\u7684\u6bcf\u6b21\u904d\u5386\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u5fae\u4fe1\u7fa4\u4e2d\u5927\u4f6c\u7ed9\u51fa\u7684 Shader \u4ee3\u7801\uff1a</p> <pre><code>vec2 st = vec2(gl_FragCoord.xy / u_resolution);\nst.x *= u_resolution.x / u_resolution.y;\n\nvec3 color = vec3(.0);\n\nst *= 10.;\n\nvec2 i_st = floor(st);\nvec2 f_st = fract(st);\n\ncolor += step(.98,f_st.x) + step(.98,f_st.y);\n\ngl_FragColor = vec4(color,1.0);\n</code></pre> <p>\u53ef\u4ee5\u4e00\u773c\u770b\u51fa\u8fd9\u91cc\u9762\u6ca1\u6709 <code>for</code> \u5faa\u73af\u7684\u64cd\u4f5c\u4e86\u3002</p> <p>\u8fd8\u662f\u5148\u8bb2\u89e3\u51e0\u4e2a\u7ea7\u522b\u64cd\u4f5c\uff1a</p> <p><code>floor</code> \u51fd\u6570\u5c31\u662f\u5411\u4e0b\u53d6\u6574\u7684\u64cd\u4f5c</p> <p><code>fract</code> \u51fd\u6570\u662f <code>x - floor(x)</code> \u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u53d6\u5c0f\u6570\u90e8\u5206\u7684\u610f\u601d\u3002</p> <p>\u901a\u8fc7\u5bf9 <code>st</code> \u8fdb\u884c <code>floor</code> \u548c <code>fract</code> \u64cd\u4f5c\u53ef\u4ee5\u5206\u51fa\u5b83\u7684\u6574\u6570\u548c\u5c0f\u6570\u90e8\u5206\u3002</p> <p><code>step</code> \u51fd\u6570\u7c7b\u4f3c\u4e8e <code>if</code> \u5224\u65ad\uff0c\u5f53\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5927\u4e8e\u7b49\u4e8e\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u5219\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002</p> <p>\u6574\u4e2a Shader \u4ee3\u7801\u7b2c\u4e00\u884c\u8fd8\u662f\u76f8\u540c\u7684\uff0c\u90fd\u662f\u5f52\u4e00\u5316\u64cd\u4f5c\u3002</p> <p>\u7136\u540e\u5728\u7b2c\u4e8c\u884c</p> <pre><code>st.x *= u_resolution.x / u_resolution.y\n</code></pre> <p>\u5b9e\u9645\u4e0a\u662f\u505a\u4e86\u4e00\u4e2a\u6bd4\u4f8b\u5207\u6362\u7684\u64cd\u4f5c\u3002\u5c06 <code>st</code> \u7684 <code>x</code> \uff0c<code>y</code> \u503c\u6309\u7167\u56fe\u50cf\u5206\u8fa8\u7387\u7684\u5bbd\u9ad8\u6bd4\u505a\u4e86\u8c03\u6574\uff0c\u5176\u4e2d\u4ee5 <code>y</code> \u4e3a\u57fa\u51c6 1 \u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c<code>st</code> \u7684 <code>y</code> \u503c\u8fd8\u662f\u5728 <code>[0,1]</code> \u8303\u56f4\u5185\uff0c\u800c <code>x</code> \u503c\u53ef\u80fd\u5927\u4e8e\u4e5f\u53ef\u80fd\u5c0f\u4e8e\u8fd9\u4e2a\u8303\u56f4\u4e86\uff0c\u8fd9\u90fd\u53d6\u51b3\u4e8e\u56fe\u50cf\u5206\u8fa8\u7387\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5c06 <code>st</code> \u4e58\u4e86 10 \uff0c\u8fd9\u4e0b st \u7684\u503c\u57df\u8303\u56f4\u5c31\u5728 <code>[0,10]</code> \u4e86 \uff0c\u8fd9\u6837\u7684\u64cd\u4f5c\u662f\u4e3a\u4e86\u63a5\u4e0b\u6765\u7684 <code>floor</code> \u51fd\u6570\uff0c\u56e0\u4e3a\u5b83\u662f\u53d6\u6574\uff0c\u5982\u679c\u90fd\u5728 <code>[0,1]</code> \u8303\u56f4\u5185\uff0c\u53d6\u7684\u6574\u6570\u6c38\u8fdc\u90fd\u662f 0 \u4e86\u3002</p> <p>\u524d\u9762\u8f6c\u6362\u64cd\u4f5c\u662f\u4e3a\u4e86\u63a5\u4e0b\u6765\u7684\u91cd\u70b9\u51fd\u6570 <code>step</code> \u3002</p> <pre><code>color += step(.98,f_st.x) + step(.98,f_st.y);\n</code></pre> <p>\u524d\u9762\u7684 <code>floor</code> \u5176\u5b9e\u4e5f\u662f\u5c06 <code>x</code> \u548c <code>y</code> \u8f74\u505a\u4e86\u7b49\u5206\uff0c\u6bd4\u5982 <code>y</code> \u7684\u503c\u57df\u662f <code>[0,1]</code> \uff0c\u4e58\u4ee5 10 \u4e4b\u540e\uff0c\u5c31\u662f\u5341\u7b49\u5206\uff0c<code>x</code> \u7684\u503c\u57df\u5982\u679c\u662f <code>[0,1.7]</code> \uff0c\u4e58\u4ee5 10 \u4e4b\u540e\uff0c\u5c31\u662f\u5341\u4e03\u7b49\u5206\u3002</p> <p>\u800c <code>fract</code> \u64cd\u4f5c\u7684\u7ed3\u679c\u8303\u56f4\u5fc5\u7136\u662f <code>[0,1)</code> \u7684\u5de6\u95ed\u53f3\u5f00\u533a\u95f4\u3002</p> <p><code>step</code> \u51fd\u6570\u7684\u610f\u56fe\u5c31\u662f\u5982\u679c\u8be5\u50cf\u7d20\u70b9\u7684\u5750\u6807\u63a5\u8fd1\u4e8e\u7b49\u5206\u7ebf\uff0c\u90a3\u4e48 color \u7684\u989c\u8272\u503c\u8fd4\u56de\u7684\u5c31\u662f 1 \uff0c\u663e\u793a\u767d\u8272\uff0c\u5426\u5219\u8fd4\u56de 0 \uff0c\u663e\u793a\u9ed1\u8272\u3002</p> <p>\u6bd4\u5982\uff0cst \u7684 <code>x</code> \u503c\u662f 7.99 \u4e86\uff0c\u63a5\u8fd1\u4e8e 8 \uff0c\u90a3\u4e48\u5c31\u8981\u663e\u793a\u767d\u8272\u7f51\u683c\u7ebf\u4e86\uff0c\u5bf9\u4e8e <code>y</code> \u503c\u540c\u7406\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\u5c31\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u50cf\u7d20\u70b9\u8fdb\u884c\u5224\u65ad\uff0c\u6839\u636e\u5b83\u7684\u5750\u6807\u51b3\u5b9a\u8981\u663e\u793a\u4ec0\u4e48\u989c\u8272\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-draw-grid-optimize/#_1","title":"\u603b\u7ed3\u5bf9\u6bd4","text":"<p>\u5728\u7b2c\u4e8c\u79cd\u7ed8\u5236\u4e2d\uff0c\u7531\u4e8e\u505a\u4e86\u6bd4\u4f8b\u8f6c\u6362\u64cd\u4f5c\uff0c\u6240\u4ee5\u7ed8\u5236\u51fa\u6765\u7684\u7f51\u683c\u5927\u5c0f\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u4e14\u90fd\u662f\u6b63\u65b9\u5f62\u3002</p> <p>\u800c\u7b2c\u4e00\u79cd\u6ca1\u6709\u6bd4\u4f8b\u5207\u6362\u64cd\u4f5c\uff0c\u5f53\u5bbd\u9ad8\u4e0d\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u540c\u6837\u8fdb\u884c\u5341\u7b49\u5206\u7684\u8bdd\uff0c\u753b\u51fa\u6765\u7684\u7f51\u683c\u662f\u4e2a\u957f\u65b9\u5f62\u4e86\u3002</p> <p>\u4f46\u662f\uff0c\u4e24\u79cd\u7ed8\u5236\u7684\u601d\u8def\u90fd\u662f\u76f8\u540c\u7684\uff0c\u59d1\u4e14\u79f0\u5b83\u4e3a <code>\u63a5\u8fd1\u6cd5</code> \u5427\uff0c\u5f53\u7ed8\u5236\u7684\u50cf\u7d20\u63a5\u8fd1\u7b49\u5206\u7ebf\u65f6\uff0c\u5c31\u663e\u793a\u4e0d\u4e00\u6837\u7684\u989c\u8272\u3002</p> <p>\u4e8e\u662f\uff0c\u7b49\u5206\u7ebf\u7684\u64cd\u4f5c\u601d\u8def\u5c31\u5404\u6709\u4e0d\u540c\u4e86\u3002\u524d\u8005\u662f\u5229\u7528 <code>for</code> \u5faa\u73af\u6765\u5236\u9020\u5212\u5206\uff0c\u540e\u8005\u5219\u662f\u5229\u7528\u5f53\u524d\u50cf\u7d20\u7684 <code>x</code>\u3001<code>y</code> \u503c\u7684\u7279\u70b9\u6765\u7ed8\u5236\u7684\u3002</p> <p>\u5f53\u7136\u66f4\u63a8\u5d07\u540e\u8005\u7684\u7ed8\u5236\u65b9\u5f0f\u4e86\uff0c\u4e5f\u662f\u5b66\u5230\u4e86\u65b0\u6280\u5de7<sub>~</sub></p> <p>\u80fd\u529b\u4e0d\u8db3\uff0c\u7ecf\u9a8c\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4f55\u4e0d\u5bf9\u7684\u5730\u65b9\u6b22\u8fce\u6279\u8bc4\u6307\u6b63\uff0c\u4e5f\u53ef\u4ee5\u52a0\u6211\u5fae\u4fe1 ezglumes \u4ea4\u6d41~~</p>","tags":["OpenGL"]},{"location":"opengl/opengl-egl-usage/","title":"OpenGL \u4e4b EGL \u4f7f\u7528\u5b9e\u8df5","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/AGMA4xvynzmdCNo-Caur-g</p> <p>OpenGL \u662f\u8de8\u5e73\u53f0\u7684\u3001\u4e13\u4e1a\u7684\u56fe\u5f62\u7f16\u7a0b\u63a5\u53e3\uff0c\u800c\u63a5\u53e3\u7684\u5b9e\u73b0\u662f\u7531\u5382\u5546\u6765\u5b8c\u6210\u7684\u3002</p> <p>\u800c\u5f53\u6211\u4eec\u4f7f\u7528\u8fd9\u7ec4\u63a5\u53e3\u5b8c\u6210\u7ed8\u5236\u4e4b\u540e\uff0c\u8981\u628a\u7ed3\u679c\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\uff0c\u5c31\u8981\u7528\u5230 <code>EGL</code> \u6765\u5b8c\u6210\u8fd9\u4e2a\u8f6c\u6362\u5de5\u4f5c\u3002</p> <p>EGL \u662f OpenGL ES \u6e32\u67d3 API \u548c\u672c\u5730\u7a97\u53e3\u7cfb\u7edf\uff08native platform window system\uff09\u4e4b\u95f4\u7684\u4e00\u4e2a\u4e2d\u95f4\u63a5\u53e3\u5c42\uff0c\u5b83\u4e5f\u4e3b\u8981\u7531\u5382\u5546\u6765\u5b9e\u73b0\u3002EGL \u63d0\u4f9b\u4e86\u5982\u4e0b\u673a\u5236\uff1a</p> <ul> <li>\u4e0e\u8bbe\u5907\u7684\u539f\u751f\u7a97\u53e3\u7cfb\u7edf\u901a\u4fe1</li> <li>\u67e5\u8be2\u7ed8\u56fe\u8868\u9762\u7684\u53ef\u7528\u7c7b\u578b\u548c\u914d\u7f6e</li> <li>\u521b\u5efa\u7ed8\u56fe\u8868\u9762</li> <li>\u5728 OpenGL ES \u548c\u5176\u4ed6\u56fe\u5f62\u6e32\u67d3 API \u4e4b\u95f4\u540c\u6b65\u6e32\u67d3</li> <li>\u7ba1\u7406\u7eb9\u7406\u8d34\u56fe\u7b49\u6e32\u67d3\u8d44\u6e90</li> </ul> <p>\u4e3a\u4e86\u8ba9 OpenGL ES \u80fd\u591f\u7ed8\u5236\u5728\u5f53\u524d\u8bbe\u5907\u4e0a\uff0c\u6211\u4eec\u9700\u8981 EGL \u4f5c\u4e3a OpenGL ES \u4e0e\u8bbe\u5907\u7684\u6865\u6881\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528 GLSurfaceView \u6765\u8fdb\u884c OpenGL \u7684\u6e32\u67d3\uff0c\u5c31\u662f\u56e0\u4e3a\u5728 GLSurfaceView \u7684\u5185\u90e8\u5df2\u7ecf\u5b8c\u6210\u4e86\u5bf9 EGL \u7684\u4f7f\u7528\u5c01\u88c5\uff0c\u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c01\u88c5\u81ea\u5df1\u7684 EGL \u73af\u5883\u3002</p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#egl","title":"EGL \u4f7f\u7528\u5b9e\u8df5","text":"<p>EGL \u7684\u4f7f\u7528\u8981\u9075\u5faa\u4e00\u4e9b\u56fa\u5b9a\u7684\u6b65\u9aa4\uff0c\u6309\u7167\u8fd9\u4e9b\u6b65\u9aa4\u53bb\u914d\u7f6e\u3001\u521b\u5efa\u3001\u6e32\u67d3\u3001\u91ca\u653e\u3002</p> <ul> <li>\u521b\u5efa\u4e0e\u672c\u5730\u7a97\u53e3\u7cfb\u7edf\u7684\u8fde\u63a5<ul> <li>\u8c03\u7528 eglGetDisplay \u65b9\u6cd5\u5f97\u5230 EGLDisplay</li> </ul> </li> <li>\u521d\u59cb\u5316 EGL \u65b9\u6cd5<ul> <li>\u8c03\u7528 eglInitialize \u65b9\u6cd5\u521d\u59cb\u5316</li> </ul> </li> <li>\u786e\u5b9a\u6e32\u67d3\u8868\u9762\u7684\u914d\u7f6e\u4fe1\u606f<ul> <li>\u8c03\u7528 eglChooseConfig \u65b9\u6cd5\u5f97\u5230 EGLConfig</li> </ul> </li> <li>\u521b\u5efa\u6e32\u67d3\u4e0a\u4e0b\u6587<ul> <li>\u901a\u8fc7 EGLDisplay \u548c EGLConfig \uff0c\u8c03\u7528 eglCreateContext \u65b9\u6cd5\u521b\u5efa\u6e32\u67d3\u4e0a\u4e0b\u6587\uff0c\u5f97\u5230 EGLContext</li> </ul> </li> <li>\u521b\u5efa\u6e32\u67d3\u8868\u9762<ul> <li>\u901a\u8fc7 EGLDisplay \u548c EGLConfig \uff0c\u8c03\u7528 eglCreateWindowSurface \u65b9\u6cd5\u521b\u5efa\u6e32\u67d3\u8868\u9762\uff0c\u5f97\u5230 EGLSurface</li> </ul> </li> <li>\u7ed1\u5b9a\u4e0a\u4e0b\u6587<ul> <li>\u901a\u8fc7 eglMakeCurrent \u65b9\u6cd5\u5c06 EGLSurface\u3001EGLContext\u3001EGLDisplay \u4e09\u8005\u7ed1\u5b9a\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u4f7f\u7528 OpenGL \u8fdb\u884c\u7ed8\u5236\u4e86\u3002</li> </ul> </li> <li>\u4ea4\u6362\u7f13\u51b2<ul> <li>\u5f53\u7528 OpenGL \u7ed8\u5236\u7ed3\u675f\u540e\uff0c\u4f7f\u7528 eglSwapBuffers \u65b9\u6cd5\u4ea4\u6362\u524d\u540e\u7f13\u51b2\uff0c\u5c06\u7ed8\u5236\u5185\u5bb9\u663e\u793a\u5230\u5c4f\u5e55\u4e0a</li> </ul> </li> <li>\u91ca\u653e EGL \u73af\u5883<ul> <li>\u7ed8\u5236\u7ed3\u675f\uff0c\u4e0d\u518d\u9700\u8981\u4f7f\u7528 EGL \u65f6\uff0c\u53d6\u6d88 eglMakeCurrent \u7684\u7ed1\u5b9a\uff0c\u9500\u6bc1  EGLDisplay\u3001EGLSurface\u3001EGLContext\u3002</li> </ul> </li> </ul> <p>\u5982\u679c\u5bf9 EGLDisplay\u3001EGLSurface \u3001EGLContext \u8fd9\u4e9b\u62bd\u8c61\u6982\u5ff5\u50bb\u50bb\u5206\u4e0d\u6e05\u695a\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u5e45\u56fe\uff1a</p> <p></p> <p>\u5176\u4e2d\uff1a</p> <ul> <li>Display(EGLDisplay) \u662f\u5bf9\u5b9e\u9645\u663e\u793a\u8bbe\u5907\u7684\u62bd\u8c61</li> <li>Surface\uff08EGLSurface\uff09\u662f\u5bf9\u7528\u6765\u5b58\u50a8\u56fe\u50cf\u7684\u5185\u5b58\u533a\u57df</li> <li>FrameBuffer \u7684\u62bd\u8c61\uff0c\u5305\u62ec Color Buffer\uff0c Stencil Buffer \uff0cDepth Buffer</li> <li>Context (EGLContext) \u5b58\u50a8 OpenGL ES\u7ed8\u56fe\u7684\u4e00\u4e9b\u72b6\u6001\u4fe1\u606f</li> </ul> <p>\u4f7f\u7528 EGL \u7684\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#_1","title":"\u521b\u5efa\u4e0e\u672c\u5730\u7a97\u53e3\u7cfb\u7edf\u7684\u8fde\u63a5","text":"<p>\u901a\u8fc7 <code>eglGetDisplay</code> \u65b9\u6cd5\u521b\u5efa\u4e0e\u672c\u5730\u7a97\u53e3\u7cfb\u7edf\u7684\u8fde\u63a5\uff0c\u8fd4\u56de\u7684\u662f <code>EGLDisplay</code> \u7c7b\u578b\u5bf9\u8c61\uff0c\u53ef\u4ee5\u628a\u5b83\u62bd\u8c61\u7406\u89e3\u6210\u8bbe\u5907\u7684\u663e\u793a\u5c4f\u5e55\u3002</p> <pre><code>    private EGLDisplay mEGLDisplay = EGL14.EGL_NO_DISPLAY;\n    // \u521b\u5efa\u4e0e\u672c\u5730\u7a97\u53e3\u7cfb\u7edf\u7684\u8fde\u63a5\n    mEGLDisplay = EGL14.eglGetDisplay(EGL14.EGL_DEFAULT_DISPLAY);\n    // \u5982\u679c\u521b\u5efa\u4e4b\u540e\u8fd8\u662f EGL_NO_DISPLAY \uff0c\u8868\u793a\u521b\u5efa\u5931\u8d25\n    if (mEGLDisplay == EGL14.EGL_NO_DISPLAY) {\n        // failed\n    }\n</code></pre> <p>\u8fd9\u4e00\u6b65\u5c31\u53ef\u4ee5\u770b\u6210\u662f\u9009\u62e9\u663e\u793a\u8bbe\u5907\uff0c\u4e00\u822c\u90fd\u662f\u9009\u62e9\u9ed8\u8ba4\u7684\u663e\u793a\u8bbe\u5907\uff0c\u4e5f\u5c31\u662f\u624b\u673a\u5c4f\u5e55\u3002</p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#egl_1","title":"\u521d\u59cb\u5316 EGL","text":"<p>\u521b\u5efa <code>EGLDisplay</code> \u5bf9\u8c61\u4e4b\u540e\uff0c\u8981\u5c06\u5b83\u8fdb\u884c\u521d\u59cb\u5316\u3002</p> <pre><code>    // EGL \u7684\u4e3b\u7248\u672c\u53f7\n    private int[] mMajorVersion = new int[1];\n    // EGL \u7684\u6b21\u7248\u672c\u53f7\n    private int[] mMinorVersion = new int[1];\n    boolean result = EGL14.eglInitialize(mEGLDisplay, mMajorVersion, 0, mMajorVersion, 0);\n    if (!result) {\n        // failed\n    }\n</code></pre> <p>\u521d\u59cb\u5316\u7684\u65f6\u5019\u53ef\u4ee5\u83b7\u5f97 EGL \u7684\u4e3b\u7248\u672c\u53f7\u4e0e\u6b21\u7248\u672c\u53f7\u3002</p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#surface","title":"\u786e\u5b9a\u53ef\u7528\u7684\u6e32\u67d3\u8868\u9762\uff08Surface\uff09\u914d\u7f6e","text":"<p>\u628a Surface \u770b\u6210\u662f\u4e00\u4e2a\u6e32\u67d3\u8868\u9762\uff0c\u6e32\u67d3\u8868\u9762\u5305\u542b\u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f <code>EGLConfig</code> \u5c5e\u6027\uff1a</p> <p>\u6bd4\u5982\uff1a</p> <ul> <li>EGL_RED_SIZE\uff1a\u989c\u8272\u7f13\u51b2\u533a\u4e2d\u7ea2\u8272\u7528\u51e0\u4f4d\u6765\u8868\u793a</li> <li>EGL_BLUE_SIZE\uff1a\u989c\u8272\u7f13\u51b2\u533a\u4e2d\u84dd\u8272\u7528\u51e0\u4f4d\u6765\u8868\u793a</li> </ul> <p>\u66f4\u591a\u7684 EGLConfig \u5c5e\u6027\u53c2\u8003\u8fd9\u91cc\uff1a</p> <p>https://www.jianshu.com/p/9db986365cda\u3002</p> <p>\u6709\u4e24\u79cd\u65b9\u5f0f\u7528\u6765\u786e\u5b9a\u53ef\u7528\u7684\u6e32\u67d3\u8868\u9762\u914d\u7f6e\u3002</p> <p>\u901a\u8fc7 <code>eglGetConfigs</code> \u7684\u65b9\u6cd5\u83b7\u53d6\u5e95\u5c42\u7a97\u53e3\u7cfb\u7edf\u652f\u6301\u7684\u6240\u6709 EGL \u6e32\u67d3\u8868\u9762\u914d\u7f6e\uff0c\u518d\u7528 <code>eglGetConfigAttrib</code> \u67e5\u8be2\u6bcf\u4e2a <code>EGLConfig</code> \u7684\u4fe1\u606f\u3002 <pre><code>    public static native boolean eglGetConfigs(\n        EGLDisplay dpy,\n        EGLConfig[] configs,\n        int configsOffset,\n        int config_size,\n        int[] num_config,\n        int num_configOffset\n    );\n\n    public static native boolean eglGetConfigAttrib(\n        EGLDisplay dpy,\n        EGLConfig config,\n        int attribute,\n        int[] value,\n        int offset\n    );\n</code></pre></p> <p>\u53e6\u4e00\u79cd\u662f\u521b\u5efa\u597d\u6e32\u67d3\u8868\u9762\u914d\u7f6e\u5217\u8868\uff0c\u901a\u8fc7 <code>eglChooseConfig</code> \u7684\u65b9\u6cd5\uff0c\u627e\u5230\u7b26\u5408\u8981\u6c42\u7684 EGLConfig \u914d\u7f6e\u3002</p> <pre><code>    public static native boolean eglChooseConfig(\n        EGLDisplay dpy,\n        int[] attrib_list,\n        int attrib_listOffset,\n        EGLConfig[] configs,\n        int configsOffset,\n        int config_size,\n        int[] num_config,\n        int num_configOffset\n    );\n</code></pre> <p>\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u76f8\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u6765\u8bf4\uff0c\u4e0d\u7528\u518d\u67e5\u8be2\u6bcf\u4e00\u4e2a EGLConfig \u5c5e\u6027\u4e86\u3002</p> <p>\u5177\u4f53\u4f7f\u7528\u5982\u4e0b\uff1a</p> <pre><code>    // \u5b9a\u4e49 EGLConfig \u5c5e\u6027\u914d\u7f6e\n    private static final int[] EGL_CONFIG = {\n            EGL14.EGL_RED_SIZE, CFG_RED_SIZE,\n            EGL14.EGL_GREEN_SIZE, CFG_GREEN_SIZE,\n            EGL14.EGL_BLUE_SIZE, CFG_BLUE_SIZE,\n            EGL14.EGL_ALPHA_SIZE, CFG_ALPHA_SIZE,\n            EGL14.EGL_DEPTH_SIZE, CFG_DEPTH_SIZE,\n            EGL14.EGL_STENCIL_SIZE, CFG_STENCIL_SIZE,\n            EGL14.EGL_RENDERABLE_TYPE, EGL14.EGL_OPENGL_ES2_BIT,\n            EGL14.EGL_NONE,\n    };\n</code></pre> <p>\u9996\u5148\u5b9a\u4e49 EGLConfig \u5c5e\u6027\u914d\u7f6e\u6570\u7ec4\uff0c\u5b9a\u4e49\u7ea2\u3001\u7eff\u3001\u84dd\u3001\u900f\u660e\u5ea6\u3001\u6df1\u5ea6\u3001\u6a21\u677f\u7f13\u51b2\u7684\u4f4d\u6570\uff0c\u6700\u540e\u8981\u4ee5 <code>EGL14.EGL_NONE</code> \u7ed3\u5c3e\u3002</p> <pre><code>        // \u6240\u6709\u7b26\u5408\u914d\u7f6e\u7684 EGLConfig \u4e2a\u6570\n        int[] numConfigs = new int[1];\n        // \u6240\u6709\u7b26\u5408\u914d\u7f6e\u7684 EGLConfig\n        EGLConfig[] configs = new EGLConfig[1];\n\n        // configs \u53c2\u6570\u4e3a null,\u4f1a\u5728 numConfigs \u4e2d\u8f93\u51fa\u6240\u6709\u6ee1\u8db3 EGL_CONFIG \u6761\u4ef6\u7684 config \u4e2a\u6570\n        EGL14.eglChooseConfig(mEGLDisplay, EGL_CONFIG, 0, null, 0, 0, numConfigs, 0);\n        // \u5f97\u5230\u6ee1\u8db3\u6761\u4ef6\u7684\u4e2a\u6570\n        int num = numConfigs[0];\n        if (num != 0) {\n            // \u4f1a\u83b7\u53d6\u6240\u6709\u6ee1\u8db3 EGL_CONFIG \u7684 config\n            EGL14.eglChooseConfig(mEGLDisplay, EGL_CONFIG, 0, configs, 0, configs.length, numConfigs, 0);\n            // \u53bb\u7b2c\u4e00\u4e2a\n            mEGLConfig = configs[0];\n        }\n</code></pre> <p>\u9996\u5148\u901a\u8fc7\u7ed9 eglChooseConfig \u76f8\u5e94\u53c2\u6570\u8bbe\u7f6e\u4e3a null\uff0c\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684 EGLConfig \u4e2a\u6570\uff0c\u5982\u679c\u4e0d\u4e3a\u7a7a\uff0c\u5219\u518d\u4e00\u6b21\u8c03\u7528\uff0c\u53d6\u7b2c\u4e00\u4e2a\uff0c\u5c31\u662f\u60f3\u8981\u7684 <code>EGLConfig</code> \u914d\u7f6e\u3002</p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#_2","title":"\u521b\u5efa\u6e32\u67d3\u4e0a\u4e0b\u6587","text":"<p>\u6709\u4e86 <code>EGLDisplay</code> \u548c <code>EGLConfig</code> \u5bf9\u8c61\uff0c\u5c31\u53ef\u4ee5\u521b\u5efa \u6e32\u67d3\u8868\u9762 <code>EGLSurface</code>\u548c \u6e32\u67d3\u4e0a\u4e0b\u6587 <code>EGLContext</code>\u3002</p> <p>\u5728\u521b\u5efa\u6e32\u67d3\u4e0a\u4e0b\u6587\u65f6\uff0c\u540c\u6837\u8981\u521b\u5efa\u5c5e\u6027\u4fe1\u606f\uff0c\u4e3b\u8981\u662f\u6307\u5b9a OpenGL \u4f7f\u7528\u7248\u672c\u3002</p> <pre><code>    private static final int[] EGL_ATTRIBUTE = {\n            EGL14.EGL_CONTEXT_CLIENT_VERSION, 2,\n            EGL14.EGL_NONE,\n    };\n</code></pre> <p>\u540c\u6837\uff0c\u8fd8\u662f\u4ee5 EGL14.EGL_NONE \u7ed3\u5c3e\u3002 <pre><code>    private EGLContext mEGLContext = EGL14.EGL_NO_CONTEXT;\n    // \u521b\u5efa\u4e0a\u4e0b\u6587\n    mEGLContext = EGL14.eglCreateContext(mEGLDisplay, mEGLConfig, EGL14.EGL_NO_CONTEXT, EGL_ATTRIBUTE, 0);\n    if (mEGLContext == EGL14.EGL_NO_CONTEXT) {\n        // failed\n    }\n</code></pre></p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#_3","title":"\u521b\u5efa\u6e32\u67d3\u8868\u9762","text":"<p>EGL \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\u521b\u5efa\u6e32\u67d3\u8868\u9762\uff0c\u4e00\u79cd\u662f\u53ef\u89c1\u7684\uff0c\u6e32\u67d3\u5230\u5c4f\u5e55\u4e0a\uff0c\u4e00\u79cd\u662f\u4e0d\u53ef\u89c1\u7684\uff0c\u4e5f\u5c31\u79bb\u5c4f\u7684\u3002</p> <ul> <li>eglCreatePbufferSurface\uff1a\u521b\u5efa\u79bb\u5c4f\u7684\u6e32\u67d3\u8868\u9762</li> <li>eglCreateWindowSurface\uff1a\u521b\u5efa\u6e32\u67d3\u5230\u5c4f\u5e55\u7684\u6e32\u67d3\u8868\u9762</li> </ul> <p>\u65e0\u8bba\u4f7f\u7528\u54ea\u79cd\u521b\u5efa\u65b9\u5f0f\uff0c\u4e5f\u90fd\u9700\u8981\u521b\u5efa\u914d\u7f6e\u4fe1\u606f\u3002</p> <pre><code>    // \u521b\u5efa\u6e32\u67d3\u8868\u9762\u7684\u914d\u7f6e\u4fe1\u606f\n    private static final int[] EGL_SURFACE = {\n            EGL14.EGL_NONE,\n    };\n    private EGLSurface mEGLSurface = EGL14.EGL_NO_SURFACE;\n    // surface \u53c2\u6570\u662f\u6709 SurfaceView.getHolder \u4f20\u9012\u8fc7\u6765\u7684\n    mEGLSurface = EGL14.eglCreateWindowSurface(mEGLDisplay, mEGLConfig, surface, EGL_SURFACE, 0);\n</code></pre> <p>\u5bf9\u4e8e\u6e32\u67d3\u5230\u5c4f\u5e55\u4e0a\u7684\u521b\u5efa\uff0c\u914d\u7f6e\u4fe1\u606f\u53ef\u4ee5\u4e0d\u6dfb\u52a0\u4ec0\u4e48\uff0c\u4f46\u8fd8\u662f\u8981\u4ee5 <code>EGL14.EGL_NONE</code> \u7ed3\u5c3e\u3002</p> <p>\u800c\u5bf9\u4e8e\u79bb\u5c4f\u7684\u6e32\u67d3\u8868\u9762\u521b\u5efa\uff0c\u5c31\u8fd8\u9700\u8981\u63d0\u4f9b\u5bbd\u3001\u9ad8\u7b49\u4fe1\u606f\uff0c\u4f46\u662f\u5374\u4e0d\u9700\u8981\u63d0\u4f9b <code>surface</code> \u7684\u53c2\u6570\u4e86\u3002</p> <pre><code>        // \u4f7f\u7528 eglCreatePbufferSurface \u5c31\u9700\u8981\u6307\u5b9a\u5bbd\u548c\u9ad8\n        int[] EGL_SURFACE = {\n                EGL10.EGL_WIDTH, w,\n                EGL10.EGL_HEIGHT, h,\n                EGL10.EGL_NONE,\n        };\n        mEGLSurface = mEGL.eglCreatePbufferSurface(mEGLDisplay, mEGLConfig, EGL_SURFACE,0);\n</code></pre>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#_4","title":"\u7ed1\u5b9a\u4e0a\u4e0b\u6587","text":"<p>\u5f53\u6709\u4e86 <code>EGLDisplay</code>\u3001<code>EGLSurface</code>\u3001<code>EGLContext</code> \u5bf9\u8c61\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u4e3a <code>EGLContext</code> \u7ed1\u5b9a\u4e0a\u4e0b\u6587\u4e86\u3002</p> <pre><code> EGL14.eglMakeCurrent(mEGLDisplay, mEGLSurface, mEGLSurface, mEGLContext);\n</code></pre> <p>\u5f53\u7ed1\u5b9a\u4e0a\u4e0b\u6587\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u6267\u884c\u5177\u4f53\u7684\u7ed8\u5236\u64cd\u4f5c\u4e86\uff0c\u8c03\u7528 OpenGL \u76f8\u5173\u7684\u65b9\u6cd5\u7ed8\u5236\u56fe\u5f62\u3002</p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#_5","title":"\u4ea4\u6362\u7f13\u51b2\uff0c\u8fdb\u884c\u663e\u793a","text":"<p>\u5f53\u7ed8\u5236\u7ed3\u675f\u4e4b\u540e\uff0c\u5c31\u8be5\u628a\u7ed8\u5236\u7ed3\u679c\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u4e86\u3002</p> <pre><code>        EGL14.eglSwapBuffers(mEGLDisplay, mEGLSurface);\n</code></pre> <p>\u901a\u8fc7 <code>eglSwapBuffers</code> \u65b9\u6cd5\uff0c\u5c06\u540e\u53f0\u7ed8\u5236\u7684\u7f13\u51b2\u663e\u793a\u5230\u524d\u53f0\u3002</p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#_6","title":"\u91ca\u653e\u64cd\u4f5c","text":"<p>\u5f53\u7ed8\u5236\u7ed3\u675f\u65f6\uff0c\u8981\u8fdb\u884c\u76f8\u5e94\u7684\u91ca\u653e\u64cd\u4f5c\u3002</p> <pre><code>        EGL14.eglMakeCurrent(mEGLDisplay, EGL14.EGL_NO_SURFACE, EGL14.EGL_NO_SURFACE, EGL14.EGL_NO_CONTEXT);\n        EGL14.eglDestroyContext(mEGLDisplay, mEGLContext);\n        EGL14.eglDestroySurface(mEGLDisplay, mEGLSurface);\n        EGL14.eglReleaseThread();\n        EGL14.eglTerminate(mEGLDisplay);\n\n        mEGLContext = EGL14.EGL_NO_CONTEXT;\n        mEGLDisplay = EGL14.EGL_NO_DISPLAY;\n        mEGLConfig = null;\n</code></pre> <p>\u76f8\u5f53\u4e8e\u5c31\u662f\u628a\u524d\u9762\u64cd\u4f5c\u7684 EGL \u76f8\u5173\u5bf9\u8c61\u90fd\u91ca\u653e\u6389\u3002</p> <p>\u5f53\u5b8c\u6210\u8fd9\u6837\u7684\u4e00\u4e2a\u6d41\u7a0b\u4e4b\u540e\uff0c\u5c31\u57fa\u672c\u4e0a\u638c\u63e1\u4e86 EGL \u7684\u5927\u90e8\u5206\u4f7f\u7528\u3002</p> <p>EGL \u64cd\u4f5c\u7684\u5f88\u591a\u6d41\u7a0b\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u53ef\u4ee5\u628a\u5b83\u4eec\u518d\u5355\u72ec\u505a\u4e00\u5c42\u5c01\u88c5\uff0c\u8fd9\u91cc\u53ef\u4ee5\u53c2\u8003 grafika \u7684\u5c01\u88c5\u3002</p> <p>\u6587\u7ae0\u4e2d\u5177\u4f53\u4ee3\u7801\u90e8\u5206\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6b22\u8fce Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-egl-usage/#_7","title":"\u53c2\u8003","text":"<ol> <li>Android \u7cfb\u7edf\u56fe\u5f62\u6808\uff08\u4e00\uff09\uff1a OpenGL ES \u548c EGL \u4ecb\u7ecd</li> <li>Understaing Android EGL</li> <li>OpenGL ES EGL\u4ecb\u7ecd</li> <li>\u5f15\u5165EGL</li> </ol>","tags":["OpenGL","EGL"]},{"location":"opengl/opengl-framebuffer-object-usage/","title":"OpenGL \u4e4b \u5e27\u7f13\u51b2  \u4f7f\u7528\u5b9e\u8df5","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/l5eYzkYAzR-m21-iYBoyCw</p> <p>\u5e27\u7f13\u51b2(Framebuffer Object)\uff0c\u7b80\u79f0 <code>FBO</code>\uff0c\u5728\u6e32\u67d3\u7ed8\u5236\u4e2d\uff0c \u56fe\u50cf\u6700\u7ec8\u90fd\u662f\u7ed8\u5236\u5230 FBO \u4e0a\u7684\uff0c\u4e00\u822c\u90fd\u662f\u9ed8\u8ba4\u7684 FBO \u4e0a\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u5c4f\u5e55\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u521b\u5efa\u81ea\u5df1\u7684 FBO\uff0c\u7528\u6765\u4f5c\u4e3a\u7ed8\u5236\u7684\u8f7d\u4f53\uff0c\u5f53\u5728\u81ea\u5df1\u7684 FBO \u4e0a\u7ed8\u5236\u597d\u4e86\u4e4b\u540e\uff0c\u53ef\u4ee5\u518d\u628a\u7ed8\u5236\u5185\u5bb9\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\uff0c\u5b9e\u73b0\u4e00\u4e2a\u53cc\u7f13\u51b2\u7684\u7ed8\u5236\u3002</p> <p>FBO \u5b9e\u9645\u4e0a\u662f\u7531\u989c\u8272\u9644\u4ef6\u3001\u6df1\u5ea6\u9644\u4ef6\u3001\u6a21\u677f\u9644\u4ef6\u7ec4\u6210\u7684\uff0c\u4f5c\u4e3a\u7740\u8272\u5668\u5404\u65b9\u9762\uff08\u4e00\u822c\u5305\u62ec\u989c\u8272\u3001\u6df1\u5ea6\u3001\u6df1\u5ea6\u503c\uff09\u7ed8\u5236\u7ed3\u679c\u5b58\u50a8\u7684\u903b\u8f91\u5bf9\u8c61\u3002</p> <p>\u6e32\u67d3\u7f13\u51b2(Renderbuffer Object)\uff0c\u7b80\u79f0 <code>RBO</code>\uff0c\u7531\u5e94\u7528\u7a0b\u5e8f\u5206\u914d\u7684 2D \u56fe\u50cf\u7f13\u51b2\u533a\uff0c\u53ef\u4ee5\u7528\u4e8e\u5206\u914d\u548c\u5b58\u50a8 \u6df1\u5ea6 \u548c \u6a21\u677f \u503c\uff0c\u4e5f\u53ef\u4ee5\u7528\u4f5c FBO \u7684 \u6df1\u5ea6 \u6216\u8005 \u6a21\u677f \u9644\u4ef6\uff0c\u53e6\u5916\uff0c\u7eb9\u7406\u4e5f\u53ef\u4ee5\u4f5c\u4e3a FBO \u7684\u989c\u8272\u548c\u6df1\u5ea6\u9644\u4ef6\u3002</p> <p>\u5e27\u7f13\u51b2\u4e0e\u6e32\u67d3\u7f13\u51b2\u548c\u7eb9\u7406\u7684\u5173\u7cfb\u5982\u4e0b\uff1a</p> <p></p>","tags":["OpenGL","FBO"]},{"location":"opengl/opengl-framebuffer-object-usage/#_1","title":"\u4f7f\u7528\u6982\u8ff0","text":"<p>\u5e27\u7f13\u51b2\u7684\u4f7f\u7528\uff0c\u9996\u5148\u5c31\u521b\u5efa\u5bf9\u5e94\u7684\u5e27\u7f13\u51b2\u5bf9\u8c61\uff0c\u7136\u540e\u7ed9\u5b83\u6dfb\u52a0\u5bf9\u5e94\u7684\u9644\u4ef6\uff0c\u6bd4\u5982\u989c\u8272\u9644\u4ef6\u6216\u8005\u6df1\u5ea6\u9644\u4ef6\u7b49\u3002</p> <p>\u63a5\u7740\u5c31\u662f\u5207\u6362\u5230\u5e27\u7f13\u51b2\u6e32\u67d3\uff0c\u5728\u5e27\u7f13\u51b2\u4e2d\u8fdb\u884c\u7ed8\u5236\uff0c\u6b64\u65f6\u7ed8\u5236\u7684\u5185\u5bb9\u90fd\u662f\u8bb0\u5f55\u5728\u4e0a\u4e00\u6b65\u6dfb\u52a0\u7684\u989c\u8272\u9644\u4ef6\u6216\u8005\u6df1\u5ea6\u9644\u4ef6\u4e0a\u4e86\u3002</p> <p>\u7136\u540e\u5207\u6362\u5230\u5c4f\u5e55\u7684\u7f13\u51b2\u533a\uff0c\u8fd9\u65f6\u53ef\u4ee5\u628a\u5e27\u7f13\u51b2\u4e2d\u8bb0\u5f55\u7684\u989c\u8272\u6216\u8005\u6df1\u5ea6\u4fe1\u606f\u53d6\u51fa\u6765\uff0c\u518d\u628a\u4ed6\u4eec\u7ed8\u5236\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>\u5e27\u7f13\u51b2\u7684\u4f7f\u7528\u770b\u4f3c\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u7528\u5904\u5374\u5f88\u666e\u904d\uff0c\u4f7f\u7528\u5e27\u7f13\u51b2\u53ef\u4ee5\u5728\u4e00\u4e9b\u76f8\u673a\u5e94\u7528\u4e2d\u505a\u7f8e\u989c\u5904\u7406\u3001\u6ee4\u955c\u5904\u7406\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u4f5c\u8d34\u7eb8\u7b49\u7b49\u6548\u679c\u3002</p>","tags":["OpenGL","FBO"]},{"location":"opengl/opengl-framebuffer-object-usage/#_2","title":"\u4f7f\u7528\u6b65\u9aa4","text":"","tags":["OpenGL","FBO"]},{"location":"opengl/opengl-framebuffer-object-usage/#fbo","title":"\u521b\u5efa FBO","text":"<p>\u6309\u7167\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u9996\u5148\u662f\u521b\u5efa FBO \u3002</p> <pre><code>        int[] framebuffers = new int[1];\n        GLES20.glGenFramebuffers(1, framebuffers, 0);\n</code></pre> <p>\u548c OpenGL \u4e2d\u521b\u5efa\u7684\u5927\u591a\u5bf9\u8c61\u76f8\u540c\uff0c\u90fd\u662f\u901a\u8fc7\u4e00\u4e2a <code>int</code> \u578b\u5bf9\u8c61\u6765\u8868\u793a\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u7ed9\u8fd9\u4e2a FBO \u6dfb\u52a0\u4e00\u4e9b\u9644\u4ef6\u4e86\u3002</p>","tags":["OpenGL","FBO"]},{"location":"opengl/opengl-framebuffer-object-usage/#_3","title":"\u7ed1\u5b9a\u7eb9\u7406","text":"<pre><code>// \u628a\u7eb9\u7406\u7ed1\u5b9a\u5230\u989c\u8272\u9644\u4ef6\nGLES20.glFramebufferTexture2D(\n    GLES20.GL_FRAMEBUFFER, \n    GLES20.GL_COLOR_ATTACHMENT0, // \u4f5c\u4e3a\u989c\u8272\u9644\u4ef6\n    GLES20.GL_TEXTURE_2D, \n    fboTextureId, \n    0);\n</code></pre> <p>\u901a\u8fc7 <code>glFramebufferTexture2D</code> \u51fd\u6570\u53ef\u4ee5\u5c06\u7eb9\u7406\u7ed1\u5b9a\u5230 FBO \u4e0a\u4f5c\u4e3a\u9644\u4ef6\uff0c\u5728\u7ed1\u5b9a\u65f6\u6709\u591a\u79cd\u9644\u4ef6\u9009\u9879\u53ef\u4ee5\u9009\u62e9\u3002</p> <ul> <li>GL_COLOR_ATTACHMENT0    <ul> <li>\u989c\u8272\u9644\u4ef6</li> </ul> </li> <li>GL_DEPTH_ATTACHMENT     <ul> <li>\u6df1\u5ea6\u9644\u4ef6</li> </ul> </li> <li>GL_STENCIL_ATTACHMENT   <ul> <li>\u6a21\u677f\u9644\u4ef6</li> </ul> </li> </ul> <p>\u5f53\u7136\u4f5c\u4e3a\u7eb9\u7406\uff0c\u53ea\u6709\u989c\u8272\u548c\u6df1\u5ea6\u4e24\u79cd\u53ef\u4ee5\u9009\u62e9\u3002</p> <p>\u5982\u679c\u662f\u4f7f\u7528 OpenGL 3.x \u7248\u672c\uff0c\u5728\u7ed1\u5b9a FBO \u65f6\uff0c\u8fd8\u53ef\u4ee5\u9009\u62e9\u662f\u7ed1\u5b9a\u53ea\u8bfb\u8fd8\u662f\u53ea\u5199\u7684 FBO\u3002</p> <ul> <li>GL_READ_FRAMEBUFFER     <ul> <li>\u53ea\u8bfb\u7684 FBO</li> </ul> </li> <li>GL_DRAW_FRAMEBUFFER     <ul> <li>\u53ea\u5199\u7684 FBO </li> </ul> </li> </ul> <p>\u5982\u679c\u662f\u4f7f\u7528 <code>GL_FRAMEBUFFER</code> \u7684\u8bdd\uff0c\u90a3\u4e48\u8bfb\u5199\u7686\u53ef\u4ee5\u3002</p>","tags":["OpenGL","FBO"]},{"location":"opengl/opengl-framebuffer-object-usage/#_4","title":"\u7ed1\u5b9a\u6e32\u67d3\u7f13\u51b2","text":"<p>\u9664\u4e86\u7eb9\u7406\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u7ed1\u5b9a\u5230\u6e32\u67d3\u7f13\u51b2\u3002</p> <p>\u9996\u5148\u8fd8\u662f\u521b\u5efa\u4e00\u4e2a\u6e32\u67d3\u7f13\u51b2\u5bf9\u8c61\uff1a</p> <pre><code>        int[] renderbuffers = new int[1];\n        GLES20.glGenRenderbuffers(1, renderbuffers, 0);\n</code></pre> <p>\u4e4b\u540e\uff0c\u8981\u7ed1\u5b9a\u5230\u5f53\u524d\u7684\u6e32\u67d3\u7f13\u51b2\u5bf9\u8c61\uff0c\u5e76\u521d\u59cb\u5316\u6e32\u67d3\u7f13\u51b2\u5bf9\u8c61\u7684\u6570\u636e\u5b58\u50a8\uff0c\u518d\u628a\u5b83\u6dfb\u52a0\u5230 FBO \u4e0a\u3002</p> <pre><code>// \u7ed1\u5b9a\u5230\u5f53\u524d\u6e32\u67d3\u7f13\u51b2\u5bf9\u8c61\nGLES20.glBindRenderbuffer(GLES20.GL_RENDERBUFFER, renderbufferId);\n// \u521d\u59cb\u5316\u6e32\u67d3\u6570\u636e\u5b58\u50a8\nGLES20.glRenderbufferStorage(GLES20.GL_RENDERBUFFER, GLES20.GL_DEPTH_ATTACHMENT, width, height);\n// \u5c06\u6e32\u67d3\u7f13\u51b2\u6dfb\u52a0\u5230 FBO \u4e0a\nGLES20.glFramebufferRenderbuffer(GLES20.GL_FRAMEBUFFER, GLES20.GL_DEPTH_ATTACHMENT, GLES20.GL_RENDERBUFFER, renderbufferId);\n</code></pre> <p>\u7ed1\u5b9a\u6e32\u67d3\u7f13\u51b2\u5bf9\u8c61\uff0c\u5e76\u4e14\u521d\u59cb\u5316\u6570\u636e\u5b58\u50a8\u8fd9\u4e00\u6b65\u6709\u70b9\u7c7b\u4f3c\u4e8e\u521b\u5efa\u7eb9\u7406\u5e76\u4e14\u521d\u59cb\u5316\u7684\u64cd\u4f5c\u3002</p> <pre><code>        // \u7ed1\u5b9a\u7eb9\u7406\n        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureId);\n        // \u521d\u59cb\u5316\u7eb9\u7406\u6570\u636e\n        GLES20.glTexImage2D(GLES20.GL_TEXTURE_2D, 0, GLES20.GL_RGB, width, height,\n                0, GLES20.GL_RGB, GLES20.GL_UNSIGNED_SHORT_5_6_5, null);\n</code></pre>","tags":["OpenGL","FBO"]},{"location":"opengl/opengl-framebuffer-object-usage/#_5","title":"\u6e32\u67d3","text":"<p>\u5728\u6e32\u67d3\u65f6\uff0c\u5148\u6e32\u67d3\u5230 FBO \u4e0a\uff0c\u5728\u6e32\u67d3\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>\u9996\u5148\u8981\u5207\u6362\u5230 FBO \u8fdb\u884c\u6e32\u67d3\uff1a</p> <pre><code>GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, fboId);\n</code></pre> <p>\u5982\u679c <code>fboId</code> \u53c2\u6570\u4e3a 0 \uff0c\u5219\u4ee3\u8868\u5207\u6362\u5230\u9ed8\u8ba4\u7684\u5c4f\u5e55\u4e0a\u8fdb\u884c\u7ed8\u5236\u3002</p> <p>\u6b64\u65f6\u5c31\u53ef\u4ee5\u8fdb\u884c\u6b63\u5e38\u7684\u7ed8\u5236\uff0c\u7531\u6dfb\u52a0\u7684\u9644\u4ef6\u53bb\u8bb0\u5f55\u7ed8\u5236\u7684\u4fe1\u606f\u3002</p> <pre><code>// \u52a0\u8f7d\u7eb9\u7406\nint textureId = TextureHelper.loadTexture(context, R.drawable.lgq);\n// \u5c06\u7eb9\u7406\u7ed8\u5236\u5230 FBO \u4e0a\nmTextureRect.drawSelf(textureId);\n</code></pre> <p>\u5728 FBO \u4e0a\u7ed8\u5236\u4e00\u5f20\u7eb9\u7406\u8d34\u56fe\uff0c\u6b64\u65f6 FBO \u6240\u7ed1\u5b9a\u7684\u989c\u8272\u9644\u4ef6\uff0c\u4f1a\u8bb0\u5f55\u4e0b\u7eb9\u7406\u8d34\u56fe\u7684\u6240\u6709\u989c\u8272\u5185\u5bb9\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cFBO \u6240\u7ed1\u5b9a\u7684\u7eb9\u7406\u4f5c\u4e3a\u989c\u8272\u9644\u4ef6\uff0c\u6b64\u65f6\u5b83\u5df2\u7ecf\u88ab\u6e32\u67d3\u4e0a\u4e86\u989c\u8272\uff0c\u800c\u8fd9\u4e2a\u989c\u8272\u5c31\u662f\u6211\u4eec\u7ed8\u5236\u7684\u5185\u5bb9\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u4f7f\u7528 FBO \u7ed1\u5b9a\u7684\u7eb9\u7406\u7ee7\u7eed\u7528\u6765\u7ed8\u5236\u3002</p> <pre><code>        // \u5207\u6362\u5230\u5c4f\u5e55\u7684\u7f13\u51b2\u533a\n        GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, 0);\n        // \u4f7f\u7528 FBO \u6240\u7ed1\u5b9a\u7684\u7eb9\u7406\u8fdb\u884c\u7ed8\u5236\n        mTextureRect.drawSelf(fboTextureId);\n</code></pre> <p>\u5207\u6362\u5230\u5c4f\u5e55\u7684\u7f13\u51b2\u533a\u540e\uff0c\u76f4\u63a5\u4f7f\u7528 FBO \u7ed1\u5b9a\u7684\u7eb9\u7406\u8fdb\u884c\u7ed8\u5236\uff0c\u6b64\u65f6\u770b\u5230\u7684\u6548\u679c\u548c\u672a\u4f7f\u7528 FBO \u662f\u76f8\u540c\u7684\u3002</p> <p>\u4f46\u662f\u5185\u90e8\u7684\u7ed8\u5236\u5c31\u662f\u5b8c\u5168\u4e0d\u4e00\u6837\u4e86\u3002</p> <p>\u6587\u7ae0\u4e2d\u5177\u4f53\u4ee3\u7801\u90e8\u5206\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6b22\u8fce Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL","FBO"]},{"location":"opengl/opengl-framebuffer-object-usage/#_6","title":"\u53c2\u8003","text":"<ol> <li>https://blog.csdn.net/cauchyweierstrass/article/details/53166940</li> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u4e0b\u5377\u300b</li> </ol>","tags":["OpenGL","FBO"]},{"location":"opengl/opengl-glsl-2-mark/","title":"OpenGL ES 2.0 \u7740\u8272\u5668\u8bed\u8a00 GLSL \u5b66\u4e60 Mark","text":"<p>\u8981\u60f3\u53d1\u6325 OpenGL ES \u81ea\u5b9a\u4e49\u6e32\u67d3\u7ba1\u7ebf\u7684\u529f\u80fd\uff0c\u5c31\u5f97\u5b66\u4f1a\u5199 GLSL \u7740\u8272\u5668\u811a\u672c\u3002</p> <p>\u672c\u6587\u4e2d\u7684\u5185\u5bb9\u6765\u81ea\u4e8e \u300aAndroid 3D \u6e38\u620f\u5f00\u53d1\u6280\u672f\u5b9d\u5178 OpenGL ES 2.0\u300b\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_1","title":"\u6570\u636e\u7c7b\u578b","text":"<p>OpenGL ES \u7740\u8272\u5668\u8bed\u8a00\u548c C/C++ \u8bed\u6cd5\u76f8\u8fd1\uff0c\u4f46\u8fd8\u662f\u6709\u5f88\u5927\u4e0d\u540c\uff0c\u6bd4\u5982 GLSL \u4e0d\u652f\u6301 double\u3001byte\u3001short\u3001long\u3001union\u3001enum\u3001unsigned \u7b49\u3002</p> <p>GLSL \u7684\u6570\u636e\u7c7b\u578b\u53ef\u4ee5\u5206\u4e3a\u6807\u91cf\u3001\u5411\u91cf\u3001\u77e9\u9635\u3001\u91c7\u6837\u5668\u3001\u7ed3\u6784\u4f53\u4ee5\u53ca\u6570\u7ec4\u7b49\u51e0\u7c7b\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_2","title":"\u6807\u91cf","text":"<p>\u6807\u91cf\u4e5f\u88ab\u79f0\u4e3a \"\u65e0\u5411\u91cf\"\uff0c\u5176\u503c\u53ea\u6709\u5927\u5c0f\uff0c\u5e76\u4e0d\u5177\u6709\u65b9\u5411\u3002</p> <p>\u6807\u91cf\u4e4b\u95f4\u7684\u8fd0\u7b97\u9075\u5faa\u7b80\u5355\u7684\u4ee3\u6570\u6cd5\u5219\u3002</p> <p>GLSL \u652f\u6301\u7684\u7684\u53d8\u91cf\u7c7b\u578b\u6709\u5982\u4e0b\uff1a</p> <ul> <li>\u5e03\u5c14\u578b bool</li> <li>\u6574\u578b int</li> <li>\u6d6e\u70b9\u578b float</li> </ul>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_3","title":"\u5411\u91cf","text":"<p>\u5728 GLSL \u4e2d\uff0c\u5411\u91cf\u53ef\u4ee5\u770b\u505a\u662f\u540c\u6837\u7c7b\u578b\u7684\u6807\u91cf\u7ec4\u6210\u7684\uff0c\u5176\u57fa\u672c\u7c7b\u578b\u4e5f\u5206\u4e3a bool\u3001int \u53ca float 3 \u79cd\u3002</p> <p>\u6bcf\u4e2a\u5411\u91cf\u53ef\u4ee5\u7531 2 \u4e2a\u30013 \u4e2a\u6216\u8005 4 \u4e2a\u76f8\u540c\u7684\u6807\u91cf\u7ec4\u6210\u3002</p> \u5411\u91cf\u7c7b\u578b \u8bf4\u660e \u5411\u91cf\u7c7b\u578b \u8bf4\u660e vec2 \u5305\u542b\u4e86 2 \u4e2a\u6d6e\u70b9\u6570\u7684\u5411\u91cf ivec4 \u5305\u542b\u4e86 4 \u4e2a\u6574\u6570\u7684\u5411\u91cf vec3 \u5305\u542b\u4e86 3 \u4e2a\u6d6e\u70b9\u6570\u7684\u5411\u91cf bvec2 \u5305\u542b\u4e86 2 \u4e2a\u5e03\u5c14\u6570\u7684\u5411\u91cf vec4 \u5305\u542b\u4e86 4 \u4e2a\u6d6e\u70b9\u6570\u7684\u5411\u91cf bvec3 \u5305\u542b\u4e86 3 \u4e2a\u5e03\u5c14\u6570\u7684\u5411\u91cf ivec2 \u5305\u542b\u4e86 2 \u4e2a\u6574\u6570\u7684\u5411\u91cf bvec4 \u5305\u542b\u4e86 4 \u4e2a\u5e03\u5c14\u6570\u7684\u5411\u91cf ivec3 \u5305\u542b\u4e86 3 \u4e2a\u6574\u6570\u7684\u5411\u91cf","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_4","title":"\u77e9\u9635","text":"<p>\u77e9\u9635\u6309\u5c3a\u5bf8\u5206\u4e3a 2*2 \u77e9\u9635\u30013*3 \u77e9\u9635\u4ee5\u53ca 4*4 \u77e9\u9635\u3002</p> \u77e9\u9635\u7c7b\u578b \u8bf4\u660e mat2 2x2 \u7684\u6d6e\u70b9\u6570\u77e9\u9635 mat3 3x3 \u7684\u6d6e\u70b9\u6570\u77e9\u9635 mat4 4x4 \u7684\u6d6e\u70b9\u6570\u77e9\u9635","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_5","title":"\u91c7\u6837\u5668","text":"<p>\u91c7\u6837\u5668\u662f\u4e13\u95e8\u8fdb\u884c\u7eb9\u7406\u91c7\u6837\u7684\u76f8\u5173\u64cd\u4f5c\u3002</p> \u91c7\u6837\u5668\u7c7b\u578b \u8bf4\u660e \u91c7\u6837\u5668\u7c7b\u578b \u8bf4\u660e sampler2D \u7528\u4e8e\u8bbf\u95ee\u4e8c\u7ef4\u7eb9\u7406 sampleCube \u7528\u4e8e\u8bbf\u95ee\u7acb\u65b9\u8d34\u56fe\u7eb9\u7406 sampler3D \u7528\u4e8e\u8bbf\u95ee\u4e09\u7ef4\u7eb9\u7406","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_6","title":"\u7ed3\u6784\u4f53","text":"<p>\u4f7f\u7528 <code>struct</code> \u5173\u952e\u5b57\u58f0\u660e\u7ed3\u6784\u4f53\u3002</p> <pre><code>struct info{\n    vec3 color;\n    vec3 position;\n    vec2 textureCoor;\n}\n\ninfo CubeInfo;\n</code></pre>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_7","title":"\u6570\u7ec4","text":"<p>\u5728 GLSL \u4e2d\uff0c\u53ef\u4ee5\u58f0\u660e\u4efb\u4f55\u7c7b\u578b\u7684\u6570\u7ec4\u3002\u58f0\u660e\u6570\u7ec4\u7684\u65b9\u5f0f\u4e3b\u8981\u6709\u4e24\u79cd\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <ul> <li>\u5728\u58f0\u660e\u6570\u7ec4\u7684\u540c\u65f6\uff0c\u6307\u5b9a\u6570\u7ec4\u5927\u5c0f\u3002</li> </ul> <p><pre><code>vec3 position[20];\n</code></pre> *   \u5728\u58f0\u660e\u6570\u7ec4\u65f6\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u6307\u5b9a\u6570\u7ec4\u7684\u5927\u5c0f\uff0c\u4f46\u5fc5\u987b\u7b26\u5408\u4e0b\u5217\u4e24\u79cd\u60c5\u51b5\u4e4b\u4e00\uff1a</p> <p>\u5f15\u7528\u6570\u7ec4\u4e4b\u524d\uff0c\u8981\u518d\u6b21\u4f7f\u7528\u7b2c\u4e00\u79cd\u58f0\u660e\u65b9\u5f0f\u6765\u58f0\u660e\u8be5\u6570\u7ec4</p> <pre><code>vec3 position[];\nvec3 position[5];\n</code></pre> <p>\u4ee3\u7801\u4e2d\u8bbf\u95ee\u6570\u7ec4\u7684\u4e0b\u6807\u90fd\u662f\u7f16\u8bd1\u65f6\u5e38\u91cf\uff08\u5982\uff1a\u5b57\u9762\u5e38\u91cf\uff09\uff0c\u8fd9\u65f6\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u521b\u5efa\u9002\u5f53\u5927\u5c0f\u7684\u6570\u7ec4\uff0c\u4f7f\u5f97\u6570\u7ec4\u5c3a\u5bf8\u7ec4\u7ec7\u5b58\u50a8\u7f16\u8bd1\u5668\u770b\u5230\u7684\u6700\u5927\u7d22\u5f15\u503c\u5bf9\u5e94\u7684\u5143\u7d20\u3002</p> <pre><code>vec3 position[];\nposition[3] = vec3(3.0); // \u9700\u8981\u4e00\u4e2a\u5927\u5c0f\u4e3a 4 \u7684\u6570\u7ec4\nposition[20] = vec3(6.0); // \u9700\u8981\u4e00\u4e2a\u5927\u5c0f\u4e3a 21 \u7684\u6570\u7ec4\n</code></pre>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_8","title":"\u7a7a\u7c7b\u578b","text":"<p>\u7a7a\u7c7b\u578b\u4f7f\u7528 <code>void</code> \u8868\u793a\uff0c\u4ec5\u7528\u6765\u58f0\u660e\u4e0d\u8fd4\u56de\u4efb\u4f55\u503c\u7684\u51fd\u6570\uff0c\u6bd4\u5982\u7740\u8272\u5668\u4e2d\u7684 main \u51fd\u6570\u5c31\u662f\u4e00\u4e2a\u8fd4\u56de\u503c\u4e3a <code>void</code> \u7c7b\u578b\u7684\u51fd\u6570\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_9","title":"\u9650\u5b9a\u7b26","text":"<p>\u7740\u8272\u5668\u5bf9\u53d8\u91cf\u7531\u5f88\u591a\u53ef\u9009\u7684\u9650\u5b9a\u7b26\uff0c\u8fd9\u4e9b\u9650\u5b9a\u7b26\u4e2d\u5927\u90e8\u5206\u53ea\u80fd\u7528\u6765\u4fee\u9970\u5168\u5c40\u53d8\u91cf\uff0c\u5982\u4e0b\u8868\uff1a</p> \u9650\u5b9a\u7b26 \u8bf4\u660e attribute \u4e00\u822c\u7528\u4e8e\u6bcf\u4e2a\u9876\u70b9\u90fd\u5404\u4e0d\u76f8\u540c\u7684\u91cf\uff0c\u5982\u9876\u70b9\u4f4d\u7f6e\u3001\u989c\u8272\u7b49 uniform \u4e00\u822c\u7528\u4e8e\u5bf9\u540c\u4e00\u7ec4\u9876\u70b9\u7ec4\u6210\u7684\u5355\u4e2a 3D \u7269\u4f53\u4e2d\u6240\u6709\u9876\u70b9\u90fd\u76f8\u540c\u7684\u91cf\uff0c\u5982\u5f53\u524d\u7684\u5149\u6e90\u4f4d\u7f6e varying \u7528\u4e8e\u4ece\u9876\u70b9\u7740\u8272\u5668\u4f20\u9012\u5230\u7247\u5143\u7740\u8272\u5668\u7684\u91cf const \u7528\u4e8e\u58f0\u660e\u5e38\u91cf <pre><code>uniform mat4 uMVPMatrix;\nattribute vec3 aPosition;\nvarying vec4 aaColor;\nconst int lightsCount = 4;\n</code></pre> <p>\u9650\u5b9a\u7b26\u7684\u4f7f\u7528\u5e94\u8be5\u653e\u5728\u53d8\u91cf\u524d\u9762\uff0c\u4e14\u4f7f\u7528 attribute\u3001uniform \u4ee5\u53ca  varying \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u53d8\u91cf\u5fc5\u987b\u4e3a\u5168\u5c40\u53d8\u91cf\u3002</p> <p>\u7740\u8272\u5668\u8bed\u8a00\u4e2d\u6ca1\u6709\u9ed8\u8ba4\u9650\u5b9a\u7b26\u7684\u6982\u5ff5\uff0c\u56e0\u6b64\u5982\u679c\u6709\u9700\u8981\uff0c\u5fc5\u987b\u4e3a\u5168\u5c40\u53d8\u91cf\u660e\u786e\u6307\u5b9a\u9700\u8981\u7684\u9650\u5b9a\u7b26\u3002</p> <ul> <li>attribute \u9650\u5b9a\u7b26</li> </ul> <p>attribute \u9650\u5b9a\u7b26\u987e\u540d\u601d\u4e49\u4e3a\u5c5e\u6027\u9650\u5b9a\u7b26\uff0c\u5176\u4fee\u9970\u7684\u53d8\u91cf\u7528\u6765\u63a5\u6536\u6e32\u67d3\u7ba1\u7ebf\u4f20\u9012\u8fdb\u9876\u70b9\u7740\u8272\u5668\u7684\u5f53\u524d\u5f85\u5904\u7406\u9876\u70b9\u7684\u5404\u79cd\u5c5e\u6027\u503c\u3002\u8fd9\u4e9b\u5c5e\u6027\u503c\u6bcf\u4e2a\u9876\u70b9\u5404\u81ea\u62e5\u6709\u72ec\u7acb\u7684\u526f\u672c\uff0c\u7528\u4e8e\u63cf\u8ff0\u9876\u70b9\u7684\u5404\u9879\u7279\u5f81\uff0c\u5982\u9876\u70b9\u5750\u6807\u3001\u6cd5\u5411\u91cf\u3001\u989c\u8272\u3001\u7eb9\u7406\u5750\u6807\u7b49\u3002</p> <p>\u7528 attribute \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u53d8\u91cf\u5176\u503c\u662f\u7531\u5e94\u7528\u7a0b\u5e8f\u6279\u91cf\u4f20\u5165\u6e32\u67d3\u7ba1\u7ebf\u7684\uff0c\u7ba1\u7ebf\u8fdb\u884c\u57fa\u672c\u5904\u7406\u540e\u518d\u4f20\u9012\u7ed9\u9876\u70b9\u7740\u8272\u5668\u3002\u6570\u636e\u4e2d\u6709\u591a\u5c11\u4e2a\u9876\u70b9\uff0c\u7ba1\u7ebf\u5c31\u8c03\u7528\u591a\u5c11\u6b21\u9876\u70b9\u7740\u8272\u5668\uff0c\u6bcf\u6b21\u5c06\u4e00\u4e2a\u9876\u70b9\u7684\u5404\u79cd\u5c5e\u6027\u6570\u636e\u4f20\u9012\u7ed9\u9876\u70b9\u7740\u8272\u5668\u4e2d\u5bf9\u5e94\u7684 attribute \u53d8\u91cf\u3002\u56e0\u6b64\uff0c\u9876\u70b9\u7740\u8272\u5668\u6bcf\u6b21\u6267\u884c\u5c06\u5b8c\u6210\u5bf9\u4e00\u4e2a\u9876\u70b9\u5404\u9879\u5c5e\u6027\u6570\u636e\u7684\u5904\u7406\u3002</p> <p>attribute \u9650\u5b9a\u7b26\u53ea\u80fd\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u4e2d\uff0c\u4e0d\u80fd\u518d\u7247\u5143\u7740\u8272\u5668\u4e2d\u4f7f\u7528\u3002\u800c\u4e14\uff0cattribute \u9650\u5b9a\u7b26\u53ea\u80fd\u7528\u6765\u4fee\u9970\u6d6e\u70b9\u6570\u6807\u91cf\u3001\u6d6e\u70b9\u6570\u5411\u91cf\u4ee5\u53ca\u77e9\u9635\u53d8\u91cf\uff0c\u4e0d\u80fd\u7528\u6765\u4fee\u9970\u5176\u4ed6\u7c7b\u578b\u7684\u53d8\u91cf\u3002</p> <ul> <li>uniform \u9650\u5b9a\u7b26</li> </ul> <p>uniform \u4e3a\u4e00\u81f4\u53d8\u91cf\u9650\u5b9a\u7b26\uff0c\u4e00\u81f4\u53d8\u91cf\u6307\u7684\u662f\u5bf9\u4e8e\u540c\u4e00\u7ec4\u9876\u70b9\u7ec4\u6210\u7684\u5355\u4e2a 3D \u7269\u4f53\u4e2d\u6240\u6709\u9876\u70b9\u90fd\u76f8\u540c\u7684\u91cf\u3002</p> <p>uniform \u53d8\u91cf\u53ef\u4ee5\u7528\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u6216\u7247\u5143\u7740\u8272\u5668\u4e2d\uff0c\u5176\u652f\u6301\u7528\u6765\u4fee\u9970\u6240\u6709\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u4e0e attribute \u53d8\u91cf\u7c7b\u4f3c\uff0c\u4e00\u81f4\u53d8\u91cf\u7684\u503c\u4e5f\u662f\u4ece\u5e94\u7528\u7a0b\u5e8f\u4f20\u5165\u7684\u3002</p> <ul> <li>varying \u9650\u5b9a\u7b26</li> </ul> <p>\u8981\u60f3\u5c06\u9876\u70b9\u7740\u8272\u5668\u4e2d\u7684\u4fe1\u606f\u4f20\u5165\u5230\u7247\u5143\u7740\u8272\u5668\uff0c\u5219\u5fc5\u987b\u4f7f\u7528 varying \u9650\u5b9a\u7b26\u3002\u7528 varying \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u5168\u5c40\u53d8\u91cf\u53c8\u79f0\u4e3a\u6613\u53d8\u53d8\u91cf\uff0c\u6613\u53d8\u53d8\u91cf\u53ef\u4ee5\u770b\u6210\u662f\u9876\u70b9\u7740\u8272\u5668\u4ee5\u53ca\u7247\u5143\u7740\u8272\u5668\u4e4b\u95f4\u7684\u52a8\u6001\u63a5\u53e3\uff0c\u65b9\u4fbf\u9876\u70b9\u7740\u8272\u5668\u4e0e\u7247\u5143\u7740\u8272\u5668\u4e4b\u95f4\u4fe1\u606f\u7684\u4f20\u9012\u3002</p> <p>\u7269\u4f53\u5728\u6e32\u67d3\u7ba1\u7ebf\u4e2d\u4f1a\u8fdb\u884c\u5149\u6805\u5316\uff0c\u5149\u6805\u5316\u4e4b\u540e\u4f1a\u4ea7\u751f\u8bb8\u591a\u4e2a\u7247\u5143\uff0c\u6709\u591a\u5c11\u4e2a\u7247\u5143\uff0c\u5c31\u4f1a\u63d2\u503c\u8ba1\u7b97\u51fa\u591a\u5c11\u6613\u53d8\u53d8\u91cf\uff0c\u540c\u65f6\uff0c\u6e32\u67d3\u7ba1\u7ebf\u5c31\u4f1a\u8c03\u7528\u591a\u5c11\u6b21\u7247\u5143\u7740\u8272\u5668\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u6e32\u67d3\u4e00\u4e2a 3D \u7269\u4f53\uff0c\u7247\u5143\u7740\u8272\u5668\u6267\u884c\u7684\u6b21\u6570\u4f1a\u5927\u5927\u8d85\u8fc7\u9876\u70b9\u7740\u8272\u5668\uff0c\u56e0\u6b64\uff0cGPU \u786c\u4ef6\u914d\u7f6e\u4e2d\u7247\u5143\u7740\u8272\u5668\u7684\u786c\u4ef6\u6570\u91cf\u5f80\u5f80\u591a\u4f59\u9876\u70b9\u7740\u8272\u5668\u786c\u4ef6\u6570\u91cf\u3002</p> <ul> <li>const \u9650\u5b9a\u7b26</li> </ul> <p>\u7528 const \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u53d8\u91cf\u5176\u503c\u662f\u4e0d\u53ef\u4ee5\u53d8\u7684\uff0c\u4e5f\u5c31\u662f\u5e38\u91cf\uff0c\u53c8\u79f0\u4e3a\u7f16\u8bd1\u65f6\u5e38\u91cf\u3002</p> <p>\u7f16\u8bd1\u65f6\u5e38\u91cf\u5728\u58f0\u660e\u7684\u65f6\u5019\u5fc5\u987b\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u540c\u65f6\u8fd9\u4e9b\u5e38\u91cf\u5728\u7740\u8272\u5668\u5916\u90e8\u662f\u5b8c\u5168\u4e0d\u53ef\u89c1\u7684\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_10","title":"\u51fd\u6570\u58f0\u660e\u4e0e\u4f7f\u7528","text":"<p>GLSL \u53ef\u4ee5\u5f00\u53d1\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\uff1a</p> <pre><code> &lt;\u8fd4\u56de\u7c7b\u578b&gt; \u51fd\u6570\u540d\u79f0 ([&lt;\u53c2\u6570\u5e8f\u5217&gt;]) {/*\u51fd\u6570\u4f53*/}\n</code></pre> <p>\u5728\u53c2\u6570\u5e8f\u5217\u4e2d\uff0c\u9664\u4e86\u53ef\u4ee5\u6307\u5b9a\u7c7b\u578b\u5916\uff0c\u8fd8\u53ef\u4ee5\u6307\u5b9a\u7528\u9014\uff0c\u5177\u4f53\u65b9\u6cd5\u4e3a\u7528<code>\u53c2\u6570\u7528\u9014\u4fee\u9970\u7b26</code>\u8fdb\u884c\u4fee\u9970\uff0c\u5e38\u7528\u7684\u53c2\u6570\u7528\u9014\u4fee\u9970\u7b26\u5982\u4e0b\uff1a</p> <ul> <li><code>in</code> \u4fee\u9970\u7b26\uff0c\u7528\u5176\u4fee\u9970\u7684\u53c2\u6570\u4e3a\u8f93\u5165\u53c2\u6570\uff0c\u4ec5\u4f9b\u51fd\u6570\u63a5\u6536\u5916\u754c\u4f20\u5165\u7684\u503c\u3002\u82e5\u67d0\u4e2a\u53c2\u6570\u6ca1\u6709\u660e\u786e\u7ed9\u51fa\u7528\u9014\u4fee\u9970\u7b26\uff0c\u5219\u7b49\u540c\u4e8e\u4f7f\u7528\u4e86 <code>in</code> \u4fee\u9970\u7b26\u3002</li> <li><code>out</code>\u4fee\u9970\u7b26\uff0c\u7528\u5176\u4fee\u9970\u7684\u53c2\u6570\u4e3a\u8f93\u51fa\u53c2\u6570\uff0c\u5728\u51fd\u6570\u4f53\u4e2d\u5bf9\u8f93\u51fa\u53c2\u6570\u8d4b\u503c\u53ef\u4ee5\u5c06\u503c\u4f20\u9012\u5230\u8c03\u7528\u5176\u7684\u5916\u754c\u53d8\u91cf\u4e2d\u3002\u5bf9\u4e8e\u8f93\u51fa\u53c2\u6570\uff0c\u8981\u6ce8\u610f\u7684\u662f\u5728\u8c03\u7528\u65f6\u4e0d\u53ef\u4ee5\u4f7f\u7528\u5b57\u9762\u5e38\u91cf\u3002</li> <li><code>inout</code> \u4fee\u9970\u7b26\uff0c\u7528\u5176\u4fee\u9970\u7684\u53c2\u6570\u4e3a\u8f93\u5165\u8f93\u51fa\u53c2\u6570\uff0c\u5177\u6709\u8f93\u5165\u4e0e\u8f93\u51fa\u4e24\u79cd\u53c2\u6570\u7684\u529f\u80fd\u3002</li> </ul>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_11","title":"\u9876\u70b9\u7740\u8272\u5668\u4e2d\u7684\u5185\u5efa\u53d8\u91cf","text":"<p>\u9876\u70b9\u7740\u8272\u5668\u4e2d\u7684\u5185\u5efa\u53d8\u91cf\u4e3b\u8981\u662f\u8f93\u51fa\u53d8\u91cf\uff0c\u5305\u62ec gl_Position\u3001gl_PointSize \u7b49\u3002</p> <p>\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u5e94\u8be5\u6839\u636e\u9700\u8981\u7ed9\u8fd9\u4e9b\u5185\u5efa\u53d8\u91cf\u8d4b\u503c\uff0c\u4ee5\u4fbf\u7531\u6e32\u67d3\u7ba1\u7ebf\u4e2d\u7684\u56fe\u5143\u88c5\u914d\u4e0e\u5149\u6805\u5316\u7b49\u540e\u7eed\u56fa\u5b9a\u529f\u80fd\u9636\u6bb5\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u5904\u7406\u3002</p> <ul> <li>gl_Position</li> </ul> <p>\u7269\u4f53\u7684\u9876\u70b9\u4f4d\u7f6e\u7ecf\u8fc7\u5e73\u79fb\u3001\u65cb\u8f6c\u3001\u7f29\u653e\u7b49\u6570\u5b66\u53d8\u6362\u540e\uff0c\u751f\u6210\u65b0\u7684\u9876\u70b9\u4f4d\u7f6e\u3002\u65b0\u7684\u9876\u70b9\u4f4d\u7f6e\u901a\u8fc7\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u5199\u5165 gl_Position \u4f20\u9012\u5230\u6e32\u67d3\u7ba1\u7ebf\u7684\u540e\u7eed\u9636\u6bb5\u7ee7\u7eed\u5904\u7406\u3002</p> <p>gl_Position \u7684\u7c7b\u578b\u662f vec4 \uff0c\u5199\u5165\u7684\u9876\u70b9\u4f4d\u7f6e\u6570\u636e\u4e5f\u5fc5\u987b\u4e0e\u5176\u7c7b\u578b\u4e00\u81f4\u3002</p> <ul> <li>gl_PointSize</li> </ul> <p>\u9876\u70b9\u7740\u8272\u5668\u4e2d\u53ef\u4ee5\u8ba1\u7b97\u4e00\u4e2a\u70b9\u7684\u5927\u5c0f\uff08\u5355\u4f4d\u4e3a\u50cf\u7d20\uff09\uff0c\u5e76\u5c06\u5176\u8d4b\u503c\u7ed9 gl_PointSize\uff08\u6807\u91cf float \u7c7b\u578b\uff09\u4ee5\u4f20\u9012\u7ed9\u6e32\u67d3\u7ba1\u7ebf\uff0c\u9ed8\u8ba4\u4e3a 1 \u3002</p> <p>gl_PointSize \u7684\u503c\u4e00\u822c\u53ea\u6709\u5728\u91c7\u7528\u4e86\u70b9\u7ed8\u5236\u65b9\u5f0f\u540e\u624d\u6709\u610f\u4e49\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_12","title":"\u7247\u5143\u7740\u8272\u5668\u4e2d\u7684\u5185\u5efa\u53d8\u91cf","text":"<p>\u7247\u5143\u7740\u8272\u5668\u4e2d\u7684\u5185\u5efa\u53d8\u91cf\u5206\u4e3a\u8f93\u5165\u53d8\u91cf\u4ee5\u53ca\u8f93\u51fa\u53d8\u91cf\u4e24\u79cd\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_13","title":"\u5185\u5efa\u8f93\u5165\u53d8\u91cf","text":"<p>\u5185\u5efa\u8f93\u5165\u53d8\u91cf\u4e3b\u8981\u6709 <code>gl_FragCoord</code> \u548c <code>gl_FrontFacing</code>\uff0c\u8fd9\u4e24\u4e2a\u90fd\u662f\u53ea\u8bfb\u7684\uff0c\u7531\u6e32\u67d3\u7ba1\u7ebf\u4e2d\u7247\u5143\u7740\u8272\u5668\u4e4b\u524d\u7684\u9636\u6bb5\u751f\u6210\u3002</p> <ul> <li>gl_FragCoord</li> </ul> <p>\u5185\u5efa\u53d8\u91cf gl_FragCoord \uff08vec4 \u7c7b\u578b\uff09\u4e2d\u542b\u6709\u5f53\u524d\u7247\u5143\u76f8\u5bf9\u4e8e\u7a97\u53e3\u4f4d\u7f6e\u7684\u5750\u6807\u503c x\u3001y\u3001z \u4e0e 1/w \u3002</p> <p>\u5176\u4e2d x \u4e0e y \u5206\u522b\u4e3a\u7247\u5143\u76f8\u5bf9\u4e8e\u7a97\u53e3\u7684\u4e8c\u7ef4\u5750\u6807\uff0c\u5982\u679c\u7a97\u53e3\u7684\u5927\u5c0f\u4e3a 800 * 480\uff08\u5355\u4f4d\u4e3a\u50cf\u7d20\uff09\uff0c\u90a3\u4e48 x \u7684\u53d6\u503c\u8303\u56f4\u4e3a 0 ~ 800\uff0cy \u7684\u53d6\u503c\u8303\u56f4\u4e3a 0 ~ 480\uff0cz \u90e8\u5206\u4e3a\u8be5\u7247\u5143\u7684\u6df1\u5ea6\u503c\u3002</p> <p>\u901a\u8fc7\u8be5\u5185\u5efa\u53d8\u91cf\u53ef\u4ee5\u5b9e\u73b0\u4e0e\u7a97\u53e3\u4f4d\u7f6e\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c\u4ec5\u7ed8\u5236\u7a97\u53e3\u4e2d\u6307\u5b9a\u533a\u57df\u5185\u5bb9\u7b49\u3002</p> <ul> <li>gl_FrontFacing</li> </ul> <p>gl_FrontFacing \u662f\u4e00\u4e2a\u5e03\u5c14\u7c7b\u578b\u7684\u5185\u5efa\u53d8\u91cf\uff0c\u901a\u8fc7\u8bfb\u53d6\u8be5\u5185\u5efa\u53d8\u91cf\u7684\u503c\u53ef\u4ee5\u5224\u65ad\u6b63\u5728\u5904\u7406\u7684\u7247\u5143\u662f\u5426\u5c5e\u4e8e\u5728\u5149\u6805\u5316\u9636\u6bb5\u751f\u6210\u6b64\u7247\u5143\u7684\u5bf9\u5e94\u56fe\u5143\u7684\u6b63\u9762\u3002\u5982\u679c\u5c5e\u4e8e\u6b63\u9762\uff0cgl_FrontFacing \u7684\u503c\u4e3a true\uff0c\u53cd\u4e4b\u4e3a false \u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_14","title":"\u5185\u5efa\u8f93\u51fa\u53d8\u91cf","text":"<p>\u5185\u5efa\u8f93\u51fa\u53d8\u91cf\u4e3b\u8981\u6709 <code>gl_FragColor</code> \u548c <code>gl_FragData</code>\uff0c\u5728\u7247\u5143\u7740\u8272\u5668\u4e2d\u6839\u636e\u5177\u4f53\u60c5\u51b5\u9700\u8981\u7ed9\u8fd9\u4e24\u4e2a\u5185\u5efa\u53d8\u91cf\u5199\u5165\u503c\u3002</p> <ul> <li>gl_FragColor</li> </ul> <p>gl_FragColor\uff08vec4 \u7c7b\u578b\uff09\u5185\u5efa\u53d8\u91cf\u7528\u6765\u7531\u7247\u5143\u7740\u8272\u5668\u5199\u5165\u8ba1\u7b97\u5b8c\u6210\u7684\u7247\u5143\u989c\u8272\u503c\uff0c\u6b64\u989c\u8272\u503c\u5c06\u9001\u5165\u6e32\u67d3\u7ba1\u7ebf\u7684\u540e\u7ee7\u9636\u6bb5\u8fdb\u884c\u5904\u7406\u3002</p> <ul> <li>gl_FragData</li> </ul> <p>gl_FragData \u5185\u5efa\u53d8\u91cf\u672c\u8eab\u662f\u4e00\u4e2a vec4 \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u5199\u5165\u65f6\u8981\u7ed9\u51fa\u4e0b\u6807\uff0c\u5982 gl_FragData\\([0\\)]\uff0c\u901a\u8fc7\u5176\u5199\u5165\u7684\u4fe1\u606f\u5c06\u4f9b\u6e32\u67d3\u7ba1\u7ebf\u7684\u540e\u7ee7\u8fc7\u7a0b\u4f7f\u7528\u3002</p> <p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5bf9\u4e0a\u8ff0\u4e24\u4e2a\u5185\u5efa\u8f93\u51fa\u53d8\u91cf\u9009\u7528\u5176\u4e2d\u4e00\u4e2a\u5c31\u597d\u4e86\uff0c\u4e0d\u7528\u4e24\u4e2a\u90fd\u8d4b\u503c\uff0c\u82e5\u6267\u884c\u4e86 discard \u64cd\u4f5c\uff0c\u5219\u4e24\u4e2a\u5185\u5efa\u53d8\u91cf\u90fd\u4e0d\u9700\u8981\u5199\u5165\u503c\u4e86\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_15","title":"\u5185\u7f6e\u51fd\u6570","text":"<p>OpenGL ES \u7740\u8272\u5668\u8bed\u8a00\u63d0\u4f9b\u4e86\u5f88\u591a\u5185\u7f6e\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u5927\u90fd\u5df2\u7ecf\u88ab\u91cd\u8f7d\uff0c\u4e00\u822c\u5177\u6709 4 \u79cd\u53d8\u4f53\uff0c\u5206\u522b\u7528\u6765\u63a5\u6536\u548c\u8fd4\u56de <code>genType</code>\u3001<code>genIType</code>\u3001<code>genUType</code>\u548c<code>genBType</code>\u7c7b\u578b\u7684\u503c\u3002</p> <p>\u56db\u79cd\u53d8\u4f53\u5982\u4e0b\uff1a</p> \u53d8\u4f53\u7c7b\u578b \u8bf4\u660e \u53d8\u4f53\u7c7b\u578b \u8bf4\u660e genType float,vec2,vec3,vec4 genUType uint,uvec2,uvec3,uvec4 genIType int,ivec2,ivec3,ivec4 genBType bool,bvec2,bvec4,bvec4 <p>\u4ece\u8868\u4e2d\u53ef\u4ee5\u770b\u5230\uff0cgenType\u3001genIType\u3001genUType\u3001genBType \u5206\u522b\u4ee3\u8868\u7684\u662f\u6d6e\u70b9\u578b\u7c7b\u578b\u3001\u6574\u578b\u7c7b\u578b\u3001\u65e0\u7b26\u53f7\u6574\u578b\u7c7b\u578b\u548c\u5e03\u5c14\u578b\u7c7b\u578b\u3002</p> <p>\u5185\u7f6e\u51fd\u6570\u901a\u5e38\u662f\u4ee5\u6700\u4f18\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7684\uff0c\u6709\u90e8\u5206\u51fd\u6570\u751a\u81f3\u7531\u786c\u4ef6\u76f4\u63a5\u652f\u6301\u3002</p> <p>\u5185\u7f6e\u51fd\u6570\u6309\u7167\u8bbe\u8ba1\u76ee\u7684\u5206\u4e3a 3 \u4e2a\u7c7b\u522b\uff1a</p> <ul> <li>\u63d0\u4f9b\u72ec\u7279\u786c\u4ef6\u529f\u80fd\u7684\u8bbf\u95ee\u63a5\u53e3\uff0c\u5982\u7eb9\u7406\u91c7\u6837\u7cfb\u5217\u51fd\u6570</li> <li>\u7b80\u5355\u7684\u6570\u5b66\u51fd\u6570\uff0c\u5982 abs\uff08\u6c42\u7edd\u5bf9\u503c\uff09\u3001floor\uff08\u5411\u4e0b\u53d6\u6574\uff09 \u7b49</li> <li>\u4e00\u4e9b\u590d\u6742\u7684\u51fd\u6570\uff0c\u5982\u4e09\u89d2\u51fd\u6570\u7b49</li> </ul>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_16","title":"\u89d2\u5ea6\u8f6c\u6362\u548c\u4e09\u89d2\u51fd\u6570","text":"<p>\u89d2\u5ea6\u8f6c\u6362\u4e0e\u4e09\u89d2\u51fd\u6570\u540c\u65f6\u9002\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u4e0e\u7247\u5143\u7740\u8272\u5668\uff0c\u5e76\u4e14\u6bcf\u4e2a\u89d2\u5ea6\u8f6c\u6362\u4e0e\u4e09\u89d2\u51fd\u6570\u90fd\u6709 4 \u79cd\u91cd\u8f7d\u53d8\u4f53\u3002</p> <p></p> <p>\u4e0a\u8ff0\u8868\u4e2d genType \u4ee3\u8868\u7684\u6570\u636e\u7c7b\u578b\u6709 float\u3001vec2\u3001vec3 \u4ee5\u53ca vec4 \u3002\u5176\u4e2d float \u6307\u7684\u662f\u6d6e\u70b9\u6570\u6807\u91cf\uff0cvec2\u3001vec3 \u548c vec4 \u6307\u7684\u662f\u6d6e\u70b9\u6570\u5411\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_17","title":"\u6307\u6570\u51fd\u6570","text":"<p>\u6307\u6570\u51fd\u6570\u540c\u6837\u9002\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\u3002</p> <p></p> <p>\u4e0a\u8ff0\u8868\u4e2d genType \u4ee3\u8868\u7684\u6570\u636e\u7c7b\u578b\u6709 float\u3001vec2\u3001vec3 \u4ee5\u53ca vec4 \u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_18","title":"\u5e38\u89c1\u51fd\u6570","text":"<p>\u5e38\u89c1\u51fd\u6570\u4e5f\u53ef\u540c\u65f6\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\u3002</p> <p></p> <p></p> <p></p> <p>genType \u3001 genIType \u3001genUType \u4ee3\u8868\u7684\u6570\u636e\u7c7b\u578b\u53c2\u8003\u4e0a\u9762\u63d0\u5230\u7684\u7c7b\u578b\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_19","title":"\u51e0\u4f55\u51fd\u6570","text":"<p>\u51e0\u4f55\u51fd\u6570\u9002\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\uff0c\u4e3b\u8981\u7528\u4e8e\u5bf9\u5411\u91cf\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p> </p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_20","title":"\u77e9\u9635\u51fd\u6570","text":"<p>\u77e9\u9635\u51fd\u6570\u76ee\u524d\u53ea\u6709\u4e00\u4e2a\uff0c\u53ef\u4ee5\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u7247\u6bb5\u7740\u8272\u5668\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_21","title":"\u5411\u91cf\u5173\u7cfb\u51fd\u6570","text":"<p>\u5411\u91cf\u5173\u7cfb\u51fd\u6570\u4e3b\u8981\u529f\u80fd\u4e3a\u5c06\u5411\u91cf\u7684\u5404\u5206\u91cf\u8fdb\u884c\u5173\u7cfb\u6bd4\u8f83\u8fd0\u7b97\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_22","title":"\u7eb9\u7406\u91c7\u6837\u51fd\u6570","text":"<p>\u7eb9\u7406\u91c7\u6837\u51fd\u6570\u4e3b\u8981\u7528\u4e8e\u6839\u636e\u6307\u5b9a\u7684\u7eb9\u7406\u5750\u6807\u4ece\u91c7\u6837\u5668\u5bf9\u5e94\u7684\u7eb9\u7406\u4e2d\u8fdb\u884c\u91c7\u6837\uff0c\u8fd4\u56de\u91c7\u6837\u5f97\u5230\u7684\u989c\u8272\u503c\u3002</p> <p>\u5927\u90e8\u5206\u7eb9\u7406\u91c7\u6837\u51fd\u6570\u5373\u53ef\u4ee5\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u4e5f\u53ef\u4ee5\u7528\u4e8e\u7247\u6bb5\u7740\u8272\u5668\uff0c\u4f46\u53c8\u4e2a\u522b\u7684\u4ec5\u9002\u7528\u4e8e\u7247\u5143\u7740\u8272\u5668\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_23","title":"\u5c0f\u7ed3","text":"<p>\u5173\u4e8e OpenGL ES 2.0 \u7684\u8bed\u6cd5\u5c31\u5148\u8ba4\u8bc6\u5230\u8fd9\u5427\uff0c\u4e3b\u8981\u8fd8\u662f\u5728\u65e5\u540e\u7684\u5f00\u53d1\u4e2d\u591a\u53bb\u5b9e\u8df5\uff0c\u5728\u5b9e\u8df5\u4e2d\u66f4\u597d\u5730\u53bb\u8fd0\u7528\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-2-mark/#_24","title":"\u53c2\u8003","text":"<ol> <li>\u300aAndroid 3D \u6e38\u620f\u5f00\u53d1\u6280\u672f\u5b9d\u5178 OpenGL ES 2.0\u300b</li> </ol>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/","title":"OpenGL ES 3.0 \u7740\u8272\u5668\u8bed\u8a00 GLSL \u5b66\u4e60 Mark","text":"<p>\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\uff0c \u4e3b\u8981\u4ecb\u7ecd\u4e86 OpenGL ES 2.0 \u7684 GLSL \u8bed\u6cd5\uff0c\u5728 OpenGL ES 3.0 \u4e2d\u8bed\u6cd5\u53c8\u6709\u4e86\u4e00\u4e9b\u53d8\u5316\u3002</p> <p>\u672c\u6587\u7684\u5185\u5bb9\u6765\u81ea\u4e8e\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1 \u4e0a\u5377\u300b\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_1","title":"\u6570\u636e\u7c7b\u578b","text":"","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_2","title":"\u6807\u91cf","text":"<p>\u6807\u91cf\u4e5f\u88ab\u79f0\u4e3a \"\u65e0\u5411\u91cf\"\uff0c\u5176\u503c\u53ea\u6709\u5927\u5c0f\uff0c\u5e76\u4e0d\u5177\u6709\u65b9\u5411\u3002</p> <p>OpenGL ES \u7740\u8272\u5668\u8bed\u8a00\u652f\u6301\u7684\u6807\u91cf\u7c7b\u578b\u5982\u4e0b\uff1a</p> <ul> <li>\u5e03\u5c14\u578b    bool</li> <li>\u6709\u7b26\u53f7\u6574\u578b\u548c\u65e0\u7b26\u53f7\u6574\u578b    int/uint</li> <li>\u6d6e\u70b9\u578b   float</li> </ul> <p>\u76f8\u5bf9\u4e8e OpenGL ES 2.0 \uff0c\u591a\u4e86\u65e0\u7b26\u53f7\u6574\u578b uint \u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_3","title":"\u5411\u91cf","text":"<p>\u5728 GLSL \u4e2d\uff0c\u5411\u91cf\u53ef\u4ee5\u770b\u505a\u662f\u540c\u6837\u7c7b\u578b\u7684\u6807\u91cf\u7ec4\u6210\u7684\uff0c\u5176\u57fa\u672c\u7c7b\u578b\u4e5f\u5206\u4e3a bool\u3001int \u3001uint \u53ca float 4 \u79cd\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_4","title":"\u77e9\u9635","text":"<p>OpenGL ES 3.0 \u652f\u6301\u7684\u77e9\u9635\u7c7b\u578b\u6bd4 OpenGL ES 2.0 \u591a\u4e86\u4e00\u4e9b\u3002</p> <p></p> <p>\u5728 OpenGL \u4e2d\uff0c\u77e9\u9635\u662f\u6309\u5217\u7684\u987a\u5e8f\u7ec4\u7ec7\u7684\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u77e9\u9635\u53ef\u4ee5\u770b\u4f5c\u7531\u51e0\u4e2a\u5217\u5411\u91cf\u7ec4\u6210\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_5","title":"\u91c7\u6837\u5668","text":"<p>\u91c7\u6837\u5668\u662f\u4e13\u95e8\u8fdb\u884c\u7eb9\u7406\u91c7\u6837\u7684\u76f8\u5173\u64cd\u4f5c\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u91c7\u6837\u5668\u53d8\u91cf\u4ee3\u8868\u4e00\u5e45\u6216\u4e00\u5957\u7eb9\u7406\u8d34\u56fe\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_6","title":"\u7ed3\u6784\u4f53","text":"<p>\u4f7f\u7528 <code>struct</code> \u5173\u952e\u5b57\u58f0\u660e\u7ed3\u6784\u4f53\u3002</p> <pre><code>struct info{\n    vec3 color;\n    vec3 position;\n    vec2 textureCoor;\n}\n\ninfo CubeInfo;\n</code></pre>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_7","title":"\u6570\u7ec4","text":"<p>\u5728 GLSL \u4e2d\uff0c\u53ef\u4ee5\u58f0\u660e\u4efb\u4f55\u7c7b\u578b\u7684\u6570\u7ec4\u3002\u58f0\u660e\u6570\u7ec4\u7684\u65b9\u5f0f\u4e3b\u8981\u6709\u4e24\u79cd\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <ul> <li>\u5728\u58f0\u660e\u6570\u7ec4\u7684\u540c\u65f6\uff0c\u6307\u5b9a\u6570\u7ec4\u5927\u5c0f\u3002</li> </ul> <pre><code>vec3 position[20];\n</code></pre> <ul> <li>\u5728\u58f0\u660e\u6570\u7ec4\u5e76\u521d\u59cb\u5316\u7684\u540c\u65f6\uff0c\u53ef\u4ee5\u4e0d\u6307\u5b9a\u6570\u7ec4\u7684\u5927\u5c0f\u3002</li> </ul> <pre><code>float x[] = float[2](1.0,2.0);\nfloat y[] = float[](1.0,2.0,3.0);\n</code></pre>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_8","title":"\u7a7a\u7c7b\u578b","text":"<p>\u7a7a\u7c7b\u578b\u4f7f\u7528 <code>void</code> \u8868\u793a\uff0c\u4ec5\u7528\u6765\u58f0\u660e\u4e0d\u8fd4\u56de\u4efb\u4f55\u503c\u7684\u51fd\u6570\uff0c\u6bd4\u5982\u7740\u8272\u5668\u4e2d\u7684 main \u51fd\u6570\u5c31\u662f\u4e00\u4e2a\u8fd4\u56de\u503c\u4e3a <code>void</code> \u7c7b\u578b\u7684\u51fd\u6570\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_9","title":"\u5b58\u50a8\u9650\u5b9a\u7b26","text":"<p>\u9650\u5b9a\u7b26\u7684\u4f7f\u7528\u5e94\u8be5\u653e\u5728\u53d8\u91cf\u524d\u9762\uff0c\u4e14\u4f7f\u7528 in\u3001uniform \u4ee5\u53ca out \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u53d8\u91cf\u5fc5\u987b\u4e3a\u5168\u5c40\u53d8\u91cf\u3002</p> <p>\u7740\u8272\u5668\u8bed\u8a00\u4e2d\u6ca1\u6709\u9ed8\u8ba4\u9650\u5b9a\u7b26\u7684\u6982\u5ff5\uff0c\u56e0\u6b64\u5982\u679c\u6709\u9700\u8981\uff0c\u5fc5\u987b\u4e3a\u5168\u5c40\u53d8\u91cf\u660e\u786e\u6307\u5b9a\u9700\u8981\u7684\u9650\u5b9a\u7b26\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#in-centroid-in","title":"in / centroid in \u9650\u5b9a\u7b26","text":"<p>in / centroid in \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u5168\u5c40\u53d8\u91cf\u53c8\u79f0\u4e3a\u8f93\u5165\u53d8\u91cf\u3002</p> <p>\u5bf9\u4e8e\u9876\u70b9\u7740\u8272\u5668\u7684\u8f93\u5165\u53d8\u91cf\u53ea\u80fd\u7528 in \u9650\u5b9a\u7b26\u6765\u4fee\u9970\uff0c\u4e0d\u80fd\u4f7f\u7528 centroid in \u9650\u5b9a\u7b26\u548c imterpolation \u9650\u5b9a\u7b26\u6765\u4fee\u9970\u3002</p> <p>in \u4fee\u9970\u7b26\u6709\u70b9\u7c7b\u4f3c\u4e8e OpenGL ES 2.0 \u4e2d\u7684 attribute \u9650\u5b9a\u7b26\u3002</p> <p>\u5bf9\u4e8e\u7247\u5143\u7740\u8272\u5668\u53ef\u4ee5\u4f7f\u7528 in \u6216 centroid in \u9650\u5b9a\u7b26\u6765\u4fee\u9970\u5168\u5c40\u53d8\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#out-centroid-out","title":"out / centroid out \u9650\u5b9a\u7b26","text":"<p>out / centroid out \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u5168\u5c40\u53d8\u91cf\u53c8\u79f0\u4e3a\u8f93\u51fa\u53d8\u91cf\u3002\u4f7f\u7528\u60c5\u51b5\u5206\u4e3a\u5982\u4e0b\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u9876\u70b9\u7740\u8272\u5668\u7684\u8f93\u51fa\u53d8\u91cf</li> </ul> <p>\u9876\u70b9\u7740\u8272\u5668\u4e2d\u53ef\u4ee5\u4f7f\u7528 out \u6216\u8005 centroid out \u9650\u5b9a\u7b26\u4fee\u9970\u5168\u5c40\u53d8\u91cf\uff0c\u5176\u53d8\u91cf\u7528\u4e8e\u5411\u6e32\u67d3\u7ba1\u7ebf\u540e\u7ee7\u9636\u6bb5\u4f20\u9012\u5f53\u524d\u9876\u70b9\u7684\u6570\u636e\u3002</p> <ul> <li>\u7247\u5143\u7740\u8272\u5668\u7684\u8f93\u51fa\u53d8\u91cf</li> </ul> <p>\u5728\u7247\u5143\u7740\u8272\u5668\u4e2d\u53ea\u80fd\u4f7f\u7528 out \u9650\u5b9a\u7b26\u6765\u4fee\u9970\u5168\u5c40\u53d8\u91cf\uff0c\u800c\u4e0d\u80fd\u4f7f\u7528 centroid out \u9650\u5b9a\u7b26\u3002</p> <p>\u7247\u5143\u7740\u8272\u5668\u4e2d\u7684 out \u53d8\u91cf\u4e00\u822c\u6307\u7684\u662f\u7531\u7247\u5143\u7740\u8272\u5668\u5199\u5165\u8ba1\u7b97\u5b8c\u6210\u7247\u5143\u989c\u8272\u503c\u7684\u53d8\u91cf\u3002</p> <p>\u5bf9\u4e8e\u9876\u70b9\u7740\u8272\u5668\u800c\u8a00\uff0c\u4e00\u822c\u662f\u65e2\u58f0\u660e out \u53d8\u91cf\uff0c\u53c8\u5bf9 out \u53d8\u91cf\u8fdb\u884c\u8d4b\u503c\u7528\u4ee5\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u3002\u800c\u7247\u5143\u7740\u8272\u5668\u4e2d\u58f0\u660e in \u53d8\u91cf\u7528\u4e8e\u63a5\u6536\u9876\u70b9\u7740\u8272\u5668\u4f20\u8fc7\u6765\u7684\u503c\u5373\u53ef\uff0c\u662f\u4e0d\u53ef\u4ee5\u5bf9 in \u53d8\u91cf\u8d4b\u503c\u7684\u3002\u53e6\u5916\uff0c\u5728 OpenGL ES 3.0 \u4e2d\u7247\u5143\u7740\u8272\u5668\u5185\u7684\u5185\u5efa\u8f93\u51fa\u53d8\u91cf gl_FragColor \u4e0d\u5b58\u5728\u4e86\uff0c\u9700\u8981\u81ea\u5df1\u58f0\u660e out (vec4) \u53d8\u91cf\uff0c\u7528\u58f0\u660e\u7684 out \u53d8\u91cf\u66ff\u4ee3 gl_FragColor \u5185\u5efa\u53d8\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#uniform","title":"uniform \u9650\u5b9a\u7b26","text":"<p>uniform \u4e3a\u4e00\u81f4\u53d8\u91cf\u9650\u5b9a\u7b26\uff0c\u4e00\u81f4\u53d8\u91cf\u6307\u7684\u662f\u5bf9\u4e8e\u540c\u4e00\u7ec4\u9876\u70b9\u7ec4\u6210\u7684\u5355\u4e2a 3D \u7269\u4f53\u4e2d\u6240\u6709\u9876\u70b9\u90fd\u76f8\u540c\u7684\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#const","title":"const \u9650\u5b9a\u7b26","text":"<p>\u7528 const \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u53d8\u91cf\u5176\u503c\u662f\u4e0d\u53ef\u4ee5\u53d8\u7684\uff0c\u4e5f\u5c31\u662f\u5e38\u91cf\uff0c\u53c8\u79f0\u4e3a\u7f16\u8bd1\u65f6\u5e38\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_10","title":"\u63d2\u503c\u9650\u5b9a\u7b26","text":"<p>\u63d2\u503c\u9650\u5b9a\u7b26\uff0c\u5176\u4e3b\u8981\u7528\u4e8e\u63a7\u5236\u9876\u70b9\u7740\u8272\u5668\u4f20\u9012\u5230\u7247\u5143\u7740\u8272\u5668\u6570\u636e\u7684\u63d2\u503c\u65b9\u5f0f\u3002</p> <p>\u63d2\u503c\u9650\u5b9a\u7b26\u5305\u542b\u5982\u4e0b\u4e24\u79cd\uff1a</p> <ul> <li>smooth</li> <li>flat</li> </ul> <p></p> <p>\u82e5\u4f7f\u7528\u63d2\u503c\u9650\u5b9a\u7b26\uff0c\u5219\u8be5\u9650\u5b9a\u7b26\u5e94\u8be5\u5728 in\u3001centroid in \u3001out \u6216\u8005 centroid out \u4e4b\u524d\u4f7f\u7528\uff0c\u4e14\u53ea\u80fd\u7528\u6765\u4fee\u9970\u9876\u70b9\u7740\u8272\u5668\u7684 out \u53d8\u91cf\u4e0e\u7247\u5143\u7740\u8272\u5668\u4e2d\u5bf9\u5e94\u7684 in \u53d8\u91cf\u3002\u5f53\u672a\u4f7f\u7528\u4efb\u4f55\u63d2\u503c\u9650\u5b9a\u7b26\u65f6\uff0c\u9ed8\u8ba4\u7684\u63d2\u503c\u65b9\u5f0f\u4e3a smooth \u3002</p> <ul> <li>smooth \u9650\u5b9a\u7b26</li> </ul> <p>\u5982\u679c\u9876\u70b9\u7740\u8272\u5668\u4e2d out \u53d8\u91cf\u4e4b\u524d\u542b\u6709 smooth \u9650\u5b9a\u7b26\u6216\u8005\u4e0d\u542b\u6709\u4efb\u4f55\u9650\u5b9a\u7b26\uff0c\u5219\u4f20\u9012\u5230\u540e\u7ee7\u7247\u5143\u7740\u8272\u5668\u5bf9\u5e94\u7684 in \u53d8\u91cf\u7684\u503c\uff0c\u662f\u5728\u5149\u6805\u5316\u9636\u6bb5\u7531\u7ba1\u7ebf\u6839\u636e\u7247\u5143\u6240\u5c5e\u56fe\u5143\u5404\u4e2a\u9876\u70b9\u5bf9\u5e94\u7684\u9876\u70b9\u7740\u8272\u5668\u5bf9\u6b64 out \u53d8\u91cf\u7684\u8d4b\u503c\u60c5\u51b5\uff0c\u53ca\u7247\u5143\u4e0e\u5404\u9876\u70b9\u7684\u4f4d\u7f6e\u5173\u7cfb\u63d2\u503c\u4ea7\u751f\u3002</p> <ul> <li>flat \u9650\u5b9a\u7b26</li> </ul> <p>\u5982\u679c\u9876\u70b9\u7740\u8272\u5668\u4e2d out \u53d8\u91cf\u4e4b\u524d\u542b\u6709 flat \u9650\u5b9a\u7b26\uff0c\u5219\u4f20\u9012\u5230\u540e\u7ee7\u7247\u5143\u7740\u8272\u5668\u4e2d\u5bf9\u5e94\u7684 in \u53d8\u91cf\u7684\u503c\u4e0d\u662f\u5728\u5149\u6805\u5316\u9636\u6bb5\u63d2\u503c\u4ea7\u751f\u7684\uff0c\u4e00\u822c\u662f\u7531\u56fe\u5143\u7684\u6700\u540e\u4e00\u4e2a\u9876\u70b9\u5bf9\u5e94\u7684\u9876\u70b9\u7740\u8272\u5668\u5bf9\u6b64 out \u53d8\u91cf\u6240\u8d4b\u7684\u503c\u51b3\u5b9a\u7684\u3002\u6b64\u65f6\uff0c\u56fe\u5143\u4e2d\u6bcf\u4e2a\u7247\u5143\u7684\u6b64\u9879\u503c\u5747\u76f8\u540c\u3002</p> <p>\u82e5\u9876\u70b9\u7740\u8272\u5668\u4e2d\u7684\u8f93\u51fa\u53d8\u91cf\u7684\u7c7b\u578b\u4e3a\u6574\u578b\u6807\u91cf\u6216\u8005\u6574\u578b\u5411\u91cf\uff0c\u5219\u53d8\u91cf\u5fc5\u987b\u4f7f\u7528 flat \u9650\u5b9a\u7b26\u4fee\u9970\u3002\u4e0e\u4e4b\u5bf9\u5e94\uff0c\u82e5\u7247\u5143\u7740\u8272\u5668\u4e2d\u7684\u8f93\u5165\u53d8\u91cf\u7684\u7c7b\u578b\u4e3a\u6574\u578b\u6807\u91cf\u6216\u6574\u578b\u5411\u91cf\uff0c\u53d8\u91cf\u5fc5\u987b\u7528 flat \u9650\u5b9a\u7b26\u4fee\u9970\u3002</p> <p>\u65e0\u8bba\u9876\u70b9\u7740\u8272\u5668\u4e2d\u7684 out \u5168\u5c40\u53d8\u91cf\u88ab\u54ea\u79cd\u63d2\u503c\u9650\u5b9a\u7b26\u4fee\u9970\uff0c\u540e\u7ee7\u7247\u5143\u7740\u8272\u5668\u4e2d\u5fc5\u987b\u542b\u6709\u4e0e\u4e4b\u5bf9\u5e94\u7684\u4fee\u9970\u7b26\u4fee\u9970\u7684 in \u5168\u5c40\u53d8\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_11","title":"\u4e00\u81f4\u5757","text":"<p>\u591a\u4e2a\u4e00\u81f4\u53d8\u91cf\u7684\u58f0\u660e\u53ef\u4ee5\u901a\u8fc7\u7c7b\u4f3c\u7ed3\u6784\u4f53\u5f62\u5f0f\u7684\u63a5\u53e3\u5757\u5b9e\u73b0\uff0c\u8be5\u5f62\u5f0f\u7684\u63a5\u53e3\u5757\u53c8\u79f0\u4e3a\u4e00\u81f4\u5757\uff08uniform block\uff09\u3002</p> <p>\u4e00\u81f4\u5757\u7684\u6570\u636e\u662f\u901a\u8fc7\u7f13\u51b2\u5bf9\u8c61\u9001\u5165\u6e32\u67d3\u7ba1\u7ebf\u7684\uff0c\u4ee5\u4e00\u81f4\u5757\u7684\u5f62\u5f0f\u6279\u91cf\u4f20\u9001\u6570\u636e\u6bd4\u5355\u4e2a\u4f20\u9001\u6548\u7387\u9ad8\uff0c\u5176\u57fa\u672c\u8bed\u6cd5\u4e3a\uff1a</p> <pre><code>[&lt;layout \u9650\u5b9a\u7b26&gt;] unifrom \u4e00\u81f4\u5757\u540d\u79f0 {&lt;\u6210\u5458\u53d8\u91cf\u5217\u8868&gt;} [&lt;\u5b9e\u4f8b\u540d&gt;]\n</code></pre> <p>\u58f0\u660e\u4e00\u81f4\u5757\u65f6\u53ef\u80fd\u5305\u542b 5 \u4e2a\u7ec4\u6210\u90e8\u5206\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>layout \u9650\u5b9a\u7b26</li> <li>uniform \u4fee\u9970\u7b26</li> <li>\u4e00\u81f4\u5757\u540d\u79f0</li> <li>\u6210\u5458\u53d8\u91cf\u5217\u8868</li> <li>\u5b9e\u4f8b\u540d</li> </ul> <p>\u793a\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>uniform Transform{\n    float radius;\n    mat4 modelViewMatrix;\n    uniform mat3 normalMatrix;\n} block_Transform;\n</code></pre> <p>\u521b\u5efa\u4e00\u81f4\u5757\u65f6\uff0c\u53ef\u4ee5\u58f0\u660e\u5b9e\u4f8b\u540d\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u58f0\u660e\u5b9e\u4f8b\u540d\u3002</p> <ul> <li>\u672a\u58f0\u660e\u5b9e\u4f8b\u540d</li> </ul> <p>\u5982\u679c\u5728\u521b\u5efa\u4e00\u81f4\u5757\u65f6\u672a\u58f0\u660e\u5b9e\u4f8b\u540d\uff0c\u5219\u4e00\u81f4\u5757\u7684\u6210\u5458\u53d8\u91cf\u4e0e\u5728\u5757\u5916\u4e00\u6837\uff0c\u5176\u4f5c\u7528\u57df\u662f\u5168\u5c40\u7684\uff0c\u65e2\u53ef\u4ee5\u901a\u8fc7\u4e00\u81f4\u5757\u7684\u6210\u5458\u53d8\u91cf\u540d\u79f0\u8bbf\u95ee\u5bf9\u5e94\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>&lt;\u4e00\u81f4\u5757\u540d\u79f0&gt;.&lt;\u6210\u5458\u53d8\u91cf\u540d&gt;</code> \u7684\u5f62\u5f0f\u8bbf\u95ee\u4e00\u81f4\u5757\u7684\u6210\u5458\u53d8\u91cf\u3002</p> <ul> <li>\u58f0\u660e\u5b9e\u4f8b\u540d</li> </ul> <p>\u5982\u679c\u5728\u521b\u5efa\u4e00\u81f4\u5757\u65f6\u58f0\u660e\u4e86\u5b9e\u4f8b\u540d\uff0c\u5219\u4e00\u81f4\u5757\u5185\u6210\u5458\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u4ece\u58f0\u660e\u5f00\u59cb\u5230\u4e00\u81f4\u5757\u7ed3\u675f\uff0c\u90fd\u901a\u8fc7<code>&lt;\u4e00\u81f4\u5757\u540d\u79f0&gt;.&lt;\u6210\u5458\u53d8\u91cf\u540d&gt;</code> \u8bbf\u95ee\u6210\u5458\u53d8\u91cf\uff0c\u800c\u7740\u8272\u5668\u8bed\u8a00\u4e2d\u9700\u8981\u901a\u8fc7<code>&lt;\u5b9e\u4f8b\u540d&gt;.&lt;\u6210\u5458\u53d8\u91cf\u540d&gt;</code>\u8bbf\u95ee\u4e00\u81f4\u5757\u7684\u6210\u5458\u53d8\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#layout","title":"layout \u9650\u5b9a\u7b26","text":"<p>layout \u9650\u5b9a\u7b26\u4ece OpenGL ES 3.0 \u5f00\u59cb\u51fa\u73b0\u7684\uff0c\u5176\u4e3b\u8981\u7528\u4e8e\u8bbe\u7f6e\u53d8\u91cf\u7684\u5b58\u50a8\u7d22\u5f15\uff08\u5373\u5f15\u7528\uff09\u503c\uff0c\u58f0\u660e\u6709\u51e0\u79cd\u4e0d\u540c\u7684\u5f62\u5f0f\u3002</p> <ul> <li>\u4f5c\u4e3a\u63a5\u53e3\u5757\u5b9a\u4e49\u7684\u4e00\u90e8\u5206\u6216\u8005\u63a5\u53e3\u5757\u7684\u6210\u5458</li> <li>\u53ef\u4ee5\u4ec5\u4ec5\u4fee\u9970 uniform\uff0c\u7528\u4e8e\u5efa\u7acb\u5176\u4ed6\u4e00\u81f4\u53d8\u91cf\u58f0\u660e\u7684\u53c2\u7167</li> </ul> <pre><code>&lt;layout \u9650\u5b9a\u7b26&gt; uniform\n</code></pre> <ul> <li>\u7528\u4e8e\u4fee\u9970\u88ab\u63a5\u53e3\u9650\u5b9a\u7b26\u4fee\u9970\u7684\u5355\u72ec\u53d8\u91cf</li> </ul> <pre><code>&lt;layout \u9650\u5b9a\u7b26&gt; &lt;\u63a5\u53e3\u9650\u5b9a\u7b26&gt; &lt;\u53d8\u91cf\u58f0\u660e&gt;\n</code></pre> <p>\u63a5\u53e3\u9650\u5b9a\u7b26\u6709 in\u3001out\u3001uniform \u4e09\u79cd\u9009\u62e9\u3002</p> <p>\u7740\u8272\u5668\u4e2d\u7684 layout \u9650\u5b9a\u7b26\u5fc5\u987b\u5728\u5b58\u50a8\u9650\u5b9a\u7b26\u4e4b\u524d\u4f7f\u7528\uff0c\u4e14 layout \u9650\u5b9a\u7b26\u4fee\u9970\u7684\u53d8\u91cf\u6216\u63a5\u53e3\u5757\u7684\u4f5c\u7528\u57df\u5fc5\u987b\u662f\u5168\u5c40\u7684\u3002</p> <ul> <li>layout \u8f93\u5165\u9650\u5b9a\u7b26</li> </ul> <p>\u9876\u70b9\u7740\u8272\u5668\u5141\u8bb8 layout \u8f93\u5165\u9650\u5b9a\u7b26\u4fee\u9970\u8f93\u5165\u53d8\u91cf\u7684\u58f0\u660e\u3002</p> <pre><code>layout (location = 0) in vec3 aPosition;\nlayout (location = 1) in vec4 aColor;\n</code></pre> <p>\u5728\u7247\u5143\u7740\u8272\u5668\u4e2d\u4e0d\u5141\u8bb8\u6709 layout \u8f93\u5165\u9650\u5b9a\u7b26\u3002</p> <ul> <li>layout \u8f93\u51fa\u9650\u5b9a\u7b26</li> </ul> <p>\u7247\u5143\u7740\u8272\u5668\u4e2d\uff0clayout \u9650\u5b9a\u7b26\u901a\u8fc7 location \u503c\u5c06\u8f93\u51fa\u53d8\u91cf\u548c\u6307\u5b9a\u7f16\u53f7\u7684\u7ed8\u5236\u7f13\u51b2\u7ed1\u5b9a\u8d77\u6765\u3002\u6bcf \u4e00\u4e2a\u8f93\u51fa\u53d8\u91cf\u7684\u7d22\u5f15(\u5f15\u7528)\u503c\u90fd\u4f1a\u5bf9\u5e94\u5230\u4e00\u4e2a\u76f8\u5e94\u7f16\u53f7\u7684\u7ed8\u5236\u7f13\u51b2\uff0c\u800c\u8fd9\u4e2a\u8f93\u51fa\u53d8\u91cf\u7684\u503c\u5c06\u5199 \u5165\u76f8\u5e94\u7f13\u51b2\u3002</p> <p>layout \u9650\u5b9a\u7b26\u7684 location \u503c\u662f\u6709\u8303\u56f4\u7684\uff0c\u5176\u8303\u56f4\u4e3a \\([0, MAX_DRAW_BUFFERS-1\\)]\u3002 \u4e0d\u540c\u624b\u6301\u8bbe\u5907\u7684\u8303\u56f4\u6709\u53ef\u80fd\u4e0d\u540c\uff0c\u6700\u57fa\u672c\u7684\u8303\u56f4\u662f \\([0,3\\)] \u3002</p> <pre><code>layout (location = 0) out vec4 fragColor;\nlayout (location = 1) out vec4 colors[2];\n</code></pre> <p>\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u4e0d\u5141\u8bb8\u6709 layout \u8f93\u51fa\u9650\u5b9a\u7b26\u3002</p> <p>\u9876\u70b9\u7740\u8272\u5668\u4e0d\u5141\u8bb8\u6709 layout \u8f93\u51fa\u9650\u5b9a\u7b26\u3002\u5982\u679c\u5728\u7247\u5143\u7740\u8272\u5668\u4e2d\u53ea\u6709\u4e00\u4e2a\u8f93\u51fa\u53d8 \u91cf\uff0c\u5219\u4e0d\u9700\u8981\u7528 layout \u4fee\u9970\u7b26\u8bf4\u660e\u5176\u5bf9\u5e94\u7ed8\u5236\u7f13\u51b2\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u503c\u4e3a 0\u3002\u5982 \u679c\u7247\u5143\u7740\u8272\u5668\u4e2d\u6709\u591a\u4e2a\u8f93\u51fa\u53d8\u91cf\uff0c\u5219\u4e0d\u5141\u8bb8\u91cd\u590d\u4f7f\u7528\u76f8\u540c\u7684 location \u503c\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_12","title":"\u5185\u5efa\u53d8\u91cf","text":"","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_13","title":"\u9876\u70b9\u7740\u8272\u5668\u4e2d\u7684\u5185\u5efa\u53d8\u91cf","text":"","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_14","title":"\u5185\u5efa\u8f93\u5165\u53d8\u91cf","text":"<p>\u9876\u70b9\u7740\u8272\u5668\u4e2d\u7684\u5185\u5efa\u8f93\u5165\u53d8\u91cf\u4e3b\u8981\u6709 gl_VertexID \u4ee5\u53ca gl_InstanceID\uff0c\u8fd9\u4e24\u4e2a\u53d8\u91cf\u5206\u522b\u4e3a\u9876\u70b9\u6574\u6570\u7d22\u5f15\u548c\u5b9e\u4f8b ID\uff0c\u90fd\u53ea\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u4f7f\u7528\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_15","title":"\u5185\u5efa\u8f93\u51fa\u53d8\u91cf","text":"<p>\u9876\u70b9\u7740\u8272\u5668\u4e2d\u7684\u5185\u5efa\u8f93\u51fa\u53d8\u91cf\u4e3b\u8981\u6709 gl_Position \u548c gl_PointSize \u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_16","title":"\u7247\u5143\u7740\u8272\u5668\u4e2d\u7684\u5185\u5efa\u53d8\u91cf","text":"","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_17","title":"\u5185\u5efa\u8f93\u51fa\u53d8\u91cf","text":"<p>\u5185\u5efa\u8f93\u51fa\u53d8\u91cf\u6307 gl_FragDepth\uff0c\u5176\u503c\u4e3a\u7247\u5143\u6df1\u5ea6\u503c\uff0c\u4ece OpenGL ES 3.0 \u5f00\u59cb\uff0c\u53ef\u4ee5\u5bf9\u5176\u8d4b\u503c\uff0c\u7136\u540e\u9001\u8fdb\u6df1\u5ea6\u7f13\u51b2\u533a\u5185\u53c2\u4e0e\u540e\u7eed\u8ba1\u7b97\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_18","title":"\u5185\u5efa\u8f93\u5165\u53d8\u91cf","text":"<p>\u5185\u5efa\u8f93\u5165\u53d8\u91cf\u5305\u62ec gl_FragCoord\u3001gl_FrontFacing \u548c gl_PointCoord \u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#invariant","title":"\u7528 invariant \u4fee\u9970\u7b26\u907f\u514d\u503c\u53d8\u95ee\u9898","text":"<p>\u503c\u53d8\u95ee\u9898\u662f\u6307\u5728\u540c\u6837\u7684\u7740\u8272\u5668\u7a0b\u5e8f\u591a\u6b21\u8fd0\u884c\u65f6\uff0c\u540c\u4e00\u4e2a\u8868\u8fbe\u5f0f\u5728\u540c\u6837\u8f93\u5165\u503c\u7684\u60c5\u51b5\u4e0b\u591a\u6b21\u8fd0\u884c\uff0c\u7ed3\u679c\u4e0d\u7cbe\u786e\u4e00\u81f4\u7684\u73b0\u8c61\uff0c\u5728\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u8fd9\u5e76\u4e0d\u5f71\u54cd\u6700\u7ec8\u6548\u679c\u7684\u6b63\u786e\u6027\u3002</p> <p>\u5982\u679c\u5728\u67d0\u4e9b\u7279\u5b9a\u60c5\u51b5\u4e0b\u9700\u8981\u907f\u514d\u503c\u53d8\u95ee\u9898\uff0c\u53ef\u4ee5\u7528 invariant \u4fee\u9970\u7b26\u6765\u4fee\u9970\u53d8\u91cf\u3002</p> <p>\u91c7\u7528 invariant \u4fee\u9970\u7b26\u4fee\u9970\u53d8\u91cf\u4e3b\u8981\u6709\u5982\u4e0b\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>\u5728\u58f0\u660e\u53d8\u91cf\u65f6\u52a0\u4e0a invariant \u4fee\u9970\u7b26</li> </ul> <pre><code>invariant out vec3 color;\n</code></pre> <ul> <li>\u5bf9\u5df2\u7ecf\u58f0\u660e\u7684\u53d8\u91cf\u8865\u5145\u4f7f\u7528 invariant \u4fee\u9970\u7b26\u8fdb\u884c\u4fee\u9970</li> </ul> <pre><code>out vec3 color;\ninvariant color;\n</code></pre> <p>\u82e5\u6709\u591a\u4e2a\u5df2\u7ecf\u58f0\u660e\u7684\u53d8\u91cf\u9700\u8981\u7528 invariant \u4fee\u9970\u7b26\u8865\u5145\u4fee\u9970\uff0c\u5219\u53ef\u4ee5\u5728 invariant \u4fee\u9970\u7b26\u540e\u628a\u8fd9\u4e9b\u53d8\u91cf\u540d\u7528\u9017\u53f7\u9694\u5f00\uff0c\u4e00\u6b21\u5b8c\u6210\u3002\u53e6\u5916\uff0c\u7528 invariant \u4fee\u9970\u7b26\u8865\u5145\u4fee\u9970\u53d8\u91cf\u5fc5\u987b\u5728\u53d8\u91cf\u7b2c\u4e00\u6b21\u88ab\u4f7f\u7528\u524d\u5b8c\u6210\u3002</p> <p>\u5982\u679c\u5e0c\u671b\u6240\u6709\u7684\u8f93\u51fa\u53d8\u91cf\u90fd\u662f invariant \u7684\uff0c\u7528\u5982\u4e0b\u8bed\u53e5\u5b8c\u6210\uff1a</p> <pre><code>#pragma STDGL invariant(all)\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u53ea\u80fd\u6dfb\u52a0\u5728\u9876\u70b9\u7740\u8272\u5668\u7a0b\u5e8f\u7684\u6700\u524d\u9762\uff0c\u4e0d\u80fd\u7528\u5728\u7247\u6bb5\u7740\u8272\u5668\u4e2d\u3002</p> <p>\u4e0d\u662f\u6240\u6709\u53d8\u91cf\u90fd\u53ef\u4ee5\u7528 invariant \u4fee\u9970\uff0c\u53ea\u6709\u5982\u4e0b\u51e0\u79cd\u624d\u53ef\u4ee5\uff1a</p> <ul> <li>\u9876\u70b9\u7740\u8272\u5668\u7684\u5185\u5efa\u8f93\u51fa\u53d8\u91cf\uff0c\u5982 gl_Position \u3002</li> <li>\u9876\u70b9\u7740\u8272\u5668\u4e2d\u58f0\u660e\u7684\u4ee5 out \u4fee\u9970\u7b26\u4fee\u9970\u7684\u53d8\u91cf\u3002</li> <li>\u7247\u5143\u7740\u8272\u5668\u4e2d\u5185\u5efa\u7684\u8f93\u51fa\u53d8\u91cf\u3002</li> <li>\u7247\u5143\u7740\u8272\u5668\u4e2d\u58f0\u660e\u7684\u4ee5 out \u4fee\u9970\u7b26\u4fee\u9970\u7684\u53d8\u91cf\u3002</li> </ul> <p>invariant \u4f7f\u7528\u65f6\u8981\u6ce8\u610f\u653e\u5728\u5176\u4ed6\u7684\u4fee\u9970\u7b26\u4e4b\u524d\uff0c\u540c\u65f6\uff0cinvariant \u4fee\u9970\u7b26\u53ea\u80fd\u7528\u6765\u4fee\u9970\u5168\u5c40\u53d8\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_19","title":"\u51fd\u6570","text":"<p>OpenGL ES \u7740\u8272\u5668\u8bed\u8a00\u63d0\u4f9b\u4e86\u5f88\u591a\u5185\u7f6e\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u5927\u90fd\u5df2\u7ecf\u88ab\u91cd\u8f7d\uff0c\u4e00\u822c\u5177\u6709 4 \u79cd\u53d8\u4f53\uff0c\u5206\u522b\u7528\u6765\u63a5\u6536\u548c\u8fd4\u56de <code>genType</code>\u3001<code>genIType</code>\u3001<code>genUType</code>\u548c<code>genBType</code>\u7c7b\u578b\u7684\u503c\u3002</p> <p>\u56db\u79cd\u53d8\u4f53\u5982\u4e0b\uff1a</p> \u53d8\u4f53\u7c7b\u578b \u8bf4\u660e \u53d8\u4f53\u7c7b\u578b \u8bf4\u660e genType float,vec2,vec3,vec4 genUType uint,uvec2,uvec3,uvec4 genIType int,ivec2,ivec3,ivec4 genBType bool,bvec2,bvec4,bvec4 <p>\u4ece\u8868\u4e2d\u53ef\u4ee5\u770b\u5230\uff0cgenType\u3001genIType\u3001genUType\u3001genBType \u5206\u522b\u4ee3\u8868\u7684\u662f\u6d6e\u70b9\u578b\u7c7b\u578b\u3001\u6574\u578b\u7c7b\u578b\u3001\u65e0\u7b26\u53f7\u6574\u578b\u7c7b\u578b\u548c\u5e03\u5c14\u578b\u7c7b\u578b\u3002</p> <p>\u5185\u7f6e\u51fd\u6570\u901a\u5e38\u662f\u4ee5\u6700\u4f18\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u7684\uff0c\u6709\u90e8\u5206\u51fd\u6570\u751a\u81f3\u7531\u786c\u4ef6\u76f4\u63a5\u652f\u6301\u3002</p> <p>\u5185\u7f6e\u51fd\u6570\u6309\u7167\u8bbe\u8ba1\u76ee\u7684\u5206\u4e3a 3 \u4e2a\u7c7b\u522b\uff1a</p> <ul> <li>\u63d0\u4f9b\u72ec\u7279\u786c\u4ef6\u529f\u80fd\u7684\u8bbf\u95ee\u63a5\u53e3\uff0c\u5982\u7eb9\u7406\u91c7\u6837\u7cfb\u5217\u51fd\u6570</li> <li>\u7b80\u5355\u7684\u6570\u5b66\u51fd\u6570\uff0c\u5982 abs\uff08\u6c42\u7edd\u5bf9\u503c\uff09\u3001floor\uff08\u5411\u4e0b\u53d6\u6574\uff09 \u7b49</li> <li>\u4e00\u4e9b\u590d\u6742\u7684\u51fd\u6570\uff0c\u5982\u4e09\u89d2\u51fd\u6570\u7b49</li> </ul>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_20","title":"\u89d2\u5ea6\u8f6c\u6362\u548c\u4e09\u89d2\u51fd\u6570","text":"<p>\u89d2\u5ea6\u8f6c\u6362\u4e0e\u4e09\u89d2\u51fd\u6570\u540c\u65f6\u9002\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u4e0e\u7247\u5143\u7740\u8272\u5668\uff0c\u5e76\u4e14\u6bcf\u4e2a\u89d2\u5ea6\u8f6c\u6362\u4e0e\u4e09\u89d2\u51fd\u6570\u90fd\u6709 4 \u79cd\u91cd\u8f7d\u53d8\u4f53\u3002</p> <p></p> <p></p> <p>\u4e0a\u8ff0\u8868\u4e2d genType \u4ee3\u8868\u7684\u6570\u636e\u7c7b\u578b\u6709 float\u3001vec2\u3001vec3 \u4ee5\u53ca vec4 \u3002\u5176\u4e2d float \u6307\u7684\u662f\u6d6e\u70b9\u6570\u6807\u91cf\uff0cvec2\u3001vec3 \u548c vec4 \u6307\u7684\u662f\u6d6e\u70b9\u6570\u5411\u91cf\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_21","title":"\u6307\u6570\u51fd\u6570","text":"<p>\u6307\u6570\u51fd\u6570\u540c\u6837\u9002\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\u3002</p> <p></p> <p></p> <p>\u4e0a\u8ff0\u8868\u4e2d genType \u4ee3\u8868\u7684\u6570\u636e\u7c7b\u578b\u6709 float\u3001vec2\u3001vec3 \u4ee5\u53ca vec4 \u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_22","title":"\u5e38\u89c1\u51fd\u6570","text":"<p>\u5e38\u89c1\u51fd\u6570\u4e5f\u53ef\u540c\u65f6\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\u3002</p> <p></p> <p></p> <p>genType \u3001 genIType \u3001genUType \u4ee3\u8868\u7684\u6570\u636e\u7c7b\u578b\u53c2\u8003\u4e0a\u9762\u63d0\u5230\u7684\u7c7b\u578b\u3002</p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_23","title":"\u51e0\u4f55\u51fd\u6570","text":"<p>\u51e0\u4f55\u51fd\u6570\u9002\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\uff0c\u4e3b\u8981\u7528\u4e8e\u5bf9\u5411\u91cf\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_24","title":"\u77e9\u9635\u51fd\u6570","text":"<p>\u77e9\u9635\u51fd\u6570\u9002\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\uff0c\u4e3b\u8981\u5305\u62ec\u751f\u6210\u77e9\u9635\u3001\u77e9\u9635\u7684\u8f6c\u7f6e\u3001\u6c42\u77e9\u9635\u7684\u884c\u5217\u5f0f\u4ee5\u53ca\u6c42\u9006\u77e9\u9635\u7b49\u6709\u5173\u77e9\u9635\u7684\u64cd\u4f5c\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_25","title":"\u5411\u91cf\u5173\u7cfb\u51fd\u6570","text":"<p>\u5411\u91cf\u5173\u7cfb\u51fd\u6570\u4e3b\u8981\u529f\u80fd\u4e3a\u5c06\u5411\u91cf\u7684\u5404\u5206\u91cf\u8fdb\u884c\u5173\u7cfb\u6bd4\u8f83\u8fd0\u7b97\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_26","title":"\u7eb9\u7406\u91c7\u6837\u51fd\u6570","text":"<p>\u7eb9\u7406\u91c7\u6837\u51fd\u6570\u4e3b\u8981\u7528\u4e8e\u6839\u636e\u6307\u5b9a\u7684\u7eb9\u7406\u5750\u6807\u4ece\u91c7\u6837\u5668\u5bf9\u5e94\u7684\u7eb9\u7406\u4e2d\u8fdb\u884c\u91c7\u6837\uff0c\u8fd4\u56de\u91c7\u6837\u5f97\u5230\u7684\u989c\u8272\u503c\u3002</p> <p>\u5927\u90e8\u5206\u7eb9\u7406\u91c7\u6837\u51fd\u6570\u5373\u53ef\u4ee5\u7528\u4e8e\u9876\u70b9\u7740\u8272\u5668\u4e5f\u53ef\u4ee5\u7528\u4e8e\u7247\u6bb5\u7740\u8272\u5668\uff0c\u4f46\u53c8\u4e2a\u522b\u7684\u4ec5\u9002\u7528\u4e8e\u7247\u5143\u7740\u8272\u5668\u3002</p> <p> </p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_27","title":"\u5fae\u5206\u51fd\u6570","text":"<p>\u5fae\u5206\u51fd\u6570\u4ec5\u80fd\u7528\u4e8e\u7247\u6bb5\u7740\u8272\u5668\uff0c\u662f\u4ece OpenGL ES 3.0 \u5f00\u59cb\u6b63\u5f0f\u652f\u6301\u7684\u3002</p> <p></p>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_28","title":"\u6d6e\u70b9\u6570\u7684\u6253\u5305\u4e0e\u89e3\u5305\u51fd\u6570","text":"","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-glsl-3-mark/#_29","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1 \u4e0a\u5377\u300b</li> </ol>","tags":["OpenGL","GLSL"]},{"location":"opengl/opengl-gpuimage-analysis/","title":"OpenGL \u4e4b GPUImage \u6e90\u7801\u5206\u6790","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/2EeI91pu6y6Z7pnLPToXYA</p> <p>GPUImage \u662f iOS \u4e0a\u4e00\u4e2a\u57fa\u4e8e OpenGL \u8fdb\u884c\u56fe\u50cf\u5904\u7406\u7684\u5f00\u6e90\u6846\u67b6\uff0c\u540e\u6765\u6709\u4eba\u501f\u9274\u5b83\u7684\u60f3\u6cd5\u5b9e\u73b0\u4e86\u4e00\u4e2a Android \u7248\u672c\u7684 GPUImage \uff0c\u672c\u6587\u4e5f\u4e3b\u8981\u5bf9 Android \u7248\u672c\u7684 GPUImage \u8fdb\u884c\u5206\u6790\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-gpuimage-analysis/#_1","title":"\u6982\u8981","text":"<p>\u5728 GPUImage \u4e2d\u65e2\u6709\u5bf9\u56fe\u50cf\u8fdb\u884c\u5904\u7406\u7684\uff0c\u4e5f\u6709\u5bf9\u76f8\u673a\u5185\u5bb9\u8fdb\u884c\u5904\u7406\u7684\uff0c\u8fd9\u91cc\u4e3b\u8981\u4ee5\u76f8\u673a\u5904\u7406\u4e3a\u4f8b\u8fdb\u884c\u5206\u6790\u3002</p> <p>\u5927\u81f4\u4f1a\u5206\u4e3a\u4e09\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>\u76f8\u673a\u6570\u636e\u7684\u91c7\u96c6</li> <li>OpenGL \u5bf9\u56fe\u50cf\u7684\u5904\u7406\u4e0e\u663e\u793a</li> <li>\u76f8\u673a\u7684\u62cd\u6444</li> </ul>","tags":["OpenGL"]},{"location":"opengl/opengl-gpuimage-analysis/#_2","title":"\u76f8\u673a\u6570\u636e\u91c7\u96c6","text":"<p>\u76f8\u673a\u6570\u636e\u91c7\u96c6\u5b9e\u9645\u4e0a\u5c31\u662f\u628a\u76f8\u673a\u7684\u56fe\u50cf\u6570\u636e\u8f6c\u6362\u6210 OpenGL \u4e2d\u7684\u7eb9\u7406\u3002</p> <p>\u5728\u76f8\u673a\u7684\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u4f1a\u7ed9\u76f8\u673a\u8bbe\u7f6e <code>PreviewCallback</code> \u56de\u8c03\u65b9\u6cd5\uff0c\u53ea\u8981\u76f8\u673a\u5904\u4e8e\u9884\u89c8\u9636\u6bb5\uff0c\u8fd9\u4e2a\u56de\u8c03\u5c31\u4f1a\u88ab\u91cd\u590d\u8c03\u7528\uff0c\u8fd4\u56de\u5f53\u524d\u9884\u89c8\u5e27\u7684\u5185\u5bb9\u3002</p> <pre><code>    camera.setPreviewCallback(GPUImageRenderer.this);\n    camera.startPreview();\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u76f8\u673a\u8fd4\u56de\u7684\u6570\u636e\u662f <code>NV21</code> \u683c\u5f0f\uff0c\u4e5f\u5c31\u662f <code>YCbCr_420_SP</code> \u683c\u5f0f\uff0c\u800c OpenGL \u4f7f\u7528\u7684\u7eb9\u7406\u662f RGB \u683c\u5f0f\uff0c\u6240\u4ee5\u5728\u6bcf\u4e00\u6b21\u7684\u56de\u8c03\u65b9\u6cd5\u4e2d\u9700\u8981\u5c06 <code>YUV</code> \u683c\u5f0f\u7684\u6570\u636e\u8f6c\u6362\u6210 <code>RGB</code> \u683c\u5f0f\u6570\u636e\u3002</p> <pre><code>GPUImageNativeLibrary.YUVtoRBGA(data, previewSize.width, previewSize.height,\n                             mGLRgbBuffer.array());\n</code></pre> <p>\u6709\u4e86\u56fe\u50cf\u7684 RGB \u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>glGenTextures</code> \u751f\u6210\u7eb9\u7406\uff0c\u5e76\u7528 <code>glTexImage2D</code> \u65b9\u6cd5\u5c06\u56fe\u50cf\u6570\u636e\u4f5c\u4e3a\u7eb9\u7406\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c\u7eb9\u7406\u5df2\u7ecf\u751f\u6210\u4e86\uff0c\u5f53\u518d\u6709\u56fe\u50cf\u6570\u636e\u8fc7\u6765\u65f6\uff0c\u53ea\u9700\u8981\u66f4\u65b0\u6570\u636e\u5c31\u597d\u4e86\uff0c\u65e0\u9700\u91cd\u590d\u521b\u5efa\u7eb9\u7406\u3002</p> <pre><code>    // \u6839\u636e\u56fe\u50cf\u6570\u636e\u52a0\u8f7d\u7eb9\u7406\n    public static int loadTexture(final IntBuffer data, final Size size, final int usedTexId) {\n        int textures[] = new int[1];\n        if (usedTexId == NO_TEXTURE) {\n            GLES20.glGenTextures(1, textures, 0);\n            GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textures[0]);\n            // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n            GLES20.glTexImage2D(GLES20.GL_TEXTURE_2D, 0, GLES20.GL_RGBA, size.width, size.height,\n                    0, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, data);\n        } else {\n            GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, usedTexId);\n            // \u66f4\u65b0\u7eb9\u7406\u6570\u636e\u5c31\u597d\uff0c\u65e0\u9700\u91cd\u590d\u521b\u5efa\u7eb9\u7406\n            GLES20.glTexSubImage2D(GLES20.GL_TEXTURE_2D, 0, 0, 0, size.width,\n                    size.height, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, data);\n            textures[0] = usedTexId;\n        }\n        return textures[0];\n    }\n</code></pre> <p>\u901a\u8fc7\u5728 <code>PreviewCallback</code> \u56de\u8c03\u65b9\u6cd5\u4e2d\u7684\u64cd\u4f5c\uff0c\u5c31\u5b8c\u6210\u4e86\u5c06\u56fe\u50cf\u6570\u636e\u8f6c\u6362\u4e3a OpenGL \u7684\u7eb9\u7406\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u5982\u4f55\u5c06\u7eb9\u7406\u6570\u636e\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u4e14\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>\u5728\u76f8\u673a\u6570\u636e\u91c7\u96c6\u4e2d\uff0c\u8fd8\u6709\u4e00\u4e9b\u5c0f\u7684\u7ec6\u8282\u95ee\u9898\uff0c\u6bd4\u5982\u76f8\u673a\u524d\u7f6e\u4e0e\u540e\u7f6e\u6444\u50cf\u5934\u7684\u5de6\u53f3\u955c\u50cf\u7ffb\u8f6c\u95ee\u9898\u3002</p> <p>\u5bf9\u4e8e\u524d\u7f6e\u6444\u50cf\u5934\uff0c\u518d\u628a\u4f20\u611f\u5668\u5185\u5bb9\u4f5c\u4e3a\u7eb9\u7406\u663e\u793a\u65f6\uff0c\u524d\u7f6e\u6444\u50cf\u5934\u8981\u505a\u4e00\u4e2a\u5de6\u53f3\u7684\u7ffb\u8f6c\u5904\u7406\uff0c\u56e0\u4e3a\u6211\u4eec\u770b\u5230\u7684\u662f\u4e00\u4e2a\u955c\u50cf\u5185\u5bb9\uff0c\u7b26\u5408\u6b63\u5e38\u7684\u81ea\u62cd\u6d41\u7a0b\u3002</p> <p>\u5728 GPUImage \u7684 TextureRotationUtil \u7c7b\u4e2d\u6709\u5b9a\u4e49\u4e86\u7eb9\u7406\u5750\u6807\uff0c\u8fd9\u4e9b\u7eb9\u7406\u5750\u6807\u7cfb\u7684\u539f\u70b9\u4e0d\u662f\u4f4d\u4e8e\u5de6\u4e0b\u89d2\u8fdb\u884c\u5b9a\u4e49\u7684\uff0c\u800c\u662f\u4f4d\u4e8e\u5de6\u4e0a\u89d2\u3002</p> <p>\u5982\u679c\u4ee5\u5de6\u4e0b\u89d2\u4e3a\u7eb9\u7406\u5750\u6807\u7cfb\u7684\u5750\u6807\u539f\u70b9\uff0c\u90a3\u4e48\u9664\u4e86\u8981\u5c06\u7eb9\u7406\u5750\u6807\u5411\u53f3\u987a\u65f6\u9488\u65cb\u8f6c 90\u00b0 \u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u8fdb\u884c\u4e0a\u4e0b\u7ffb\u8f6c\u624d\u884c\uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u5411\u53f3\u987a\u65f6\u9488\u65cb\u8f6c 90\u00b0 \uff0c\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1a</p> <p>Android \u76f8\u673a\u5f00\u53d1\u4e2d\u7684\u5c3a\u5bf8\u548c\u65b9\u5411\u95ee\u9898</p> <p>\u5f53\u6211\u4eec\u628a\u7eb9\u7406\u5750\u6807\u4ee5\u5de6\u4e0a\u89d2\u4e3a\u539f\u70b9\uff0c\u5e76\u76f8\u5bf9\u4e8e\u9876\u70b9\u5750\u6807\u987a\u65f6\u9488\u65cb\u8f6c 90 \u00b0 \u4e4b\u540e\uff0c\u624d\u80fd\u591f\u6b63\u5e38\u7684\u663e\u793a\u56fe\u50cf\uff1a</p> <pre><code>    // \u9876\u70b9\u5750\u6807\n    static final float CUBE[] = {\n            -1.0f, -1.0f,\n            1.0f, -1.0f,\n            -1.0f, 1.0f,\n            1.0f, 1.0f,\n    };\n    // \u4ee5\u5de6\u4e0a\u89d2\u4e3a\u539f\u70b9\uff0c\u5e76\u76f8\u5bf9\u4e8e\u9876\u70b9\u5750\u6807\u987a\u65f6\u9488\u65cb\u8f6c 90\u00b0 \u540e\u7684\u7eb9\u7406\u5750\u6807\n    public static final float TEXTURE_ROTATED_90[] = {\n            1.0f, 1.0f,\n            1.0f, 0.0f,\n            0.0f, 1.0f,\n            0.0f, 0.0f,\n    };\n</code></pre>","tags":["OpenGL"]},{"location":"opengl/opengl-gpuimage-analysis/#_3","title":"\u56fe\u50cf\u5904\u7406\u4e0e\u663e\u793a","text":"<p>\u5728\u6709\u4e86\u7eb9\u7406\u4e4b\u540e\uff0c\u9700\u8981\u660e\u786e\u7684\u662f\uff0c\u8fd9\u4e2a\u7eb9\u7406\u5c31\u662f\u76f8\u673a\u91c7\u96c6\u5230\u7684\u56fe\u50cf\u5185\u5bb9\uff0c\u6211\u4eec\u8981\u5c06\u7eb9\u7406\u7ed8\u5236\u5230\u5c4f\u5e55\u4e0a\uff0c\u5b9e\u9645\u4e0a\u662f\u7ed8\u5236\u4e00\u4e2a\u77e9\u5f62\uff0c\u7136\u540e\u7eb9\u7406\u662f\u8d34\u5728\u8fd9\u4e2a\u77e9\u5f62\u4e0a\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u91cc\u53ef\u4ee5\u56de\u987e\u4e00\u4e0b OpenGL \u662f\u5982\u4f55\u7ed8\u5236\u77e9\u5f62\u7684\uff0c\u5e76\u4e14\u5c06\u7eb9\u7406\u8d34\u5230\u77e9\u5f62\u4e0a\u3002</p> <p>OpenGL \u5b66\u4e60\u7cfb\u5217---\u7eb9\u7406</p> <p>\u5728 GPUImage \u4e2d\uff0c<code>GPUImageFilter</code> \u7c7b\u5c31\u5b8c\u6210\u4e86\u4e0a\u8ff0\u7684\u64cd\u4f5c\uff0c\u5b83\u662f OpenGL \u4e2d\u6240\u6709\u6ee4\u955c\u7684\u57fa\u7c7b\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-gpuimage-analysis/#gpuimagefilter","title":"\u89e3\u6790 GPUImageFilter \u7684\u4ee3\u7801\u5b9e\u73b0\uff1a","text":"<p>\u5728 GPUImageFilter \u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u4f1a\u786e\u5b9a\u597d\u9700\u8981\u4f7f\u7528\u7684\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\u811a\u672c\u5185\u5bb9\u3002</p> <p>\u5728 <code>init</code> \u65b9\u6cd5\u4e2d\u4f1a\u8c03\u7528 <code>onInit</code> \u65b9\u6cd5\u548c <code>onInitialized</code> \u65b9\u6cd5\u3002</p> <ul> <li><code>onInit</code> \u65b9\u6cd5\u4f1a\u521b\u5efa OpenGL \u4e2d\u7684 Program\uff0c\u5e76\u4e14\u4f1a\u7ed1\u5b9a\u5230\u7740\u8272\u5668\u811a\u672c\u4e2d\u58f0\u660e\u7684 <code>attribute</code> \u548c <code>uniform</code> \u53d8\u91cf\u5b57\u6bb5\u3002</li> <li><code>onInitialized</code> \u65b9\u6cd5\u4f1a\u7ed9\u4e00\u4e9b <code>uniform</code> \u5b57\u6bb5\u53d8\u91cf\u8d4b\u503c\uff0c\u5728 GPUImageFilter \u7c7b\u4e2d\u8fd8\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u53d8\u91cf\u8d4b\u503c\u8fdb\u884c\u4e86\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982\u5bf9 <code>float</code> \u53d8\u91cf\uff1a</li> </ul> <pre><code>    protected void setFloat(final int location, final float floatValue) {\n        runOnDraw(new Runnable() {\n            @Override\n            public void run() {\n                GLES20.glUniform1f(location, floatValue);\n            }\n        });\n    }\n</code></pre> <p>\u5728 onDraw \u65b9\u6cd5\u4e2d\u5c31\u662f\u6267\u884c\u5177\u4f53\u7684\u7ed8\u5236\u4e86\uff0c\u5728\u7ed8\u5236\u7684\u65f6\u5019\u4f1a\u6267\u884c <code>runPendingOnDrawTasks</code> \u65b9\u6cd5\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5728 <code>init</code> \u65b9\u6cd5\u53bb\u4e2d\u7ed9\u7740\u8272\u5668\u8bed\u8a00\u4e2d\u7684\u53d8\u91cf\u8d4b\u503c\uff0c\u5e76\u6ca1\u6709\u7acb\u5373\u751f\u6548\uff0c\u800c\u662f\u6dfb\u52a0\u5230\u4e86\u4e00\u4e2a\u94fe\u8868\u4e2d\uff0c\u6240\u4ee5\u9700\u8981\u628a\u94fe\u8868\u4e2d\u7684\u4efb\u52a1\u6267\u884c\u5b8c\u4e86\u624d\u63a5\u7740\u6267\u884c\u7ed8\u5236\u3002</p> <pre><code>    public void onDraw(final int textureId, final FloatBuffer cubeBuffer,\n                       final FloatBuffer textureBuffer) {\n        GLES20.glUseProgram(mGLProgId);\n        // \u6267\u884c\u8d4b\u503c\u7684\u4efb\u52a1\n        runPendingOnDrawTasks();\n        // \u9876\u70b9\u548c\u7eb9\u7406\u5750\u6807\u6570\u636e\n        GLES20.glVertexAttribPointer(mGLAttribPosition, 2, GLES20.GL_FLOAT, false, 0, cubeBuffer);\n        GLES20.glEnableVertexAttribArray(mGLAttribPosition);\n        GLES20.glVertexAttribPointer(mGLAttribTextureCoordinate, 2, GLES20.GL_FLOAT, false, 0, textureBuffer);\n        GLES20.glEnableVertexAttribArray(mGLAttribTextureCoordinate);\n        // \u5728\u7ed8\u5236\u524d\u7684\u6700\u540e\u4e00\u6ce2\u64cd\u4f5c\n        onDrawArraysPre();\n        // \u6700\u7ec8\u7ed8\u5236\n        GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, 0, 4);\n    }\n</code></pre> <p>\u5728\u7ed8\u5236\u65f6\uff0c\u8fd8\u9700\u8981\u7ed9\u9876\u70b9\u5750\u6807\u8d4b\u503c\uff0c\u7ed9\u7eb9\u7406\u5750\u6807\u8d4b\u503c\uff0cGPUImageFilter \u5e76\u6ca1\u6709\u53bb\u7ba1\u7406\u9876\u70b9\u5750\u6807\u548c\u7eb9\u7406\u5750\u6807\uff0c\u800c\u662f\u901a\u8fc7\u4f20\u9012\u53c2\u6570\u7684\u5f62\u5f0f\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u53bb\u5904\u7406\u5728\u524d\u7f6e\u6444\u50cf\u5934\u4e0e\u540e\u7f6e\u524d\u6444\u50cf\u5934\u3001\u624b\u673a\u7ad6\u7acb\u653e\u7f6e\u4e0e\u6a2a\u5c4f\u653e\u7f6e\u65f6\u7684\u5173\u7cfb\u4e86\u3002</p> <p>\u5728\u6267\u884c\u5177\u4f53\u7684 <code>glDrawArrays</code> \u65b9\u6cd5\u4e4b\u524d\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a <code>onDrawArraysPre</code> \u65b9\u6cd5\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u8fd8\u53ef\u4ee5\u6267\u884c\u7ed8\u5236\u524d\u7684\u6700\u540e\u4e00\u6ce2\u64cd\u4f5c\uff0c\u5728\u67d0\u4e9b\u6ee4\u955c\u7684\u5b9e\u73b0\u4e2d\u6709\u7528\u5230\u4e86\u3002</p> <p>\u6700\u540e\u624d\u662f <code>glDrawArrays</code> \u65b9\u6cd5\u53bb\u5b8c\u6210\u7ed8\u5236\u3002</p> <p>\u5f53\u6211\u4eec\u4e0d\u9700\u8981 GPUImageFilter \u8fdb\u884c\u7ed8\u5236\u65f6\uff0c\u9700\u8981\u5c06\u5b83\u9500\u6bc1\u6389\uff0c\u5728 destroy \u65b9\u6cd5\u53bb\u8fdb\u884c\u9500\u6bc1\uff0c\u5e76\u4e14\u63d0\u4f9b onDestory \u65b9\u6cd5\u53bb\u4e3a\u67d0\u4e9b\u6ee4\u955c\u63d0\u4f9b\u81ea\u5b9a\u4e49\u7684\u9500\u6bc1\u3002</p> <pre><code>    public final void destroy() {\n        mIsInitialized = false;\n        GLES20.glDeleteProgram(mGLProgId);\n        onDestroy();\n    }\n\n    public void onDestroy() {\n    }\n</code></pre> <p>\u5728 GPUImageFilter \u65b9\u6cd5\u4e2d\u5b9a\u4e49\u4e86\u7247\u6bb5\u7740\u8272\u5668\u811a\u672c\uff0c\u8fd9\u4e2a\u811a\u672c\u662f\u5c06\u56fe\u50cf\u5185\u5bb9\u539f\u6837\u8d34\u5230\u4e86\u77e9\u5f62\u4e0a\uff0c\u5e76\u6ca1\u6709\u505a\u7279\u6b8a\u7684\u56fe\u50cf\u5904\u7406\u64cd\u4f5c\u3002</p> <p>\u800c\u5176\u4ed6\u6ee4\u955c\u4e2d\uff0c\u66f4\u6539\u4e86\u7740\u8272\u5668\u811a\u672c\uff0c\u4e5f\u5c31\u4f1a\u5bf9\u56fe\u50cf\u8fdb\u884c\u5176\u4ed6\u7684\u5904\u7406\uff0c\u5728\u6574\u4e2a GPUImage \u9879\u76ee\u4e2d\uff0c\u6700\u7cbe\u534e\u7684\u4e5f\u5c31\u662f\u90a3\u4e9b\u7740\u8272\u5668\u811a\u672c\u5185\u5bb9\u4e86\uff0c\u5982\u4f55\u901a\u8fc7\u7740\u8272\u5668\u53bb\u505a\u56fe\u50cf\u5904\u7406\u53c8\u662f\u4e00\u95e8\u9ad8\u6df1\u7684\u5b66\u95ee\u4e86<sub>~</sub></p>","tags":["OpenGL"]},{"location":"opengl/opengl-gpuimage-analysis/#gpuimagefiltergroup","title":"\u89e3\u6790 GPUImageFilterGroup \u7684\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u5f53\u60f3\u8981\u5bf9\u56fe\u50cf\u8fdb\u884c\u591a\u6b21\u5904\u7406\u65f6\uff0c\u5c31\u5f97\u8003\u8651\u4f7f\u7528 GPUImageFilterGroup \u4e86\u3002</p> <p>GPUImageFilterGroup \u7ee7\u627f\u81ea GPUImageFilter\uff0c \u987e\u540d\u601d\u4e49\u5c31\u662f\u4e00\u7cfb\u5217 GPUImageFilter \u6ee4\u955c\u7684\u7ec4\u5408\uff0c\u53ef\u4ee5\u628a\u5b83\u7c7b\u6bd4\u4e3a ViewGroup \uff0cViewGroup \u5373\u53ef\u4ee5\u5305\u542b View \uff0c\u4e5f\u53ef\u4ee5\u5305\u542b ViewGroup \uff0c\u540c\u6837 GPUImageFilterGroup \u5373\u53ef\u4ee5\u5305\u542b GPUImageFilter\uff0c\u4e5f\u53ef\u4ee5\u5305\u542b GPUImageFilterGroup\u3002</p> <p>\u5728\u7528 GPUImageFilterGroup \u8fdb\u884c\u7ed8\u5236\u65f6\uff0c\u9700\u8981\u628a\u6240\u6709\u7684\u6ee4\u955c\u5185\u5bb9\u90fd\u8fdb\u884c\u4e00\u904d\u7ed8\u5236\uff0c\u800c\u5bf9\u4e8e GPUImageFilterGroup \u5305\u542b GPUImageFilterGroup \u7684\u60c5\u51b5\uff0c\u5c31\u9700\u8981\u628a\u5b50 GPUImageFilterGroup \u5185\u7684\u6ee4\u955c\u5185\u5bb9\u62c6\u5206\u51fa\u6765\uff0c\u6700\u7ec8\u662f\u7528 <code>mMergedFilters</code> \u53d8\u91cf\u8868\u793a\u6240\u6709\u975e GPUImageFilterGroup \u7c7b\u578b\u7684 GPUImageFilter \u3002</p> <pre><code>    // \u62ff\u5230\u6240\u6709\u975e GPUImageFilterGroup \u7684 GPUImageFilter\n    public void updateMergedFilters() {\n        List&lt;GPUImageFilter&gt; filters;\n        for (GPUImageFilter filter : mFilters) {\n            // \u5982\u679c\u6ee4\u955c\u662f GPUImageFilterGroup \u7c7b\u578b\uff0c\u5c31\u628a\u5b83\u62c6\u5206\u4e86\n            if (filter instanceof GPUImageFilterGroup) {\n                // \u9012\u5f52\u8c03\u7528 updateMergedFilters \u65b9\u6cd5\u53bb\u62c6\u5206\n                ((GPUImageFilterGroup) filter).updateMergedFilters();\n                // \u62ff\u5230\u6240\u6709\u975e GPUImageFilterGroup \u7684 GPUImageFilter\n                filters = ((GPUImageFilterGroup) filter).getMergedFilters();\n                if (filters == null || filters.isEmpty())\n                    continue;\n                // \u628a GPUImageFilter \u6dfb\u52a0\u5230 mMergedFilters \u4e2d\n                mMergedFilters.addAll(filters);\n                continue;\n            }\n            // \u5982\u679c\u662f\u975e GPUImageFilterGroup \u76f4\u63a5\u6dfb\u52a0\u4e86\n            mMergedFilters.add(filter);\n        }\n    }\n</code></pre> <p>\u5728 GPUImageFilterGroup \u6267\u884c\u5177\u4f53\u7684\u7ed8\u5236\u4e4b\u524d\uff0c\u8fd8\u521b\u5efa\u4e86\u548c\u6ee4\u955c\u6570\u91cf\u4e00\u6837\u591a\u7684 FrameBuffer \u5e27\u7f13\u51b2\u548c Texture \u7eb9\u7406\u3002</p> <pre><code>        // \u904d\u5386\u65f6\uff0c\u9009\u62e9 mMergedFilters \u7684\u957f\u5ea6\uff0c\u56e0\u4e3a mMergedFilters \u91cc\u9762\u624d\u662f\u4fdd\u5b58\u7684\u6240\u6709\u7684 \u6ee4\u955c\u7684\u957f\u5ea6\u3002\n        if (mMergedFilters != null &amp;&amp; mMergedFilters.size() &gt; 0) {\n            size = mMergedFilters.size();\n            // FrameBuffer \u5e27\u7f13\u51b2\u6570\u91cf\n            mFrameBuffers = new int[size - 1];\n            // \u7eb9\u7406\u6570\u91cf\n            mFrameBufferTextures = new int[size - 1];\n\n            for (int i = 0; i &lt; size - 1; i++) {\n                // \u751f\u6210 FrameBuffer \u5e27\u7f13\u51b2\n                GLES20.glGenFramebuffers(1, mFrameBuffers, i);\n                // \u751f\u6210\u7eb9\u7406\n                GLES20.glGenTextures(1, mFrameBufferTextures, i);\n                GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, mFrameBufferTextures[i]);\n                GLES20.glTexImage2D(GLES20.GL_TEXTURE_2D, 0, GLES20.GL_RGBA, width, height, 0,\n                        GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, null);\n                // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n                GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, mFrameBuffers[i]);\n                // \u7eb9\u7406\u7ed1\u5b9a\u5230\u5e27\u7f13\u51b2\u4e0a\n                GLES20.glFramebufferTexture2D(GLES20.GL_FRAMEBUFFER, GLES20.GL_COLOR_ATTACHMENT0,\n                        GLES20.GL_TEXTURE_2D, mFrameBufferTextures[i], 0);\n                // \u7701\u7565\u90e8\u5206\u4ee3\u7801\n            }\n        }\n</code></pre> <p>\u5982\u679c\u5bf9 FrameBuffer \u7684\u4f7f\u7528\u4e0d\u719f\u6089\u7684\u8bdd\uff0c\u8bf7\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1a</p> <p>OpenGL \u4e4b \u5e27\u7f13\u51b2 \u4f7f\u7528\u5b9e\u8df5</p> <pre><code>        if (mMergedFilters != null) {\n            int size = mMergedFilters.size();\n            // \u76f8\u673a\u539f\u59cb\u56fe\u50cf\u8f6c\u6362\u7684\u7eb9\u7406 ID\n            int previousTexture = textureId;\n            for (int i = 0; i &lt; size; i++) {\n                GPUImageFilter filter = mMergedFilters.get(i);\n                boolean isNotLast = i &lt; size - 1;\n                // \u5982\u679c\u4e0d\u662f\u6700\u540e\u4e00\u4e2a\u6ee4\u955c\uff0c\u7ed8\u5236\u5230 FrameBuffer \u4e0a\uff0c\u5982\u679c\u662f\u6700\u540e\u4e00\u4e2a\uff0c\u5c31\u7ed8\u5236\u5230\u4e86\u5c4f\u5e55\u4e0a\n                if (isNotLast) {\n                    GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, mFrameBuffers[i]);\n                    GLES20.glClearColor(0, 0, 0, 0);\n                }\n                // \u6ee4\u955c\u7ed8\u5236\u4ee3\u7801\n                if (i == 0) {\n                    // \u7b2c\u4e00\u4e2a\u6ee4\u955c\u7ed8\u5236\u4f7f\u7528\u76f8\u673a\u7684\u539f\u59cb\u56fe\u50cf\u7eb9\u7406 ID \u548c\u53c2\u6570\u4f20\u9012\u8fc7\u6765\u7684\u9876\u70b9\u4ee5\u53ca\u7eb9\u7406\u5750\u6807\n                    filter.onDraw(previousTexture, cubeBuffer, textureBuffer);\n                } else if (i == size - 1) {\n                    // \n                    filter.onDraw(previousTexture, mGLCubeBuffer, (size % 2 == 0) ? mGLTextureFlipBuffer : mGLTextureBuffer);\n                } else {\n                    // \u4e2d\u95f4\u7684\u6ee4\u955c\u7ed8\u5236\u5728\u4e4b\u524d\u7eb9\u7406\u57fa\u7840\u4e0a\u7ee7\u7eed\u7ed8\u5236\uff0c\u4f7f\u7528 mGLTextureBuffer \u7eb9\u7406\u5750\u6807\n                    filter.onDraw(previousTexture, mGLCubeBuffer, mGLTextureBuffer);\n                }\n\n                if (isNotLast) {\n                    // \u7ed1\u5b9a\u5230\u5c4f\u5e55\u4e0a\n                    GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, 0);\n                    previousTexture = mFrameBufferTextures[i];\n                }\n            }\n        }\n</code></pre> <p>\u5728\u6267\u884c\u5177\u4f53\u7684\u7ed8\u5236\u65f6\uff0c\u53ea\u8981\u4e0d\u662f\u6700\u540e\u4e00\u4e2a\u6ee4\u955c\uff0c\u90a3\u4e48\u5c31\u4f1a\u5148\u7ed1\u5b9a\u5230 FrameBuffer \u4e0a\uff0c\u7136\u540e\u5728 FrameBuffer \u4e0a\u8fdb\u884c\u7ed8\u5236\uff0c\u8fd9\u65f6\u7ed8\u5236\u662f\u7ed8\u5236\u5230\u4e86 FrameBuffer \u7ed1\u5b9a\u7684\u7eb9\u7406\u4e0a\uff0c\u7ed8\u5236\u7ed3\u675f\u540e\u518d\u63a5\u7740\u89e3\u7ed1\uff0c\u7ed1\u5b9a\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>\u5982\u679c\u662f\u6700\u540e\u4e00\u4e2a\u6ee4\u955c\uff0c\u90a3\u4e48\u5c31\u4e0d\u7528\u7ed1\u5b9a\u5230 FrameBuffer \u4e0a\u4e86\uff0c\u76f4\u63a5\u7ed8\u5236\u5230\u5c4f\u5e55\u4e0a\u5373\u53ef\u3002</p> <p>\u5728\u8fd9\u91cc\u6709\u4e2a\u7ec6\u8282\uff0c\u5c31\u662f\u5982\u4e0b\u7684\u4ee3\u7801\uff1a</p> <pre><code>    filter.onDraw(previousTexture, mGLCubeBuffer, (size % 2 == 0) ? mGLTextureFlipBuffer : mGLTextureBuffer);\n</code></pre> <p>\u5982\u679c\u662f\u6700\u540e\u4e00\u4e2a\u6ee4\u955c\uff0c\u5e76\u4e14\u6ee4\u955c\u4e2a\u6570\u4e3a\u5076\u6570\uff0c\u5219\u4f7f\u7528 mGLTextureFlipBuffer \u7684\u7eb9\u7406\u5750\u6807\uff0c\u5426\u5219\u4f7f\u7528 mGLTextureBuffer \u7684\u7eb9\u7406\u5750\u6807\u3002</p> <pre><code>// \u5bf9\u5e94\u7684\u7eb9\u7406\u5750\u6807\u4e3a TEXTURE_NO_ROTATION\n mGLTextureBuffer.put(TEXTURE_NO_ROTATION).position(0);\n\n// \u5bf9\u5e94\u7684\u7eb9\u7406\u5750\u6807\u4e3a TEXTURE_NO_ROTATION\uff0c\u5e76\u4e14 true \u7684\u53c2\u6570\u8868\u793a\u8fdb\u884c\u5782\u76f4\u4e0a\u4e0b\u7ffb\u8f6c\nfloat[] flipTexture = TextureRotationUtil.getRotation(Rotation.NORMAL, false, true);\nmGLTextureFlipBuffer.put(flipTexture).position(0);\n</code></pre> <p>\u5728\u7b2c\u4e00\u4e2a\u6ee4\u955c\u7ed8\u5236\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u53c2\u6570\u4f20\u9012\u8fc7\u6765\u7684\u9876\u70b9\u5750\u6807\u548c\u7eb9\u7406\u5750\u6807\uff0c\u4e2d\u95f4\u90e8\u5206\u7684\u6ee4\u955c\u4f7f\u7528\u7684\u662f mGLTextureBuffer \u7eb9\u7406\u5750\u6807\uff0c\u5b83\u5bf9\u5e94\u7684\u7eb9\u7406\u5750\u6807\u6570\u7ec4\u4e3a <code>TEXTURE_NO_ROTATION</code>\u3002</p> <p>\u5728\u524d\u9762\u8bb2\u5230\u8fc7\uff0cGPUImage \u7684\u7eb9\u7406\u5750\u6807\u539f\u70b9\u662f\u4f4d\u4e8e\u5de6\u4e0a\u89d2\u7684\uff0c\u6240\u4ee5\u4f7f\u7528 <code>TEXTURE_NO_ROTATION</code> \u7684\u7eb9\u7406\u5750\u6807\u5b9e\u8d28\u4e0a\u662f\u5c06\u56fe\u50cf\u8fdb\u884c\u4e86\u4e0a\u4e0b\u7ffb\u8f6c\uff0c\u4e24\u6b21\u8c03\u7528<code>TEXTURE_NO_ROTATION</code>\u7eb9\u7406\u5750\u6807\u65f6\uff0c\u53c8\u5c06\u56fe\u50cf\u590d\u539f\u4e86\uff0c\u8fd9\u4e5f\u5c31\u53ef\u4ee5\u89e3\u91ca\u4e3a\u4ec0\u4e48\u6ee4\u955c\u4e2a\u6570\u4e3a\u5076\u6570\u65f6\uff0c\u9700\u8981\u4f7f\u7528 <code>mGLTextureFlipBuffer</code> \u7eb9\u7406\u5750\u6807\u5c06\u56fe\u50cf\u518d\u8fdb\u884c\u4e00\u6b21\u7ffb\u8f6c\uff0c\u800c <code>mGLTextureBuffer</code> \u7eb9\u7406\u5750\u6807\u4e0d\u9700\u8981\u4e86\u3002</p> <p>\u5f53\u660e\u767d\u4e86 GPUImageFilter \u548c GPUImageFilterGroup \u7684\u5b9e\u73b0\u4e4b\u540e\uff0c\u518d\u53bb\u770b\u5177\u4f53\u7684 Renderer \u7684\u4ee3\u7801\u5c31\u660e\u4e86\u591a\u4e86\u3002</p> <p>\u5728 <code>onSurfaceCreated</code> \u548c <code>onSurfaceChanged</code> \u65b9\u6cd5\u4e2d\u5206\u522b\u5bf9\u6ee4\u955c\u8fdb\u884c\u521d\u59cb\u5316\u4ee5\u53ca\u8bbe\u5b9a\u5bbd\u3001\u9ad8\uff0c\u5728 onDrawFrame \u65b9\u6cd5\u4e2d\u8c03\u7528\u5177\u4f53\u7684\u7ed8\u5236\u3002</p> <p>\u5f53\u5207\u6362\u6ee4\u955c\u65f6\uff0c\u5148\u5c06\u4e0a\u4e00\u4e2a\u6ee4\u955c\u9500\u6bc1\u6389\uff0c\u7136\u540e\u521d\u59cb\u5316\u65b0\u7684\u6ee4\u955c\u5e76\u8bbe\u5b9a\u5bbd\u3001\u9ad8\u3002</p> <pre><code>                final GPUImageFilter oldFilter = mFilter;\n                mFilter = filter;\n                if (oldFilter != null) {\n                    oldFilter.destroy();\n                }\n                mFilter.init();\n                GLES20.glUseProgram(mFilter.getProgram());\n                mFilter.onOutputSizeChanged(mOutputWidth, mOutputHeight);\n</code></pre>","tags":["OpenGL"]},{"location":"opengl/opengl-gpuimage-analysis/#_4","title":"\u56fe\u50cf\u62cd\u6444\u4fdd\u5b58\u5904\u7406","text":"<p>\u5728 GPUImage \u4e2d\u76f8\u673a\u7684\u62cd\u6444\u662f\u8c03\u7528 Camera \u7684 <code>takePicture</code> \u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u8fd4\u56de\u76f8\u673a\u91c7\u96c6\u7684\u539f\u59cb\u56fe\u50cf\u6570\u636e\uff0c\u7136\u540e\u518d\u5bf9\u8be5\u6570\u636e\u8fdb\u884c\u4e00\u904d\u6ee4\u955c\u5904\u7406\u540e\u5e76\u4fdd\u5b58\u3002</p> <p>\u8c03\u7528\u7684\u6700\u540e\u90fd\u662f\u901a\u8fc7 <code>glReadPixels</code> \u65b9\u6cd5\u5c06\u5904\u7406\u540e\u7684\u56fe\u50cf\u8bfb\u53d6\u51fa\u6765\uff0c\u5e76\u4fdd\u5b58\u4e3a Bitmap \u3002</p> <pre><code>    private void convertToBitmap() {\n        int[] iat = new int[mWidth * mHeight];\n        IntBuffer ib = IntBuffer.allocate(mWidth * mHeight);\n        mGL.glReadPixels(0, 0, mWidth, mHeight, GL_RGBA, GL_UNSIGNED_BYTE, ib);\n        int[] ia = ib.array();\n        // glReadPixels \u8bfb\u53d6\u7684\u5185\u5bb9\u662f\u4e0a\u4e0b\u7ffb\u8f6c\u7684\uff0c\u8981\u5904\u7406\u4e00\u4e0b\n        for (int i = 0; i &lt; mHeight; i++) {\n            for (int j = 0; j &lt; mWidth; j++) {\n                iat[(mHeight - i - 1) * mWidth + j] = ia[i * mWidth + j];\n            }\n        }\n        mBitmap = Bitmap.createBitmap(mWidth, mHeight, Bitmap.Config.ARGB_8888);\n        mBitmap.copyPixelsFromBuffer(IntBuffer.wrap(iat));\n    }\n</code></pre>","tags":["OpenGL"]},{"location":"opengl/opengl-gpuimage-analysis/#_5","title":"\u5c0f\u7ed3","text":"<p>\u5bf9 GPUImage \u7684\u5206\u6790\u4ee5\u53ca\u6ee4\u955c\u67b6\u6784\u7684\u8bbe\u8ba1\u5927\u81f4\u5c31\u662f\u8fd9\u6837\u4e86\uff0c\u8fd9\u4e9b\u90fd\u8fd8\u4e0d\u662f\u5b83\u7684\u7cbe\u534e\u5566\uff0c\u91cd\u8981\u7684\u8fd8\u662f\u5b83\u7684\u90a3\u4e9b\u7740\u8272\u5668\u811a\u672c\uff0c\u4ece\u90a3\u4e9b\u7740\u8272\u5668\u811a\u672c\u4e2d\u5b66\u4f1a\u5982\u679c\u901a\u8fc7 <code>GLSL</code> \u53bb\u5b9e\u73b0\u56fe\u50cf\u5904\u7406\u7b97\u6cd5\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/","title":"\u7528 OpenGL \u5bf9\u89c6\u9891\u5e27\u5185\u5bb9\u8fdb\u884c\u66ff\u6362","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/WZWY5Ml9YP9N9tv-iiFOqg</p> <p>\u5728\u7fa4\u91cc\u9762\u6709\u4eba\u63d0\u5230\u4e86\u8fd9\u4e48\u4e00\u4e2a\u5b9e\u73b0\uff1a\u73b0\u6709\u4e00\u6bb5\u7d20\u6750\u89c6\u9891\uff0c\u60f3\u8981\u5bf9\u89c6\u9891\u4e2d\u7684\u67d0\u4e2a\u5185\u5bb9\u8fdb\u884c\u66ff\u6362\uff0c\u6362\u6210\u81ea\u5df1\u7684\u56fe\u7247\uff0c\u8fd9\u4e2a\u600e\u4e48\u7528 OpenGL \u53bb\u5b9e\u73b0\u5462\uff1f</p> <p>\u9996\u5148\u8981\u660e\u786e\u7684\u662f\uff0c\u89c6\u9891\u662f\u7531\u4e00\u5e27\u4e00\u5e27\u56fe\u50cf\u7ec4\u6210\u7684\uff0c\u5b83\u5229\u7528\u4e86\u4eba\u773c\u7684\u89c6\u89c9\u6682\u7559\u6548\u5e94\uff0c\u4e00\u79d2\u5185\u64ad\u653e\u8db3\u591f\u5e27\u6570\u7684\u56fe\u7247\u624d\u4f1a\u611f\u89c9\u5230\u662f\u8fde\u7eed\u7684\u3002</p> <p>\u800c\u60f3\u8981\u5bf9\u89c6\u9891\u7684\u5185\u5bb9\u8fdb\u884c\u66ff\u6362\uff0c\u4e5f\u5c31\u662f\u8981\u5c06\u6bcf\u4e00\u5e27\u56fe\u50cf\u7684\u5185\u5bb9\u90fd\u8fdb\u884c\u66ff\u6362\u4e86\uff0c\u4e00\u822c\u6765\u8bf4\u8fd9\u5e94\u8be5\u662f\u5c5e\u4e8e\u89c6\u9891\u540e\u671f\u5904\u7406\u4e86\uff0c\u7528\u4e13\u4e1a\u7684 AE \uff08Adobe After Effects\uff09\u8f6f\u4ef6\u6765\u5904\u7406\u4f1a\u6bd4\u8f83\u597d\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/#_1","title":"\u5904\u7406\u601d\u8def","text":"<p>\u5982\u679c\u7528 OpenGL \u6765\u5904\u7406\uff0c\u6709\u8fd9\u6837\u7684\u4e00\u4e2a\u601d\u8def\uff1a</p> <p>\u9996\u5148\u901a\u8fc7 MediaCodec \u5bf9\u6bcf\u4e00\u5e27\u56fe\u50cf\u5185\u5bb9\u8fdb\u884c\u89e3\u7801\uff0c\u7136\u540e\u518d\u901a\u8fc7 OpenGL \u5bf9\u5f53\u524d\u89e3\u7801\u7684\u4e00\u5e27\u56fe\u50cf\u8fdb\u884c\u5904\u7406\uff0c\u5728\u539f\u56fe\u50cf\u4e0a\u52a0\u4e00\u4e2a\u900f\u660e\u7684\u906e\u7f69\u5c42\uff0c\u906e\u7f69\u5c42\u7684\u8981\u6c42\u5c31\u662f\u5bf9\u4e8e\u8981\u66ff\u6362\u7684\u5185\u5bb9\u533a\u57df\u662f\u975e\u900f\u660e\u7684\uff0c\u5176\u4ed6\u533a\u57df\u900f\u660e\uff0c\u5c06\u906e\u7f69\u5c42\u548c\u539f\u56fe\u50cf\u8fdb\u884c\u878d\u5408\uff0c\u6700\u540e\u5f97\u5230\u7684\u5c31\u662f\u4e00\u5e27\u88ab\u66ff\u6362\u8fc7\u5185\u5bb9\u56fe\u50cf\u4e86\uff0c\u518d\u5c06\u5904\u7406\u8fc7\u7684\u4e00\u5e27\u56fe\u50cf\u8fdb\u884c\u7f16\u7801\uff0c\u91cd\u65b0\u7f16\u7801\u6210\u65b0\u7684\u89c6\u9891\u5185\u5bb9\u3002</p> <p>\u4e00\u76f4\u91cd\u590d \u89e3\u7801 -&gt; \u5904\u7406 -&gt; \u7f16\u7801\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u76f4\u5230\u89c6\u9891\u7684\u6bcf\u4e00\u5e27\u5185\u5bb9\u90fd\u5904\u7406\u5b8c\u4e86\uff0c\u5c31\u5b9e\u73b0\u4e86\u5bf9\u89c6\u9891\u5185\u5bb9\u66ff\u6362\u3002</p> <p>\u5f53\u7136\u8fd9\u4ec5\u4ec5\u662f\u4e2a\u601d\u8def\uff0c\u96be\u70b9\u5728\u4e8e\u5982\u4f55\u627e\u5230\u5408\u9002\u7684\u906e\u7f69\u5c42\uff0c\u5982\u679c\u89c6\u9891\u56fe\u50cf\u5185\u5bb9\u662f\u53d8\u52a8\u7684\uff0c\u8981\u66ff\u6362\u7684\u5185\u5bb9\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u90a3\u4e48\u5bf9\u4e8e\u906e\u7f69\u5c42\u8981\u6c42\u66f4\u9ad8\u4e86\uff0c\u6bcf\u4e00\u5e27\u5904\u7406\u90fd\u5f97\u6709\u4e2a\u5408\u9002\u7684\u906e\u7f69\u3002</p> <p>\u4e0b\u9762\u4f1a\u9488\u5bf9\u89c6\u9891\u7684\u4e00\u5e27\u56fe\u50cf\u5185\u5bb9\u8fdb\u884c\u5904\u7406\uff0c\u5982\u4f55\u5c06\u4e00\u5e27\u7684\u56fe\u50cf\u5185\u5bb9\u66ff\u6362\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/#_2","title":"\u76f4\u63a5\u6548\u679c","text":"<p>\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ee3\u7801\u5b9e\u73b0\u7684\u6548\u679c\uff0c\u5de6\u4e0a\u65b9\u7684\u5185\u5bb9\u88ab\u53f3\u4e0a\u65b9\u5185\u5bb9\u66ff\u6362\u4e86\uff0c\u6700\u540e\u6210\u4e86\u53f3\u4e0b\u89d2\u7684\u56fe\u7247\u3002</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/#_3","title":"\u51c6\u5907\u5de5\u4f5c","text":"<p>\u4e0d\u4f1a\u505a\u8bbe\u8ba1\u7684\u5f00\u53d1\u4e0d\u662f\u597d\u7801\u519c</p> <p>\u662f\u65f6\u5019\u638f\u51fa\u6211\u7684\u5927\u5b9d\u77f3\u8f6f\u4ef6 Sketch \u5207\u4e2a\u56fe\u4e86\uff1a</p> <p>\u51c6\u5907\u4e00\u5f20\u5f85\u66ff\u6362\u5185\u5bb9\uff1a</p> <p></p> <p>\u7136\u540e\u518d\u5207\u4e00\u5f20\u540c\u7b49\u5927\u5c0f\uff0c\u5e76\u628a\u4e2d\u95f4\u5706\u5f62\u4f4d\u7f6e\u7684\u56fe\u7247\u66ff\u6362\u6210\u60f3\u8981\u7684\u56fe\u7247\uff0c\u5176\u4ed6\u5468\u8fb9\u5185\u5bb9\u8bbe\u7f6e\u900f\u660e\u5ea6\u4e3a 0 \u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\u7684\u4e8b\u60c5\u5c31\u662f\u5c06\u4e24\u5f20\u56fe\u7247\u878d\u5408\uff0c\u5206\u522b\u4ecb\u7ecd\u57fa\u4e8e\u7740\u8272\u5668\u548c\u989c\u8272\u6df7\u5408\u6765\u66ff\u6362\u5185\u5bb9\u3002</p> <p>\u8fd9\u4e24\u4e2a\u65b9\u6848\u90fd\u6709\u4e00\u4e2a\u5171\u540c\u70b9\uff0c\u5c31\u662f\u8981\u5c06\u5e26\u906e\u7f69\u7684\u56fe\u7247\u8986\u76d6\u5728\u539f\u56fe\u4e0a\uff0c\u4e0d\u540c\u7684\u662f\u5982\u4f55\u5904\u7406\u4e24\u4e2a\u56fe\u7247\u4e4b\u95f4\u7684\u8986\u76d6\uff0c\u900f\u660e\u5ea6\u5c31\u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u5207\u5165\u70b9\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/#_4","title":"\u4f7f\u7528\u7740\u8272\u5668\u8fdb\u884c\u66ff\u6362","text":"<p>\u5728 OpenGL \u7684\u6e32\u67d3\u7ba1\u7ebf\u4e2d\uff0c\u4f1a\u5148\u6784\u5efa\u56fe\u5f62\uff0c\u7136\u540e\u8fdb\u884c\u5149\u6805\u5316\uff0c\u5149\u6805\u5316\u540e\u5bf9\u6bcf\u4e00\u4e2a\u7247\u5143\u7740\u8272\uff0c\u5728\u8fd9\u4e2a\u7740\u8272\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u6839\u636e\u9700\u8981\u5bf9\u7247\u5143\u8fdb\u884c\u5904\u7406\uff0c\u5305\u62ec\u629b\u5f03\u67d0\u4e9b\u7247\u5143\u7b49\uff0c\u7b80\u5355\u8bf4\u5728 OpenGL \u4e2d\u5c31\u662f\u5148\u6709\u5f62\u540e\u6709\u8272\uff0c\u800c\u5728\u6709\u5f62\u6709\u8272\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u641e\u70b9\u5c0f\u64cd\u4f5c~~</p> <p>\u5bf9\u7247\u5143\u8fdb\u884c\u5904\u7406\u5c31\u662f\u6211\u4eec\u7684\u7247\u5143\u7740\u8272\u5668\u811a\u672c\u4e86\u3002</p> <p><pre><code>precision mediump float;\nvarying vec2 vTextureCoord; //\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u53c2\u6570\nuniform sampler2D sTexture;//\u7eb9\u7406\u5185\u5bb9\u6570\u636e\nvoid main() { \n   vec4 bcolor = texture2D(sTexture, vTextureCoord);//\u7ed9\u6b64\u7247\u5143\u4ece\u7eb9\u7406\u4e2d\u91c7\u6837\u51fa\u989c\u8272\u503c \n   if(bcolor.a&lt;0.6) {\n        discard;\n   } else {\n      gl_FragColor=bcolor;\n}}\n</code></pre> \u6211\u4eec\u7684\u906e\u7f69\u56fe\u9664\u4e86\u8981\u66ff\u6362\u7684\u5185\u5bb9\uff0c\u5176\u4ed6\u5730\u65b9\u90fd\u662f\u900f\u660e\u7684\uff0c\u6839\u636e\u91c7\u6837\u51fa\u7684\u900f\u660e\u5ea6\u503c\u5c0f\u4e8e\u9608\u503c\uff0c\u5c31\u629b\u5f03\u8be5\u7247\u5143\uff0c\u76f4\u63a5\u5c31\u4e0d\u663e\u793a\u4e86\u3002</p> <p>\u800c\u900f\u660e\u5ea6\u6ee1\u8db3\u8981\u6c42\u7684\u5c31\u4f1a\u663e\u793a\uff0c\u5e76\u4e14\u5728\u6700\u540e\u6620\u5c04\u5230\u89c6\u53e3\u4e0a\u65f6\uff0c\u76f4\u63a5\u8986\u76d6\u4e86\u539f\u6709\u7684\u989c\u8272\u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5c31\u5b9e\u73b0\u4e86\u5185\u5bb9\u66ff\u6362\u3002</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/#_5","title":"\u4f7f\u7528\u989c\u8272\u6df7\u5408\u8fdb\u884c\u66ff\u6362","text":"<p>\u4f7f\u7528\u989c\u8272\u6df7\u5408\u7684\u65b9\u5f0f\u4e0d\u50cf\u7740\u8272\u5668\u90a3\u6837\u7b80\u5355\u7c97\u66b4\uff0c\u8981\u4e48\u629b\u5f03\u67d0\u4e9b\u7247\u5143\uff0c\u8981\u4e48\u76f4\u63a5\u8986\u76d6\u4e86\u3002</p> <p>\u5b83\u662f\u6839\u636e\u4e00\u5b9a\u7684\u8ba1\u7b97\u89c4\u5219\uff0c\u6765\u8ba1\u7b97\u4e24\u4e2a\u989c\u8272\u4e4b\u95f4\u7684\u878d\u5408\u3002</p> <p>\u5728 OpenGL \u4e2d\u4f7f\u7528\u989c\u8272\u6df7\u5408\u8981\u8bbe\u7f6e\u5408\u7406\u7684\u6df7\u5408\u56e0\u5b50\u3002</p> <pre><code>        glEnable(GL_BLEND);\n        glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)\n        // \u7ed8\u5236\n        glDisable(GL_BLEND)\n</code></pre> <p>\u6df7\u5408\u56e0\u5b50\u7684\u8bbe\u7f6e\u4f7f\u5f97\u5982\u679c\u906e\u7f69\u56fe\u662f\u900f\u660e\u7684\uff0c\u4f7f\u7528\u88ab\u906e\u7f69\u56fe\u7684\u989c\u8272\uff0c\u5982\u679c\u4e0d\u662f\u900f\u660e\u7684\uff0c\u4f7f\u7528\u906e\u7f69\u56fe\u7684\u989c\u8272\uff0c\u8fd9\u6837\u5c31\u4e0d\u662f\u76f4\u63a5\u629b\u5f03\u67d0\u4e9b\u7247\u5143\u4e86\u3002</p> <p>\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/#_6","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u5728\u5177\u4f53\u7684\u4ee3\u7801\u5b9e\u73b0\u4e2d\uff0c\u91c7\u7528\u4e86 EGL \u6765\u5b9e\u73b0\u79bb\u5c4f\u7684\u6e32\u67d3\u3002</p> <p>\u5728\u975e\u4e3b\u7ebf\u7a0b\u4e2d\uff0c\u521d\u59cb\u5316 EGL \u73af\u5883\uff0c\u7136\u540e\u51c6\u5907\u597d\u7ed8\u5236\u7684\u5fc5\u8981\u5de5\u4f5c\uff0c\u63a5\u7740\u6267\u884c\u7ed8\u5236\uff0c\u6700\u540e\u628a\u7ed8\u5236\u7684\u7ed3\u679c\u901a\u8fc7 glReadPixels \u8bfb\u53d6\u51fa\u6765\u3002</p> <pre><code>        Observable.fromCallable {\n        // \u521d\u59cb\u5316 EGL \u73af\u5883\n            return@fromCallable initEgl()\n        }.map {\n        // \u8bbe\u7f6e\u5404\u79cd\u77e9\u9635\n            prepare(width, height)\n            return@map it\n        }.map {\n        // \u6267\u884c\u7ed8\u5236\n            replaceContent(isBlend)\n            return@map it\n        }.map {\n        // \u8bfb\u53d6\u50cf\u7d20\n            val result = readPixel(width, height)\n            it.destroy()\n            return@map result\n        }.subscribeOn(Schedulers.computation())\n                .observeOn(AndroidSchedulers.mainThread())\n                .subscribe({\n                // \u8bbe\u7f6e\u6548\u679c\n                    mResultImage.setImageBitmap(it)\n                }, {\n                    showToast(\"replace failed\")\n                })\n</code></pre> <p>\u5177\u4f53\u7684\u7ed8\u5236\u8fc7\u7a0b\u6bd4\u8f83\u7b80\u5355\uff0c\u5982\u679c\u91c7\u7528\u4e86\u989c\u8272\u6df7\u5408\u5c31\u6267\u884c\u989c\u8272\u6df7\u5408\u7684\u7ed8\u5236\uff0c\u5426\u5219\u91c7\u7528\u7740\u8272\u5668\u7684\u7ed8\u5236\uff0c\u4e5f\u4f53\u73b0\u4e86\u5c31\u662f\u5c06\u906e\u7f69\u56fe\u76f4\u63a5\u8986\u76d6\u5728\u539f\u56fe\u4e0a\u7684\u601d\u60f3\u3002</p> <pre><code> private fun replaceContent(isBlend: Boolean) {\n        glClearColor(1f, 1f, 1f, 1f)\n        glClear(GL_COLOR_BUFFER_BIT or GL_DEPTH_BUFFER_BIT)\n        mOriginImage?.drawSelf(mOriginTextureId)\n        if (isBlend) {\n            glEnable(GL_BLEND);\n            glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)\n            mReplaceImage?.drawSelf(mReplaceTextureId)\n            glDisable(GL_BLEND)\n        } else {\n            mAlphaTextureRect?.drawSelf(mReplaceTextureId)\n        }\n    }\n</code></pre> <p>\u5728\u6700\u540e\u8bfb\u53d6\u50cf\u7d20\u5185\u5bb9\u65f6\u8981\u6ce8\u610f\uff0cglReadPixels \u8bfb\u53d6\u7684\u5185\u5bb9\u662f\u4e0a\u4e0b\u98a0\u5012\u7684\uff0c\u9700\u8981\u5c06\u5b83\u7ffb\u8f6c\u8fc7\u6765\u3002</p> <pre><code>   for (i in 0 until height) {\n            for (j in 0 until width) {\n                pixelMirroredArray[(height - i - 1) * width + j] = pixelArray[i * width + j]\n            }\n        }\n</code></pre> <p>\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6c42\u4e00\u6ce2 Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/#_7","title":"\u540e\u7eed\u60f3\u6cd5","text":"<p>\u5bf9\u4e8e\u89c6\u9891\u5185\u5bb9\u66ff\u6362\uff0c\u8fd9\u91cc\u4ec5\u4ec5\u662f\u7ed9\u51fa\u4e86\u4e00\u5e27\u56fe\u50cf\u5185\u5bb9\u7684\u66ff\u6362\uff0c\u800c\u4e14\u8fd8\u662f\u57fa\u4e8e\u900f\u660e\u5ea6\u7684\u3002</p> <p>\u770b\u5230\u597d\u83b1\u575e\u6709\u4e9b\u7535\u5f71\u573a\u666f\u62cd\u6444\u65f6\uff0c\u540e\u9762\u90fd\u4f1a\u7ed9\u51fa\u4e00\u5757\u7eaf\u8272\u7684\u5e55\u5e03\uff0c\u7136\u540e\u5728\u540e\u671f\u5904\u7406\u65f6\u628a\u5e55\u5e03\u5185\u5bb9\u66ff\u6362\u6210\u80cc\u666f\uff0c\u8fd9\u79cd\u66ff\u6362\u901a\u8fc7\u7740\u8272\u5668\u6bd4\u8f83\u989c\u8272\u7684\u8303\u56f4\u5e94\u8be5\u4e5f\u662f\u53ef\u4ee5\u5b9e\u73b0\u7684\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u8981\u662f\u642d\u914d\u56fe\u50cf\u8bc6\u522b\u6765\u66ff\u6362\u5185\u5bb9\u73a9\u6cd5\u5c31\u66f4\u52a0\u4e30\u5bcc\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-handle-video-frame-and-replace-content/#_8","title":"\u6700\u540e","text":"<p>\u4fd7\u8bdd\u8bf4\uff1a</p> <p>\u72ec\u5b66\u800c\u65e0\u53cb\uff0c\u5219\u5b64\u964b\u800c\u5be1\u95fb</p> <p>\u5b66\u4e60\u7684\u8def\u4e0a\u662f\u9700\u8981\u4ea4\u6d41\u548c\u5206\u4eab\u7684\uff0c\u8fd9\u91cc\u6709\u4e2a\u4e8c\u7ef4\u7801\uff0c\u5982\u679c\u4f60\u5bf9 OpenGL ES \u611f\u5174\u8da3\u6b22\u8fce\u4e00\u8d77\u6765\u4ea4\u6d41\u8ba8\u8bba\u3002</p> <p></p> <p>\u8981\u662f\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u52a0\u5fae\u4fe1 ezglume \u597d\u53cb\uff0c\u5907\u6ce8 OpenGL \uff0c\u62c9\u4f60\u5165\u7fa4~</p>","tags":["OpenGL"]},{"location":"opengl/opengl-share-context/","title":"OpenGL\u4e0a\u4e0b\u6587\u521b\u5efa\u4ee5\u53ca\u5171\u4eab\u673a\u5236","text":"<p>\u5728\u77e5\u8bc6\u661f\u7403\u91cc\u9762\uff0c\u6709\u4e00\u4e2a\u540c\u5b66\u54a8\u8be2\u7eb9\u7406\u6c60\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002</p> <p>\u5173\u4e8e\u7eb9\u7406\u6c60\u7684\u5b9e\u73b0\u65b9\u6848\u4ee5\u53ca\u80cc\u540e\u7684\u539f\u56e0\u3001\u7ec6\u8282\u3001\u6280\u5de7\uff0c\u53ea\u6709\u957f\u7bc7\u5927\u8bba\u624d\u8db3\u4ee5\u8bba\u9053\uff0c\u672c\u6587\u6682\u8868\u4e0d\u63d0\u3002</p> <p>\u9488\u5bf9\u95ee\u9898\u672c\u8eab\uff0c\u7b14\u8005\u53d1\u73b0\u8fd9\u4f4d\u540c\u5b66\u5bf9OpenGL\u4e2d\u7684\u5171\u4eab\u8d44\u6e90\u5b58\u5728\u8bef\u89e3\uff0c\u4ed6\u8ba4\u4e3aOpenGL\u4e2d\u53ef\u4ee5\u5171\u4eabFBO\u3002</p> <p>\u4e3a\u4e86\u7ea0\u6b63\u9519\u8bef\uff0c\u4e5f\u4e3a\u4e86\u8ba9\u5927\u5bb6\u5728\u4f7f\u7528OpenGL\u4e4b\u524d\u7406\u6e05\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5\uff0c\u7b14\u8005\u4e13\u95e8\u9644\u4e0a\u4e00\u7bc7\u65e7\u6587\u7cfb\u7edf\u8bb2\u8ff0\u4e0a\u4e0b\u6587\u7684\u521b\u5efa\u53ca\u5171\u4eab\u3002</p> <p>\u5e0c\u671b\u80fd\u591f\u5e2e\u52a9\u5230\u8fd9\u4e2a\u540c\u5b66\uff0c\u540c\u65f6\u6211\u7684\u56de\u590d\u4e5f\u662f\u629b\u7816\u5f15\u7389\uff0c\u5982\u679c\u5404\u4f4d\u770b\u5b98\u6709\u5176\u4ed6\u7406\u89e3\u548c\u4e00\u4e9b\u81ea\u5df1\u7684\u770b\u6cd5\uff0c\u6b22\u8fce\u4ea4\u6d41\u3002</p> <p>\u4ee5\u4e0b\u662f\u661f\u7403\u5185\u7684\u63d0\u95ee\uff1a</p> <p>\u60f3\u95ee\u4e0b\u7eb9\u7406\u6c60\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff0c\u7eb9\u7406\u6c60\u91cc\u9762\u7f13\u5b58\u7684\u662ffbo\u5417\uff1f</p> <p>\u4e0b\u9762\u662f\u6211\u7684\u539f\u6587\uff1a</p> <p>\u524d\u6587\u6211\u4eec\u8bb2\u8ff0\u4e86\u5982\u4f55\u521b\u5efa\u6e32\u67d3\u7a97\u53e3\u3002\u770b\u8fc7\u7684\u5c0f\u4f19\u4f34\u4eec\u4e5f\u77e5\u9053OpenGL\u73af\u5883\u642d\u5efa\u9664\u4e86\u521b\u5efa\u6e32\u67d3\u7a97\u53e3\uff0c\u8fd8\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4efb\u52a1\uff0c\u90a3\u5c31\u662f\u521b\u5efaOpenGL\u4e0a\u4e0b\u6587\u3002</p> <p>\u4f46\u6211\u4eec\u60f3\u8bf4\u7684\u662f\uff0c\u9488\u5bf9\u4e0a\u4e0b\u6587\uff0c\u4e0d\u662f\u4ec5\u4ec5\u4e86\u89e3\u5982\u4f55\u521b\u5efa\u4e0a\u4e0b\u6587\u5c31\u8db3\u591f\u4e86\uff0c\u8fd9\u8fd8\u8fdc\u8fdc\u4e0d\u591f\u3002</p> <p>OpenGL\u4e2d\u7684\u4e0a\u4e0b\u6587\u662f\u4e00\u4e2a\u4f7f\u7528\u975e\u5e38\u590d\u6742\u7684\u57fa\u7840\u6982\u5ff5\uff0c\u8981\u8fd0\u7528\u597d\u4e0a\u4e0b\u6587\uff0c\u9664\u4e86\u521b\u5efa\u4e4b\u5916\uff0c\u56f4\u7ed5\u5728\u591a\u7ebf\u7a0b\u4e2d\u7684\u5171\u4eab\u4ee5\u53ca\u5171\u4eab\u4e4b\u540e\u7684\u4e0a\u4e0b\u6587\u7ed1\u5b9a\uff0c\u8fd9\u4e9b\u57fa\u7840\u77e5\u8bc6\u4e5f\u5fc5\u987b\u4e86\u89e3\u3002</p> <p>\u6211\u4eec\u5c06\u5bf9\u4e0a\u4e0b\u6587\u8fdb\u884c\u7cfb\u7edf\u8bb2\u8ff0\u3002\u56f4\u7ed5\u7740\u4e0a\u4e0b\u6587\uff0c\u672c\u6587\u5148\u4f1a\u4ece\u4e0a\u4e0b\u6587\u5171\u4eab\u5c55\u5f00\uff0c\u8fd9\u4e00\u8282\u4f1a\u544a\u8bc9\u5c0f\u4f19\u4f34\u4eec\u5171\u4eab\u4e0a\u4e0b\u6587\u7684\u539f\u56e0\u4ee5\u53ca\u539f\u7406\uff1b\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f1a\u8bb2\u8ff0\u5982\u4f55\u521b\u5efa\u4e0a\u4e0b\u6587\uff0c\u5e76\u7ed3\u5408\u4e0a\u6587\u4e2d\u6e32\u67d3\u7a97\u53e3\u7684\u521b\u5efa\uff0c\u8ba9\u5c0f\u4f19\u4f34\u5b66\u4f1a\u5b8c\u6574\u642d\u5efaOpenGL\u5f00\u53d1\u73af\u5883\uff1b\u6700\u540e\u4e00\u8282\uff0c\u6211\u4eec\u4f1a\u544a\u8bc9\u5c0f\u4f19\u4eec\u7ed1\u5b9a\u4e0a\u4e0b\u6587\u7684\u539f\u7406\u548c\u89c4\u5219\u3002</p> <p>\u4e00\u3001\u5171\u4eab</p> <ol> <li>\u4e3a\u4ec0\u4e48\u5171\u4eab\u4e0a\u4e0b\u6587</li> </ol> <p>\u4e0a\u4e0b\u6587\u975e\u5e38\u5173\u952e\uff0c\u4e5f\u662f\u5b66\u4e60OpenGL\u9700\u8981\u82b1\u529b\u6c14\u7406\u89e3\u7684\u6982\u5ff5\u3002\u4e0a\u4e0b\u6587\u4e2d\u5b58\u50a8\u4e86OpenGL\u6240\u6709\u7684\u72b6\u6001\uff0c\u8fd9\u4e9b\u72b6\u6001\u5728\u6e32\u67d3\u547d\u4ee4\u89e6\u53d1\u4e4b\u540e\u4f1a\u88abGPU\u5229\u7528\u5b8c\u6210\u7ed8\u5236\u3002\u72b6\u6001\u53ef\u4ee5\u901a\u8fc7OpenGL API\u8fdb\u884c\u66f4\u65b0\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u4e24\u6b21\u6e32\u67d3\u52a8\u6001\u5448\u73b0\u4e0d\u540c\u6548\u679c\uff0c\u5927\u5927\u62d3\u5c55\u4e86\u6e32\u67d3\u7ba1\u7ebf\u7684\u7075\u6d3b\u6027\u3002\u5173\u4e8e\u4e0a\u4e0b\u6587\uff0c\u8fd8\u6709\u4e00\u4e2a\u505aOpenGL\u5f00\u53d1\u4e0d\u53ef\u56de\u907f\u7684\u7279\u6027\uff0c\u90a3\u5c31\u662f\u5b83\u7684\u7ebf\u7a0b\u76f8\u5173\u3002\u4e0a\u4e0b\u6587\u88ab\u8bbe\u8ba1\u6210\u7ebf\u7a0b\u76f8\u5173\u662f\u5f88\u81ea\u7136\u7684\u3002</p> <p>\u9996\u5f53\u5176\u4e2d\u7684\u539f\u56e0\u5c31\u662f\u72b6\u6001\u7684\u53bb\u4e2d\u5fc3\u5316\uff0c\u65b9\u4fbf\u7ba1\u7406\u3002\u4e0a\u4e0b\u6587\u4e2d\u4fdd\u5b58\u4e86\u7ed8\u5236\u6240\u9700\u8981\u7684\u5168\u90e8\u72b6\u6001\uff0c\u5982\u679c\u4e0d\u6cbf\u7528\u53bb\u4e2d\u5fc3\u5316\u7406\u5ff5\u8bbe\u8ba1\u6210\u7ebf\u7a0b\u76f8\u5173\u4ece\u800c\u901a\u8fc7\u591a\u7ebf\u7a0b\u5206\u89e3\u8fd9\u4e9b\u72b6\u6001\uff0c\u90a3\u4e48\u6574\u4e2a\u7a0b\u5e8f\u7684\u6240\u6709\u72b6\u6001\u5c31\u5c31\u4f1a\u90fd\u4fdd\u5b58\u5728\u4e00\u4e2a\u4e0a\u4e0b\u6587\u4e2d\u3002\u8fd9\u4e2a\u4e0a\u4e0b\u6587\u5c06\u662f\u4e00\u4e2a\u5e9e\u7136\u5927\u7269\uff0c\u7ef4\u62a4\u5b83\u9700\u8981\u5173\u6ce8\u6570\u91cf\u7e41\u591a\u7684\u72b6\u6001\uff0c\u5df2\u7ecf\u975e\u5e38\u957f\u96be\u4ee5\u7ba1\u7406\u3002\u66f4\u52a0\u5f15\u5165\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e9b\u72b6\u6001\u4f1a\u88ab\u6301\u4e45\u5316\u4fdd\u5b58\u7684\u7279\u70b9\u5bfc\u81f4\u6bcf\u6b21\u7ed8\u5236\u90fd\u9700\u8981\u5bf9\u8fd9\u4e9b\u72b6\u6001\u8fdb\u884c\u7ef4\u62a4\uff0c\u8fd9\u65e0\u7591\u4f1a\u52a0\u6df1\u7ba1\u7406\u96be\u5ea6\u3002\u53ef\u4ee5\u8bf4\uff0c\u6ca1\u6709\u7ebf\u7a0b\u76f8\u5173\uff0c\u8fd9\u4e9b\u72b6\u6001\u57fa\u672c\u662f\u65e0\u6cd5\u7ef4\u62a4\u7684\u3002</p> <p>\u53e6\u5916\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u5c31\u662f\u6027\u80fd\u4e0a\u7684\u8003\u8651\u3002\u6211\u4eec\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u53ea\u662f\u4e00\u6b21\u7b80\u5355\u7684\u7ed8\u5236\uff0c\u90a3\u4e48\u4e3a\u4e86\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u786e\u5b9e\u53ef\u4ee5\u5728\u67d0\u4e2a\u7ebf\u7a0b\u521b\u5efa\u4e0a\u4e0b\u6587\uff0c\u7136\u540e\u6240\u6709\u7684OpenGL\u547d\u4ee4\u90fd\u653e\u5728\u8fd9\u4e2a\u7ebf\u7a0b\u6267\u884c\u3002\u8fd9\u597d\u50cf\u903b\u8f91\u4e0a\u4e5f\u662f\u8bf4\u7684\u901a\u7684\u3002\u53ef\u662f\u73b0\u5b9e\u5f80\u5f80\u4e0d\u5982\u4eba\u610f\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u8fd9\u6837\u7b80\u5355\u7684\u7ed8\u5236\u4ec5\u4ec5\u662f\u5c11\u6570\uff0c\u66f4\u591a\u65f6\u5019\uff0c\u6211\u4eec\u9762\u4e34\u7684\u7ed8\u5236\u975e\u5e38\u590d\u6742\uff0c\u903b\u8f91\u4e0a\u7684\u6d41\u7a0b\u4e5f\u5341\u5206\u5197\u7e41\uff0c\u8fd9\u65f6\u5019\u6027\u80fd\u95ee\u9898\u5c31\u662f\u6211\u4eec\u4e0d\u5f97\u4e0d\u9762\u5bf9\u7684\u4e00\u4e2a\u95ee\u9898\u3002</p> <p>\u4e00\u4e2a\u5178\u578b\u7684\u590d\u6742\u7ed8\u5236\u573a\u666f\u5c31\u662f\u5730\u56fe\u3002\u4e3a\u4e86\u5feb\u901f\u5b8c\u6210\u5730\u56fe\u66f4\u65b0\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5730\u56fe\u7684\u67d0\u4e9b\u4efb\u52a1\u4ece\u4e3b\u7ed8\u5236\u7ebf\u7a0b\u4e2d\u62bd\u79bb\u51fa\u53bb\uff0c\u8f7b\u91cf\u5316\u4e3b\u7ed8\u5236\u7ebf\u7a0b\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u9700\u8981\u53e6\u8d77\u7ebf\u7a0b\u53bb\u627f\u8f7d\u8fd9\u4e9b\u62bd\u79bb\u51fa\u53bb\u7684\u4efb\u52a1\u3002\u8fd9\u4e9b\u4efb\u52a1\u80fd\u591f\u88ab\u62bd\u79bb\u51fa\u53bb\u7684\u524d\u63d0\u6761\u4ef6\u5c31\u662f\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u6570\u636e\u53ef\u4ee5\u548c\u4e3b\u7ed8\u5236\u7ebf\u7a0b\u5171\u4eab\u3002</p> <p>\u9700\u8981\u57fa\u4e8e\u5171\u4eab\u8d44\u6e90\u7684\u601d\u8def\u8fdb\u884c\u6d41\u7a0b\u4f18\u5316\u6216\u6539\u9020\u7684\u4e1a\u52a1\u5f88\u591a\uff0c\u4ee5\u5c0f\u4f19\u4f34\u4eec\u719f\u6089\u7684\u76f8\u673a\u4e1a\u52a1\u4e3a\u4f8b\u3002\u76f8\u673a\u4e00\u822c\u4f1a\u91c7\u96c6\u7eb9\u7406\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5728\u91c7\u96c6\u7ebf\u7a0b\u4e2d\u9884\u5907OpenGL\u73af\u5883\u3002\u7136\u800c\uff0c\u5728\u76f8\u673a\u4e2dOpenGL\u73af\u5883\u4e00\u822c\u662f\u7531\u63a7\u4ef6GLSurfaceView\u63d0\u4f9b\uff0cGLSurfaceView\u7684\u7ed8\u5236\u7ebf\u7a0b\u662f\u7531\u81ea\u5df1\u521b\u5efa\u7684\u3002\u65e0\u6cd5\u5171\u4eab\u8d44\u6e90\u7684\u8bdd\uff0c\u76f8\u673a\u7684\u5f00\u542f\u5c31\u9700\u8981\u4f9d\u8d56GLSurfaceView\u63a7\u4ef6\u521d\u59cb\u5316\u5b8c\u6210\uff0c\u5e76\u5c06GLSurfaceView\u521b\u5efa\u7684\u7ed8\u5236\u7ebf\u7a0b\u4f5c\u4e3a\u91c7\u96c6\u7ebf\u7a0b\u3002\u8fd9\u663e\u7136\u4f1a\u5bfc\u81f4\u91c7\u96c6\u7ed8\u5236\u7ebf\u7a0b\u4efb\u52a1\u8fc7\u91cd\u4ee5\u53ca\u76f8\u673a\u6253\u5f00\u901f\u5ea6\u504f\u6162\uff08\u56e0\u4e3a\u76f8\u673a\u7684\u5f00\u542f\u9700\u8981\u4e32\u5f62\u5316\u4f9d\u8d56\u63a7\u4ef6\u7684\u521d\u59cb\u5316\u4e86\uff09\u3002\u5728\u76f8\u673a\u7684\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6b63\u56e0\u4e3a\u6709\u4e86\u4e0a\u4e0b\u6587\u5171\u4eab\uff0c\u8fd9\u4e9b\u95ee\u9898\u4e5f\u5c31\u4e0d\u518d\u56f0\u6270\u6211\u4eec\u4e86\u3002\u901a\u8fc7\u8d44\u6e90\u5171\u4eab\uff0c\u91c7\u96c6\u7ebf\u7a0b\u548c\u7ed8\u5236\u7ebf\u7a0b\u80fd\u591f\u8bbf\u95ee\u540c\u6837\u7684\u8d44\u6e90\u3002\u5b83\u4eec\u7684\u5f02\u6b65\u6267\u884c\u53d8\u4e3a\u53ef\u80fd\uff0c\u76f8\u673a\u9996\u5e27\u901f\u5ea6\u5f97\u5230\u5927\u5927\u63d0\u5347\uff1b\u540c\u65f6\uff0c\u91c7\u96c6\u548c\u7ed8\u5236\u7684\u7ebf\u7a0b\u5206\u79bb\u4e5f\u8f7b\u91cf\u5316\u4e86\u91c7\u96c6\u7ebf\u7a0b\u548c\u7ed8\u5236\u7ebf\u7a0b\u7684\u4efb\u52a1\uff0c\u5bf9\u91c7\u96c6\u548c\u7ed8\u5236\u7684\u5404\u81ea\u7684\u6027\u80fd\u90fd\u6709\u5f88\u5927\u4f18\u5316\u3002</p> <p>\u8d44\u6e90\u5171\u4eab\u5728\u6027\u80fd\u4e0a\u4f1a\u5e26\u6765\u5982\u6b64\u5927\u7684\u4f18\u52bf\uff0cOpenGL\u7684\u8bbe\u8ba1\u81ea\u7136\u4e5f\u4e0d\u4f1a\u5ffd\u89c6\u8fd9\u4e00\u70b9\u3002\u4e0a\u4e0b\u6587\u7684\u5171\u4eab\u5c31\u662fOpenGL\u4e2d\u63d0\u4f9b\u8d44\u6e90\u5171\u4eab\u7684\u65b9\u5f0f\u3002\u4e24\u4e2a\u7ebf\u7a0b\u5171\u4eab\u4e86\u4e0a\u4e0b\u6587\u5c31\u80fd\u5b9e\u73b0\u8d44\u6e90\u5171\u4eab\u3002\u5b83\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u662f\u6027\u80fd\u4f18\u5316\u7684\u6709\u6548\u9014\u5f84\uff0c\u5176\u5b9e\u4e5f\u662f\u6211\u4eec\u5728OpenGL\u4e2d\u51cf\u5c11\u8d44\u6e90\u5360\u7528\u7684\u91cd\u8981\u65b9\u5f0f\uff0c\u4f8b\u5982\u4e00\u4e2a\u7ebf\u7a0b\u590d\u7528\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\u7684\u7eb9\u7406\u5c31\u80fd\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u3002</p> <ol> <li>\u5171\u4eab\u54ea\u4e9b\u8d44\u6e90</li> </ol> <p>\u5728OpenGL\u4e0a\u4e0b\u6587\u4e2d\uff0c\u53ea\u6709\u5bf9\u8c61\u53ef\u4ee5\u88ab\u5171\u4eab\u3002\u6211\u4eec\u5148\u4ecb\u7ecd\u4e00\u4e0bOpenGL\u4e2d\u7684\u5bf9\u8c61\u3002</p> <p>1) \u53ea\u6709\u5bf9\u8c61\u53ef\u88ab\u5171\u4eab</p> <p>\u4eceAPI\u5f62\u6001\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0cOpenGL\u5e93\u662f\u57fa\u4e8eC\u8bed\u8a00\u5b9e\u73b0\u7684\u3002\u8fd9\u5bfc\u81f4\u5b83\u7684\u8bed\u8a00\u7ed3\u6784\u4e0d\u6613\u88ab\u7ffb\u8bd1\u6210\u5176\u4ed6\u9ad8\u7ea7\u8bed\u8a00\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cOpenGL\u5f15\u5165\u4e86\u4e00\u4e9b\u62bd\u8c61\u5c42\uff0c\u5bf9\u8c61\u5c31\u662f\u5176\u4e2d\u4e00\u4e2a\u3002</p> <p>\u5728OpenGL\u4e2d\uff0c\u4e00\u4e2a\u5bf9\u8c61\u662f\u6307\u4e00\u4e9b\u9009\u9879\u7684\u96c6\u5408\uff0c\u5b83\u4ee3\u8868OpenGL\u72b6\u6001\u7684\u4e00\u4e2a\u5b50\u96c6\u3002\u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u5bf9\u8c61\u6765\u4ee3\u8868\u56fe\u50cf\u6570\u636e\uff0c\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u5b83\u7684\u683c\u5f0f\u3001\u91c7\u6837\u65b9\u5f0f\u7b49\u7b49\u3002\u5bf9\u8c61\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2aC\u98ce\u683c\u7684\u7ed3\u6784\u4f53\uff1a</p> <pre><code>struct object_name {\n\n GLfloat option1;\n\n GLuint option2;\n\n GLchar[] name;\n\n};\n</code></pre> <p>\u6d4f\u89c8\u5168\u6587\u53ef\u4ee5\u52a0\u5165\u77e5\u8bc6\u661f\u7403\uff0c\u5b66\u4e60\u4ea4\u6d41\u66f4\u591a\u5185\u5bb9!!!</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-transition/","title":"OpenGL \u5b9e\u73b0\u89c6\u9891\u7f16\u8f91\u4e2d\u7684\u8f6c\u573a\u6548\u679c","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/OuyU_7ieecjdGyDKTx-iFg</p>","tags":["OpenGL"]},{"location":"opengl/opengl-transition/#_1","title":"\u8f6c\u573a\u4ecb\u7ecd","text":"<p>\u8f6c\u573a\u6548\u679c\u662f\u4ec0\u4e48\uff1f</p> <p>\u8f6c\u573a\u6548\u679c\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u4e24\u6bb5\u89c6\u9891\u4e4b\u95f4\u7684\u8854\u63a5\u8fc7\u6e21\u6548\u679c\u3002</p> <p>\u73b0\u5728\u62cd\u6444 vlog \u7684\u73a9\u5bb6\u8d8a\u6765\u8d8a\u591a\uff0c\u8981\u662f\u89c6\u9891\u6ca1\u6709\u4e00\u4e24\u4e2a\u70ab\u9177\u7684\u8f6c\u573a\u6548\u679c\uff0c\u90fd\u4e0d\u597d\u610f\u601d\u62ff\u51fa\u6765\u70ab\u9177\u4e86\u3002</p> <p></p> <p>\u90a3\u4e48\u5982\u4f55\u5728\u89c6\u9891\u7f16\u8f91\u8f6f\u4ef6\u4e2d\u5b9e\u73b0\u8f6c\u573a\u6548\u679c\u5462\uff1f</p> <p>\u8fd9\u91cc\u63d0\u4f9b\u4f7f\u7528 OpenGL \u5b9e\u73b0\u89c6\u9891\u8f6c\u573a\u7684\u4e00\u4e2a\u5c0f\u793a\u4f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49 GLSL \u6765\u5b9e\u73b0\u4e0d\u540c\u7684\u8f6c\u573a\u6548\u679c\u3002</p> <p>\u4ee5\u5728 Android \u5e73\u53f0\u4e0a\u4f5c\u4e3a\u6f14\u793a\uff0c\u4f46\u5176\u5b9e\u4e0d\u7ba1\u662f Android \u8fd8\u662f iOS\uff0c\u5b9e\u73b0\u7684\u539f\u7406\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u9996\u5148\u8981\u6709\u4e24\u6bb5\u89c6\u9891\uff0c\u89c6\u9891 A \u548c\u89c6\u9891 B\uff0c\u5148\u64ad\u653e\u89c6\u9891 A \u540e\u64ad\u653e\u89c6\u9891 B\uff0c\u4e2d\u95f4\u6709\u4e00\u6bb5\u8fc7\u7a0b\u79f0\u4e3a C \uff0cC \u5c31\u662f\u89c6\u9891 A\u3001B \u505a\u8f6c\u573a\u52a8\u753b\u7684\u65f6\u95f4\u6bb5\u3002</p> <p>\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u64ad\u653e\u5668\u6309\u7167\u65f6\u95f4\u987a\u5e8f\uff0c\u4ece A -&gt; C -&gt; B \u7684\u64ad\u653e\uff0c\u8fd9\u6837\u5c31\u6709\u4e86\u8f6c\u573a\u7684\u6548\u679c\u3002</p> <p>\u89c6\u9891\u8f6c\u573a\uff0c\u9996\u5148\u5c31\u5f97\u6709\u89c6\u9891\uff0c\u76f4\u63a5\u4ece\u89c6\u9891 A\u3001B \u4e2d\u89e3\u7801\u51fa\u5f53\u524d\u5e27\u5e76\u901a\u8fc7 OpenGL \u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u5c31\u597d\u4e86\uff0c\u5982\u679c\u4f60\u5bf9\u8fd9\u4e2a\u64cd\u4f5c\u4e0d\u719f\u6089\u7684\u8bdd\uff0c\u53ef\u4ee5\u67e5\u770b\u6211\u7684\u516c\u4f17\u53f7\u3010\u7eb8\u4e0a\u6d45\u8c08\u3011\u5386\u53f2\u6587\u7ae0\uff0c\u90fd\u6709\u5199\u8fc7\u76f8\u5173\u5185\u5bb9\u3002</p> <p>\u8fd9\u91cc\u4ee5\u56fe\u7247\u6765\u66ff\u4ee3\u89c6\u9891 A\u3001B \u4e2d\u89e3\u7801\u51fa\u6765\u7684\u5e27\u3002</p> <p>\u6700\u7ec8\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-transition/#_2","title":"\u5b9e\u73b0\u8bb2\u89e3","text":"","tags":["OpenGL"]},{"location":"opengl/opengl-transition/#_3","title":"\u6a21\u62df\u89c6\u9891\u6e32\u67d3\u64ad\u653e","text":"<p>\u6a21\u62df fps \u4e3a 30 \u7684\u89c6\u9891\uff0c\u7528 RxJava \u6bcf\u95f4\u9694 30 ms \u5c31\u89e6\u53d1\u4e00\u6b21 OpenGL \u6e32\u67d3\u3002</p> <pre><code>Observable\n        .interval(30, TimeUnit.MILLISECONDS)\n        .subscribeOn(AndroidSchedulers.mainThread())\n        .subscribe {\n            mGLSurfaceView.requestRender()\n        }\n</code></pre> <p>\u53e6\u5916\uff0c\u5982\u679c\u5728\u89c6\u9891 A \u64ad\u653e\u9636\u6bb5\u4e0d\u65ad\u5730\u6539\u53d8\u56fe\u7247\uff0c\u4e5f\u5c31\u662f\u66f4\u65b0\u7eb9\u7406\u5185\u5bb9\uff0c\u5c31\u76f8\u5f53\u4e8e\u5728\u771f\u5b9e\u7684\u89e3\u7801\u89c6\u9891\u8fdb\u884c\u64ad\u653e\u4e86\u3002</p> <p>\u5f53\u7136\u8fd9\u4e9b\u64cd\u4f5c\u53ea\u662f\u4e3a\u4e86\u8ba9\u8fd9\u4e2a\u5c0f\u4f8b\u5b50\u66f4\u52a0\u8d34\u8fd1\u771f\u6b63\u7684\u89c6\u9891\u8f6c\u573a\uff0c\u91cd\u8981\u7684\u8fd8\u662f\u5728\u4e8e\u5982\u4f55\u5b9e\u73b0\u8f6c\u573a\u7684 Shader \u6548\u679c\u3002</p> <p>\u9996\u5148\u8f6c\u573a\u7684\u65f6\u5019\u8981\u6709\u4e24\u4e2a\u7eb9\u7406\u4f5c\u4e3a\u8f93\u5165\uff0c\u90a3\u4e48\u80af\u5b9a\u8981\u5b9a\u4e49\u4e24\u4e2a <code>sampler2D</code> \u8fdb\u884c\u91c7\u6837\u4e86\u3002</p> <pre><code>varying vec2 vTextureCoord;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u53c2\u6570\nuniform sampler2D sTexture1;\nuniform sampler2D sTexture2;\n</code></pre> <p>\u5176\u4e2d <code>sTexture1</code> \u5bf9\u5e94\u4e8e\u89c6\u9891 A \u5185\u5bb9\uff0c<code>sTexture2</code> \u5bf9\u5e94\u4e8e\u89c6\u9891 B \u5185\u5bb9\u3002</p> <p><code>vTextureCoord</code> \u5bf9\u5e94\u4e8e\u9876\u70b9\u7740\u8272\u5668\u4f20\u9012\u8fc7\u6765\u7684\u7eb9\u7406\u5750\u6807\uff0c\u89c6\u9891 A \u548c \u89c6\u9891 B \u90fd\u9700\u8981\u7528\u5230\u8fd9\u4e2a\u7eb9\u7406\u5750\u6807\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u53ea\u8981\u8c03\u7528 texture2D \u65b9\u6cd5\u5c31\u80fd\u5f97\u5230\u89c6\u9891 A \u548c \u89c6\u9891 B \u7684\u5185\u5bb9\u4e86\u3002</p> <pre><code>// \u5f97\u5230\u89c6\u9891 A \u7684\u5185\u5bb9\ntexture2D(sTexture1,vTextureCoord)\n// \u5f97\u5230\u89c6\u9891 B \u7684\u5185\u5bb9\ntexture2D(sTexture2,vTextureCoord)\n</code></pre> <p>\u8981\u6ce8\u610f\u7684\u662f\u8fd9\u91cc\u8bf4\u5f97\u5230\u89c6\u9891 A/B \u7684\u5185\u5bb9\uff0c\u662f\u5f97\u5230\u7eb9\u7406\u5750\u6807\u5bf9\u5e94\u7684\u56fe\u50cf\u5185\u5bb9\u3002\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u7eb9\u7406\u5750\u6807\u662f [0,1] \u8303\u56f4\u5185\uff0c\u90a3\u4e48\u53ef\u4ee5\u5f97\u5230\u89c6\u9891 A/B \u7684\u5168\u90e8\u56fe\u50cf\u5185\u5bb9\u3002\u5982\u679c\u5750\u6807\u662f [-0.5,0.5] \u90a3\u4e48\u53ea\u80fd\u91c7\u6837\u5f97\u5230\u4e00\u534a\u5185\u5bb9\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-transition/#_4","title":"\u8f6c\u573a\u6548\u679c\u5b9e\u73b0","text":"","tags":["OpenGL"]},{"location":"opengl/opengl-transition/#mix","title":"\u6df7\u5408\u51fd\u6570 mix","text":"<p>\u7531\u4e8e\u8f6c\u573a\u6548\u679c\u662f\u9700\u8981\u89c6\u9891 A \u548c\u89c6\u9891 B \u8fdb\u884c\u53e0\u52a0\u6df7\u5408\u7684\uff0c\u800c GLSL \u5185\u5d4c\u4e86 <code>mix</code> \u51fd\u6570\u8fdb\u884c\u8c03\u7528\u3002</p> <p>\u5bf9\u4e8e GLSL \u4e2d\u6709\u54ea\u4e9b\u5185\u5d4c\u7684\u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u7684\uff0c\u53ef\u4ee5\u53c2\u8003\u5199\u8fc7\u7684\u6587\u7ae0\u8bb0\u5f55\uff1a</p> <p>OpenGL ES 2.0 \u7740\u8272\u5668\u8bed\u8a00 GLSL \u5b66\u4e60</p> <p><code>mix</code> \u51fd\u6570\u7684\u58f0\u660e\u5982\u4e0b\uff1a</p> <pre><code>genType mix(genType x,genType y,float a) // \u5176\u4e2d genType \u6cdb\u6307 GLSL \u4e2d\u7684\u7c7b\u578b\u5b9a\u4e49\n</code></pre> <p>\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u662f\u4f7f\u7528\u56e0\u5b50 a \u5bf9 x \u4e0e y \u6267\u884c\u7ebf\u6027\u6df7\u5408\uff0c\u65e2\u8fd4\u56de <code>x * (1-a) + y * a</code> \u3002</p> <p>\u73b0\u5728\uff0c\u901a\u8fc7 texture2D \u80fd\u5f97\u5230\u89c6\u9891\u5e27\u5185\u5bb9\uff0c\u901a\u8fc7 mix \u80fd\u8fdb\u884c\u89c6\u9891\u5e27\u6df7\u5408\u53e0\u52a0\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5f97\u5230\u6700\u540e\u8f6c\u573a\u89c6\u9891\u5e27\u4e86\u3002</p> <pre><code>vec4 color = mix(texture2D(sTexture1,vTextureCoord),texture2D(sTexture2,vTextureCoord),a);\n</code></pre>","tags":["OpenGL"]},{"location":"opengl/opengl-transition/#_5","title":"\u6e32\u67d3\u8fdb\u5ea6\u63a7\u5236","text":"<p>\u4f3c\u4e4e\u5230\u8fd9\u91cc\u5c31\u53ef\u4ee5\u5927\u529f\u544a\u6210\u4e86\uff0c\u5b9e\u9645\u4e0a\u624d\u521a\u521a\u5b8c\u6210\u4e86\u4e00\u534a<sub>~</sub></p> <p>\u8981\u77e5\u9053\u8f6c\u573a\u6548\u679c\u662f\u968f\u7740\u65f6\u95f4\u6765\u64ad\u653e\u7684\uff0c\u5c31\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u8f6c\u573a\u65f6\u95f4\u5185\uff0c\u4e00\u5f00\u59cb\u90fd\u662f\u89c6\u9891 A \u7684\u5185\u5bb9\uff0c\u7136\u540e\u89c6\u9891 A \u9010\u6e10\u51cf\u5c11\uff0c\u89c6\u9891 B \u9010\u6e10\u589e\u591a\uff0c\u5230\u6700\u540e\u5168\u662f\u89c6\u9891 B \u5185\u5bb9\uff0c\u5728\u6211\u4eec\u7684 Shader \u4e2d\u4e5f\u8981\u4f53\u73b0\u8fd9\u4e2a\u65f6\u95f4\u53d8\u5316\u7684\u6982\u5ff5\u3002</p> <p>\u5728 Shader \u4e2d\u5b9a\u4e49 <code>progress</code> \u53d8\u91cf\uff0c\u4ee3\u8868\u8f6c\u573a\u7684\u64ad\u653e\u8fdb\u5ea6\uff0c\u8fdb\u5ea6\u4e3a 0 ~ 1.0 \u4e4b\u95f4\u3002</p> <pre><code>uniform float progress;\n</code></pre> <p>\u540c\u65f6\u5728\u6bcf\u4e00\u6b21\u6e32\u67d3\u65f6\u66f4\u65b0 <code>progress</code> \u53d8\u91cf\u7684\u503c\u3002</p> <pre><code>GLES20.glUniform1f(muProgressHandle, mProgress);\n</code></pre> <p>\u5f53 <code>progress</code> \u4e3a 0 \u65f6\u4ee3\u8868\u8f6c\u573a\u521a\u521a\u5f00\u59cb\uff0c\u5f53 <code>progress</code> \u4e3a 1 \u65f6\u4ee3\u8868\u8f6c\u573a\u5df2\u7ecf\u7ed3\u675f\u4e86\u3002</p> <pre><code>if (mProgress &gt;= 1.0f) {\n    mProgress = 0.0f;\n} else {\n    mProgress += 0.01;\n}\n</code></pre> <p>\u8fd9\u91cc <code>progress</code> \u6bcf\u6b21\u9012\u589e 0.01\uff0c\u5b8c\u6210\u4e00\u6b21\u8f6c\u573a\u5c31\u9700\u8981 100 \u6b21\u6e32\u67d3\uff0c\u6bcf\u6b21\u6e32\u67d3\u95f4\u9694 30ms\uff0c\u90a3\u4e48\u4e00\u6b21\u8f6c\u573a\u52a8\u753b\u5c31\u662f 3000ms \u4e86\uff0c\u5f53\u7136\u8fd9\u4e2a\u53ef\u4ee5\u81ea\u5df1\u8c03\u8282\u7684\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-transition/#_6","title":"\u753b\u9762\u7ed8\u5236","text":"<p>\u518d\u56de\u5230 <code>mix</code> \u51fd\u6570\u7684\u53c2\u6570 <code>a</code> \uff0c\u8fd9\u4e2a\u53c2\u6570\u8d77\u5230\u4e86\u968f\u65f6\u95f4\u8c03\u8282\u8f6c\u573a\u6df7\u5408\u7a0b\u5ea6\u7684\u4f5c\u7528\u3002\u5f53 a = 0 \u65f6\uff0c\u5168\u662f\u89c6\u9891 A \u7684\u5185\u5bb9\uff0c \u5f53 a = 1 \u65f6\uff0c\u5168\u662f\u89c6\u9891 B \u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5728\u8f6c\u573a\u52a8\u753b\u7684\u67d0\u4e00\u5e27\uff0c\u5de6\u4fa7\u662f\u89c6\u9891 A \u7684\u5185\u5bb9\uff0c\u56e0\u4e3a\u6b64\u65f6 a = 0\uff0c\u53f3\u4fa7\u662f\u89c6\u9891 B \u7684\u5185\u5bb9\uff0c\u6b64\u65f6 a = 1 \u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u5728\u4e00\u6b21\u6e32\u67d3\u7ed8\u5236\u5185 a \u65e2\u8981\u80fd\u7b49\u4e8e 0 \uff0c\u8fd8\u8981\u80fd\u7b49\u4e8e 1 \uff0c\u8fd9\u4e2a\u662f\u600e\u4e48\u5b9e\u73b0\u7684\u5462? </p> <p>\u4e8b\u5b9e\u4e0a\u6211\u4eec\u8bf4\u7684\u4e00\u6b21\u6e32\u67d3\u7ed8\u5236\uff0c\u901a\u5e38\u6307 OpenGL draw \u65b9\u6cd5\u7684\u4e00\u6b21\u8c03\u7528\uff0c\u4f46\u662f\u5728\u8fd9\u4e00\u6b21\u8c03\u7528\u91cc\uff0c\u8fd8\u662f\u6709\u5f88\u591a\u6b65\u9aa4\u8981\u6267\u884c\u7684\u3002</p> <p>OpenGL \u6e32\u67d3\u7ba1\u7ebf\u4f1a\u5148\u6267\u884c\u9876\u70b9\u7740\u8272\u5668\uff0c\u7136\u540e\u5149\u6805\u5316\uff0c\u518d\u63a5\u7740\u5c31\u662f\u7247\u6bb5\u7740\u8272\u5668\uff0c\u7247\u6bb5\u7740\u8272\u5668\u4f1a\u6839\u636e\u7eb9\u7406\u5750\u6807\u91c7\u6837\u7eb9\u7406\u8d34\u56fe\u4e0a\u7684\u50cf\u7d20\u5185\u5bb9\u8fdb\u884c\u7740\u8272\uff0c\u56e0\u6b64\u7247\u6bb5\u7740\u8272\u5668\u5728\u7ba1\u7ebf\u4e2d\u4f1a\u591a\u6b21\u6267\u884c\uff0c\u9488\u5bf9\u6bcf\u4e2a\u50cf\u7d20\u90fd\u8981\u8fdb\u884c\u7740\u8272\u3002</p> <p></p> <p>\u4e0a\u9762\u56fe\u50cf\u7684\u5c0f\u65b9\u5757\u5c31\u597d\u6bd4\u4e00\u4e2a\u50cf\u7d20\uff0c\u6bcf\u4e2a\u50cf\u7d20\u90fd\u8981\u6267\u884c\u4e00\u4e2a\u7247\u6bb5\u7740\u8272\u5668\u3002</p> <p>\u9996\u5148\uff0c\u80af\u5b9a\u6240\u6709\u7684\u50cf\u7d20\u90fd\u8981\u8fdb\u884c\u7740\u8272\u7684\u3002\u5de6\u4fa7\u65b9\u5757\u91c7\u6837\u89c6\u9891 A \u7684\u7eb9\u7406\u8fdb\u884c\u7740\u8272\uff0c\u53f3\u4fa7\u65b9\u5757\u91c7\u6837\u89c6\u9891 B \u7684\u7eb9\u7406\u8fdb\u884c\u7740\u8272\u3002</p> <p>\u56de\u5230\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>mix(texture2D(sTexture1,vTextureCoord),texture2D(sTexture2,vTextureCoord),a);\n</code></pre> <p>\u53ea\u8981\u4fdd\u8bc1\u7ed8\u5236\u5de6\u4fa7\u65f6 a = 0\uff0c\u7ed8\u5236\u53f3\u4fa7\u65f6 a = 1 \u5c31\u884c\u4e86\u3002\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7\u79fb\u52a8\u7eb9\u7406\u5750\u6807\u6765\u63a7\u5236 a \u7684\u503c\u3002</p> <pre><code>vec2 p = vTextureCoord + progress * sign(direction);\nfloat a = step(0.0,p.y) * step(p.y,1.0) * step(0.0,p.x) * step(p.x,1.0);\n</code></pre> <p>OpenGL \u4e2d\u5b9a\u4e49\u7eb9\u7406\u5750\u6807\u8303\u56f4\u662f [0 ~ 1] \uff0c\u53ef\u4ee5\u5c06\u8303\u56f4\u53f3\u79fb 0.5 \uff0c\u4ece\u800c\u53d8\u6210 [0.5 ~ 1.5] \uff0c\u6b64\u65f6\u7eb9\u7406\u5750\u6807\u4e00\u534a\u4f4d\u4e8e\u89c4\u5b9a\u8303\u56f4\u5185\uff0c\u4e00\u534a\u8d85\u51fa\u754c\u5916\u4e86\u3002</p> <p>\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u5bf9\u5f53\u524d\u50cf\u7d20\u5c0f\u65b9\u683c\u5bf9\u5e94\u7684\u7eb9\u7406\u5750\u6807\u7684 x\uff0cy \u503c\u8fd0\u7528 <code>step</code> \u51fd\u6570\u8fdb\u884c\u5224\u65ad\u662f\u5426\u5728\u754c\u5185\uff0c\u5c31\u53ef\u4ee5\u51b3\u5b9a\u662f\u91c7\u6837\u89c6\u9891 A \u8fd8\u662f\u89c6\u9891 B \u7684\u56fe\u50cf\u4e86\u3002</p> <p>\u5f53\u6bcf\u6b21\u5237\u65b0 progress \u65f6\uff0c\u5c31\u5411\u53f3\u79fb\u4e00\u5c0f\u6bb5\u8ddd\u79bb\uff0c\u89c6\u9891 A \u968f\u7740\u53f3\u79fb\u800c\u53d8\u5c11\uff0c\u89c6\u9891 B \u53d8\u591a\uff0c\u8fd9\u6837\u5c31\u662f\u5b9e\u73b0\u4e86\u8f6c\u573a\u6548\u679c\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-transition/#_7","title":"\u8054\u60f3\u548c\u603b\u7ed3","text":"<p>\u4e0d\u77e5\u9053\u8fd9\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6709\u6ca1\u6709\u8ba9\u4f60\u60f3\u5230\u4e9b\u4ec0\u4e48\uff1f</p> <p>\u5bf9\u7684\uff0c\u6ca1\u9519\uff0c\u5c31\u662f\u5347\u804c\u52a0\u85aa\uff0c\u8d70\u5411\u5dc5\u5cf0\u5fc5\u5907\u7684 PPT \u6280\u80fd\uff0c\u8fd9\u79cd\u89c6\u9891\u8f6c\u573a\u7684\u5b9e\u73b0\u6548\u679c\u5c31\u548c\u6211\u4eec\u5728\u7f16\u8f91 PPT \u52a8\u753b\u65f6\u6dfb\u52a0\u7684\u4e00\u6837\u3002</p> <p></p> <p>\u800c\u4e14\u8fd9\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u60f3\u8981\u505a\u4e00\u4e9b\u82b1\u91cc\u80e1\u54e8\u7684\u8f6c\u573a\u7279\u6548\uff0c\u7f3a\u5c11\u7075\u611f\u5c31\u53ef\u4ee5\u53c2\u8003 PPT \u91cc\u9762\u7684\u52a8\u753b\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5bf9\u8f6c\u573a\u6548\u679c\u505a\u4e00\u4e9b\u603b\u7ed3\u5206\u7c7b\uff0c\u6bd4\u5982\u793a\u4f8b\u4e2d\u7528\u7684\u662f\u56fe\u7247\uff0c\u53ef\u4ee5\u7406\u89e3\u6210\u89c6\u9891 A \u7684\u6700\u540e\u4e00\u5e27\u663e\u793a\u4e0e\u89c6\u9891 B \u7684\u7b2c\u4e00\u5e27\u663e\u793a\u505a\u8f6c\u573a\u6548\u679c\uff0c\u8fd9\u79cd\u8f6c\u573a\u6548\u679c\u5b9e\u9645\u4f7f\u7528\u7684\u4eba\u6bd4\u8f83\u5c11\uff0c\u5927\u591a\u6570\u662f\u89c6\u9891 A \u7684\u6700\u540e\u4e00\u5e27\u4e0e\u89c6\u9891 B \u7684\u524d\u4e00\u6bb5\u65f6\u95f4\u7684\u89c6\u9891\u505a\u8f6c\u573a\u6548\u679c\u3002</p> <p>\u56e0\u6b64\u4e5f\u53ef\u4ee5\u5bf9\u8f6c\u573a\u6548\u679c\u505a\u4e2a\u5206\u7c7b\uff1a</p> <ul> <li>\u89c6\u9891 A \u6700\u540e\u4e00\u5e27\u4e0e\u89c6\u9891 B \u7b2c\u4e00\u5e27\u505a\u8f6c\u573a\u52a8\u753b</li> <li>\u89c6\u9891 A \u6700\u540e\u4e00\u5e27\u4e0e\u89c6\u9891 B \u524d\u4e00\u6bb5\u65f6\u95f4\u89c6\u9891\u505a\u8f6c\u573a\u52a8\u753b</li> <li>\u89c6\u9891 A \u6700\u540e\u4e00\u6bb5\u65f6\u95f4\u89c6\u9891 \u4e0e\u89c6\u9891 B \u7b2c\u4e00\u5e27\u505a\u8f6c\u573a\u52a8\u753b</li> <li>\u89c6\u9891 A \u6700\u540e\u4e00\u6bb5\u65f6\u95f4\u89c6\u9891 \u4e0e\u89c6\u9891 B \u524d\u4e00\u6bb5\u65f6\u95f4\u89c6\u9891\u505a\u8f6c\u573a\u52a8\u753b</li> </ul> <p>\u8fd9\u56db\u4e2a\u5206\u7c7b\u7684\u5b9e\u73b0\u539f\u7406\u5176\u5b9e\u90fd\u5dee\u4e0d\u591a\uff0c\u5982\u679c\u662f\u4e00\u6bb5\u89c6\u9891\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u5728\u89c6\u9891\u64ad\u653e\u65f6\u66f4\u65b0\u5bf9\u5e94\u7eb9\u7406\u3002</p> <p>\u4ee5\u4e0a\u5c31\u5728\u5173\u4e8e\u4f7f\u7528 OpenGL \u5728\u89c6\u9891\u7f16\u8f91\u4e2d\u5b9e\u73b0\u8f6c\u573a\u6548\u679c\u7684\u8bb2\u89e3\uff0c\u901a\u8fc7\u8fd9\u7bc7\u6587\u7ae0\u5e0c\u671b\u5927\u5bb6\u53ef\u4ee5\u638c\u63e1\u8f6c\u573a\u7684\u57fa\u672c\u5b9e\u73b0\u539f\u7406\u3002</p> <p>\u6587\u4e2d\u7528\u5230\u7684\u4ee3\u7801\u793a\u4f8b\uff0c\u53ef\u4ee5\u5173\u6ce8\u6211\u7684\u5fae\u4fe1\u516c\u4f17\u53f7\u3010\u7eb8\u4e0a\u6d45\u8c08\u3011\uff0c\u56de\u590d \u201c\u8f6c\u573a\u201d \u5373\u53ef<sub>~</sub></p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-alpha-test/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b\u4e4b\u5229\u7528 Alpha \u900f\u660e\u5ea6\u8fdb\u884c\u6d4b\u8bd5","text":"<p>\u5728\u524d\u9762\u7684\u535a\u5ba2\u6587\u7ae0\u4e2d\u6709\u63d0\u5230 OpenGL \u88c1\u526a\u6d4b\u8bd5\u53ca\u6ce8\u610f\u70b9\uff0c\u5e76\u4e14\u88c1\u526a\u6d4b\u8bd5\u53ea\u80fd\u88c1\u526a\u4e00\u4e2a\u77e9\u5f62\u533a\u57df\uff0c\u76f8\u5f53\u4e8e\u5c31\u662f\u628a\u6574\u4e2a\u5185\u5bb9\u90fd\u7ed8\u5236\u4e0a\u53bb\u4e86\uff0c\u4f46\u662f\u900f\u8fc7\u4e00\u4e2a\u5c0f\u77e9\u5f62\u533a\u57df\u6765\u770b\u7ed8\u5236\u7684\u7269\u4f53\u3002</p> <p>\u9664\u4e86\u900f\u8fc7\u77e9\u5f62\u533a\u57df\uff0c\u8fd8\u53ef\u4ee5\u5b9e\u73b0\u900f\u8fc7\u4efb\u610f\u5f62\u72b6\u533a\u57df\u6765\u89c2\u5bdf\u7269\u4f53\uff0c\u8fd9\u5c31\u662f\u8981\u7528\u5230 OpenGL \u7684 Alpha \u900f\u660e\u5ea6\u6d4b\u8bd5\u3002</p> <p>\u5173\u4e8e Alpha \u900f\u660e\u5ea6\u6d4b\u8bd5\uff0c\u5728 \u7528 OpenGL \u5bf9\u89c6\u9891\u5e27\u5185\u5bb9\u8fdb\u884c\u66ff\u6362 \u4e5f\u7528\u5b9e\u8df5\u7528\u5230\u8fc7\u3002</p> <p>\u5728 OpenGL \u4e2d\uff0c\u6bcf\u4e2a\u989c\u8272\u90fd\u6709\u56db\u4e2a\u8272\u5f69\u901a\u9053 --- RGBA\uff0c\u5176\u4e2d A \u5c31\u662f Alpha \u900f\u660e\u5ea6\u901a\u9053\uff0c\u53ef\u4ee5\u5229\u7528\u5b83\u7684\u503c\u8fdb\u884c\u68c0\u6d4b\u3002</p> <p>Alpha \u6d4b\u8bd5\u7684\u57fa\u672c\u539f\u7406\u4e3a\uff0c\u5f53\u7ed8\u5236\u4e00\u4e2a\u7247\u5143\u65f6\uff0c\u9996\u5148\u68c0\u6d4b\u5176 Alpha \u503c\uff0c\u82e5 Alpha \u503c\u6ee1\u8db3\u8981\u6c42\uff0c\u5c31\u901a\u8fc7\u6d4b\u8bd5\uff0c\u7ed8\u5236\u6b64\u7247\u5143\uff0c\u5426\u5219\u4e22\u5f03\u6b64\u7247\u5143\uff0c\u4e0d\u8fdb\u884c\u7ed8\u5236\u3002</p> <p>\u6bd4\u5982\u5982\u4e0b\u7684\u573a\u666f\uff1a</p> <p></p> <p>\u5982\u679c\u662f\u88c1\u526a\u6d4b\u8bd5\uff0c\u53ea\u80fd\u5c4f\u5e55\u4e0a\u900f\u8fc7\u4e00\u4e2a\u77e9\u5f62\u533a\u57df\u6765\u89c2\u5bdf\u5b9e\u9645\u573a\u666f\u3002</p> <p></p> <p>\u800c\u6362\u6210 Alpha \u6d4b\u8bd5\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u900f\u8fc7\u4efb\u610f\u5f62\u72b6\u7684\u89c2\u5bdf\uff0c\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u56fe\u4e0a\u7684\u5185\u5bb9\u5b9e\u9645\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u6811\u3001\u5730\u5f62\u3001\u4e2d\u95f4\u5e26\u900f\u660e\u5ea6\u7684\u8fb9\u6846\u3002</p> <p>\u6b63\u56e0\u4e3a\u7ed8\u5236\u7684\u8fb9\u6846\u5e26\u900f\u660e\u5ea6\uff0c\u624d\u4e0d\u4f1a\u5168\u90e8\u906e\u4f4f\u540e\u9762\u7684\u5185\u5bb9\u3002</p> <p>\u5177\u4f53\u7ed8\u5236\u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>            GLES20.glClear(GLES20.GL_DEPTH_BUFFER_BIT or GLES20.GL_COLOR_BUFFER_BIT)\n            // \u6253\u5f00\u6df1\u5ea6\u68c0\u6d4b\n             GLES20.glEnable(GLES20.GL_DEPTH_TEST)\n            // \u8bbe\u7f6e\u76f8\u673a\u548c\u89c2\u5bdf\u77e9\u9635\uff0c\u7ed8\u5236\u5730\u5f62\u548c\u6811\n            MatrixState.setProjectFrustum(-ratio!!, ratio!!, -1f, 1f, 1f, 100f)\n            MatrixState.setCamera(cx, 0f, cz, 0f, 0f, 0f, 0f, 1.0f, 0f)\n\n            MatrixState.pushMatrix()\n            MatrixState.translate(0f, -2f, 0f)\n            // \u7ed8\u5236\u5730\u5f62\n            desert!!.drawSelf(desertId)\n            MatrixState.popMatrix()\n            // \u5f00\u542f\u6df7\u5408\uff0c\u56e0\u4e3a\u6811\u8981\u548c\u5730\u5f62\u6709\u6df7\u5408\u7684\u5730\u65b9\n            GLES20.glEnable(GLES20.GL_BLEND)\n            // \u8bbe\u7f6e\u6df7\u5408\u56e0\u5b50\n            GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE_MINUS_SRC_ALPHA)\n            MatrixState.pushMatrix()\n            MatrixState.translate(0f, -2f, 0f)\n            // \u7ed8\u5236\u6811\n            tg!!.drawSelf(treeId)\n            MatrixState.popMatrix()\n            // \u5173\u95ed\u6df7\u5408\n            GLES20.glDisable(GLES20.GL_BLEND)\n            // \u6e05\u9664\u6df1\u5ea6\u7f13\u51b2\n            GLES20.glClear(GLES20.GL_DEPTH_BUFFER_BIT)\n            // \u8bbe\u7f6e\u76f8\u673a\u548c\u6295\u5f71\u77e9\u9635\u6765\u7ed8\u5236\u5e26\u900f\u660e\u5ea6\u7684\u8fb9\u6846\n            MatrixState.pushMatrix()\n            MatrixState.setProjectOrtho(-1f, 1f, -1f, 1f, 1f, 100f)\n            MatrixState.setCamera(0f, 0f, 3f, 0f, 0f, 0f, 0f, 1.0f, 0.0f)\n            rect!!.drawSelf(maskTextureId)\n            MatrixState.popMatrix()\n</code></pre></p> <p>\u8fd9\u91cc\u9762\u7ed8\u5236\u5e26\u900f\u660e\u5ea6\u7684\u8fb9\u6846\u65f6\u6e05\u9664\u4e86\u4e00\u6b21\u6df1\u5ea6\u7f13\u51b2\uff0c\u56e0\u4e3a\u5e26\u900f\u660e\u5ea6\u8fb9\u6846\u4e0d\u5c5e\u4e8e\u4e3b\u573a\u666f\uff0c\u4e0d\u5e94\u8be5\u548c\u4e3b\u573a\u666f\u4e2d\u7684\u7269\u4f53\u4ee5\u540c\u4e00\u6807\u51c6\u8fdb\u884c\u6df1\u5ea6\u68c0\u6d4b\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e0d\u6b63\u786e\u7684\u89c6\u89c9\u6548\u679c\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-alpha-test/#_1","title":"\u5177\u4f53\u5b9e\u73b0","text":"<p>Alpha \u6d4b\u8bd5\u7684\u91cd\u70b9\u5728\u4e8e\u7247\u6bb5\u7740\u8272\u5668\u7684\u5904\u7406\uff0c\u5728\u8fd9\u91cc\u53ef\u4ee5\u5bf9\u6bcf\u4e00\u4e2a\u7247\u6bb5\u8fdb\u884c\u5904\u7406\uff0c\u6839\u636e Alpha \u6765\u51b3\u5b9a\u662f\u5426\u629b\u5f03\u5b83\u3002</p> <pre><code>precision mediump float;\nvarying vec2 vTextureCoord; //\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u53c2\u6570\nuniform sampler2D sTexture;//\u7eb9\u7406\u5185\u5bb9\u6570\u636e\nvoid main() { \n    //\u7ed9\u6b64\u7247\u5143\u4ece\u7eb9\u7406\u4e2d\u91c7\u6837\u51fa\u989c\u8272\u503c \n   vec4 bcolor = texture2D(sTexture, vTextureCoord);\n   if(bcolor.a&lt;0.6) {\n        discard;\n   } else {\n      gl_FragColor=bcolor;\n}}\n</code></pre> <p>\u6839\u636e\u5177\u4f53\u7684\u56fe\u7247\u900f\u660e\u5ea6\uff0c\u8fd9\u91cc\uff0c\u5982\u679c\u900f\u660e\u5ea6\u5c0f\u4e8e 0.6 \uff0c\u5c31\u629b\u5f03\u8fd9\u4e2a\u7247\u5143\uff0c\u5426\u5219\u7684\u8bdd\u5c31\u8d4b\u503c\u7ed9\u539f\u672c\u91c7\u6837\u7684\u989c\u8272\u3002</p> <p>\u5176\u4e2d\uff0c\u5728 GLSL \u7740\u8272\u5668\u8bed\u8a00\u4e2d\uff0c<code>discard</code> \u4ee3\u8868\u653e\u5f03\u8be5\u7247\u5143\u3002</p> <p>\u800c texture2D \u65b9\u6cd5\u4ee3\u8868\u7eb9\u7406\u91c7\u6837\uff0c\u5b83\u7684\u7ed3\u679c\u7c7b\u578b\u662f\u4e00\u4e2a\u5411\u91cf\uff0c\u5411\u91cf\u5728\u7740\u8272\u5668\u4ee3\u7801\u4e2d\u7684\u5730\u4f4d\u975e\u5e38\u91cd\u8981\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5730\u5b58\u50a8\u4ee5\u53ca\u64cd\u4f5c \u989c\u8272\u3001\u4f4d\u7f6e\u3001\u7eb9\u7406\u5750\u6807 \u7b49\u4e0d\u4ec5\u5305\u542b\u4e00\u4e2a\u7ec4\u6210\u90e8\u5206\u7684\u91cf\u3002</p> <p>\u5bf9\u4e8e\u4e00\u4e2a\u5411\u91cf\uff0c\u6709\u65f6\u9700\u8981\u5355\u72ec\u8bbf\u95ee\u5411\u91cf\u4e2d\u7684\u67d0\u4e2a\u5206\u91cf\uff0c\u57fa\u672c\u8bed\u6cd5\u4e3a <code>&lt;\u5411\u91cf\u540d&gt;.&lt;\u5206\u91cf\u540d&gt;</code>\uff0c\u4ece\u4e0d\u540c\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5b83\u7684\u6bcf\u4e2a\u5206\u91cf\u4ee3\u8868\u7684\u542b\u4e49\u662f\u4e0d\u540c\u7684\uff1a</p> <ul> <li>\u5c06\u5411\u91cf\u770b\u4f5c\u989c\u8272\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 r\u3001g\u3001b\u3001a \u56db\u4e2a\u5206\u91cf\u540d\uff0c\u5206\u522b\u4ee3\u8868\u7ea2\u3001\u7eff\u3001\u84dd\u3001\u900f\u660e\u5ea6 4 \u4e2a\u8272\u5f69\u901a\u9053\u3002</li> </ul> <p><pre><code>vec4 aColor;\naColor.r = 0.6;\naColor.g = 0.8;\n</code></pre> \u82e5\u5411\u91cf\u662f 4 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u5206\u91cf\u540d\u4e3a r\u3001g\u3001b\u3001a\uff1b\u82e5\u5411\u91cf\u662f 3 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u5206\u91cf\u540d\u4e3a r\u3001g\u3001b\uff1b\u82e5\u662f 2 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684 r\u3001g \u4e24\u4e2a\u5206\u91cf\u540d\u3002</p> <ul> <li> <p>\u5c06\u5411\u91cf\u770b\u4f5c\u4f4d\u7f6e\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 x\u3001y\u3001z\u3001w \u56db\u4e2a\u5206\u91cf\u540d\uff0c\u5206\u522b\u4ee3\u8868 x \u8f74\u3001y \u8f74\u3001z \u8f74\u5206\u91cf\u53ca w \u503c\u3002 <pre><code>vec4 aPosition;\naPosition.x = 34.2\naPosition.z = 12.2\n</code></pre> \u82e5\u5411\u91cf\u662f 4 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u5206\u91cf\u540d\u4e3a x\u3001y\u3001z\u3001w\uff1b\u82e5\u5411\u91cf\u662f 3 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u5206\u91cf\u540d\u4e3a x\u3001y\u3001z\uff1b\u82e5\u662f 2 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684 x\u3001y \u4e24\u4e2a\u5206\u91cf\u540d\u3002</p> </li> <li> <p>\u5c06\u5411\u91cf\u770b\u4f5c\u7eb9\u7406\u5750\u6807\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 s\u3001t\u3001p\u3001q \u56db\u4e2a\u5206\u91cf\u540d\uff0c\u5206\u522b\u4ee3\u8868\u7eb9\u7406\u5750\u6807\u7684\u4e0d\u540c\u5206\u91cf\u3002 <pre><code>vec4 aTexCoor;\naTexCoor.s = 0.45;\naTexCoor.t = 0.22;\n</code></pre> \u82e5\u5411\u91cf\u662f 4 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u5206\u91cf\u540d\u4e3a s\u3001t\u3001p\u3001q\uff1b\u82e5\u5411\u91cf\u662f 3 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u5206\u91cf\u540d\u4e3a s\u3001t\u3001p\uff1b\u82e5\u662f 2 \u7ef4\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684 s\u3001t \u4e24\u4e2a\u5206\u91cf\u540d\u3002</p> </li> </ul> <p>\u9664\u4e86\u4f7f\u7528 <code>.</code> \u7684\u5f62\u5f0f\u6765\u8bbf\u95ee\u5206\u91cf\u540d\uff0c\u8fd8\u53ef\u4ee5\u5c06\u5411\u91cf\u770b\u4f5c\u4e00\u4e2a\u6570\u7ec4\uff0c\u7528\u4e0b\u6807\u6765\u8fdb\u884c\u8bbf\u95ee\uff1a</p> <pre><code>aColor[0] = 0.4;\naPostion[2] = 0.34;\naTexCoorp[1] = 0.12;\n</code></pre> <p>\u7406\u89e3\u4e86 discard \u7684\u4f5c\u7528\u548c\u5411\u91cf\u5404\u5206\u91cf\u7684\u542b\u4e49\uff0c\u5c31\u5f88\u5bb9\u6613\u660e\u767d Alpha \u6d4b\u8bd5\u7684\u539f\u7406\u4e86\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cAlpha \u6d4b\u8bd5\u5e76\u4e0d\u662f\u6e32\u67d3\u7ba1\u7ebf\u4e0a\u8981\u8fdb\u884c\u7684\u64cd\u4f5c\u6d41\u7a0b\uff0c\u800c\u662f\u6211\u4eec\u81ea\u5df1\u60f3\u51fa\u7684\u6839\u636e Alpha \u900f\u660e\u5ea6\u503c\u5bf9\u7247\u5143\u8fdb\u884c\u5904\u7406\u7f62\u4e86\u3002</p> <p>\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6c42\u4e00\u6ce2 Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-alpha-test/#_2","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-alpha-test/#_3","title":"\u6700\u540e","text":"<p>\u4fd7\u8bdd\u8bf4\uff1a</p> <p>\u72ec\u5b66\u800c\u65e0\u53cb\uff0c\u5219\u5b64\u964b\u800c\u5be1\u95fb</p> <p>\u5b66\u4e60\u7684\u8def\u4e0a\u662f\u9700\u8981\u4ea4\u6d41\u548c\u5206\u4eab\u7684\uff0c\u8fd9\u91cc\u6709\u4e2a\u4e8c\u7ef4\u7801\uff0c\u5982\u679c\u4f60\u5bf9 OpenGL ES \u611f\u5174\u8da3\u6b22\u8fce\u4e00\u8d77\u6765\u4ea4\u6d41\u8ba8\u8bba\u3002</p> <p></p> <p>\u8981\u662f\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u52a0\u5fae\u4fe1 ezglume \u597d\u53cb\uff0c\u5907\u6ce8 OpenGL \uff0c\u62c9\u4f60\u5165\u7fa4~</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-ambient-light/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b\u5149\u7167\u7cfb\u5217\u4e4b\u73af\u5883\u5149","text":"<p>\u5728 OpenGL \u4e2d\u4f7f\u7528\u5149\u7167\u3002</p> <p>OpenGL \u4e2d\u7684\u5149\u7167\u6a21\u578b\u76f8\u5bf9\u5b9e\u73b0\u4e16\u754c\u8fdb\u884c\u4e86\u5f88\u5927\u7684\u7b80\u5316\uff0c\u5c06\u5149\u7167\u5206\u6210\u4e86 3 \u79cd\u7ec4\u6210\u5143\u7d20\u3002</p> <ul> <li>\u73af\u5883\u5149</li> <li>\u6563\u5c04\u5149</li> <li>\u955c\u9762\u5149</li> </ul> <p>\u8fd9\u4e09\u79cd\u5149\u7167\u662f\u5206\u522b\u91c7\u7528\u4e0d\u540c\u7684\u6570\u5b66\u6a21\u578b\u72ec\u7acb\u8ba1\u7b97\u7684\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-ambient-light/#ambient","title":"\u73af\u5883\u5149 Ambient","text":"<p>\u73af\u5883\u5149\u6307\u7684\u662f\u4ece\u56db\u9762\u516b\u65b9\u7167\u5c04\u5230\u7269\u4f53\u4e0a\uff0c\u5168\u65b9\u4f4d 360\u00b0 \u90fd\u5747\u5300\u7684\u5149\u3002\u5b83\u4ee3\u8868\u7684\u662f\u73b0\u5b9e\u4e16\u754c\u4e2d\u4ece\u5149\u6e90\u5c04\u51fa\uff0c\u7ecf\u8fc7\u591a\u6b21\u53cd\u5c04\u540e\uff0c\u5404\u65b9\u5411\u57fa\u672c\u5747\u5300\u7684\u5149\u3002</p> <p>\u6548\u679c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u73af\u5883\u5149\u6700\u5927\u7684\u7279\u70b9\u662f\u4e0d\u4f9d\u8d56\u4e8e\u5149\u6e90\u7684\u4f4d\u7f6e\uff0c\u800c\u4e14\u6ca1\u6709\u65b9\u5411\u6027\uff0c\u800c\u4e14\u73af\u5883\u5149\u4e0d\u4f46\u5165\u5c04\u662f\u5747\u5300\u7684\uff0c\u53d1\u5c04\u4e5f\u662f\u5404\u9879\u5747\u5300\u7684\u3002</p> <p>\u7528\u4e8e\u8ba1\u7b97\u73af\u5883\u5149\u7684\u6570\u5b66\u6a21\u578b\u975e\u5e38\u7b80\u5355\uff1a</p> <p>\u73af\u5883\u5149\u7167\u5c04\u7ed3\u679c = \u6750\u8d28\u7684\u53cd\u5c04\u7cfb\u6570 * \u73af\u5883\u5149\u5f3a\u5ea6</p> <p>\u73af\u5883\u5149\u5f3a\u5ea6\u6307\u7684\u662f\u73af\u5883\u5149\u4e2d RGB\uff08\u7ea2\u3001\u7eff\u3001\u84dd\uff093 \u4e2a\u8272\u5f69\u901a\u9053\u7684\u5f3a\u5ea6\uff0c\u6750\u8d28\u7684\u53cd\u5c04\u7cfb\u6570\u5b9e\u9645\u6307\u7684\u5c31\u662f\u7269\u4f53\u88ab\u7167\u5c04\u5904\u7684\u989c\u8272\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-ambient-light/#_1","title":"\u5b9e\u8df5","text":"<p>\u52a0\u5165\u73af\u5883\u5149\u5bf9\u7a0b\u5e8f\u7684\u5f71\u54cd\u5c31\u662f\u7740\u8272\u5668\u4ee3\u7801\u4f1a\u6709\u4e9b\u4e0d\u540c\u3002</p> <p>\u5728\u7740\u8272\u5668\u4ee3\u7801\u4e0a\u7684\u533a\u522b\u5c31\u662f\u589e\u52a0\u4e86\u63a5\u6536\u73af\u5883\u5149\u5f3a\u5ea6\uff0c\u4ee5\u53ca\u4f7f\u7528\u73af\u5883\u5149\u5f3a\u5ea6\u4e0e\u7247\u5143\u672c\u8eab\u989c\u8272\u503c\u52a0\u6743\u8ba1\u7b97\u4ea7\u751f\u6700\u7ec8\u7247\u5143\u989c\u8272\u503c\u7684\u76f8\u5173\u4ee3\u7801\u3002</p> <p>\u4ee5\u4e0b\u662f\u4f7f\u7528\u7684\u9876\u70b9\u7740\u8272\u5668\u4ee3\u7801\uff1a</p> <pre><code>#version 300 es\nuniform mat4 uMVPMatrix; //\u603b\u53d8\u6362\u77e9\u9635\nin vec3 aPosition;  //\u9876\u70b9\u4f4d\u7f6e\nout vec3 vPosition;//\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u9876\u70b9\u4f4d\u7f6e\nout vec4 vAmbient;//\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u73af\u5883\u5149\u5206\u91cf\nvoid main()\n{\n   //\u6839\u636e\u603b\u53d8\u6362\u77e9\u9635\u8ba1\u7b97\u6b64\u6b21\u7ed8\u5236\u6b64\u9876\u70b9\u4f4d\u7f6e\n   gl_Position = uMVPMatrix * vec4(aPosition,1);\n   //\u5c06\u9876\u70b9\u7684\u4f4d\u7f6e\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668,\u7528\u4e8e\u7eb9\u7406\u91c7\u6837\n   vPosition = aPosition;\n    //\u5c06\u73af\u5883\u5149\u5f3a\u5ea6\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n   vAmbient = vec4(0.15,0.15,0.15,1.0);\n}\n</code></pre> <p>\u5728\u9876\u70b9\u7740\u8272\u4ee3\u7801\u4e2d\uff0c\u4f1a\u591a\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf <code>vAmbien</code>\uff0c\u5b83\u662f\u7531\u56db\u4e2a\u6570\u7ec4\u6210\u7684\u5411\u91cf\uff0c\u4ee3\u8868\u73af\u5883\u5149\u5f3a\u5ea6\u3002</p> <p>\u6211\u4eec\u9700\u8981\u628a\u8fd9\u4e2a\u73af\u5883\u5149\u5f3a\u5ea6\u4f20\u9012\u7ed9\u7247\u6bb5\u7740\u8272\u5668\uff0c\u8ba9\u7247\u6bb5\u7740\u8272\u5668\u53bb\u6839\u636e\u73af\u5883\u5149\u5f3a\u5ea6\u53bb\u751f\u6210\u6700\u7ec8\u7684\u989c\u8272\u3002</p> <p>\u4ee5\u4e0b\u662f\u7247\u6bb5\u7740\u8272\u5668\u4ee3\u7801\uff1a</p> <pre><code>#version 300 es\nprecision mediump float;\nuniform float uR;\nin vec3 vPosition; //\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u9876\u70b9\u4f4d\u7f6e\nin vec4 vAmbient;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u73af\u5883\u5149\u5f3a\u5ea6\nout vec4 fragColor;\nvoid main()\n{\n   // \u7701\u7565\u4e00\u4e9b\u4ee3\u7801\n   //\u6700\u7ec8\u989c\u8272\uff0c\u4ee3\u8868\u7ecf\u8fc7\u91c7\u6837\u6216\u8005\u662f\u8ba1\u7b97\u540e\u7684\u989c\u8272\n   vec4 finalColor=vec4(color,0);\n    //\u6839\u636e\u73af\u5883\u5149\u5f3a\u5ea6\u8ba1\u7b97\u6700\u7ec8\u7247\u5143\u989c\u8272\u503c\n   fragColor=finalColor*vAmbient;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u4ee3\u7801\u4e2d\u7684 <code>fragColor</code> \u5c31\u662f\u7269\u4f53\u7ecf\u8fc7\u73af\u5883\u5149\u7167\u5c04\u540e\u7684\u989c\u8272\uff0c\u5b83\u4e5f\u662f\u6839\u636e\u4e0a\u9762\u7684\u8ba1\u7b97\u516c\u5f0f\u5f97\u6765\u7684\uff0c\u5c06\u7269\u4f53\u7684\u989c\u8272\u4e0e\u73af\u5883\u5149\u5f3a\u5ea6\u76f8\u4e58\u5f97\u5230\u3002</p> <p>\u4ee5\u4e0b\u662f\u4f7f\u7528\u73af\u5883\u5149\u7167\u5c04\u7684\u7ed3\u679c\u5b9e\u4f8b\uff0c\u73af\u5883\u5149\u5f3a\u5ea6\u4e3a <code>vec4(0.15,0.15,0.15,1.0)</code>\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u7269\u4f53\u6697\u6de1\u4e86\u4e00\u4e9b\uff0c\u8fd9\u5c31\u50cf\u662f\u5728\u9ed1\u591c\u4e2d\u53bb\u89c2\u5bdf\u7269\u4f53\u4e00\u6837\uff0c\u53ea\u6709\u5fae\u5f31\u7684\u6708\u5149\uff0c\u800c\u4e14\u6708\u5149\u53c8\u662f\u5747\u5300\u5206\u5e03\u7684\uff0c\u901a\u8fc7\u7ffb\u8f6c\u7403\u4f53\u7684\u5404\u4e2a\u9762\uff0c\u53ef\u4ee5\u89c2\u5bdf\u5230\u660e\u4eae\u7a0b\u5ea6\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u800c\u5728\u4e4b\u524d\u7684\u6240\u6709\u7ed8\u5236\u4e2d\uff0c\u7269\u4f53\u90fd\u4e0d\u662f\u8fd9\u4e48\u6697\u6de1\u7684\uff0c\u5176\u5dee\u522b\u5c31\u662f\u6ca1\u6709\u7ed9\u6700\u7ec8\u7684\u989c\u8272\u4e58\u4ee5\u73af\u5883\u5149\u5f3a\u5ea6\uff0c\u6216\u8005\u8bf4\uff0c\u6211\u4eec\u4e4b\u524d\u7ed8\u5236\u7684\u73af\u5883\u5149\u5f3a\u5ea6\u8bbe\u7f6e\u662f <code>vec4(1.0,1.0,1.0,1.0)</code>\u3002</p> <p></p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u8ba9\u5176\u4ed6\u7684\u5404\u79cd\u5149\u7167\u90fd\u663e\u5f97\u65e0\u610f\u4e49\u4e86\uff0c\u56e0\u4e3a\u73af\u5883\u5149\u662f\u5747\u5300\u5206\u5e03\u7684\uff0c\u800c\u73af\u5883\u5149\u90fd\u662f\u8fd9\u4e48\u4eae\u4e86\uff0c\u7167\u4eae\u4e86\u6bcf\u4e00\u4e2a\u89d2\u843d\uff0c\u8fd8\u8981\u5176\u4ed6\u5149\u7167\u5e72\u561b\u5462\u3002</p> <p>\u6240\u4ee5\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u8981\u6ce8\u610f\u7ed9\u73af\u5883\u5149\u7167\u8bbe\u7f6e\u5408\u9002\u7684\u503c\u3002</p> <p>\u5177\u4f53\u7684\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6c42\u4e00\u6ce2 Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-ambient-light/#_2","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b\u4e4b\u989c\u8272\u6df7\u5408\u548c\u4f7f\u7528","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/40ss1fbLh3Qr5X4o76GTjA</p> <p>\u5728 Android \u4e2d\u6709\u4e00\u4e2a\u7c7b PorterDuffXfermode \uff0c\u5b83\u662f\u7528\u6765\u8bbe\u7f6e\u989c\u8272\u6df7\u5408\u65b9\u5f0f\u7684\uff0c\u4e5f\u5c31\u662f\u5728\u5df2\u6709\u989c\u8272\u7684\u57fa\u7840\u4e0a\u518d\u7ed8\u5236\u4e00\u7b14\u989c\u8272\uff0c\u8fd9\u4e24\u4e2a\u989c\u8272\u662f\u5982\u4f55\u8fdb\u884c\u6df7\u5408\u7684\uff0c\u662f\u65b0\u7ed8\u5236\u7684\u989c\u8272\u8986\u76d6\u4e86\u539f\u6709\u989c\u8272\uff0c\u8fd8\u662f\u65b0\u7ed8\u5236\u7684\u989c\u8272\u548c\u539f\u6709\u989c\u8272\u6df7\u5408\u7ec4\u6210\u53e6\u4e00\u79cd\u989c\u8272\u5462\u3002</p> <p>\u5728 OpenGL \u4e2d\u540c\u6837\u6709\u8fd9\u6837\u989c\u8272\u6df7\u5408\u7684\u95ee\u9898\u3002</p> <p>\u5728 OpenGL \u7684\u4e16\u754c\u6a21\u578b\u4e2d\u662f\u6709\u6df1\u5ea6\u7684\u6982\u5ff5\u7684\uff0c\u4e5f\u5c31\u662f\u7531 z \u8f74\u5750\u6807\u503c\u6765\u51b3\u5b9a\u7269\u4f53\u8ddd\u79bb\u5750\u6807\u539f\u5730\u7684\u8fdc\u8fd1\uff0c\u4f46\u5230\u6700\u540e\u4e16\u754c\u6a21\u578b\u91cc\u7684\u7269\u4f53\u90fd\u8981\u6295\u5f71\u5230\u8fd1\u5e73\u9762\uff0c\u6700\u540e\u6620\u5c04\u5230\u89c6\u53e3\u4e0a\u3002\u800c\u4e14\uff0c\u8ddd\u79bb\u76f8\u673a\u4e5f\u5c31\u662f\u89c6\u53e3\u8d8a\u8fd1\u7684\u7269\u4f53\uff0c\u5c31\u4f1a\u906e\u4f4f\u540e\u9762\u7684\u7269\u4f53\uff0c\u5c31\u548c\u7528\u8089\u773c\u53bb\u89c2\u5bdf\u7269\u4f53\u4e00\u4e0b\uff0c\u540e\u9762\u7684\u5f62\u72b6\u4f1a\u88ab\u524d\u9762\u7684\u5f62\u72b6\u6321\u4f4f\u3002</p> <p>\u4f46\u548c\u8089\u773c\u89c2\u5bdf\u4e0d\u540c\u7684\u662f\uff0cOpenGL \u91cc\u6700\u7ec8\u5448\u73b0\u7684\u989c\u8272\uff0c\u662f\u5c06\u4e24\u4e2a\u7247\u5143\u6df7\u5408\u4e4b\u540e\u8ba1\u7b97\u7684\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u6539\u53d8\u8fd9\u7247\u5143\u6df7\u5408\u7684\u65b9\u5f0f\uff0c\u8fd9\u5c31\u548c\u524d\u9762 Android \u91cc\u9762\u63d0\u5230\u7684 PorterDuffXfermode \u6df7\u5408\u6a21\u5f0f\u4e00\u6837\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_1","title":"\u989c\u8272\u6df7\u5408\u57fa\u7840\u77e5\u8bc6","text":"<p>OpenGL \u4e2d\u7684\u989c\u8272\u6df7\u5408\u5c31\u662f\u5c06\u901a\u8fc7\u5404\u79cd\u6d4b\u8bd5\u51c6\u5907\u8fdb\u5165\u5e27\u7f13\u51b2\u7684\u7247\u5143\uff08\u6e90\u7247\u5143\uff09\u4e0e\u5e27\u7f13\u51b2\u4e2d\u7684\u539f\u6709\u7247\u5143\uff08\u76ee\u6807\u7247\u5143\uff09\u6309\u7167\u8bbe\u5b9a\u7684\u6bd4\u4f8b\u52a0\u6743\u8ba1\u7b97\u6700\u7ec8\u7247\u5143\u7684\u989c\u8272\u503c\u3002\u65b0\u7247\u5143\u4e0d\u4e00\u5b9a\u662f\u76f4\u63a5\u8986\u76d6\u7f13\u51b2\u533a\u4e2d\u7684\u6e90\u7247\u5143\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_2","title":"\u6df7\u5408\u56e0\u5b50","text":"<p>OpenGL \u901a\u8fc7\u8bbe\u7f6e\u6df7\u5408\u56e0\u5b50\u6765\u6307\u5b9a\u4e24\u4e2a\u7247\u5143\u7684\u52a0\u6743\u6bd4\u4f8b\uff0c\u6bcf\u6b21\u90fd\u9700\u8981\u7ed9\u51fa\u4e24\u4e2a\u6df7\u5408\u56e0\u5b50\uff1a</p> <ul> <li>\u6e90\u56e0\u5b50\uff0c\u7528\u4e8e\u786e\u5b9a\u5c06\u8fdb\u5165\u5e27\u7f13\u51b2\u7684\u7247\u5143\u5728\u6700\u7ec8\u7247\u5143\u4e2d\u7684\u6bd4\u4f8b</li> <li>\u76ee\u6807\u56e0\u5b50\uff0c\u7528\u4e8e\u786e\u5b9a\u539f\u5e27\u7f13\u51b2\u4e2d\u7684\u7247\u5143\u5728\u6700\u7ec8\u7247\u5143\u4e2d\u7684\u6bd4\u4f8b</li> </ul> <p>\u7531\u4e8e OpenGL \u4e2d\u6bcf\u4e2a\u989c\u8272\u503c\u5305\u62ec 4 \u4e2a\u8272\u5f69\u901a\u9053\uff0c\u56e0\u6b64\uff0c\u4e24\u79cd\u6df7\u5b50\u56e0\u5b50\u90fd\u6709 4 \u4e2a\u5206\u91cf\u503c\uff0c\u5206\u522b\u5bf9\u5e94\u4e00\u4e2a\u8272\u5f69\u901a\u9053\uff0c\u5177\u4f53\u6df7\u5408\u8ba1\u7b97\u7ec6\u8282\u5982\u4e0b\uff1a</p> <ul> <li>\u8bbe\u6e90\u56e0\u5b50\u548c\u76ee\u6807\u56e0\u5b50\u5206\u522b\u4e3a \\([S_r,S_g,S_b,S_a]\\) \u548c \\([D_r,D_g,D_b,D_a]\\) \uff0c\\(S\\) \u8868\u793a\u662f\u6e90\u56e0\u5b50\uff0c\\(D\\) \u8868\u793a\u662f\u76ee\u6807\u56e0\u5b50\uff0cr\uff0cg\uff0cb\uff0ca \u4e0b\u6807\u5206\u522b\u8868\u793a \u7ea2\u3001\u7eff\u3001\u84dd\u3001\u900f\u660e\u5ea6 4 \u4e2a\u8272\u5f69\u901a\u9053\u3002</li> <li>\u8bbe\u6e90\u7247\u5143\u548c\u76ee\u6807\u7247\u5143\u7684\u989c\u8272\u503c\u5206\u522b\u4e3a  \\([R_s,G_s,B_s,A_s]\\)  \u548c \\([R_d,G_d,B_d,A_d]\\)\uff0cR\uff0cG\uff0cB\uff0cA \u5206\u522b\u8868\u793a\u7ea2\u3001\u7eff\u3001\u84dd\u3001\u900f\u660e\u5ea6 4 \u4e2a\u8272\u5f69\u901a\u9053\uff0cs \u4e0b\u6807\u8868\u793a\u6e90\u7247\u5143\uff0cd \u4e0b\u6807\u8868\u793a\u76ee\u6807\u7247\u5143\u3002</li> <li>\u6df7\u5408\u540e\u6700\u7ec8\u7247\u5143\u989c\u8272\u5404\u4e2a\u8272\u5f69\u901a\u9053\u7684\u503c\u662f\u7531\u989c\u8272\u6df7\u5408\u65b9\u7a0b\u5f0f\u8ba1\u7b97\u800c\u6765\uff0c\u7cfb\u7edf\u63d0\u4f9b\u7684\u5e38\u7528\u989c\u8272\u6df7\u5408\u65b9\u7a0b\u5f0f\u5982\u4e0b\uff1a</li> </ul>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_3","title":"\u6df7\u5408\u65b9\u7a0b\u5f0f","text":"\u65b9\u7a0b\u5f0f\u540d \u6700\u7ec8\u7247\u5143\u989c\u8272\u5404\u4e2a\u8272\u5f69\u901a\u9053\u7684\u503c GL_FUNC_ADD \\([R_sS_r+R_dD_r, G_sS_g+G_dD_g, B_sS_b+B_dD_b, A_sS_a+A_dD_a]\\) GL_FUNC_SUBTRACT \\([R_sS_r-R_dD_r, G_sS_g-G_dD_g, B_sS_b-B_dD_b, A_sS_a-A_dD_a]\\) GL_FUNC_REVERSE_SUBTRACT \\([R_dD_r-R_sS_r, G_dD_g-G_sS_g, B_dD_b-B_sS_b, A_dD_a-A_sS_a]\\) GL_MIN \\([min(R_sS_r,R_dD_r),min(G_sS_g,G_dD_g),min(B_sS_b,B_dD_b),min(A_sS_a,A_dD_a)]\\) GL_MAX \\([max(R_sS_r,R_dD_r),max(G_sS_g,G_dD_g),max(B_sS_b,B_dD_b),max(A_sS_a,A_dD_a)]\\) <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u8c03\u7528 GL_FUNC_ADD \u6df7\u5408\u65b9\u7a0b\u5f0f\u6765\u8ba1\u7b97\u6700\u7ec8\u7247\u5143\u989c\u8272\u5404\u4e2a\u8272\u5f69\u901a\u9053\u7684\u503c\uff0c\u5982\u679c\u60f3\u8981\u8c03\u7528\u5176\u4ed6\u6df7\u5408\u65b9\u7a0b\u5f0f\u6765\u8ba1\u7b97\u6700\u7ec8\u7684\u7247\u5143\u989c\u8272\uff0c\u7cfb\u7edf\u4e5f\u6709\u63d0\u4f9b\u5bf9\u5e94\u7684\u65b9\u6cd5\uff1a</p> \u65b9\u6cd5\u7b7e\u540d \u8bf4\u660e glBlendEquation(int mode) mode \u53c2\u6570\u7684\u542b\u4e49\u4e3a\u6307\u5b9a\u6df7\u5408\u65b9\u7a0b\u5f0f\uff0c\u7528\u6765\u8ba1\u7b97\u6700\u7ec8\u7247\u5143\u7684\u989c\u8272\uff0c\u5176\u503c\u4e3a\u6df7\u5408\u65b9\u7a0b\u5f0f\u7684\u540d\u5b57 glBlendEquationSeparate(int modeRGB,int modeAlpha) modeRGB \u53c2\u6570\u4e3a\u989c\u8272\u7684 RGB \u901a\u9053\u8fdb\u884c\u6df7\u5408\u65f6\u6240\u4f7f\u7528\u7684\u6df7\u5408\u65b9\u7a0b\u5f0f\u540d\uff0cmodeAlpha \u53c2\u6570\u7684\u542b\u4e49\u662f\u989c\u8272\u7684 Alpha \u900f\u660e\u5ea6\u901a\u9053\u8fdb\u884c\u6df7\u5408\u65f6\u6240\u4f7f\u7528\u7684\u6df7\u5408\u65b9\u7a0b\u5f0f\u540d\u5b57\uff0c\u901a\u8fc7\u5176\u53ef\u4ee5\u5b9e\u73b0 RGB \u548c Alpha \u901a\u9053\u5355\u72ec\u6307\u5b9a\u6df7\u5408\u65b9\u7a0b\u5f0f\u7684\u529f\u80fd","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_4","title":"\u6e90\u56e0\u5b50\u548c\u76ee\u6807\u56e0\u5b50","text":"<p>\u5bf9\u4e8e\u989c\u8272\u6df7\u5408\u6765\u8bf4\uff0c\u9009\u5b9a\u4e86\u6df7\u5408\u65b9\u7a0b\u5f0f\uff0c\u63a5\u4e0b\u6765\u6700\u91cd\u8981\u7684\u5c31\u662f\u8bbe\u7f6e\u6df7\u5408\u56e0\u5b50\u4e86\u3002</p> <p>\u5728 OpenGL \u4e2d\u9884\u7f6e\u4e86\u4e00\u4e9b\u6df7\u5408\u56e0\u5b50\uff0c\u5982\u4e0b\u8868\uff1a</p> \u5e38\u91cf\u540d RGB \u6df7\u5408\u56e0\u5b50 A \u6df7\u5408\u56e0\u5b50 GL_ZERO \\([0,0,0]\\) 0 GL_ONE \\([1,1,1]\\) 1 GL_SRC_COLOR \\([R_s,G_s,B_s]\\) \\(A_s\\) GL_ONE_MINUS_SRC_COLOR \\([1-R_s,1-G_s,1-B_s]\\) \\(1-As\\) GL_DST_COLOR \\([R_d,G_d,B_d]\\) \\(A_d\\) GL_ONE_MINUS_DST_COLOR \\([1- R_d, 1- G_d, 1- B_d]\\) \\(1-A_d\\) GL_SRC_ALPHA \\([A_s, A_s, A_s]\\) \\(A_s\\) GL_ONE_MINUS_SRC_ ALPHA \\([1- A_s, 1- A_s, 1- A_s]\\) \\(1-As\\) GL_DST_ ALPHA \\([A_d, A_d, A_d]\\) \\(A_d\\) GL_ONE_MINUS_DST_ ALPHA \\([1- A_d, 1- A_d, 1- A_d]\\) \\(1-A_d\\) GL_SRC_ALPHA_SATURATE \\([f , f, f] f=min(A_s, 1-A_d)\\) 1 GL_CONSTANT_COLOR \\([R_c, G_c, B_c]\\) \\(A_c\\) GL_ONE_MINUS_CONSTANT_COLOR \\([1- R_c, 1- G_c, 1- B_c]\\) \\(1-A_c\\) GL_CONSTANT_ALPHA \\([Ac, Ac, Ac]\\) \\(A_c\\) GL_ONE_MINUS_CONSTANT_ALPHA \\([1- Ac, 1- Ac, 1- Ac]\\) \\(1- Ac\\) <p>\u5176\u4e2d\uff0c\u5e38\u91cf\u540d\u79f0\u4e2d\u6709 SRC \u4ee3\u8868\u5404\u901a\u9053\u503c\u6765\u81ea\u6e90\u7247\u5143\uff0c\u6709 DST \u4ee3\u8868\u5404\u901a\u9053\u503c\u6765\u81ea\u76ee\u6807\u7247\u5143\uff0c\u53e6\u5916 GL_SRC_ALPHA_SATURATE \u53ea\u80fd\u7528\u4f5c\u6e90\u56e0\u5b50\u3002</p> <p>\u5bf9\u4e8e\u5e38\u91cf\u540d\u4e2d\u6709 CONSTANT \u7684\u4ee3\u8868\u4f7f\u7528\u9884\u8bbe\u989c\u8272\u5e38\u91cf\u503c\u5bf9\u5e94\u8272\u5f69\u901a\u9053\u7684\u503c\u4f5c\u4e3a\u76f8\u5e94\u7684\u56e0\u5b50\u503c\uff0c\u5176\u4e2d\u7684 \\(R_c\\)\u3001\\(G_c\\)\u3001\\(B_c\\)\u3001\\(A_c\\) \u5206\u522b\u4ee3\u8868\u9884\u8bbe\u989c\u8272\u5e38\u91cf\u503c\u7684 RGBA \u901a\u9053\u7684\u503c\uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u5219\u9ed8\u8ba4\u503c\u4e3a \\([0.0f\u30010.0f\u30010.0f\u30010.0f]\\) \u3002</p> <p>\u8bbe\u7f6e\u989c\u8272\u5e38\u91cf\u503c\u4f7f\u7528\u7684\u662f glBlendColor \u65b9\u6cd5\uff0c\u5982\u4e0b\uff1a</p> <pre><code>    public static native void glBlendColor(\n        float red,\n        float green,\n        float blue,\n        float alpha\n    );\n</code></pre>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_5","title":"\u8bbe\u7f6e\u6df7\u5408\u7684\u65b9\u6cd5","text":"<p>\u6709\u4e86\u6df7\u5408\u56e0\u5b50\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u8bbe\u7f6e\u6df7\u5408\u56e0\u5b50\u4e86\uff0cOpenGL \u63d0\u4f9b\u4e86\u5982\u4e0b\u65b9\u6cd5\u6765\u8bbe\u7f6e\uff1a</p> \u65b9\u6cd5\u7b7e\u540d \u8bf4\u660e glBlendFunc(GLenum sfactor, GLenum dfactor) \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u8bbe\u7f6e\u7684\u6e90\u56e0\u5b50\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u8bbe\u7f6e\u7684\u76ee\u6807\u56e0\u5b50\uff0c\u5176\u503c\u5982\u4e0a\u8868 glBlendFuncSeparate(GLenum srcRGB, GLenum dstRGB, GLenum srcAlpha,GLenum dstAlpha) \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u8bbe\u7f6e\u6e90\u56e0\u5b50\u7684 RGB \u503c\uff1b\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u8bbe\u7f6e\u76ee\u6807\u56e0\u5b50 RGB \u503c\uff1b\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e3a\u8bbe\u7f6e\u6e90\u56e0\u5b50 Alpha \u7684\u503c\uff1b\u7b2c\u56db\u4e2a\u53c2\u6570\u4e3a\u8bbe\u7f6e\u76ee\u6807\u56e0\u5b50 Alpha \u7684\u503c\u3002\u8be5\u65b9\u6cd5\u5b9e\u73b0\u4e86 RGB \u548c Alpha \u901a\u9053\u5355\u72ec\u6307\u5b9a\u6df7\u5408\u56e0\u5b50\u503c\u7684\u529f\u80fd","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_6","title":"\u5e38\u7528\u6df7\u5408\u7ec4\u5408","text":"<p>\u5bf9\u4e8e\u6df7\u5408\u56e0\u5b50\u548c\u6df7\u5408 \u65b9\u7a0b\u5f0f\u7684\u7ec4\u5408\u592a\u591a\u4e86\uff0c\u6070\u5f53\u7684\u7ec4\u5408\u53ef\u4ee5\u4ea7\u751f\u5f88\u597d\u7684\u6548\u679c\uff0c\u4e0b\u9762\u7ed9\u51fa\u4e24\u7ec4\u5e38\u7528\u7684\u7ec4\u5408\uff1a</p> <ul> <li> <p>\u6e90\u56e0\u5b50 GL_SRC_ALPHA \uff0c\u76ee\u6807\u56e0\u5b50 GL_ONE_MINUS_SRC_ALPHA \uff0c\u5373\u6e90\u56e0\u5b50\u548c\u76ee\u6807\u56e0\u5b50\u5206\u522b\u4e3a \\([A_s, A_s, A_s, A_s]\\) \u548c \\([1-A_s, 1-A_s, 1-A_s, 1-A_s]\\) \u3002\u6b64\u7ec4\u5408\u5b9e\u73b0\u7684\u662f\u6700\u5178\u578b\u7684\u534a\u900f\u660e\u906e\u6321\u6548\u679c\u3002\u82e5\u6e90\u7247\u5143\u662f\u900f\u660e\u7684\uff0c\u5219\u6839\u636e\u900f\u660e\u5ea6\u900f\u8fc7\u540e\u9762\u7684\u5185\u5bb9\uff1b\u82e5\u6e90\u7247\u5143\u4e0d\u900f\u660e\uff0c\u5219\u4ec5\u80fd\u770b\u5230\u6e90\u7247\u5143\uff0c\u56e0\u6b64\uff0c\u4f7f\u7528\u6b64\u7ec4\u5408\u65f6\u5f80\u5f80\u4f1a\u91c7\u7528\u534a\u900f\u660e\u7684\u7eb9\u7406\u6216\u989c\u8272\u5bf9\u6e90\u7247\u5143\u7740\u8272\u3002</p> </li> <li> <p>\u6e90\u56e0\u5b50 GL_SRC_COLOR \uff0c\u76ee\u6807\u56e0\u5b50 GL_ONE_MINUS_SRC_COLOR \uff0c\u5373\u6e90\u56e0\u5b50\u548c\u76ee\u6807\u56e0\u5b50\u5206\u522b\u4e3a \\([R_s, G_s, B_s, A_s]\\) \u548c \\([1- R_s, 1- G_s, 1- B_s, 1-A_s\\) \u3002\u6b64\u7ec4\u5408\u53ef\u4ee5\u5b9e\u73b0\u6ee4\u5149\u955c\u6548\u679c\uff0c\u4e5f\u5c31\u662f\u5e73\u65f6\u900f\u8fc7\u6709\u8272\u773c\u955c\u6216\u73bb\u7483\u89c2\u5bdf\u4e8b\u7269\u7684\u611f\u89c9\u3002\u4e0e\u7b2c\u4e00\u79cd\u5e38\u7528\u7ec4\u5408\u4e0d\u540c\uff0c\u6b64\u7ec4\u5408\u4e0d\u8981\u6c42\u5e94\u7528\u4e8e\u6e90\u7247\u5143\u7684\u989c\u8272\u6216\u8005\u7eb9\u7406\u662f\u534a\u900f\u660e\u7684\u3002</p> </li> </ul>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_7","title":"\u5177\u4f53\u4f7f\u7528","text":"<p>\u524d\u9762\u8bb2\u4e86\u8fd9\u4e48\u591a\u7406\u8bba\uff0c\u5176\u5b9e\u5c31\u662f\u9610\u8ff0\u4e24\u4e2a\u989c\u8272\u7684 RGBA \u503c\u5982\u4f55\u8ba1\u7b97\u5f97\u5230\u6700\u540e\u7684 RGBA \u503c\uff0c\u5e76\u4e14\u6bcf\u4e00\u4e2a R\u3001G\u3001B\u3001A \u5206\u91cf\u90fd\u662f\u4e24\u4e2a\u989c\u8272\u7684 R\u3001G\u3001B\u3001A \u5bf9\u5e94\u4e58\u4ee5\u4e0d\u540c\u7684\u6df7\u5408\u56e0\u5b50\u540e\u76f8\u52a0\u5f97\u5230\u7684\uff0c\u8fd9\u4e2a\u6df7\u5408\u56e0\u5b50\u7684\u8bbe\u7f6e\u53ef\u4ee5\u6839\u636e\u6e90\u7247\u5143\u7684\u989c\u8272\u6765\u8bbe\u5b9a\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u76ee\u6807\u7247\u5143\u7684\u989c\u8272\u6765\u8bbe\u5b9a\u3002</p> <p>\u5148\u5047\u8bbe\u6709\u8fd9\u6837\u7684\u573a\u666f\uff1a</p> <p></p> <p>\u901a\u8fc7\u8fd9\u6837\u7684\u56fe\u7247\u7ecf\u8fc7\u6df7\u5408\u540e\u53bb\u67e5\u770b\u540e\u9762\u7684\u5185\u5bb9\uff0c\u7c7b\u4f3c\u4e8e\u523a\u6fc0\u6218\u573a\u4e0a\u5f00\u955c\u6548\u679c\uff0c</p> <p></p> <p>\u663e\u7136\uff0c\u56fe\u7247\u7684\u9ed1\u8272\u533a\u57df\u662f\u8981\u53ef\u4ee5\u900f\u8fc7\u770b\u5230\u540e\u9762\u5185\u5bb9\u7684\uff0c\u7eff\u8272\u533a\u57df\u4e5f\u662f\u4e00\u6837\uff0c\u4e0d\u7136\u5c31\u5168\u906e\u76d6\u4f4f\u540e\u9762\u5185\u5bb9\u4e86\u3002</p> <p>\u8fd9\u91cc\u5c31\u53ef\u4ee5\u7528\u5230\u4e0a\u9762\u7684\u6df7\u5408\u56e0\u5b50\u7ec4\u5408\uff0c\u6e90\u56e0\u5b50 GL_SRC_COLOR\uff0c\u76ee\u6807\u56e0\u5b50 GL_ONE_MINUS_SRC_COLOR \uff0c\u8fd9\u4e2a\u6df7\u5408\u56e0\u5b50\u662f\u6839\u636e\u6e90\u7247\u5143\u7684\u989c\u8272\u6765\u8bbe\u5b9a\u7684\u3002</p> <p>\u6839\u636e\u8fd9\u4e24\u4e2a\u6df7\u5408\u56e0\u5b50\u548c\u6df7\u5408\u65b9\u7a0b\u5f0f\u8ba1\u7b97\uff0c\u53ef\u4ee5\u5f97\u51fa\u6700\u540e\u7684\u989c\u8272\u503c\u3002</p> <p>\u6839\u636e\u6e90\u56e0\u5b50 GL_SRC_COLOR \u8ba1\u7b97\uff0c\u7531\u4e8e\u9ed1\u8272\u7684 RGB \u503c\u90fd\u4e3a 0 \uff0cRGB \u6df7\u5408\u56e0\u5b50\u90fd\u4e3a 0\uff0c\u4e5f\u5c31\u662f\u900f\u660e\u7684\uff0c\u6e90\u7247\u5143\u4e0d\u4f1a\u8fdb\u5165\u5230\u6700\u7ec8\u7247\u5143\u3002</p> <p>\u6839\u636e\u6e90\u56e0\u5b50 GL_ONE_MINUS_SRC_COLOR \u8ba1\u7b97\uff0c\u7531\u4e8e\u9ed1\u8272\u7684 RGB \u503c\u90fd\u4e3a 0 \uff0c\u90a3\u4e48\u76ee\u6807\u989c\u8272\u7684\u6df7\u5408\u56e0\u5b50\u90fd\u4e3a 1\uff0c\u4e5f\u5c31\u662f\u76ee\u6807\u989c\u8272\u90fd\u4f1a\u88ab\u663e\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u540e\u9762\u7684\u7269\u4f53\u3002</p> <p>\u5bf9\u4e8e\u7eff\u8272\u90e8\u5206\uff0c\u5c31\u4e0d\u5b58\u5728\u4e3a0 \u6216\u8005\u4e3a 1 \u7684\u60c5\u51b5\u4e86\uff0c\u5c31\u662f\u4e24\u4e2a\u989c\u8272\u6309\u7167\u6df7\u5408\u56e0\u5b50\u8ba1\u7b97\u540e\u7684\u503c\u4e86\u3002</p> <p>\u5177\u4f53\u7684\u4f7f\u7528\u8fc7\u7a0b\u5f88\u7b80\u5355\uff0c\u5927\u81f4\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>            // \u5148\u7ed8\u5236\u597d\u80cc\u666f\u5185\u5bb9 \n            // \u5f00\u542f\u989c\u8272\u6df7\u5408\u8fdb\u884c\u7ed8\u5236\n            GLES20.glEnable(GLES20.GL_BLEND)\n            // \u8bbe\u7f6e\u6df7\u5408\u56e0\u5b50\n            GLES20.glBlendFunc(GLES20.GL_SRC_COLOR, GLES20.GL_ONE_MINUS_SRC_COLOR)\n            // \u7ed8\u5236\u64cd\u4f5c\n            rect!!.drawSelf(textureId)\n            MatrixState.popMatrix()\n</code></pre> <p>\u6700\u540e\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5f53\u7136\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u53e6\u5916\u4e00\u79cd\u6df7\u5408\u56e0\u5b50\u7ec4\u5408 GL_SRC_ALPHA \u548c GL_ONE_MINUS_SRC_ALPHA\uff0c\u6839\u636e\u6e90\u56e0\u5b50\u7684\u900f\u660e\u5ea6\u6765\u8bbe\u7f6e\u6df7\u5408\u56e0\u5b50\u3002</p> <p>\u5173\u4e8e\u5982\u4f55\u4f7f\u7528 GL_SRC_ALPHA \u548c GL_ONE_MINUS_SRC_ALPHA \u6df7\u5408\u56e0\u5b50\uff0c\u53ef\u4ee5\u53c2\u8003\u4e4b\u524d\u7684\u6587\u7ae0 \u7528 OpenGL \u5bf9\u89c6\u9891\u5e27\u5185\u5bb9\u8fdb\u884c\u66ff\u6362\uff0c\u5927\u6982\u539f\u7406\u90fd\u4e00\u6837\u7684\uff0c\u5c31\u662f\u56fe\u7247\u6362\u6210\u5e26\u900f\u660e\u5ea6\u7684\uff0c\u5e76\u4e14\u66f4\u6539\u4e00\u4e0b\u6df7\u5408\u56e0\u5b50\u7ec4\u5408\uff0c\u5c31\u4e0d\u8d58\u8ff0\u4e86\u3002</p> <p>\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6c42\u4e00\u6ce2 Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_8","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-color-blend/#_9","title":"\u6700\u540e","text":"<p>\u4fd7\u8bdd\u8bf4\uff1a</p> <p>\u72ec\u5b66\u800c\u65e0\u53cb\uff0c\u5219\u5b64\u964b\u800c\u5be1\u95fb</p> <p>\u5b66\u4e60\u7684\u8def\u4e0a\u662f\u9700\u8981\u4ea4\u6d41\u548c\u5206\u4eab\u7684\uff0c\u8fd9\u91cc\u6709\u4e2a\u4e8c\u7ef4\u7801\uff0c\u5982\u679c\u4f60\u5bf9 OpenGL ES \u611f\u5174\u8da3\u6b22\u8fce\u4e00\u8d77\u6765\u4ea4\u6d41\u8ba8\u8bba\u3002</p> <p></p> <p>\u8981\u662f\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u52a0\u5fae\u4fe1 ezglume \u597d\u53cb\uff0c\u5907\u6ce8 OpenGL \uff0c\u62c9\u4f60\u5165\u7fa4~</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/","title":"OpenGL \u5b66\u4e60\u7cfb\u5217\u4e4b\u5750\u6807\u7cfb\u7edf","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/0HZgyZra90LQLFAq6dQJ9A</p> <p>\u5728\u524d\u9762\u7ed8\u5236\u57fa\u672c\u56fe\u5f62\u4e2d\uff0c\u9047\u5230\u4e86\u5f88\u660e\u663e\u7684\u95ee\u9898\uff0c\u5706\u5f62\u4e0d\u50cf\u5706\u5f62\uff0c\u6b63\u591a\u8fb9\u5f62\u4e0d\u50cf\u6b63\u591a\u8fb9\u5f62\uff1f\u5c31\u50cf\u4e0b\u9762\u56fe\u5f62\u4e00\u6837\uff1a</p> <p></p> <p>\u597d\u597d\u7684\u6b63\u4e94\u8fb9\u5f62\u5374\u4e1c\u5012\u897f\u6b6a\u7684\uff0c\u8fd9\u5c31\u662f\u56e0\u4e3a\u6211\u4eec\u524d\u9762\u7684\u7ed8\u5236\u90fd\u662f\u628a\u5b83\u5f53\u6210 \u4e8c\u7ef4 \u7684\u7ed8\u5236\uff0c\u800c\u5728 OpenGL \u4e2d\u5374\u662f\u7ed8\u5236 \u4e09\u7ef4\u7684\u3002\u5728\u4e8c\u7ef4\u548c\u4e09\u7ef4\u4e4b\u95f4\u8fd8\u6709\u4e2a\u8f6c\u6362\uff0c\u800c\u4e4b\u524d\u4e3a\u4e86\u65b9\u4fbf\u5b66\u4e60\u5219\u5ffd\u7565\u4e86\u8fd9\u4e2a\u8f6c\u6362\uff0c\u73b0\u5728\u5c31\u8981\u5f00\u59cb\u7406\u89e3\u5b83\u4e86 \u2014\u2014 <code>\u5750\u6807\u7cfb\u7edf</code>\uff01\uff01</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_1","title":"\u5750\u6807\u7cfb\u7edf","text":"<p>\u5728\u7acb\u4f53\u51e0\u4f55\u7684\u5750\u6807\u7cfb\u91cc\u9762\u5b9a\u4e49\u4e00\u4e2a\u70b9\u7684\u4f4d\u7f6e\uff0c\u9700\u8981 x\u3001y\u3001z \u4e09\u4e2a\u5750\u6807\u8f74\u7684\u503c\uff0c\u800c\u5728 OpenGL \u4e2d\u7ed8\u5236 3D \u7269\u4f53\u4e5f\u662f\u9700\u8981\u7684\u3002</p> <p>\u5728\u7ed8\u5236\u57fa\u672c\u5f62\u72b6\u65f6\uff0c\u53ea\u662f\u5b9a\u4e49\u4e86 x\u3001y \u8f74\u7684\u5750\u6807\uff0c\u8fd9\u6837 z \u8f74\u7684\u5750\u6807\u5c31\u9ed8\u8ba4\u4e3a 0 \u4e86\u3002</p> <p>OpenGL \u5c06\u5b9a\u4e49\u597d\u7684\u5750\u6807\u8f74\u7684\u503c\u8f6c\u6362\u4e3a\u5b9e\u9645\u7ed8\u5236\u7684\u5750\u6807\uff0c\u9700\u8981\u7ecf\u8fc7\u4e94\u4e2a\u5750\u6807\u7cfb\u7edf\u7684\u8f6c\u6362\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p></p> <p>\u8fd9\u91cc\u9762\u6d89\u53ca\u5230\u4e86\u4e94\u4e2a\u5750\u6807\u7a7a\u95f4\u548c\u4e09\u4e2a\u8f6c\u6362\u77e9\u9635\uff1a</p> <p>\u7a7a\u95f4\uff1a</p> <ul> <li>\u5c40\u90e8\u7a7a\u95f4\uff08Local Space\uff09</li> <li>\u4e16\u754c\u7a7a\u95f4\uff08World Space\uff09</li> <li>\u89c2\u5bdf\u7a7a\u95f4\uff08View Space\uff09</li> <li>\u88c1\u526a\u7a7a\u95f4\uff08Clip Space\uff09</li> <li>\u5c4f\u5e55\u7a7a\u95f4\uff08Screen Space\uff09</li> </ul> <p>\u77e9\u9635\uff1a</p> <ul> <li>\u6a21\u578b\u77e9\u9635\uff08Model Matrix\uff09</li> <li>\u89c6\u56fe\u77e9\u9635\uff08View Matrix\uff09</li> <li>\u6295\u5f71\u77e9\u9635\uff08Projection Matrix\uff09</li> </ul> <p>\u6839\u636e\u6d41\u7a0b\u56fe\uff0c\u6bcf\u4e2a\u5750\u6807\u7a7a\u95f4\u7684\u8f6c\u6362\u90fd\u9700\u8981\u4e00\u4e2a\u8f6c\u6362\u77e9\u9635\u6765\u5b8c\u6210\u3002</p> <p>\u6700\u540e\u88c1\u526a\u7a7a\u95f4\u5230\u5c4f\u5e55\u7a7a\u95f4\u7684\u8f6c\u6362\uff0c\u5c31\u662f\u5c06\u7ecf\u8fc7\u8fd9\u4e00\u7cfb\u5217\u8f6c\u6362\u540e\u7684\u5750\u6807\u6620\u5c04\u5230\u5c4f\u5e55\u7684\u5750\u6807\u4e0a\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u5c31\u4e0d\u9700\u8981\u8f6c\u6362\u77e9\u9635\u4e86\u3002</p> <p>\u5728\u8fdb\u5165\u4e0d\u540c\u7684\u5750\u6807\u7a7a\u95f4\u4e4b\u524d\uff0c\u9700\u8981\u5148\u4e86\u89e3 OpenGL \u7684\u5750\u6807\u7cfb\uff1a</p> <p>OpenGL \u662f\u4e00\u4e2a\u53f3\u624b\u5750\u6807\u7cfb\uff0c\u6b63 X \u8f74\u5728\u53f3\u624b\u8fb9\uff0c\u6b63 Y \u8f74\u671d\u4e0a\uff0c\u6b63 Z \u8f74\u7a7f\u8fc7\u5c4f\u5e55\u671d\u5411\u4f60\u3002</p> <p></p> <p></p> <p>\u4e0e\u4e4b\u76f8\u5bf9\u7684\u5c31\u662f\u5de6\u624b\u5750\u6807\u7cfb\uff0c\u5176\u6b63 Z \u8f74\u7a7f\u8fc7\u5c4f\u5e55\u671d\u5411\u91cc\u9762\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_2","title":"\u5c40\u90e8\u7a7a\u95f4","text":"<p>\u5c40\u90e8\u7a7a\u95f4\u5750\u6807\u662f OpenGL \u7ed8\u5236\u5750\u6807\u7684\u8d77\u70b9\uff0c\u63a5\u4e0b\u6765\u6240\u6709\u7684\u8f6c\u6362\u64cd\u4f5c\u90fd\u662f\u5728\u5c40\u90e8\u7a7a\u95f4\u5750\u6807\u57fa\u7840\u4e0a\u8fdb\u884c\u7684\u3002</p> <p>\u5c40\u90e8\u7a7a\u95f4\u5750\u6807\u5c31\u662f\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u7684\u8d77\u59cb\u5750\u6807\u70b9\uff0c\u662f\u76f8\u5bf9\u4e8e\u539f\u70b9 $ (0,0,0) $ \u7684\u3002</p> <p>\u6b64\u65f6\u6240\u5728\u7684\u7a7a\u95f4\u5c31\u662f\u5c40\u90e8\u7a7a\u95f4\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u5728\u5c40\u90e8\u7a7a\u95f4\u91cc\u9762\u5b9a\u4e49\u7269\u4f53\u7684\u8d77\u59cb\u5750\u6807\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_3","title":"\u4e16\u754c\u7a7a\u95f4","text":"<p>\u6211\u4eec\u5b9a\u4e49\u6bcf\u4e00\u4e2a\u5750\u6807\u70b9\u90fd\u662f\u5728\u5c40\u90e8\u7a7a\u95f4\uff0c\u76f8\u5bf9\u4e8e $ (0,0,0) $ \u7684\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5f53\u591a\u4e2a\u7269\u4f53\u540c\u65f6\u7ed8\u5236\u65f6\uff0c\u5c31\u4f1a\u624e\u5806\u4e86\u3002</p> <p>\u800c\u4e16\u754c\u7a7a\u95f4\u5c31\u662f\u5f53\u6240\u6709\u7269\u4f53\u4e00\u8d77\u7ed8\u5236\u3001\u4ecd\u7136\u76f8\u5bf9\u4e8e\u539f\u70b9\u7684\u3001\u66f4\u5927\u7684\u4e00\u4e2a\u5750\u6807\u7cfb\u3002</p> <p>\u5c40\u90e8\u7a7a\u95f4\u548c\u4e16\u754c\u7a7a\u95f4\u6709\u70b9\u76f8\u50cf\uff0c\u53ef\u4ee5\u5728\u5c40\u90e8\u7a7a\u95f4\u5b9a\u4e49\u5750\u6807\u7cfb\u65f6\u5c31\u8003\u8651\u5230\u4e16\u754c\u5750\u6807\u7cfb\uff0c\u907f\u514d\u591a\u4e2a\u7269\u4f53\u7ed8\u5236\u65f6\u51fa\u73b0\u624e\u5806\u73b0\u8c61\u3002</p> <p>\u5f53\u7136\u8fd8\u6709\u66f4\u597d\u7684\u65b9\u6cd5\uff0c\u5c31\u662f\u4f7f\u7528\u6a21\u578b\u77e9\u9635\uff08Model Matrix\uff09\u3002</p> <p>\u4f7f\u7528\u6a21\u578b\u77e9\u9635\uff0c\u53ef\u4ee5\u5bf9\u7269\u4f53\u8fdb\u884c\u4f4d\u79fb\u3001\u7f29\u653e\u3001\u65cb\u8f6c\u3002</p> <p>\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u5c06\u7269\u4f53\u4ece\u5750\u6807\u539f\u70b9\u79fb\u5f00\uff0c\u5e76\u4e14\u8fd8\u80fd\u591f\u8fdb\u884c\u4e00\u4e9b\u76f8\u5173\u64cd\u4f5c\uff0c\u4e0d\u7528\u53bb\u8003\u8651\u5728\u5c40\u90e8\u7a7a\u95f4\u6765\u5b9a\u4e49\u4e16\u754c\u7a7a\u95f4\u7684\u5750\u6807\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_4","title":"\u89c2\u5bdf\u7a7a\u95f4","text":"<p>\u6a2a\u770b\u6210\u5cad\u4fa7\u6210\u5cf0 \u8fdc\u8fd1\u9ad8\u4f4e\u5404\u4e0d\u540c</p> <p>\u5f53\u7269\u4f53\u5728\u4e16\u754c\u7a7a\u95f4\u4e2d\u5c31\u4f4d\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u8981\u8003\u8651\u4ece\u54ea\u4e2a\u65b9\u5411\u548c\u89d2\u5ea6\u6765\u89c2\u5bdf\u7269\u4f53\u4e86\u3002</p> <p>\u89c2\u5bdf\u7a7a\u95f4\uff0c\u53c8\u662f OpenGL \u7684\u6444\u50cf\u673a\uff0c\u662f\u5c06\u4e16\u754c\u7a7a\u95f4\u7684\u5750\u6807\u8f6c\u5316\u4e3a\u6444\u50cf\u673a\u7684\u89c6\u89d2\u6240\u89c2\u5bdf\u5230\u7684\u7a7a\u95f4\u5750\u6807\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u89c2\u5bdf\u7a7a\u95f4\u91cc\uff0c\u5750\u6807\u539f\u70b9\u4e0d\u518d\u662f\u4e16\u754c\u7a7a\u95f4\u7684\u5750\u6807\u539f\u70b9\u4e86\uff0c\u800c\u662f\u4ee5\u6444\u50cf\u673a\u7684\u89c6\u89d2\u4f5c\u4e3a\u573a\u666f\u539f\u70b9\uff0c\u8fd9\u5c31\u4e0d\u518d\u662f\u7b80\u5355\u5730\u8fdb\u884c\u5e73\u79fb\u3001\u65cb\u8f6c\u4e86\uff0c\u800c\u662f\u5207\u6362\u5230\u53e6\u4e00\u79cd\u5750\u6807\u7cfb\u91cc\u3002</p> <p>OpenGL \u672c\u8eab\u662f\u6ca1\u6709\u6444\u50cf\u673a\u7684\u6982\u5ff5\u7684\uff0c\u4e0d\u8fc7\u53ef\u4ee5\u901a\u8fc7\u628a\u573a\u666f\u4e2d\u7684\u6240\u6709\u7269\u4f53\u5f80\u76f8\u53cd\u7684\u65b9\u5411\u79fb\u52a8\u6765\u6a21\u62df\u51fa\u6444\u50cf\u673a\u3002\u8fd9\u6837\u5c31\u573a\u666f\u6ca1\u52a8\uff0c\u800c\u6444\u50cf\u673a\u5728\u79fb\u52a8\u3002</p> <p>\u8981\u5b9a\u4e49\u4e00\u4e2a\u6444\u50cf\u673a\uff0c\u6216\u8005\u8bf4\u8981\u5b9a\u4e49\u4e00\u4e2a\u6444\u50cf\u673a\u89c6\u89d2\u4e3a\u5750\u6807\u539f\u70b9\u7684\u5750\u6807\u7cfb\uff0c\u9700\u8981\uff1a</p> <ul> <li>\u6444\u50cf\u673a\u5728\u4e16\u754c\u7a7a\u95f4\u4e2d\u7684\u4f4d\u7f6e</li> <li>\u6444\u50cf\u673a\u89c2\u5bdf\u7684\u65b9\u5411</li> <li>\u6307\u5411\u6444\u50cf\u673a\u53f3\u6d4b\u7684\u5411\u91cf</li> <li>\u6307\u5411\u6444\u50cf\u673a\u4e0a\u65b9\u7684\u5411\u91cf</li> </ul> <p></p> <p>\u5982\u56fe\uff0c\u6700\u7ec8\u5efa\u7acb\u4e86\u4e00\u4e2a\u4ee5\u6444\u50cf\u673a\u4f4d\u7f6e\u4e3a\u539f\u70b9\u7684\u5750\u6807\u7cfb\u3002</p> <p>\u5176\u4e2d\uff0c\u84dd\u8272\u7bad\u5934\u4e3a\u6444\u50cf\u673a\u5750\u6807\u7cfb\u4e2d\u7684 Z \u8f74\uff0c\u7eff\u8272\u7bad\u5934\u4e3a\u6444\u50cf\u673a\u5750\u6807\u7cfb\u4e2d\u7684 Y \u8f74\uff0c\u7ea2\u8272\u7bad\u5934\u4e3a\u6444\u50cf\u673a\u5750\u6807\u7cfb\u4e2d\u7684 X \u8f74\u3002</p> <p>\u800c\u63a5\u4e0b\u6765\u8981\u505a\u7684\u5c31\u662f\u5c06\u7269\u4f53\u5728\u4e16\u754c\u7a7a\u95f4\u4e2d\u7684\u5750\u6807\u8f6c\u6362\u5230\u4ee5\u6444\u50cf\u673a\u89c6\u89d2\u4e3a\u539f\u70b9\u7684\u89c2\u5bdf\u7a7a\u95f4\u5750\u6807\u4e2d\u3002</p> <p>\u8fd9\u5176\u4e2d\u4e5f\u9700\u8981\u7528\u5230\u4e00\u4e2a\u8f6c\u6362\u77e9\u9635\uff1a\u89c6\u56fe\u77e9\u9635\uff08View Matrix\uff09\u3002\u901a\u8fc7\u89c6\u56fe\u77e9\u9635\u6765\u5207\u6362\u5750\u6807\u7cfb\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_5","title":"\u88c1\u526a\u7a7a\u95f4","text":"<p>\u5f53\u7269\u4f53\u5750\u6807\u90fd\u4f4d\u4e8e\u89c2\u5bdf\u7a7a\u95f4\u540e\uff0c\u63a5\u4e0b\u6765\u8981\u505a\u7684\u5c31\u662f\u88c1\u526a\u3002\u6839\u636e\u6211\u4eec\u7684\u9700\u8981\u6765\u88c1\u526a\u4e00\u5b9a\u8303\u56f4\u5185\u7684\u7269\u4f53\uff0c\u800c\u5728\u8fd9\u4e2a\u8303\u56f4\u4e4b\u5916\u7684\u5750\u6807\u5c31\u4f1a\u88ab\u5ffd\u7565\u6389\u3002</p> <p>\u88c1\u526a\u7a7a\u95f4\u5b9e\u8d28\u4e0a\u8fd8\u662f\u8fdb\u884c\u5750\u6807\u7684\u64cd\u4f5c\u3002</p> <p>\u4ece\u89c2\u5bdf\u7a7a\u95f4\u5230\u88c1\u526a\u7a7a\u95f4\uff0c\u9700\u8981\u7528\u5230\uff1a\u6295\u5f71\u77e9\u9635\uff08Projection Matrix\uff09\u3002</p> <p>\u6295\u5f71\u77e9\u9635\u4f1a\u6307\u5b9a\u4e00\u4e2a\u5750\u6807\u8303\u56f4\uff0c\u8fd9\u4e2a\u8303\u56f4\u5185\u7684\u5750\u6807\u5c06\u53d8\u6362\u4e3a<code>\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807</code> \uff0c\u4e0d\u5728\u8fd9\u4e2a\u8303\u56f4\u5185\u7684\u5750\u6807\u5c31\u4f1a\u88ab\u88c1\u526a\u6389\u3002</p> <p>\u89c2\u5bdf\u7a7a\u95f4\u4e2d\u7684\u5750\u6807\u7ecf\u8fc7\u6295\u5f71\u77e9\u9635\u7684\u53d8\u6362\u4e4b\u540e\u79f0\u4e3a\u6295\u5f71\u5750\u6807\uff0c\u53c8\u53eb\u505a<code>\u88c1\u526a\u5750\u6807</code>\u3002</p> <p>\u8bf4\u662f\u88c1\u526a\u5750\u6807\uff0c\u5176\u5b9e\u662f\u5f85\u88c1\u526a\uff0c\u63a5\u4e0b\u6765\u7684\u88c1\u526a\u8fc7\u7a0b\u5c06\u7531 OpenGL \u6765\u5b8c\u6210\u7684\u3002\u6295\u5f71\u77e9\u9635\u7684\u53d8\u6362\uff0c\u53ea\u662f\u7b5b\u9009\u51fa\u90a3\u4e9b\u4e0d\u9700\u8981\u88ab\u88c1\u526a\u7684\u5750\u6807\u3002</p> <p>\u7531\u6295\u5f71\u77e9\u9635\u521b\u5efa\u7684\u8303\u56f4\uff0c\u662f\u4e00\u4e2a\u5c01\u95ed\u7684\u7a7a\u95f4\u51e0\u4f55\u4f53\uff0c\u88ab\u79f0\u4e3a<code>\u89c6\u666f\u4f53</code>\u3002</p> <p>\u6295\u5f71\u77e9\u9635\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u5f62\u5f0f\uff0c\u521b\u5efa\u7684\u89c6\u666f\u4f53\u4e5f\u6709\u4e24\u79cd\u6837\u5f0f\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_6","title":"\u6b63\u4ea4\u6295\u5f71","text":"<p>\u6b63\u4ea4\u6295\u5f71\u4f1a\u521b\u5efa\u4e00\u4e2a\u7c7b\u4f3c\u7acb\u65b9\u4f53\u7684\u89c6\u666f\u4f53\u3002\u5b83\u7531\u5de6\u3001\u4e0a\u3001\u53f3\u3001\u4e0b \u56db\u4e2a\u65b9\u5411\u8ddd\u79bb\u548c\u8fd1\u5e73\u9762\u8ddd\u79bb\u3001\u8fdc\u5e73\u9762\u8ddd\u79bb\u7ec4\u6210\u3002\u56db\u4e2a\u65b9\u5411\u8ddd\u79bb\u5b9a\u4e49\u4e86\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762\u7684\u5927\u5c0f\u3002\u800c\u5728\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762\u4e4b\u5916\u7684\u5750\u6807\u70b9\u5c31\u4f1a\u88ab\u88c1\u526a\u6389\u4e86\u3002</p> <p></p> <p>\u5728\u573a\u666f\u4e2d\u5904\u4e8e\u89c6\u666f\u4f53\u5185\u7684\u7269\u4f53\u4f1a\u88ab\u6295\u5f71\u5230\u8fd1\u5e73\u9762\u4e0a\uff0c\u7136\u540e\u518d\u5c06\u8fd1\u5e73\u9762\u4e0a\u6295\u5f71\u51fa\u7684\u5185\u5bb9\u6620\u5c04\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>\u5b83\u6240\u7528\u5230\u7684\u77e9\u9635\u662f\u6b63\u4ea4\u6295\u5f71\u77e9\u9635\u3002</p> <p> \u7531\u4e8e\u6b63\u4ea4\u6295\u5f71\u662f\u5e73\u884c\u6295\u5f71\u7684\u4e00\u79cd\uff0c\u5176\u6295\u5f71\u7ebf\u662f\u5e73\u884c\u7684\uff0c\u6240\u4ee5\u6295\u5f71\u5230\u8fd1\u5e73\u9762\u4e0a\u7684\u56fe\u5f62\u4e0d\u4f1a\u4ea7\u751f\u771f\u5b9e\u4e16\u754c\u4e2d\u7684<code>\u8fd1\u5927\u8fdc\u5c0f</code>\u7684\u6548\u679c\u3002\u56e0\u4e3a\u6b63\u4ea4\u6295\u5f71\u6ca1\u6709\u628a\u900f\u89c6\u8003\u8651\u8fdb\u53bb\uff0c\u6240\u4ee5\uff0c\u8fdc\u5904\u7684\u7269\u4f53\u4e0d\u4f1a\u53d8\u5c0f\uff0c\u8fd9\u9002\u7528\u4e8e\u4e00\u4e9b\u7279\u5b9a\u7684\u573a\u5408\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_7","title":"\u900f\u89c6\u6295\u5f71","text":"<p>\u900f\u89c6\u6295\u5f71\u662f\u80fd\u591f\u4ea7\u751f<code>\u8fd1\u5927\u8fdc\u5c0f</code>\u6548\u679c\u7684\uff0c\u5c31\u50cf\u6211\u4eec\u4eba\u773c\u4e00\u6837\uff0c\u770b\u8fdc\u5904\u7684\u7269\u4f53\u5c31\u53d8\u5f97\u5f88\u5c0f\u4e86\u3002</p> <p>\u5b83\u6240\u7528\u5230\u7684\u77e9\u9635\u5c31\u662f\u900f\u89c6\u6295\u5f71\u77e9\u9635\u3002</p> <p></p> <p>\u900f\u89c6\u6295\u5f71\u4e5f\u4f1a\u521b\u5efa\u4e00\u4e2a\u89c6\u666f\u4f53\uff0c\u7c7b\u4f3c\u4e8e\u9525\u5f62\u3002\u5b83\u540c\u6837\u4e5f\u6709\u7740\u8fd1\u5e73\u9762\u8ddd\u79bb\u548c\u8fdc\u5e73\u9762\u8ddd\u79bb\uff0c\u800c\u4e14\u4e5f\u662f\u5c06\u8fd1\u5e73\u9762\u7684\u5185\u5bb9\u6620\u5c04\u5230\u5c4f\u5e55\u89c6\u53e3\u4e2d\uff0c\u4f46\u4e0d\u540c\u4e0e\u6b63\u4ea4\u6295\u5f71\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762\u5927\u5c0f\u76f8\u540c\uff0c\u6240\u4ee5\u5b83\u7684\u5de6\u3001\u4e0a\u3001\u53f3\u3001\u4e0b\u8ddd\u79bb\u90fd\u662f\u76f8\u5bf9\u4e8e\u8fd1\u5e73\u9762\u7684\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u900f\u89c6\u6295\u5f71\u7684\u6295\u5f71\u7ebf\u4e92\u4e0d\u5e73\u884c\uff0c\u90fd\u76f8\u4ea4\u4e8e\u89c6\u70b9\u3002\u56e0\u6b64\uff0c\u540c\u6837\u5c3a\u5bf8\u7684\u7269\u4f53\uff0c\u624d\u4f1a\u8fd1\u5904\u7684\u6295\u5f71\u51fa\u6765\u5927\uff0c\u8fdc\u5904\u7684\u6295\u5f71\u51fa\u6765\u5c0f\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_8","title":"\u900f\u89c6\u9664\u6cd5","text":"<p>\u5f53\u5750\u6807\u7ecf\u8fc7\u6295\u5f71\u77e9\u9635\u7684\u53d8\u6362\u5230\u88c1\u526a\u7a7a\u95f4\u4e4b\u540e\uff0c\u7d27\u63a5\u7740\u5c31\u4f1a\u8fdb\u884c<code>\u900f\u89c6\u9664\u6cd5</code>\u7684\u64cd\u4f5c\u3002</p> <p>\u900f\u89c6\u9664\u6cd5\u662f\u5728\u4e09\u7ef4\u7ed8\u5236\u4e2d\u4ea7\u751f<code>\u8fd1\u5927\u8fdc\u5c0f</code>\u6548\u679c\u975e\u5e38\u5173\u952e\u91cd\u8981\u7684\u4e00\u6b65\u3002</p> <p>\u5728\u6b64\u4e4b\u524d\u8981\u5148\u6765\u4e86\u89e3\u4e00\u4e0b OpenGL \u4e2d\u7684 <code>w \u5206\u91cf</code>\u3002</p> <p>OpenGL \u5750\u6807\u7cfb\u4e2d\u9664\u4e86 x\u3001y\u3001z \u5750\u6807\u5916\uff0c\u8fd8\u6709 w \u5206\u91cf\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u90fd\u662f 1 \u3002\u800c\u7ecf\u8fc7\u900f\u89c6\u6295\u5f71\u53d8\u6362\u4e4b\u540e\uff0cw \u5206\u91cf\u4e0d\u518d\u662f 1 \u4e86\uff0c\u6b63\u4ea4\u6295\u5f71\u4e0d\u6539\u53d8 w \u5206\u91cf\u3002</p> <p>\u800c OpenGL \u8fdb\u884c\u88c1\u526a\uff0c\u5b9e\u8d28\u4e0a\u662f GPU \u8fdb\u884c\u88c1\u526a\u7684\u8fc7\u7a0b\uff0c\u5c31\u662f\u5c06 x\u3001y\u3001z \u5750\u6807\u7684\u7edd\u5bf9\u503c\u4e0e w \u5206\u91cf\u7edd\u5bf9\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u5206\u91cf\u7684\u7edd\u5bf9\u503c\u5927\u4e8e w \u7684\u7edd\u5bf9\u503c\uff0c\u5c31\u8ba4\u4e3a\u4e0d\u5728\u89c6\u666f\u4f53\u5185\uff0c\u4f1a\u88ab\u88c1\u526a\u6389\u3002</p> <p>\u7ecf\u8fc7\u88c1\u526a\u4e4b\u540e\uff0c\u518d\u8fdb\u884c\u900f\u89c6\u9664\u6cd5\u3002\u5c31\u662f\u5c06 x\u3001y\u3001z \u5750\u6807\u5206\u522b\u9664\u4ee5 w \u5206\u91cf\uff0c\u5f97\u5230\u65b0\u7684 x\u3001y\u3001z \u5750\u6807\u3002\u7531\u4e8e x\u3001y\u3001z \u5750\u6807\u7684\u7edd\u5bf9\u503c\u90fd\u5c0f\u4e8e w \u7684\u7edd\u5bf9\u503c\uff0c\u6240\u4ee5\u5f97\u5230\u65b0\u7684\u5750\u6807\u503c\u90fd\u662f\u4f4d\u4e8e $ [-1,1] $ \u7684\u533a\u95f4\u5185\u7684\u3002\u6b64\u65f6\u5f97\u5230\u7684\u5750\u6807\uff0c\u4e5f\u5c31\u662f<code>\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807</code>\u3002</p> <p>\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u662f\u72ec\u7acb\u4e8e\u5c4f\u5e55\u7684\uff0c\u800c\u4e14\u5b83\u7684\u5750\u6807\u7cfb\u7528\u7684\u662f\u5de6\u624b\u5750\u6807\u7cfb\u3002</p> <p>\u7ecf\u8fc7\u900f\u89c6\u6295\u5f71\u77e9\u9635\u53d8\u6362\u4e4b\u540e\uff0c\u6bcf\u4e2a\u5750\u6807\u7684 w \u5206\u91cf\u90fd\u4e0d\u76f8\u540c\u4e86\uff0c\u8fd9\u6837\u518d\u7ecf\u8fc7\u900f\u89c6\u9664\u6cd5\u64cd\u4f5c\uff0c\u5c31\u4f1a\u4f7f\u5f97\u8fdc\u5904\u7684\u7269\u4f53\u770b\u8d77\u6765\u53d8\u5c0f\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_9","title":"\u5c4f\u5e55\u7a7a\u95f4","text":"<p>\u6709\u4e86\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\uff0c\u6700\u540e\u4e00\u6b65\u5c31\u662f\u5c06\u5750\u6807\u6295\u5c04\u5230\u5c4f\u5e55\u4e0a\uff0c\u8fd9\u4e00\u6b65\u662f\u7531 OpenGL \u6765\u5b8c\u6210\u7684\u3002</p> <p>OpenGL \u4f1a\u4f7f\u7528 <code>glViewPort</code> \u51fd\u6570\u6765\u5c06\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u6620\u5c04\u5230\u5c4f\u5e55\u5750\u6807\uff0c\u6bcf\u4e2a\u5750\u6807\u90fd\u5173\u8054\u4e86\u5c4f\u5e55\u4e0a\u7684\u4e00\u4e2a\u70b9\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a<code>\u89c6\u53e3\u53d8\u6362</code>\u3002\u8fd9\u4e00\u6b65\u64cd\u4f5c\u4e0d\u518d\u9700\u8981\u53d8\u6362\u77e9\u9635\u4e86\u3002</p> <p>\u5c31\u8fd9\u6837\uff0c\u4e00\u4e2a\u70b9\u7684\u5750\u6807\u5c31\u5b8c\u6210\u4e86\u4ece\u5c40\u90e8\u7a7a\u95f4\u5750\u6807 <code>$(x,y,z,w)$</code> \u5230\u5c4f\u5e55\u5750\u6807 <code>$(x,y)$</code> \u7684\u8f6c\u53d8\u3002</p> <p>\u7528\u4e00\u5f20\u56fe\u603b\u7ed3\u5982\u4e0b\uff1a</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_10","title":"\u5750\u6807\u7684\u77e9\u9635\u64cd\u4f5c","text":"<p>\u70b9\u7684\u5750\u6807\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u5411\u91cf\uff0c\u7528 <code>$V$</code> \u8868\u793a\uff0c\u800c\u77e9\u9635\u7528 <code>$M$</code> \u8868\u793a\u3002</p> <p>\u90a3\u4e48\uff0c\u4ece \u5c40\u90e8\u7a7a\u95f4 -&gt; \u4e16\u754c\u7a7a\u95f4 -&gt; \u89c2\u5bdf\u7a7a\u95f4 -&gt; \u88c1\u526a\u7a7a\u95f4 \uff0c\u56db\u4e2a\u7a7a\u95f4\u7684\u8f6c\u6362\uff0c\u9700\u8981\u7528\u5230\u4e09\u4e2a\u8f6c\u6362\u77e9\u9635\uff0c\u70b9\u4ece\u67d0\u4e2a\u5750\u6807\u7cfb\u53d8\u6362\u5230\u53e6\u4e00\u4e2a\u5750\u6807\u7cfb\u7684\u65f6\u5019\u90fd\u8981\u5de6\u4e58\u67d0\u4e2a\u53d8\u6362\u77e9\u9635\uff0c\u6700\u540e\u88c1\u526a\u7a7a\u95f4\u7684\u5750\u6807\u53ef\u4ee5\u8868\u793a\u5982\u4e0b\uff1a</p> $$V_{clip}=M_{projection} \\cdot M_{view} \\cdot M_{model} \\cdot V_{local}$$ <p>\u800c\u5728\u7740\u8272\u5668\u811a\u672c\u4e2d\uff0c<code>gl_Position</code> \u5bf9\u5e94\u7684\u4e5f\u662f <code>$V_{clip}$</code>  \u88c1\u526a\u5750\u6807\u3002</p> <p>\u6709\u4e86\u88c1\u526a\u7a7a\u95f4\u5750\u6807\u540e\uff0c\u63a5\u4e0b\u6765\u7684\u4e8b\u60c5\u5c31\u4ea4\u4e2a OpenGL \u53bb\u5b8c\u6210\u88c1\u526a\u548c\u900f\u89c6\u9664\u6cd5\u5c31\u597d\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_11","title":"\u56fe\u5f62\u9002\u5e94\u5bbd\u9ad8\u6bd4","text":"<p>\u5728\u6587\u7ae0\u4e00\u5f00\u59cb\u63d0\u5230\u7684\uff0c\u7ed8\u5236\u7684\u5706\u5f62\u53d8\u6210\u4e86\u692d\u5706\uff0c\u7ed8\u5236\u7684\u6b63\u591a\u8fb9\u5f62\u5374\u4e1c\u5012\u897f\u6b6a\u7684\uff0c\u73b0\u5728\u4e5f\u80fd\u7ed9\u51fa\u539f\u56e0\u4e86\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5c40\u90e8\u7a7a\u95f4\u3001\u4e16\u754c\u7a7a\u95f4\u3001\u89c2\u5bdf\u7a7a\u95f4\u3001\u88c1\u526a\u7a7a\u95f4\u7684\u5750\u6807\u7cfb\u90fd\u662f\u91cd\u5408\u7684\uff0c\u90fd\u662f\u4ee5\\((0,0,0)\\)\u4e3a\u5750\u6807\u539f\u70b9\u3002\u4e00\u5f00\u59cb\u53ea\u662f\u7ed9\u51fa\u4e86\u7406\u60f3\u72b6\u6001\u4e0b\u7684\u5e73\u9762\u5750\u6807\u70b9\uff0c\u5e76\u4e14\u5b9a\u4e49\u7740\u8272\u5668\u811a\u672c\u5982\u4e0b\uff1a</p> <pre><code>attribute vec4 a_Position;\nvoid main(){\n    gl_Position = a_Position;\n}\n</code></pre> <p>\u90a3\u4e48\u5b83\u7ecf\u8fc7\u4e00\u7cfb\u5217\u8f6c\u6362\u540e\uff0c\u6700\u540e OpenGL \u7528\u6765\u88c1\u526a\u7684\u5750\u6807\u8fd8\u662f\u6211\u4eec\u5b9a\u4e49\u7684\u57fa\u4e8e\u5e73\u9762\u7684\u5750\u6807\uff0c\u53ea\u6709\\((x,y)\\)\u503c\uff0c\u800c \\(z\\) \u5750\u6807\u9ed8\u8ba4\u4e3a 0\uff0c\\(w\\) \u5750\u6807\u9ed8\u8ba4\u4e3a 1 \u3002\u7ecf\u8fc7\u900f\u89c6\u9664\u6cd5\u540e\u7684\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u4f9d\u65e7\u662f\\((x,y)\\)\u3002</p> <p>\u800c\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u5047\u5b9a\u7684\u5750\u6807\u7a7a\u95f4\u662f\u4e00\u4e2a\u6b63\u65b9\u5f62\uff0c\u4f46\u624b\u673a\u5c4f\u5e55\u7684\u89c6\u53e3\u5374\u662f\u4e00\u4e2a\u957f\u65b9\u5f62\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u5c31\u4f1a\u6709\u4e00\u4e2a\u65b9\u5411\u88ab\u62c9\u4f38\u3002\u540c\u6837\u7684\u4efd\u6570\uff0c\u4f46\u957f\u5ea6\u8d8a\u957f\uff0c\u5bfc\u81f4\u6bcf\u4e00\u4efd\u7684\u957f\u5ea6\u4e5f\u589e\u52a0\u4e86\uff0c\u6240\u4ee5\u4e5f\u5c31\u88ab\u62c9\u4f38\u4e86\u3002</p> <p></p> <p>\u8981\u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\uff0c\u53ef\u4ee5\u5728\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u4e0a\u8fdb\u884c\u64cd\u4f5c\uff0c\u5c06\u8f83\u957f\u7684\u4e00\u8fb9\u4e58\u4ee5\u76f8\u5e94\u7684\u6bd4\u4f8b\u7cfb\u6570\uff0c\u8f6c\u5316\u5230\u540c\u6837\u7684\u957f\u5ea6\u6bd4\u4e0a\u3002</p> <pre><code>// 1280 * 720 \u7684\u5bbd\u9ad8\u6bd4\naspect =  width / height ;\nx = x * aspect \ny = y \n</code></pre> <p></p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5c06\u8f83\u957f\u7684\u4e00\u8fb9\u7684\u6bd4\u4f8b\u653e\u5927\u4e86\uff0c\u53d6\u8f83\u77ed\u7684\u90a3\u4e00\u8fb9\u4f5c\u4e3a 1 \u7684\u6807\u51c6\u3002</p> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u5750\u6807\u8f6c\u6362\u6210\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u4e4b\u524d\uff0c\u4e5f\u5c31\u662f\u5728\u6295\u5f71\u65f6\u5c31\u628a\u62c9\u4f38\u7684\u60c5\u51b5\u8003\u8651\u8fdb\u53bb\u3002</p> <p>\u4f7f\u7528\u6b63\u4ea4\u6295\u5f71\uff0c\u518d\u5c06\u7269\u4f53\u7684\u5bbd\u9ad8\u6295\u5f71\u5230\u8fd1\u5e73\u9762\u4e0a\u65f6\uff0c\u5c31\u628a\u5c4f\u5e55\u7684\u5bbd\u9ad8\u6bd4\u4f8b\u7cfb\u6570\u8003\u8651\u8fdb\u53bb\uff0c\u8fd9\u6837\u5728\u8f6c\u6362\u6210\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u4e4b\u524d\u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\u56fe\u5f62\u7684\u5bbd\u9ad8\u6bd4\u9002\u5e94\u3002</p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u4fee\u6539\u7740\u8272\u5668\u811a\u672c\u8bed\u8a00\uff0c\u628a\u6295\u5f71\u77e9\u9635\u8003\u8651\u5728\u5185\u3002</p> <pre><code>attribute vec4 a_Position;\nuniform mat4 u_Matrix;\nvoid main(){\n    gl_Position = u_Matrix * a_Position;\n}\n</code></pre> <p>\u5177\u4f53\u5b9e\u64cd\u4e0b\u4e00\u7bc7\u535a\u5ba2\u518d\u5199\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-coordinate-system/#_12","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES \u5e94\u7528\u5f00\u53d1\u5b9e\u8df5\u6307\u5357\u300b</li> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> <li>http://blog.csdn.net/iispring/article/details/27970937</li> </ol> <p>\u5177\u4f53\u4ee3\u7801\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-diffuse-light/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b \u5149\u7167\u7cfb\u5217\u4e4b\u6563\u5c04\u5149","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u4ecb\u7ecd\u4e86 OpenGL \u4e2d\u7684\u73af\u5883\u5149\uff0c\u73b0\u5728\u5c31\u662f\u6563\u5c04\u5149\u4e86\u3002</p> <p>\u6563\u5c04\u5149\u6307\u7684\u662f\u4ece\u7269\u4f53\u8868\u9762\u5411\u5168\u65b9\u4f4d 360\u00b0 \u5747\u5300\u53d1\u5c04\u7684\u5149\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6563\u5c04\u5149\u5177\u4f53\u4ee3\u8868\u7684\u662f\u73b0\u5b9e\u4e16\u754c\u4e2d\u7c97\u7cd9\u7684\u7269\u4f53\u8868\u9762\u88ab\u5149\u7167\u5c04\u65f6\uff0c\u53d1\u5c04\u5149\u5728\u5404\u4e2a\u65b9\u5411\u57fa\u672c\u5747\u5300\u7684\u60c5\u51b5\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u867d\u7136\u53cd\u5c04\u540e\u7684\u6563\u5c04\u5149\u5728\u5404\u4e2a\u65b9\u5411\u662f\u5747\u5300\u7684\uff0c\u4f46\u6563\u5c04\u5149\u53cd\u5c04\u7684\u5f3a\u5ea6\u4e0e\u5165\u5c04\u5149\u7684\u5f3a\u5ea6\u4ee5\u53ca\u5165\u5c04\u7684\u89d2\u5ea6\u5bc6\u5207\u76f8\u5173\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u5149\u6e90\u7684\u4f4d\u7f6e\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u6563\u5c04\u5149\u7684\u6548\u679c\u4f1a\u53d1\u751f\u660e\u663e\u53d8\u5316\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u5f53\u5149\u5782\u76f4\u7167\u5c04\u5230\u7269\u4f53\u8868\u9762\u65f6\u6bd4\u659c\u7167\u65f6\u8981\u4eae\uff0c\u5176\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a</p> <p>\u6563\u5c04\u5149\u7167\u5c04\u7ed3\u679c = \u6750\u8d28\u7684\u53cd\u5c04\u7cfb\u6570 * \u6563\u5c04\u5149\u5f3a\u5ea6 * max(cos(\u5165\u5c04\u89d2)\uff0c0)</p> <p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6563\u5c04\u5149\u7167\u5c04\u7ed3\u679c\u5206\u4e3a\u4e24\u6b65\u8fdb\u884c\uff1a</p> <p>\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6 = \u6563\u5c04\u5149\u5f3a\u5ea6 * max(cos(\u5165\u5c04\u89d2)\uff0c0)</p> <p>\u6563\u5c04\u5149\u7167\u5c04\u7ed3\u679c = \u6750\u8d28\u7684\u53cd\u5c04\u7cfb\u6570 * \u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6</p> <p>\u5176\u4e2d\uff1a\u6750\u8d28\u7684\u53cd\u5c04\u7cfb\u6570\u5b9e\u9645\u6307\u7684\u5c31\u662f\u7269\u4f53\u88ab\u7167\u5c04\u5904\u7684\u989c\u8272\uff0c\u6563\u5c04\u5149\u5f3a\u5ea6\u6307\u7684\u662f\u6563\u5c04\u5149\u4e2d RGB\uff08\u7ea2\u3001\u7eff\u3001\u84dd\uff093 \u4e2a\u8272\u5f69\u901a\u9053\u7684\u5f3a\u5ea6\u3002</p> <p>\u4ece\u516c\u5f0f\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u4e0e\u73af\u5883\u5149\u8ba1\u7b97\u516c\u5f0f\u552f\u4e00\u7684\u533a\u522b\u5c31\u662f\u5f15\u5165\u4e86\u6700\u540e\u4e00\u9879 <code>max(cos(\u5165\u5c04\u89d2)\uff0c0)</code>\uff0c\u8fd9\u4ee3\u8868\u7740\u5165\u5c04\u89d2\u8d8a\u5927\u3001\u53d1\u5c04\u5f3a\u5ea6\u8d8a\u5f31\uff0c\u5f53\u5165\u5c04\u89d2\u7684\u4f59\u5f26\u503c\u4e3a\u8d1f\u65f6\uff08\u5373\u5165\u5c04\u89d2\u5927\u4e8e 90\u00b0\uff09\uff0c\u53cd\u5c04\u5f3a\u5ea6\u4e3a 0 \u3002</p> <p>\u7531\u4e8e\u5165\u5c04\u89d2\u4e3a\u5165\u5c04\u5149\u5411\u91cf\u4e0e\u6cd5\u5411\u91cf\u7684\u5939\u89d2\uff0c\u56e0\u6b64\uff0c\u5176\u4f59\u5f26\u503c\u5e76\u4e0d\u9700\u8981\u8c03\u7528\u4e09\u89d2\u51fd\u6570\u8fdb\u884c\u8ba1\u7b97\uff0c\u53ea\u9700\u8981\u5c06\u4e24\u4e2a\u5411\u91cf\u5f52\u4e00\u5316\uff0c\u7136\u540e\u8fdb\u884c\u70b9\u79ef\u8ba1\u7b97\u5c31\u53ef\u4ee5\u5f97\u51fa\u4f59\u5f26\u503c\u3002</p> <p></p> <p>\u56fe\u4e2d\u7684 N \u4ee3\u8868\u88ab\u7167\u5c04\u70b9\u8868\u9762\u7684\u6cd5\u5411\u91cf\uff0cP \u4e3a\u88ab\u7167\u5c04\u70b9\uff0cL \u4e3a\u4ece P \u70b9\u5230\u5149\u6e90\u7684\u5411\u91cf\uff0cN \u4e0e L \u7684\u5939\u89d2\u5373\u4e3a\u5165\u5c04\u89d2\u3002</p> <p>\u5173\u4e8e\u70b9\u79ef\uff1a\u5728\u6570\u5b66\u4e2d\uff0c\u4e24\u4e2a\u5411\u91cf\u7684\u70b9\u4e58\u4e3a\u4e24\u4e2a\u5411\u91cf\u5939\u89d2\u7684\u4f59\u5f26\u503c\u4e58\u4ee5\u4e24\u4e2a\u5411\u91cf\u7684\u6a21</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-diffuse-light/#_1","title":"\u5b9e\u8df5","text":"<p>\u52a0\u5165\u6563\u5c04\u5149\u5bf9\u7a0b\u5e8f\u7684\u5f71\u54cd\u4e3b\u8981\u8fd8\u662f\u5728\u7740\u8272\u5668\u4ee3\u7801\u4e0a\u3002</p> <p>\u5bf9\u4e8e\u7247\u6bb5\u7740\u8272\u5668\uff0c\u53d8\u5316\u4e0d\u4f1a\u592a\u5927\uff0c\u56e0\u4e3a\u6700\u7ec8\u7684\u90fd\u662f\u7269\u4f53\u672c\u8eab\u7684\u989c\u8272\u4e58\u4ee5\u6563\u5c04\u5149\u6700\u7ec8\u7684\u7167\u5c04\u7ed3\u679c\uff0c\u8fd9\u4e2a\u7ed3\u679c\u53ef\u4ee5\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u8ba1\u7b97\u597d\uff0c\u76f4\u63a5\u4f20\u9012\u7ed9\u7247\u6bb5\u7740\u8272\u5668\u3002</p> <pre><code>#version 300 es\nprecision mediump float;\nuniform float uR;\nin vec3 vPosition;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u9876\u70b9\u4f4d\u7f6e\nin vec4 vDiffuse;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\nout vec4 fragColor;\nvoid main()\n{\n   // \u7701\u7565\u4e00\u4e9b\u4ee3\u7801\n   //\u6700\u7ec8\u989c\u8272\n   vec4 finalColor=vec4(color,0);\n   //\u6839\u636e\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\u8ba1\u7b97\u7247\u5143\u7684\u6700\u7ec8\u989c\u8272\u503c\n   fragColor=finalColor*vDiffuse;\n}\n</code></pre> <p>\u91cd\u70b9\u5c31\u5728\u4e8e\u9876\u70b9\u7740\u8272\u5668\u91cc\u9762\u4e86\uff0c\u9664\u4e86\u4ee5\u5f80\u7684\u4ee3\u7801\u4e4b\u5916\uff0c\u6839\u636e\u6563\u5c04\u5149\u7684\u8ba1\u7b97\u516c\u5f0f\uff0c\u6211\u4eec\u8fd8\u9700\u6dfb\u52a0\u4e00\u4e9b\u65b0\u7684\u53d8\u91cf\uff0c\u6bd4\u5982\uff1a\u5149\u6e90\u7684\u4f4d\u7f6e\u3002\u4e0d\u540c\u5149\u6e90\u4f4d\u7f6e\u7684\u7167\u5c04\u7ed3\u679c\u4e0d\u540c\u3002</p> <p>\u5177\u4f53\u7684\u7740\u8272\u5668\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>#version 300 es\nuniform mat4 uMVPMatrix;                        //\u603b\u53d8\u6362\u77e9\u9635\nuniform mat4 uMMatrix;                          //\u53d8\u6362\u77e9\u9635(\u5305\u62ec\u5e73\u79fb\u3001\u65cb\u8f6c\u3001\u7f29\u653e)\nuniform vec3 uLightLocation;                        //\u5149\u6e90\u4f4d\u7f6e\nin vec3 aPosition;                          //\u9876\u70b9\u4f4d\u7f6e\nin vec3 aNormal;                            //\u9876\u70b9\u6cd5\u5411\u91cf\nout vec3 vPosition;                         //\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u9876\u70b9\u4f4d\u7f6e\nout vec4 vDiffuse;                          //\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u6563\u5c04\u5149\u5206\u91cf\nvoid pointLight (                               //\u6563\u5c04\u5149\u5149\u7167\u8ba1\u7b97\u7684\u65b9\u6cd5\n  in vec3 normal,                               //\u6cd5\u5411\u91cf\n  inout vec4 diffuse,                               //\u6563\u5c04\u5149\u8ba1\u7b97\u7ed3\u679c\n  in vec3 lightLocation,                            //\u5149\u6e90\u4f4d\u7f6e\n  in vec4 lightDiffuse                          //\u6563\u5c04\u5149\u5f3a\u5ea6\n){\n  vec3 normalTarget=aPosition+normal;                   //\u8ba1\u7b97\u53d8\u6362\u540e\u7684\u6cd5\u5411\u91cf\n  vec3 newNormal=(uMMatrix*vec4(normalTarget,1)).xyz-(uMMatrix*vec4(aPosition,1)).xyz;\n  newNormal=normalize(newNormal);                   //\u5bf9\u6cd5\u5411\u91cf\u5f52\u4e00\u5316\n//\u8ba1\u7b97\u4ece\u8868\u9762\u70b9\u5230\u5149\u6e90\u4f4d\u7f6e\u7684\u5411\u91cfvp\n  vec3 vp= normalize(lightLocation-(uMMatrix*vec4(aPosition,1)).xyz);\n  vp=normalize(vp);                                 //\u5f52\u4e00\u5316vp\n  float nDotViewPosition=max(0.0,dot(newNormal,vp));    //\u6c42\u6cd5\u5411\u91cf\u4e0evp\u5411\u91cf\u7684\u70b9\u79ef\u4e0e0\u7684\u6700\u5927\u503c\n  diffuse=lightDiffuse*nDotViewPosition;            //\u8ba1\u7b97\u6563\u5c04\u5149\u7684\u6700\u7ec8\u5f3a\u5ea6\n}\nvoid main(){\n   gl_Position = uMVPMatrix * vec4(aPosition,1);    //\u6839\u636e\u603b\u53d8\u6362\u77e9\u9635\u8ba1\u7b97\u6b64\u6b21\u7ed8\u5236\u6b64\u9876\u70b9\u7684\u4f4d\u7f6e\n   vec4 diffuseTemp=vec4(0.0,0.0,0.0,0.0);\n   pointLight(normalize(aNormal), diffuseTemp, uLightLocation, vec4(0.8,0.8,0.8,1.0));\n   vDiffuse=diffuseTemp;                    //\u5c06\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n   vPosition = aPosition;                   //\u5c06\u9876\u70b9\u7684\u4f4d\u7f6e\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n}\n</code></pre> <p>\u9996\u5148\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u6765\u8ba1\u7b97\u6563\u5c04\u5149\u7684\u6700\u7ec8\u5f3a\u5ea6\u3002</p> <p>\u6563\u5c04\u5149\u7684\u6700\u7ec8\u5f3a\u5ea6 =  \u6563\u5c04\u5149\u5f3a\u5ea6 * max(cos(\u5165\u5c04\u89d2)\uff0c0) \u3002</p> <p>\u6839\u636e\u6b64\u516c\u5f0f\uff0c\u6563\u5c04\u5149\u5f3a\u5ea6\u81ea\u5df1\u8bbe\u5b9a\u4e3a <code>vec4(0.8,0.8,0.8,1.0)</code>\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u8981\u505a\u7684\u5c31\u662f\u8ba1\u7b97\u5165\u5c04\u5149\u5411\u91cf\u548c\u6cd5\u5411\u91cf\u4e4b\u95f4\u7684\u5939\u89d2\uff0c\u6839\u636e\u70b9\u4e58\u516c\u5f0f\u8fdb\u884c\u8ba1\u7b97\uff1a</p> <p>\u7531\u4e8e\u5728\u4e16\u754c\u6a21\u578b\u91cc\uff0c\u70b9\u7684\u4f4d\u7f6e\u4f1a\u53d1\u751f\u79fb\u52a8\uff0c\u6240\u4ee5\u4e5f\u8981\u628a\u6cd5\u5411\u91cf\u8fdb\u884c\u79fb\u52a8\u5230\u5f53\u524d\u7684\u89c2\u5bdf\u5750\u6807\u4e0b\uff1a</p> <pre><code>  vec3 normalTarget=aPosition+normal;                   //\u8ba1\u7b97\u53d8\u6362\u540e\u7684\u6cd5\u5411\u91cf\n  vec3 newNormal=(uMMatrix*vec4(normalTarget,1)).xyz-(uMMatrix*vec4(aPosition,1)).xyz;\n</code></pre> <p>\u7136\u540e\u628a\u6cd5\u5411\u91cf\u8fdb\u884c\u5f52\u4e00\u5316\uff1a</p> <pre><code>  newNormal=normalize(newNormal);                   //\u5bf9\u6cd5\u5411\u91cf\u5f52\u4e00\u5316\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7528\u5230\u5149\u6e90\u7684\u4f4d\u7f6e\u4e86\uff0c\u8ba1\u7b97\u5165\u5c04\u5149\u5411\u91cf\u5e76\u8fdb\u884c\u5f52\u4e00\u5316\u3002</p> <pre><code>  vec3 vp= normalize(lightLocation-(uMMatrix*vec4(aPosition,1)).xyz);\n</code></pre> <p>\u6700\u540e\u5c31\u662f\u8ba1\u7b97\u4f59\u5f26\u503c\u3002</p> <pre><code>  float nDotViewPosition=max(0.0,dot(newNormal,vp));    //\u6c42\u6cd5\u5411\u91cf\u4e0evp\u5411\u91cf\u7684\u70b9\u79ef\u4e0e0\u7684\u6700\u5927\u503c\n</code></pre> <p>\u5f97\u5230\u4e86\u4f59\u5f26\u503c\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u6563\u5c04\u5149\u7684\u6700\u7ec8\u5f3a\u5ea6\u4e86\uff0c\u6709\u4e86\u6700\u7ec8\u5f3a\u5ea6\u76f4\u63a5\u4f20\u9012\u7ed9\u7247\u6bb5\u7740\u8272\u5668\u8fdb\u884c\u8ba1\u7b97\u5c31\u65b9\u4fbf\u591a\u4e86\u3002</p> <p>\u5177\u4f53\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u62d6\u6ed1\u52a8\u6761\u6539\u53d8\u5149\u6e90\u7684\u4f4d\u7f6e\uff0c\u660e\u663e\u770b\u5230\u5149\u6e90\u4e0d\u540c\u5f97\u5230\u7684\u7167\u5c04\u7ed3\u679c\u4e5f\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u5177\u4f53\u7684\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6c42\u4e00\u6ce2 Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-diffuse-light/#_2","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-basic-shape/","title":"OpenGL \u5b66\u4e60\u7cfb\u5217\u4e4b\u57fa\u672c\u5f62\u72b6\u7684\u7ed8\u5236","text":"<p>\u5728\u4e4b\u524d\u7684\u4e00\u7bc7\u535a\u5ba2\u4e2d\uff0c\u8bb2\u8ff0\u4e86 OpenGL \u7ed8\u5236\u4e00\u4e2a\u70b9\u7684\u6d41\u7a0b\u53ca\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u5176\u4e2d\u5173\u4e8e OpenGL \u7a0b\u5e8f\u7f16\u8bd1\u90e8\u5206\u90fd\u662f\u53ef\u4ee5\u5728\u5176\u4ed6\u9879\u76ee\u4e2d\u63a5\u7740\u590d\u7528\u7684\uff0c\u63a5\u4e0b\u6765\u4f1a\u8bb2\u5230\u5982\u4f55\u53bb\u7ed8\u5236\u5176\u4ed6\u7684\u57fa\u672c\u56fe\u5143\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-basic-shape/#_1","title":"\u7ed8\u5236\u76f4\u7ebf","text":"<p>\u4e24\u70b9\u786e\u5b9a\u4e00\u6761\u76f4\u7ebf\uff0c\u663e\u7136\u7ed8\u5236\u4e00\u6761\u76f4\u7ebf\u662f\u9700\u8981\u4e24\u4e2a\u9876\u70b9\u6570\u636e\u7684\u3002</p> <p>\u5b9a\u4e49\u5982\u4e0b\u9876\u70b9\u6570\u636e\uff0c\u7ed8\u5236\u4e00\u6761\u5c4f\u5e55\u5bf9\u89d2\u7ebf\u7684\u76f4\u7ebf\uff1a</p> <pre><code>    float[] lineVertex = {\n            -0.5f, 0.5f,\n            0.5f, -0.5f\n    };\n</code></pre> <p>\u800c\u6211\u4eec\u7684\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\u4e5f\u4f1a\u53d1\u751f\u4e00\u4e9b\u53d8\u5316\uff0c\u6700\u7ec8\u8fd8\u662f\u7ed8\u5236\u4e00\u6761\u5355\u4e00\u989c\u8272\u7684\u76f4\u7ebf\u3002</p> <p>\u9876\u70b9\u7740\u8272\u5668\u4ee3\u7801\uff1a <pre><code>attribute vec4 a_Position;\nvoid main(){\n    gl_Position = a_Position;\n}\n</code></pre></p> <p>\u7531\u4e8e\u662f\u7ed8\u5236\u7684\u76f4\u7ebf\uff0c\u76f8\u6bd4\u4e8e\u7ed8\u5236\u70b9\uff0c\u5c31\u6ca1\u6709\u4e86 <code>gl_PointSize</code>\u53d8\u91cf\u6765\u786e\u5b9a\u5927\u5c0f\u4e86\u3002</p> <p>\u7247\u6bb5\u7740\u8272\u5668\u4ee3\u7801\uff1a</p> <pre><code>precision mediump float;\nuniform vec4 u_Color;\nvoid main()\n{\n    gl_FragColor = u_Color;\n}\n</code></pre> <p>\u4f9d\u65e7\u662f\u7eaf\u8272\uff0c\u76ee\u524d\u8fd8\u6ca1\u6709\u6d89\u53ca\u5230\u989c\u8272\u7684\u53d8\u5316\u3002</p> <p>\u800c\u5728\u6211\u4eec\u7ed9\u7740\u8272\u5668\u53d8\u91cf\u7ed1\u5b9a\u6570\u636e\u65f6\uff0c\u4f9d\u65e7\u662f\u901a\u8fc7<code>glGetUniformLocation</code>\u548c<code>glGetAttribLocation</code>\u65b9\u6cd5\u7ed9<code>uniform</code>\u548c<code>attribute</code>\u7c7b\u578b\u7684<code>u_Color</code>\u548c<code>a_Position</code>\u53d8\u91cf\u8d4b\u503c\u3002</p> <p>\u6700\u540e\u8fd8\u662f\u901a\u8fc7<code>glDrawArrays</code>\u65b9\u6cd5\u6267\u884c\u7ed8\u5236\u3002</p> <pre><code>glDrawArrays(GL_LINES, 0, 2);\n</code></pre> <p><code>GL_LINES</code>\u4ee3\u8868\u7ed8\u5236\u7684\u7c7b\u578b\u662f\u76f4\u7ebf\uff0c\u800c<code>0\uff0c2</code>\u5219\u662f\u7ed8\u5236\u7684\u9876\u70b9\u8303\u56f4\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-basic-shape/#_2","title":"\u7ed8\u5236\u4e09\u89d2\u5f62","text":"<p>\u7ed8\u5236\u4e09\u89d2\u5f62\u548c\u7ed8\u5236\u76f4\u7ebf\u57fa\u672c\u5dee\u4e0d\u591a\uff0c\u4ece\u4e24\u4e2a\u70b9\u7684\u76f4\u7ebf\u53d8\u6210\u4e86\u4e09\u4e2a\u70b9\u7684\u4e09\u89d2\u5f62\u3002</p> <p>\u9876\u70b9\u6570\u636e\u4e5f\u53d1\u751f\u4e86\u76f8\u5e94\u7684\u6539\u52a8\uff0c\u5047\u8bbe\u5982\u4e0b\u7684\u6570\u636e\uff0c\u6ce8\u610f\u8981\u4ee5\u9006\u65f6\u9488\u5b9a\u4e49\u6570\u636e\u3002</p> <pre><code>    float[] triangleVertex = {\n            -0.5f, 0.5f,\n            -0.5f, -0.5f,\n            0.5f, -0.5f\n    };\n</code></pre> <p>\u90a3\u4e48\u6700\u540e\u7ed8\u5236\u65f6\uff0c\u7ed8\u5236\u7c7b\u578b\u4e5f\u4f1a\u53d1\u751f\u53d8\u5316\u4e86\uff0c\u9876\u70b9\u4e2a\u6570\u8303\u56f4\u4e5f\u4f1a\u53d8\u5316\u3002</p> <pre><code> glDrawArrays(GL_TRIANGLES, 0, 3);\n</code></pre> <p>\u7ed8\u5236\u4e09\u89d2\u5f62\u7ed3\u679c\u5982\u56fe\uff1a</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-basic-shape/#_3","title":"\u7ed8\u5236\u77e9\u5f62","text":"<p>\u663e\u7136\uff0cOpenGL \u662f\u6ca1\u6709\u63d0\u4f9b\u77e9\u5f62\u8fd9\u4e00\u57fa\u672c\u56fe\u5143\u7684\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u7528\u4e24\u4e2a\u4e09\u89d2\u5f62\u6765\u62fc\u63a5\u6210\u4e00\u4e2a\u77e9\u5f62\u3002</p> <p>OpenGL \u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7ed8\u5236\u7c7b\u578b\u53eb\u505a<code>\u4e09\u89d2\u5f62\u6247</code>\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5728\u4e0a\u56fe\u4e2d\uff0c\u77e9\u5f62\u7684\u6bcf\u4e00\u6761\u8fb9\u4e0a\u7684\u9876\u70b9\u90fd\u88ab\u4e24\u4e2a\u4e09\u89d2\u5f62\u4f7f\u7528\u4e86\uff0c\u800c\u4e14\u4e2d\u5fc3\u7684\u9876\u70b9\u88ab\u6240\u6709\u56db\u4e2a\u4e09\u89d2\u5f62\u4f7f\u7528\u4e86\u3002</p> <p>\u6211\u4eec\u4e0d\u5fc5\u8f93\u5165\u56db\u4e2a\u4e09\u89d2\u5f62\u7684\u9876\u70b9\u6570\u636e\u6765\u7ed8\u5236\u56db\u4e2a\u4e09\u89d2\u5f62\u4ece\u800c\u7ec4\u6210\u77e9\u5f62\uff0c\u53ef\u4ee5\u544a\u8bc9 OpenGL \u91cd\u7528\u90a3\u4e9b\u9876\u70b9\u6570\u636e\uff0c\u628a\u8fd9\u4e9b\u9876\u70b9\u4f5c\u4e3a\u4e00\u4e2a\u4e09\u89d2\u5f62\u6247\u7ed8\u5236\u3002</p> <p>\u4e00\u4e2a\u4e09\u89d2\u5f62\u6247\u4ee5\u4e00\u4e2a\u4e2d\u5fc3\u9876\u70b9\u4f5c\u4e3a\u8d77\u59cb\uff0c\u4f7f\u7528\u76f8\u90bb\u7684\u4e24\u4e2a\u9876\u70b9\u521b\u5efa\u7b2c\u4e00\u4e2a\u4e09\u89d2\u5f62\uff0c\u63a5\u4e0b\u6765\u7684\u6bcf\u4e2a\u9876\u70b9\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e09\u89d2\u5f62\uff0c\u56f4\u7ed5\u8d77\u59cb\u7684\u4e2d\u5fc3\u70b9\u6309\u6247\u5f62\u5c55\u5f00\uff0c\u4e3a\u4e86\u4f7f\u6247\u5f62\u95ed\u5408\uff0c\u6211\u4eec\u9700\u8981\u5728\u6700\u540e\u91cd\u590d\u7b2c\u4e8c\u4e2a\u70b9\u3002</p> <p>\u6240\u4ee5\uff0c\u4ee5\u4e09\u89d2\u5f62\u6247\u7684\u5f62\u5f0f\u7ed8\u5236\u4e00\u4e2a\u77e9\u5f62\uff0c\u6211\u4eec\u53ef\u4ee5\u91cd\u65b0\u5b9a\u4e49\u77e9\u5f62\u7684\u9876\u70b9\u6570\u636e\uff1a</p> <pre><code>   float[] rectangleVertex = {\n           // \u7b2c\u4e00\u4e2a\u70b9\u5c31\u662f\u4e09\u89d2\u5f62\u6247\u7684\u4e2d\u5fc3\u70b9\n            0f,    0f, \n            -0.5f, -0.8f,   \n            0.5f, -0.8f,   \n            0.5f,  0.8f,   \n            -0.5f,  0.8f,   \n            -0.5f, -0.8f\n          // \u91cd\u590d\u7b2c\u4e8c\u4e2a\u70b9\uff0c\u4f7f\u4e09\u89d2\u5f62\u6247\u95ed\u5408\n    };\n</code></pre> <p>\u800c\u7740\u8272\u5668\u4ee3\u7801\u4f9d\u65e7\u4e0d\u53d8\uff0c\u7ed8\u5236\u4e00\u4e2a\u7eaf\u8272\u7684\u77e9\u5f62\uff0c\u7ed8\u5236\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>  glDrawArrays(GL_TRIANGLE_FAN, 0, 6);\n</code></pre> <p>\u7ed8\u5236\u7c7b\u578b\u4e3a<code>GL_TRIANGLE_FAN</code>\uff0c\u9876\u70b9\u6570\u91cf\u4e5f\u53d8\u6210\u4e86 6 \u4e2a\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0cOpenGL \u5230\u5e95\u4e3a\u6211\u4eec\u63d0\u4f9b\u54ea\u4e9b\u7ed8\u5236\u65b9\u5f0f\u5462\uff1f\u5982\u4e0b\u8868\u6240\u793a\uff1a</p> \u7ed8\u5236\u7c7b\u578b \u7ed8\u5236\u65b9\u5f0f GL_POINTS \u5c06\u4f20\u5165\u7684\u9876\u70b9\u5750\u6807\u4f5c\u4e3a\u5355\u72ec\u7684\u70b9\u7ed8\u5236 GL_LINES \u5c06\u4f20\u5165\u7684\u5750\u6807\u4f5c\u4e3a\u5355\u72ec\u7ebf\u6761\u7ed8\u5236\uff0cABCDEFG\u516d\u4e2a\u9876\u70b9\uff0c\u7ed8\u5236AB\u3001CD\u3001EF\u4e09\u6761\u7ebf GL_LINE_STRIP \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u6298\u7ebf\u7ed8\u5236\uff0cABCD\u56db\u4e2a\u9876\u70b9\uff0c\u7ed8\u5236AB\u3001BC\u3001CD\u4e09\u6761\u7ebf GL_LINE_LOOP \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u95ed\u5408\u6298\u7ebf\u7ed8\u5236\uff0cABCD\u56db\u4e2a\u9876\u70b9\uff0c\u7ed8\u5236AB\u3001BC\u3001CD\u3001DA\u56db\u6761\u7ebf\u3002 GL_TRIANGLES \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u5355\u72ec\u7684\u4e09\u89d2\u5f62\u7ed8\u5236\uff0cABCDEF\u7ed8\u5236ABC,DEF\u4e24\u4e2a\u4e09\u89d2\u5f62 GL_TRIANGLE_STRIP \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u4e09\u89d2\u6761\u5e26\u7ed8\u5236\uff0cABCDEF\u7ed8\u5236ABC,BCD,CDE,DEF\u56db\u4e2a\u4e09\u89d2\u5f62 GL_TRIANGLE_FAN \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u6247\u9762\u7ed8\u5236\uff0cABCDEF\u7ed8\u5236ABC\u3001ACD\u3001ADE\u3001AEF\u56db\u4e2a\u4e09\u89d2\u5f62","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-basic-shape/#_4","title":"\u7ed8\u5236\u5706\u5f62","text":"<p>\u73b0\u5728\u6211\u4eec\u8981\u7ed8\u5236\u4e00\u4e2a\u5706\u5f62\uff0c\u663e\u7136 OpenGL \u662f\u6ca1\u6709\u63d0\u4f9b\u5706\u5f62\u7684\u7ed8\u5236\u7c7b\u578b\u7684\uff0c\u8fd9\u5c31\u8981\u7528\u5230\u4e0a\u9762\u63d0\u4f9b\u7684\u7ed8\u5236\u65b9\u5f0f\u4e86\u3002</p> <p>\u4ee5\u7ed8\u5236\u4e00\u4e2a\u5b9e\u5fc3\u7684\u5706\u5f62\u4e3a\u4f8b\u5b50\uff1a</p> <p>\u6709\u4e86\u4e0a\u9762<code>\u4e09\u89d2\u5f62\u6247\u7ed8</code>\u5236\u77e9\u5f62\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u6309\u7167\u540c\u6837\u7684\u601d\u60f3\uff0c\u628a\u4e00\u4e2a\u5706\u5f62\u5206\u6210\u591a\u4e2a\u4e09\u89d2\u5f62\u7ec4\u6210\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6211\u4eec\u5206\u7684\u4e09\u89d2\u5f62\u8d8a\u591a\uff0c\u4e09\u89d2\u5f62\u4e2a\u6570\u8d8b\u5411\u4e8e\u65e0\u9650\u5927\u7684\u65f6\u5019\uff0c\u6574\u4e2a\u56fe\u6848\u4e5f\u5c31\u8d8a\u8d8b\u5411\u4e8e\u5706\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u9876\u70b9\u6570\u636e\u5c31\u4e0d\u80fd\u518d\u9760\u624b\u5199\u4e86\u3002</p> <pre><code>    // \u5706\u5f62\u5206\u5272\u7684\u6570\u91cf\uff0c\u5206\u6210 360 \u4efd\uff0c\u53ef\u7531 360 \u4e2a\u7ebf\u6bb5\u7ec4\u6210\u7a7a\u5fc3\u5706\uff0c\u4e5f\u53ef\u4ee5\u7531 360 \u4e2a\u4e09\u89d2\u5f62\u7ec4\u6210\u5b9e\u5fc3\u5706\n    public static final int VERTEX_DATA_NUM = 360;\n    // 360 \u4e2a\u9876\u70b9\u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u6709 x \u548c y \u5750\u6807\uff0c\u6240\u4ee5 double \u4e00\u4e0b\uff0c\u518d\u52a0\u4e0a\u4e2d\u5fc3\u70b9 \u548c \u95ed\u5408\u7684\u70b9\n    float[] circleVertex = new float[VERTEX_DATA_NUM * 2 + 4];\n    // \u5206\u6210 360 \u4efd\uff0c\u6bcf\u4e00\u4efd\u7684\u5f27\u5ea6\n    float radian = (float) (2 * Math.PI / VERTEX_DATA_NUM);\n    // \u7ed8\u5236\u7684\u534a\u5f84\n    float radius = 0.8f;\n\n    // \u521d\u59cb\u5316\u5706\u5f62\u7684\u9876\u70b9\u6570\u636e\n    private void initVertexData() {\n        // \u4e2d\u5fc3\u70b9\n        circleVertex[0] = 0f;\n        circleVertex[1] = 0f;\n        // \u5706\u7684 360 \u4efd\u7684\u9876\u70b9\u6570\u636e\n        for (int i = 0; i &lt; VERTEX_DATA_NUM; i++) {\n            circleVertex[2 * i + 2] = (float) (radius * Math.cos(radian * i));\n            circleVertex[2 * i + 1 + 2] = (float) (radius * Math.sin(radian * i));\n        }\n        // \u95ed\u5408\u70b9\n        circleVertex[VERTEX_DATA_NUM * 2 + 2] = (float) (radius * Math.cos(radian));\n        circleVertex[VERTEX_DATA_NUM * 2 + 3] = (float) (radius * Math.sin(radian));\n    }\n</code></pre> <p>\u628a\u5706\u5206\u6210\u4e86 360 \u4efd\u3002\u5706\u5f62\u7684\u9876\u70b9\u6570\u636e\u4e5f\u5206\u4e3a\u4e86\u4e09\u90e8\u5206\u4e86\uff0c\u4ee5\u539f\u5fc3\u4f5c\u4e3a\u6211\u4eec\u7684\u4e2d\u5fc3\u70b9\uff0c\u4e2d\u95f4\u7684 360 \u4e2a\u70b9\u7528\u6765\u7ed8\u5236\u4e09\u89d2\u5f62\uff0c\u6700\u540e\u4e00\u4e2a\u70b9\u4f7f\u5f97\u6211\u4eec\u7684\u56fe\u5f62\u95ed\u5408\u3002</p> <p>\u5728\u7ed8\u5236\u65f6\u4f9d\u65e7\u4f7f\u7528\u4e09\u89d2\u5f62\u6247\u7684\u5f62\u5f0f\u6765\u7ed8\u5236\u3002</p> <pre><code>    // \u8981\u628a\u9876\u70b9\u6570\u636e\u4e2a\u6570\u5bf9\u5e94\u4e0a\n    glDrawArrays(GL_TRIANGLE_FAN, 0, VERTEX_DATA_NUM + 2);\n</code></pre> <p>\u5f53\u7136\uff0c\u5728\u7ed8\u5236\u5706\u5f62\u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4e0d\u5355\u72ec\u5b9a\u4e49\u539f\u70b9\u548c\u95ed\u5408\u70b9\uff0c\u76f4\u63a5\u4f7f\u7528\u5706\u5f62\u7684 360 \u4e2a\u9876\u70b9\u6765\u7ed8\u5236\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u4f9d\u65e7\u4f1a\u662f\u4e00\u4e2a\u5706\u5f62\u3002</p> <p></p> <p>\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u7684\u7ed8\u5236\u7c7b\u578b\uff0c\u6bd4\u5982\u76f4\u7ebf\uff0c\u6765\u7ed8\u5236\u4e00\u4e2a\u7a7a\u5fc3\u7684\u5706\u5f62\u3002</p> <p>\u8fd8\u662f\u4e0a\u9762\u5b9a\u4e49\u7684\u9876\u70b9\u6570\u636e\uff0c\u4f46\u662f\u6211\u4eec\u53ea\u7528\u5176\u4e2d\u5206\u5272\u6210 360 \u4efd\u7684\u90a3\u90e8\u5206\u9876\u70b9\u6570\u636e\u5c31\u597d\u4e86\uff0c\u4e5f\u5c31\u662f\u53bb\u6389\u9996\u4f4d\u4e24\u4e2a\u70b9\uff0c\u7136\u540e\u628a\u8fd9\u4e2a 360 \u4e2a\u70b9\u4f9d\u6b21\u8fde\u63a5\u7ed8\u5236\u6210\u5706\u5f62\u3002</p> <pre><code>        glDrawArrays(GL_LINE_LOOP, 1, VERTEX_DATA_NUM );\n</code></pre> <p></p> <p>\u8fd9\u6837\u5c31\u5b8c\u6210\u4e00\u4e2a\u5706\u5f62\u7684\u7ed8\u5236\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-basic-shape/#_5","title":"\u6b63\u591a\u8fb9\u5f62\u7684\u7ed8\u5236","text":"<p>\u5728\u7ed8\u5236\u5706\u5f62\u7684\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u8fdb\u884c\u62d3\u5c55\u4e00\u4e0b\u3002</p> <p>\u8981\u77e5\u9053\uff0c\u6700\u540e\u6211\u4eec\u7684\u5706\u5f62\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6b63\u591a\u8fb9\u5f62\u6765\u8d8b\u8fd1\u4e8e\u5706\u5f62\u7684\uff0c\u53ea\u662f\u8089\u773c\u96be\u4ee5\u89c2\u5bdf\u5230\u4e86\uff0c\u6bd5\u7adf\u5b83\u662f\u4e00\u4e2a\u6b63\u4e09\u767e\u516d\u5341\u8fb9\u5f62...</p> <p>\u90a3\u4e48\u5047\u8bbe\u6211\u4eec\u8981\u7ed8\u5236\u6b63\u4e94\u8fb9\u5f62\u3001\u6b63\u516d\u8fb9\u5f62\u3001\u6b63\u4e03\u8fb9\u5f62\u5462\uff1f</p> <p>\u5b9e\u9645\u4e0a\u4e5f\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u628a\u5706\u5206\u6210\u4e94\u4efd\u3001\u516d\u4efd\u3001\u4e03\u4efd\u5c31\u597d\u4e86\u3002</p> <p>\u5c55\u793a\u4e00\u4e9b\u7ed8\u5236\u56fe\u5982\u4e0b\uff1a</p> <p>\u6b63\u4e94\u8fb9\u5f62\uff1a</p> <p></p> <p>\u6b63\u516d\u8fb9\u5f62\uff1a</p> <p></p> <p>\u6b63\u4e03\u8fb9\u5f62\uff1a</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-basic-shape/#_6","title":"\u5c0f\u7ed3","text":"<p>\u5230\u6b64\uff0c\u57fa\u672c\u8bb2\u8ff0\u4e86 OpenGL \u7684\u7ed8\u5236\u6d41\u7a0b\u4ee5\u53ca\u57fa\u672c\u56fe\u5f62\u7684\u7ed8\u5236\u3002</p> <p>\u6839\u636e\u56fe\u5f62\u548c\u7ed8\u5236\u7c7b\u578b\u6765\u91c7\u7528\u4ee5\u4f55\u79cd\u65b9\u5f0f\u8fdb\u884c\u7ed8\u5236\uff0c\u4ee5\u53ca\u5b9a\u4e49\u9876\u70b9\u6570\u636e\uff0c\u6700\u540e\u76f4\u63a5\u7ed8\u5236\u5bf9\u5e94\u56fe\u5f62\u5373\u53ef\u3002</p> <p>\u4f46\u663e\u7136\uff0c\u8fd9\u8fd8\u662f\u4e0d\u591f\u7684\uff0c\u8fd8\u662f\u6709\u5f88\u591a\u95ee\u9898\u7684\u3002</p> <p>\u60f3\u8981\u7ed8\u5236\u4e00\u4e2a\u5706\u5f62\uff0c\u7ed3\u679c\u5374\u6210\u4e86\u692d\u5706\uff1b\u60f3\u8981\u7ed8\u5236\u4e00\u4e2a\u6b63\u4e94\u8fb9\u5f62\uff0c\u5374\u6210\u4e86\u6b6a\u7684\uff1b\u8fd9\u5230\u5e95\u662f\u9053\u5fb7\u7684\u6ca6\u4e27\u8fd8\u662f\u4eba\u6027\u7684\u6cef\u706d\uff0c\u4e00\u5207\u7684\u63ed\u6653\u5c31\u5728\u4e0b\u4e00\u7bc7\u535a\u5ba2\u4e2d\u4e86\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-basic-shape/#_7","title":"\u53c2\u8003","text":"<p>1\u3001http://blog.csdn.net/junzia/article/details/52818488</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/","title":"OpenGL \u5b66\u4e60\u7cfb\u5217\u4e4b\u57fa\u7840\u7684\u7ed8\u5236\u6d41\u7a0b","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/H6p3cLGpKys5ihF7ymBhJw</p> <p>\u7ec8\u4e8e\u8981\u5f00\u59cb\u63a2\u7d22\u5947\u5999\u7684 3D \u4e16\u754c\u4e86\uff0cOpenGL \u641e\u8d77\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#opengl","title":"OpenGL \u7b80\u4ecb","text":"<p>OpenGL \u662f\u4e00\u79cd\u5e94\u7528\u7a0b\u5e8f\u7f16\u7a0b\u63a5\u53e3\uff0c\u5b83\u662f\u4e00\u79cd\u53ef\u4ee5\u5bf9\u56fe\u5f62\u786c\u4ef6\u8bbe\u5907\u7279\u6027\u8fdb\u884c\u8bbf\u95ee\u7684\u8f6f\u4ef6\u5e93\u3002</p> <p>\u91cd\u70b9\uff1aOpenGL \u662f\u4e00\u79cd\u63a5\u53e3\uff0c\u65e2\u7136\u662f\u63a5\u53e3\uff0c\u90a3\u4e48\u5c31\u5fc5\u7136\u8981\u6709\u5b9e\u73b0\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u5b83\u7684\u5b9e\u73b0\u662f\u7531\u663e\u793a\u8bbe\u5907\u5382\u5546\u63d0\u4f9b\u7684\uff0c\u800c\u4e14\u4f9d\u8d56\u4e8e\u5382\u5546\u63d0\u4f9b\u7684\u786c\u4ef6\u8bbe\u5907\u3002</p> <p>OpenGL \u5e38\u7528\u4e8e CAD\u3001\u865a\u62df\u5b9e\u5883\u3001\u79d1\u5b66\u53ef\u89c6\u5316\u7a0b\u5e8f\u548c\u7535\u5b50\u6e38\u620f\u5f00\u53d1\u3002</p> <p>\u5728 Android \u4e0a\u4f7f\u7528\u7684\u662f OpenGL ES\uff0c\u5b83\u662f OpenGL \u7684\u5b50\u96c6\uff0c\u5728 OpenGL \u7684\u57fa\u7840\u4e4b\u4e0a\u88c1\u526a\u6389\u4e86\u4e00\u4e9b\u975e\u5fc5\u8981\u7684\u90e8\u5206\uff0c\u4e3b\u8981\u662f\u9488\u5bf9\u624b\u673a\u3001PAD \u548c\u6e38\u620f\u4e3b\u673a\u7b49\u5d4c\u5165\u5f0f\u8bbe\u5907\u8bbe\u8ba1\u7684\u3002</p> <p>\u5728 Android \u4e0a\u5f00\u53d1 OpenGL \u65e2\u53ef\u4ee5\u4f7f\u7528 Java \u4e5f\u53ef\u4ee5\u4f7f\u7528 C \uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u64b8\u8d77\u8896\u5b50\u5c31\u662f\u5e72\uff01</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#opengl_1","title":"OpenGL \u7684\u7ed8\u5236\u6d41\u7a0b","text":"<p>\u5b66\u4e60 OpenGL \u7684\u7ed8\u5236\uff0c\u6700\u597d\u8fd8\u662f\u5148\u4ece 2D \u7ed8\u5236\u5f00\u59cb\uff0c\u9010\u6e10\u8fc7\u6e21\u5230 3D \u7ed8\u5236\u3002</p> <p>Android \u4e3a OpenGL \u7684\u7ed8\u5236\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7279\u5b9a\u7684\u89c6\u56fe<code>GLSurfaceView</code>\uff0c\u5c31\u50cf SurfaceView \u4e00\u6837\uff0c\u5b83\u6e32\u67d3\u7ed8\u5236\u4e5f\u53ef\u4ee5\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u7ebf\u7a0b\u4e2d\uff0c\u800c\u975e\u4e3b\u7ebf\u7a0b\uff0c\u6bd5\u7adf GLSurfaceView \u5c31\u662f\u7ee7\u627f\u81ea SurfaceView \u7684\u3002</p> <p>\u5728\u4f7f\u7528 GLSurfaceView \u65f6\uff0c\u9700\u8981\u901a\u8fc7<code>setRenderer</code>\u65b9\u6cd5\u7ed9\u5b83\u8bbe\u7f6e\u4e00\u4e2a\u6e32\u67d3\u5668\uff0c\u800c\u4e3b\u8981\u7684\u6e32\u67d3\u5de5\u4f5c\u5c31\u662f\u7531\u6e32\u67d3\u5668<code>Renderer</code>\u5b8c\u6210\u4e86\u3002</p> <p>\u901a\u8fc7\u7ee7\u627f<code>GLSurfaceView.Renderer</code>\u7c7b\u6765\u5b9e\u73b0\u6211\u4eec\u81ea\u5df1\u7684\u6e32\u67d3\u5668\u7a0b\u5e8f\uff0c\u4e3b\u8981\u6709\u5982\u4e0b\u4e09\u4e2a\u65b9\u6cd5\uff1a</p> <ul> <li>onSurfaceCreated<ul> <li>\u5f53 GLSurfaceView \u521b\u5efa\u65f6\u8c03\u7528\uff0c\u4e3b\u8981\u505a\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\u3002</li> </ul> </li> <li>onSurfaceChanged<ul> <li>\u5f53 GLSurfaceView \u89c6\u56fe\u6539\u53d8\u65f6\u8c03\u7528\uff0c\u7b2c\u4e00\u6b21\u521b\u5efa\u65f6\u4e5f\u4f1a\u88ab\u8c03\u7528\u3002</li> </ul> </li> <li>onDrawFrame<ul> <li>\u6bcf\u4e00\u5e27\u7ed8\u5236\u65f6\u88ab\u8c03\u7528\u3002</li> </ul> </li> </ul> <p>\u5b9e\u73b0\u6e32\u67d3\u5668\u7a0b\u5e8f\u65f6\uff0c\u9996\u5148\u8981\u8003\u8651\u4e09\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u5728\u4ec0\u4e48\u5730\u65b9\u8fdb\u884c\u7ed8\u5236\uff1f</li> <li>\u7ed8\u5236\u6210\u4ec0\u4e48\u5f62\u72b6\uff1f</li> <li>\u7528\u4ec0\u4e48\u989c\u8272\u6765\u7ed8\u5236\uff1f</li> </ul> <p>\u800c\u6211\u4eec\u7684\u7a0b\u5e8f\u4e5f\u4e3b\u8981\u4ee5\u89e3\u51b3\u4e0a\u8ff0\u4e09\u4e2a\u95ee\u9898\u4e3a\u4e3b\uff0c\u4e0b\u9762\u4ee5 OpenGL \u7ed8\u5236\u4e00\u4e2a\u70b9\u6765\u8bb2\u89e3\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#opengl_2","title":"OpenGL \u5750\u6807","text":"<p>\u624b\u673a\u5c4f\u5e55\u7684\u5750\u6807\u662f\u4ee5\u5de6\u4e0a\u89d2\u4e3a\u539f\u70b9\uff080\uff0c0\uff09\uff0c\u5411\u53f3\u4e3a X \u8f74\u6b63\u65b9\u5f62\uff0c\u5411\u4e0b\u4e3a Y \u8f74\u6b63\u65b9\u5411\uff0c\u800c OpenGL \u4e5f\u6709\u7740\u5b83\u81ea\u5df1\u7684\u4e00\u5957\u5750\u6807\u5b9a\u4e49\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u70b9\u7684\u5750\u6807\uff084.3\uff0c2.1\uff09\uff0c\u4e5f\u5c31\u662f\u5b83\u7684 X \u8f74\u5750\u6807\u548c Y \u8f74\u5750\u6807\uff0c\u800c OpenGL \u6700\u540e\u4f1a\u628a\u6211\u4eec\u5b9a\u4e49\u7684\u5750\u6807\u6620\u5c04\u624b\u673a\u5c4f\u5e55\u7684\u5b9e\u9645\u7269\u7406\u5750\u6807\u4e0a\u3002</p> <p>\u65e0\u8bba\u662f X \u5750\u6807\u8fd8\u662f Y \u5750\u6807\uff0cOpenGL \u90fd\u4f1a\u628a\u624b\u673a\u5c4f\u5e55\u6620\u5c04\u5230 \\([-1\uff0c1\\)] \u7684\u8303\u56f4\u5185\u3002\u4e5f\u5c31\u662f\u8bf4\uff1a\u5c4f\u5e55\u7684\u5de6\u8fb9\u5bf9\u5e94 X \u8f74\u7684 -1 \uff0c\u5c4f\u5e55\u7684\u53f3\u8fb9\u5bf9\u5e94 +1\uff0c\u5c4f\u5e55\u7684\u5e95\u8fb9\u4f1a\u5bf9\u5e94 Y \u8f74\u7684 -1\uff0c\u800c\u5c4f\u5e55\u7684\u9876\u8fb9\u5c31\u5bf9\u5e94 +1\u3002</p> <p>\u4e0d\u7ba1\u5c4f\u5e55\u662f\u4ec0\u4e48\u5f62\u72b6\u548c\u5927\u5c0f\uff0c\u8fd9\u4e2a\u5750\u6807\u8303\u56f4\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f8b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u4e0a\u9762\u5b9a\u4e49\u7684\u5750\u6807\uff084.3\uff0c2.1\uff09\uff0c\u6700\u540e\u662f\u4f1a\u88ab\u6620\u5c04\u5230\u624b\u673a\u5c4f\u5e55\u4e4b\u5916\u7684\uff0c\u5904\u4e8e\u4e0d\u53ef\u89c1\u7684\u72b6\u6001\u3002</p> <p>\u8fd9\u91cc\uff0c\u5047\u5b9a\u7ed8\u5236\u4e00\u4e2a\u4f4d\u4e8e\u539f\u70b9\u7684\u70b9\uff080\uff0c0\uff09\uff0c\u90a3\u4e48\u6620\u5c04\u4e4b\u540e\u7684\u4f4d\u7f6e\u5c31\u624b\u673a\u5c4f\u5e55\u7684\u4e2d\u5fc3\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_1","title":"\u57fa\u672c\u56fe\u5143","text":"<p>\u89e3\u51b3\u4e86\u4f4d\u7f6e\u7684\u95ee\u9898\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u5f62\u72b6\u548c\u989c\u8272\u7684\u95ee\u9898\u3002</p> <p>\u5982\u540c Android \u7684 Canvas \u5bf9\u8c61\u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u6cd5\u6765\u5b8c\u6210\u57fa\u672c\u7684\u7ed8\u5236\uff1adrawPoint\u3001drawRect\u3001drawLine \u7b49\uff0cOpenGL \u7a0b\u5e8f\u4e5f\u63d0\u4f9b\u4e14\u4ec5\u63d0\u4f9b\u4e86\u4e09\u79cd\u57fa\u672c\u7684\u56fe\u5143\u6765\u5b8c\u6210\u7ed8\u5236\u3002</p> <ul> <li>\u70b9</li> <li>\u7ebf</li> <li>\u4e09\u89d2\u5f62</li> </ul> <p>\u5176\u4ed6\u7684\u6240\u6709\u5f62\u72b6\u90fd\u662f\u57fa\u4e8e\u8fd9\u4e09\u79cd\u56fe\u5143\u6765\u5b8c\u6210\u7684\uff0c\u6bd4\u5982\u77e9\u5f62\u5c31\u53ef\u4ee5\u770b\u6210\u662f\u4e24\u4e2a\u4e09\u89d2\u5f62\u62fc\u6210\u7684\u3002</p> <p>\u7531\u4e8e\u6211\u4eec\u8981\u7ed8\u5236\u7684\u662f\u4e00\u4e2a\u70b9\uff0c\u5728\u5750\u6807\u7cfb\u4e2d\uff0c\u4e00\u4e2a\u5750\u6807\u5c31\u53ef\u4ee5\u4ee3\u66ff\u4e00\u4e2a\u70b9\u4e86\u3002\u5047\u8bbe\u8981\u7ed8\u5236\u4e00\u4e2a\u4e09\u89d2\u5f62\uff0c\u90a3\u4e48\u5728\u5750\u6807\u7cfb\u4e2d\u5c31\u9700\u8981\u4e09\u4e2a\u70b9\u624d\u884c\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u6d89\u53ca\u5230 OpenGL \u5982\u4f55\u628a\u5b9a\u4e49\u7684\u70b9\u7684\u6570\u636e\u7ed8\u5236\u51fa\u6765\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_2","title":"\u6e32\u67d3\u7ba1\u7ebf","text":"<p>\u9996\u5148\u8981\u660e\u767d\u4e00\u4e2a\u6982\u5ff5<code>\u6e32\u67d3\u7ba1\u7ebf</code>\u3002</p> <p>\u6839\u636e\u767e\u5ea6\u767e\u79d1\u7684\u5b9a\u4e49\uff0c\u6e32\u67d3\u7ba1\u7ebf\u4e5f\u79f0\u4e3a<code>\u6e32\u67d3\u6d41\u6c34\u7ebf</code>\u6216<code>\u50cf\u7d20\u6d41\u6c34\u7ebf</code>\u6216<code>\u50cf\u7d20\u7ba1\u7ebf</code>\uff0c\u662f\u663e\u793a\u82af\u7247\u5185\u90e8\uff08GPU\uff09\u5904\u7406\u56fe\u5f62\u4fe1\u53f7\u76f8\u4e92\u72ec\u7acb\u7684\u5e76\u884c\u5904\u7406\u5355\u5143\u3002</p> <p>\u663e\u5361\u7684\u6e32\u67d3\u7ba1\u7ebf\u5c31\u662f\u663e\u793a\u6838\u5fc3\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u662f\u8d1f\u8d23\u7ed9\u56fe\u5f62\u914d\u4e0a\u989c\u8272\u7684\u4e00\u7ec4\u4e13\u95e8\u901a\u9053\u3002\u6e32\u67d3\u7ba1\u7ebf\u7684\u6570\u91cf\u662f\u51b3\u5b9a\u663e\u793a\u82af\u7247\u6027\u80fd\u548c\u6863\u6b21\u7684\u6700\u91cd\u8981\u7684\u53c2\u6570\u4e4b\u4e00\u3002</p> <p>\u73b0\u9636\u6bb5\u7684\u663e\u5361\u90fd\u662f\u5206\u4e3a<code>\u9876\u70b9\u6e32\u67d3</code>\u548c<code>\u50cf\u7d20\u6e32\u67d3</code>\u7684\u3002\u5728\u663e\u5361\uff0c\u5185\u90e8\u5206\u4e3a\u4e24\u5927\u533a\u57df\uff0c\u4e00\u4e2a\u533a\u57df\u662f\u9876\u70b9\u6e32\u67d3\u5355\u5143\uff08\u4e5f\u53eb\u9876\u70b9\u7740\u8272\uff09\uff0c\u4e3b\u8981\u8d1f\u8d23\u63cf\u7ed8\u56fe\u5f62\uff0c\u4e5f\u5c31\u662f\u5efa\u7acb\u6a21\u578b\u3002\u4e00\u4e2a\u533a\u57df\u662f\u50cf\u7d20\u6e32\u67d3\u7ba1\u7ebf\uff0c\u4e3b\u8981\u8d1f\u8d23\u628a\u9876\u70b9\u7ed8\u51fa\u7684\u56fe\u5f62\u586b\u4e0a\u989c\u8272\u3002</p> <p></p> <p>\u4e0a\u56fe\u5c31\u662f OpenGL \u4e2d\u6e32\u67d3\u7ba1\u7ebf\u7684\u4e00\u4e2a\u5904\u7406\u6d41\u7a0b\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6d41\u7a0b\u56fe\u4ece\u8bfb\u53d6\u9876\u70b9\u6570\u636e\u5f00\u59cb\uff0c\u7136\u540e\u540e\u6267\u884c\u4e24\u4e2a\u7740\u8272\u5668\uff1a</p> <ul> <li>\u9876\u70b9\u7740\u8272\u5668<ul> <li>\u4e3b\u8981\u8d1f\u8d23\u63cf\u7ed8\u56fe\u5f62\uff0c\u4e5f\u5c31\u662f\u6839\u636e\u9876\u70b9\u5750\u6807\uff0c\u5efa\u7acb\u56fe\u5f62\u6a21\u578b\u3002</li> </ul> </li> <li>\u7247\u6bb5\u7740\u8272\u5668<ul> <li>\u4e3b\u8981\u8d1f\u8d23\u628a\u9876\u70b9\u7ed8\u51fa\u7684\u56fe\u5f62\u586b\u4e0a\u989c\u8272\u3002</li> </ul> </li> </ul> <p>\u7531\u4e8e\u8fd9\u4e24\u4e2a\u7740\u8272\u5668\u5bf9\u4e8e\u6700\u540e\u56fe\u5f62\u663e\u793a\u6548\u679c\u81f3\u5173\u91cd\u8981\uff0c\u5e76\u4e14\u5b83\u4eec\u8fd8\u662f\u53ef\u4ee5\u901a\u8fc7\u7f16\u7a0b\u6765\u63a7\u5236\u7684\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48<code>\u53ef\u7f16\u7a0b\u6e32\u67d3\u7ba1\u7ebf</code>\u8981\u4f18\u4e8e\u56fa\u5b9a\u7f16\u7a0b\u7ba1\u7ebf\u4e86\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u968f\u7740\u663e\u793a\u6280\u672f\u7684\u53d1\u5c55\uff0c\u6e32\u67d3\u7ba1\u7ebf\u5c06\u4e0d\u590d\u5b58\u5728\u4e86\uff0c\u9876\u70b9\u7740\u8272\u5668\u548c\u6e32\u67d3\u7ba1\u7ebf\u7edf\u4e00\u88ab<code>\u6d41\u5904\u7406\u5668\uff08Stream Processors\uff09</code>\u6240\u53d6\u4ee3\u3002</p> <p>\u4f46\u662f\u76ee\u524d\u624b\u673a\u4e0a OpenGL \u8fd8\u662f\u4f7f\u7528\u6e32\u67d3\u7ba1\u7ebf\u4e2d\uff0c\u6709\u4e86\u6e32\u67d3\u7ba1\u7ebf\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5b8c\u6210\u70b9\u7684\u5f62\u72b6\u7ed8\u5236\u548c\u7740\u8272\u4e24\u5927\u95ee\u9898\u4e86\uff0c\u63a5\u4e0b\u6765\u7684\u5de5\u4f5c\u4e5f\u662f\u56f4\u7ed5\u8fd9\u6761\u6e32\u67d3\u7ba1\u7ebf\u5f00\u59cb\u7684\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_3","title":"\u5185\u5b58\u62f7\u8d1d","text":"<p>\u5f53\u5b9a\u4e49\u5b8c\u4e86\u9876\u70b9\u5750\u6807\uff0c\u5e76\u4e14\u660e\u786e\u4e86\u4e0b\u4e00\u6b65\uff1a\u9876\u70b9\u5750\u6807\u5c06\u8981\u901a\u8fc7\u6e32\u67d3\u7ba1\u7ebf\u8fdb\u884c\u4e00\u7cfb\u5217\u5904\u7406\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u662f\u5982\u4f55\u628a\u9876\u70b9\u5750\u6807\u4f20\u9012\u7ed9\u6e32\u67d3\u7ba1\u7ebf\u4e86\u3002</p> <p>OpenGL \u7684\u5b9e\u73b0\u662f\u7531\u663e\u793a\u8bbe\u5907\u5382\u5546\u63d0\u4f9b\u7684\uff0c\u5b83\u4f5c\u4e3a\u672c\u5730\u7cfb\u7edf\u5e93\u76f4\u63a5\u8fd0\u884c\u5728\u786c\u4ef6\u4e0a\u3002\u800c\u6211\u4eec\u5b9a\u4e49\u7684\u9876\u70b9 Java \u4ee3\u7801\u662f\u8fd0\u884c\u5728\u865a\u62df\u673a\u4e0a\u7684\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230\u4e86\u5982\u4f55\u628a Java \u5c42\u7684\u5185\u5b58\u590d\u5236\u5230 Native \u5c42\u4e86\u3002</p> <p>\u4e00\u79cd\u65b9\u6cd5\u662f\u76f4\u63a5\u4f7f\u7528<code>JNI</code>\u5f00\u53d1\uff0c\u76f4\u63a5\u8c03\u7528\u672c\u5730\u7cfb\u7edf\u5e93\uff0c\u4e5f\u5c31\u662f\u7528 <code>C++</code> \u6765\u5f00\u53d1 OpenGL\uff0c\u8fd9\u79cd\u5b9e\u73b0\u80af\u5b9a\u8981\u5b66\u4f1a\u7684\u3002</p> <p>\u53e6\u4e00\u79cd\u65b9\u6cd5\u5c31\u662f\u5728 Java \u5c42\u628a\u5185\u5b58\u5757\u590d\u5236\u5230 Native \u5c42\u3002</p> <p>\u4f7f\u7528<code>ByteBuffer.allocateDirect()</code>\u65b9\u6cd5\u5c31\u53ef\u4ee5\u5206\u914d\u4e00\u5757 Native \u5185\u5b58\uff0c\u8fd9\u5757\u5185\u5b58\u4e0d\u4f1a\u88ab Java \u7684\u5783\u573e\u56de\u6536\u5668\u7ba1\u7406\u3002</p> <p>\u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\u5927\u81f4\u90fd\u4e00\u6837\uff0c\u62bd\u51fa\u516c\u5171\u7684\u6a21\u677f\uff1a</p> <pre><code>   // \u58f0\u660e\u4e00\u4e2a\u5b57\u8282\u7f13\u51b2\u533a FloatBuffer\n   private FloatBuffer floatBuffer;\n   // \u5b9a\u4e49\u9876\u70b9\u6570\u636e\n   float[] vertexData = new float[16];\n   // FloatBuffer \u521d\u59cb\u5316\u5de5\u4f5c\u5e76\u653e\u5165\u9876\u70b9\u6570\u636e\n   floatBuffer = ByteBuffer\n       .allocateDirect(vertexData.length * Constant.BYTES_PRE_FLOAT)\n       .order(ByteOrder.nativeOrder())\n       .asFloatBuffer()\n       .put(vertexData);\n</code></pre> <p>\u5728<code>allocateDirect</code>\u65b9\u6cd5\u5206\u914d\u4e86\u5185\u5b58\u5e76\u6307\u5b9a\u4e86\u5927\u5c0f\u4e4b\u540e\uff0c\u4e0b\u4e00\u6b65\u5c31\u662f\u544a\u8bc9 ByteBuffer \u6309\u7167<code>\u672c\u5730\u5b57\u8282\u5e8f</code>\u7ec4\u7ec7\u5b83\u7684\u5185\u5bb9\u3002\u672c\u5730\u5b57\u8282\u5e8f\u662f\u6307\uff0c\u5f53\u4e00\u4e2a\u503c\u5360\u7528\u591a\u4e2a\u5b57\u8282\u65f6\uff0c\u6bd4\u5982 32 \u4f4d\u6574\u578b\u6570\uff0c\u5b57\u8282\u6309\u7167\u4ece\u6700\u91cd\u8981\u4f4d\u5230\u6700\u4e0d\u91cd\u8981\u4f4d\u6216\u8005\u76f8\u53cd\u987a\u5e8f\u6392\u5217\u3002</p> <p>\u63a5\u4e0b\u6765<code>asFloatBuffer</code>\u65b9\u6cd5\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u53cd\u6620\u5e95\u5c42\u5b57\u8282\u7684 FloatBuffer \u7c7b\u5b9e\u4f8b\uff0c\u907f\u514d\u76f4\u63a5\u64cd\u4f5c\u5355\u72ec\u7684\u5b57\u8282\uff0c\u800c\u662f\u4f7f\u7528\u6d6e\u70b9\u6570\u3002</p> <p>\u6700\u540e\uff0c\u901a\u8fc7<code>put</code>\u65b9\u6cd5\u5c31\u53ef\u4ee5\u628a\u6570\u636e\u4ece Java \u5c42\u5185\u5b58\u590d\u5236\u5230 Native \u5c42\u4e86\uff0c\u5f53\u8fdb\u7a0b\u7ed3\u675f\u65f6\uff0c\u8fd9\u5757\u5185\u5b58\u5c31\u4f1a\u88ab\u91ca\u653e\u6389\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_4","title":"\u9876\u70b9\u7740\u8272\u5668","text":"<p>\u63a5\u4e0b\u6765\u53ef\u7f16\u7a0b\u7684\u90e8\u5206\u4e86\uff0c\u5b9a\u4e49\u7740\u8272\u5668\uff08<code>Shader</code>\uff09\u7a0b\u5e8f\u3002</p> <p>\u4f7f\u7528\u4e0d\u540c\u7684\u7740\u8272\u5668\u5bf9\u8f93\u5165\u7684\u56fe\u5143\u6570\u636e\u6267\u884c\u8ba1\u7b97\u64cd\u4f5c\uff0c\u5224\u65ad\u5b83\u4eec\u7684\u4f4d\u7f6e\u3001\u989c\u8272\uff0c\u4ee5\u53ca\u5176\u4ed6\u6e32\u67d3\u5c5e\u6027\u3002</p> <p>\u9996\u5148\u662f\u9876\u70b9\u7740\u8272\u5668\u3002</p> <p>\u5728\u6e32\u67d3\u7ba1\u7ebf\u4e2d\u4f20\u8f93\u7684\u6bcf\u4e2a\u9876\u70b9\u5750\u6807\u4f4d\u7f6e\uff0cOpenGL \u90fd\u4f1a\u8c03\u7528\u4e00\u4e2a\u9876\u70b9\u7740\u8272\u5668\u6765\u5904\u7406\u9876\u70b9\u76f8\u5173\u7684\u6570\u636e\uff0c\u8fd9\u4e2a\u5904\u7406\u8fc7\u7a0b\u53ef\u4ee5\u5f88\u590d\u6742\uff0c\u4e5f\u53ef\u4ee5\u5f88\u7b80\u5355\u3002</p> <p>\u60f3\u8981\u5b9a\u4e49\u4e00\u4e2a\u7740\u8272\u5668\u7a0b\u5e8f\uff0c\u8fd8\u8981\u901a\u8fc7\u4e00\u79cd\u7279\u6b8a\u7684\u8bed\u8a00\u53bb\u7f16\u5199\uff1a<code>OpenGL Shading Language</code>\uff0c\u7b80\u79f0<code>GLSL</code>.</p> <p><code>GLSL</code>\u8bed\u8a00\u7c7b\u4f3c\u4e8e C \u8bed\u8a00\u6216\u8005 Java \u8bed\u8a00\uff0c\u5b83\u7684\u7a0b\u5e8f\u5165\u53e3\u4e5f\u662f\u4e00\u4e2a\u540d\u4e3a<code>main</code>\u7684\u51fd\u6570\u3002\u5173\u4e8e GLSL \u7684\u90e8\u5206\uff0c\u5b8c\u5168\u53ef\u4ee5\u5355\u72ec\u5199\u4e00\u7bc7\u535a\u5ba2\u4e86\uff0c\u6682\u65f6\u5148\u4e0d\u8be6\u7ec6\u9610\u8ff0\u3002</p> <p>\u4e0b\u9762\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u9876\u70b9\u7740\u8272\u5668\u7a0b\u5e8f\uff1a <pre><code>attribute vec4 a_Position;\nvoid main()\n{\n    gl_Position = a_Position;\n    gl_PointSize = 30.0;\n}\n</code></pre> \u7740\u8272\u5668\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\u7684\u65b9\u5f0f\u2014\u2014\u6570\u636e\u4f20\u8f93\u8fdb\u6765\uff0c\u7ecf\u8fc7\u5904\u7406\uff0c\u7136\u540e\u518d\u4f20\u8f93\u51fa\u53bb\u3002</p> <p>\u5176\u4e2d\uff0c<code>gl_Position</code>\u548c<code>gl_PointSize</code>\u5c31\u662f\u7740\u8272\u5668\u4e2d\u7684\u7279\u6b8a\u5168\u5c40\u53d8\u91cf\uff0c\u5b83\u63a5\u6536\u8f93\u5165\u3002</p> <p><code>a_Position</code>\u5c31\u662f\u6211\u4eec\u5b9a\u4e49\u7684\u4e00\u4e2a\u53d8\u91cf\uff0c\u5b83\u662f<code>vec4</code>\u7c7b\u578b\u7684\u3002\u800c<code>attribute</code>\u53ea\u80fd\u5b58\u5728\u4e8e\u9876\u70b9\u7740\u8272\u5668\u4e2d\uff0c\u4e00\u822c\u7528\u4e8e\u4fdd\u5b58\u9876\u70b9\u6570\u636e\uff0c\u5b83\u53ef\u4ee5\u5728\u6570\u636e\u7f13\u51b2\u533a\u4e2d\u8bfb\u53d6\u6570\u636e\u3002</p> <p>\u6570\u636e\u7f13\u5b58\u533a\u4e2d\u7684\u9876\u70b9\u5750\u6807\u4f1a\u8d4b\u503c\u7ed9 a_Position \uff0ca_Position \u4f1a\u4f20\u9012\u7ed9 gl_Position\u3002</p> <p>\u800c gl_PointSize \u5219\u56fa\u5b9a\u4e86\u70b9\u7684\u5927\u5c0f\u4e3a 30\u3002</p> <p>\u6709\u4e86\u9876\u70b9\u7740\u8272\u5668\uff0c\u5c31\u80fd\u591f\u4e3a\u6bcf\u4e2a\u9876\u70b9\u751f\u6210\u6700\u7ec8\u7684\u4f4d\u7f6e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u5b9a\u4e49\u7247\u6bb5\u7740\u8272\u5668\u3002</p> <p>\u6839\u636e\u4e0a\u56fe\u7684\u6e32\u67d3\u7ba1\u7ebf\uff0c\u9876\u70b9\u7740\u8272\u5668\u5230\u7247\u6bb5\u7740\u8272\u5668\u4e4b\u95f4\uff0c\u8fd8\u8981\u7ecf\u8fc7<code>\u7ec4\u88c5\u56fe\u5143</code>\u548c<code>\u5149\u6805\u5316\u56fe\u5143</code>\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_5","title":"\u5149\u6805\u5316\u6280\u672f","text":"<p>\u79fb\u52a8\u8bbe\u5907\u7684\u663e\u793a\u5c4f\u7531\u6210\u767e\u4e0a\u5343\u4e2a\u5c0f\u7684\u3001\u72ec\u7acb\u7684\u90e8\u4ef6\u7ec4\u6210\uff0c\u4ed6\u4eec\u79f0\u4e3a<code>\u50cf\u7d20</code>\u3002\u6bcf\u4e2a\u50cf\u7d20\u901a\u5e38\u7531\u4e09\u4e2a\u5355\u72ec\u7684\u5b50\u7ec4\u4ef6\u6784\u6210\uff0c\u5b83\u4eec\u53d1\u51fa\u7ea2\u8272\u3001\u7eff\u8272\u548c\u84dd\u8272\u7684\u5149\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u50cf\u7d20\u90fd\u975e\u5e38\u5c0f\uff0c\u4eba\u7684\u773c\u775b\u4f1a\u628a\u7ea2\u8272\u3001\u7eff\u8272\u548c\u84dd\u8272\u7684\u5149\u6df7\u5408\u5728\u4e00\u8d77\uff0c\u4ece\u800c\u521b\u9020\u51fa\u5de8\u91cf\u7684\u989c\u8272\u8303\u56f4\u3002</p> <p>OpenGL \u5c31\u662f\u901a\u8fc7 \u5149\u6805\u5316 \u6280\u672f\u7684\u8fc7\u7a0b\u628a\u6bcf\u4e2a\u70b9\u3001\u76f4\u7ebf\u53ca\u4e09\u89d2\u5f62\u5206\u89e3\u6210\u5927\u91cf\u7684\u5c0f\u7247\u6bb5\uff0c\u5b83\u4eec\u53ef\u4ee5\u6620\u5c04\u5230\u79fb\u52a8\u8bbe\u5907\u663e\u793a\u5c4f\u7684\u50cf\u7d20\u4e0a\uff0c\u4ece\u800c\u751f\u6210\u4e00\u5e45\u56fe\u50cf\u3002\u8fd9\u4e9b\u7247\u6bb5\u7c7b\u4f3c\u4e8e\u663e\u793a\u5c4f\u4e0a\u7684\u50cf\u7d20\uff0c\u6bcf\u4e00\u4e2a\u90fd\u5305\u542b\u5355\u4e00\u7684\u7eaf\u8272\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>OpenGL \u901a\u8fc7\u5149\u6805\u5316\u6280\u672f\u628a\u4e00\u6761\u76f4\u7ebf\u6620\u5c04\u4e3a\u4e00\u4e2a\u7247\u6bb5\u96c6\u5408\uff0c\u663e\u793a\u7cfb\u7edf\u901a\u5e38\u4f1a\u628a\u8fd9\u4e9b\u7247\u6bb5\u76f4\u63a5\u6620\u5c04\u5230\u5c4f\u5e55\u4e0a\u7684\u50cf\u7d20\uff0c\u7ed3\u679c\u4e00\u4e2a\u7247\u6bb5\u5c31\u5bf9\u5e94\u4e00\u4e2a\u50cf\u7d20\u3002</p> <p>\u660e\u767d\u4e86\u8fd9\u6837\u7684\u663e\u793a\u539f\u7406\uff0c\u5c31\u53ef\u4ee5\u5728\u5176\u4e2d\u505a\u4e00\u4e9b\u64cd\u4f5c\u4e86\uff0c\u8fd9\u5c31\u662f\u7247\u6bb5\u7740\u8272\u5668\u7684\u529f\u80fd\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_6","title":"\u7247\u6bb5\u7740\u8272\u5668","text":"<p>\u7247\u6bb5\u7740\u8272\u5668\u7684\u4e3b\u8981\u76ee\u7684\u5c31\u662f\u544a\u8bc9 GPU \u6bcf\u4e2a\u7247\u6bb5\u7684\u6700\u7ec8\u989c\u8272\u5e94\u8be5\u662f\u4ec0\u4e48\u3002</p> <p>\u5bf9\u4e8e\u57fa\u672c\u56fe\u5143\u7684\u6bcf\u4e2a\u7247\u6bb5\uff0c\u7247\u6bb5\u7740\u8272\u5668\u90fd\u4f1a\u88ab\u8c03\u7528\u4e00\u6b21\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u4e00\u4e2a\u4e09\u89d2\u5f62\u88ab\u6620\u5c04\u5230 10000 \u4e2a\u7247\u6bb5\uff0c\u90a3\u4e48\u7247\u6bb5\u7740\u8272\u5668\u5c31\u4f1a\u88ab\u8c03\u7528 10000 \u6b21\u3002</p> <p>\u4e0b\u9762\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u7247\u6bb5\u7740\u8272\u5668\u7a0b\u5e8f\uff1a</p> <pre><code>precision mediump float;\nuniform vec4 u_Color;\nvoid main()\n{\n    gl_FragColor = u_Color;\n}\n</code></pre> <p>\u5176\u4e2d\uff0c<code>gl_FragColor</code>\u53d8\u91cf\u5c31\u662f OpenGL \u6700\u7ec8\u6e32\u67d3\u51fa\u6765\u7684\u989c\u8272\u7684\u5168\u5c40\u53d8\u91cf\uff0c\u800c<code>u_Color</code>\u5c31\u662f\u6211\u4eec\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u901a\u8fc7\u5728 Java \u5c42\u7ed1\u5b9a\u5230 <code>u_Color</code>\u53d8\u91cf\u5e76\u7ed9\u5b83\u8d4b\u503c\uff0c\u5c31\u4f1a\u4f20\u9012\u5230 Native \u5c42\u7684<code>gl_FragColor</code>\u4e2d\u3002</p> <p>\u800c\u7b2c\u4e00\u884c\u7684<code>mediump</code>\u6307\u7684\u5c31\u662f\u7247\u6bb5\u7740\u8272\u5668\u7684\u7cbe\u5ea6\u4e86\uff0c\u6709\u4e09\u79cd\u53ef\u9009\uff0c\u8fd9\u91cc\u7528\u4e2d\u7b49\u7cbe\u5ea6\u5c31\u884c\u4e86\u3002<code>uniform</code>\u5219\u8868\u793a\u8be5\u53d8\u91cf\u662f\u4e0d\u53ef\u53d8\u7684\u4e86\uff0c\u4e5f\u5c31\u662f\u56fa\u5b9a\u989c\u8272\u4e86\uff0c\u76ee\u524d\u663e\u793a\u56fa\u5b9a\u989c\u8272\u5c31\u597d\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#opengl_3","title":"\u7f16\u8bd1 OpenGL \u7a0b\u5e8f","text":"<p>\u660e\u767d\u4e86\u7740\u8272\u5668\u7684\u529f\u80fd\u548c\u5149\u6805\u5316\u6280\u672f\u4e4b\u540e\uff0c\u5bf9\u6e32\u67d3\u7ba1\u7ebf\u7684\u6d41\u7a0b\u4e5f\u5c31\u66f4\u52a0\u6e05\u695a\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u7f16\u8bd1 OpenGL \u7684\u7a0b\u5e8f\u4e86\u3002</p> <p>\u7f16\u8bd1 OpenGL \u7a0b\u5e8f\u57fa\u672c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u7f16\u8bd1\u7740\u8272\u5668</li> <li>\u521b\u5efa OpenGL \u7a0b\u5e8f\u548c\u7740\u8272\u5668\u94fe\u63a5</li> <li>\u9a8c\u8bc1 OpenGL \u7a0b\u5e8f</li> <li>\u786e\u5b9a\u4f7f\u7528 OpenGL \u7a0b\u5e8f</li> </ul>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_7","title":"\u7f16\u8bd1\u7740\u8272\u5668","text":"<p>\u521b\u5efa\u65b0\u7684\u6587\u4ef6\u7f16\u5199\u7740\u8272\u5668\u7a0b\u5e8f\uff0c\u7136\u540e\u518d\u4ece\u6587\u4ef6\u4ee5\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u4e2d\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u3002\u8fd9\u6837\u4f1a\u6bd4\u628a\u7740\u8272\u5668\u7a0b\u5e8f\u5199\u6210\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u66f4\u52a0\u6e05\u6670\u3002</p> <p>\u5f53\u8bfb\u53d6\u4e86\u7740\u8272\u5668\u7a0b\u5e8f\u5185\u5bb9\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u7f16\u8bd1\u4e86\u3002</p> <pre><code>   // \u7f16\u8bd1\u9876\u70b9\u7740\u8272\u5668\n    public static int compileVertexShader(String shaderCode) {\n        return compileShader(GL_VERTEX_SHADER, shaderCode);\n    }\n\n    // \u7f16\u8bd1\u7247\u6bb5\u7740\u8272\u5668\n    public static int compleFragmentShader(String shaderCode) {\n        return compileShader(GL_FRAGMENT_SHADER, shaderCode);\n    }\n\n    // \u6839\u636e\u7c7b\u578b\u7f16\u8bd1\u7740\u8272\u5668\n    private static int compileShader(int type, String shaderCode) {\n        // \u6839\u636e\u4e0d\u540c\u7684\u7c7b\u578b\u521b\u5efa\u7740\u8272\u5668 ID\n        final int shaderObjectId = glCreateShader(type);\n        if (shaderObjectId == 0) {\n            return 0;\n        }\n        // \u5c06\u7740\u8272\u5668 ID \u548c\u7740\u8272\u5668\u7a0b\u5e8f\u5185\u5bb9\u8fde\u63a5\n        glShaderSource(shaderObjectId, shaderCode);\n        // \u7f16\u8bd1\u7740\u8272\u5668\n        glCompileShader(shaderObjectId);\n        // \u4ee5\u4e0b\u4e3a\u9a8c\u8bc1\u7f16\u8bd1\u7ed3\u679c\u662f\u5426\u5931\u8d25\n        final int[] compileStatsu = new int[1];\n        glGetShaderiv(shaderObjectId, GL_COMPILE_STATUS, compileStatsu, 0);\n        if ((compileStatsu[0] == 0)) {\n            // \u5931\u8d25\u5219\u5220\u9664\n            glDeleteShader(shaderObjectId);\n            return 0;\n        }\n        return shaderObjectId;\n    }\n</code></pre> <p>\u4ee5\u4e0a\u7a0b\u5e8f\u4e3b\u8981\u5c31\u662f\u901a\u8fc7<code>glCreateShader</code>\u65b9\u6cd5\u521b\u5efa\u4e86\u7740\u8272\u5668 ID\uff0c\u7136\u540e\u901a\u8fc7<code>glShaderSource</code>\u8fde\u63a5\u4e0a\u7740\u8272\u5668\u7a0b\u5e8f\u5185\u5bb9\uff0c\u63a5\u4e0b\u6765\u901a\u8fc7<code>glCompileShader</code>\u7f16\u8bd1\u7740\u8272\u5668\uff0c\u6700\u540e\u901a\u8fc7<code>glGetShaderiv</code>\u9a8c\u8bc1\u662f\u5426\u5931\u8d25\u3002</p> <p><code>glGetShaderiv</code>\u51fd\u6570\u6bd4\u8f83\u901a\u7528\uff0c\u5728\u7740\u8272\u5668\u9636\u6bb5\u548c OpenGL \u7a0b\u5e8f\u9636\u6bb5\u90fd\u4f1a\u901a\u8fc7\u5b83\u6765\u9a8c\u8bc1\u7ed3\u679c\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#opengl_4","title":"\u521b\u5efa OpenGL \u7a0b\u5e8f\u548c\u7740\u8272\u5668\u94fe\u63a5","text":"<p>\u63a5\u4e0b\u6765\u5c31\u662f\u521b\u5efa OpenGL \u7a0b\u5e8f\u5e76\u52a0\u7740\u8272\u5668\u52a0\u8fdb\u6765\u3002</p> <pre><code>  public static int linkProgram(int vertexShaderId, int fragmentShaderId) {\n        // \u521b\u5efa OpenGL \u7a0b\u5e8f ID\n        final int programObjectId = glCreateProgram();\n        if (programObjectId == 0) {\n            return 0;\n        }\n        // \u94fe\u63a5\u4e0a \u9876\u70b9\u7740\u8272\u5668\n        glAttachShader(programObjectId, vertexShaderId);\n        // \u94fe\u63a5\u4e0a \u7247\u6bb5\u7740\u8272\u5668\n        glAttachShader(programObjectId, fragmentShaderId);\n        // \u94fe\u63a5\u7740\u8272\u5668\u4e4b\u540e\uff0c\u94fe\u63a5 OpenGL \u7a0b\u5e8f\n        glLinkProgram(programObjectId);\n        final int[] linkStatus = new int[1];\n        // \u9a8c\u8bc1\u94fe\u63a5\u7ed3\u679c\u662f\u5426\u5931\u8d25\n        glGetProgramiv(programObjectId, GL_LINK_STATUS, linkStatus, 0);\n        if (linkStatus[0] == 0) {\n            // \u5931\u8d25\u5219\u5220\u9664 OpenGL \u7a0b\u5e8f\n            glDeleteProgram(programObjectId);\n            return 0;\n        }\n        return programObjectId;\n    }\n</code></pre> <p>\u9996\u5148\u901a\u8fc7<code>glCreateProgram</code>\u7a0b\u5e8f\u521b\u5efa OpenGL \u7a0b\u5e8f\uff0c\u7136\u540e\u901a\u8fc7<code>glAttachShader</code>\u5c06\u7740\u8272\u5668\u7a0b\u5e8f ID \u6dfb\u52a0\u4e0a OpenGL \u7a0b\u5e8f\uff0c\u63a5\u4e0b\u6765\u901a\u8fc7<code>glLinkProgram</code>\u94fe\u63a5 OpenGL \u7a0b\u5e8f\uff0c\u6700\u540e\u901a\u8fc7<code>glGetProgramiv</code>\u6765\u9a8c\u8bc1\u94fe\u63a5\u662f\u5426\u5931\u8d25\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#opengl_5","title":"\u9a8c\u8bc1 OpenGL \u7a0b\u5e8f","text":"<p>\u94fe\u63a5\u4e86 OpenGL \u7a0b\u5e8f\u540e\uff0c\u5c31\u662f\u9a8c\u8bc1 OpenGL \u662f\u5426\u53ef\u7528\u3002</p> <pre><code> public static boolean validateProgram(int programObjectId) {\n        glValidateProgram(programObjectId);\n        final int[] validateStatus = new int[1];\n        glGetProgramiv(programObjectId, GL_VALIDATE_STATUS, validateStatus, 0);\n        return validateStatus[0] != 0;\n\n    }\n</code></pre> <p>\u901a\u8fc7<code>glValidateProgram</code>\u51fd\u6570\u9a8c\u8bc1\uff0c\u5e76\u518d\u6b21\u901a\u8fc7<code>glGetProgramiv</code>\u51fd\u6570\u9a8c\u8bc1\u662f\u5426\u5931\u8d25\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#opengl_6","title":"\u786e\u5b9a\u4f7f\u7528 OpenGL \u7a0b\u5e8f","text":"<p>\u5f53\u4e00\u5207\u5b8c\u6210\u540e\uff0c\u5c31\u662f\u786e\u5b9a\u4f7f\u7528\u8be5 OpenGL \u7a0b\u5e8f\u4e86\u3002</p> <pre><code>// \u521b\u5efa OpenGL \u7a0b\u5e8f\u8fc7\u7a0b\n public static int buildProgram(Context context, int vertexShaderSource, int fragmentShaderSource) {\n        int program;\n\n        int vertexShader = compileVertexShader(\n                TextResourceReader.readTextFileFromResource(context, vertexShaderSource));\n\n        int fragmentShader = compleFragmentShader(\n                TextResourceReader.readTextFileFromResource(context, fragmentShaderSource));\n\n        program = linkProgram(vertexShader, fragmentShader);\n\n        validateProgram(program);\n\n        return program;\n    }\n\n// \u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u786e\u5b9a\u4f7f\u7528\n    mProgram = ShaderHelper.buildProgram(context, R.raw.point_vertex_shader\n                , R.raw.point_fragment_shader);\n\n        glUseProgram(mProgram);\n</code></pre> <p>\u5c06\u4e0a\u8ff0\u7684\u8fc7\u7a0b\u5408\u5e76\u8d77\u6765\uff0c<code>buildProgram</code>\u51fd\u6570\u8fd4\u56de\u7684 OpenGL \u7a0b\u5e8f ID \u5373\u53ef\uff0c\u901a\u8fc7<code>glUseProgram</code>\u51fd\u6570\u8868\u793a\u4f7f\u7528\u8be5 OpenGL \u7a0b\u5e8f\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_8","title":"\u7ed8\u5236","text":"<p>\u5b8c\u6210\u4e86 OpenGL \u7a0b\u5e8f\u7684\u7f16\u8bd1\uff0c\u5c31\u662f\u6700\u540e\u7684\u7ed8\u5236\u4e86\uff0c\u518d\u56de\u5230\u6e32\u67d3\u5668 <code>Renderer</code>\u91cc\u9762\u3002</p> <pre><code>public class PointRenderer extends BaseRenderer {\n\n    private Point mPoint;\n    public PointRenderer(Context mContext) {\n        super(mContext);\n    }\n\n    @Override\n    public void onSurfaceCreated(GL10 gl, EGLConfig config) {\n        super.onSurfaceCreated(gl, config);\n        glClearColor(0.0f, 0.0f, 0.0f, 0.0f);\n        // \u5728 onSurfaceCreated \u91cc\u9762\u521d\u59cb\u5316\uff0c\u5426\u5219\u4f1a\u62a5\u7ebf\u7a0b\u9519\u8bef\n        mPoint = new Point(mContext);\n        // \u7ed1\u5b9a\u76f8\u5e94\u7684\u9876\u70b9\u6570\u636e\n        mPoint.bindData();\n    }\n\n    @Override\n    public void onSurfaceChanged(GL10 gl, int width, int height) {\n        // \u786e\u5b9a\u89c6\u53e3\u5927\u5c0f\n        glViewport(0, 0, width, height);\n    }\n\n    @Override\n    public void onDrawFrame(GL10 gl) {\n        // \u6e05\u5c4f\n        glClear(GL_COLOR_BUFFER_BIT);\n        // \u7ed8\u5236\n        mPoint.draw();\n    }\n}\n</code></pre> <p>\u5728<code>onSurfaceCreated</code>\u51fd\u6570\u91cc\u9762\u505a\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7ed1\u5b9a\u6570\u636e\u7b49\uff1b\u5728<code>onSurfaceChanged</code>\u65b9\u6cd5\u91cc\u9762\u786e\u5b9a\u89c6\u56fe\u5927\u5c0f\uff0c\u5728<code>onDrawFrame</code>\u91cc\u9762\u6267\u884c\u7ed8\u5236\u3002</p> <p>\u4e3a\u4e86\u7b80\u5316\u6e32\u67d3\u6d41\u7a0b\uff0c\u628a\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u653e\u5728\u653e\u5728\u8981\u6e32\u67d3\u7684\u5bf9\u8c61\u91cc\u9762\u53bb\u4e86\uff0c\u58f0\u660e\u4e00\u4e2a Point \u5bf9\u8c61\uff0c\u4ee3\u8868\u8981\u7ed8\u5236\u7684\u70b9\u3002</p> <pre><code>public class Point extends BaseShape {\n\n    // \u7740\u8272\u5668\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u5728 Java \u5c42\u7ed1\u5b9a\u5e76\u8d4b\u503c\n    private static final String U_COLOR = \"u_Color\";\n    private static final String A_POSITION = \"a_Position\";\n    private int aColorLocation;\n    private int aPositionLocation;\n\n    float[] pointVertex = {\n            0f, 0f\n    };\n\n    public Point(Context context) {\n        super(context);\n        mProgram = ShaderHelper.buildProgram(context, R.raw.point_vertex_shader\n                , R.raw.point_fragment_shader);\n        glUseProgram(mProgram);\n        vertexArray = new VertexArray(pointVertex);\n        POSITION_COMPONENT_COUNT = 2;\n    }\n\n    @Override\n    public void bindData() {\n        //\u7ed1\u5b9a\u503c\n        aColorLocation = glGetUniformLocation(mProgram, U_COLOR);\n        aPositionLocation = glGetAttribLocation(mProgram, A_POSITION);\n        // \u7ed9\u7ed1\u5b9a\u7684\u503c\u8d4b\u503c\uff0c\u4e5f\u5c31\u662f\u4ece\u9876\u70b9\u6570\u636e\u90a3\u91cc\u5f00\u59cb\u8bfb\u53d6\uff0c\u6bcf\u6b21\u8bfb\u53d6\u95f4\u9694\u662f\u591a\u5c11\n        vertexArray.setVertexAttribPointer(0, aPositionLocation, POSITION_COMPONENT_COUNT,\n                0);\n    }\n\n    @Override\n    public void draw() {\n        // \u7ed9\u7ed1\u5b9a\u7684\u503c\u8d4b\u503c\n        glUniform4f(aColorLocation, 0.0f, 0.0f, 1.0f, 1.0f);\n        glDrawArrays(GL_POINTS, 0, 1);\n    }\n}\n</code></pre> <p>\u5728 Point \u7684\u6784\u9020\u51fd\u6570\u4e2d\uff0c\u7f16\u8bd1\u5e76\u4f7f\u7528 OpenGL \u7a0b\u5e8f\uff0c\u800c\u5728 <code>bindData</code>\u51fd\u6570\u4e2d\uff0c\u901a\u8fc7<code>glGetUniformLocation</code>\u548c<code>glGetAttribLocation</code>\u51fd\u6570\u7ed1\u5b9a\u4e86\u6211\u4eec\u5728 OpenGL \u4e2d\u58f0\u660e\u7684\u53d8\u91cf<code>u_Color</code>\u548c<code>a_Position</code>\uff0c\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>attribute</code>\u7c7b\u578b\u548c<code>uniform</code>\u7c7b\u578b\u6240\u5bf9\u5e94\u7684\u65b9\u6cd5\u662f\u4e0d\u540c\u7684\uff0c\u6700\u540e\u901a\u8fc7\u7ed9<code>POSITION_COMPONENT_COUNT</code>\u53d8\u91cf\u8d4b\u503c\uff0c\u6307\u5b9a\u6bcf\u4e2a\u9876\u70b9\u6570\u636e\u7684\u4e2a\u6570\u4e3a 2 \u3002</p> <p>\u7ed1\u5b9a\u4e86\u53d8\u91cf\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u7ed9\u4ed6\u4eec\u8d4b\u503c\u4e86\uff0c\u5bf9\u4e8e<code>uniform</code>\u7c7b\u578b\u53d8\u91cf\uff0c\u7531\u4e8e\u662f\u56fa\u5b9a\u503c\uff0c\u6240\u4ee5\u76f4\u63a5\u8c03\u7528<code>glUniform4f</code>\u65b9\u6cd5\u7ed9\u5176\u8d4b\u503c\u5c31\u597d\u4e86\uff0c\u800c<code>attribute</code>\u7c7b\u578b\u53d8\u91cf\uff0c\u5219\u9700\u8981\u5bf9\u5e94\u9876\u70b9\u6570\u636e\u4e2d\u7684\u503c\u4e86\uff0c<code>vertexArray.setVertexAttribPointer</code>\u65b9\u6cd5\u5c31\u662f\u5b8c\u6210\u8fd9\u4e2a\u4efb\u52a1\u7684\u3002</p> <pre><code>    // \u7ed9\u67d0\u4e2a\u9876\u70b9\u6570\u636e\u7ed1\u5b9a\u503c\uff0c\u5e76 Enable \u4f7f\u80fd\n    public void setVertexAttribPointer(int dataOffset, int attributeLocation, int componentCount, int stride) {\n        floatBuffer.position(dataOffset);\n        glVertexAttribPointer(attributeLocation, componentCount, GL_FLOAT, false, stride, floatBuffer);\n        glEnableVertexAttribArray(attributeLocation);\n        floatBuffer.position(0);\n    }\n</code></pre> <p>\u5728<code>setVertexAttribPointer</code>\u65b9\u6cd5\u4e2d\uff0c\u4f7f\u7528\u4e86<code>glVertexAttribPointer</code>\u65b9\u6cd5\u6765\u7ed1\u5b9a\u503c\uff0c\u5b83\u7684\u53c2\u6570\u91ca\u4e49\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7<code>glEnableVertexAttribArray</code>\u65b9\u6cd5\u6765\u5f00\u542f\u4f7f\u7528\u5373\u53ef\u3002</p> <p>\u6700\u540e\u901a\u8fc7<code>glDrawArrays</code>\u65b9\u6cd5\u6765\u6267\u884c\u6700\u540e\u7684\u7ed8\u5236\uff0c<code>GL_POINTS</code>\u4ee3\u8868\u7ed8\u5236\u7684\u7c7b\u578b\uff0c\u800c\u53c2\u6570<code>0\uff0c1</code>\u5219\u4ee3\u8868\u7ed8\u5236\u7684\u70b9\u7684\u8303\u56f4\uff0c\u5b83\u662f\u4e00\u4e2a\u5de6\u95ed\u53f3\u5f00\u7684\u533a\u95f4\u3002</p> <p>\u4ee5\u4e0a\u6b65\u9aa4\u5c31\u5b8c\u6210\u4e86\u4e00\u4e2a\u70b9\u7684\u7ed8\u5236\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5177\u4f53\u4ee3\u7801\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_9","title":"\u5c0f\u7ed3","text":"<p>\u4f7f\u7528 OpenGL \u8fdb\u884c\u7ed8\u5236\u7684\u539f\u7406\uff0c\u4e5f\u5c31\u662f\u6309\u7167 GPU \u7684\u6e32\u67d3\u7ba1\u7ebf\u6d41\u7a0b\uff0c\u63d0\u4f9b\u4e86\u9876\u70b9\u6570\u636e\u4e4b\u540e\uff0c\u6267\u884c\u9876\u70b9\u7740\u8272\u5668\uff0c\u7136\u540e\u6267\u884c\u7247\u6bb5\u7740\u8272\u5668\uff0c\u6700\u540e\u6620\u5c04\u5230\u624b\u673a\u5c4f\u5e55\u4e0a\u3002</p> <p>\u800c\u4f5c\u4e3a\u53ef\u7f16\u7a0b\u7684\u9636\u6bb5\uff0c\u6211\u4eec\u5c31\u662f\u5728\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\u4e2d\u505a\u6211\u4eec\u60f3\u8981\u7684\u5904\u7406\uff0c\u7f16\u5199\u4e86\u7740\u8272\u5668\u4ee3\u7801\u4e4b\u540e\uff0c\u901a\u8fc7\u7f16\u8bd1\u94fe\u63a5\u6210 OpenGL \u7a0b\u5e8f\u3002\u7136\u540e\u7ed9 OpenGL \u4e2d\u8bbe\u5b9a\u7684\u53d8\u91cf\u7ed1\u5b9a\u5bf9\u5e94\u7684\u503c\uff0c\u4ece\u9876\u70b9\u6570\u636e\u4f55\u5904\u5f00\u59cb\u8bfb\u53d6\u503c\u3002\u5230\u8fd9\u91cc\uff0c\u4e00\u5207\u51c6\u5907\u5de5\u4f5c\u5c31\u505a\u5b8c\u4e86\u3002</p> <p>\u6700\u540e\u5c31\u5728\u5728\u6e32\u67d3\u5668 Renderer \u4e2d\u5f00\u59cb\u7ed8\u5236\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-draw-point/#_10","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES \u5e94\u7528\u5f00\u53d1\u5b9e\u8df5\u6307\u5357\u300b</li> <li>\u300aOpenGL \u7f16\u7a0b\u6307\u5357\u300b\uff08\u539f\u4e66\u7b2c\u516b\u7248\uff09</li> <li>https://github.com/glumes/AndroidOpenGLTutorial</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-face-culling-usage/","title":"OpenGL \u4f18\u5316\u9879\u4e4b\u9762\u5254\u9664\u548c\u6ce8\u610f\u70b9","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/mMUS1ewazFqCqtRgOchDYw</p> <p>\u73b0\u5728\u6211\u4eec\u7528 OpenGL \u7ed8\u5236\u4e86\u5982\u4e0b\u7684\u7acb\u65b9\u4f53\uff1a</p> <p> </p> <p>\u4e0d\u7ba1\u6211\u4eec\u600e\u4e48\u65cb\u8f6c\u7acb\u65b9\u4f53\uff0c\u4ece\u4efb\u4f55\u4e00\u4e2a\u65b9\u5411\u53bb\u770b\u5b83\uff0c\u6700\u591a\u90fd\u53ea\u80fd\u770b\u5230\u4e09\u4e2a\u9762\u3002</p> <p>\u90a3\u4e48\u5bf9\u4e8e OpenGL \u6765\u8bf4\uff0c\u90a3\u770b\u4e0d\u5230\u7684\u53e6\u5916\u4e09\u4e2a\u9762\u5b8c\u5168\u53ef\u4ee5\u4e0d\u7528\u7ed8\u5236\u5b83\uff0c\u4ece\u800c\u63d0\u9ad8\u7ed8\u5236\u7684\u6027\u80fd\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-face-culling-usage/#_1","title":"\u9762\u5254\u9664","text":"<p>\u65e2\u7136\u73b0\u5728\u8981\u628a\u770b\u4e0d\u5230\u7684\u9762\u4e22\u5f03\uff0c\u90a3\u4e48\u95ee\u9898\u5c31\u6765\u4e86\uff1a</p> <p>\u5982\u4f55\u53bb\u786e\u5b9a\u54ea\u4e2a\u9762\u770b\u5f97\u5230\uff0c\u54ea\u4e2a\u9762\u770b\u4e0d\u5230\u5462\uff1f</p> <p>\u5728 OpenGL \u4e2d\u5141\u8bb8\u68c0\u67e5\u6240\u6709\u6b63\u9762\u671d\u5411\u89c2\u5bdf\u8005\u7684\u9762\uff0c\u5e76\u6e32\u67d3\u5b83\u4eec\uff0c\u800c\u4e22\u5f03\u6240\u6709\u80cc\u5411\u89c2\u5bdf\u8005\u7684\u9762\uff0c\u8fd9\u5c31\u53ef\u4ee5\u8282\u7701\u7247\u6bb5\u7740\u8272\u5668\u7684\u8fd0\u884c\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u544a\u8bc9 OpenGL \u54ea\u4e2a\u9762\u662f\u6b63\u9762\uff0c\u54ea\u4e2a\u9762\u662f\u80cc\u9762\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-face-culling-usage/#_2","title":"\u901a\u8fc7\u9876\u70b9\u8fde\u63a5\u987a\u5e8f\u786e\u5b9a\u6b63\u53cd\u9762","text":"<p>\u5f53\u6211\u4eec\u901a\u8fc7\u4e09\u89d2\u5f62\u6765\u7ed8\u5236\u5f62\u72b6\u65f6\uff0c\u4f1a\u5b9a\u4e49\u9876\u70b9\u8fde\u63a5\u7684\u987a\u5e8f\uff0c\u5b83\u53ef\u80fd\u662f\u987a\u65f6\u9488\u6216\u9006\u65f6\u9488\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u5de6\u4fa7\u4e09\u89d2\u5f62\u5c31\u662f\u987a\u65f6\u9488\u65b9\u5411\uff0c\u53f3\u4fa7\u5c31\u662f\u9006\u65f6\u9488\u65b9\u5411\u3002</p> <p>\u800c OpenGL \u5c31\u662f\u5229\u7528\u8fd9\u4e2a\u4e09\u89d2\u5f62\u7684\u987a\u65f6\u9488\u6216\u9006\u65f6\u9488\u65b9\u5411\u6765\u51b3\u5b9a\u4e09\u89d2\u5f62\u662f\u6b63\u9762\u8fd8\u662f\u53cd\u9762\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u9006\u65f6\u9488\u7684\u9876\u70b9\u8fde\u63a5\u987a\u5e8f\u88ab\u5b9a\u4e49\u4e3a\u4e09\u89d2\u5f62\u7684\u6b63\u9762</p> <p>\u9006\u65f6\u9488\u6216\u987a\u65f6\u9488\u90fd\u662f\u76f8\u5bf9\u4e8e\u89c2\u5bdf\u8005\u65b9\u5411\u7684</p> <p>\u5f53\u5b9a\u4e49\u9876\u70b9\u987a\u5e8f\u65f6\uff0c\u5e94\u8be5\u60f3\u8c61\u5bf9\u5e94\u7684\u4e09\u89d2\u5f62\u662f\u9762\u5411\u4f60\u7684\uff0c\u6240\u4ee5\u5b9a\u4e49\u7684\u4e09\u89d2\u5f62\u9876\u70b9\u65b9\u5411\u5e94\u8be5\u9006\u65f6\u9488\u7684\u3002</p> <p>\u8fd9\u6837\u5b9a\u4e49\u7684\u597d\u5904\u5728\u4e8e\u4e09\u89d2\u5f62\u9876\u70b9\u7684\u5b9e\u9645\u8fde\u63a5\u987a\u5e8f\u662f\u5728\u5149\u6805\u5316\u9636\u6bb5\u8fdb\u884c\u7684\uff0c\u4e5f\u5c31\u662f\u9876\u70b9\u7740\u8272\u5668\u8fd0\u884c\u4e4b\u540e\uff0c\u8fd9\u4e9b\u9876\u70b9\u5c31\u662f\u4ee5\u89c2\u5bdf\u8005\u89c6\u89d2\u6240\u89c1\u7684\u4e86\u3002</p> <p>\u5bf9\u4e8e\u4e0a\u56fe\uff0c\u5de6\u4fa7\u4e09\u89d2\u5f62 1 -&gt; 2 -&gt;3 \u7684\u8fde\u63a5\u987a\u5e8f\u662f\u987a\u65f6\u9488\u7684\uff0c\u8fd9\u662f\u5728\u89c2\u5bdf\u8005\u4f4d\u4e8e\u5c4f\u5e55\u524d\u770b\u5230\u7684\uff0c\u5982\u679c\u89c2\u5bdf\u8005\u4f4d\u4e8e\u5c4f\u5e55\u540e\uff0c\u8fde\u63a5\u987a\u5e8f\u4f9d\u65e7\u662f 1 -&gt; 2 -&gt; 3 \uff0c\u90a3\u4e48\u5c31\u662f\u9006\u65f6\u9488\u4e86\u3002</p> <p>\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u8bf4\uff0c\u5b9a\u4e49\u4e09\u89d2\u5f62\u9876\u70b9\u987a\u5e8f\u65f6\u8981\u5047\u8bbe\u4e09\u89d2\u5f62\u662f\u9762\u5411\u4f60\u7684\uff0c\u4fdd\u8bc1\u9006\u65f6\u9488\u5b9a\u4e49\uff0c\u5e76\u4e14\u53ef\u4ee5\u6839\u636e\u89c2\u5bdf\u8005\u65b9\u5411\u7684\u6539\u53d8\uff0c\u987a\u65f6\u9488\u548c\u9006\u65f6\u9488\u65b9\u5411\u4f1a\u53d1\u751f\u6539\u53d8\u3002</p> <p>\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e09\u89d2\u5f62\u7684\u9876\u70b9\u987a\u5e8f\u90fd 1 -&gt; 2 -&gt; 3\uff0c\u5f53\u6211\u4eec\u5b9a\u4e49\u8fd9\u4e2a\u987a\u5e8f\u65f6\uff0c\u90fd\u662f\u5047\u8bbe\u89c2\u5bdf\u8005\u6b63\u9762\u5411\u8fd9\u4e2a\u4e09\u89d2\u5f62\u5462\uff0c\u6240\u4ee5\u90fd\u662f\u9006\u65f6\u9488\u5b9a\u4e49\u7684\u3002</p> <p>\u4f46\u662f\u4ece\u53f3\u4fa7\u773c\u955c\u5904\u6765\u89c2\u5bdf\uff0c\u53f3\u4fa7\u4e09\u89d2\u5f62\u65b9\u5411\u662f\u9006\u65f6\u9488\u7684\uff0c\u5de6\u4fa7\u4e09\u89d2\u5f62\u65b9\u5411\u662f\u987a\u65f6\u9488\u7684\uff0c\u8fd9\u5c31\u662f\u56e0\u4e3a\u5bf9\u4e8e\u53f3\u4fa7\u4e09\u89d2\u5f62\u6765\u8bf4\uff0c\u89c2\u5bdf\u8005\u65b9\u5411\u548c\u5f53\u521d\u5b9a\u4e49\u987a\u5e8f\u65f6\u7684\u5047\u8bbe\u65b9\u5411\u4e00\u81f4\uff0c\u800c\u5bf9\u4e8e\u5de6\u4fa7\u4e09\u89d2\u5f62\uff0c\u89c2\u5bdf\u8005\u65b9\u5411\u5c31\u548c\u5b9a\u4e49\u987a\u5e8f\u65f6\u7684\u5047\u8bbe\u65b9\u5411\u76f8\u53cd\u4e86\uff0c\u6240\u4ee5\u4ece\u53cd\u65b9\u5411\u6765\u770b\u5c31\u6210\u4e86\u987a\u65f6\u9488\u4e86\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5728\u9762\u5254\u9664\u7684\u4f18\u5316\u4e0b\uff0c\u53f3\u4fa7\u9762\u53ef\u89c1\uff0c\u5de6\u4fa7\u9762\u4e0d\u53ef\u89c1\u4e86\uff0c\u4e5f\u5c31\u662f\u9762\u5411\u89c2\u5bdf\u8005\u7684\u6b63\u9762\u53ef\u89c1\uff0c\u53cd\u9762\u4e0d\u53ef\u89c1\u4e86\u3002</p> <p>\u770b\u4e86\u597d\u591a\u6587\u7ae0\uff0c\u90fd\u6ca1\u6709\u8bb2\uff1a\u4e3a\u4ec0\u4e48\u8981\u9006\u65f6\u9488\u5b9a\u4e49\u4e09\u89d2\u5f62\u65b9\u5411\uff0c\u4f46\u662f\u89c2\u5bdf\u65f6\u5374\u6210\u4e86\u987a\u65f6\u9488\u4e86\uff0c\u5c31\u662f\u56e0\u4e3a\u5f53\u521d\u5b9a\u4e49\u7684\u9006\u65f6\u9488\u65b9\u5411\u5176\u5b9e\u662f\u548c\u89c2\u5bdf\u8005\u65b9\u5411\u6302\u94a9\u7684\u3002</p> <p>\u5f53\u4e0a\u56fe\u7684\u89c2\u5bdf\u8005\u65b9\u5411\u53d8\u6210\u4e86\u5de6\u4fa7\uff0c\u90a3\u4e48\u9876\u70b9\u8fde\u63a5\u987a\u5e8f\u90fd\u8fd8\u662f  1 -&gt; 2 -&gt; 3 \u7684\u60c5\u51b5\u4e0b\uff0c\u5de6\u4fa7\u4e09\u89d2\u5f62\u7684\u987a\u5e8f\u5c31\u548c\u5f53\u521d\u5b9a\u4e49\u9876\u70b9\u987a\u5e8f\u4e00\u6837\u6210\u4e86\u9006\u65f6\u9488\u53ef\u89c1\uff0c\u800c\u53f3\u4fa7\u7684\u4e09\u89d2\u5f62\u9876\u70b9\u987a\u5e8f\u5c31\u6210\u4e86\u987a\u65f6\u9488\u4e0d\u53ef\u89c1\u3002</p> <p>\u660e\u767d\u4e86\u8fd9\u4e00\u70b9\uff0c\u5c31\u5bf9\u4e8e\u9762\u5254\u9664\u66f4\u52a0\u6e05\u6670\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-face-culling-usage/#_3","title":"\u5177\u4f53\u4f7f\u7528","text":"<p>\u5728 OpenGL \u4e2d\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u65b9\u6cd5\u5f00\u542f\u9762\u5254\u9664\uff1a</p> <p><pre><code>glEnable(GLES20.GL_CULL_FACE)\n</code></pre> \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u9762\u5254\u9664\u662f\u5173\u95ed\u7684\u3002</p> <p>\u5f00\u542f\u9762\u5254\u9664\u540e\uff0c\u6240\u6709\u7684\u80cc\u5411\u89c2\u5bdf\u8005\u7684\u9762\u90fd\u4f1a\u88ab\u4e22\u5f03\uff0c\u8282\u7701\u6e32\u67d3\u6027\u80fd\u3002</p> <p>\u53e6\u5916\uff0cOpenGL \u8fd8\u63d0\u4f9b\u4e86\u5176\u4ed6\u529f\u80fd\u6765\u9009\u62e9\u8981\u5254\u9664\u7684\u9762\u3002</p> <pre><code>    public static native void glCullFace(\n        int mode\n    );\n</code></pre> <p>\u6709\u4e09\u4e2a\u6a21\u5f0f\u53ef\u9009\uff1a</p> <ul> <li>GL_BACK\uff1a\u53ea\u5254\u9664\u80cc\u5411\u9762</li> <li>GL_FRONT\uff1a\u53ea\u5254\u9664\u6b63\u5411\u9762</li> <li>GL_FRONT_AND_BACK\uff1a\u5254\u9664\u6b63\u5411\u9762\u548c\u80cc\u5411\u9762</li> </ul> <p>glCullFace \u7684\u521d\u59cb\u503c\u662f GL_BACK\uff0c\u53ea\u5254\u9664\u80cc\u5411\u9762\u3002</p> <p>\u9664\u4e86\u9700\u8981\u5254\u9664\u7684\u9762\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 glFrontFace \u65b9\u6cd5\u544a\u8bc9 OpenGL \u5c06\u987a\u65f6\u9488\u7684\u9762\uff08\u800c\u4e0d\u662f\u9006\u65f6\u9488\u7684\u9762\uff09\u5b9a\u4e49\u4e3a\u6b63\u5411\u9762\u3002</p> <pre><code>    public static native void glFrontFace(\n        int mode\n    );\n</code></pre> <p>\u5b83\u6709\u4e24\u4e2a\u9009\u9879\uff1a</p> <ul> <li>GL_CCW\uff1a\u4ee3\u8868\u9006\u65f6\u9488\u65b9\u5411\u4e3a\u6b63\u5411\u9762</li> <li>GL_CW\uff1a\u4ee3\u8868\u987a\u65f6\u9488\u65b9\u5411\u4e3a\u6b63\u5411\u9762</li> </ul> <p>glFrontFace \u6a21\u5f0f\u503c\u662f GL_CCW\uff0c\u9006\u65f6\u9488\u65b9\u5411\u4e3a\u6b63\u5411\u9762\u3002</p> <p>\u73b0\u5047\u8bbe\u5f00\u542f\u9762\u5254\u9664\uff0c\u5e76\u4e14\u5254\u9664\u6b63\u5411\uff0c\u987a\u65f6\u9488\u4e3a\u6b63\u5411\uff1a</p> <pre><code>    glEnable(GL_CULL_FACE);\n    glCullFace(GL_FRONT);\n    glFrontFace(GL_CW);\n</code></pre>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-face-culling-usage/#_4","title":"\u5c0f\u7ed3","text":"<ol> <li> <p>\u4f7f\u7528\u9762\u5254\u9664\u53ef\u4ee5\u4f18\u5316\u6e32\u67d3\u8fc7\u7a0b\uff0c\u7701\u4e0b\u8d85\u8fc7 50 % \u7684\u7247\u6bb5\u7740\u8272\u5668\u6267\u884c\u6570\u3002</p> </li> <li> <p>\u4f7f\u7528\u9762\u5254\u9664\u65f6\u5b9a\u4e49\u9876\u70b9\u8981\u4ee5\u9006\u65f6\u9488\u65b9\u5411\u5b9a\u4e49\u3002</p> </li> <li> <p>\u9006\u65f6\u9488\u6216\u987a\u65f6\u9488\u90fd\u662f\u76f8\u5bf9\u4e8e\u89c2\u5bdf\u8005\u65b9\u5411\u7684\u3002</p> </li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-face-culling-usage/#_5","title":"\u53c2\u8003","text":"<ol> <li>https://learnopengl-cn.github.io/04%20Advanced%20OpenGL/04%20Face%20culling/</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-gldrawelements-method/","title":"OpenGL \u7684 glDrawElements  \u7ed8\u5236\u65b9\u6cd5","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/WcWdYE5j8Ycw2dtJYS-Cxg</p> <p>\u5728\u4e4b\u524d\u7684\u7ed8\u5236\u4e2d\uff0c\u6211\u4eec\u90fd\u662f\u901a\u8fc7 <code>glDrawArrays</code> \u65b9\u6cd5\u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4f1a\u6309\u7167\u6211\u4eec\u4f20\u5165\u7684\u9876\u70b9\u987a\u5e8f\u548c\u6307\u5b9a\u7684\u7ed8\u5236\u65b9\u5f0f\u8fdb\u884c\u7ed8\u5236\u3002</p> <p>\u56de\u987e\u4e00\u4e0b\u4e4b\u524d\u63d0\u5230\u7684\u7ed8\u5236\u7c7b\u578b\uff1a</p> \u7ed8\u5236\u7c7b\u578b \u7ed8\u5236\u65b9\u5f0f GL_POINTS \u5c06\u4f20\u5165\u7684\u9876\u70b9\u5750\u6807\u4f5c\u4e3a\u5355\u72ec\u7684\u70b9\u7ed8\u5236 GL_LINES \u5c06\u4f20\u5165\u7684\u5750\u6807\u4f5c\u4e3a\u5355\u72ec\u7ebf\u6761\u7ed8\u5236\uff0cABCDEFG\u516d\u4e2a\u9876\u70b9\uff0c\u7ed8\u5236AB\u3001CD\u3001EF\u4e09\u6761\u7ebf GL_LINE_STRIP \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u6298\u7ebf\u7ed8\u5236\uff0cABCD\u56db\u4e2a\u9876\u70b9\uff0c\u7ed8\u5236AB\u3001BC\u3001CD\u4e09\u6761\u7ebf GL_LINE_LOOP \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u95ed\u5408\u6298\u7ebf\u7ed8\u5236\uff0cABCD\u56db\u4e2a\u9876\u70b9\uff0c\u7ed8\u5236AB\u3001BC\u3001CD\u3001DA\u56db\u6761\u7ebf\u3002 GL_TRIANGLES \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u5355\u72ec\u7684\u4e09\u89d2\u5f62\u7ed8\u5236\uff0cABCDEF\u7ed8\u5236ABC,DEF\u4e24\u4e2a\u4e09\u89d2\u5f62 GL_TRIANGLE_STRIP \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u4e09\u89d2\u6761\u5e26\u7ed8\u5236\uff0cABCDEF\u7ed8\u5236ABC,BCD,CDE,DEF\u56db\u4e2a\u4e09\u89d2\u5f62 GL_TRIANGLE_FAN \u5c06\u4f20\u5165\u7684\u9876\u70b9\u4f5c\u4e3a\u6247\u9762\u7ed8\u5236\uff0cABCDEF\u7ed8\u5236ABC\u3001ACD\u3001ADE\u3001AEF\u56db\u4e2a\u4e09\u89d2\u5f62 <p>\u5047\u8bbe\u8981\u7ed8\u5236\u4e00\u4e2a\u7acb\u65b9\u4f53\uff0c\u4ee5 <code>GL_TRIANGLES</code> \u7684\u7c7b\u578b\u8fdb\u884c\u7ed8\u5236\uff0c\u90a3\u4e48\u516d\u4e2a\u9762\uff0c\u6bcf\u4e2a\u9762\u7531\u4e24\u4e2a\u4e09\u89d2\u5f62\u7ec4\u6210\uff0c\u5c31\u5f97\u5411\u6e32\u67d3\u7ba1\u7ebf\u4f20\u5165 36 \u4e2a\u9876\u70b9\uff0c36 \u4e2a\u9876\u70b9\u6309\u7167\u987a\u5e8f\u8fdb\u884c\u7ed8\u5236\uff0c\u800c\u5b9e\u9645\u4e0a\uff0c\u4e00\u4e2a\u77e9\u5f62\u4e5f\u5c31\u624d 8 \u4e2a\u9876\u70b9\u800c\u5df2\u3002</p> <p>\u4e3a\u4e86\u4f18\u5316\u7ed8\u5236\u7684\u6548\u7387\uff0c\u51cf\u5c11\u6570\u636e\u7684\u4f20\u9012\uff0c\u4e8e\u662f\u5c31\u6709\u4e86 <code>glDrawElements</code> \u7ed8\u5236\u65b9\u6cd5\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-gldrawelements-method/#gldrawelements","title":"glDrawElements \u7ed8\u5236\u65b9\u6cd5","text":"<p><code>glDrawElements</code> \u65b9\u6cd5\u8fd8\u662f\u9700\u8981\u4f20\u9012\u9876\u70b9\u6570\u636e\uff0c\u4f46\u53ea\u9700\u8981\u4f20\u9012\u7269\u4f53\u5b9e\u9645\u4e0a\u7684\u9876\u70b9\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u6700\u5c11\u7684\uff0c\u4e0d\u91cd\u590d\u7684\u9876\u70b9\u6570\u636e\u3002</p> <p>\u7136\u540e\u518d\u5411\u6e32\u67d3\u7ba1\u7ebf\u4f20\u9012\u8981\u7ed8\u5236\u7684\u9876\u70b9\u6570\u636e\u7684\u7d22\u5f15\uff0c\u6839\u636e\u7d22\u5f15\u4ece\u9876\u70b9\u6570\u636e\u4e2d\u53d6\u51fa\u5bf9\u5e94\u7684\u9876\u70b9\uff0c\u7136\u540e\u518d\u6309\u7167\u6307\u5b9a\u7684\u65b9\u5f0f\u8fdb\u884c\u7ed8\u5236\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u56fe\u7247\u622a\u81ea\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u4e0a\u5377\u300b\uff1a</p> <p></p> <p>\u7531\u4e09\u4e2a\u4e09\u89d2\u5f62\u7ec4\u6210\u7684\u5012\u7f6e\u7684\u68af\u5f62\uff0c\u5b9e\u9645\u4e0a\u53ea\u6709\u4e94\u4e2a\u9876\u70b9 $ {v0,v1,v2,v3,v4}$\uff0c\u56e0\u6b64\u4e5f\u53ea\u4f20\u9012\u4e86\u4e94\u4e2a\u9876\u70b9\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u786e\u5b9a\u8fd9\u4e2a\u4e94\u4e2a\u9876\u70b9\u7684\u7d22\u5f15\u987a\u5e8f\u3002</p> <p>\u7d22\u5f15\u987a\u5e8f\u548c\u6211\u4eec\u8981\u7ed8\u5236\u7684\u65b9\u5f0f\u6709\u5f88\u5927\u7684\u5173\u7cfb\uff0c\u4e0d\u540c\u7ed8\u5236\u65b9\u5f0f\u7684\u7d22\u5f15\u987a\u5e8f\u4e0d\u540c\u3002</p> <p>\u91c7\u7528 <code>GL_TRIANGLE_STRIP</code> \u7684\u7c7b\u578b\u7ed8\u5236\uff0c\u90a3\u4e48\u7d22\u5f15\u987a\u5e8f\u5c31\u662f \\(\\{0,1,2,3,4\\}\\)\u3002</p> <p>\u5177\u4f53\u65b9\u6cd5\u8c03\u7528\u60c5\u51b5\u4ee3\u7801\uff1a</p> <pre><code>    // \u51fd\u6570\u539f\u578b\n    public static native void glDrawElements(\n        int mode, // \u7ed8\u5236\u65b9\u5f0f\n        int count, // \u7ed8\u5236\u6570\u91cf\n        int type, // \u7d22\u5f15\u7684\u6570\u636e\u7c7b\u578b\n        java.nio.Buffer indices // \u7d22\u5f15\u7f13\u51b2\n    );\n    // \u5b9a\u4e49\u9876\u70b9\u7684\u7d22\u5f15\u6570\u636e\n    private byte[] front = {\n            // \u524d\u9762\u7d22\u5f15\n            0, 1, 2, 3\n    };\n    // \u7d22\u5f15\u6570\u636e\u4f20\u9012\u5230\u7f13\u51b2\u533a\n    private ByteBuffer frontBuffer = ByteBuffer.allocateDirect(indices.length *Constants.BYTES_PRE_BYTE)\n                                     .put(indices)\n    frontBuffer.position(0)                              \n    // glDrawElements \u7ed8\u5236\n    GLES20.glDrawElements(GLES20.GL_TRIANGLE_STRIP,front.size,GLES20.GL_UNSIGNED_BYTE, frontBuffer)\n    // glDrawArrays \u7ed8\u5236\n    // GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, 0, 4)\n</code></pre> <p>\u5728\u51fd\u6570\u539f\u578b\u4e2d\u5b9a\u4e49\u4e86\u8981\u4f20\u5165\u7684\u53c2\u6570\uff0c\u6839\u636e\u8981\u7ed8\u5236\u7684\u65b9\u6cd5\u548c\u7d22\u5f15\u7f13\u51b2\u533a\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u70b9\u8fdb\u884c\u7ed8\u5236\u3002</p> <p>\u5bf9\u4e8e\u7ed8\u5236\u65f6\u6709\u91cd\u590d\u70b9\uff0c\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5c31\u53ef\u4ee5\u51cf\u5c11\u5411\u6e32\u67d3\u7ba1\u7ebf\u4e2d\u4f20\u9012\u91cd\u590d\u7684\u70b9\u4e86\u3002</p> <p>\u800c\u4e14\uff0c\u5728\u5b9a\u4e49\u4e00\u4e2a\u9876\u70b9\u65f6\uff0c\u5927\u90fd\u662f <code>float</code> \u7c7b\u578b\uff0c\u5b83\u662f\u56db\u4e2a\u5b57\u8282\uff0c\u800c\u5bf9\u4e8e\u7ed8\u5236\u91cf\u6bd4\u8f83\u5c0f\uff0c\u9876\u70b9\u6570\u91cf\u5728 <code>byte</code> \u6240\u80fd\u8868\u8fbe\u6574\u6570\u8303\u56f4\u5185\uff0c\u53ef\u4ee5\u91c7\u7528 <code>byte</code> \u7c7b\u578b\u5b9a\u4e49\u7d22\u5f15\u987a\u5e8f\uff0c\u5b83\u53ea\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u51cf\u5c11\u4e86\u5185\u5b58\u7684\u4f7f\u7528\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-gldrawelements-method/#gldrawelements-gldrawarrays","title":"glDrawElements \u548c glDrawArrays \u7684\u5bf9\u6bd4","text":"<p><code>glDrawElements</code> \u65b9\u6cd5\u7684 <code>count</code> \u7684\u53c2\u6570\u5b9a\u4e49\u4e86\u8981\u53d6\u591a\u5c11\u4e2a\u7d22\u5f15\u51fa\u6765\u7ed8\u5236\uff0c\u800c\u4e14\u8fd9\u4e2a\u7ed8\u5236\u662f\u8fde\u7eed\u7684\uff0c\u5fc5\u987b\u8981\u628a <code>count</code> \u6570\u91cf\u7684\u9876\u70b9\u7ed8\u5236\u5b8c\u3002</p> <p>\u8fd9\u91cc\u5c31\u6709\u4e00\u4e2a\u5f88\u6709\u610f\u601d\u7684\u5730\u65b9\u4e86\uff0c\u6709\u4e00\u4e9b\u5c0f\u6e38\u620f\u662f\u8fd9\u6837\u7684\uff1a\u8981\u6c42\u4e00\u7b14\u7ed8\u5236\u5b8c\u4e00\u4e2a\u5f62\u72b6\uff0c\u800c\u4e14\u4e0d\u5141\u8bb8\u4ea4\u53c9\u3002</p> <p>\u6bd4\u5982\uff0c\u8981\u6c42\u4e00\u7b14\u7ed5\u8fc7\u7acb\u65b9\u4f53\u7684\u516d\u4e2a\u9762\uff0c\u800c\u4e14\u4e0d\u5141\u8bb8\u4ea4\u53c9\uff0c\u8fd9\u5c31\u5f88\u96be\u505a\u5230\u7684\u4e86\u3002</p> <p>\u800c\u4f7f\u7528 <code>glDrawElements</code> \u65b9\u6cd5\u540c\u6837\u4f1a\u8fd9\u6837\uff0c\u91c7\u7528\u7d22\u5f15\u4e0d\u80fd\u4e00\u6b21\u4e0d\u4ea4\u53c9\u7684\u628a\u56fe\u5f62\u5168\u90e8\u7ed8\u5236\u5b8c\uff0c\u5f97\u91c7\u53d6\u4e24\u6b21\u7ed8\u5236\u3002</p> <p>\u6bd4\u5982\u5728\u5b9e\u8df5\u7ed8\u5236\u4e00\u4e2a\u7acb\u65b9\u4f53\u65f6\uff0c\u91c7\u7528\u4e86\u5982\u4e0b\u7684\u65b9\u5f0f\uff1a</p> <pre><code>    // \u524d\u9762\u7d22\u5f15\n    private byte[] front = {0, 1, 2, 3};\n    // \u540e\u9762\u7d22\u5f15\n    private byte[] back = { 4, 5, 6, 7};\n    // \u4e0a\u9762\u7d22\u5f15\n    private byte[] top = {0, 1, 4, 5};\n    // \u4e0b\u9762\u7d22\u5f15\n    private byte[] bottom = { 2, 3, 6, 7};\n    // \u5de6\u9762\u7d22\u5f15\n    private byte[] left = {0, 4, 2, 6};\n    // \u53f3\u4fa7\u7d22\u5f15\n    private byte[] right = {1, 5, 3, 7};\n</code></pre> <p>\u628a\u7acb\u65b9\u4f53\u5206\u89e3\u6210\u4e86\u516d\u4e2a\u9762\u7684\u5185\u5bb9\u8fdb\u884c\u7ed8\u5236\uff0c\u4e5f\u5c31\u662f\u91c7\u7528\u4e86\u516d\u4e2a\u7d22\u5f15\u7f13\u5b58\u3002</p> <p>\u800c\u5bf9\u4e8e\u4f7f\u7528 <code>glDrawArrays</code>\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4e00\u6b21\u6027\u628a\u6240\u6709\u9876\u70b9\u4f20\u5230\u6e32\u67d3\u7ba1\u7ebf\uff0c\u5e76\u4e14\u53ef\u4ee5\u9009\u62e9\u7ed8\u5236\u7684\u5f00\u59cb\u548c\u7ed3\u5c3e\u70b9\uff0c\u8fd9\u6837\u5c31\u53ea\u8981\u4e00\u4e2a\u7f13\u51b2\u533a\u5c31\u597d\u4e86\uff0c\u4e0d\u8fc7\u4ee3\u7801\u5c31\u662f\u8981\u591a\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u4e86\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0c\u80fd\u7528 glDrawElements \u65b9\u5f0f\u7684\u8fd8\u662f\u8981\u91c7\u7528\u7684\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-import-3d-object/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b 3D \u6a21\u578b\u52a0\u8f7d\u548c\u6e32\u67d3","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/OCcTOJArxipvY-v_HuD0Eg</p> <p>\u5728\u4f7f\u7528 OpenGL \u7ed8\u5236\u65f6\uff0c\u6211\u4eec\u6700\u591a\u7ed8\u5236\u7684\u662f\u4e00\u4e9b\u7b80\u5355\u7684\u56fe\u5f62\uff0c\u6bd4\u5982\u4e09\u89d2\u5f62\u3001\u5706\u5f62\u3001\u7acb\u65b9\u4f53\u7b49\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u56fe\u5f62\u7684\u9876\u70b9\u6570\u91cf\u4e0d\u591a\uff0c\u8fd8\u662f\u53ef\u4ee5\u624b\u52a8\u7684\u5199\u51fa\u90a3\u4e9b\u9876\u70b9\u7684\uff0c\u53ef\u8981\u662f\u7ed8\u5236\u4e00\u4e9b\u590d\u6742\u56fe\u5f62\u8be5\u600e\u4e48\u529e\u5462\uff1f</p> <p>\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u4f7f\u7528 OpenGL \u6765\u52a0\u8f7d 3D \u6a21\u578b\u3002\u5148\u4f7f\u7528 3D \u5efa\u6a21\u5de5\u5177\u6784\u5efa\u7269\u4f53\uff0c\u7136\u540e\u518d\u5c06\u7269\u4f53\u5bfc\u51fa\u6210\u7279\u5b9a\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u6700\u7ec8\u901a\u8fc7 OpenGL \u6e32\u67d3\u6a21\u578b\u3002</p> <p>\u4f8b\u5982\u5982\u4e0b\u7684 3D \u6a21\u578b\u6587\u4ef6\u56fe\u50cf\uff1a</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-import-3d-object/#obj","title":"Obj \u6a21\u578b\u6587\u4ef6","text":"<p>obj \u6a21\u578b\u6587\u4ef6\u662f\u4f17\u591a 3D \u6a21\u578b\u6587\u4ef6\u4e2d\u7684\u4e00\u79cd\uff0c\u5b83\u7684\u683c\u5f0f\u6bd4\u8f83\u7b80\u5355\uff0c\u672c\u8d28\u4e0a\u5c31\u662f\u6587\u672c\u6587\u4ef6\uff0c\u53ea\u662f\u683c\u5f0f\u56fa\u5b9a\u4e86\u683c\u5f0f\u3002</p> <p>obj \u6587\u4ef6\u5c06\u9876\u70b9\u5750\u6807\u3001\u4e09\u89d2\u5f62\u9762\u3001\u7eb9\u7406\u5750\u6807\u7b49\u4fe1\u606f\u4ee5\u56fa\u5b9a\u683c\u5f0f\u7684\u6587\u672c\u5b57\u7b26\u4e32\u8868\u793a\u3002</p> <p>\u622a\u53d6\u4e00\u5c0f\u6bb5 obj \u6587\u4ef6\u5185\u5bb9\uff1a</p> <pre><code># Max2Obj Version 4.0 Mar 10th, 2001\n#\n# object (null) to come ...\n#\nv  -0.052045 11.934561 -0.071060\nv  -0.052045 11.728649 1.039199\n...\n# 288 vertices\nvt 0.000000 0.000000 0.000000\nvt 1.000000 0.000000 0.000000\n...\nvt 1.000000 1.000000 0.000000\n# 122 texture vertices\nvn 0.000000 0.000000 -1.570796\nvn 0.000000 0.000000 -1.570796\n...\nvn 0.000000 0.000000 1.570796\n# 8 vertex normals\ng (null)\nf 1/10/1 14/12/11 13/4/11 \nf 1/11/4 2/12/3 14/12/11\n...\nf 5/4/5 7/3/7 3/1/3\n# 576 faces\ng\n</code></pre> <ul> <li>\"#\" \u5f00\u5934\u7684\u884c\u8868\u793a\u6ce8\u91ca\uff0c\u52a0\u8f7d\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u5ffd\u7565</li> <li>\u201cv\u201d \u5f00\u5934\u7684\u884c\u7528\u4e8e\u5b58\u653e\u9876\u70b9\u5750\u6807\uff0c\u540e\u9762\u4e09\u4e2a\u6570\u8868\u793a\u4e00\u4e2a\u9876\u70b9\u7684 x , y , z \u5750\u6807     \u5982\uff1a</li> </ul> <pre><code>v  -0.052045 11.934561 -0.071060\n</code></pre> <ul> <li> <p>\"vt\" \u5f00\u5934\u7684\u884c\u8868\u793a\u5b58\u653e\u9876\u70b9\u7eb9\u7406\u5750\u6807\uff0c\u540e\u9762\u4e09\u4e2a\u6570\u8868\u793a\u7eb9\u7406\u5750\u6807\u7684 S\uff0cT\uff0cP \u5206\u91cf\uff0c\u5176\u4e2d P \u6307\u7684\u662f\u6df1\u5ea6\u7eb9\u7406\u91c7\u6837\uff0c\u4e3b\u8981\u7528\u4e8e 3D \u7eb9\u7406\u7684\u91c7\u6837\uff0c\u4f46\u4f7f\u7528\u7684\u8f83\u5c11     \u5982\uff1a <pre><code>vt 0.000000 0.000000 0.000000\n</code></pre></p> </li> <li> <p>\"vn\" \u5f00\u5934\u7684\u884c\u7528\u4e8e\u5b58\u653e\u9876\u70b9\u6cd5\u5411\u91cf\uff0c\u540e\u9762\u4e09\u4e2a\u6570\u5206\u522b\u8868\u793a\u4e00\u4e2a\u9876\u70b9\u7684\u6cd5\u5411\u91cf\u5728 x \u8f74\uff0cy \u8f74\uff0cz \u8f74\u4e0a\u7684\u5206\u91cf\u3002     \u5982\uff1a <pre><code>vn 0.000000 0.000000 1.570796\n</code></pre></p> </li> <li>\u201cg\u201d \u5f00\u5934\u7684\u884c\u8868\u793a\u4e00\u7ec4\u7684\u5f00\u59cb\uff0c\u540e\u9762\u7684\u5b57\u7b26\u4e32\u4e3a\u6b64\u7ec4\u7684\u540d\u79f0\u3002\u7ec4\u5c31\u662f\u7531\u9876\u70b9\u7ec4\u6210\u7684\u4e00\u4e9b\u9762\u7684\u96c6\u5408\uff0c\u53ea\u5305\u542b \u201cg\u201d \u7684\u884c\u8868\u793a\u4e00\u7ec4\u7684\u7ed3\u675f\uff0c\u4e0e \u201cg\u201d \u5f00\u5934\u7684\u884c\u5bf9\u5e94\u3002</li> <li>\"f\" \u5f00\u5934\u7684\u884c\u8868\u793a\u7ec4\u4e2d\u7684\u4e00\u4e2a\u9762\uff0c\u5bf9\u4e8e\u4e09\u89d2\u5f62\u56fe\u5f62\uff0c\u540e\u9762\u6709\u4e09\u7ec4\u7528\u7a7a\u683c\u5206\u9694\u7684\u6570\u636e\uff0c\u4ee3\u8868\u4e09\u89d2\u5f62\u7684\u4e09\u4e2a\u9876\u70b9\u3002\u6bcf\u7ec4\u6570\u636e\u4e2d\u5305\u542b 3 \u4e2a\u6570\u503c\uff0c\u7528 <code>/</code> \u5206\u9694\uff0c\u4f9d\u6b21\u8868\u793a**\u9876\u70b9\u5750\u6807\u6570\u636e\u7d22\u5f15**\u3001\u9876\u70b9\u7eb9\u7406\u5750\u6807\u6570\u636e\u7d22\u5f15\u3001\u9876\u70b9\u6cd5\u5411\u91cf\u6570\u636e\u7d22\u5f15\uff0c\u6ce8\u610f\u8fd9\u91cc\u90fd\u662f\u6307\u7d22\u5f15\uff0c\u800c\u4e0d\u662f\u6307\u5177\u4f53\u6570\u636e\uff0c\u7d22\u5f15\u6307\u5411\u7684\u662f\u5177\u4f53\u54ea\u4e00\u884c\u5bf9\u5e94\u7684\u5750\u6807     \u5982\uff1a <pre><code>f 1/10/1 14/12/11 13/4/12 \n</code></pre> \u5982\u4e0a\u6570\u636e\u4ee3\u8868\u4e86\u4e09\u4e2a\u9876\u70b9\uff0c\u5176\u4e2d\u4e09\u89d2\u5f62 3 \u4e2a\u9876\u70b9\u5750\u6807\u6765\u81ea 1\u300114\u300113 \u53f7\u4ee5 \"v\" \u5f00\u5934\u7684\u884c\uff0c 3 \u4e2a\u9876\u70b9\u7684\u7eb9\u7406\u5750\u6807\u6765\u81ea 10\u300112\u30014 \u53f7\u4ee5 \u201cvt\u201d \u5f00\u5934\u7684\u884c\uff0c3 \u4e2a\u9876\u70b9\u7684\u6cd5\u5411\u91cf\u6765\u81ea 1\u300111\u300112 \u53f7\u4ee5 \u201cvn\u201d \u5f00\u5934\u7684\u884c\u3002</li> </ul> <p>\u5982\u679c\u9876\u70b9\u5750\u6807\u6ca1\u6709\u6cd5\u5411\u91cf\u548c\u7eb9\u7406\u5750\u6807\uff0c\u90a3\u4e48\u76f4\u63a5\u53ef\u4ee5\u5ffd\u7565\uff0c\u7528\u7a7a\u683c\u5c06\u4e09\u4e2a\u9876\u70b9\u5750\u6807\u7d22\u5f15\u5206\u5f00\u5c31\u884c <pre><code>f 1 3 4\n</code></pre></p> <p>\u6700\u540e OpenGL \u5728\u7ed8\u5236\u65f6\u91c7\u7528\u7684\u662f <code>GL_TRIANGLES</code>\uff0c\u4e5f\u5c31\u662f\u7531 ABCDEF \u516d\u4e2a\u70b9\u7ed8\u5236 ABC\u3001DEF \u4e24\u4e2a\u4e09\u89d2\u5f62\uff0c\u6240\u4ee5 \"f\" \u5f00\u5934\u7684\u884c\u90fd\u4ee3\u8868\u7ed8\u5236\u4e00\u4e2a\u72ec\u7acb\u7684\u4e09\u89d2\u5f62\uff0c\u6700\u7ec8\u56fe\u50cf\u7531\u4e00\u4e2a\u4e00\u4e2a\u4e09\u89d2\u5f62\u62fc\u63a5\u7ec4\u6210\uff0c\u5e76\u4e14\u5f7c\u6b64\u7684\u70b9\u53ef\u4ee5\u5206\u5f00\u3002 </p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-import-3d-object/#obj_1","title":"\u52a0\u8f7d Obj \u6a21\u578b\u6587\u4ef6","text":"<p>\u660e\u767d\u4e86 Obj \u6a21\u578b\u6587\u4ef6\u4ee3\u8868\u7684\u542b\u4e49\uff0c\u63a5\u4e0b\u6765\u628a\u5b83\u52a0\u8f7d\u5e76\u7528 OpenGL \u8fdb\u884c\u6e32\u67d3\u3002</p> <p>Obj \u6a21\u578b\u6587\u4ef6\u5b9e\u8d28\u4e0a\u4e5f\u5c31\u662f\u6587\u672c\u6587\u4ef6\u4e86\uff0c\u901a\u8fc7\u8bfb\u53d6\u6bcf\u4e00\u884c\u6765\u8fdb\u884c\u52a0\u8f7d\u5373\u53ef\uff0c\u5047\u8bbe\u52a0\u8f7d\u7684\u6a21\u578b\u6587\u4ef6\u53ea\u6709\u9876\u70b9\u5750\u6807\uff0c\u5b9e\u9645\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>        // \u52a0\u8f7d\u6240\u6709\u7684\u9876\u70b9\u5750\u6807\u6570\u636e\uff0c\u628a List \u5bb9\u5668\u7684 index \u5f53\u6210 \u7d22\u5f15\n        ArrayList&lt;Float&gt; alv = new ArrayList&lt;&gt;();\n        // \u4ee3\u8868\u7ed8\u5236\u56fe\u50cf\u7684\u6bcf\u4e00\u4e2a\u5c0f\u4e09\u89d2\u5f62\u7684\u5750\u6807\n        ArrayList&lt;Float&gt; alvResult = new ArrayList&lt;&gt;();\n        // \u6700\u7ec8\u8981\u4f20\u5165\u7ed9 OpenGL \u7684\u6570\u7ec4\n        float[] vXYZ;\n        try {\n            InputStream in = context.getResources().getAssets().open(fname);\n            InputStreamReader isr = new InputStreamReader(in);\n            BufferedReader br = new BufferedReader(isr);\n            String temps = null;\n            // \u904d\u5386\u6bcf\u4e00\u884c\u6765\u8bfb\u53d6\u5185\u5bb9\n            while ((temps = br.readLine()) != null) {\n                // \u6b63\u5219\u8868\u8fbe\u5f0f \u7528\u7a7a\u683c\u5206\u5f00\n                String[] tempsa = temps.split(\"[ ]+\");\n                // \u5148\u628a\u6240\u6709\u7684\u9876\u70b9\u5750\u6807\u52a0\u5165\u5230 List \u4e2d\uff0c\u8fd9\u6837\u5c31\u6709\u4e86\u7d22\u5f15\n                if (tempsa[0].trim().equals(\"v\")) {\n                    alv.add(Float.parseFloat(tempsa[1]));\n                    alv.add(Float.parseFloat(tempsa[2]));\n                    alv.add(Float.parseFloat(tempsa[3]));\n                } else if (tempsa[0].trim().equals(\"f\")) {\n                // \u6839\u636e f \u6307\u793a\u7684\u7d22\u5f15\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u9876\u70b9\u5750\u6807\uff0c\n                // \u8fd9\u91cc -1 \u7684\u64cd\u4f5c\u662f\u56e0\u4e3a List \u4ece 0 \u5f00\u59cb\uff0cf \u5f00\u5934\u7684\u884c\u7684\u7d22\u5f15\u4ece 1 \u5f00\u59cb\n                // *3 \u662f\u56e0\u4e3a\u8981\u8df3\u8fc7 3 \u7684\u500d\u6570\u4e2a\u9876\u70b9\n                    int index = Integer.parseInt(tempsa[1].split(\"/\")[0]) - 1;\n                    alvResult.add(alv.get(3 * index));\n                    alvResult.add(alv.get(3 * index + 1));\n                    alvResult.add(alv.get(3 * index + 2));\n\n                    index = Integer.parseInt(tempsa[2].split(\"/\")[0]) - 1;\n                    alvResult.add(alv.get(3 * index));\n                    alvResult.add(alv.get(3 * index + 1));\n                    alvResult.add(alv.get(3 * index + 2));\n\n                    index = Integer.parseInt(tempsa[3].split(\"/\")[0]) - 1;\n                    alvResult.add(alv.get((3 * index)));\n                    alvResult.add(alv.get((3 * index + 1)));\n                    alvResult.add(alv.get((3 * index + 2)));\n                }\n            }\n            // \u628a\u9762\u7684\u5750\u6807\u8f6c\u6362\u4e3a\u6700\u7ec8\u8981\u4f20\u9012\u7ed9 OpenGL \u7684\u6570\u7ec4\n            // \u6839\u636e\u8fd9\u4e2a\u6570\u7ec4\uff0c\u7136\u540e\u6309\u7167 GL_TRIANGLES \u65b9\u5f0f\u8fdb\u884c\u7ed8\u5236\n            int size = alvResult.size();\n            vXYZ = new float[size];\n            for (int i = 0; i &lt; size; i++) {\n                vXYZ[i] = alvResult.get(i);\n            }\n            return vXYZ;\n        } catch (IOException e) {\n            return null;\n        }\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u51fd\u6570\u5c31\u8ba1\u7b97\u51fa\u4e86\u6700\u7ec8\u7684\u9876\u70b9\u5750\u6807\u4f4d\u7f6e\uff0c\u5e76\u5c06\u6b64\u9876\u70b9\u5750\u6807\u4f4d\u7f6e\u4f20\u5165\u7ed9 GPU \uff0c\u901a\u8fc7 FloatBuffer \u8fdb\u884c\u8f6c\u6362\u7b49\u7b49\uff0c\u8fd9\u5c31\u548c\u4e4b\u524d\u7684\u6587\u7ae0\u5185\u5bb9\u76f8\u540c\u4e86\u3002</p> <p></p> <p>\u5982\u679c\u53ea\u662f\u5355\u7eaf\u7684\u5bfc\u5165\u4e86\u6240\u6709\u9876\u70b9\uff0c\u5e76\u51b3\u5b9a\u4e86\u8981\u7ed8\u5236\u7684\u989c\u8272\uff0c\u5c31\u4f1a\u51fa\u73b0\u7c7b\u4f3c\u4e0a\u9762\u7684\u5355\u4e00\u989c\u8272\u7684\u7ed8\u5236\u60c5\u51b5\uff0c\u4e8b\u5b9e\u4e0a\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u7247\u6bb5\u7740\u8272\u5668\u6765\u7ed9 3D \u6a21\u578b\u6dfb\u52a0\u6761\u7eb9\u7740\u8272\u6548\u679c\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-import-3d-object/#_1","title":"\u5229\u7528\u7740\u8272\u5668\u6dfb\u52a0\u6761\u7eb9\u7740\u8272\u6548\u679c","text":"<p>\u901a\u8fc7\u4fee\u6539\u7247\u6bb5\u7740\u8272\u5668\u6765\u7ed9 3D \u5f62\u72b6\u6dfb\u52a0\u6761\u7eb9\u7740\u8272\u6548\u679c\u3002</p> <pre><code>precision mediump float;\nvarying  vec3 vPosition;  //\u9876\u70b9\u4f4d\u7f6e\nvoid main() {\n   vec4 bColor=vec4(0.678,0.231,0.129,0);//\u6761\u7eb9\u7684\u989c\u8272\n   vec4 mColor=vec4(0.763,0.657,0.614,0);//\u95f4\u9694\u7684\u989c\u8272\n   float y=vPosition.y;\n   y=mod((y+100.0)*4.0,4.0);\n   if(y&gt;1.8) {\n     gl_FragColor = bColor;//\u7ed9\u6b64\u7247\u5143\u989c\u8272\u503c\n   } else {\n     gl_FragColor = mColor;//\u7ed9\u6b64\u7247\u5143\u989c\u8272\u503c\n   }\n// \u9ed8\u8ba4\u4f7f\u7528\u5355\u4e00\u989c\u8272\u8fdb\u884c\u7ed8\u5236\n//   vec4 white = vec4(1,1,1,1);\n//   gl_FragColor = white;\n}\n</code></pre> <p>\u5b9e\u73b0\u7684\u65b9\u5f0f\u4e5f\u662f\u6839\u636e\u7247\u6bb5\u7684 y \u5750\u6807\u6240\u5728\u4f4d\u7f6e\u6765\u51b3\u5b9a\u8be5\u7247\u6bb5\u662f\u91c7\u6837\u6761\u7eb9\u7684\u989c\u8272\u8fd8\u662f\u95f4\u9694\u7684\u989c\u8272\u3002</p> <p>\u6700\u540e\uff0c\u52a0\u8f7d 3D \u6a21\u578b\u5c31\u5148\u4e86\u89e3\u5230\u8fd9\u4e86\uff0c\u5982\u679c\u60f3\u8981\u52a0\u8f7d\u66f4\u591a\u6548\u679c\uff0c\u5012\u662f\u53ef\u4ee5\u7ee7\u7eed\u6df1\u6316\uff0c\u53ea\u662f\u6ca1\u6709 MAC \u7248\u672c\u7684 3ds Max \u8f6f\u4ef6\uff0c\u5374\u662f\u5c11\u4e86\u4e00\u4e9b\u4e50\u8da3~~</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-import-3d-object/#_2","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-light-mix/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b\u5149\u7167\u7cfb\u5217\u4e4b\u6548\u679c\u6df7\u5408","text":"<p>\u5728\u524d\u9762\u7684\u7cfb\u5217\u6587\u7ae0\u4e2d\uff0c\u5206\u522b\u4ecb\u7ecd\u4e86 OpenGL \u7684\u73af\u5883\u5149\u3001\u6563\u5c04\u5149\u3001\u955c\u9762\u5149\u3002</p> <p>\u73b0\u5728\u5c1d\u8bd5\u5c06\u8fd9\u4e9b\u5149\u7167\u6548\u679c\u6df7\u5408\u8d77\u6765\uff0c\u8ba9\u6574\u4e2a\u573a\u666f\u663e\u5f97\u66f4\u52a0\u903c\u771f\u3002</p> <p>\u5177\u4f53\u7684\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5728\u8fd9\u4e2a\u573a\u666f\u91cc\u6709\u73af\u5883\u5149\u3001\u6563\u5c04\u5149\u548c\u955c\u9762\u5149\u3002\u62d6\u52a8\u6ed1\u5757\u7684\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u6539\u53d8\u5149\u6e90\u7684\u4f4d\u7f6e\uff0c\u4e0d\u540c\u4f4d\u7f6e\u7684\u5149\u6e90\uff0c\u770b\u5230\u7684\u6548\u679c\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u8981\u5b9e\u73b0\u8fd9\u6837\u7684\u6548\u679c\uff0c\u5176\u5b9e\u5c31\u662f\u628a\u4e4b\u524d\u6587\u7ae0\u7684\u4ee3\u7801\u7ed3\u5408\u4e00\u4e0b\uff1a</p> <p>\u6df7\u5408\u5149\u7167\u5c04\u7ed3\u679c = \u73af\u5883\u5149\u7167\u5c04\u7ed3\u679c + \u6563\u5c04\u5149\u7167\u5c04\u7ed3\u679c + \u955c\u9762\u5149\u7167\u5c04\u7ed3\u679c</p> <p>\u81f3\u4e8e\u4e0d\u540c\u5149\u7167\u5c04\u7ed3\u679c\u8ba1\u7b97\uff0c\u53ef\u4ee5\u53c2\u8003\u4e4b\u524d\u7684\u6587\u7ae0\u4e86\u3002</p> <p>\u5bf9\u4e8e\u4ee3\u7801\u6765\u8bf4\uff0c\u91cd\u70b9\u8fd8\u662f\u5728\u4e8e\u7740\u8272\u5668\u4ee3\u7801\u4e0a\u7684\u53d8\u5316\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-light-mix/#_1","title":"\u5b9e\u8df5","text":"<p>\u7247\u6bb5\u7740\u8272\u5668\u7684\u6539\u52a8\u4f9d\u65e7\u4e0d\u5927\uff0c\u4e0d\u540c\u5149\u7167\u5c04\u7ed3\u679c\u90fd\u8fd8\u662f\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u8fdb\u884c\u4e86\u3002</p> <p>\u7247\u6bb5\u7740\u8272\u5668\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p><pre><code>#version 300 es\nprecision mediump float;\nuniform float uR;\nin vec3 vPosition;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u9876\u70b9\u4f4d\u7f6e\nin vec4 vAmbient;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u73af\u5883\u5149\u6700\u7ec8\u5f3a\u5ea6\nin vec4 vDiffuse;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\nin vec4 vSpecular;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u955c\u9762\u53cd\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\nout vec4 fragColor;\nvoid main()\n{\n   // \u7701\u7565\u4e00\u4e9b\u4ee3\u7801\n   //\u6700\u7ec8\u989c\u8272\n   vec4 finalColor=vec4(color,0);\n   //\u7ed9\u6b64\u7247\u5143\u989c\u8272\u503c\n   fragColor=finalColor*vAmbient + finalColor*vDiffuse + finalColor*vSpecular;\n}\n</code></pre> \u7531\u9876\u70b9\u7740\u8272\u5668\u4f20\u9012\u8fc7\u6765\u7684\u73af\u5883\u5149\u6700\u7ec8\u5f3a\u5ea6\u3001\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\u3001\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6\uff0c\u5206\u522b\u4e58\u4ee5\u7269\u4f53\u7684\u989c\u8272\uff0c\u7136\u540e\u4e09\u8005\u76f8\u52a0\u5f97\u5230\u6700\u540e\u7684\u989c\u8272\u7ed3\u679c\u3002</p> <p>\u5176\u5b9e\uff0c\u91cd\u70b9\u8fd8\u662f\u5728\u4e8e\u9876\u70b9\u7740\u8272\u5668\u4ee3\u7801\u4e2d\uff1a</p> <pre><code>#version 300 es\nuniform mat4 uMVPMatrix;        //\u603b\u53d8\u6362\u77e9\u9635\nuniform mat4 uMMatrix;          //\u53d8\u6362\u77e9\u9635\nuniform vec3 uLightLocation;        //\u5149\u6e90\u4f4d\u7f6e\nuniform vec3 uCamera;           //\u6444\u50cf\u673a\u4f4d\u7f6e\nin vec3 aPosition;          //\u9876\u70b9\u4f4d\u7f6e\nin vec3 aNormal;            //\u6cd5\u5411\u91cf\nout vec3 vPosition;         //\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u9876\u70b9\u4f4d\u7f6e\nout vec4 vAmbient;          //\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u73af\u5883\u5149\u6700\u7ec8\u5f3a\u5ea6\nout vec4 vDiffuse;          //\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\nout vec4 vSpecular;         //\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6\nvoid pointLight(                    //\u5b9a\u4f4d\u5149\u5149\u7167\u8ba1\u7b97\u7684\u65b9\u6cd5\n  in vec3 normal,               //\u6cd5\u5411\u91cf\n  inout vec4 ambient,           //\u73af\u5883\u5149\u6700\u7ec8\u5f3a\u5ea6\n  inout vec4 diffuse,               //\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\n  inout vec4 specular,          //\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6\n  in vec3 lightLocation,            //\u5149\u6e90\u4f4d\u7f6e\n  in vec4 lightAmbient,         //\u73af\u5883\u5149\u5f3a\u5ea6\n  in vec4 lightDiffuse,         //\u6563\u5c04\u5149\u5f3a\u5ea6\n  in vec4 lightSpecular         //\u955c\u9762\u5149\u5f3a\u5ea6\n){\n  ambient=lightAmbient;         //\u76f4\u63a5\u5f97\u51fa\u73af\u5883\u5149\u7684\u6700\u7ec8\u5f3a\u5ea6\n  vec3 normalTarget=aPosition+normal;   //\u8ba1\u7b97\u53d8\u6362\u540e\u7684\u6cd5\u5411\u91cf\n  vec3 newNormal=(uMMatrix*vec4(normalTarget,1)).xyz-(uMMatrix*vec4(aPosition,1)).xyz;\n  newNormal=normalize(newNormal);   //\u5bf9\u6cd5\u5411\u91cf\u5f52\u4e00\u5316\n  //\u8ba1\u7b97\u4ece\u8868\u9762\u70b9\u5230\u6444\u50cf\u673a\u7684\u5411\u91cf\n  vec3 eye= normalize(uCamera-(uMMatrix*vec4(aPosition,1)).xyz);\n  //\u8ba1\u7b97\u4ece\u8868\u9762\u70b9\u5230\u5149\u6e90\u4f4d\u7f6e\u7684\u5411\u91cfvp\n  vec3 vp= normalize(lightLocation-(uMMatrix*vec4(aPosition,1)).xyz);\n  vp=normalize(vp);//\u5f52\u4e00\u5316vp\n  vec3 halfVector=normalize(vp+eye);    //\u6c42\u89c6\u7ebf\u4e0e\u5149\u7ebf\u7684\u534a\u5411\u91cf\n  float shininess=50.0;             //\u7c97\u7cd9\u5ea6\uff0c\u8d8a\u5c0f\u8d8a\u5149\u6ed1\n  float nDotViewPosition=max(0.0,dot(newNormal,vp));    //\u6c42\u6cd5\u5411\u91cf\u4e0evp\u7684\u70b9\u79ef\u4e0e0\u7684\u6700\u5927\u503c\n  diffuse=lightDiffuse*nDotViewPosition;                //\u8ba1\u7b97\u6563\u5c04\u5149\u7684\u6700\u7ec8\u5f3a\u5ea6\n  float nDotViewHalfVector=dot(newNormal,halfVector);   //\u6cd5\u7ebf\u4e0e\u534a\u5411\u91cf\u7684\u70b9\u79ef\n  float powerFactor=max(0.0,pow(nDotViewHalfVector,shininess));     //\u955c\u9762\u53cd\u5c04\u5149\u5f3a\u5ea6\u56e0\u5b50\n  specular=lightSpecular*powerFactor;               //\u8ba1\u7b97\u955c\u9762\u5149\u7684\u6700\u7ec8\u5f3a\u5ea6\n}\nvoid main(){\n   gl_Position = uMVPMatrix * vec4(aPosition,1); //\u6839\u636e\u603b\u53d8\u6362\u77e9\u9635\u8ba1\u7b97\u6b64\u6b21\u7ed8\u5236\u6b64\u9876\u70b9\u4f4d\u7f6e\n   vec4 ambientTemp,diffuseTemp,specularTemp;     //\u7528\u6765\u63a5\u6536\u4e09\u4e2a\u901a\u9053\u6700\u7ec8\u5f3a\u5ea6\u7684\u53d8\u91cf\n   pointLight(normalize(aNormal),ambientTemp,diffuseTemp,specularTemp,uLightLocation,\n   vec4(0.15,0.15,0.15,1.0),vec4(0.8,0.8,0.8,1.0),vec4(0.7,0.7,0.7,1.0));\n   vAmbient=ambientTemp;        //\u5c06\u73af\u5883\u5149\u6700\u7ec8\u5f3a\u5ea6\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n   vDiffuse=diffuseTemp;        //\u5c06\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n   vSpecular=specularTemp;      //\u5c06\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n   vPosition = aPosition;  //\u5c06\u9876\u70b9\u7684\u4f4d\u7f6e\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n}\n</code></pre> <p>\u9996\u5148\uff0c\u9876\u70b9\u7740\u8272\u5668\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u4f20\u9012\u5149\u6e90\u7684\u4f4d\u7f6e\uff0c\u4e5f\u9700\u8981\u4f20\u9012\u89c2\u5bdf\u8005\uff0c\u4e5f\u5c31\u662f\u76f8\u673a\u7684\u4f4d\u7f6e\u3002</p> <p>\u7136\u540e\u5728 pointLight \u51fd\u6570\u91cc\u9762\u8ba1\u7b97\u6700\u7ec8\u7684\u4e0d\u540c\u7684\u5149\u7167\u5f3a\u5ea6\u3002</p> <p>\u5728 pointLight \u51fd\u6570\u91cc\u9762\u6700\u5148\u64cd\u4f5c\u7684\u8fd8\u662f\u5c06\u6cd5\u5411\u91cf\u8fdb\u884c\u76f8\u5e94\u7684\u4f4d\u79fb\uff0c\u7136\u540e\u5c31\u662f\u51c6\u5907\u5728\u4e0d\u540c\u5149\u7167\u60c5\u51b5\u4e0b\u9700\u8981\u7528\u5230\u7684\u5411\u91cf\uff1a</p> <ul> <li>\u6cd5\u5411\u91cf\u5f52\u4e00\u5316\u4e4b\u540e\u7684\u5411\u91cf</li> <li>\u4ece\u89c2\u5bdf\u70b9\u5230\u76f8\u673a\u7684\u5411\u91cf\u8fdb\u884c\u5f52\u4e00\u5316\u4e4b\u540e\u7684\u5411\u91cf</li> <li>\u4ece\u89c2\u5bdf\u70b9\u5230\u5149\u6e90\u4f4d\u7f6e\u7684\u5411\u91cf\u8fdb\u884c\u5f52\u4e00\u5316\u4e4b\u540e\u7684\u5411\u91cf</li> <li>\u534a\u5411\u91cf\u5f52\u4e00\u5316\u4e4b\u540e\u7684\u5411\u91cf</li> </ul> <p>\u6709\u4e86\u8fd9\u4e9b\u4e2a\u5411\u91cf\uff0c\u8981\u8ba1\u7b97\u4f59\u5f26\u503c\uff0c\u53ea\u8981\u8c03\u7528 <code>dot</code> \u51fd\u6570\u8ba1\u7b97\u4e24\u4e2a\u5411\u91cf\u7684\u70b9\u79ef\u5c31\u597d\u4e86\uff0c\u6700\u540e\u8fd8\u662f\u6309\u7167\u4e4b\u524d\u6587\u7ae0\u4e2d\u7684\u516c\u5f0f\u8fdb\u884c\u8ba1\u7b97\u5c31\u597d\u4e86\u3002</p> <p>\u5982\u679c\u4f60\u5bf9\u4e4b\u524d\u7684\u5149\u7167\u6bd4\u8f83\u719f\u6089\u4e86\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5149\u7167\u6df7\u5408\u6548\u679c\u4e5f\u4f1a\u5f88\u5feb\u4e0a\u624b\uff0c\u5c31\u662f\u5728\u7740\u8272\u5668\u4e4b\u95f4\u4f20\u9012\u7684\u53d8\u91cf\u591a\u4e86\u4e00\u4e9b\uff0c\u5176\u4ed6\u7684\u6309\u7167\u516c\u5f0f\u8ba1\u7b97\u5c31\u597d\u4e86\u3002</p> <p>\u5177\u4f53\u7684\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6c42\u4e00\u6ce2 Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-light-mix/#_2","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-projection-matrix/","title":"OpenGL \u5b66\u4e60\u7cfb\u5217\u4e4b\u6295\u5f71\u77e9\u9635","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/AVyNmsO7s6rGPZw3WH5kcA</p> <p>\u5728 OpenGL \u5750\u6807\u7cfb\u7edf \u6587\u7ae0\u4e2d\uff0c\u6839\u636e\u70b9\u7684\u5750\u6807\u53d8\u6362\u5f97\u51fa\u4e86\u5982\u4e0b\u7684\u516c\u5f0f\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u516c\u5f0f\u6bcf\u5de6\u4e58\u4e00\u4e2a\u77e9\u9635\uff0c\u90fd\u4ee3\u8868\u4e86\u4e00\u79cd\u5750\u6807\u7cfb\u7684\u53d8\u6362\u3002</p> <p>\u8f6c\u5316\u4e3a\u7740\u8272\u5668\u811a\u672c\u8bed\u8a00\u5982\u4e0b\uff1a</p> <pre><code>attribute vec4 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewMatrix;\nvoid main()\n{\n    gl_Position  = u_ProjectionMatrix * u_ViewMatrix * u_ModelMatrix * a_Position;\n}\n</code></pre> <p>\u672c\u7bc7\u6587\u7ae0\u5c31\u4e3b\u8981\u662f\u5bf9\u6295\u5f71\u77e9\u9635\u6765\u5206\u6790\u7684\u3002</p> <p>OpenGL \u5728\u89c2\u5bdf\u7a7a\u95f4\u8f6c\u6362\u5230\u88c1\u526a\u7a7a\u95f4\u65f6\uff0c\u9700\u8981\u7528\u5230\u6295\u5f71\u77e9\u9635\u3002\u800c\u5728\u7740\u8272\u5668\u811a\u672c\u4e2d\uff0c\u4e5f\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u6295\u5f71\u77e9\u9635\u7ed9\u5bf9\u5e94\u7684 <code>u_ProjectionMatrix</code>\u53d8\u91cf\u3002</p> <p>\u9996\u5148\u8981\u5728\u7a0b\u5e8f\u91cc\u7ed1\u5b9a\u5230\u5bf9\u5e94\u7684\u53d8\u91cf\uff0c\u7136\u540e\u518d\u7ed9\u53d8\u91cf\u8d4b\u503c\u3002</p> <pre><code>// \u7ed1\u5b9a\u5230\u7740\u8272\u5668\u811a\u672c\u4e2d\u7684\u5bf9\u5e94\u53d8\u91cf\nprivate static final String U_ProMatrix = \"u_ProjectionMatrix\";\nprivate int uProMatrixLocation;\nuProMatrixLocation = glGetUniformLocation(mProgram,U_ProMatrix);\n// \u7ed9\u53d8\u91cf\u8d4b\u503c\uff0cprojectionMatrix \u4e3a\u6295\u5f71\u77e9\u9635\nglUniformMatrix4fv(uProMatrixLocation,1,false,projectionMatrix,0)\n</code></pre> <p>\u6b63\u5982\u524d\u6587\u8bb2\u5230\u7684\uff0c\u6295\u5f71\u77e9\u9635\u4f1a\u521b\u5efa\u4e00\u4e2a\u89c6\u666f\u4f53\u5bf9\u7269\u4f53\u5750\u6807\u8fdb\u884c\u88c1\u526a\uff0c\u5f97\u5230\u7684\u88c1\u526a\u5750\u6807\u518d\u7ecf\u8fc7\u900f\u89c6\u9664\u6cd5\u4e4b\u540e\uff0c\u5c31\u4f1a\u5f97\u5230\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u3002\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\u518d\u7ecf\u8fc7\u89c6\u53e3\u8f6c\u6362\uff0c\u6700\u7ec8\u5c06\u5750\u6807\u6620\u5c04\u5230\u4e86\u5c4f\u5e55\u4e0a\u3002</p> <p>OpenGL \u63d0\u4f9b\u4e86\u4e24\u79cd\u6295\u5f71\u65b9\u5f0f\uff1a\u6b63\u4ea4\u6295\u5f71\u548c\u900f\u89c6\u6295\u5f71\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-projection-matrix/#_1","title":"\u6b63\u4ea4\u6295\u5f71\u77e9\u9635","text":"<p>\u4e0d\u7ba1\u662f\u6b63\u4ea4\u6295\u5f71\u8fd8\u662f\u900f\u89c6\u6295\u5f71\uff0c\u6700\u7ec8\u90fd\u662f\u5c06\u89c6\u666f\u4f53\u5185\u7684\u7269\u4f53\u6295\u5f71\u5728\u8fd1\u5e73\u9762\u4e0a\uff0c\u8fd9\u4e5f\u662f 3D \u5750\u6807\u8f6c\u6362\u5230 2D \u5750\u6807\u7684\u5173\u952e\u4e00\u6b65\u3002</p> <p>\u800c\u8fd1\u5e73\u9762\u4e0a\u7684\u5750\u6807\u63a5\u7740\u4e5f\u4f1a\u8f6c\u6362\u6210\u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807\uff0c\u518d\u6620\u5c04\u5230\u5c4f\u5e55\u89c6\u53e3\u4e0a\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e4b\u524d\u7684\u56fe\u50cf\u62c9\u4f38\u95ee\u9898\uff0c\u5c31\u662f\u8981\u4fdd\u8bc1\u8fd1\u5e73\u9762\u7684\u5bbd\u9ad8\u6bd4\u548c\u89c6\u53e3\u7684\u5bbd\u9ad8\u6bd4\u4e00\u81f4\uff0c\u800c\u4e14\u662f\u4ee5\u8f83\u77ed\u7684\u90a3\u4e00\u8fb9\u4f5c\u4e3a 1 \u7684\u6807\u51c6\uff0c\u8ba9\u56fe\u50cf\u4fdd\u6301\u5c45\u4e2d\u3002</p> <p>OpenGL \u63d0\u4f9b\u4e86 <code>Matrix.orthoM</code> \u51fd\u6570\u6765\u751f\u6210\u6b63\u4ea4\u6295\u5f71\u77e9\u9635\u3002</p> <pre><code>    /**\n     * Computes an orthographic projection matrix.\n     *\n     * @param m returns the result \u6b63\u4ea4\u6295\u5f71\u77e9\u9635\n     * @param mOffset \u504f\u79fb\u91cf\uff0c\u9ed8\u8ba4\u4e3a 0 ,\u4e0d\u504f\u79fb\n     * @param left \u5de6\u5e73\u9762\u8ddd\u79bb\n     * @param right \u53f3\u5e73\u9762\u8ddd\u79bb\n     * @param bottom \u4e0b\u5e73\u9762\u8ddd\u79bb\n     * @param top \u4e0a\u5e73\u9762\u8ddd\u79bb\n     * @param near \u8fd1\u5e73\u9762\u8ddd\u79bb\n     * @param far \u8fdc\u5e73\u9762\u8ddd\u79bb\n     */\n    public static void orthoM(float[] m, int mOffset,\n        float left, float right, float bottom, float top,\n        float near, float far)\n</code></pre> <p> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u4eec\u7684\u5de6\u3001\u4e0a\u3001\u53f3\u3001\u4e0b\u8ddd\u79bb\u90fd\u662f\u76f8\u5bf9\u4e8e\u8fd1\u5e73\u9762\u4e2d\u5fc3\u7684\u3002</p> <p>\u8fd1\u5e73\u9762\u7684\u5750\u6807\u539f\u70b9\u4f4d\u4e8e\u4e2d\u5fc3\uff0c\u5411\u53f3\u4e3a \\(X\\) \u8f74\u6b63\u65b9\u5411\uff0c\u5411\u4e0a\u4e3a \\(Y\\) \u8f74\u6b63\u65b9\u5411\uff0c\u6240\u4ee5\u6211\u4eec\u7684 left\u3001bottom \u8981\u4e3a\u8d1f\u6570\uff0c\u800c right\u3001top \u8981\u4e3a\u6b63\u6570\u3002\u540c\u65f6\uff0c\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762\u7684\u8ddd\u79bb\u90fd\u662f\u6307\u76f8\u5bf9\u4e8e\u89c6\u70b9\u7684\u8ddd\u79bb\uff0c\u6240\u4ee5 near\u3001far \u8981\u4e3a\u6b63\u6570\uff0c\u800c\u4e14 \\(far &gt; near\\)\u3002</p> <p>\u53ef\u4ee5\u5728 GLSurfaceView \u7684 surfaceChanged \u91cc\u9762\u6765\u8bbe\u5b9a\u6b63\u4ea4\u6295\u5f71\u77e9\u9635\u3002</p> <pre><code>  @Override\n    public void onSurfaceChanged(GL10 gl, int width, int height) {\n        float aspectRatio = width &gt; height ? (float) width / (float) height : (float) height / (float) width;\n        if (width &gt; height){\n            Matrix.orthoM(projectionMatrix,0,-aspectRatio,aspectRatio,-1f,1f,0f,10f);\n        }else {\n            Matrix.orthoM(projectionMatrix,0,-1f,1f,-aspectRatio,aspectRatio,0f,10f);\n        }\n    }\n</code></pre> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u5c31\u628a\u8fd1\u5e73\u9762\u7684\u5bbd\u9ad8\u6bd4\u8bbe\u5b9a\u4e0e\u89c6\u53e3\u7684\u5bbd\u9ad8\u6bd4\u4e00\u81f4\u4e86\u3002\u89e3\u51b3\u4e86\u4e4b\u524d\u7ed8\u5236\u7684\u56fe\u50cf\u88ab\u62c9\u4f38\u7684\u95ee\u9898\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-projection-matrix/#_2","title":"\u900f\u89c6\u6295\u5f71\u77e9\u9635","text":"<p>OpenGL \u63d0\u4f9b\u4e86\u4e24\u4e2a\u51fd\u6570\u6765\u521b\u5efa\u900f\u89c6\u6295\u5f71\u77e9\u9635\uff1a<code>frustumM</code> \u548c <code>perspectiveM</code>\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-projection-matrix/#frustumm","title":"frustumM","text":"<p>frustumM \u51fd\u6570\u521b\u5efa\u7684\u89c6\u666f\u4f53\u662f\u4e00\u4e2a\u9525\u5f62\u3002</p> <p> \u5b83\u7684\u89c6\u666f\u4f53\u6709\u70b9\u7c7b\u4f3c\u4e8e\u6b63\u4ea4\u6295\u5f71\uff0c\u5728\u53c2\u6570\u7406\u89e3\u4e0a\u57fa\u672c\u90fd\u76f8\u540c\u7684\u3002</p> <pre><code>/**\n     * Defines a projection matrix in terms of six clip planes.\n     *\n     * @param m the float array that holds the output perspective matrix\n     * @param offset the offset into float array m where the perspective\n     *        matrix data is written\n     * @param left \n     * @param right\n     * @param bottom\n     * @param top\n     * @param near\n     * @param far\n     */\n    public static void frustumM(float[] m, int offset,\n            float left, float right, float bottom, float top,\n            float near, float far)\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f near \u548c far \u53d8\u91cf\u7684\u503c\u5fc5\u987b\u8981\u5927\u4e8e 0 \u3002\u56e0\u4e3a\u5b83\u4eec\u90fd\u662f\u76f8\u5bf9\u4e8e\u89c6\u70b9\u7684\u8ddd\u79bb\uff0c\u4e5f\u5c31\u662f\u7167\u76f8\u673a\u7684\u8ddd\u79bb\u3002</p> <p>\u5f53\u7528\u89c6\u56fe\u77e9\u9635\u786e\u5b9a\u4e86\u7167\u76f8\u673a\u7684\u4f4d\u7f6e\u65f6\uff0c\u8981\u786e\u4fdd\u7269\u4f53\u8ddd\u79bb\u89c6\u70b9\u7684\u4f4d\u7f6e\u5728 near \u548c far  \u7684\u533a\u95f4\u8303\u56f4\u5185\uff0c\u5426\u5219\u5c31\u4f1a\u770b\u4e0d\u5230\u7269\u4f53\u3002</p> <p>\u7531\u4e8e\u900f\u89c6\u6295\u5f71\u4f1a\u4ea7\u751f\u8fd1\u5927\u8fdc\u5c0f\u7684\u6548\u679c\uff0c\u5f53\u7167\u76f8\u673a\u4f4d\u7f6e\u4e0d\u53d8\uff0c\u6539\u53d8 near \u7684\u503c\u65f6\u4e5f\u4f1a\u6539\u53d8\u7269\u4f53\u5927\u5c0f\uff0cnear \u8d8a\u5c0f\uff0c\u5219\u79bb\u89c6\u70b9\u8d8a\u8fd1\uff0c\u76f8\u5f53\u4e8e\u7269\u4f53\u8d8a\u8fdc\uff0c\u90a3\u4e48\u663e\u793a\u7684\u7269\u4f53\u4e5f\u5c31\u8d8a\u5c0f\u4e86\u3002</p> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5 near \u548c far \u7684\u8ddd\u79bb\u4e0d\u52a8\uff0c\u6539\u53d8\u6444\u50cf\u673a\u7684\u4f4d\u7f6e\u6765\u6539\u53d8\u89c2\u5bdf\u5230\u7684\u7269\u4f53\u5927\u5c0f\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-projection-matrix/#perspectivem","title":"perspectiveM","text":"<p> OpenGL \u8fd8\u63d0\u4f9b\u4e86  <code>perspectiveM</code> \u51fd\u6570\u6765\u521b\u5efa\u6295\u5f71\u77e9\u9635\uff0c\u5b83\u7684\u89c6\u666f\u4f53\u548c <code>frustumM</code> \u51fd\u6570\u76f8\u540c\uff0c\u4f46\u662f\u6784\u9020\u7684\u53c2\u6570\u6709\u6240\u4e0d\u540c\u3002</p> <pre><code> /**\n     * Defines a projection matrix in terms of a field of view angle, an\n     * aspect ratio, and z clip planes.\n     *\n     * @param m the float array that holds the perspective matrix\n     * @param offset the offset into float array m where the perspective\n     *        matrix data is written\n     * @param fovy field of view in y direction, in degrees\n     * @param aspect width to height aspect ratio of the viewport\n     * @param zNear\n     * @param zFar\n     */\n    public static void perspectiveM(float[] m, int offset,\n          float fovy, float aspect, float zNear, float zFar)\n</code></pre> <p>\u89c6\u666f\u4f53\u4e0d\u518d\u9700\u8981\u786e\u5b9a\u8fd1\u5e73\u9762\u5de6\u3001\u4e0a\u3001\u53f3\u3001\u4e0b\u8ddd\u79bb\u4e86\u3002</p> <p>\u901a\u8fc7\u89c6\u89d2\u6765\u51b3\u5b9a\u6211\u4eec\u80fd\u770b\u5230\u7684\u89c6\u91ce\u5927\u5c0f\u3002\u89c6\u89d2\u5c31\u662f\u56fe\u4e2d\u6240\u793a\u7684\u90a3\u4e2a\u5939\u89d2\u3002\u53e6\u5916\u7684\u53c2\u6570\u662f\u89c6\u53e3\u7684\u5bbd\u9ad8\u6bd4\uff0c\u8fd8\u6709\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762\u7684\u8ddd\u79bb\uff0c\u53c2\u6570\u4e2a\u6570\u51cf\u5c11\u4e86\u3002</p> <p></p> <p></p> <p>\u4e0a\u8ff0\u56fe\u7247\u5de6\u8fb9\u662f 90 \u89c6\u89d2\uff0c\u53f3\u8fb9\u662f 45 \u5ea6\u89c6\u89d2\u3002\u663e\u7136\uff0c\u89c6\u91ce\u89d2\u5ea6\u8d8a\u5927\uff0c\u5219\u770b\u5230\u7684\u5185\u5bb9\u66f4\u591a\uff0c\u4f46\u662f\u7269\u4f53\u663e\u5f97\u66f4\u5c0f\uff0c\u800c\u89c6\u91ce\u89d2\u5ea6\u8d8a\u5c0f\uff0c\u5219\u770b\u7684\u5185\u5bb9\u66f4\u5c11\uff0c\u4f46\u7269\u4f53\u663e\u5f97\u66f4\u5927\u3002\u6709\u70b9\u7c7b\u4f3c\u4e8e\u6210\u8bed \u4e00\u53f6\u969c\u76ee \u7684\u611f\u89c9\u3002</p> <p>\u548c <code>frustumM</code>\u4e0d\u540c\u7684\u662f\uff0c\u4e00\u65e6\u786e\u5b9a\u4e86\u89c6\u89d2\u548c\u5bbd\u9ad8\u6bd4\uff0c\u90a3\u4e48\u6574\u4e2a\u6444\u50cf\u673a\u89c6\u91ce\u4e5f\u5c31\u786e\u5b9a\u4e86\uff0c\u6b64\u65f6\u5b8c\u6574\u7684\u9525\u5f62\u89c6\u91ce\u5df2\u7ecf\u5f62\u6210\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\u7269\u4f53\u7684\u8fd1\u5927\u8fdc\u5c0f\u6548\u679c\u5df2\u7ecf\u5b8c\u6210\u4e86\u3002\u8fd9\u65f6\uff0c\u8fd1\u5e73\u9762\u8ddd\u79bb\u548c\u8fdc\u5e73\u9762\u8ddd\u79bb\u53ea\u662f\u786e\u5b9a\u60f3\u8981\u622a\u53d6\u9525\u5f62\u89c6\u91ce\u4e2d\u7684\u54ea\u4e00\u90e8\u5206\u4e86\u3002\u4e0d\u50cf\u5728<code>frustumM</code>\u51fd\u6570\u4e2d\uff0c\u8fd1\u3001\u8fdc\u5e73\u9762\u7684\u8ddd\u79bb\u8fd8\u80fd\u591f\u8c03\u6574\u8fd1\u5927\u8fdc\u5c0f\u7684\u6548\u679c\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-projection-matrix/#_3","title":"\u5c0f\u7ed3","text":"<p>\u7406\u89e3\u4e86 OpenGL \u4e2d\u7684\u51e0\u79cd\u6295\u5f71\u77e9\u9635\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u8c03\u8bd5\u65f6\u5c31\u66f4\u5f97\u5fc3\u5e94\u624b\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-projection-matrix/#_4","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES \u5e94\u7528\u5f00\u53d1\u5b9e\u8df5\u6307\u5357\u300b</li> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol> <p>\u5177\u4f53\u4ee3\u7801\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-scissor-test/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b \u88c1\u526a\u6d4b\u8bd5\u53ca\u6ce8\u610f\u70b9","text":"<p>\u5728 OpenGL \u4e2d\u542f\u7528\u88c1\u526a\u6d4b\u8bd5\u53ef\u4ee5\u5728\u5c4f\u5e55\u6216\u8005\u5e27\u7f13\u51b2\u4e0a\u6307\u5b9a\u4e00\u4e2a\u77e9\u5f62\u533a\u57df\uff0c\u7136\u540e\u5728\u8be5\u77e9\u5f62\u533a\u57df\u5185\u7ed8\u5236\uff0c\u53ea\u6709\u5728\u8be5\u533a\u57df\u5185\u7684\u7247\u5143\u624d\u6709\u673a\u4f1a\u6700\u7ec8\u8fdb\u5165\u5e27\u7f13\u51b2\uff0c\u4e0d\u5728\u8be5\u533a\u57df\u5185\u7684\u5c06\u4f1a\u88ab\u4e22\u5f03\u3002</p> <p>\u88c1\u526a\u6d4b\u8bd5\u7684\u6548\u679c\u5c31\u76f8\u5f53\u4e8e\u5728\u5c4f\u5e55\u4e0a\u5f00\u8f9f\u4e00\u4e2a\u77e9\u5f62\u533a\u57df\uff0c\u5728\u8be5\u533a\u57df\u5185\u518d\u5355\u72ec\u7ed8\u5236\u5185\u5bb9\u3002</p> <p>\u5b83\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>        // \u5f00\u542f\u88c1\u526a\u6d4b\u8bd5\n        GLES20.glEnable(GLES20.GL_SCISSOR_TEST)\n        // \u6307\u5b9a\u5f00\u8f9f\u7684\u77e9\u5f62\u533a\u57df\n        GLES20.glScissor(x,y,width,height)\n        // \u6e05\u9664\u8be5\u533a\u57df\u5185\u7684\u989c\u8272\n        GLES20.glClearColor(1f, 0f, 0f, 1f)\n        GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT or GLES20.GL_DEPTH_BUFFER_BIT)\n        // \u5728\u77e9\u5f62\u5c40\u57df\u5185\u7ed8\u5236\u5185\u5bb9\n        mCube.onDrawFrame(gl)\n        // \u5173\u95ed\u88c1\u526a\u6d4b\u8bd5\n        GLES20.glDisable(GLES20.GL_SCISSOR_TEST)\n</code></pre> <p>\u5b83\u7684\u4f7f\u7528\u5e76\u4e0d\u96be\uff0c\u53ea\u8981\u5728 onDrawFrame \u65b9\u6cd5\u91cc\u9762\u5f00\u542f\u88c1\u526a\u6d4b\u8bd5\uff0c\u7136\u540e\u7ed8\u5236\uff0c\u7136\u540e\u5173\u95ed\u88c1\u526a\u5c31\u884c\u4e86\uff0c\u5177\u4f53\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5728\u539f\u6765\u7684\u56fe\u50cf\u4e0a\u88c1\u526a\u4e86\u4e00\u5c0f\u5757\u77e9\u5f62\uff0c\u7136\u540e\u7ed8\u5236\u4e86\u4e00\u4e2a\u65cb\u8f6c\u7684\u5f62\u72b6\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-scissor-test/#_1","title":"\u6ce8\u610f\u70b9","text":"<p><code>glScissor</code> \u65b9\u6cd5\u53ef\u4ee5\u6307\u5b9a\u88c1\u526a\u7684\u77e9\u5f62\u533a\u57df\uff0c\u5b83\u7684\u65b9\u6cd5\u539f\u578b\u5982\u4e0b\uff1a</p> <pre><code>    public static native void glScissor(\n        int x,\n        int y,\n        int width,\n        int height\n    );\n</code></pre> <p>\u5176\u4e2d\uff0cx \u548c y \u6307\u77e9\u5f62\u533a\u57df\u7684\u5de6\u4e0b\u89d2\u5750\u6807\uff0cwidth \u548c height \u6307\u77e9\u5f62\u533a\u57df\u7684\u5bbd\u548c\u9ad8\u3002</p> <p>x \u548c y \u5750\u6807\u6240\u5728\u7684\u5750\u6807\u7cfb\u662f\u4ee5\u89c6\u53e3\u77e9\u5f62\u533a\u57df\u7684\u5de6\u4e0b\u89d2\u4e3a\u539f\u70b9\u7684\uff0cx \u8f74\u5411\u53f3\uff0cy \u8f74\u5411\u4e0a\u7684\u5750\u6807\u7cfb\uff0c\u5bf9\u5e94\u5230\u5c4f\u5e55\u7684\u5750\u6807\uff0c\u5c31\u662f\u4ee5\u5c4f\u5e55\u7684\u5de6\u4e0b\u89d2\u4e3a\u539f\u70b9\uff0c\u8fd9\u548c Android \u4e2d\u4ee5\u5de6\u4e0a\u89d2\u4e3a\u539f\u70b9\u4e0d\u540c\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u7ed8\u5236\u65f6\u6211\u4eec\u628a\u89c6\u53e3\u8bbe\u7f6e\u4e3a\u5c4f\u5e55\u7684\u5bbd\u548c\u9ad8\uff0c\u90a3\u4e48\u5728\u542f\u7528\u88c1\u526a\u6d4b\u8bd5\u540e\uff0c\u60f3\u8ba9\u7ed8\u5236\u7684\u5185\u5bb9\u6b63\u597d\u663e\u793a\u5728\u6307\u5b9a\u7684\u77e9\u5f62\u533a\u57df\u5185\uff0c\u5c31\u5fc5\u987b\u4fdd\u8bc1\u5373\u4fbf\u6ca1\u6709\u542f\u7528\u88c1\u526a\u6d4b\u8bd5\uff0c\u5185\u5bb9\u4e5f\u662f\u7ed8\u5236\u5728\u6307\u5b9a\u7684\u533a\u57df\u5185\uff0c\u5426\u5219\u88c1\u526a\u533a\u57df\u5185\u5c06\u4e0d\u4f1a\u663e\u793a\u7ed8\u5236\u5185\u5bb9\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u88c1\u526a\u6d4b\u8bd5\u53ea\u662f\u5728\u539f\u6765\u7684\u89c6\u53e3\u6807\u51c6\u7684\u7ed8\u5236\u533a\u57df\u5185\u5f00\u8f9f\u4e00\u5757\u77e9\u5f62\u533a\u57df\u6765\u663e\u793a\uff0c\u800c\u4e0d\u662f\u628a\u5185\u5bb9\u653e\u5230\u88c1\u526a\u7684\u533a\u57df\u5185\u6765\u663e\u793a\u3002</p> <p>\u6700\u540e\u521b\u5efa\u4e86\u4e00\u4e2a\u5fae\u4fe1\u7fa4\uff0c\u6b22\u8fce\u52a0\u7fa4\u4ea4\u6d41\u8ba8\u8bba OpenGL ES \u76f8\u5173\u6280\u672f~~</p> <p></p> <p>\u5177\u4f53\u4ee3\u7801\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6c42\u4e00\u6ce2 star~~</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-scissor-test/#_2","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-share/","title":"OpenGL ES \u5b66\u4e60\u8d44\u6e90\u5206\u4eab","text":"<p>\u5b66\u4e60\u4e86\u4e00\u6bb5\u65f6\u95f4\u7684 OpenGL ES\uff0c\u5e76\u5728\u516c\u53f8\u7684\u9879\u76ee\u4e2d\u5f97\u5230\u4e86\u8fd0\u7528\uff0c\u4e5f\u7b97\u662f\u6709\u4e86\u4e00\u4e9b\u79ef\u7d2f\uff0c\u73b0\u5728\u5206\u4eab\u4e00\u4e9b\u5f53\u521d\u5b66\u4e60\u7684\u8d44\u6e90\uff0c\u5927\u5bb6\u4e00\u8d77\u6765\u5b66\u4e60\uff0c\u5171\u540c\u4ea4\u6d41\u8fdb\u6b65\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-share/#_1","title":"\u5173\u4e8e\u5b66\u4e60\u65b9\u5f0f","text":"<p>\u5728\u5206\u4eab\u8d44\u6e90\u4e4b\u524d\uff0c\u7b80\u5355\u5730\u804a\u804a\u5b66\u4e60\u7684\u65b9\u5f0f\u3002</p> <p>\u6709\u53e5\u540d\u8a00\u8bf4\u7684\u597d\uff1a</p> <p>\u4e66\u7c4d\u7684\u4eba\u7c7b\u8fdb\u6b65\u7684\u9636\u68af</p> <p>\u5728\u9700\u8981\u89e3\u51b3\u4e00\u4e9b\u672a\u77e5\u9886\u57df\u7684\u95ee\u9898\u3001\u5b8c\u6210\u4e00\u4e9b\u672a\u77e5\u9886\u57df\u7684\u9700\u6c42\u65f6\uff0c\u662f\u5fc5\u987b\u8981\u53bb\u5b66\u4e60\u4e00\u4e9b\u65b0\u4e1c\u897f\u7684\u3002</p> <p>\u800c\u5728\u5b66\u4e60\u8fd9\u4e9b\u65b0\u4e1c\u897f\u65f6\uff0c\u4e0d\u8981\u592a\u4f9d\u8d56\u4e8e\u641c\u7d22\u5f15\u64ce\u4e86\uff0c\u4e0d\u7136\u53ea\u662f\u5f53\u4e0b\u89e3\u51b3\u4e86\u67d0\u4e9b\u95ee\u9898\u3001\u5b8c\u6210\u4e86\u67d0\u4e9b\u9700\u6c42\u3002</p> <p>\u901a\u8fc7\u770b\u4e00\u4e9b\u535a\u5ba2\u6587\u7ae0\u3001\u770b\u4e00\u4e9b\u6587\u7ae0\u5206\u6790\uff0c\u5728\u67d0\u4e9b\u65f6\u523b\u786e\u5b9e\u662f\u5f88\u6709\u5e2e\u52a9\u7684\uff0c\u4f46\u603b\u662f\u4f1a\u5b58\u5728\u4e00\u4e9b\u788e\u7247\u5316\u77e5\u8bc6\uff0c\u6ca1\u6709\u7cfb\u7edf\u5730\u5f62\u6210\u77e5\u8bc6\u7f51\u7edc\uff0c\u6b64\u65f6\u638c\u63e1\u7684\u4ec5\u4ec5\u662f\u6280\u5de7\u3002\u8fd8\u662f\u8981\u901a\u8fc7\u7cfb\u7edf\u5730\u53bb\u5b66\u4e60\u67d0\u4e9b\u77e5\u8bc6\u5185\u5bb9\uff0c\u5728\u8111\u6d77\u91cc\u9762\u6709\u4e2a\u5b8c\u6574\u7684\u77e5\u8bc6\u4f53\u7cfb\u3002</p> <p>\u8fd9\u4e2a\u7b80\u5355\u7684\u9053\u7406\u5927\u5bb6\u90fd\u61c2\uff0c\u5c31\u4e0d\u591a\u8bf4\u4e86~</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-share/#_2","title":"\u7b80\u5355\u4e0a\u624b","text":"<p>\u4f5c\u4e3a\u7a0b\u5e8f\u5458\u5b66\u4e60\u4e00\u9879\u5185\u5bb9\uff0c\u6700\u91cd\u8981\u7684\u5c31\u662f Hello World \u4e86\u3002</p> <p>\u300aOpenGL ES \u5e94\u7528\u5f00\u53d1\u5b9e\u8df5\u6307\u5357\u300b</p> <p></p> <p>\u8fd9\u672c\u4e66\u6bd4\u8f83\u901a\u4fd7\u6613\u61c2\uff0c\u76f4\u63a5\u4e0a\u624b\u4f7f\u7528 OpenGL ES\uff0c\u53ef\u4ee5\u8bf4\u662f\u624b\u628a\u624b\u6559\u5b66\u4e86\u3002</p> <p>\u4f5c\u4e3a\u521d\u5b66\u8005\uff0c\u6700\u91cd\u8981\u7684\u662f\u5565\uff1f\u73af\u5883\u914d\u7f6e\u3001Demo \u8fd0\u884c\u5440<sub>~</sub></p> <p>\u5728 \u300aOpenGL ES \u5e94\u7528\u5f00\u53d1\u5b9e\u8df5\u6307\u5357\u300b\u91cc\u9762\uff0c\u8ddf\u7740\u4e66\u4e2d\u7684\u7ae0\u8282\u987a\u5e8f\u8d70\uff0c\u6bcf\u4e00\u7ae0\u90fd\u4f1a\u6709\u4ee3\u7801\u793a\u4f8b\uff0c\u4e5f\u7b97\u662f\u4e00\u6b65\u6b65\u5f15\u5bfc\u4e86\u3002</p> <p>\u4f60\u53ef\u4ee5\u6682\u65f6\u4e0d\u6c42\u751a\u89e3\uff0c\u5148\u628a\u793a\u4f8b\u5de5\u7a0b\u8fd0\u884c\u8d77\u6765\uff0c\u7b49\u719f\u7ec3\u4e86\u518d\u53bb\u6df1\u7a76\u539f\u7406\u3002</p> <p>\u7f8e\u4e2d\u4e0d\u8db3\u7684\u662f\uff0c\u8fd9\u672c\u4e66\u9488\u5bf9\u7684 OpenGL ES \u7248\u672c\u662f 2.0 \u7684\uff0c\u5728 OpenGL ES 3.x \u4e2d\u7684\u4e00\u4e9b\u7279\u6027\u65e0\u6cd5\u4f53\u9a8c\u5230\u4e86\uff0c\u800c\u4e14\u73b0\u5728\u7684\u624b\u673a\u5927\u591a\u652f\u6301 OpenGL ES 3.x \u7248\u672c\u4e86\uff0c\u4e0d\u8fc7\u8981\u662f\u8003\u8651\u5230\u517c\u5bb9\u4f4e\u7248\u672c\u7684\u60c5\u51b5\uff0c\u8fd8\u662f\u53ef\u4ee5\u4f7f\u7528 OpenGL ES 2.0 \u7248\u672c\u7684\u3002</p> <p>\u8fd9\u672c\u4e66\u662f\u7ffb\u8bd1\u8fc7\u6765\u7684\uff0c\u5b83\u7684\u82f1\u6587\u539f\u7248\u5c01\u9762\u5982\u4e0b\uff1a</p> <p></p> <p>\u7b80\u5355\u4e0a\u624b\u4e86 OpenGL ES 2.0 \u4e4b\u540e\uff0c\u8be5\u4e86\u89e3\u4e00\u4e0b OpenGL Shading Language \uff08GLSL\uff09\u4e86\u3002</p> <p>GLSL \u5c31\u662f\u7740\u8272\u5668\u811a\u672c\u8bed\u8a00\uff0c\u8fd9\u4e2a\u8bed\u8a00\u662f\u7528\u6765\u7ed9 GPU \u8fd0\u884c\u7684\uff0c\u7075\u6d3b\u5730\u4f7f\u7528\u5b83\u624d\u80fd\u66f4\u597d\u5730\u638c\u63e1 OpenGL ES\uff0c\u8981\u77e5\u9053\u73b0\u5728\u624b\u673a\u76f8\u673a\u4e0a\u7684\u4e00\u4e9b\u6ee4\u955c\u6548\u679c\u90fd\u662f\u901a\u8fc7 GLSL \u6765\u5b9e\u73b0\u7684\u54e6\u3002</p> <p>\u300aOpenGL\u00ae Shading Language, Second Edition\u300b</p> <p></p> <p>\u8fd9\u672c\u4e66\u662f\u82f1\u6587\u7248\u7684\uff0c\u8bb2\u89e3\u4e86 GLSL \u7684\u4e00\u4e9b\u8bed\u6cd5\uff0c\u57fa\u4e8e\u7684\u7248\u672c\u662f OpenGL ES 2.0 \u7684\uff0c\u6b63\u597d\u548c\u524d\u9762\u7684\u4e66\u7c4d\u914d\u5957\u5b66\u4e60\u4e86\uff0c\u800c\u4e14\u82f1\u6587\u96be\u5ea6\u4e0d\u5927\uff0c\u6613\u61c2\u3002</p> <p>\u8be5\u4e66\u4e2d\u540c\u6837\u6709\u5f88\u591a\u4f8b\u5b50\u53ef\u4ee5\u5b9e\u8df5\uff0c\u6bd4\u5982\u5149\u7167\u3001\u9634\u5f71\u3001\u566a\u97f3\u7b49\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e24\u672c\u4e66\u7684\u914d\u5957\u7ec3\u4e60\uff0c\u53ef\u4ee5\u638c\u63e1 OpenGL ES 2.x \u7248\u672c\u7684\u57fa\u672c\u5185\u5bb9\u4e86\u3002</p> <p>\u5f53\u7136\u4e86\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u4f60\u8fd8\u9700\u8981\u66f4\u591a\u7684\u7ec3\u4e60\u3002</p> <p>\u53ef\u4ee5\u53c2\u8003\u8fd9\u672c\u4e66\uff0c\u83b7\u5f97\u66f4\u591a\u6253\u602a\u664b\u7ea7\u7684\u7ecf\u9a8c\uff1a</p> <p></p> <p>\u300aAndroid 3D \u6e38\u620f\u5f00\u53d1\u6280\u672f\u5b9d\u5178\u300b\u4e00\u4e66\u4e2d\u6709\u5f88\u591a\u53ef\u4ee5\u5728\u5b9e\u8df5\u4e2d\u7528\u5230\u7684\u5185\u5bb9\uff0c\u5177\u4f53\u5185\u5bb9\u5c31\u7b49\u5927\u5bb6\u81ea\u884c\u63a2\u7d22\u4e86<sub>~</sub></p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-share/#_3","title":"\u9ad8\u9636\u7248\u672c","text":"<p>\u5f53\u7136\u4e86\uff0c\u5b66\u4f1a\u4e86 OpenGL ES 2.0 \u518d\u53bb\u770b OpenGL ES 3.x \u5c31\u5bb9\u6613\u591a\u4e86\u3002</p> <p>\u8fd9\u4e24\u8005\u5728 GLSL \u4e0a\u662f\u6709\u4e00\u4e9b\u53d8\u5316\u7684\uff0c\u53e6\u5916 OpenGL ES 3.x \u652f\u6301\u7684\u6e32\u67d3\u6548\u679c\u66f4\u597d\uff0c\u800c\u4e14\u652f\u6301\u7684\u7279\u6027\u66f4\u591a\u3002</p> <p>\u5173\u4e8e OpenGL ES 3.x \u7248\u672c\u7684\u5b66\u4e60\uff0c\u6709\u5982\u4e0b\u4e66\u7c4d\u63a8\u8350\uff1a</p> <p></p> <p></p> <p>\u5728 Android \u540e\u7eed\u7cfb\u7edf\u7248\u672c\u4e2d\uff0c\u90fd\u5f00\u59cb\u4f7f\u7528 Vulkan \u6765\u66ff\u4ee3 OpenGL \u4e86\u3002</p> <p>\u7b49\u638c\u63e1\u4e86 OpenGL ES \u4e4b\u540e\uff0c\u4e0b\u4e00\u4e2a\u5c31\u662f Vulkan \u4e86<sub>~</sub></p> <p>\u53e6\u5916\u5173\u4e8e\u4e66\u7c4d\u63a8\u8350\uff0c\u5176\u5b9e\u5927\u5bb6\u53ef\u4ee5\u5230\u4eac\u4e1c\u6216\u8005\u5f53\u5f53\u4e0a\u641c\u7d22\u4e00\u4e0b\u5173\u952e\u5b57\u5c31\u77e5\u9053\u4e86\uff0c\u76ee\u524d\u5e02\u9762\u4e0a\u5173\u4e8e OpenGL ES \u7684\u4e66\u7c4d\u4e5f\u4e0d\u591a\uff0c\u641c\u6765\u641c\u53bb\u4e5f\u5c31\u662f\u90a3\u51e0\u672c\u4e66\u5566<sub>~</sub>\u5bf9\u4e8e\u5176\u4ed6\u9886\u57df\u7684\u4e66\u7c4d\u60c5\u51b5\u7c7b\u4f3c...</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-share/#_4","title":"\u6df1\u5165\u7406\u89e3","text":"<p>\u5f53\u4f60\u5df2\u7ecf\u638c\u63e1\u4e86 OpenGL ES \u7684\u5927\u90e8\u5206\u5185\u5bb9\uff0c\u5e76\u4e14\u53ef\u4ee5\u7b80\u5355\u7684\u8fd0\u7528\u4ed6\u4eec\u4e86\uff0c\u8fd9\u65f6\u5019\u518d\u60f3\u53bb\u6df1\u5165\u7406\u89e3\u5b83\u4eec\uff0c\u90a3\u5c31\u5fc5\u987b\u8981\u8bf4\u5230 OpenGL ES \u5b66\u4e60\u4e2d\u7684\u7ea2\u5b9d\u4e66\u548c\u84dd\u5b9d\u4e66\u4e86\u3002</p> <p>\u7ea2\u5b9d\u4e66\u6307\u7684\u662f \u300aOpenGL \u7f16\u7a0b\u6307\u5357\u300b\uff0c\u76ee\u524d\u5df2\u7ecf\u51fa\u5230\u4e86\u7b2c\u4e5d\u7248\u4e86\uff0c\u84dd\u5b9d\u4e66\u6307\u7684\u662f\u300aOpenGL \u8d85\u7ea7\u5b9d\u5178\u300b\u76ee\u524d\u5df2\u7ecf\u51fa\u5230\u4e86\u7b2c\u4e94\u7248\u4e86\u3002</p> <p></p> <p>\u8fd9\u4e24\u672c\u4e66\u5c31\u6ca1\u6709\u524d\u9762\u90a3\u4e48\u591a\u4ee3\u7801\u793a\u4f8b\u4e86\uff0c\u66f4\u591a\u7684\u662f\u8bb2\u89e3\u4e00\u4e9b\u539f\u7406\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u800c\u4e14\u4e5f\u4e0d\u662f\u7279\u522b\u9488\u5bf9 Android \u5f00\u53d1\u73af\u5883\u6765\u8bb2\u7684\u3002\u8fd9\u4e24\u672c\u4e66\u66f4\u591a\u662f\u8fd8\u662f\u5f53\u505a\u5de5\u5177\u4e66\u6765\u4f7f\u7528\uff0c\u5f53\u67d0\u4e9b\u77e5\u8bc6\u70b9\u4e0d\u6e05\u6670\u65f6\uff0c\u770b\u770b\u4e66\u67e5\u6f0f\u8865\u7f3a<sub>~</sub>\uff08\u53cd\u6b63\u6211\u662f\u5f53\u5de5\u5177\u4e66\u7528\u4e86\uff09</p> <p>\u542c\u8bf4\uff0c\u4e0b\u96e8\u5929\uff0c\u4ee3\u7801\u548c\u4e66\u7c4d\u66f4\u914d\u54e6~</p> <p>\u663e\u7136\uff0c\u5149\u662f\u770b\u4e66\u662f\u4e0d\u591f\u7684\uff0c\u7eb8\u4e0a\u5f97\u6765\u7ec8\u89c9\u6d45\uff0c\u7edd\u77e5\u6b64\u4e8b\u8981\u8eac\u884c\u3002</p> <p>\u5728 OpenGL ES \u5f00\u53d1\u4e2d\uff0c\u6709\u4e00\u4e9b\u9879\u76ee\u662f\u5fc5\u770b\u7684\uff1a</p> <ul> <li>https://github.com/CyberAgent/android-gpuimage</li> <li>https://github.com/BradLarson/GPUImage2</li> <li>https://github.com/google/grafika</li> </ul> <p>\u8fd9\u4e9b\u9879\u76ee\u4e2d\u53ef\u4ee5\u770b\u5230 OpenGL ES \u5728\u76f8\u673a\u6ee4\u955c\u548c\u89c6\u9891\u5f55\u5236\u65b9\u9762\u7684\u8fd0\u7528~</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-share/#_5","title":"\u6700\u540e","text":"<p>\u4fd7\u8bdd\u8bf4\uff1a</p> <p>\u72ec\u5b66\u800c\u65e0\u53cb\uff0c\u5219\u5b64\u964b\u800c\u5be1\u95fb</p> <p>\u5149\u662f\u638c\u63e1\u4e86\u8fd9\u4e9b\u4e66\u4e0a\u7684\u5185\u5bb9\u8fd8\u662f\u4e0d\u591f\u7684\uff0c\u66f4\u591a\u7684\u662f\u9700\u8981\u4ea4\u6d41\u548c\u8ba8\u8bba\uff0c\u8ba9\u8fd9\u4e9b\u77e5\u8bc6\u5728\u6bcf\u4e00\u6b21\u7684\u63a2\u8ba8\u4e2d\u53d8\u5f97\u66f4\u52a0\u751f\u52a8\u7075\u6d3b\uff0c\u4e0d\u518d\u662f\u67af\u71e5\u7684\u4ee3\u7801\u548c\u7406\u8bba\u3002</p> <p>\u90a3\u5c31\u8d76\u7d27\u626b\u7801\u52a0\u5165\u6211\u4eec\u5427~~</p> <p></p> <p>\u8981\u662f\u4e8c\u7ef4\u7801\u8fc7\u671f\u4e86\uff0c\u52a0\u5fae\u4fe1 ezglumes \u597d\u53cb\uff0c\u5907\u6ce8 OpenGL \uff0c\u62c9\u4f60\u5165\u7fa4~</p> <p>\u672c\u6587\u4e2d\u63d0\u5230\u7684\u4e66\u7c4d\u8d44\u6e90\uff0c\u7686\u53ef\u5728\u6211\u7684 Github \u5730\u5740\u4e0a\u4e0b\u8f7d\u5f97\u5230\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p> <p>\u4e00\u4e9b OpenGL ES \u5b66\u4e60\u7684\u4ee3\u7801\u4e5f\u4f1a\u5728\u8fd9\u91cc\uff0c\u6c42 Star \u4e00\u6ce2 \u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-specular-light/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b\u5149\u7167\u7cfb\u5217\u4e4b\u955c\u9762\u5149","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u4ecb\u7ecd\u4e86 OpenGL \u7684\u73af\u5883\u5149\u548c\u6563\u5c04\u5149\uff0c\u73b0\u5728\u5c31\u662f\u6700\u540e\u4e00\u4e2a\u955c\u9762\u5149\u4e86\u3002</p> <p>\u8fd8\u662f\u5148\u7406\u89e3\u4e00\u4e0b\u4ec0\u4e48\u662f\u955c\u9762\u5149\uff1a</p> <p></p> <p>\u5c31\u5982\u540c\u4f7f\u7528\u6211\u4eec\u4f7f\u7528\u955c\u5b50\u53cd\u5c04\u592a\u9633\u5149\u4e00\u6837\uff0c\u5728\u73b0\u5b9e\u4e16\u754c\u4e2d\uff0c\u5f53\u5149\u6ed1\u8868\u9762\u88ab\u7167\u5c04\u65f6\u4f1a\u6709\u65b9\u5411\u5f88\u96c6\u4e2d\u7684\u53cd\u5c04\u5149\uff0c\u8fd9\u5c31\u662f\u955c\u9762\u5149\u3002</p> <p>\u4e0e\u6563\u5c04\u5149\u6700\u7ec8\u5f3a\u5ea6\u4ec5\u4f9d\u8d56\u4e8e\u5165\u5c04\u5149\u548c\u88ab\u7167\u5c04\u70b9\u6cd5\u5411\u91cf\u7684\u5939\u89d2\u4e0d\u540c\uff0c\u955c\u9762\u5149\u7684\u6700\u7ec8\u5f3a\u5ea6\u8fd8\u4f9d\u8d56\u4e8e\u89c2\u5bdf\u8005\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4ece\u6444\u50cf\u673a\u5230\u88ab\u7167\u5c04\u70b9\u7684\u5411\u91cf\u4e0d\u5728\u53cd\u5c04\u5149\u65b9\u5411\u96c6\u4e2d\u7684\u8303\u56f4\u5185\uff0c\u89c2\u5bdf\u8005\u5c06\u4e0d\u4f1a\u770b\u5230\u955c\u9762\u5149\uff0c\u5c31\u5982\u4e0a\u56fe\u6240\u793a\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u955c\u9762\u5149\u7684\u7167\u5c04\u8ba1\u7b97\u516c\u5f0f\uff1a</p> <p>\u955c\u9762\u5149\u7167\u5c04\u7ed3\u679c = </p> <p>\\(\u6750\u8d28\u7684\u53cd\u5c04\u7cfb\u6570 * \u955c\u9762\u5149\u5f3a\u5ea6 * max\uff080\uff0c\uff08cos\uff08\u534a\u5411\u91cf\u4e0e\u6cd5\u5411\u91cf\u7684\u5939\u89d2\uff09^{\u7c97\u7cd9\u5ea6}\\)\uff09</p> <p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u955c\u9762\u5149\u7167\u5c04\u7ed3\u679c\u5206\u4e3a\u4e24\u6b65\u8fdb\u884c\uff1a</p> <p>\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6 = </p> <p>\\(\u955c\u9762\u5149\u5f3a\u5ea6 * max\uff080\uff0c\uff08cos\uff08\u534a\u5411\u91cf\u4e0e\u6cd5\u5411\u91cf\u7684\u5939\u89d2\uff09^{\u7c97\u7cd9\u5ea6}\\)\uff09</p> <p>\u955c\u9762\u5149\u7167\u5c04\u7ed3\u679c = \u6750\u8d28\u53cd\u5c04\u7cfb\u6570 * \u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6</p> <p>\u5176\u4e2d\uff1a\u6750\u8d28\u7684\u53cd\u5c04\u7cfb\u6570\u5b9e\u9645\u6307\u7684\u5c31\u662f\u7269\u4f53\u88ab\u7167\u5c04\u5904\u7684\u989c\u8272\uff0c\u955c\u9762\u5149\u5f3a\u5ea6\u6307\u7684\u662f\u955c\u9762\u5149\u4e2d RGB\uff08\u7ea2\u3001\u7eff\u3001\u84dd\uff093 \u4e2a\u8272\u5f69\u901a\u9053\u7684\u5f3a\u5ea6\u3002</p> <p>\u4e0e\u8ba1\u7b97\u6563\u5c04\u5149\u516c\u5f0f\u4e0d\u540c\u7684\u662f\uff0c\u8ba1\u7b97\u4f59\u5f26\u503c\u65f6\u5bf9\u5e94\u7684\u89d2\u4e0d\u518d\u662f\u5165\u5c04\u89d2\uff0c\u800c\u662f<code>\u534a\u5411\u91cf</code>\u548c\u6cd5\u5411\u91cf\u7684\u5939\u89d2\u3002\u5176\u4e2d\uff0c\u534a\u5411\u91cf\u6307\u7684\u662f\u4ece\u88ab\u7167\u5c04\u70b9\u5230\u5149\u6e90\u7684\u5411\u91cf\u4e0e\u4ece\u88ab\u7167\u5c04\u70b9\u5230\u89c2\u5bdf\u70b9\u5411\u91cf\u7684\u5e73\u5747\u5411\u91cf\u3002</p> <p><code>\u534a\u5411\u91cf</code>\u7684\u56fe\u793a\u5982\u4e0b\uff1a</p> <p></p> <p>\u5176\u4e2d\uff0cV \u8868\u793a\u4ece\u88ab\u7167\u5c04\u70b9\u5230\u89c2\u5bdf\u70b9\u7684\u5411\u91cf\uff0cN \u4e3a\u88ab\u7167\u5c04\u70b9\u8868\u9762\u6cd5\u5411\u91cf\uff0cH \u4e3a\u534a\u5411\u91cf\uff0cL \u4e3a\u4ece\u88ab\u7167\u5c04\u70b9\u5230\u5149\u6e90\u7684\u5411\u91cf\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5411\u91cf V \u548c\u5411\u91cf L \u6709\u5171\u540c\u4ea4\u70b9 P \uff0c\u6240\u4ee5\u5b83\u4eec\u5728\u540c\u4e00\u5e73\u9762\uff0c\u800c\u5411\u91cf H \u662f\u5411\u91cf V \u548c\u5411\u91cf L \u7684\u5e73\u5747\u5411\u91cf\uff0c\u6240\u4ee5\u5411\u91cf H \u3001V\u3001L \u5171\u9762\uff0c\u5e76\u4e14\u5411\u91cf H \u548c\u5411\u91cf V\u3001L \u7684\u5939\u89d2\u76f8\u7b49\u3002</p> <p>\u56e0\u6b64\u8ba1\u7b97\u5411\u91cf H \uff0c\u9996\u5148\u9700\u8981\u5c06\u5411\u91cf V \u548c\u5411\u91cf L \u5f52\u4e00\u5316\uff0c\u7136\u540e\u5c06\u5f52\u4e00\u5316\u7684\u5411\u91cf V \u548c L \u6c42\u548c\u5e76\u518d\u6b21\u5f52\u4e00\u5316\u5373\u53ef\u5f97\u5230\u5411\u91cf H \u3002</p> <p>\u6709\u4e86\u534a\u5411\u91cf H \u4e4b\u540e\uff0c\u8ba1\u7b97\u5176\u548c\u6cd5\u5411\u91cf\u7684\u4f59\u5f26\u503c\u5c31\u548c\u5728\u955c\u9762\u5149\u4e2d\u63d0\u5230\u7684\u4e00\u6837\uff0c\u8fdb\u884c\u70b9\u79ef\u5c31\u597d\u4e86\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u8981\u8003\u8651\u7684\u5c31\u662f\u7269\u4f53\u7684\u7c97\u7cd9\u7a0b\u5ea6\uff0c\u7269\u4f53\u8d8a\u7c97\u7cd9\uff0c\u955c\u9762\u5149\u9762\u79ef\u8d8a\u5c0f\uff0c\u53cd\u4e4b\u955c\u9762\u5149\u9762\u79ef\u8d8a\u5927\uff0c\u8fd9\u4e5f\u633a\u7b26\u5408\u73b0\u5b9e\u4e16\u754c\u7684\uff0c\u6bdb\u6bef\u7684\u53cd\u5c04\u5149\u80af\u5b9a\u6ca1\u6709\u73bb\u7483\u7684\u53cd\u5c04\u5149\u5927\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-specular-light/#_1","title":"\u5b9e\u8df5","text":"<p>\u52a0\u5165\u955c\u9762\u5149\u5bf9\u7a0b\u5e8f\u7684\u5f71\u54cd\u4e3b\u8981\u8fd8\u662f\u5728\u7740\u8272\u5668\u4ee3\u7801\u4e0a\u3002</p> <p>\u5bf9\u4e8e\u7247\u6bb5\u7740\u8272\u5668\uff0c\u4f9d\u65e7\u53d8\u5316\u4e0d\u5927\uff0c\u4e3b\u8981\u7684\u8ba1\u7b97\u5de5\u4f5c\u5728\u9876\u70b9\u7740\u8272\u5668\uff0c\u9876\u70b9\u7740\u8272\u5668\u8ba1\u7b97\u5b8c\u6700\u540e\u955c\u9762\u5149\u7167\u5c04\u5f3a\u5ea6\u4e4b\u540e\uff0c\u76f4\u63a5\u4f20\u9012\u7ed9\u7247\u6bb5\u7740\u8272\u5668\u5c31\u597d\u4e86\u3002</p> <pre><code>#version 300 es\nprecision mediump float;\nuniform float uR;\nin vec3 vPosition;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u9876\u70b9\u4f4d\u7f6e\nin vec4 vDiffuse;//\u63a5\u6536\u4ece\u9876\u70b9\u7740\u8272\u5668\u8fc7\u6765\u7684\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6\nout vec4 fragColor;\nvoid main()\n{\n   // \u7701\u7565\u4e00\u4e9b\u4ee3\u7801\n   //\u6700\u7ec8\u989c\u8272\n   vec4 finalColor=vec4(color,0);\n   //\u6839\u636e\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6\u8ba1\u7b97\u7247\u5143\u7684\u6700\u7ec8\u989c\u8272\u503c\n   fragColor=finalColor*vDiffuse;\n}\n</code></pre> <p>\u91cd\u70b9\u4f9d\u65e7\u662f\u9876\u70b9\u7740\u8272\u5668\uff1a</p> <pre><code>#version 300 es\nuniform mat4 uMVPMatrix;    //\u603b\u53d8\u6362\u77e9\u9635\nuniform mat4 uMMatrix;      //\u53d8\u6362\u77e9\u9635\nuniform vec3 uLightLocation;    //\u5149\u6e90\u4f4d\u7f6e\nuniform vec3 uCamera;       //\u6444\u50cf\u673a\u4f4d\u7f6e\nin vec3 aPosition;      //\u9876\u70b9\u4f4d\u7f6e\nin vec3 aNormal;    //\u6cd5\u5411\u91cf\nout vec3 vPosition;     //\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u9876\u70b9\u4f4d\u7f6e\nout vec4 vSpecular;     //\u7528\u4e8e\u4f20\u9012\u7ed9\u7247\u5143\u7740\u8272\u5668\u7684\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6\n\nvoid pointLight(                //\u5b9a\u4f4d\u5149\u5149\u7167\u8ba1\u7b97\u7684\u65b9\u6cd5\n  in vec3 normal,           //\u6cd5\u5411\u91cf\n  inout vec4 specular,      //\u955c\u9762\u5149\u6700\u7ec8\u5f3a\u5ea6\n  in vec3 lightLocation,        //\u5149\u6e90\u4f4d\u7f6e\n  in vec4 lightSpecular     //\u955c\u9762\u5149\u5f3a\u5ea6\n){\n  vec3 normalTarget=aPosition+normal;   //\u8ba1\u7b97\u53d8\u6362\u540e\u7684\u6cd5\u5411\u91cf\n  vec3 newNormal=(uMMatrix*vec4(normalTarget,1)).xyz-(uMMatrix*vec4(aPosition,1)).xyz;\n  newNormal=normalize(newNormal);   //\u5bf9\u6cd5\u5411\u91cf\u5f52\u4e00\u5316\n  //\u8ba1\u7b97\u4ece\u8868\u9762\u70b9\u5230\u6444\u50cf\u673a\u7684\u5411\u91cf\n  vec3 eye= normalize(uCamera-(uMMatrix*vec4(aPosition,1)).xyz);\n  //\u8ba1\u7b97\u4ece\u8868\u9762\u70b9\u5230\u5149\u6e90\u4f4d\u7f6e\u7684\u5411\u91cfvp\n  vec3 vp= normalize(lightLocation-(uMMatrix*vec4(aPosition,1)).xyz);\n  vp=normalize(vp);//\u683c\u5f0f\u5316vp\n  vec3 halfVector=normalize(vp+eye);    //\u6c42\u89c6\u7ebf\u4e0e\u5149\u7ebf\u7684\u534a\u5411\u91cf\n  // \u7269\u4f53\u8868\u9762\u7684\u5149\u6ed1\u5ea6\uff0c\u81ea\u5df1\u62df\u5b9a\u4e3a 50.0\n  float shininess=50.0;             //\u7c97\u7cd9\u5ea6\uff0c\u8d8a\u5c0f\u8d8a\u5149\u6ed1\n\n  float nDotViewHalfVector=dot(newNormal,halfVector);           //\u6cd5\u7ebf\u4e0e\u534a\u5411\u91cf\u7684\u70b9\u79ef\n  float powerFactor=max(0.0,pow(nDotViewHalfVector,shininess));     //\u955c\u9762\u53cd\u5c04\u5149\u5f3a\u5ea6\u56e0\u5b50\n\n  specular=lightSpecular*powerFactor;    //\u6700\u7ec8\u7684\u955c\u9762\u5149\u5f3a\u5ea6\n}\n\nvoid main()  {\n   gl_Position = uMVPMatrix * vec4(aPosition,1); //\u6839\u636e\u603b\u53d8\u6362\u77e9\u9635\u8ba1\u7b97\u6b64\u6b21\u7ed8\u5236\u6b64\u9876\u70b9\u7684\u4f4d\u7f6e\n   vec4 specularTemp=vec4(0.0,0.0,0.0,0.0);\n   pointLight(normalize(aNormal), specularTemp, uLightLocation, vec4(0.7,0.7,0.7,1.0));//\u8ba1\u7b97\u955c\u9762\u5149\n   vSpecular=specularTemp;  //\u5c06\u6700\u7ec8\u955c\u9762\u5149\u5f3a\u5ea6\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n   vPosition = aPosition;       //\u5c06\u9876\u70b9\u7684\u4f4d\u7f6e\u4f20\u7ed9\u7247\u5143\u7740\u8272\u5668\n}\n</code></pre> <p>\u5728\u6563\u5c04\u5149\uff0c\u6211\u4eec\u9700\u8981\u4f20\u9012\u5149\u6e90\u7684\u4f4d\u7f6e\uff0c\u800c\u5728\u955c\u9762\u5149\u4e2d\uff0c\u4e0d\u4ec5\u4ec5\u662f\u5149\u6e90\u7684\u4f4d\u7f6e\uff0c\u8fd8\u9700\u8981\u628a\u76f8\u673a\u7684\u4f4d\u7f6e\u4f20\u9012\u7ed9\u7740\u8272\u5668\u4ee3\u7801\u7528\u4e8e\u8ba1\u7b97\u3002</p> <p>\u5728\u9876\u70b9\u7740\u8272\u5668\u4ee3\u7801\u4e2d\uff0c\u8fd8\u662f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u51fd\u6570 pointLight \u7528\u4e8e\u8ba1\u7b97\u955c\u9762\u5149\u7167\u5c04\u5f3a\u5ea6\u3002</p> <p>\u7531\u4e8e\u6cd5\u5411\u91cf\u7684\u57fa\u4e8e\u7269\u4f53\u6a21\u578b\u7a7a\u95f4\u5b9a\u4e49\u7684\uff0c\u9996\u5148\u8fd8\u662f\u8981\u5c06\u6cd5\u5411\u91cf\u8f6c\u6362\u5230\u4e16\u754c\u6a21\u578b\u7a7a\u95f4\u4e2d\u3002</p> <pre><code>  vec3 normalTarget=aPosition+normal;   //\u8ba1\u7b97\u53d8\u6362\u540e\u7684\u6cd5\u5411\u91cf\n  vec3 newNormal=(uMMatrix*vec4(normalTarget,1)).xyz-(uMMatrix*vec4(aPosition,1)).xyz;\n</code></pre> <p>\u5176\u6b21\u5c06\u6cd5\u5411\u91cf\u5f52\u4e00\u5316\uff0c\u7136\u540e\u8ba1\u7b97\u7269\u4f53\u8868\u9762\u7684\u70b9\u5230\u89c2\u5bdf\u70b9\u76f8\u673a\u7684\u5411\u91cf\u3001\u8ba1\u7b97\u7269\u4f53\u8868\u9762\u7684\u70b9\u5230\u5149\u6e90\u4f4d\u7f6e\u7684\u5411\u91cf\uff0c\u5e76\u5c06\u8fd9\u4e24\u4e2a\u5411\u91cf\u4e5f\u8fdb\u884c\u5f52\u4e00\u5316\u3002</p> <pre><code>  newNormal=normalize(newNormal);   //\u5bf9\u6cd5\u5411\u91cf\u5f52\u4e00\u5316\n  //\u8ba1\u7b97\u4ece\u8868\u9762\u70b9\u5230\u6444\u50cf\u673a\u7684\u5411\u91cf\n  vec3 eye= normalize(uCamera-(uMMatrix*vec4(aPosition,1)).xyz);\n  //\u8ba1\u7b97\u4ece\u8868\u9762\u70b9\u5230\u5149\u6e90\u4f4d\u7f6e\u7684\u5411\u91cfvp\n  vec3 vp= normalize(lightLocation-(uMMatrix*vec4(aPosition,1)).xyz);\n  vp=normalize(vp);//\u5f52\u4e00\u5316vp\n</code></pre> <p>\u5f97\u5230\u8fd9\u4e09\u4e2a\u5411\u91cf\u5f52\u4e00\u5316\u4e4b\u540e\u7684\u5411\u91cf\uff0c\u76f8\u5bf9\u4e8e\u5c31\u662f\u5728\u4e3a\u63a5\u4e0b\u6765\u7684\u8ba1\u7b97\u505a\u51c6\u5907\u4e86\u3002</p> <p>\u9996\u5148\u662f\u5f97\u5230<code>\u534a\u5411\u91cf</code>\uff0c\u5e76\u5c06\u5b83\u5f52\u4e00\u5316\uff0c\u63a5\u7740\u5c31\u662f\u6c42<code>\u534a\u5411\u91cf</code>\u548c\u6cd5\u5411\u91cf\u7684\u70b9\u79ef\uff0c\u5f97\u5230\u4f59\u5f26\u503c\u3002</p> <pre><code>  vec3 halfVector=normalize(vp+eye);    //\u6c42\u89c6\u7ebf\u4e0e\u5149\u7ebf\u7684\u534a\u5411\u91cf\n  float nDotViewHalfVector=dot(newNormal,halfVector);           //\u6cd5\u7ebf\u4e0e\u534a\u5411\u91cf\u7684\u70b9\u79ef\n</code></pre> <p>\u7136\u540e\u5c31\u662f\u8ba1\u7b97\u4f59\u5f26\u503c\u4e0e\u7269\u4f53\u8868\u9762\u7c97\u7cd9\u56e0\u5b50\u7684\u5e73\u65b9\uff0c\u5e76\u548c 0 \u8fdb\u884c\u6bd4\u8f83\uff0c\u82e5\u5c0f\u4e8e 0\uff0c\u5219\u4e3a 0 \uff0c\u6700\u540e\u5f97\u5230\u7684\u662f\u955c\u9762\u53cd\u5c04\u5149\u5f3a\u5ea6\u56e0\u5b50\u3002</p> <pre><code>  // \u7269\u4f53\u8868\u9762\u7684\u5149\u6ed1\u5ea6\uff0c\u81ea\u5df1\u62df\u5b9a\u4e3a 50.0\n  float shininess=50.0;             //\u7c97\u7cd9\u5ea6\uff0c\u8d8a\u5c0f\u8d8a\u5149\u6ed1\n  float powerFactor=max(0.0,pow(nDotViewHalfVector,shininess));     //\u955c\u9762\u53cd\u5c04\u5149\u5f3a\u5ea6\u56e0\u5b50\n</code></pre> <p>\u5c06\u53cd\u5c04\u5149\u5f3a\u5ea6\u56e0\u5b50\u548c\u955c\u9762\u5149\u5f3a\u5ea6\u76f8\u4e58\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u955c\u9762\u5149\u5f3a\u5ea6\uff0c\u8fd9\u4e2a\u5f3a\u5ea6\u5c31\u662f\u7528\u6765\u4f20\u9012\u7ed9\u7247\u6bb5\u7740\u8272\u5668\u7684\u6700\u7ec8\u955c\u9762\u5149\u5f3a\u5ea6\u3002</p> <p>\u4f7f\u7528\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5982\u679c\u6211\u4eec\u6539\u53d8\u81ea\u5df1\u62df\u5b9a\u7684\u7269\u4f53\u7c97\u7cd9\u5ea6\uff0c\u7c97\u7cd9\u5ea6\u8d8a\u5927\uff0c\u4f1a\u4f7f\u5f97\u955c\u9762\u5149\u9762\u79ef\u8d8a\u5c0f\uff0c\u7c97\u7cd9\u5ea6\u8d8a\u5c0f\uff0c\u4f1a\u4f7f\u5f97\u955c\u9762\u5149\u9762\u79ef\u8d8a\u5927\u3002</p> <p>\u540c\u65f6\uff0c\u62d6\u52a8\u6ed1\u5757\uff0c\u6539\u53d8\u5149\u6e90\u7684\u4f4d\u7f6e\uff0c\u4e5f\u4f1a\u5f71\u54cd\u955c\u9762\u5149\u53cd\u5c04\u7684\u5730\u65b9\uff0c\u955c\u9762\u5149\u4e5f\u53d7\u5149\u6e90\u7684\u5f71\u54cd\u3002</p> <p>\u5177\u4f53\u7684\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff0c\u6c42\u4e00\u6ce2 Star \u3002</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-specular-light/#_2","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/","title":"OpenGL \u5b66\u4e60\u7cfb\u5217\u4e4b\u7eb9\u7406","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/Y3FsQrJJWQogD3PWWo1cVQ</p> <p>\u63a5\u4e0b\u6765\u63a2\u7d22\u7eb9\u7406\u4e86\u3002</p> <p>\u7eb9\u7406\uff0c\u7b80\u5355\u7684\u7406\u89e3\u5c31\u662f\u4e00\u526f\u56fe\u50cf\u3002\u800c\u628a\u4e00\u526f\u56fe\u50cf\u6620\u5c04\u5230\u56fe\u5f62\u4e0a\u7684\u8fc7\u7a0b\uff0c\u53eb\u505a<code>\u7eb9\u7406\u6620\u5c04</code>\u3002</p> <p>\u6bd4\u5982\u6709\u5982\u4e0b\u56fe\u5f62\u548c\u4e09\u89d2\u5f62\uff0c\u60f3\u8981\u628a\u56fe\u5f62\u4e2d\u7684\u4e00\u90e8\u5206\u6620\u5c04\u5230\u4e09\u89d2\u5f62\u4e0a\u3002</p> <p>\u7ed3\u679c\u5c31\u662f\u8fd9\u6837\u7684\uff1a</p> <p>\u8fd9\u5c31\u662f\u7eb9\u7406\u6620\u5c04\u7684\u4e00\u4e2a\u5c0f\u5c0f\u4f8b\u5b50\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/#_1","title":"\u57fa\u672c\u539f\u7406","text":"<p>\u8981\u6ce8\u610f\u5230\uff0cOpenGL \u7ed8\u5236\u7684\u7269\u4f53\u662f 3D \u7684\uff0c\u800c\u7eb9\u7406\u662f 2D \u7684\uff0c\u90a3\u4e48\u7eb9\u7406\u6620\u5c04\u5c31\u662f\u5c06 2D \u7684\u7eb9\u7406\u6620\u5c04\u5230 3D \u7684\u7269\u4f53\u4e0a\uff0c\u53ef\u4ee5\u60f3\u8c61\u6210\u7528\u4e00\u5f20\u7eb8\u88f9\u7740\u4e00\u4e2a\u7269\u4f53\u4e00\u6837\uff0c\u4e0d\u8fc7\u8981\u6309\u7167\u4e00\u5b9a\u89c4\u5f8b\u6765\u3002</p> <p>OpenGL \u4e2d\u7ed8\u5236\u7684\u7269\u4f53\u662f\u6709\u5750\u6807\u7cfb\u7684\uff0c\u6bcf\u4e2a\u70b9\u90fd\u5bf9\u5e94 x\u3001y\u3001z \u5750\u6807\uff0c\u800c\u7eb9\u7406\u4e5f\u6709\u7740\u5b83\u7684\u5750\u6807\uff0c\u53ea\u8981 3D \u7269\u4f53\u4e2d\u7684\u6bcf\u4e2a\u70b9\u90fd\u5bf9\u5e94\u4e86 2D \u7eb9\u7406\u4e2d\u7684\u67d0\u4e2a\u70b9\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u628a\u7eb9\u7406\u6620\u5c04\u5230 3D \u7269\u4f53\u4e0a\u53bb\u4e86\u3002</p> <p>\u7eb9\u7406\u7684\u5750\u6807\uff0c\u53eb\u505a<code>\u7eb9\u7406\u5750\u6807\u7cfb</code>\u3002\u5b83\u7684\u8303\u56f4\u53ea\u6709 \\([0,0]\\) \u5230 \\([1,1]\\) \u3002</p> <p></p> <p>\u5b83\u7684\u5750\u6807\u539f\u70b9\u4f4d\u4e8e\u5de6\u4e0b\u89d2\uff0c\u6c34\u5e73\u5411\u53f3\u4e3a S \u8f74\uff0c\u7ad6\u76f4\u5411\u4e0a\u4e3a Y \u8f74\u3002\u4e0d\u8bba\u5b9e\u9645\u7684\u7eb9\u7406\u56fe\u7247\u5c3a\u5bf8\u5927\u5c0f\u5982\u4f55\uff0c\u6a2a\u5411\u3001\u7eb5\u5411\u5750\u6807\u6700\u5927\u503c\u90fd\u662f 1 \u3002</p> <p>\u4f8b\u5982\uff1a\u5b9e\u9645\u56fe\u4e3a 512 x 256 \u50cf\u7d20\u5206\u8fa8\u7387\uff0c\u5219\u6a2a\u5411\u7b2c 512 \u4e2a\u50cf\u7d20\u5bf9\u5e94\u7eb9\u7406\u5750\u6807\u4e3a 1 \uff0c\u7eb5\u5411\u7b2c 256 \u4e2a\u50cf\u7d20\u5bf9\u5e94\u7eb9\u7406\u5750\u6807\u4e3a 1 \u3002\u4e0d\u8fc7\uff0c\u7eb9\u7406\u56fe\u6700\u597d\u662f\u91c7\u7528\u50cf\u7d20\u4e3a 2 \u7684 n \u6b21\u65b9\u7684\u7eb9\u7406\u56fe\u3002</p> <p>\u7eb9\u7406\u6620\u5c04\u7684\u57fa\u672c\u601d\u60f3\u5c31\u662f\uff1a\u9996\u5148\u4e3a\u56fe\u5143\u4e2d\u7684\u6bcf\u4e2a\u9876\u70b9\u6307\u5b9a\u6070\u5f53\u7684\u7eb9\u7406\u5750\u6807\uff0c\u7136\u540e\u901a\u8fc7\u7eb9\u7406\u5750\u6807\u5728\u7eb9\u7406\u56fe\u4e2d\u53ef\u4ee5\u786e\u5b9a\u9009\u4e2d\u7684\u7eb9\u7406\u533a\u57df\uff0c\u6700\u540e\u5c06\u9009\u4e2d\u7eb9\u7406\u533a\u57df\u4e2d\u7684\u5185\u5bb9\u6839\u636e\u7eb9\u7406\u5750\u6807\u6620\u5c04\u5230\u6307\u5b9a\u7684\u56fe\u5143\u4e0a\u3002</p> <p>\u7eb9\u7406\u6620\u5c04\u5728 OpenGL \u7684\u6e32\u67d3\u7ba1\u7ebf\u4e0a\u7684\u4f53\u73b0\uff1a\u5728\u6e32\u67d3\u7ba1\u7ebf\u4e2d\uff0c\u5148\u8fdb\u884c\u9876\u70b9\u7740\u8272\u5668\uff0c\u7ed8\u5236\u51fa\u7269\u4f53\u7684\u5927\u81f4\u5f62\u72b6\uff0c\u4e4b\u540e\u4f1a\u8fdb\u884c<code>\u5149\u6805\u5316</code>\uff0c\u5c06\u7269\u4f53\u5149\u6805\u5316\u4e3a\u8bb8\u591a\u7247\u6bb5\u7ec4\u6210\uff0c\u7136\u540e\u518d\u8fdb\u884c\u7247\u6bb5\u7740\u8272\u5668\uff0c\u5c06\u56fe\u5f62\u7684\u6bcf\u4e2a\u7247\u6bb5\u8fdb\u884c\u7740\u8272\u3002</p> <p>\u90a3\u4e48\u5c31\u9700\u8981\u5728 \u9876\u70b9\u7740\u8272\u5668 \u4e2d\u5c06\u7eb9\u7406\u7684\u5750\u6807\u4f20\u5165\uff0c\u5728\u5149\u6805\u5316\u9636\u6bb5\uff0c\u7eb9\u7406\u5750\u6807\u5c06\u6839\u636e \u9876\u70b9\u7740\u8272\u5668 \u5bf9\u5b83\u7684\u5904\u7406\u4ee5\u53ca \u7247\u6bb5\u548c\u5404\u9876\u70b9\u7684\u4f4d\u7f6e\u5173\u7cfb \u63d2\u503c\u4ea7\u751f\uff0c\u7136\u540e\u624d\u662f\u5c06\u63d2\u503c\u8ba1\u7b97\u540e\u7684\u7ed3\u679c\u4f20\u5165\u5230\u7247\u6bb5\u7740\u8272\u5668\u4e2d\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/#_2","title":"\u7740\u8272\u5668\u64cd\u4f5c","text":"<p>\u76f8\u6bd4\u76f4\u63a5\u7ed8\u5236\u56fe\u5f62\uff0c\u4f7f\u7528\u7eb9\u7406\u540e\uff0c\u7740\u8272\u5668\u4e5f\u8981\u6539\u53d8\u4e86\u3002</p> <p>\u9876\u70b9\u7740\u8272\u5668\uff1a</p> <pre><code>attribute vec4 a_Position;\nattribute vec2 a_TextureCoordinates;\nvarying vec2 v_TextureCoordinates;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_Matrix;\n\nvoid main() {\n    v_TextureCoordinates = a_TextureCoordinates ;\n    gl_Position = u_ProjectionMatrix * u_ViewMatrix * u_ModelMatrix * a_Position;\n}\n</code></pre> <p>\u5728\u9876\u70b9\u7740\u8272\u5668\u4e2d\u591a\u4e86 <code>v_TextureCoordinates</code> \u53d8\u91cf\uff0c\u5b83\u662f <code>varying</code> \u7c7b\u578b\uff0c\u610f\u601d\u4e3a\u53ef\u53d8\u7c7b\u578b\uff0c\u5728\u5149\u6805\u5316\u5904\u7406\u65f6\u4f1a\u5bf9\u8be5\u53d8\u91cf\u8fdb\u884c\u5904\u7406\uff0c\u968f\u540e\u4f20\u5165\u5230\u7247\u6bb5\u7740\u8272\u5668\u4e2d\u3002</p> <p>\u7247\u6bb5\u7740\u8272\u5668</p> <pre><code>precision mediump float;\nuniform sampler2D u_TextureUnit;\nvarying vec2 v_TextureCoordinates;\n\nvoid main(){\n    // \u672a\u4f7f\u7528\u7eb9\u7406\u7684\u989c\u8272\u8d4b\u503c \uff1a gl_FragColor = u_Color;\n    gl_FragColor = texture2D(u_TextureUnit,v_TextureCoordinates);\n}\n</code></pre> <p><code>v_TextureCoordinates1</code>\u53d8\u91cf\u5c31\u662f\u63a5\u53d7\u6765\u81ea\u9876\u70b9\u7740\u8272\u5668\u4f20\u7684\u503c\uff0c<code>u_TextureUnit</code>\u53d8\u91cf\u5c31\u662f\u4f7f\u7528\u7684\u91c7\u6837\u5668\uff0c\u7c7b\u578b\u662f<code>sampler2D</code>\u3002</p> <p>\u4f7f\u7528\u7eb9\u7406\u540e\u7684\u7247\u6bb5\u7740\u8272\u5668\u8981\u4f7f\u7528 <code>texture2D</code> \u51fd\u6570\u7ed9\u989c\u8272\u8d4b\u503c\u3002</p> <p><code>texture2D</code>\u51fd\u6570\u7684\u4f5c\u7528\u5c31\u662f\u91c7\u6837\uff0c\u4ece\u7eb9\u7406\u4e2d\u91c7\u53d6\u50cf\u7d20\u8d4b\u503c\u7ed9 <code>gl_FragColor</code>\u53d8\u91cf\uff0c\u4e5f\u5c31\u662f\u6700\u540e\u7684\u989c\u8272\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/#_3","title":"\u4e0a\u5c42\u4ee3\u7801","text":"<p>\u5927\u81f4\u4e86\u89e3\u4e86\u7740\u8272\u5668\u4ee3\u7801\uff0c\u63a5\u7740\u5c31\u662f\u4e0a\u5c42\u7684 Java \u4ee3\u7801\u4e86\u3002</p> <p>\u548c\u8981\u521b\u5efa\u4e00\u4e2a OpenGL ProgramId \u7c7b\u4f3c\uff0c\u4f7f\u7528\u7eb9\u7406\u4e5f\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7eb9\u7406 ID\u3002</p> <pre><code>     /**\n     * \u8fd4\u56de\u52a0\u8f7d\u56fe\u50cf\u540e\u7684 OpenGl \u7eb9\u7406\u7684 ID\n     * @param context\n     * @param resourceId\n     * @return\n     */\n    public static int loadTexture(Context context, int resourceId) {\n        final int[] textureObjectIds = new int[1];\n        glGenTextures(1, textureObjectIds, 0);\n        if (textureObjectIds[0] == 0) {\n            Timber.d(\"Could not generate a new OpenGL texture object.\");\n            return 0;\n        }\n        final BitmapFactory.Options options = new BitmapFactory.Options();\n        options.inScaled = false;\n        final Bitmap bitmap = BitmapFactory.decodeResource(context.getResources(), resourceId, options);\n\n        if (bitmap == null) {\n            Timber.d(\"resource Id could not be decoded\");\n            glDeleteTextures(1, textureObjectIds, 0);\n            return 0;\n        }\n\n        glBindTexture(GL_TEXTURE_2D, textureObjectIds[0]);\n\n        // \u8bbe\u7f6e\u7f29\u5c0f\u7684\u60c5\u51b5\u4e0b\u8fc7\u6ee4\u65b9\u5f0f\n        glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);\n        // \u8bbe\u7f6e\u653e\u5927\u7684\u60c5\u51b5\u4e0b\u8fc7\u6ee4\u65b9\u5f0f\n        glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);\n\n        // \u52a0\u8f7d\u7eb9\u7406\u5230 OpenGL\uff0c\u8bfb\u5165 Bitmap \u5b9a\u4e49\u7684\u4f4d\u56fe\u6570\u636e\uff0c\u5e76\u628a\u5b83\u590d\u5236\u5230\u5f53\u524d\u7ed1\u5b9a\u7684\u7eb9\u7406\u5bf9\u8c61\n        // \u5f53\u524d\u7ed1\u5b9a\u7684\u7eb9\u7406\u5bf9\u8c61\u5c31\u4f1a\u88ab\u9644\u52a0\u4e0a\u7eb9\u7406\u56fe\u50cf\u3002\n        texImage2D(GL_TEXTURE_2D, 0, bitmap, 0);\n\n        bitmap.recycle();\n\n        // \u4e3a\u5f53\u524d\u7ed1\u5b9a\u7684\u7eb9\u7406\u81ea\u52a8\u751f\u6210\u6240\u6709\u9700\u8981\u7684\u591a\u7ea7\u6e10\u8fdc\u7eb9\u7406\n        // \u751f\u6210 MIP \u8d34\u56fe\n        glGenerateMipmap(GL_TEXTURE_2D);\n\n        // \u89e3\u9664\u4e0e\u7eb9\u7406\u7684\u7ed1\u5b9a\uff0c\u907f\u514d\u7528\u5176\u4ed6\u7684\u7eb9\u7406\u65b9\u6cd5\u610f\u5916\u5730\u6539\u53d8\u8fd9\u4e2a\u7eb9\u7406\n        glBindTexture(GL_TEXTURE_2D, 0);\n\n        return textureObjectIds[0];\n    }\n</code></pre> <ol> <li>\u9996\u5148\u4f7f\u7528 <code>glGenTextures</code> \u521b\u5efa\u7eb9\u7406 ID\u3002</li> <li>\u5982\u679c\u521b\u5efa\u5931\u8d25\uff0c\u5219\u4f7f\u7528 <code>glDeleteTextures</code> \u5220\u9664\u5e76\u9000\u51fa\u3002</li> <li>\u521b\u5efa\u6210\u529f\u4e4b\u540e\uff0c\u4f7f\u7528 <code>glBindTexture</code> \u51fd\u6570\u5c06\u7eb9\u7406 ID \u548c\u7eb9\u7406\u76ee\u6807\u7ed1\u5b9a\u3002</li> <li>\u4e4b\u540e\u4f1a\u8bbe\u7f6e\u7eb9\u7406\u5728\u7f29\u5c0f\u548c\u653e\u5927\u60c5\u51b5\u4e0b\u7684\u8fc7\u6ee4\u65b9\u5f0f\u3002</li> <li>\u518d\u4f7f\u7528 <code>texImage2D</code> \u5c06\u7eb9\u7406\u76ee\u6807\u548c Bitmap \u56fe\u7247\u7ed1\u5b9a\u3002</li> <li>\u4f7f\u7528 <code>glGenerateMipmap</code> \u51fd\u6570\u751f\u6210\u591a\u7ea7\u6e10\u8fdc\u7eb9\u7406\u548c MIP \u7eb9\u7406\u8d34\u56fe\u3002</li> <li>\u518d\u4f7f\u7528 <code>glBindTexture</code>\u51fd\u6570\u89e3\u9664\u7ed1\u5b9a\u3002</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/#glbindtexture","title":"glBindTexture \u51fd\u6570","text":"<p>\u8fd9\u91cc\u8981\u91cd\u70b9\u8bf4\u4e00\u4e0b glBindTexture \u51fd\u6570\u3002</p> <p>\u5b83\u7684\u4f5c\u7528\u662f\u7ed1\u5b9a\u7eb9\u7406\u540d\u5230\u6307\u5b9a\u7684\u5f53\u524d\u6d3b\u52a8\u7eb9\u7406\u5355\u5143\uff0c\u5f53\u4e00\u4e2a\u7eb9\u7406\u7ed1\u5b9a\u5230\u4e00\u4e2a\u76ee\u6807\u65f6\uff0c\u76ee\u6807\u7eb9\u7406\u5355\u5143\u5148\u524d\u7ed1\u5b9a\u7684\u7eb9\u7406\u5bf9\u8c61\u5c06\u88ab\u81ea\u52a8\u65ad\u5f00\u3002\u7eb9\u7406\u76ee\u6807\u9ed8\u8ba4\u7ed1\u5b9a\u7684\u662f 0 \uff0c\u6240\u4ee5\u8981\u65ad\u5f00\u65f6\uff0c\u4e5f\u518d\u5c06\u7eb9\u7406\u76ee\u6807\u7ed1\u5b9a\u5230 0 \u5c31\u597d\u4e86\u3002</p> <p>\u6240\u4ee5\u5728\u4ee3\u7801\u7684\u6700\u540e\u8c03\u7528\u4e86 <code>glBindTexture(GL_TEXTURE_2D, 0)</code> \u6765\u89e3\u9664\u7ed1\u5b9a\u3002</p> <p>\u5f53\u4e00\u4e2a\u7eb9\u7406\u88ab\u7ed1\u5b9a\u65f6\uff0c\u5728\u7ed1\u5b9a\u7684\u76ee\u6807\u4e0a\u7684 OpenGL \u64cd\u4f5c\u5c06\u4f5c\u7528\u5230\u7ed1\u5b9a\u7684\u7eb9\u7406\u4e0a\uff0c\u5e76\u4e14\uff0c\u5bf9\u7ed1\u5b9a\u7684\u76ee\u6807\u7684\u67e5\u8be2\u4e5f\u5c06\u8fd4\u56de\u5176\u4e0a\u7ed1\u5b9a\u7684\u7eb9\u7406\u7684\u72b6\u6001\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u7eb9\u7406\u76ee\u6807\u6210\u4e3a\u4e86\u88ab\u7ed1\u5b9a\u5230\u5b83\u4e0a\u9762\u7684\u7eb9\u7406\u7684\u522b\u540d\uff0c\u800c\u7eb9\u7406\u540d\u79f0\u4e3a 0 \u5219\u4f1a\u5f15\u7528\u5230\u5b83\u7684\u9ed8\u8ba4\u7eb9\u7406\u3002\u6240\u4ee5\uff0c\u5f53\u540e\u7eed\u5bf9\u7eb9\u7406\u76ee\u6807\u8c03\u7528 <code>glTexParameteri</code> \u51fd\u6570\u8bbe\u7f6e\u8fc7\u6ee4\u65b9\u5f0f\uff0c\u5176\u5b9e\u4e5f\u662f\u5bf9\u7eb9\u7406\u8bbe\u7f6e\u7684\u8fc7\u6ee4\u65b9\u5f0f\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/#_4","title":"\u7ed1\u5b9a\u7eb9\u7406\u4e2d\u7684\u503c","text":"<p>\u521b\u5efa\u5e76\u4e14\u8bbe\u7f6e\u4e86\u7eb9\u7406\u7740\u8272\u5668ID\u4e4b\u540e\uff0c\u5c31\u9700\u8981\u7ed1\u5b9a\u5e76\u8bbe\u7f6e\u5728\u7740\u8272\u5668\u8bed\u8a00\u4e2d\u7684\u53d8\u91cf\u4e86\u3002</p> <pre><code>        // \u7ed1\u5b9a\u7740\u8272\u5668\u811a\u672c\u4e2d\u7684\u53d8\u91cf\n        uTextureUnitAttr = glGetUniformLocation(mProgram, U_TEXTURE_UNIT)\n        mTextureId = TextureHelper.loadTexture(mContext,R.drawable.texture)\n        // \u6fc0\u6d3b\u7eb9\u7406\u5355\u5143\n        glActiveTexture(GL_TEXTURE0)\n        // \u7ed1\u5b9a\u7eb9\u7406\u76ee\u6807\n        glBindTexture(GL_TEXTURE_2D, mTextureId)\n        // \u7ed9\u7247\u6bb5\u7740\u8272\u5668\u4e2d\u7684\u91c7\u6837\u5668\u53d8\u91cf sample2D \u8d4b\u503c\n        glUniform1i(uTextureUnitAttr, 0)\n</code></pre> <p>\u5728\u7740\u8272\u5668\u811a\u672c\u4e2d\u5b9a\u4e49\u4e86 <code>uniform</code> \u7c7b\u578b\u7684\u91c7\u6837\u5668\u53d8\u91cf <code>sampler2D</code>\uff0c\u5728\u4e0a\u5c42\u7684\u5e94\u7528\u4ee3\u7801\u9700\u8981\u5c06\u5b83\u7ed1\u5b9a\u5e76\u8d4b\u503c\u3002\u800c <code>varying</code> \u7c7b\u578b\u7684\u53d8\u91cf\u7531\u9876\u70b9\u7740\u8272\u5668\u4f20\u8fc7\u53bb\uff0c\u4e0d\u9700\u8981\u53e6\u5916\u8d4b\u503c\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u8981\u4f7f\u7528 glActiveTexture \u51fd\u6570\u6fc0\u6d3b\u7eb9\u7406\u5355\u5143\u3002\u5728\u4e00\u4e2a\u7cfb\u7edf\u4e2d\uff0c\u7eb9\u7406\u5355\u5143\u7684\u6570\u636e\u662f\u6709\u9650\u7684\uff0c\u5728\u6e90\u7801\u4e2d\u4ece GL_TEXTURE0 \u5230 GL_TEXTURE31 \u5171\u5b9a\u4e49\u4e86\u4e09\u5341\u4e8c\u4e2a\u7eb9\u7406\u5355\u5143\uff0c\u4f46\u5177\u4f53\u6570\u91cf\u6839\u636e\u673a\u578b\u800c\u5b9a\u3002</p> <p>\u901a\u8fc7 GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS \u5e38\u91cf\u53ef\u4ee5\u67e5\u8be2\u5230\u3002</p> <pre><code>   var intBuffer:IntBuffer = IntBuffer.allocate(1)\n   glGetIntegerv(GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS,intBuffer)\n   LogUtil.d(\"max combined texture image units \" + intBuffer[0])\n</code></pre> <p>\u6fc0\u6d3b\u4e86\u7eb9\u7406\u5355\u5143\uff0c\u8fd8\u9700\u8981\u518d\u7ed1\u5b9a\u7eb9\u7406\u76ee\u6807\u3002</p> <p>\u4e00\u4e2a\u7eb9\u7406\u5355\u5143\u5305\u542b\u4e86\u591a\u4e2a\u7c7b\u578b\u7eb9\u7406\u76ee\u6807\uff0c\u5982\uff1aGL_TEXTURE_1D\u3001GL_TEXTURE_2D\u3001CUBE_MAP \u7b49\u7b49\u3002</p> <p>\u56e0\u4e3a\u7eb9\u7406\u5355\u5143\u662f\u7eb9\u7406\u7684\u4e00\u4e2a\u522b\u540d\uff0c\u6240\u4ee5\u5bf9\u7eb9\u7406\u5355\u5143\u6240\u505a\u7684\u64cd\u4f5c\uff0c\u90fd\u76f8\u5f53\u4e8e\u5bf9\u7eb9\u7406\u64cd\u4f5c\u7684\u3002\u628a\u4e00\u4e9b\u5bf9\u7eb9\u7406\u6240\u505a\u7684\u64cd\u4f5c\u63d0\u53d6\u5230\u51fd\u6570\u91cc\uff0c\u6700\u540e\u518d\u52a0\u8f7d\u7eb9\u7406\uff0c\u5e76\u7ed1\u5b9a\u5230\u7eb9\u7406\u76ee\u6807\u4e0a\u3002</p> <p>\u4f7f\u7528<code>glUniform1i</code>\u51fd\u6570\u4e3a\u91c7\u6837\u5668\u8fdb\u884c\u8d4b\u503c\u4e3a 0 \uff0c\u8fd9\u662f\u548c\u6fc0\u6d3b\u7eb9\u7406\u5355\u5143\u76f8\u5bf9\u5e94\u7684\u3002\u56e0\u4e3a\u6fc0\u6d3b\u7684\u7eb9\u7406\u5355\u5143\u4e3a 0 \uff0c\u6240\u4ee5\u8d4b\u503c\u4e5f\u662f\u4e3a 0 \u3002\u5982\u679c\u8fd9\u91cc\u4e0d\u4e00\u81f4\uff0c\u76f4\u63a5\u5c31\u770b\u4e0d\u5230\u4efb\u4f55\u4e1c\u897f\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/#_5","title":"\u5b9e\u9645\u6548\u679c","text":"<p>\u5f53\u7ed1\u5b9a\u5e76\u8bbe\u7f6e\u597d\u7247\u6bb5\u7740\u8272\u5668\u4e2d\u7684\u503c\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u7684\u6d41\u7a0b\u5c31\u548c\u7ed8\u5236\u57fa\u672c\u56fe\u5f62\u4e00\u6837\u4e86\u3002</p> <p>\u5177\u4f53\u7684\u7ed8\u5236\u64cd\u4f5c\u90fd\u5728\u7247\u6bb5\u7740\u8272\u5668\u91cc\u9762\u5b9a\u4e49\u4e86\uff0c\u800c\u5728\u4e0a\u5c42\u4ee3\u7801\u4e2d\u5c31\u4e0d\u7528\u82b1\u8d39\u5f88\u591a\u5fc3\u601d\u4e86\uff0c\u5728\u9876\u70b9\u7740\u8272\u5668\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c\u751a\u81f3\u53ef\u4ee5\u53ea\u6539\u53d8\u7247\u6bb5\u7740\u8272\u5668\u7684\u503c\u6765\u7ed8\u5236\u4e0d\u540c\u7684\u7eb9\u7406\u6548\u679c\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/#_6","title":"\u603b\u7ed3 &amp; \u540d\u8bcd\u6df7\u6dc6\u70b9","text":"<p>\u5728\u4e0a\u9762\u65e2\u662f\u7eb9\u7406\u5355\u5143\u53c8\u662f\u7eb9\u7406\u76ee\u6807\u7684\u5f88\u5bb9\u6613\u641e\u6df7\uff0c\u68b3\u7406\u4e00\u4e0b\u6982\u5ff5\uff1a</p> <p>\u5f62\u5982 GL_TEXTURE0\u3001GL_TEXTURE1\u3001GL_TEXTURE2 \u7684\u5c31\u662f\u7eb9\u7406\u5355\u5143\uff0c\u4e00\u53f0\u673a\u5b50\u4e0a\u7eb9\u7406\u5355\u5143\u6570\u91cf\u662f\u6709\u9650\u7684\uff0c\u4f9d\u5177\u4f53\u673a\u578b\u800c\u5b9a\u3002\u800c glActiveTexture \u5219\u662f\u6fc0\u6d3b\u5177\u4f53\u7684\u7eb9\u7406\u5355\u5143\u3002</p> <p>\u4e00\u4e2a\u7eb9\u7406\u5355\u5143\u53c8\u5305\u542b\u591a\u4e2a\u7c7b\u578b\u7684\u7eb9\u7406\u76ee\u6807\uff0c\u6709\uff1aGL_TEXTURE_1D\u3001GL_TEXTURE_2D\u3001CUBE_MAP \u7b49\u7b49\u3002</p> <p>\u901a\u8fc7 glGenTextures \u51fd\u6570\u751f\u6210\u7684 int \u7c7b\u578b\u7684\u503c\u5c31\u662f\u7eb9\u7406\uff0c\u901a\u8fc7 glBindTexture \u51fd\u6570\u5c06\u7eb9\u7406\u76ee\u6807\u548c\u7eb9\u7406\u7ed1\u5b9a\u540e\uff0c\u5bf9\u7eb9\u7406\u76ee\u6807\u6240\u8fdb\u884c\u7684\u64cd\u4f5c\u90fd\u53cd\u6620\u5230\u5bf9\u7eb9\u7406\u4e0a\u3002</p> <p>\u7eb9\u7406\u76ee\u6807\u9700\u8981\u901a\u8fc7 texImage2D \u51fd\u6570\u9644\u52a0\u4e0a Bitmap \u4f4d\u56fe\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-texture/#_7","title":"\u53c2\u8003","text":"<ol> <li>http://blog.csdn.net/opengl_es/article/details/19852277</li> <li>http://blog.csdn.net/artisans/article/details/76695614</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-array-object-usage/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b \u9876\u70b9\u6570\u7ec4\u5bf9\u8c61 VAO \u7684\u4f7f\u7528","text":"<p>\u5728\u4e4b\u524d\u4f7f\u7528 OpenGL \u9876\u70b9\u7f13\u51b2\u533a VBO \u7684\u4f7f\u7528 \u4e3a\u9876\u70b9\u5750\u6807\u3001\u7eb9\u7406\u5750\u6807\u5206\u522b\u7ed1\u5b9a\u4e86\u9876\u70b9\u7f13\u51b2\u533a\uff0c\u5e76\u4e14\u5728 onDrawFrame \u65b9\u6cd5\u91cc\u9762\u4e5f\u8981\u5206\u522b\u4e3a\u9876\u70b9\u5750\u6807\u3001\u7eb9\u7406\u5750\u6807\u6307\u5b9a\u6570\u636e\u3002</p> <p>\u8fd9\u5c31\u5b58\u5728\u4e86\u4e00\u4e9b\u91cd\u590d\u7684\u64cd\u4f5c\u3002</p> <p>\u5728 OpenGL ES 3.0 \u53ef\u4ee5\u4f7f\u7528\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u6765\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u3002</p> <p>\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u53c8\u53eb\u505a VAO \uff08Vertex Array Object\uff09\u3002</p> <p>\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u7684\u4e3b\u8981\u529f\u80fd\u5c31\u662f\u5c06\u7ed8\u5236\u7684\u4e00\u4e2a\u7269\u4f53\u65f6\u6240\u9700\u7684\u5bf9\u5e94\u4e8e\u4e0d\u540c\u65b9\u9762\u7684\u9876\u70b9\u7f13\u51b2\u53ca\u76f8\u5173\u8bbe\u7f6e\u5305\u88c5\u6210\u4e00\u4e2a\u6574\u4f53\uff0c\u5728\u7ed8\u5236\u65f6\u76f4\u63a5\u4f7f\u7528\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u5373\u53ef\uff0c\u4e0d\u5fc5\u5206\u522b\u4f7f\u7528\u6bcf\u4e2a\u9876\u70b9\u7f13\u51b2\uff0c\u8fd9\u6837\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63d0\u9ad8\u7ed8\u5236\u6548\u7387\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-array-object-usage/#_1","title":"\u65b9\u6cd5\u4ecb\u7ecd","text":"<p>\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u4e3b\u8981\u63d0\u4f9b\u4e86 glGenVertexArrays \u548c glBindVertexArray \u65b9\u6cd5\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-array-object-usage/#glgenvertexarrays","title":"glGenVertexArrays \u65b9\u6cd5","text":"<p>glGenVertexArrays \u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u521b\u5efa\u65b0\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\uff0c\u65b9\u6cd5\u7b7e\u540d\u5982\u4e0b\uff1a</p> <pre><code>    public static native void glGenVertexArrays(\n        int n,\n        int[] arrays,\n        int offset\n    );\n</code></pre> <p>\u5176\u4e2d\uff0c\u53c2\u6570 n \u4e3a\u8981\u521b\u5efa\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u7684\u6570\u91cf\uff0c\u53c2\u6570 arrays \u7528\u6765\u5b58\u653e\u521b\u5efa\u7684 n \u4e2a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u7684\u7f16\u53f7\uff0c\u53c2\u6570 offset \u4e3a arrays \u6570\u7ec4\u7684\u504f\u79fb\u91cf\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-array-object-usage/#glbindvertexarray","title":"glBindVertexArray \u65b9\u6cd5","text":"<p>\u521b\u5efa\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u7528 glBindVertexArray \u65b9\u6cd5\u7ed1\u5b9a\u6307\u5b9a\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\uff0c\u4ee5\u4fbf\u5bf9\u6307\u5b9a\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u8fdb\u884c\u8bbe\u7f6e\u6216\u4f7f\u7528\uff0c\u65b9\u6cd5\u7b7e\u540d\u5982\u4e0a\uff1a</p> <pre><code>    public static native void glBindVertexArray(\n        int array\n    );\n</code></pre> <p>\u5176\u4e2d\uff0c\u53c2\u6570 array \u4e3a\u9700\u8981\u7ed1\u5b9a\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u7684\u7f16\u53f7\u3002</p> <p>\u7528 glBindVertexArray \u65b9\u6cd5\u7ed1\u5b9a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u4e4b\u540e\uff0c\u66f4\u6539\u9876\u70b9\u6570\u7ec4\u72b6\u6001\u7684\u540e\u7eed\u8c03\u7528\uff08\u5982 glBindBuffer\u3001glVertexAttribPointer\u3001glEnableVertexAttribArray\u3001glDisableVertexAttribArray \u7b49\uff09\u5c06\u5f71\u54cd\u7ed1\u5b9a\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u3002</p> <p>\u901a\u8fc7\u7ed1\u5b9a\u4e0d\u540c\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\uff0c\u7ed8\u5236\u65f6\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u5feb\u901f\u5728\u4e0d\u540c\u9876\u70b9\u6570\u7ec4\u914d\u7f6e\u4e4b\u95f4\u8fdb\u884c\u5207\u6362\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u5f00\u53d1\u6548\u7387\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-array-object-usage/#_2","title":"\u5b9e\u8df5","text":"<p>\u4e0b\u9762\u662f\u5177\u4f53\u7684\u5b9e\u8df5\uff0c\u8fd8\u662f\u7ed8\u5236\u5982\u4e0b\u7684\u4e00\u5f20\u7eb9\u7406\u56fe\uff1a</p> <p></p> <p>\u4f7f\u7528\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61 VA0 \u4e4b\u524d\uff0c\u8fd8\u662f\u5206\u522b\u4e3a\u9876\u70b9\u5750\u6807\u3001\u7eb9\u7406\u5750\u6807\u751f\u6210\u7f13\u51b2\u533a\uff0c\u5e76\u4f20\u5165\u6570\u636e\u3002</p> <pre><code>        // \u751f\u6210\u7eb9\u7406\u7f13\u51b2\u533a\n        int[] bufferIds = new int[3];\n        GLES30.glGenBuffers(3, bufferIds, 0);\n        // \u9876\u70b9\u7f13\u51b2\n        mVertexBufferId = bufferIds[0];\n        GLES30.glBindBuffer(GLES30.GL_ARRAY_BUFFER, mVertexBufferId);\n        GLES30.glBufferData(GLES30.GL_ARRAY_BUFFER, vertices.length * 4, mVertexBuffer, GLES30.GL_STATIC_DRAW);\n        GLES30.glBindBuffer(GLES30.GL_ARRAY_BUFFER, 0);\n        // \u7eb9\u7406\u7f13\u51b2\n        mTextureBufferId = bufferIds[1];\n        GLES30.glBindBuffer(GLES30.GL_ARRAY_BUFFER, mTextureBufferId);\n        GLES30.glBufferData(GLES30.GL_ARRAY_BUFFER, textures.length * 4, mTextureBuffer, GLES30.GL_STATIC_DRAW);\n        GLES30.glBindBuffer(GLES30.GL_ARRAY_BUFFER, 0);\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u4f7f\u7528\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u4e86\u3002</p> <pre><code>        // \u751f\u6210\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\n        int[] vaoIds = new int[1];\n        GLES30.glGenVertexArrays(1, vaoIds, 0);\n        mVAOId = vaoIds[0];\n        // \u7ed1\u5b9a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\n        GLES30.glBindVertexArray(mVAOId);\n        // \u5728\u7ed1\u5b9a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u4e4b\u540e \u8c03\u7528 glBindBuffer glVertexAttribPointer\n        // glEnableVertexAttribArray\uff0cglDisableVertexAttribArray \u7b49\u7b49\n        // \u5c06\u5f71\u54cd\u7ed1\u5b9a\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\n        GLES30.glBindBuffer(GLES30.GL_ARRAY_BUFFER, mVertexBufferId);\n        GLES30.glEnableVertexAttribArray(maPositionHandle);\n        GLES30.glVertexAttribPointer(maPositionHandle, 3, GLES30.GL_FLOAT, false, 3 * 4, 0);\n        GLES30.glBindBuffer(GLES30.GL_ARRAY_BUFFER, 0);\n\n        GLES30.glBindBuffer(GLES30.GL_ARRAY_BUFFER, mTextureBufferId);\n        GLES30.glEnableVertexAttribArray(maTexCoorHandle);\n        GLES30.glVertexAttribPointer(maTexCoorHandle, 2, GLES30.GL_FLOAT, false, 2 * 4, 0);\n        GLES30.glBindBuffer(GLES30.GL_ARRAY_BUFFER, 0);\n        // \u7ed1\u5b9a\u5230\u9ed8\u8ba4\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\n          GLES30.glBindVertexArray(0);\n</code></pre> <p>\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8c03\u7528\u4e86 glBindVertexArray \u7ed1\u5b9a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u4e4b\u540e\uff0c\u6211\u4eec\u8c03\u7528\u7684 glBindBuffer\u3001glVertexAttribPointer\u3001glEnableVertexAttribArray\u3001glDisableVertexAttribArray \u7b49\u65b9\u6cd5\u90fd\u5c5e\u4e8e\u8be5\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u4e4b\u5185\u4e86\uff0c\u90fd\u4f1a\u5f71\u54cd\u5230\u8fd9\u4e2a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\uff0c\u76f4\u5230\u7ed1\u5b9a\u4e86\u9ed8\u8ba4\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u3002</p> <p>\u5728\u6211\u4eec\u4f7f\u7528 \u9876\u70b9\u7f13\u51b2\u533a VBO \u7ed8\u5236\u65f6\uff0c\u8981\u5728 onDrawFrame \u65b9\u6cd5\u91cc\u9762\u4e3a\u6bcf\u4e00\u4e2a\u9876\u70b9\u5750\u6807\u3001\u7eb9\u7406\u5750\u6807\u8c03\u7528 glBindBuffer \u3001glVertexAttribPointer\u3001glEnableVertexAttribArray \u65b9\u6cd5\uff0c\u800c\u4f7f\u7528\u4e86 \u9876\u70b9\u6570\u7ec4\u5bf9\u8c61 VA0 \u4e4b\u540e\uff0c\u5c31\u4e0d\u9700\u8981\u8fd9\u4e48\u9ebb\u70e6\u4e86\uff0c\u56e0\u4e3a\u76f8\u5f53\u4e8e\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u628a\u5b83\u4eec\u90fd\u63a5\u7ba1\u4e86\uff0c\u76f4\u63a5\u7ed1\u5b9a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\u5c31\u597d\u4e86\u3002</p> <p>\u4f7f\u7528 \u9876\u70b9\u6570\u7ec4\u5bf9\u8c61 VAO \u7ed8\u5236\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>        // \u7ed1\u5b9a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\n        GLES30.glBindVertexArray(mVAOId);\n        GLES30.glBindBuffer(GLES30.GL_ELEMENT_ARRAY_BUFFER, mIndicesBufferId);\n        GLES30.glDrawElements(GLES30.GL_TRIANGLES, vCount, GLES30.GL_UNSIGNED_BYTE, 0);\n        GLES30.glBindBuffer(GLES30.GL_ELEMENT_ARRAY_BUFFER, 0);\n        // \u89e3\u9664\u7ed1\u5b9a\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61\n        GLES30.glBindVertexArray(0);\n</code></pre> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u76f8\u5f53\u4e8e\u66ff\u4ee3\u4e86\u90a3\u4e9b\u7e41\u7410\u7684\u65b9\u6cd5\uff0c\u5e76\u4e14\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u66f4\u6539\u7ed1\u5b9a\u7684\u9876\u70b9\u6570\u7ec4\u5bf9\u8c61 ID \u53bb\u66f4\u6539\u7ed8\u5236\u7684\u5185\u5bb9\uff0c\u7b80\u5355\u9ad8\u6548\u5730\u5b9e\u73b0\u5207\u6362\u9876\u70b9\u6570\u636e\u3002</p> <p>\u5173\u4e8e\u5177\u4f53\u7684\u4ee3\u7801\u5b9e\u73b0\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-array-object-usage/#_3","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/","title":"\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b\u9876\u70b9\u7f13\u51b2\u533a VBO \u7684\u4f7f\u7528","text":"<p>\u5728\u4e4b\u524d\u7684\u7ed8\u5236\u8fc7\u7a0b\u4e2d\uff0c\u9996\u5148\u90fd\u9700\u8981\u5c06\u7269\u4f53\u7684\u9876\u70b9\u6570\u636e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u7136\u540e <code>glDrawArrays</code> \u6216 <code>glDrawElements</code> \u7ed8\u5236\u524d\uff0c\u5c06\u9876\u70b9\u6570\u636e\u9001\u5165\u5230\u663e\u5b58\u4e2d\uff0c\u8fd9\u6837\u4f1a\u5b58\u5728 I/O \u5f00\u9500\u8f83\u5927\u7684\u95ee\u9898\uff0c\u6027\u80fd\u4e5f\u4e0d\u591f\u597d\u3002</p> <p>\u53ef\u4ee5\u5c06\u9876\u70b9\u6570\u636e\u5b58\u653e\u5728\u9876\u70b9\u7f13\u51b2\u533a\u4e2d\uff0c\u5c31\u4e0d\u9700\u8981\u5728\u6bcf\u6b21\u7ed8\u5236\u524d\u628a\u9876\u70b9\u6570\u636e\u590d\u5236\u8fdb\u663e\u5b58\uff0c\u800c\u662f\u5728\u521d\u59cb\u5316\u9876\u70b9\u7f13\u51b2\u533a\u5bf9\u8c61\u65f6\u4e00\u6b21\u6027\u5c06\u9876\u70b9\u6570\u636e\u9001\u5165\u663e\u5b58\uff0c\u6bcf\u6b21\u7ed8\u5236\u65f6\u76f4\u63a5\u4f7f\u7528\u663e\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5927\u5927\u63d0\u9ad8\u6e32\u67d3\u6027\u80fd\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#_1","title":"\u9876\u70b9\u7f13\u51b2\u533a","text":"<p>\u5728 OpenGL ES  \u4e2d\u652f\u6301\u4e24\u79cd\u7c7b\u578b\u7684\u9876\u70b9\u7f13\u51b2\u533a\u5bf9\u8c61\uff0c\u5206\u522b\u662f\u6570\u7ec4\u7f13\u51b2\u533a\u5bf9\u8c61\uff08Array Buffer\uff09\u548c \u5143\u7d20\u6570\u7ec4\u7f13\u51b2\u533a\u5bf9\u8c61\uff08Element Array Buffer\uff09\u3002</p> <ul> <li>\u6570\u7ec4\u7f13\u51b2\u533a\u5bf9\u8c61\u5bf9\u5e94\u7684\u7c7b\u578b\u4e3a GL_ARRAY_BUFFER\uff0c\u4e00\u822c\u7528\u4e8e\u5b58\u653e\u5f85\u7ed8\u5236\u7269\u4f53\u7684\u9876\u70b9\u76f8\u5173\u6570\u636e\uff0c\u5982\u9876\u70b9\u5750\u6807\u3001\u7eb9\u7406\u5750\u6807\u3001\u6cd5\u5411\u91cf\u7b49\u3002</li> <li>\u5143\u7d20\u6570\u7ec4\u7f13\u51b2\u533a\u5bf9\u8c61\u5bf9\u5e94\u7684\u7c7b\u578b\u4e3a GL_ELEMENT_ARRAY_BUFFER \uff0c\u4e00\u822c\u7528\u4e8e\u5b58\u653e\u56fe\u5143\u7684\u7ec4\u88c5\u7d22\u5f15\u6570\u636e\uff0c\u5728\u4f7f\u7528\u7d22\u5f15\u6cd5\u8fdb\u884c\u7ed8\u5236\u65f6\u4f7f\u7528\u3002</li> </ul> <p>\u4f7f\u7528\u9876\u70b9\u7f13\u51b2\u533a\u7684\u597d\u5904\u5c31\u5728\u4e8e\u9876\u70b9\u6570\u91cf\u975e\u5e38\u591a\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4e00\u6b21\u6027\u5c06\u5927\u91cf\u9876\u70b9\u6570\u636e\u9001\u5165\u5230\u663e\u5b58\u4e2d\u3002</p> <p>\u5173\u4e8e\u9876\u70b9\u7f13\u51b2\u533a\uff0c\u53c8\u6709\u53e6\u4e00\u79cd\u8bf4\u6cd5\uff0c\u53eb\u505a <code>VBO</code>\uff0c\u5176\u5b9e\u5c31\u662f <code>Vertex Buffer Object</code>\u7684\u7f29\u5199\u5566\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#_2","title":"\u7f13\u51b2\u533a\u5bf9\u8c61\u7684\u5e38\u7528\u64cd\u4f5c\u65b9\u6cd5","text":"<p>\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0b\u5173\u4e8e\u9876\u70b9\u7f13\u51b2\u533a\u7684\u5e38\u7528\u65b9\u6cd5\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#-glgenbuffers","title":"\u521b\u5efa\u7f13\u51b2\u533a\u5bf9\u8c61 -- glGenBuffers","text":"<p>glGenBuffers \u65b9\u6cd5\u7528\u4e8e\u521b\u5efa\u7f13\u51b2\u5bf9\u8c61\uff0c\u662f\u5728\u4f7f\u7528\u6bcf\u4e2a\u81ea\u5b9a\u4e49\u7f13\u51b2\u524d\u90fd\u9700\u8981\u8c03\u7528\u7684\u3002</p> <pre><code>    // \u65b9\u6cd5\u4e00\n    public static native void glGenBuffers(\n        int n,\n        java.nio.IntBuffer buffers\n    );\n    // \u65b9\u6cd5\u4e8c\n    public static native void glGenBuffers(\n        int n,\n        int[] buffers,\n        int offset\n    );\n</code></pre> <ol> <li>\u5728\u65b9\u6cd5\u4e00\u4e2d\uff0c\u53c2\u6570 n \u4e3a\u9700\u8981\u521b\u5efa\u7684\u7f13\u51b2\u533a\u6570\u91cf\uff0c\u53c2\u6570 buffers \u4e3a\u7528\u4e8e\u5b58\u653e\u521b\u5efa\u7684 n \u4e2a\u7f13\u51b2\u533a\u7f16\u53f7\u7684 IntBuffer \u3002</li> <li>\u5728\u65b9\u6cd5\u4e8c\u4e2d\uff0c\u53c2\u6570 n \u4e3a\u9700\u8981\u521b\u5efa\u7684\u7f13\u51b2\u533a\u6570\u91cf\uff0c\u53c2\u6570 buffers \u4e3a\u7528\u4e8e\u5b58\u653e\u521b\u5efa\u7684 n \u4e2a\u7f13\u51b2\u533a\u7f16\u53f7\u7684\u6570\u7ec4\uff0c\u53c2\u6570 offset \u4e3a buffers \u6570\u7ec4\u6240\u9700\u7684\u504f\u79fb\u91cf\u3002</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#-glbindbuffer","title":"\u7ed1\u5b9a\u7f13\u51b2\u533a\u5bf9\u8c61 -- glBindBuffer","text":"<p>glBindBuffer \u65b9\u6cd5\u7528\u4e8e\u7ed1\u5b9a\u5f53\u524d\u7f13\u51b2\u533a\u5bf9\u8c61\uff0c\u7b2c\u4e00\u6b21\u8c03\u7528 glBindBuffer \u65b9\u6cd5\u7ed1\u5b9a\u7f13\u51b2\u533a\u5bf9\u8c61\u65f6\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u4ee5\u9ed8\u8ba4\u72b6\u6001\u5206\u914d\uff1b\u5982\u679c\u5206\u914d\u6210\u529f\uff0c\u5219\u5206\u914d\u7684\u5bf9\u8c61\u7ed1\u5b9a\u4e3a\u5f53\u524d\u7f13\u51b2\u533a\u5bf9\u8c61\u3002</p> <pre><code>    public static native void glBindBuffer(\n        int target,\n        int buffer\n    );\n</code></pre> <p>\u5176\u4e2d\uff0c\u53c2\u6570 target \u7528\u4e8e\u63cf\u8ff0\u9700\u7ed1\u5b9a\u7684\u7f13\u51b2\u533a\u7c7b\u578b\uff0c\u53c2\u6570 buffer \u4e3a\u9700\u8981\u7ed1\u5b9a\u7684\u7f13\u51b2\u533a\u7f16\u53f7\u3002</p> <p>target \u503c\u5982\u4e0b\uff1a</p> target \u503c \u7f13\u51b2\u533a\u7c7b\u578b GL_ARRAY_BUFFER \u6570\u7ec4\u7f13\u51b2 GL_ELEMENT_ARRAY_BUFFER \u5143\u7d20\u6570\u7ec4\u7f13\u51b2 GL_COPY_READ_BUFFER \u590d\u5236\u53ea\u8bfb\u7f13\u51b2 GL_COPY_WRITE_BUFFER \u590d\u5236\u53ef\u5199\u7f13\u51b2 GL_PIXEL_PACK_BUFFER \u50cf\u7d20\u6253\u5305\u7f13\u51b2 GL_PIXEL_UNPACK_BUFFER \u50cf\u7d20\u89e3\u5305\u7f13\u51b2 GL_TRANSFORM_FEEDBACK_BUFFER \u53d8\u6362\u53cd\u9988\u7f13\u51b2 GL_UNIFORM_BUFFER \u4e00\u81f4\u53d8\u91cf\u7f13\u51b2","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#-glbufferdata-glbuffersubdata","title":"\u5411\u7f13\u51b2\u533a\u9001\u5165\u6570\u636e -- glBufferData \u548c glBufferSubData","text":"<p>glBufferData \u65b9\u6cd5\u4e00\u822c\u7528\u4e8e\u5411\u6307\u5b9a\u7f13\u51b2\u4e2d\u9001\u5165\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5bf9\u6307\u5b9a\u7f13\u51b2\u8fdb\u884c\u76f8\u5173\u5b58\u50a8\u7a7a\u95f4\u521d\u59cb\u5316\u3002</p> <pre><code>  public static native void glBufferData(\n        int target,\n        int size,\n        java.nio.Buffer data,\n        int usage\n    );\n</code></pre> <p>\u5176\u4e2d\uff0ctarget \u7528\u4e8e\u63cf\u8ff0\u6307\u5b9a\u7684\u7f13\u51b2\u533a\u7c7b\u578b\uff0c\u5982\u4e0a\u8868\u6240\u793a\uff1b\u53c2\u6570 size \u7528\u4e8e\u7ed9\u51fa\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff08\u5355\u4f4d\u4e3a\u5b57\u8282\uff09\uff0c\u53c2\u6570 data \u4e3a\u9700\u8981\u9001\u5165\u7f13\u51b2\u7684\u6570\u636e\uff0c\u82e5\u6ca1\u6709\u6570\u636e\u8981\u9001\u5165\u7f13\u51b2\u533a\uff0c\u5176\u503c\u53ef\u4ee5\u4e3a null\uff1b\u53c2\u6570 usage \u7528\u4e8e\u6307\u5b9a\u7f13\u51b2\u533a\u7684\u7528\u9014\uff0c\u53ef\u53d6\u7684\u503c\u5982\u4e0b\u8868\uff1a</p> \u7f13\u51b2\u533a\u7528\u9014\u53ef\u9009\u53c2\u6570\u503c \u53c2\u6570\u8bf4\u660e GL_STATIC_DRAW \u5728\u7ed8\u5236\u65f6\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u4fee\u6539\u4e00\u6b21\uff0c\u4f7f\u7528\u591a\u6b21 GL_STATIC_READ \u5728 OpenGL ES \u4e2d\u8bfb\u56de\u7684\u6570\u636e\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u4fee\u6539\u4e00\u6b21\uff0c\u4f7f\u7528\u591a\u6b21\uff0c\u4e14\u8be5\u6570\u636e\u53ef\u4ee5\u51b2\u5e94\u7528\u7a0b\u5e8f\u4e2d\u67e5\u8be2 GL_STATIC_COPY \u4ece OpenGL ES \u4e2d\u8bfb\u56de\u7684\u6570\u636e\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u4fee\u6539\u4e00\u6b21\uff0c\u4f7f\u7528\u591a\u6b21\uff0c\u8be5\u6570\u636e\u5c06\u76f4\u63a5\u4f5c\u4e3a\u7ed8\u5236\u56fe\u5143\u6216\u8005\u6307\u5b9a\u56fe\u50cf\u7684\u4fe1\u606f\u6765\u6e90 GL_DYNAMIC_DRAW \u5728\u7ed8\u5236\u65f6\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u91cd\u590d\u4fee\u6539\u3001\u4f7f\u7528\u591a\u6b21 GL_DYNAMIC_READ \u4ece OpenGL ES \u4e2d\u8bfb\u56de\u7684\u6570\u636e\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u91cd\u590d\u4fee\u6539\u3001\u4f7f\u7528\u591a\u6b21\uff0c\u4e14\u8be5\u6570\u636e\u53ef\u4ee5\u4ece\u5e94\u7528\u7a0b\u5e8f\u4e2d\u67e5\u8be2 GL_DYNAMIC_COPY \u4ece OpenGL ES \u4e2d\u8bfb\u56de\u7684\u6570\u636e\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u91cd\u590d\u4fee\u6539\u3001\u4f7f\u7528\u591a\u6b21\uff0c\u8be5\u6570\u636e\u5c06\u76f4\u63a5\u4f5c\u4e3a\u7ed8\u5236\u56fe\u5143\u6216\u8005\u6307\u5b9a\u56fe\u50cf\u7684\u4fe1\u606f\u6765\u6e90 GL_STREAM_DRAW \u5728\u7ed8\u5236\u65f6\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u4fee\u6539\u4e00\u6b21\uff0c\u4f7f\u7528\u5c11\u6570\u51e0\u6b21 GL_STREAM_READ \u4ece OpenGL ES \u4e2d\u8bfb\u56de\u7684\u6570\u636e\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u4fee\u6539\u4e00\u6b21\uff0c\u4f7f\u7528\u5c11\u6570\u51e0\u6b21\uff0c\u4e14\u8be5\u6570\u636e\u53ef\u4ee5\u4ece\u5e94\u7528\u7a0b\u5e8f\u4e2d\u67e5\u8be2 GL_STREAM_COPY \u4ece OpenGL ES \u4e2d\u8bfb\u56de\u7684\u6570\u636e\uff0c\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u636e\u53ef\u4ee5\u88ab\u4fee\u6539\u4e00\u6b21\uff0c\u4f7f\u7528\u5c11\u6570\u51e0\u6b21\uff0c\u4e14\u8be5\u6570\u636e\u5c06\u76f4\u63a5\u4f5c\u4e3a\u7ed8\u5236\u56fe\u5143\u6216\u8005\u6307\u5b9a\u56fe\u50cf\u7684\u4fe1\u606f\u6765\u6e90 <p>glBufferSubData \u65b9\u6cd5\u4e00\u822c\u7528\u4e8e\u5411\u6307\u5b9a\u7f13\u51b2\u4e2d\u9001\u5165\u90e8\u5206\u6570\u636e\u8fdb\u884c\u521d\u59cb\u5316\u6216\u8005\u66f4\u65b0\uff0c\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>    public static native void glBufferSubData(\n        int target,\n        int offset,\n        int size,\n        java.nio.Buffer data\n    );\n</code></pre> <p>\u5176\u5b9e\uff0c\u53c2\u6570 target \u8fd8\u662f\u7528\u4e8e\u63cf\u8ff0\u6307\u5b9a\u7684\u7f13\u51b2\u533a\u7c7b\u578b\uff0c\u53c2\u6570 offset \u7528\u4e8e\u7ed9\u51fa\u7f13\u51b2\u533a\u88ab\u4fee\u6539\u7684\u6570\u636e\u7684\u8d77\u59cb\u5185\u5b58\u504f\u79fb\u91cf\uff0c\u53c2\u6570 size \u7528\u4e8e\u7ed9\u51fa\u7f13\u51b2\u533a\u4e2d\u6570\u636e\u88ab\u4fee\u6539\u7684\u5b57\u8282\u6570\uff0c\u53c2\u6570 data \u4e3a\u9700\u8981\u9001\u5165\u7f13\u51b2\u7684\u6570\u636e\u3002</p> <p>\u901a\u8fc7 glBufferSubData \u65b9\u6cd5\uff0c\u53ef\u4ee5\u505a\u5230\u66f4\u6539\u6307\u5b9a\u8303\u56f4\u5185\u7684\u7f13\u51b2\u533a\u6570\u636e\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#-gldeletebuffers","title":"\u5220\u9664\u7f13\u51b2\u533a\u5bf9\u8c61 -- glDeleteBuffers","text":"<p>glDeteleBuffers \u65b9\u6cd5\u7528\u4e8e\u5220\u9664\u6307\u5b9a\u7684\u7f13\u51b2\u533a\u5bf9\u8c61\uff0c\u5176\u65b9\u6cd5\u7b7e\u540d\u5982\u4e0b\uff1a</p> <pre><code>    // \u65b9\u6cd5\u4e00\n    public static native void glDeleteBuffers(\n        int n,\n        java.nio.IntBuffer buffers\n    );\n    // \u65b9\u6cd5\u4e8c\n    public static native void glDeleteBuffers(\n        int n,\n        int[] buffers,\n        int offset\n    );\n</code></pre> <p>\u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u65b9\u6cd5\u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u53c2\u6570 n \u4e3a\u5c06\u8981\u88ab\u5220\u9664\u7684\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u91cf\uff0c\u53c2\u6570 buffers \u4e3a\u5b58\u50a8\u4e86 n \u4e2a\u8981\u5220\u9664\u7684\u7f13\u51b2\u533a\u7f16\u53f7\u7684 IntBuffer \u3002</p> <p>\u7b2c\u4e8c\u4e2a\u65b9\u6cd5\u6709\u4e09\u4e2a\u53c2\u6570\uff0c\u53c2\u6570 n \u4e3a\u5c06\u8981\u88ab\u5220\u9664\u7684\u7f13\u51b2\u533a\u5bf9\u8c61\u6570\u91cf\uff0c\u53c2\u6570 buffers \u4e3a\u5b58\u50a8\u4e86 n \u4e2a\u8981\u5220\u9664\u7f13\u51b2\u533a\u7f16\u53f7\u7684\u6570\u7ec4\uff0c\u53c2\u6570 offset \u4e3a\u6570\u7ec4\u6240\u9700\u7684\u504f\u79fb\u91cf\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#-glgetbufferparameteriv","title":"\u7f13\u51b2\u533a\u67e5\u8be2 -- glGetBufferParameteriv","text":"<p>\u53ef\u4ee5\u901a\u8fc7 glGetBufferParameteriv \u65b9\u6cd5\u67e5\u8be2\u6307\u5b9a\u7f13\u51b2\u533a\u7684\u4fe1\u606f\uff0c\u5176\u65b9\u6cd5\u7b7e\u540d\u5982\u4e0b\uff1a</p> <pre><code>    public static native void glGetBufferParameteriv(\n        int target,\n        int pname,\n        int[] params,\n        int offset\n    );\n</code></pre> <p>\u5176\u4e2d\uff0c\u53c2\u6570 target \u7528\u4e8e\u63cf\u8ff0\u6307\u5b9a\u7684\u7f13\u51b2\u533a\u7c7b\u578b\uff0c\u53c2\u6570 pname \u4e3a\u8981\u67e5\u8be2\u7684\u4fe1\u606f\u9879\u76ee\uff0c\u5177\u4f53\u9879\u76ee\u89c1\u4e0b\u8868\uff0c\u53c2\u6570 params \u7528\u4e8e\u5b58\u653e\u67e5\u8be2\u7ed3\u679c\uff0coffset \u4ee3\u8868\u67e5\u8be2\u504f\u79fb\u91cf\u3002</p> \u7f13\u51b2\u533a\u67e5\u8be2\u4fe1\u606f \u8bf4\u660e GL_BUFFER_SIZE \u7f13\u51b2\u533a\u4ee5\u5b57\u8282\u8ba1\u7684\u5927\u5c0f GL_BUFFER_USAGE \u7f13\u51b2\u533a\u7528\u9014 GL_BUFFER_MAPPED \u662f\u5426\u4e3a\u6620\u5c04\u7f13\u51b2\u533a GL_BUFFER_ACCESS_FLAGS \u7f13\u51b2\u533a\u8bbf\u95ee\u6807\u5fd7 GL_BUFFER_MAP_LENGTH \u7f13\u51b2\u533a\u6620\u5c04\u957f\u5ea6 GL_BUFFER_MAP_OFFSET \u7f13\u51b2\u533a\u6620\u5c04\u504f\u79fb\u91cf","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#_3","title":"\u5b9e\u8df5","text":"<p>\u524d\u9762\u8bf4\u4e86\u90a3\u4e48\u7406\u8bba\uff0c\u90a3\u4e48\u9488\u5bf9\u6570\u7ec4\u7f13\u51b2\u533a Array Buffer \u548c\u5143\u7d20\u6570\u7ec4\u7f13\u51b2\u533a Element Array Buffer \u5206\u522b\u8fdb\u884c\u5b9e\u8df5\uff0c\u5b9e\u73b0\u7684\u6548\u679c\u90fd\u662f\u7ed8\u5236\u4e00\u4e2a\u5e26\u7eb9\u7406\u7684\u77e9\u5f62\u3002</p> <p>\u5982\u4e0b\uff1a</p> <p></p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#_4","title":"\u6570\u7ec4\u7f13\u51b2\u533a\u4f7f\u7528","text":"<p>\u5bf9\u4e8e Array Buffer  \u6570\u7ec4\u7f13\u51b2\u533a\uff0c\u5b83\u53ef\u4ee5\u5b58\u653e\u9876\u70b9\u76f8\u5173\u6570\u636e\uff0c\u6bd4\u5982\u9876\u70b9\u5750\u6807\u3001\u7eb9\u7406\u5750\u6807\u3001\u6cd5\u5411\u91cf\u7b49\uff0c\u6700\u540e\u91c7\u7528 glDrawArrays \u65b9\u6cd5\u6765\u7ed8\u5236\uff0c</p> <p>\u9996\u5148\uff0c\u5b9a\u4e49\u597d\u9876\u70b9\u5750\u6807\uff1a</p> <p><pre><code>        float vertices[] =\n                {\n                        -width / 2, height / 2, 0,\n                        -width / 2, -height / 2, 0,\n                        width / 2, height / 2, 0,\n\n                        -width / 2, -height / 2, 0,\n                        width / 2, -height / 2, 0,\n                        width / 2, height / 2, 0\n                };\n</code></pre> \u7136\u540e\u5b9a\u4e49\u597d\u7eb9\u7406\u5750\u6807\uff1a</p> <pre><code>        float textures[] =\n                {\n                        0f, 0f, 0f, 1f, 1f, 0f,\n                        0f, 1f, 1f, 1f, 1f, 0f,\n                };\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u521b\u5efa\u9876\u70b9\u5750\u6807\u548c\u7eb9\u7406\u5750\u6807\u7684\u7f13\u5b58\u6570\u636e\uff0c\u901a\u8fc7 <code>ByteBuffer</code> \u8fdb\u884c\u8f6c\u6362\u5f97\u5230 <code>FloatBuffer</code>\u3002</p> <p>\u5b8c\u6210\u51c6\u5907\u5de5\u4f5c\u63a5\u4e0b\u6765\u5c31\u662f\u521b\u5efa\u5bf9\u5e94\u7684\u9876\u70b9\u7f13\u51b2\u533a\u4e86\u3002</p> <pre><code>        // \u6307\u5b9a\u7f13\u5b58\u6570\u91cf\u5e76\u751f\u6210\n        int[] bufferIds = new int[3];\n        GLES20.glGenBuffers(3, bufferIds, 0);\n\n        // \u521b\u5efa\u9876\u70b9\u5750\u6807\u7f13\u51b2\uff0c\u7ed1\u5b9a\u5e76\u4f20\u9012\u6570\u636e\n        mVertexBufferId = bufferIds[0];\n        GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, mVertexBufferId);\n        GLES20.glBufferData(GLES20.GL_ARRAY_BUFFER, vertices.length * 4, mVertexBuffer, GLES20.GL_STATIC_DRAW);\n        // \u89e3\u9664\u7ed1\u5b9a\n        GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, 0);\n\n        // \u521b\u5efa\u7eb9\u7406\u5750\u6807\u7f13\u51b2\uff0c\u7ed1\u5b9a\u5e76\u4f20\u9012\u6570\u636e\n        mTextureBufferId = bufferIds[1];\n        GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, mTextureBufferId);\n        GLES20.glBufferData(GLES20.GL_ARRAY_BUFFER, textures.length * 4, mTextureBuffer, GLES20.GL_STATIC_DRAW);\n        // \u89e3\u9664\u7ed1\u5b9a\n        GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, 0);\n</code></pre> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u7ed8\u5236\u7684\u8fc7\u7a0b\uff1a</p> <pre><code>        // \u7ed1\u5b9a\u5230\u9876\u70b9\u5750\u6807\u6570\u636e\u7f13\u51b2\n        GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, mVertexBufferId);\n        // \u542f\u7528\u9876\u70b9\u5750\u6807\u6570\u636e\u6570\u7ec4\n        GLES20.glEnableVertexAttribArray(maPositionHandle);\n        // \u6307\u5b9a\u9876\u70b9\u4f4d\u7f6e\u6570\u636e\u4f7f\u7528\u5bf9\u5e94\u7f13\u51b2\n        GLES20.glVertexAttribPointer(maPositionHandle, 3, GLES20.GL_FLOAT, false, 3 * 4, 0);\n        GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, 0);\n\n        // \u7ed1\u5b9a\u5230\u7eb9\u7406\u5750\u6807\u6570\u636e\u7f13\u51b2\n        GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, mTextureBufferId);\n        // \u542f\u7528\u7eb9\u7406\u5750\u6807\u6570\u636e\u6570\u7ec4\n        GLES20.glEnableVertexAttribArray(maTexCoorHandle);\n        // \u6307\u5b9a\u7eb9\u7406\u4f4d\u7f6e\u6570\u636e\u4f7f\u7528\u5bf9\u5e94\u7f13\u51b2\n        GLES20.glVertexAttribPointer(maTexCoorHandle, 2, GLES20.GL_FLOAT, false, 2 * 4, 0);\n        GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, 0);\n        // \u6267\u884c\u7ed8\u5236\n        GLES20.glDrawArrays(GLES20.GL_TRIANGLES, 0, vCount);\n</code></pre> <p>\u5728\u7ed8\u5236\u65f6\u4f1a\u4f7f\u7528\u5230 <code>glVertexAttribPointer</code> \u51fd\u6570\uff0c\u8fd9\u91cc\u6709\u4e2a\u7ec6\u8282\u5dee\u522b\uff0c\u5b83\u548c\u4e4b\u524d\u4f7f\u7528\u65f6\u53c2\u6570\u4e0d\u4e00\u6837\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#_5","title":"\u5143\u7d20\u6570\u7ec4\u7f13\u51b2\u533a\u4f7f\u7528","text":"<p>\u4f7f\u7528 \u5143\u7d20\u6570\u7ec4\u7f13\u51b2\u533a Element Array Buffer \u5c31\u5f97\u91c7\u7528 glDrawElement \u7684\u65b9\u5f0f\u8fdb\u884c\u7ed8\u5236\uff0c\u5148\u8981\u66f4\u6539\u9876\u70b9\u5750\u6807\u6570\u636e\u548c\u7eb9\u7406\u5750\u6807\u6570\u636e\uff0c\u7136\u540e\u5b9a\u4e49\u9876\u70b9\u7d22\u5f15\u6570\u7ec4\uff0c\u7136\u540e\u4e3a\u7d22\u5f15\u6570\u7ec4\u751f\u6210\u5bf9\u5e94\u7684 \u5143\u7d20\u6570\u7ec4\u7f13\u51b2\u533a\u3002</p> <pre><code>        // \u7d22\u5f15\u6570\u7ec4\n        byte[] indices = {\n                1, 2, 3,\n                0, 1, 2,\n        };\n</code></pre> <p>\u4e3a\u7d22\u5f15\u6570\u7ec4\u751f\u6210\u5bf9\u5e94\u7684 \u5143\u7d20\u6570\u7ec4\u7f13\u51b2\u533a\u3002</p> <pre><code>     // \u7d22\u5f15\u7f13\u51b2\n        mIndicesBufferId = bufferIds[2];\n        GLES20.glBindBuffer(GLES20.GL_ELEMENT_ARRAY_BUFFER, mIndicesBufferId);\n        GLES20.glBufferData(GLES20.GL_ELEMENT_ARRAY_BUFFER, indices.length, mIndicesBuffer, GLES20.GL_STATIC_DRAW);\n        GLES20.glBindBuffer(GLES20.GL_ELEMENT_ARRAY_BUFFER, 0);\n</code></pre> <p>\u53e6\u5916\u5728\u7ed8\u5236\u65f6\uff0c\u4e5f\u8981\u7ed1\u5b9a\u5143\u7d20\u6570\u7ec4\u7f13\u51b2\u533a\u540e\u8fdb\u884c\u7ed8\u5236\uff1a</p> <pre><code> GLES20.glBindBuffer(GLES20.GL_ELEMENT_ARRAY_BUFFER, mIndicesBufferId);\n GLES20.glDrawElements(GLES20.GL_TRIANGLES, vCount, GLES20.GL_UNSIGNED_BYTE, 0);\n</code></pre>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#_6","title":"\u5c0f\u7ed3","text":"<p>\u5bf9\u4e8e\u535a\u5ba2\u7684\u4f8b\u5b50\uff0c\u4e00\u4e2a\u7eb9\u7406\u77e9\u5f62\u53ea\u6709\u56db\u4e2a\u9876\u70b9\uff0c\u4f53\u73b0\u4e0d\u51fa\u9876\u70b9\u6570\u7ec4\u7f13\u5b58\u7684\u4f18\u52bf\uff0c\u591a\u4f59\u5927\u91cf\u70b9\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u79cd\u4f18\u52bf\u8fd8\u662f\u633a\u660e\u663e\u7684\uff0c\u5c24\u5176\u662f\u5b58\u5728\u8981\u66f4\u6539\u9876\u70b9\u6570\u636e\u7684\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u4f7f\u7528 glBufferSubData \u65b9\u6cd5\u53bb\u66f4\u6539\uff0c\u800c\u4e0d\u662f\u5728\u91cd\u65b0\u4f20\u5165\u65b0\u7684\u9876\u70b9\u5750\u6807\u6570\u636e\u3002</p> <p>\u5173\u4e8e\u5177\u4f53\u7684\u4ee3\u7801\u5b9e\u73b0\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-vertex-buffer-object-usage/#_7","title":"\u53c2\u8003","text":"<ol> <li>\u300aOpenGL ES 3.x \u6e38\u620f\u5f00\u53d1\u300b</li> </ol>","tags":["OpenGL"]},{"location":"opengl/opengl-tutorial-view-matrix/","title":"OpenGL \u5b66\u4e60\u7cfb\u5217\u4e4b\u89c2\u5bdf\u77e9\u9635","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/0cWh3IF_7wa5PHoGsh8ZcQ</p> <p>\u5728 OpenGL \u6295\u5f71\u77e9\u9635 \u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u8bb2\u8ff0\u4e86 OpenGL \u5750\u6807\u7cfb\u7edf\u4e2d\u7684\u6295\u5f71\u77e9\u9635\uff0c\u6709\u4e24\u79cd\u7c7b\u578b\u7684\u6295\u5f71\u77e9\u9635\uff0c\u5206\u522b\u662f\u6b63\u4ea4\u6295\u5f71\u548c\u900f\u89c6\u6295\u5f71\u3002</p> <p>\u8fd9\u4e24\u79cd\u6295\u5f71\u5b9e\u8d28\u4e0a\u662f\u4e24\u79cd\u7c7b\u578b\u7684\u88c1\u526a\u7a7a\u95f4\uff0c\u5206\u522b\u521b\u5efa\u5bf9\u5e94\u89c6\u666f\u4f53\u5bf9\u7269\u4f53\u5750\u6807\u8fdb\u884c\u88c1\u526a\uff0c\u4f4d\u4e8e\u88c1\u526a\u7a7a\u95f4\u5185\u7684\u624d\u4f1a\u88ab\u6620\u5c04\u5230\u5c4f\u5e55\u4e0a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\uff08\u56fe\u7247\u6765\u6e90\uff1ahttps://glumpy.github.io/modern-gl.html\uff09</p> <p></p> <p>\u5f53\u5b9a\u4e49\u88c1\u526a\u7a7a\u95f4\u89c6\u666f\u4f53\u65f6\uff0c\u6211\u4eec\u90fd\u9700\u8981\u63d0\u4f9b\u8fd1\u5e73\u9762\u548c\u8fdc\u5e73\u9762\u7684\u8ddd\u79bb\uff0c\u8fd9\u91cc\u7684\u8fd1\u548c\u8fdc\u90fd\u662f\u6307\u76f8\u5bf9\u4e8e<code>\u89c6\u70b9</code>\u7684\uff0c\u89c6\u70b9\u4e5f\u5c31\u662f\u6211\u4eec\u8fd9\u7bc7\u6587\u7ae0\u8981\u8bb2\u5230\u7684\u6444\u50cf\u673a\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u56fe\u7247\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6295\u5f71\u77e9\u9635\u7684\u89c6\u666f\u4f53\u7684\u56db\u6761\u865a\u7ebf\u8fb9\u770b\u6210\u662f\u4ee5\u6444\u50cf\u673a\u4e3a\u8d77\u59cb\u70b9\u53d1\u51fa\u7684\u5c04\u7ebf\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5f53\u8d77\u59cb\u70b9\u4e5f\u5c31\u662f\u6444\u50cf\u673a\u4f4d\u7f6e\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u5b83\u6240\u53d1\u51fa\u7684\u5c04\u7ebf\u4e5f\u4f1a\u968f\u4e4b\u6539\u53d8\uff0c\u90a3\u4e48\u89c6\u666f\u4f53\u7684\u5f62\u72b6\u4e5f\u5c31\u6539\u53d8\u4e86\uff0c\u5728\u5176\u5185\u90e8\u6240\u89c2\u5bdf\u5230\u7684\u5185\u5bb9\u4e5f\u4f1a\u53d1\u751f\u53d8\u5316\u3002</p> <p>\u6bd4\u5982\uff0c\u5047\u8bbe\u6b64\u65f6\u6444\u50cf\u673a\u4f4d\u4e8e\u5f69\u8272\u5c0f\u7403\u7684\u4e0a\u9762\uff0c\u90a3\u4e48\u6574\u4e2a\u89c6\u666f\u4f53\u5c31\u662f\u5782\u76f4\u7acb\u8d77\u6765\u4e86\u7684\uff0c\u6240\u89c2\u5bdf\u5230\u7684\u5c0f\u7403\u4e5f\u662f\u671d\u4e0a\u7684\u90a3\u4e00\u9762\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u53ef\u4ee5\u770b\u5230\u76f8\u673a\u7684\u4f4d\u7f6e\u548c\u671d\u5411\uff0c\u51b3\u5b9a\u4e86\u89c6\u666f\u4f53\u5728\u4ec0\u4e48\u4f4d\u7f6e\u548c\u4ec0\u4e48\u671d\u5411\u5c55\u5f00\u3002</p> <p>\u5728 OpenGL \u5750\u6807\u7cfb\u7edf\u7684\u8f6c\u6362\u516c\u5f0f\u4e2d\u4e5f\u53ef\u4ee5\u5370\u8bc1\u8fd9\u4e00\u70b9\uff1a</p> $$ V_{clip}=M_{projection} \\cdot M_{view} \\cdot M_{model} \\cdot V_{local} $$ <p>\u5b83\u7684\u8ba1\u7b97\u987a\u5e8f\u662f\u5de6\u4e58\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u5148\u8fdb\u884c\u89c6\u56fe\u77e9\u9635\u7684\u8ba1\u7b97\uff0c\u7136\u540e\u518d\u8fdb\u884c\u6295\u5f71\u77e9\u9635\u7684\u8ba1\u7b97\uff0c\u8fd9\u6837\u4e00\u6765\u6211\u4eec\u5c31\u8981\u5148\u786e\u5b9a\u4e86\u76f8\u673a\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u518d\u6839\u636e\u76f8\u673a\u786e\u5b9a\u6295\u5f71\u77e9\u9635\u3002</p>","tags":["OpenGL","Camera"]},{"location":"opengl/opengl-tutorial-view-matrix/#_1","title":"\u786e\u5b9a\u6444\u50cf\u673a\u4f4d\u7f6e","text":"<p>\u5728\u8fd9\u91cc\uff0c\u786e\u5b9a\u76f8\u673a\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e0d\u4ec5\u4ec5\u662f\u5b9a\u4e49\u76f8\u673a\u5728\u4e09\u7ef4\u4e2d\u7684 \\((x,y,z)\\)\u5750\u6807\uff0c\u800c\u662f\u8981\u786e\u5b9a\u4e00\u4e2a\u4ee5\u76f8\u673a\u4f4d\u7f6e\u4e3a\u539f\u70b9\u7684\u5750\u6807\u7cfb\u3002</p> <p>\u5728\u4e0a\u9762\u4e5f\u63d0\u5230\uff0c\u6295\u5f71\u77e9\u9635\u6216\u8005\u8bf4\u89c6\u666f\u4f53\u7684\u4e00\u4e2a\u5c55\u5f00\uff0c\u662f\u4ee5\u76f8\u673a\u4f5c\u4e3a\u53c2\u8003\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u80af\u5b9a\u8fd8\u9700\u8981\u4e00\u4e2a\u6444\u50cf\u673a\u7684\u89c2\u5bdf\u65b9\u5411\uff0c\u8fd9\u4e2a\u65b9\u5411\u5c31\u662f\u89c6\u666f\u4f53\u5c55\u5f00\u7684\u65b9\u5411\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u7684\u5de6\u4e8c\u5185\u5bb9\u6240\u793a\uff0c\u6444\u50cf\u673a\u5728 Z \u8f74\u6b63\u65b9\u5411\u5411\u5750\u6807\u7cfb\u7684\u539f\u70b9\u8fdb\u884c\u89c2\u5bdf\uff0c\u5047\u8bbe\u6b64\u65f6\u6444\u50cf\u673a\u5750\u6807\u4e3a \\(A(-1,1,1)\\)\uff0c\u800c\u539f\u70b9\u4e3a \\(O(0,0,0)\\)\uff0c\u90a3\u4e48\u89c2\u5bdf\u65b9\u5411\u5c31\u662f\u4ece \\(A\\) \u70b9\u5411 \\(O\\) \u70b9\u3002\u800c\u65b9\u5411\u5411\u91cf\u5c31\u662f \\(A-O\\)\uff0c\u5c31\u662f\u5411\u91cf  $ \\overrightarrow {OA}(-1,1,1)$\uff0c\u5b83\u7684\u65b9\u5411\u4e5f\u5c31\u662f\u56fe\u4e8c\u4e2d\u7684\u84dd\u8272\u7bad\u5934\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 \u6444\u50cf\u673a\u7684\u65b9\u5411\u5411\u91cf\u548c\u5b83\u7684\u89c2\u5bdf\u65b9\u5411\u6b63\u597d\u662f\u76f8\u53cd\u7684\u3002</p> <p>\u4e00\u4e2a\u4e09\u7ef4\u7684\u7a7a\u95f4\u5750\u6807\u7cfb\u662f\u9700\u8981\u4e09\u4e2a\u4e92\u76f8\u5782\u76f4\u7684\u8f74\u7684\uff0c\u73b0\u5728\u5df2\u7ecf\u6709\u4e86\u65b9\u5411\u5411\u91cf\u8fd9\u4e00\u4e2a\u4e86\u3002\u8fd9\u65f6\u53ef\u4ee5\u501f\u52a9\u4e00\u4e2a\u8f85\u52a9\u5411\u91cf \u4e0a\u5411\u91cf  \\(\\overrightarrow{UP}\\)\uff0c\u628a\u4e0a\u5411\u91cf\u4e0e\u65b9\u5411\u5411\u91cf\u8fdb\u884c\u53c9\u4e58\uff0c$ \\overrightarrow {UP} \\cdot \\overrightarrow{OA}$\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5411\u91cf\uff0c\u540c\u65f6\u5782\u76f4\u4e8e\u4e0a\u5411\u91cf\u548c\u65b9\u5411\u5411\u91cf\uff0c\u5b83\u5c31\u662f\u53f3\u5411\u91cf  \\(\\overrightarrow{Right}\\) \uff0c\u5b83\u7684\u65b9\u5411\u6307\u5411 \\(X\\) \u8f74\u6b63\u65b9\u5411 \u3002\u8fd9\u91cc\u8981\u5c0f\u5fc3\u53c9\u4e58\u7684\u987a\u5e8f\uff0c\u5426\u5219\u5f97\u5230\u7684\u65b9\u5411\u5c31\u662f\u53cd\u7684\u4e86\u3002</p> <p>\u5982\u56fe\u4e09\u6240\u4ee5\uff0c\u7070\u8272\u7684\u5c31\u662f\u8f85\u52a9\u4e0a\u5411\u91cf \\(\\overrightarrow{UP}\\)\uff0c\u800c\u7ea2\u8272\u7bad\u5934\u6240\u6307\u65b9\u5411\u5c31\u662f \\(X\\) \u8f74\u6b63\u65b9\u5411\u3002</p> <p>\u518d\u5229\u7528\u53f3\u5411\u91cf\u548c\u65b9\u5411\u5411\u91cf\u7684\u53c9\u4e58\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u6307\u5411\u6444\u50cf\u673a \\(Y\\) \u8f74\u65b9\u5411\u7684\u5411\u91cf\uff0c\u5982\u6700\u53f3\u56fe\u7684\u7eff\u8272\u7bad\u5934\u6240\u793a\u3002</p> <p>\u8fd9\u6837\u5c31\u6784\u9020\u4e86\u4e09\u4e2a\u8f74\u4e92\u76f8\u5782\u76f4\u7684\u5750\u6807\u7cfb\uff0c\u5b83\u5c31\u662f\u6444\u50cf\u673a\u7684\u5750\u6807\u7cfb\u3002</p>","tags":["OpenGL","Camera"]},{"location":"opengl/opengl-tutorial-view-matrix/#matrixlookat","title":"Matrix.lookAt \u51fd\u6570","text":"<p>\u4ece\u4e0a\u9762\u7684\u5185\u5bb9\u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u8981\u77e5\u9053\u4e86\u76f8\u673a\u5750\u6807\u70b9\uff0c\u4ee5\u53ca\u89c2\u5bdf\u7684\u70b9\uff0c\u8fd8\u6709\u8f85\u52a9\u7684\u4e0a\u5411\u91cf\uff0c\u5c31\u53ef\u4ee5\u786e\u5b9a\u6444\u50cf\u673a\u7684\u5750\u6807\u7cfb\u4e86\u3002</p> <p>\u786e\u5b9a\u6444\u50cf\u673a\u4e4b\u540e\uff0c\u5c31\u662f\u7528\u5b83\u6765\u751f\u6210\u6211\u4eec\u7684\u89c2\u5bdf\u77e9\u9635\uff0c\u628a\u89c2\u5bdf\u77e9\u9635\u7528\u4e8e\u5728 OpenGL \u6e32\u67d3\u7ba1\u7ebf\u4e2d\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u548c\u6295\u5f71\u77e9\u9635\u4e00\u6837\uff0cAndroid \u4e5f\u63d0\u4f9b\u4e86\u5bf9\u5e94\u51fd\u6570 <code>Matrix.setLookAtM</code> \u6765\u751f\u6210 OpenGL \u5750\u6807\u8f6c\u6362\u4e2d\u7684\u89c2\u5bdf\u77e9\u9635\u3002</p> <pre><code>     /**\n     * Defines a viewing transformation in terms of an eye point, a center of\n     * view, and an up vector.\n     *\n     * @param rm returns the result\n     * @param rmOffset index into rm where the result matrix starts\n     * @param eyeX eye point X\n     * @param eyeY eye point Y\n     * @param eyeZ eye point Z\n     * @param centerX center of view X\n     * @param centerY center of view Y\n     * @param centerZ center of view Z\n     * @param upX up vector X\n     * @param upY up vector Y\n     * @param upZ up vector Z\n     */\n    public static void setLookAtM(float[] rm, int rmOffset,\n            float eyeX, float eyeY, float eyeZ,\n            float centerX, float centerY, float centerZ, float upX, float upY,\n            float upZ)\n</code></pre> <p>\u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u5c31\u662f\u8981\u4f20\u5165\u7684\u89c2\u5bdf\u77e9\u9635\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u504f\u79fb\u91cf\uff0c\u8fd9\u4e2a\u4e00\u822c\u662f  0 \uff0c\u4e4b\u540e\u5c31\u662f\u76f8\u673a\u4f4d\u7f6e\u3001\u89c2\u5bdf\u70b9\u3001\u8f85\u52a9\u4e0a\u5411\u91cf\u3002</p>","tags":["OpenGL","Camera"]},{"location":"opengl/opengl-tutorial-view-matrix/#_2","title":"\u79fb\u52a8\u76f8\u673a\u89c2\u5bdf\u5185\u5bb9","text":"<p>\u63a5\u4e0b\u6765\u901a\u8fc7\u79fb\u52a8\u6444\u50cf\u673a\u6765\u89c2\u5bdf\u7269\u4f53\uff0c\u4ece\u800c\u52a0\u6df1\u5bf9\u6444\u50cf\u673a\u7684\u7406\u89e3\u3002</p>","tags":["OpenGL","Camera"]},{"location":"opengl/opengl-tutorial-view-matrix/#_3","title":"\u65cb\u8f6c\u79fb\u52a8\u76f8\u673a","text":"<p>\u7528 OpenGL \u6765\u7ed8\u5236\u4e00\u4e2a\u7acb\u65b9\u4f53\uff0c\u5e76\u901a\u8fc7\u65cb\u8f6c\u79fb\u52a8\u6444\u50cf\u673a\uff0c\u8ba9\u6444\u50cf\u673a\u7ed5 \\(Y\\) \u8f74\u505a\u5706\u5f62\u65cb\u8f6c\uff0c\u4ece\u800c\u53ef\u4ee5\u4ece\u4e0d\u540c\u65b9\u5411\u6765\u89c2\u5bdf\u7269\u4f53\uff0c\u6548\u679c\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u8ba9\u7acb\u65b9\u4f53\u7a0d\u5fae\u5411 \\(Z\\) \u8f74\u505a\u4e00\u70b9\u503e\u659c\uff0c\u8fd9\u6837\u6700\u591a\u5c31\u53ef\u4ee5\u89c2\u5bdf\u5230\u4e09\u4e2a\u9762\u4e86\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u793a\u4f8b\uff1a</p> <p><pre><code>    var num = 0\n    var RotateNum  = 360 // \u7ed5 Y \u8f74\u505a\u5706\u5f62\u65cb\u8f6c\uff0c\u628a\u5706\u5206\u6210 360 \u4efd\n    val radian = (2 * Math.PI / RotateNum).toFloat() // \u6bcf\u4e00\u4efd\u5bf9\u5e94\u7684\u5f27\u5ea6\n    override fun onSurfaceChanged(gl: GL10?, width: Int, height: Int) {\n        //... \u7701\u7565\u4ee3\u7801\n        // \u901a\u8fc7 RxJava \u7684 interval \u64cd\u4f5c\u7b26\uff0c\u6bcf\u9694 30 \u6beb\u79d2\uff0c\u79fb\u52a8\u76f8\u673a\u89c2\u5bdf\u89d2\u5ea6\n        Observable.interval(30, TimeUnit.MILLISECONDS)\n                .subscribe {\n                    eyeX = eyeDistance * Math.sin((radian * num).toDouble()).toFloat()\n                    eyeZ = eyeDistance * Math.cos((radian * num).toDouble()).toFloat()\n                    num++\n                    if (num &gt; 360) {\n                        num = 0\n                    }\n                }\n        // \u8bbe\u7f6e\u89c2\u5bdf\u77e9\u9635\n        MatrixState.setCamera(eyeX, eyeY, eyeZ, lookX, lookY, lookZ, upX, upY, upZ)     \n        // \u8ba9\u7269\u4f53\u7a0d\u5fae\u5411 Z \u8f74\u8d1f\u65b9\u5411\u503e\u659c\u4e00\u5b9a\u89d2\u5ea6\n        MatrixState.rotate(-30f, 0f, 0f, 1f)\n    }\n</code></pre> \u5728 GLSurfaceView \u7684 onSurfaceChanged \u65b9\u6cd5\u91cc\u9762\u8bbe\u5b9a\u89c2\u5bdf\u77e9\u9635\uff0c\u5e76\u901a\u8fc7 RxJava \u7684 interval \u64cd\u4f5c\u7b26\u6bcf\u9694 30 \u6beb\u79d2\u6539\u53d8\u76f8\u673a\u4f4d\u7f6e\u7684 \\(X\\) \u5750\u6807\u548c \\(Z\\) \u5750\u6807\uff0c\u8ba9\u6444\u50cf\u673a\u5728 \\(XOY\\) \u5e73\u9762\u4e0a\u7ed5 \\(Y\\) \u8f74\u505a\u5706\u5468\u8fd0\u52a8\u3002</p> <p>\u5728 onDrawFrame \u65b9\u6cd5\u91cc\uff0c\u6bcf\u5f53\u5750\u6807\u6539\u53d8\u4e86\uff0c\u5c31\u6539\u53d8\u76f8\u673a\u7684\u4f4d\u7f6e\u3002</p> <pre><code>    override fun onDrawFrame(gl: GL10?) {\n        //... \u7701\u7565\u4ee3\u7801\n        MatrixState.setCamera(eyeX, eyeY, eyeZ, lookX, lookY, lookZ, upX, upY, upZ)\n        GLES20.glUniformMatrix4fv(uViewMatrixAttr, 1, false, MatrixState.getVMatrix(), 0)\n        //... \u7701\u7565\u4ee3\u7801\n    }\n</code></pre> <p>\u7531\u4e8e\u662f\u505a\u5706\u5468\u8fd0\u52a8\uff0c\u5706\u7684\u534a\u5f84\u662f\u6ca1\u6709\u53d8\u7684\uff0c\u6240\u4ee5\u770b\u5230\u7684\u7269\u4f53\u5927\u5c0f\u662f\u4e0d\u53d8\u7684\uff0c\u53ea\u662f\u770b\u5230\u7684\u5185\u5bb9\u4e0d\u540c\u3002</p>","tags":["OpenGL","Camera"]},{"location":"opengl/opengl-tutorial-view-matrix/#_4","title":"\u524d\u540e\u79fb\u52a8\u76f8\u673a","text":"<p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u524d\u540e\u79fb\u52a8\u76f8\u673a\uff0c\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u4eba\u8d70\u8fd1\u6216\u8005\u79bb\u5f00\u7269\u4f53\uff0c\u611f\u89c9\u5230\u7269\u4f53\u5927\u5c0f\u53d1\u751f\u53d8\u5316\uff08\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\uff09\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\uff0c\u7269\u4f53\u8fd8\u662f\u90a3\u4e2a\u7269\u4f53\uff0c\u4f46\u662f\u4ece\u4e0d\u540c\u7684\u8fdc\u8fd1\u6765\u89c2\u5bdf\uff0c\u6240\u770b\u5230\u7684\u5927\u5c0f\u5c31\u4e0d\u4e00\u6837\u4e86\u3002</p> <pre><code>    override fun onSurfaceChanged(gl: GL10?, width: Int, height: Int) {\n        super.onSurfaceChanged(gl, width, height)\n        var isPlus = true\n        var distance = eyeZ\n        Observable.interval(100, TimeUnit.MILLISECONDS)\n                .subscribe {\n                    distance = if (isPlus) distance + 0.1f else distance - 0.1f\n                    if (distance &lt; 2.0f) {\n                        isPlus = true\n                    }\n                    if (distance &gt; 5.0f) {\n                        isPlus = false\n                    }\n                    eyeZ = distance\n                    updateCamera()\n                }\n        // \u5c06\u7269\u4f53\u8c03\u6574\u4e00\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\u4e09\u4e2a\u9762\n        MatrixState.rotate(-45f, 0f, 1f, 0f)\n        MatrixState.rotate(45f, 1f, 0f, 0f)\n    }\n</code></pre> <p>\u5982\u4e0a\u4ee3\u7801\u6240\u793a\uff0c\u6211\u4eec\u6539\u53d8\u4e86\u76f8\u673a\u7684 \\(Z\\) \u8f74\u5750\u6807\uff0c\u8ba9\u5b83\u5728 \\([2.0,5.0]\\) \u4e4b\u95f4\u6765\u56de\u79fb\u52a8\uff0c\u8fd9\u6837\u5c31\u8fbe\u5230\u4e86\u524d\u540e\u79fb\u52a8\u76f8\u673a\u7684\u6548\u679c\u3002</p> <p>\u6700\u540e\uff0c\u8fd8\u53ef\u4ee5\u628a\u4e24\u79cd\u65cb\u8f6c\u7ed3\u5408\u8d77\u6765\uff0c\u5373\u505a\u5706\u5468\u8fd0\u52a8\u53c8\u524d\u540e\u79fb\u52a8\u76f8\u673a\uff0c\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p>","tags":["OpenGL","Camera"]},{"location":"opengl/opengl-tutorial-view-matrix/#_5","title":"\u5c0f\u7ed3","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u5c31\u5e94\u8be5\u5bf9 OpenGL \u4e2d\u7684\u76f8\u673a\u6709\u4e00\u4e2a\u66f4\u52a0\u6e05\u6670\u7684\u8ba4\u8bc6\u4e86\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684 Github \u9879\u76ee\uff1a</p> <p>https://github.com/glumes/AndroidOpenGLTutorial</p>","tags":["OpenGL","Camera"]},{"location":"opengl/run-learnopengl-code-on-xcode/","title":"LearnOpenGL \u6e90\u7801\u5728 MAC \u4e0a\u7684\u7f16\u8bd1\u4e0e\u8c03\u8bd5","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/Ah8bK4dELT-LDjwSk9dHiQ</p> <p>\u5b66\u4e60 OpenGL \uff0c\u76f8\u4fe1\u80af\u5b9a\u6709\u4e0d\u5c11\u4eba\u770b\u8fc7\u8fd9\u4e2a\u7f51\u7ad9\uff1a</p> <p>https://learnopengl.com/</p> <p></p> <p>\u8fd9\u662f\u5b83\u7684\u82f1\u6587\u539f\u7248\u7f51\u7ad9\uff0c\u540e\u6765\u53c8\u6709\u4e86\u4e0d\u540c\u8bed\u8a00\u7684\u7ffb\u8bd1\u7248\u672c\uff0c\u5bf9\u5e94\u4e2d\u6587\u5c31\u662f\uff1a</p> <p>https://learnopengl-cn.github.io/</p> <p></p> <p>\u8fd9\u4e24\u4e2a\u7f51\u7ad9\u5bf9\u4e8e\u5b66\u4e60 OpenGL \u5e2e\u52a9\u975e\u5e38\u5927\uff0c\u65e2\u53ef\u4ee5\u7528\u4f5c\u5165\u95e8\u7684\u6559\u6750\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5de5\u5177\u4e66\uff0c\u540e\u7eed\u8fdb\u884c\u67e5\u6f0f\u8865\u7f3a\u3002</p> <p>\u5e76\u4e14\u5b83\u7684\u5185\u5bb9\u5f88\u5168\u9762\uff0c\u9664\u4e86 OpenGL \u57fa\u7840\u77e5\u8bc6\u3001\u5750\u6807\u7cfb\u7edf\u3001\u7eb9\u7406\u3001Shader\u3001\u6a21\u578b\u52a0\u8f7d\u7b49\uff0c\u8fd8\u6709\u9ad8\u7ea7\u5149\u7167\u3001PBR \u7b49\u6e32\u67d3\u6280\u5de7\uff0c\u8fd9\u4e9b\u5728\u6e32\u67d3\u5f15\u64ce\u7684\u5f00\u53d1\u4e2d\u90fd\u662f\u4f1a\u7528\u5230\u7684\uff0c\u540e\u9762\u4f1a\u7ee7\u7eed\u548c\u5927\u5bb6\u5206\u4eab\u3002</p> <p>\u672c\u6587\u4e3b\u8981\u662f\u8bb2\u89e3\u5982\u4f55\u8fd0\u884c LearnOpenGL \u6587\u7ae0\u4e2d\u7684\u793a\u4f8b\u4ee3\u7801\uff0c\u5728 XCode \u4e0a\u8fdb\u884c\u7f16\u8bd1\u548c\u8c03\u8bd5\uff0c\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5728\u7f51\u7ad9\u4e0a\u67d0\u4e00\u7ae0\u8282\u7684\u5185\u5bb9\uff0c\u5c31\u5bf9\u5e94\u4e8e XCode \u5de5\u7a0b\u67d0\u4e00\u5c0f\u9879\u7684\u5177\u4f53\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u8981\u8fd0\u884c\u7684\u7ae0\u8282\u4ee3\u7801\uff0c\u5728 Mac \u770b\u5230\u6700\u7ec8\u6548\u679c\u3002</p> <p></p> <p>\u53e6\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5728 XCode \u4e0a\u4fee\u6539\u76f8\u5173\u4ee3\u7801\uff0c\u8c03\u6574\u67d0\u4e9b\u53c2\u6570\uff0c\u9a8c\u8bc1\u81ea\u5df1\u7684\u60f3\u6cd5\u548c\u5b9e\u9a8c\u7ed3\u679c\u3002</p> <p>\u8fd9\u4e00\u70b9\u5f88\u91cd\u8981\uff0c\u5bf9\u4e8e\u521d\u5b66\u8005\u6765\u8bf4\u5c31\u662f\u8981\u4e0d\u65ad\u5730\u8bd5\u9519\uff0c\u5728\u5931\u8d25\u4e2d\u6210\u957f\u3002</p> <p>\u5728\u5f00\u59cb LearnOpenGL \u7f51\u7ad9\u7684\u4ee3\u7801\u8bb2\u89e3\u4e4b\u524d\uff0c\u5148\u4ecb\u7ecd\u4e00\u4e0b\u4ed6\u7684\u4e3b\u4eba\u3002</p> <p></p> <p>\u4e0d\u5f97\u4e0d\u8bf4\uff0c\u8fd9\u662f\u4f4d\u5927\u4f6c\uff0c\u6709\u5174\u8da3\u7684\u540c\u5b66\u90fd\u53ef\u4ee5\u53bb Follow \u4e00\u4e0b\u3002</p> <p>\u4ed6\u7684\u4e2a\u4eba\u4e3b\u9875\u662f\uff1a</p> <p>https://joeydevries.com</p> <p>\u4ece\u4e3b\u9875\u4e0a\u53ef\u4ee5\u770b\u5230\u5927\u4f6c\u5728\u56fe\u5f62\u5b66\u548c\u6e38\u620f\u5f00\u53d1\u4e0a\u9020\u8be3\u9887\u6df1\uff0c\u505a\u4e86\u4e0d\u5c11\u6709\u610f\u601d\u7684\u4e1c\u897f\u3002</p> <ul> <li>\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u6e32\u67d3\u5f15\u64ce\uff0c\u91c7\u7528 C++ \u5f00\u53d1\uff0c\u652f\u6301\u4e86\u4e0d\u5c11\u7279\u6027\uff0c\u5728 LearnOpenGL \u7f51\u7ad9\u4e0a\u90fd\u53ef\u4ee5\u770b\u5230\u3002</li> </ul> <p>https://github.com/JoeyDeVries/Cell</p> <p>\u8fd9\u53ef\u4ee5\u5f53\u505a\u662f\u5b66\u4e60 OpenGL \u4e4b\u540e\u5de9\u56fa\u63d0\u9ad8\u7684\u4e00\u4e2a\u5927\u4f5c\u4e1a\u4e86\u3002</p> <ul> <li>\u53e6\u5916\uff0c\u8fd8\u505a\u4e86\u4e00\u4e2a Vulkan \u7684\u6559\u5b66\u7f51\u7ad9\uff0c\u867d\u8bf4\u76ee\u524d\u8fd8\u6ca1\u6709\u5b8c\u6210\uff0c\u4f46\u4ecd\u7136\u503c\u5f97\u671f\u5f85\u3002</li> </ul> <p>https://learnvulkan.com/</p> <ul> <li>\u5f53\u7136\u4e86\uff0c\u4f60\u4e5f\u53ef\u4ee5\u770b\u6211\u7684\u7f51\u7ad9\uff0c\u6216\u8bb8\u5bf9\u4f60\u6709\u4e00\u4e9b\u5e2e\u52a9</li> </ul> <p>https://glumes.com/</p> <p>\u8a00\u5f52\u6b63\u4f20\uff0c\u8bb2\u56de\u4ee3\u7801\u7684\u7f16\u8bd1\u90e8\u5206\u3002</p> <p>LearnOpenGL \u7f51\u7ad9\u7684\u793a\u4f8b\u4ee3\u7801\u5730\u5740\u5982\u4e0b\uff0cclone \u8fd9\u4e2a\u9879\u76ee\u5230\u4f60\u7684\u7535\u8111\u4e0a\u3002</p> <p>https://github.com/JoeyDeVries/LearnOpenGL</p> <p>\u5728\u8fd9\u4e2a\u9879\u76ee\u7684 <code>README.md</code> \u4e0a\u5df2\u7ecf\u6709\u8bb2\u5982\u4f55\u5728 MAC \u5e73\u53f0\u8fdb\u884c\u7f16\u8bd1\u4e86\u3002</p> <pre><code>brew install cmake assimp glm glfw\nmkdir build\ncd build\ncmake ../.\nmake -j8\n</code></pre> <p>\u4f46\u662f\u8fd9\u4e2a\u7f16\u8bd1\u7ed3\u679c\u5e76\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\uff0c\u56e0\u4e3a\u5b83\u7f16\u8bd1\u51fa\u6765\u7684\u90fd\u662f\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p></p> <p>\u867d\u8bf4\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>./xxx</code> \u7684\u65b9\u5f0f\u6765\u8fd0\u884c\u8fd9\u4e9b\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4f46\u603b\u4e0d\u80fd\u6bcf\u6539\u4e00\u70b9\u4ee3\u7801\u5c31\u5168\u90fd\u7f16\u8bd1\u4e00\u6b21\u5427\u3002</p> <p>\u7406\u60f3\u7684\u65b9\u5f0f\u5c31\u8981\u901a\u8fc7 IDE\uff08\u96c6\u6210\u5f00\u53d1\u73af\u5883\uff09 \u6765\u7f16\u8bd1\u8fd0\u884c\uff0c\u5e76\u4e14\u5728 IDE \u4e0a\u4fee\u6539\u4ee3\u7801\uff0c\u770b\u5230\u7ed3\u679c\u3002</p> <p>XCode \u5728\u8fd9\u91cc\u5c31\u5145\u5f53\u4e86 IDE \u7684\u89d2\u8272\u3002</p> <p>\u4e0b\u9762\u7ed9\u51fa\u65b0\u7684\u7f16\u8bd1\u4ee3\u7801\uff1a</p> <pre><code>brew install cmake assimp glm glfw\nmkdir build\ncd build\ncmake -G \"Xcode\" ..\n</code></pre> <p>\u6709\u53d8\u5316\u7684\u5c31\u662f\u6700\u540e\u4e00\u884c\u4e86\uff0c\u6b64\u884c\u4ee3\u7801\u4f1a\u5728 build \u76ee\u5f55\u4e0b\u751f\u6210 XCode \u5de5\u7a0b\u3002</p> <p></p> <p>\u53cc\u51fb <code>LearnOpenGL.xcodeproj</code> \u5c31\u53ef\u4ee5\u6253\u5f00\u6574\u4e2a\u5de5\u7a0b\u5566\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u81ea\u7531\u53d1\u6325\u65f6\u95f4\uff0c\u4f60\u53ef\u4ee5\u5728\u6e90\u4ee3\u7801\u57fa\u7840\u4e0a\u8fdb\u884c\u4efb\u4f55\u4fee\u6539\uff0c\u5bf9\u7167\u7740 LearnOpenGL \u7f51\u7ad9\u4e0a\u7684\u8bb2\u89e3\uff0c\u4e00\u6b65\u4e00\u6b65\u5730\u53bb\u8c03\u8bd5\u9a8c\u8bc1\uff0c\u79ef\u7d2f\u7ecf\u9a8c\uff0c\u5728\u6210\u4e3a\u5927\u4f6c\u7684\u8def\u4e0a\u8d8a\u8d70\u8d8a\u8fdc<sub>~</sub>~</p> <p>\u795d\u73a9\u5f97\u6109\u5feb \ud83d\ude00\ud83d\ude00\ud83d\ude00</p>","tags":["opengl"]},{"location":"opengl/shader-tool-kodelife-introduce/","title":"KodeLife | Shader \u5b9e\u65f6\u7f16\u8f91\u9884\u89c8\u7684\u5f3a\u5927\u5de5\u5177\u4f7f\u7528\u5b9e\u8df5","text":"<p>\u907f\u514d\u56fe\u7247\u4e22\u5931\uff0c\u5efa\u8bae\u9605\u8bfb\u5fae\u4fe1\u539f\u6587\uff1a</p> <p>https://mp.weixin.qq.com/s/6ZMP6Tc_MqggjAXS_GjV2Q</p> <p>\u7ecf\u5e38\u6709\u670b\u53cb\u5728\u7fa4\u91cc\u9762\u95ee\u60f3\u5b66\u4e60 Shader \u6709\u4ec0\u4e48\u5de5\u5177\u53ef\u4ee5\u63a8\u8350\uff1f</p> <p>\u4eca\u5929\u5b83\u6765\u4e86<sub>~</sub></p> <p>\u63a8\u8350\u4e00\u6b3e\u5f3a\u5927\u7684 Shader \u5b9e\u65f6\u7f16\u8f91\u9884\u89c8\u7684\u5de5\u5177 \u2014\u2014 <code>KodeLife</code> \u3002</p> <p>\u5bf9\uff0c\u5b83\u7684\u540d\u5b57\u5c31\u53eb\u505a <code>KodeLife</code> \uff0c\u53ef\u522b\u770b\u6210 <code>KobeLife</code> \u4e86\uff0c\u4e00\u4e2a\u5b57\u6bcd\u4e4b\u5dee\u5b8c\u5168\u5c31\u662f\u4e24\u4e2a\u6982\u5ff5\u3002</p> <p><code>KodeLife</code> \u7684\u5b98\u7f51\u5730\u5740\u5982\u4e0b\uff1a</p> <p>https://hexler.net/products/kodelife</p> <p>\u8d34\u4e00\u5f20\u4e3b\u9875\u5c01\u9762\u56fe\uff1a</p> <p></p> <p>\u6709\u9700\u8981\u7684\u540c\u5b66\u53ef\u4ee5\u53bb\u5b98\u7f51\u4e0b\u8f7d\u5b89\u88c5\uff0c\u5b83\u662f\u9700\u8981\u8d2d\u4e70 License \u7684\uff0c\u4e0d\u8fc7\u53ef\u4ee5\u514d\u8d39\u4f7f\u7528\u4e24\u4e2a\u6708\u3002</p>","tags":["OpenGL"]},{"location":"opengl/shader-tool-kodelife-introduce/#kodelife","title":"KodeLife \u7684\u7f16\u8f91\u529f\u80fd","text":"<p>\u9996\u6b21\u6253\u5f00 KodeLife \u4f1a\u52a0\u8f7d\u5e76\u6f14\u793a\u9ed8\u8ba4\u7684 Shader \u4ee3\u7801\u6548\u679c\u3002</p> <p></p> <p>\u7f16\u8f91\u533a\u5c31\u662f\u6211\u4eec\u5199 Shader \u4ee3\u7801\u7684\u5730\u65b9\uff0c\u80cc\u540e\u7684\u753b\u9762\u5c31\u662f\u5b9e\u65f6\u9884\u89c8\u7684\u6548\u679c\u3002\u8fd9\u753b\u9762\u6548\u679c\u662f\u4f1a\u968f\u7740\u65f6\u95f4\u4e0d\u65ad\u6539\u53d8\u7684\uff0c\u8fd9\u91cc\u53ea\u662f\u9759\u6001\u56fe\u770b\u4e0d\u5230\u800c\u5df2\u3002</p> <p>\u9996\u6b21\u6253\u5f00\u53ef\u80fd\u4f1a\u88ab\u8fd9\u4e2a\u6548\u679c\u7ed9\u5413\u552c\u5230\uff0c\u6bd5\u7adf\u8fd9\u753b\u9762\u4e94\u989c\u516d\u8272\u800c\u4e14\u8fd8\u95ea\u6765\u95ea\u53bb\uff0c\u5176\u5b9e\u5f88\u591a\u4e1c\u897f\u90fd\u53ef\u4ee5\u53bb\u6389\u7684\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u4f1a\u66f4\u5bb9\u6613\u4e0a\u624b\u4e00\u4e9b\u3002</p> <p>\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u770b\u5230\u8fd9\u4e2d\u95f4\u6253\u94a9\u7684\u4e09\u4e2a\u9009\u9879\u4e86\u561b\uff0c\u5b83\u4eec\u5206\u522b\u662f OpenGL \u6e32\u67d3\u4e0d\u540c\u9636\u6bb5\u5bf9\u5e94\u7684\u7740\u8272\u5668\uff0c\u7531\u4e8e\u6211\u4eec\u90fd\u662f\u7528 OpenGL ES \uff0c\u5b83\u662f OpenGL \u7684\u5b50\u96c6\uff0c\u4e00\u4e9b\u529f\u80fd\u90fd\u88ab\u79fb\u9664\u4e86\uff0c\u6240\u4ee5\u4e0b\u9762\u8fd9\u4e9b Shader \u90fd\u662f\u7528\u4e0d\u5230\u7684\u3002</p> <p>\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u5b83\u4eec\u7684\u540d\u5b57\uff1a</p> <ul> <li> <p>Tess Control</p> <ul> <li>\u5168\u540d\uff1aTessellation Control Shader</li> <li>\u4e2d\u6587\u540d\uff1a\u66f2\u9762\u7ec6\u5206\u7740\u8272\u5668</li> </ul> </li> <li> <p>Tess Eval</p> <ul> <li>\u5168\u540d\uff1aTessellation Control Shader</li> <li>\u4e2d\u6587\u540d\uff1a\u7ec6\u5206\u8ba1\u7b97\u7740\u8272\u5668</li> </ul> </li> <li> <p>Geometry</p> <ul> <li>\u5168\u540d\uff1aGeometry Shader</li> <li>\u4e2d\u6587\u540d\uff1a\u51e0\u4f55\u7740\u8272\u5668</li> </ul> </li> </ul> <p>\u629b\u5f00\u8fd9\u4e09\u4e2a\u4e0d\u770b\uff0c\u90a3\u4e48\u5269\u4e0b\u7684\u6807\u7b7e\u9875\u5c31\u662f <code>Vertex</code> \u548c <code>Fragment</code> \uff0c\u5206\u522b\u662f\u9876\u70b9\u7740\u8272\u5668\u548c\u7247\u6bb5\u7740\u8272\u5668\uff0c\u8fd9\u5e94\u8be5\u5f88\u719f\u6089\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/shader-tool-kodelife-introduce/#kodelife_1","title":"KodeLife \u4f7f\u7528\u5b9e\u8df5","text":"<p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8981\u65b0\u5efa\u4e00\u4e2a Shader \u8fdb\u884c\u7f16\u5199\u3002</p> <p></p> <p>\u5728 <code>File</code> \u91cc\u9762\u6709\u4e24\u79cd <code>New</code> \u65b0\u5efa\u6587\u4ef6\u7684\u7c7b\u578b\u3002</p> <p>\u5176\u4e2d\u7b2c\u4e8c\u4e2a <code>New From Template</code> \u5c31\u4f1a\u6309\u7167 <code>Shadertoy</code> \u6216\u8005 <code>The Book of Shaders</code> \u7684\u793a\u4f8b\u6765\u52a0\u8f7d Shader \u6a21\u677f\u5de5\u7a0b\u3002</p> <p>\u6e29\u99a8\u63d0\u793a:</p> <p>Shadertoy \u662f\u975e\u5e38\u6709\u540d\u7684 Shader \u5b66\u4e60\u7f51\u7ad9\uff0c\u4e0a\u9762\u6709\u7740\u7eda\u4e3d\u7684 Shader \u6548\u679c\uff0c\u5e76\u4e14\u6709\u6e90\u7801\u4f9b\u5b66\u4e60\uff0c\u5c31\u662f\u7f51\u7ad9\u6253\u5f00\u901f\u5ea6\u592a\u6162\u4e86\u3002</p> <p>The Book of Shaders \u662f\u4e00\u672c\u975e\u5e38\u6709\u540d\u7684 Shader \u5165\u95e8\u5b66\u4e60\u4e66\u7c4d\uff0c\u8bb2\u89e3\u7684\u793a\u4f8b\u7b80\u5355\u6613\u5b66\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u6309\u7167 <code>The Book of Shaders</code> \u63d0\u4f9b\u7684\u6a21\u677f\u65b0\u5efa\u4e00\u4e2a\u5de5\u7a0b\u6765\u7f16\u5199\u4ee3\u7801\u3002</p> <p>\u4e0b\u9762\u662f\u5de5\u7a0b\u5efa\u597d\u540e\u5bf9\u5e94\u7684\u4ee3\u7801\u548c\u6548\u679c\u3002</p> <p></p> <p>\u5b83\u81ea\u5e26\u4e86\u4e09\u4e2a <code>unifrom</code> \u53d8\u91cf\uff1a</p> <ul> <li>u_resolution<ul> <li>\u56fe\u50cf\u7684\u5206\u8fa8\u7387</li> </ul> </li> <li>u_mouse<ul> <li>\u9f20\u6807\u70b9\u7684\u4f4d\u7f6e</li> </ul> </li> <li>u_time<ul> <li>\u65f6\u95f4</li> </ul> </li> </ul> <p>\u53ef\u4ee5\u5728 Shader \u53bb\u5229\u7528\u8fd9\u4e2a\u4e09\u4e2a\u53d8\u91cf\uff0c\u5b83\u4eec\u7684\u8f93\u5165\u503c\u662f\u7531 KodeLife \u6765\u4fdd\u8bc1\u7684\uff0c\u5728\u53f3\u4fa7\u53ef\u4ee5\u67e5\u770b\u5e76\u4fee\u6539\u8fd9\u53d8\u91cf\u7684\u5177\u4f53\u503c\u3002</p> <p></p> <ul> <li> <p>\u6570\u5b57 0 \u533a\u57df:</p> <ul> <li>Shader \u6548\u679c\u7684\u9884\u89c8\u533a\u57df</li> </ul> </li> <li> <p>\u6570\u5b57 1 \u533a\u57df\uff1a</p> <ul> <li>\u5f00\u5173\u63a7\u5236\u662f\u5426\u4f7f\u7528\u4e0b\u9762\u7684\u5c5e\u6027\u5185\u5bb9</li> <li>\u67e5\u770b\u5f53\u524d\u7684\u5c5e\u6027\uff0c\u6bd4\u5982\u67e5\u770b\u5e76\u7f16\u8f91\u56fe\u50cf\u5206\u8fa8\u7387\u7684</li> <li>\u6307\u5b9a Clear Color \u65f6\u7684\u989c\u8272</li> </ul> </li> <li> <p>\u6570\u5b57 2 \u533a\u57df\uff1a</p> <ul> <li>\u65f6\u95f4\u53d8\u91cf\uff0c\u53ef\u4ee5\u5728\u91cc\u9762\u63a7\u5236\u65f6\u95f4\u7684\u5f00\u59cb\u548c\u505c\u6b62</li> <li>\u53ef\u4ee5\u8c03\u6574\u65f6\u95f4\u53d8\u5316\u7684\u901f</li> <li>\u53ef\u4ee5\u8c03\u6574\u65f6\u95f4\u53d8\u5316\u7684\u8d77\u59cb\u548c\u7ed3\u675f\u503c\uff0c\u5e76\u5728\u8be5\u533a\u57df\u5185\u5faa\u73af</li> </ul> </li> <li> <p>\u6570\u5b57 3 \u533a\u57df\uff1a</p> <ul> <li>\u663e\u793a\u56fe\u7247\u7684\u5206\u8fa8\u7387</li> </ul> </li> <li> <p>\u6570\u5b57 4 \u533a\u57df\uff1a</p> <ul> <li>\u8bbe\u7f6e\u9f20\u6807\u7684\u70b9\u51fb\u533a\u57df</li> <li>\u5728\u6570\u5b57 4 \u7684\u53f3\u4fa7\u533a\u57df\u5185\u70b9\u51fb\u9f20\u6807\uff0c\u6539\u53d8\u9f20\u6807\u533a\u57df\u503c</li> <li>\u53ef\u4ee5\u5355\u72ec\u8bbe\u7f6e X \u548c Y \u503c\uff0c\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u662f\u5426\u8981\u5f52\u4e00\u5316\u64cd\u4f5c</li> </ul> </li> </ul> <p>\u4ee5\u4e0a\u5c31\u662f KodeLife \u8fdb\u884c Shader \u7f16\u5199\u7684\u64cd\u4f5c\u90e8\u5206\u4e86\uff0c\u76f8\u4fe1\u4f60\u4e5f\u5df2\u7ecf\u77e5\u9053\u8981\u5982\u4f55\u64cd\u4f5c\u4e86\u3002</p> <p>\u5982\u679c\u4f7f\u7528 <code>Shadertoy</code> \u63d0\u4f9b\u7684\u6a21\u677f\uff0c\u5b83\u81ea\u5e26\u7684\u53d8\u91cf\u4f1a\u591a\u4e00\u70b9\uff0c\u4f46\u90fd\u5927\u540c\u5c0f\u5f02\u4e86\uff0c\u800c\u4e14\u8fd9\u90fd\u4e0d\u662f\u91cd\u70b9\uff0c\u91cd\u70b9\u8fd8\u662f\u5982\u4f55\u4f7f\u7528\u8fd9\u4e9b\u53d8\u91cf\u8fdb\u884c\u521b\u4f5c\u3002</p> <p>\u6240\u4ee5\u63a5\u4e0b\u6765\u5c31\u662f\u53d1\u6325\u60f3\u8c61\u529b\u8fdb\u884c Shader \u7684\u5f00\u53d1\u4e86\u3002</p>","tags":["OpenGL"]},{"location":"opengl/shader-tool-kodelife-introduce/#kodelife-shader","title":"KodeLife Shader \u7f16\u5199\u5b9e\u8df5","text":"<p>\u63d0\u4f9b\u4e24\u4e2a\u7b80\u5355\u4f8b\u5b50\uff0c\u6f14\u793a\u4e00\u4e0b\u5728 KodeLife \u4e2d\u7f16\u5199\u4ee3\u7801\u5b9e\u73b0\u7f51\u683c\u6548\u679c\u3002</p> <p>\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform vec2 u_resolution;\nuniform vec2 u_mouse;\nuniform float u_time;\n\nvoid main() {\n\n    vec2 fragcoord = vec2(gl_FragCoord.xy / u_resolution);\n    vec3 bgColor = vec3(1.0,1.0,1.0);\n    vec3 pixelColor = bgColor;\n    vec3 gridColor = vec3(0.5,0.5,0.5);\n\n    const float width = 0.1;\n    const float minWidth = 0.003;\n    for(float i = 0.0; i &lt; 1.0; i+=width){\n        if (mod(fragcoord.x,width) &lt; minWidth || mod(fragcoord.y,width) &lt; minWidth){\n            pixelColor = gridColor;\n        }\n    }\n\n    gl_FragColor = vec4(pixelColor,1.0);\n}\n</code></pre> <p>\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <pre><code>#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform vec2 u_resolution;\nuniform vec2 u_mouse;\nuniform float u_time;\n\nvoid main() {\n\n    vec2 r = vec2(gl_FragCoord.xy - 0.5 * u_resolution);\n    vec2 fragcoord = 2.0 * r.xy / u_resolution;\n\n    vec3 bgColor = vec3(1.0,1.0,1.0);\n    vec3 pixelColor = bgColor;\n    vec3 gridColor = vec3(0.5,0.5,0.5);\n    vec3 axesColor = vec3(1.0,0.0,0.0);\n\n    const float width = 0.1;\n    const float minWidth = 0.008;\n    for(float i = 0.0; i &lt; 1.0; i+=width){\n        if (mod(fragcoord.x,width) &lt; minWidth || mod(fragcoord.y,width) &lt; minWidth){\n            pixelColor = gridColor;\n        }\n    }\n\n    if (abs(fragcoord.x) &lt; 0.008 || abs(fragcoord.y) &lt; 0.008){\n        pixelColor = axesColor;\n    }\n\n\n    gl_FragColor = vec4(pixelColor,1.0);\n}\n</code></pre> <p>\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u628a\u4ee3\u7801\u590d\u5236\u7c98\u8d34\u5230 KodeLife \u4e2d\u8fd0\u884c\u5c31\u80fd\u770b\u5230\u6548\u679c\u4e86\u3002</p> <p>\u8fd9\u4e24\u4e2a\u6548\u679c\u7684\u533a\u522b\u5c31\u662f\u5728\u4e8e\u4e2d\u95f4\u5750\u6807\u8f74\u7ed8\u5236\u4e86\uff0c\u4f60\u80fd\u4ece\u4ee3\u7801\u4e2d\u770b\u5230\u6709\u4f55\u4e0d\u540c\u5417\uff1f</p> <p>\u5728\u540e\u7eed\u7684\u6587\u7ae0\u518d\u6765\u8bb2\u89e3\u5982\u4f55\u7f16\u5199 Shader \u5427<sub>~</sub></p> <p>\u80fd\u529b\u4e0d\u8db3\uff0c\u7ecf\u9a8c\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4f55\u4e0d\u5bf9\u7684\u5730\u65b9\u6b22\u8fce\u6279\u8bc4\u6307\u6b63\uff0c\u4e5f\u53ef\u4ee5\u52a0\u6211\u5fae\u4fe1 ezglumes \u4ea4\u6d41~~</p>","tags":["OpenGL"]},{"location":"sdl/av-beginner-001/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-001\u3011\u57fa\u7840\u5b66\u4e60\u7bc7- SDL \u4ecb\u7ecd\u4ee5\u53ca\u5de5\u7a0b\u914d\u7f6e","text":"<p>\u8fd9\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u7cfb\u5217\u7684\u7b2c\u4e00\u7bc7\u6587\u7ae0\uff0c\u4e3b\u8981\u8bb2\u89e3 SDL \u662f\u4ec0\u4e48\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u8981\u7528\u5230\u5b83\uff0c\u770b\u4f3c\u548c\u97f3\u89c6\u9891\u6ca1\u5565\u5375\u5173\u7cfb\uff0c\u5176\u5b9e\u5fc5\u4e0d\u53ef\u5c11\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-001/#sdl","title":"SDL \u7b80\u4ecb","text":"<p>SDL \u662f \u201cSimple DirectMedia Layer\u201d \u7684\u7f29\u5199\uff0c\u5b83\u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u591a\u5a92\u4f53\u5e93\uff0c\u53ef\u4ee5\u5728 Mac\u3001Windows\u3001Linux \u4ee5\u53ca\u66f4\u591a\u7684\u7cfb\u7edf\u4e0a\u8fd0\u884c\u3002</p> <p>SDL \u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u9488\u5bf9\u97f3\u9891\u3001\u89c6\u9891\u3001\u952e\u76d8\u3001\u9f20\u6807\u3001\u63a7\u5236\u6746\u4ee5\u53ca 3D \u786c\u4ef6\u7684\u4f4e\u7ea7\u522b\u8bbf\u95ee\u63a5\u53e3\uff0c\u6211\u4eec\u5229\u7528\u8fd9\u4e9b\u63a5\u53e3\u5c31\u80fd\u5728\u4e0d\u540c\u7cfb\u7edf\u4e0a\u64ad\u653e\u51fa\u97f3\u9891\u3001\u89c6\u9891\u5185\u5bb9\uff0c\u800c\u65e0\u9700\u61c2\u5f97\u7cfb\u7edf\u7279\u5b9a\u7684\u97f3\u89c6\u9891\u63a5\u53e3\u3002</p> <p>\u8fd9\u79cd\u8de8\u5e73\u53f0\u7279\u6027\u548c OpenGL \u662f\u4e00\u6837\u7684\uff0c\u5dee\u522b\u5728\u4e0e OpenGL \u662f\u771f\u00b7\u8de8\u5e73\u53f0\uff0c\u5b83\u662f Khronos Group \u7ec4\u7ec7\u5f00\u53d1\u7ef4\u62a4\u7684\u4e00\u4e2a\u63a5\u53e3\u89c4\u8303\uff0c\u5177\u4f53\u7684\u5b9e\u73b0\u662f\u7531\u9a71\u52a8\u5382\u5546\u5b8c\u6210\u3002\u800c SDL \u662f\u628a\u8981\u517c\u5bb9\u5e73\u53f0\u7684\u76f8\u5173\u63a5\u53e3\u90fd\u7ed9\u5c01\u88c5\u597d\u4e86\uff0c\u7136\u540e\u624d\u5bf9\u5916\u63d0\u4f9b\u7edf\u4e00\u7684\u63a5\u53e3\u3002</p> <p>\u7531\u6b64\u53ef\u89c1\uff0c\u9ad8\u4e0b\u7acb\u5224\u3002\u4e00\u4e2a\u8de8\u5e73\u53f0\u662f\u5199\u4e86\u63a5\u53e3\u5c31\u884c\uff0c\u4e0d\u7ba1\u5b9e\u73b0\uff1b\u53e6\u4e00\u4e2a\u662f\u5199\u597d\u4e86\u5b9e\u73b0\uff0c\u624d\u80fd\u8de8\u5e73\u53f0\uff08\u8c8c\u4f3c\u8dd1\u9898\u4e86\uff09\u3002</p> <p>\u7531\u4e8e SDL \u7684\u8de8\u5e73\u53f0\u7279\u6027\uff0c\u5728\u540e\u7eed\u5b66\u4e60 FFmpeg \u65f6\u5c31\u53ef\u4ee5\u5229\u7528 SDL \u8fdb\u884c\u97f3\u89c6\u9891\u7684\u64ad\u653e\u64cd\u4f5c\uff0c\u800c\u4e0d\u7528\u50cf\u5728 Android \u5e73\u53f0\u4e0a\u641e FFmpeg \u8fd8\u5f97\u7f16\u8bd1 so\u3001\u5199 JNI \u3001\u5199\u754c\u9762\u90a3\u4e48\u9ebb\u70e6\uff0c\u53e6\u5916 ffplay \u6e90\u7801\u91cc\u9762\u4e5f\u662f\u7528\u7684 SDL \u8fdb\u884c\u64ad\u653e\u7684\uff0c\u53ef\u4ee5\u4ece\u4e2d\u8fdb\u884c\u501f\u9274\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-001/#sdl_1","title":"SDL \u4e0b\u8f7d\u5b89\u88c5","text":"<p>\u5728 Mac \u4e0a\u4e0b\u8f7d SDL \u5f88\u7b80\u5355\uff0c\u76f4\u63a5</p> <pre><code>brew install sdl2\n</code></pre> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0b\u8f7d\u7684\u662f SDL 2.0 \u7248\u672c\uff0c\u5982\u679c\u7528\u5982\u4e0b\u7684\u547d\u4ee4</p> <pre><code>brew install sdl\n</code></pre> <p>\u4e0b\u8f7d\u7684\u5c31\u662f SDL 1.0 \u7248\u672c\u4e86\uff0c\u533a\u522b\u5c31\u662f\u7248\u672c\u540e\u9762\u6570\u5b57 <code>2</code> \u7684\u540e\u7f00\u3002</p> <p>\u91c7\u7528\u6700\u65b0\u7684 2.0 \uff0c\u6211\u5f53\u524d\u4f7f\u7528\u7684\u7248\u672c\u53f7\u5c31\u662f 2.0.10 \u3002</p> <p>\u5982\u679c\u662f Windows \u7cfb\u7edf\uff0c\u53c2\u8003\u4e0b\u5176\u4ed6\u6587\u7ae0\u7684\u4e0b\u8f7d\u914d\u7f6e\u5427\uff0c\u6ca1\u6709\u7535\u8111\u4e5f\u6ca1\u529e\u6cd5\u4e86\u3002</p> <p>SDL \u4e0b\u8f7d\u4e4b\u540e\u4f4d\u4e8e MAC \u7cfb\u7edf\u7684\u5982\u4e0b\u76ee\u5f55\uff0c\u8fd9\u4e2a\u76ee\u5f55\u540e\u7eed\u4f1a\u7528\u5230\u7684\u3002</p> <p>/usr/local/Cellar/sdl2/2.0.10</p>","tags":["SDL"]},{"location":"sdl/av-beginner-001/#clion","title":"CLion \u65b0\u5efa\u5de5\u7a0b","text":"<p>\u63a5\u4e0b\u6765\u5c31\u5f00\u59cb\u6253\u5f00 CLion \uff0c\u65b0\u5efa\u4e00\u4e2a C++ \u5de5\u7a0b\u3002</p> <p>\u8fd9\u91cc\u7528\u5230 CLion \u662f\u56e0\u4e3a\u5b83\u786e\u5b9e\u597d\u7528\uff0c\u81ea\u52a8\u8865\u5168\u3001\u4ee3\u7801\u63d0\u793a\u3001\u65ad\u70b9\u8c03\u8bd5\u7b49\u529f\u80fd\u975e\u5e38\u597d\u7528\uff0c\u53ea\u662f\u6ca1\u6709\u793e\u533a\u514d\u8d39\u7248\u7684\uff0c\u6709 30 \u5929\u7684\u514d\u8d39\u8bd5\u7528\u671f\uff0c\u4e4b\u540e\u5c31\u5f97\u9760\u6fc0\u6d3b\u7801\u6fc0\u6d3b\u4e86\u3002</p> <p>\u597d\u5728\u662f\u7528 CMake \u8fdb\u884c\u7f16\u8bd1\u7684\uff0c\u5982\u679c\u4e0b\u8f7d\u4e86\u5de5\u7a0b\u6e90\u7801\uff0c\u5e76\u4e14\u914d\u7f6e\u597d\u4e86 CMake \u7684\u5173\u8054\u5e93\u548c\u5934\u6587\u4ef6\uff0c\u76f4\u63a5\u7528 CMake \u547d\u4ee4\u884c\u4e5f\u53ef\u4ee5\u8fdb\u884c\u7f16\u8bd1\u7684\uff0c\u8fd9\u4e2a\u540e\u9762\u4f1a\u8bb2\u5230\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-001/#c-sdl","title":"C++ \u5de5\u7a0b\u5173\u8054 SDL \u5e93","text":"<p>\u63a5\u4e0b\u6765\u5c31\u662f\u5728 C++ \u5de5\u7a0b\u4e2d\u5173\u8054 SDL \u5e93\uff0c\u4fbf\u4e8e\u5728\u5de5\u7a0b\u4e2d\u5f15\u7528 SDL \u76f8\u5173\u5934\u6587\u4ef6\u3002</p> <p>\u4e4b\u524d\u63d0\u5230 SDL \u7684\u5b89\u88c5\u8def\u5f84\u5982\u4e0b\uff1a</p> <pre><code>/usr/local/Cellar/sdl2/2.0.10\n</code></pre> <p>\u8be5\u76ee\u5f55\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5176\u4e2d include \u5c31\u662f\u5934\u6587\u4ef6\u7684\u8def\u5f84\uff0clib \u5c31\u662f\u5e93\u7684\u8def\u5f84\u3002</p> <p>\u8fd9\u91cc\u8981\u7528\u5230 <code>include_directories</code> \u548c <code>link_directories</code> \u4e24\u4e2a\u547d\u4ee4\u3002</p> <p>\u5176\u4e2d\uff1a</p> <p><code>include_directories</code> \u662f\u5c06\u5934\u6587\u4ef6\u6240\u5728\u6587\u4ef6\u5939\u6dfb\u52a0\u5728\u641c\u7d22\u8def\u5f84\u4e2d\uff0c\u8fd9\u6837\u5c31\u80fd\u901a\u8fc7 <code>include</code> \u53bb\u52a0\u8f7d\u5934\u6587\u4ef6\u4e86\u3002</p> <p><code>link_directories</code> \u662f\u5c06\u5e93\u6240\u5728\u7684\u6587\u4ef6\u5939\u6dfb\u52a0\u5728\u8def\u5f84\u4e2d\u53bb\uff0c\u8fd9\u6837\u5728\u7f16\u8bd1\u65f6\u5c31\u80fd\u94fe\u63a5\u5230\u8fd9\u4e2a\u5e93\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code># \u58f0\u660e\u4e00\u4e2a\u53d8\u91cf SDL_DIR \u4e3a SDL \u5b89\u88c5\u8def\u5f84\nset(SDL_DIR \"/usr/local/Cellar/sdl2/2.0.10\")\n# \u8bbe\u7f6e\u8981\u5305\u542b\u7684\u5934\u6587\u4ef6\u7684\u8def\u5f84\ninclude_directories(${SDL_DIR}/include)\n# \u8bbe\u7f6e\u8981\u5173\u8054\u7684\u5e93\u7684\u8def\u5f84\nlink_directories(${SDL_DIR}/lib)\n</code></pre> <p>\u4ee3\u7801\u4e2d\u58f0\u660e\u4e86\u4e00\u4e2a\u53d8\u91cf <code>SDL_DIR</code> \u4f5c\u4e3a\u5b89\u88c5\u8def\u5f84\uff0c\u5982\u679c\u4f60\u7684\u7cfb\u7edf\u4e0a\u8def\u5f84\u6709\u6240\u4e0d\u540c\uff0c\u53ea\u9700\u8981\u4fee\u6539\u8def\u5f84\u5c31\u884c\u4e86\u3002</p> <p>\u5728 MAC \u4e0a\u4e5f\u53ef\u4ee5\u628a\u8def\u5f84\u8bbe\u7f6e\u6210 <code>/usr/local</code>\uff0c\u6240\u6709\u7684\u5e93\u5b89\u88c5\u65f6\u5728\u8fd9\u4e2a\u76ee\u5f55\u7684 <code>lib</code> \u548c <code>include</code> \u76ee\u5f55\u4e0b\u4e5f\u6709\u4e00\u4efd\u7d22\u5f15\u3002</p> <p>\u6700\u540e\u5c06\u6211\u4eec\u8981\u7f16\u8bd1\u7684\u7a0b\u5e8f\u5173\u8054\u4e0a SDL \u8fd9\u4e2a\u5e93\u3002</p> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7 <code>link_directories</code> \u547d\u4ee4\u5c06\u5f88\u591a\u5e93\u6240\u5728\u6587\u4ef6\u5939\u90fd\u6dfb\u52a0\u5230\u8def\u5f84\u4e2d\uff0c\u4f46\u662f\u53ea\u6709 <code>target_link_libraries</code> \u547d\u4ee4\u624d\u4f1a\u6700\u7ec8\u51b3\u5b9a\u5173\u8054\u4ec0\u4e48\u5e93\uff0c\u5982\u679c\u4f60\u6dfb\u52a0\u7684\u6587\u4ef6\u5939\u8def\u5f84\u6ca1\u6709\u5bf9\u5e94\u5e93\u7684\u8bdd\uff0c\u53cd\u800c\u8981\u62a5\u9519\u7684\u3002</p> <p>\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>target_link_libraries(av-beginner SDL2)\n</code></pre> <p><code>target_link_libraries</code> \u65b9\u6cd5\u4f1a\u4f18\u5148\u94fe\u63a5\u52a8\u6001\u5e93\uff0c\u4e5f\u53ef\u4ee5\u663e\u793a\u6307\u5b9a\u52a8\u6001\u5e93\u6216\u8005\u9759\u6001\u5e93\u3002MAC \u4e0a\u52a8\u6001\u5e93\u7684\u540e\u7f00\u662f <code>dylib</code> \u3002\u5728\u4e0a\u9762\u7684\u56fe\u7247\u53ef\u4ee5\u770b\u5230 <code>libSDL2.dylib</code> \u5176\u5b9e\u662f\u4e00\u4e2a\u7d22\u5f15\uff0c\u771f\u6b63\u7684\u5e93\u662f <code>libSDL2-2.0.0.dylib</code>\uff0c\u7d22\u5f15\u5ffd\u7565\u4e86\u5b83\u7684\u7248\u672c\u53f7\u3002</p> <p>\u5b8c\u6210\u4e86 SDL \u5e93\u7684\u5173\u8054\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u771f\u6b63\u7f16\u5199\u4ee3\u7801\u4e86\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-001/#_1","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u4ee3\u7801\u5b9e\u8df5\u4e3b\u8981\u662f\u9a8c\u8bc1\u6211\u4eec\u7684\u73af\u5883\u914d\u7f6e\u6709\u6ca1\u6709\u95ee\u9898\uff0c\u8fd0\u884c\u4e00\u4e2a SDL \u51fd\u6570\u6765\u8bd5\u8bd5\u3002</p> <pre><code>#include &lt;iostream&gt;\n#include &lt;SDL2/SDL.h&gt;\nusing namespace std;\n\nint main(){\n    cout &lt;&lt; \"hello av-beginner\" &lt;&lt; endl;\n    SDL_Init(SDL_INIT_EVERYTHING);\n    return 0;\n}\n</code></pre> <p><code>SDL_Init</code> \u662f SDL \u7684\u521d\u59cb\u5316\u51fd\u6570\uff0c\u53ef\u4ee5\u6839\u636e\u6240\u9700\u529f\u80fd\u9009\u62e9\u6027\u7684\u521d\u59cb\u5316\u4e5f\u53ef\u4ee5\u5168\u90e8\u521d\u59cb\u5316\u3002</p> <p>\u5982\u679c\u7a0b\u5e8f\u6b63\u5e38\u8f93\u51fa\u5e76\u4e14\u6b63\u5e38\u9000\u51fa\uff0c\u90a3\u4e48\u8bf4\u660e\u73af\u5883\u914d\u7f6e OK \u4e86\uff0c\u540e\u9762\u5c31\u53ef\u4ee5\u8fdb\u884c\u529f\u80fd\u5f00\u53d1\u4e86\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-001/#_2","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u8fde\u8f7d\u7684 <code>001</code> \u7bc7\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u672c\u7bc7\u6587\u7ae0\u5bf9\u5e94\u7684\u63d0\u4ea4 <code>tag</code> \u4e3a <code>av-beginner-001</code>\uff0c\u53ef\u5207\u6362\u81f3\u5bf9\u5e94\u6e90\u7801\u67e5\u770b\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-002/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-002\u3011\u57fa\u7840\u5b66\u4e60\u7bc7-SDL \u521b\u5efa\u7a97\u53e3\u5e76\u663e\u793a\u989c\u8272","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u6211\u4eec\u5df2\u7ecf\u5b8c\u6210\u4e86 SDL \u7684\u5de5\u7a0b\u914d\u7f6e\uff0c\u63a5\u4e0b\u6765\u5c31\u662f SDL \u76f8\u5173\u529f\u80fd\u7684\u5f00\u53d1\u3002</p> <p>\u672c\u7bc7\u6587\u7ae0\u4e3b\u8981\u662f\u521b\u5efa\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7a97\u53e3\u5e76\u663e\u793a\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-002/#sdl","title":"\u521b\u5efa SDL \u7a97\u53e3","text":"<p>\u901a\u8fc7 SDL \u4e2d\u7684 <code>SDL_CreateWindow</code> \u51fd\u6570\u5c31\u80fd\u591f\u521b\u5efa\u4e86\uff0c</p> <pre><code>extern DECLSPEC SDL_Window * SDLCALL SDL_CreateWindow(\n        const char *title,\n        int x, int y, int w,\n        int h, Uint32 flags);\n</code></pre> <p>\u5176\u4e2d\uff0c<code>title</code> \u5c31\u662f\u7a97\u53e3\u7684\u6807\u9898\uff0c<code>x</code>,<code>y</code>,<code>width</code>,<code>height</code> \u5c31\u662f\u7a97\u53e3\u7684\u5de6\u4e0a\u89d2\u5750\u6807\u70b9\u548c\u5bbd\u9ad8\u503c\u3002</p> <p>\u6700\u540e\u7684 <code>flags</code> \u53c2\u6570\u6709\u5f88\u591a\u7c7b\u578b\uff0c\u4e0d\u540c\u7684\u7c7b\u578b\u5bf9\u5e94\u4e0d\u540c\u7684\u7a97\u53e3\u529f\u80fd\uff0c\u6bd4\u5982\u7a97\u53e3\u5168\u5c4f\u3001\u662f\u5426\u53ef\u89c1\u7b49\uff0c\u5177\u4f53\u53ef\u4ee5\u5728 SDL \u6e90\u7801\u4e2d\u627e\u5230\u3002</p> <p>\u8fd9\u91cc\u7b80\u5355\u8bbe\u7f6e\u6210\u5982\u4e0b\uff1a</p> <pre><code>    int width = 400;\n    int height = 400;\n    SDL_Window *window = SDL_CreateWindow(\"Hello SDL\",\n            SDL_WINDOWPOS_CENTERED,\n            SDL_WINDOWPOS_CENTERED,\n            width,height,\n            SDL_WINDOW_ALLOW_HIGHDPI);\n</code></pre> <p>\u5bf9\u4e8e\u7a97\u53e3\u7684\u5de6\u4e0a\u89d2\u5750\u6807\u70b9\u4f7f\u7528 SDL \u9ed8\u8ba4\u7684\u5b8f <code>SDL_WINDOWPOS_CENTERED</code> \u8ba9\u5b83\u5c45\u4e2d\u663e\u793a\u5c31\u597d\u4e86\uff0cflags \u4f7f\u7528 <code>SDL_WINDOW_ALLOW_HIGHDPI</code>\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-002/#sdl_1","title":"\u5c55\u793a SDL \u7a97\u53e3","text":"<p>SDL_Window \u5e76\u6ca1\u6709\u4ec0\u4e48 <code>show</code> \u7684\u65b9\u6cd5\uff0c\u770b\u5230\u7f51\u4e0a\u7684\u6587\u7ae0\u5e94\u8be5\u4e00\u521b\u5efa\u5c31\u53ef\u4ee5\u663e\u793a\u51fa\u6765\u4e86\uff0c\u5982\u679c\u51fa\u73b0\u968f\u7740\u7a0b\u5e8f\u9000\u51fa\uff0c\u7a97\u53e3\u4e00\u95ea\u800c\u8fc7\u7684\u60c5\u51b5\u52a0\u4e2a <code>SDL_Delay</code> \u5ef6\u65f6\u4e00\u6bb5\u65f6\u95f4\u4e5f\u884c\u3002</p> <p>\u4e0d\u8fc7\u53ef\u80fd\u662f\u7531\u4e8e MAC \u7cfb\u7edf\u6216\u8005 SDL \u7248\u672c\u7684\u95ee\u9898\uff0c\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u7a97\u53e3\u5f39\u51fa\u6765\uff0c\u5012\u662f\u5728\u4efb\u52a1\u680f\u4e2d\u786e\u5b9e\u80fd\u770b\u5230\u6709\u4e2a\u7a0b\u5e8f\u5728\u8fd0\u884c\u3002</p> <p>\u540e\u6765\u5728\u521b\u5efa\u7a97\u53e3\u4e4b\u540e\uff0c\u52a0\u4e0a\u5982\u4e0b\u7684\u4ee3\u7801\u5c31\u597d\u4e86\uff1a</p> <pre><code>    SDL_Event windowEvent;\n    while (true){\n        if (SDL_PollEvent(&amp;windowEvent)){\n            if (SDL_QUIT == windowEvent.type){\n                break;\n            }\n        }\n    }\n</code></pre> <p>\u5728\u7a0b\u5e8f\u4e2d\u521b\u5efa\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u5f53\u505a\u6d88\u606f\u5faa\u73af\u673a\u5236\uff0c\u53ea\u6709\u5f53\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u65f6\u624d\u9000\u51fa\u5faa\u73af\u7ed3\u675f\u7a0b\u5e8f\u3002</p> <p>\u6dfb\u52a0\u8fd9\u6bb5\u4ee3\u7801\u4e4b\u540e\u5728\u8fd0\u884c\uff0c\u5c31\u80fd\u770b\u5230\u7a97\u53e3\u4e86\u3002</p> <p></p>","tags":["SDL"]},{"location":"sdl/av-beginner-002/#sdl_2","title":"\u6e32\u67d3 SDL \u7a97\u53e3","text":"<p>\u73b0\u5728\u8fd8\u662f\u4e00\u4e2a\u9ed1\u6f06\u6f06\u7684\u7a97\u53e3\uff0c\u90a3\u662f\u56e0\u4e3a\u8fd8\u6ca1\u6709\u7ed9\u5b83\u6e32\u67d3\u4e0a\u989c\u8272\u3002</p> <p>\u6e32\u67d3\u7a97\u53e3\uff0c\u9996\u5148\u8981\u521b\u5efa\u4e00\u4e2a\u6e32\u67d3\u5668\uff0c\u5e76\u8bbe\u7f6e\u6e32\u67d3\u989c\u8272\uff0c\u7136\u540e\u5f00\u59cb\u6e32\u67d3\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a</p> <pre><code>    SDL_Renderer* pRenderer = NULL;\n    // \u521b\u5efa\u6e32\u67d3\u5668\n    pRenderer = SDL_CreateRenderer(window, -1, 0);\n    // \u6307\u5b9a\u6e32\u67d3\u989c\u8272\n    SDL_SetRenderDrawColor(pRenderer,0,255,0,255);\n    // \u6e05\u7a7a\u5f53\u524d\u7a97\u53e3\u7684\u989c\u8272\n    SDL_RenderClear(pRenderer);\n    // \u6267\u884c\u6e32\u67d3\u64cd\u4f5c\uff0c\u66f4\u65b0\u7a97\u53e3\n    SDL_RenderPresent(pRenderer);\n</code></pre> <p>\u8c03\u7528 <code>SDL_CreateRenderer</code> \u65b9\u6cd5\u6765\u521b\u5efa\u6e32\u67d3\u5668\uff0c\u5e76\u901a\u8fc7 <code>SDL_SetRenderDrawColor</code> \u6765\u6307\u5b9a\u989c\u8272\uff0c\u989c\u8272\u53c2\u6570\u90fd\u662f <code>red</code>\u3001<code>green</code>\u3001<code>blue</code>\u3001<code>alpha</code> \u56db\u4e2a\uff0c\u8fd9\u91cc\u6307\u5b9a\u4e86\u6e32\u67d3\u4e3a\u7eff\u8272\u3002</p> <p>\u7136\u540e\u901a\u8fc7 <code>SDL_RenderClear</code> \u65b9\u6cd5\u6e05\u7a7a\u4e00\u4e0b\u5f53\u524d\u7a97\u53e3\u4e0a\u7684\u989c\u8272\uff0c\u907f\u514d\u548c\u8981\u6e32\u67d3\u7684\u989c\u8272\u6df7\u5728\u4e00\u8d77\u4e86\uff0c\u6700\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u6e32\u67d3\u4e86\u3002</p> <p>\u8fd9\u4e2a\u6d41\u7a0b\u548c OpenGL \u7684\u6e32\u67d3\u64cd\u4f5c\u6709\u70b9\u7c7b\u4f3c\u4e86\uff1a</p> <pre><code>glClearColor()\nglClear()\nglDrawArrays() \n</code></pre> <p>\u4e5f\u662f\u5148\u6e05\u7a7a\u540e\u6e32\u67d3\uff0c\u5b9e\u9645\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u8fd9\u6837\u5c31\u521b\u5efa\u4e86\u4e00\u4e2a\u7a97\u53e3\uff0c\u5e76\u4e14\u663e\u793a\u6307\u5b9a\u989c\u8272\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-002/#sdl_3","title":"\u9500\u6bc1 SDL \u7a97\u53e3","text":"<p>\u6700\u540e\uff0c\u5f53\u9000\u51fa\u5faa\u73af\u65f6\uff0c\u8981\u6267\u884c\u9500\u6bc1\u64cd\u4f5c\uff0c\u628a\u521b\u5efa\u7684 SDL_Window \u548c SDL_Renderer \u90fd\u91ca\u653e\u4e86\u3002</p> <pre><code>    SDL_DestroyWindow(window);\n    SDL_DestroyRenderer(pRenderer);\n    SDL_Quit();\n</code></pre> <p>\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u6574\u4e2a\u7a0b\u5e8f\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-002/#_1","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u8fde\u8f7d\u7684 <code>002</code> \u7bc7\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u672c\u7bc7\u6587\u7ae0\u5bf9\u5e94\u7684\u63d0\u4ea4 <code>tag</code> \u4e3a <code>av-beginner-002</code>\uff0c\u53ef\u5207\u6362\u81f3\u5bf9\u5e94\u6e90\u7801\u67e5\u770b\u3002</p> <p>\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4e0d\u5bf9\u4e4b\u5904\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezgluems \u8fdb\u884c\u4ea4\u6d41~~</p>","tags":["SDL"]},{"location":"sdl/av-beginner-003/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-003\u3011\u57fa\u7840\u5b66\u4e60\u7bc7-SDL \u6d88\u606f\u5faa\u73af\u548c\u4e8b\u4ef6\u54cd\u5e94","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u5df2\u7ecf\u521b\u5efa\u4e86\u4e00\u4e2a SDL \u7a97\u53e3\u5e76\u4e14\u663e\u793a\u6307\u5b9a\u7684\u989c\u8272\u3002</p> <p>\u4e3a\u4e86\u8ba9\u7a97\u53e3\u663e\u793a\u51fa\u6765\uff0c\u5728\u7a0b\u5e8f\u4e2d\u5199\u4e86\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u8fd9\u51e0\u884c\u4ee3\u7801\u5c31\u662f SDL \u6d88\u606f\u5faa\u73af\u548c\u4e8b\u4ef6\u54cd\u5e94\u7684\u6838\u5fc3\u7f29\u5f71\u4e86\u3002</p> <pre><code>    SDL_Event windowEvent;\n    while (true){\n        if (SDL_PollEvent(&amp;windowEvent)){\n            if (SDL_QUIT == windowEvent.type){\n                break;\n            }\n        }\n    }\n</code></pre>","tags":["SDL"]},{"location":"sdl/av-beginner-003/#sdl","title":"SDL \u6d88\u606f\u5faa\u73af\u548c\u4e8b\u4ef6\u54cd\u5e94","text":"<p>\u548c Android \u4e2d\u7684 Handler \u673a\u5236\u6709\u4e9b\u7c7b\u4f3c\uff0cHandler \u4f1a\u5173\u8054\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u5185\u90e8\u7ef4\u62a4\u4e00\u4e2a\u6d88\u606f\u961f\u5217 MessageQueue\uff0c\u901a\u8fc7 Handler \u50cf MessageQueue \u53d1\u9001\u6d88\u606f\uff0c\u7136\u540e\u518d\u4ece MessageQueue \u4e2d\u53d6\u51fa Message \u8fdb\u884c\u5904\u7406\u3002</p> <p>\u5728 SDL \u4e2d\u901a\u8fc7 <code>SDL_PollEvent</code> \u4ece\u6d88\u606f\u961f\u5217\u53d6\u51fa\u6d88\u606f\uff0c\u5982\u679c\u6709\u5219\u8fd4\u56de 1\uff0c\u6ca1\u7528\u5219\u8fd4\u56de 0\u3002 </p> <p><code>SDL_Event</code> \u7ed3\u6784\u4f53\u4ee3\u8868\u6d88\u606f\u4e8b\u4ef6\uff0c\u5176\u4e2d\u7684 <code>type</code> \u6307\u5b9a\u5177\u4f53\u7684\u4e8b\u4ef6\u7c7b\u578b\uff0c\u5728 <code>SDL_events.h</code> \u6587\u4ef6\u4e2d\u80fd\u770b\u5230\u6240\u6709\u7684\u4e8b\u4ef6\u7c7b\u578b\uff0c\u6284\u5f55\u4e00\u4e9b\u6bd4\u8f83\u5178\u578b\u7684\uff1a</p> <pre><code>typedef enum\n{\n   /* Application events */\n    SDL_QUIT           = 0x100, /**&lt; User-requested quit */\n\n   /* Keyboard events */\n    SDL_KEYDOWN        = 0x300, /**&lt; Key pressed */\n    SDL_KEYUP,                  /**&lt; Key released */\n\n    /* Mouse events */\n    SDL_MOUSEMOTION    = 0x400, /**&lt; Mouse moved */\n    SDL_MOUSEBUTTONDOWN,        /**&lt; Mouse button pressed */\n    SDL_MOUSEBUTTONUP,          /**&lt; Mouse button released */\n    SDL_MOUSEWHEEL,             /**&lt; Mouse wheel motion */\n\n    /* Window events */\n    SDL_WINDOWEVENT    = 0x200, /**&lt; Window state change */\n    SDL_SYSWMEVENT,             /**&lt; System specific event */\n} SDL_EventType;\n</code></pre> <p>\u5982\u4e0a\u6240\u793a\uff0c\u6709\u952e\u76d8\u3001\u9f20\u6807\u4e8b\u4ef6\u8fd8\u6709\u7a97\u53e3\u4e8b\u4ef6\u548c\u5e94\u7528\u9000\u51fa\u7684\u4e8b\u4ef6\uff0c\u57fa\u672c\u4e0a\u4e5f\u5c31\u7528\u5230\u8fd9\u4e9b\u4e86\u3002</p> <p>\u5f53\u7528\u6237\u70b9\u51fb\u4e86\u7a97\u53e3\u5de6\u4e0a\u89d2 <code>\u53c9</code> \u7684\u65f6\u5019\uff0c\u5bf9\u5e94 SDL_Event \u7684 type \u5c31\u662f <code>SDL_QUIT</code> \uff0c\u8fd9\u4e2a type \u662f\u4e00\u5b9a\u8981\u6dfb\u52a0\u5904\u7406\u7684\uff0c\u4e0d\u7136\u70b9\u53c9\u5c31\u5173\u95ed\u4e0d\u4e86\u7a97\u53e3\u4e86\u3002</p> <pre><code>    bool bQuit = false;\n    while (!bQuit){\n        while (SDL_PollEvent(&amp;windowEvent)){\n            switch (windowEvent.type){\n                case SDL_QUIT:\n                    bQuit = true;\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n</code></pre> <p>\u9664\u4e86 <code>SDL_PollEvent</code> \u65b9\u6cd5\u53bb\u53d6\u6d88\u606f\u5916\uff0c\u8fd8\u6709 <code>SDL_WaitEvent</code> \u65b9\u6cd5\u3002\u987e\u540d\u601d\u4e49\uff0c\u8be5\u65b9\u6cd5\u4f1a\u963b\u585e\u5f53\u524d\u8c03\u7528\u7684\u7ebf\u7a0b\uff0c\u76f4\u5230\u53d6\u51fa\u4e00\u4e2a\u6d88\u606f\u4e3a\u6b62\u3002</p> <pre><code>    bool bQuit = false;\n    while (!bQuit){\n        SDL_WaitEvent(&amp;windowEvent);\n        if (windowEvent.type == SDL_QUIT){\n            bQuit = true;\n            break;\n        } else{\n            cout &lt;&lt; \"get event\" &lt;&lt; endl;\n        }\n    }\n</code></pre> <p>\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0a\u6240\u793a\uff0c\u4f46\u5b9e\u9645\u4e0a\u7a0b\u5e8f\u4e0d\u4f1a\u4e00\u76f4\u5361\u5728 <code>SDL_WaitEvent</code> \u4e0a\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6709\u9650\u5236\u76d1\u542c\u7684\u4e8b\u4ef6\u7c7b\u578b\uff0c\u6240\u4ee5\u53ea\u8981\u6709\u7a97\u53e3\u5728\u8fd0\u884c\u663e\u793a\uff0c\u54ea\u6015\u4f60\u9f20\u6807\u5728\u7a97\u53e3\u4e0a\u6ed1\u8fc7\u3001\u6216\u8005\u6309\u4e0b\u4e86\u952e\u76d8\uff0c\u90fd\u80fd\u7b97\u662f\u6536\u5230\u4e86\u6d88\u606f\u4e8b\u4ef6\uff0c<code>cout</code> \u65b9\u6cd5\u6253\u5370\u7684 log \u65e5\u5fd7\u4f1a\u4e0d\u65ad\u51fa\u73b0\u7684\u3002</p> <p>\u540c\u6837\u7684\uff0c\u5728 <code>SDL_WaitEvent</code> \u65b9\u6cd5\u4e2d\u76d1\u542c\u4e86 <code>SDL_QUIT</code> \u7c7b\u578b\u7684\u4e8b\u4ef6\uff0c\u5f53\u70b9\u51fb\u7a97\u53e3\u5de6\u4e0a\u89d2\u7684\u53c9\u65f6\uff0c\u4e5f\u8981\u9000\u51fa\u5faa\u73af\uff0c\u7ed3\u675f\u7a0b\u5e8f\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-003/#_1","title":"\u952e\u76d8\u54cd\u5e94","text":"<p>\u73b0\u5728\u53ef\u4ee5\u901a\u8fc7 <code>SDL_Event</code> \u7684\u4e8b\u4ef6\u7c7b\u578b\u6765\u76d1\u542c\u7279\u5b9a\u7684\u952e\u76d8\u4e8b\u4ef6\u4e86\u3002</p> <p>\u952e\u76d8\u4e8b\u4ef6\u6709 <code>SDL_KEYDOWN</code> \u6309\u4e0b\u548c <code>SDL_KEYUP</code> \u62ac\u8d77\u4e24\u79cd\u7c7b\u578b\uff0c\u6309\u9700\u76d1\u542c\u3002</p> <p>\u800c\u5177\u4f53\u7528\u6237\u70b9\u51fb\u952e\u76d8\u4e0a\u4ec0\u4e48\u6309\u952e\uff0c\u8fd9\u4e2a\u4fe1\u606f\u5c31\u5728 SDL_Event \u7684 <code>SDL_KeyboardEvent</code> \u4e2d\u3002</p> <p>\u5bf9\u4e8e\u4e0d\u540c\u7c7b\u578b\u7684\u4e8b\u4ef6\u6240\u5305\u542b\u7684\u5177\u4f53\u4fe1\u606f\uff0cSDL_Event \u90fd\u6709\u5bf9\u5e94\u7684\u7ed3\u6784\u4f53\u53bb\u5b58\u50a8\u3002</p> <pre><code>typedef union SDL_Event\n{\n    Uint32 type;                    /**&lt; Event type, shared with all events */\n    SDL_CommonEvent common;         /**&lt; Common event data */\n    SDL_DisplayEvent display;       /**&lt; Window event data */\n    SDL_WindowEvent window;         /**&lt; Window event data */\n    // \u952e\u76d8\u4e8b\u4ef6\u7684\u4fe1\u606f\n    SDL_KeyboardEvent key;          /**&lt; Keyboard event data */\n    // \u9f20\u6807\u4e8b\u4ef6\u7684\u4fe1\u606f\n    SDL_MouseButtonEvent button;    /**&lt; Mouse button event data */\n    SDL_MouseMotionEvent motion;    /**&lt; Mouse motion event data */\n}\n</code></pre> <p>\u6240\u4ee5\u60f3\u8981\u77e5\u9053\u7528\u6237\u70b9\u51fb\u4e86\u54ea\u4e2a\u6309\u952e\uff0c\u53bb\u627e <code>SDL_KeyboardEvent</code> \u5bf9\u5e94\u7684\u4fe1\u606f\u5c31\u597d\u4e86\u3002</p> <pre><code>    bool bQuit = false;\n    while (!bQuit){\n        while (SDL_PollEvent(&amp;windowEvent)){\n            switch (windowEvent.type){\n                case SDL_QUIT:\n                    bQuit = true;\n                    break;\n                case SDL_KEYDOWN:\n                    if (windowEvent.key.keysym.sym == SDLK_SPACE){\n                        cout &lt;&lt; \"user click space \\n\" ;\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\u76d1\u542c\u7528\u6237\u662f\u5426\u70b9\u51fb\u7a7a\u683c\u952e\uff0c\u5982\u679c\u662f\u5c31\u8f93\u51fa\u5bf9\u5e94\u7684 log \u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-003/#_2","title":"\u9f20\u6807\u54cd\u5e94","text":"<p>\u9664\u6b64\u4e4b\u5916\u8fd8\u53ef\u4ee5\u76d1\u542c\u9f20\u6807\u4e8b\u4ef6\uff0c\u6bd4\u5982\u9f20\u6807\u662f\u5426\u6309\u4e0b\u3001\u62ac\u8d77\u3001\u79fb\u52a8\u548c\u5750\u6807\u4e4b\u7c7b\u7684\u3002</p> <p>\u5bf9\u5e94\u7684\u4e8b\u4ef6\u7c7b\u578b\u662f <code>SDL_MOUSEMOTION</code> \u3001<code>SDL_MOUSEBUTTONDOWN</code> \u3001<code>SDL_MOUSEBUTTONUP</code> \u3001<code>SDL_MOUSEBUTTONUP</code> \uff0c\u6309\u81ea\u5df1\u7684\u9700\u6c42\u53bb\u76d1\u542c\u4e86\u3002</p> <p>\u4e8b\u4ef6\u5305\u542b\u7684\u5177\u4f53\u4fe1\u606f\u5728 <code>SDL_MouseMotionEvent</code> \u3001<code>SDL_MouseButtonEvent</code> \u548c <code>SDL_MouseWheelEvent</code> \u91cc\u9762\u3002</p> <pre><code>    bool bQuit = false;\n    while (!bQuit){\n        while (SDL_PollEvent(&amp;windowEvent)){\n            switch (windowEvent.type){\n                case SDL_QUIT:\n                    bQuit = true;\n                    break;\n                case SDL_MOUSEBUTTONDOWN:\n                    printf(\"button index  is %d\\n\",windowEvent.button.button);\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\u5c31\u662f\u76d1\u542c\u9f20\u6807\u70b9\u51fb\u4e8b\u4ef6\uff0c\u5e76\u4e14\u6253\u5370\u51fa\u70b9\u51fb\u6309\u952e\u7684 index ,\u9f20\u6807\u7684\u5de6\u952e\u3001\u53f3\u952e\u548c\u4e2d\u95f4\u6eda\u8f6e\u6309\u4e0b\u53bb\u5bf9\u5e94\u7684 index \u4e0d\u540c\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-003/#_3","title":"\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u54cd\u5e94","text":"<p>\u9664\u4e86\u7cfb\u7edf\u4e8b\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u3002</p> <p>\u9996\u5148\u5b9a\u4e49\u4e00\u4e2a\u4e8b\u4ef6\u7c7b\u578b\u7684\u5b8f\uff1a</p> <pre><code>#define SDL_CUSTOM_EVENT  (SDL_USEREVENT + 1)\n</code></pre> <p>\u5176\u6b21\uff0c\u8981\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u8ba9\u5b83\u5ef6\u65f6\u4e94\u79d2\u540e\uff0c\u53d1\u9001\u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u53bb\u63a5\u6536\u5230\u8fd9\u4e2a\u4e8b\u4ef6\u3002</p> <pre><code>// \u7ebf\u7a0b\u8fd0\u884c\u51fd\u6570\nint sdl_thread_custom_event(void *){\n    // \u5ef6\u65f6 5 \u79d2\n    SDL_Delay(5000);\n    // \u521b\u5efa\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u5e76\u53d1\u9001\u5230\u6d88\u606f\u961f\u5217\u4e2d\u53bb\n    SDL_Event sdlEvent;\n    sdlEvent.type = SDL_CUSTOM_EVENT;\n    SDL_PushEvent(&amp;sdlEvent);\n}\n// \u521b\u5efa\u7ebf\u7a0b\u5e76\u8fd0\u884c\nSDL_CreateThread(sdl_thread_custom_event, \"custom_event\", nullptr);\n</code></pre> <p>\u7ebf\u7a0b\u8fd0\u884c\u51fd\u6570\u5982\u4e0a\u6240\u793a\uff0c\u5b9a\u4e49\u4e00\u4e2a SDL_Event \uff0c\u628a\u5b83\u7684 type \u8d4b\u503c\u4e3a\u81ea\u5b9a\u4e49\u7684\u7c7b\u578b\uff0c\u7136\u540e\u901a\u8fc7 <code>SDL_PushEvent</code> \u65b9\u6cd5\u628a\u8be5\u6d88\u606f\u4e8b\u4ef6\u653e\u5230\u6d88\u606f\u961f\u5217\u4e2d\u53bb\u3002</p> <pre><code>    bool bQuit = false;\n    while (!bQuit){\n        while (SDL_PollEvent(&amp;windowEvent)){\n            switch (windowEvent.type){\n                case SDL_QUIT:\n                    bQuit = true;\n                    break;\n                case SDL_CUSTOM_EVENT:\n                    cout &lt;&lt; \"receive user custom event\\n\";\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n</code></pre> <p>SDL_PollEvent \u65b9\u6cd5\u4f1a\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u53d6\u5230\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u6d88\u606f\u4e8b\u4ef6\uff0c\u8fd9\u65f6\u5019\u5c31\u80fd\u505a\u4e00\u4e9b\u60f3\u8981\u7684\u64cd\u4f5c\u5462\uff0c\u6bd4\u5982\u6253\u5370 log \u4e4b\u7c7b\u7684\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-003/#_4","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u5173\u4e8e SDL \u6d88\u606f\u5faa\u73af\u548c\u4e8b\u4ef6\u54cd\u5e94\u7684\u5b66\u4e60\u8fde\u8f7d <code>003</code> \u7bc7\u3002\u57fa\u672c\u4e0a\u540e\u7eed\u6240\u6709\u7684 SDL \u4ee3\u7801\u90fd\u4f1a\u6709\u8fd9\u6837\u4e00\u4e2a\u6d88\u606f\u5faa\u73af\u4f5c\u4e3a\u7a0b\u5e8f\u7684\u4e3b\u6846\u67b6\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u5f04\u660e\u767d\u4e86\uff0c\u65b9\u9762\u540e\u9762\u4ee3\u7801\u7684\u5b66\u4e60\u3002</p> <p>\u5177\u4f53\u7684\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u672c\u7bc7\u6587\u7ae0\u5bf9\u5e94\u7684\u63d0\u4ea4 <code>tag</code> \u4e3a <code>av-beginner-003</code>\uff0c\u53ef\u5207\u6362\u81f3\u5bf9\u5e94\u6e90\u7801\u67e5\u770b\u3002</p> <p>\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4e0d\u5bf9\u4e4b\u5904\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u8fdb\u884c\u4ea4\u6d41~~</p>","tags":["SDL"]},{"location":"sdl/av-beginner-004/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-004\u3011\u57fa\u7840\u5b66\u4e60\u7bc7-SDL \u52a0\u8f7d\u56fe\u7247\u5e76\u663e\u793a","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u5df2\u7ecf\u4ecb\u7ecd\u5b8c SDL \u663e\u793a\u7a97\u53e3\u3001\u6d88\u606f\u5faa\u73af\u548c\u4e8b\u4ef6\u54cd\u5e94\u8fd9\u4e9b\u57fa\u7840\u5185\u5bb9\uff0c\u6709\u4e86\u8fd9\u4e9b\u57fa\u7840\u5c31\u53ef\u4ee5\u8fdb\u884c\u529f\u80fd\u6027\u5f00\u53d1\u4e86\u3002</p> <p>\u672c\u7bc7\u7684\u4e3b\u8981\u5185\u5bb9\u662f\u5229\u7528 SDL \u52a0\u8f7d\u5e76\u663e\u793a\u4e00\u5f20\u56fe\u7247\uff0c\u7136\u540e\u518d\u53bb\u8fdb\u884c\u66f4\u591a\u7684\u97f3\u89c6\u9891\u64cd\u4f5c\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-004/#sdl2_image","title":"SDL2_Image \u914d\u7f6e","text":"<p>\u4e4b\u524d\u5199\u8fc7\u4e24\u7bc7 libpng \u548c libjpeg-turbo \u7f16\u8bd1\u4e0e\u5b9e\u8df5\u7684\u6587\u7ae0\uff1a</p> <ul> <li>\u56fe\u50cf\u5e93 libpng \u7f16\u8bd1\u4e0e\u5b9e\u8df5</li> <li>\u56fe\u50cf\u5e93 libjpeg-turbo \u7f16\u8bd1\u4e0e\u5b9e\u8df5</li> </ul> <p>\u6709\u9700\u8981\u7684\u53ef\u4ee5\u53bb\u7ffb\u9605\u4e00\u4e0b\u3002</p> <p>\u5728 SDL \u4e2d\u52a0\u8f7d png \u6216\u8005 jpeg \u56fe\u7247\u7528\u4e0d\u5230\u4e0a\u9762\u4e24\u4e2a\u5e93\u4e86\uff0c\u9700\u8981\u7528\u5230 SDL \u7279\u5b9a\u7684\u56fe\u7247\u5e93 SDL_Image \uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u53bb\u4e0b\u8f7d\uff1a</p> <pre><code>brew install sdl2_image\n</code></pre> <p>\u6211\u7528\u7684\u7248\u672c\u662f <code>2.0.5</code> \uff0c\u4e5f\u662f\u76ee\u524d\u6700\u65b0\u7684\u7248\u672c\uff0c\u4e4b\u540e\u6211\u4eec\u8981\u5728 CMake \u4e2d\u53bb\u914d\u7f6e\u5b83\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-004/#cmake","title":"CMake \u5de5\u7a0b\u914d\u7f6e","text":"<p>\u5bf9 <code>av-beginner</code> \u9879\u76ee\u7684 CMake \u914d\u7f6e\u505a\u4e86\u4e00\u4e9b\u6539\u52a8\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a <code>cmake_utils</code> \u7684\u76ee\u5f55\uff0c\u5728\u8be5\u76ee\u5f55\u4e0b\u521b\u5efa\u4e86\u4e00\u4e2a <code>CMakeLists.txt</code> \uff0c\u91cc\u9762\u5b58\u653e\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u4e13\u95e8\u7528\u6765\u505a\u5f00\u6e90\u5e93\u7684\u94fe\u63a5\u52a0\u8f7d\u5de5\u4f5c\uff0c\u5982\u4e0b\u56fe\u7ea2\u6846\u5185\u5bb9\u6240\u793a\uff1a</p> <p></p> <p>\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>init_path</code> \u7684\u5b8f\uff0c\u5b8f\u7684\u529f\u80fd\u548c\u51fd\u6570\u662f\u6709\u4e9b\u7c7b\u4f3c\u7684\uff0c\u5728\u91cc\u9762\u5b9a\u4e49\u4e86\u4e0d\u540c\u5f00\u6e90\u5e93\u7684\u8def\u5f84\u53d8\u91cf\uff0c\u540e\u7eed\u53ea\u8981\u5f15\u7528\u8fd9\u4e9b\u53d8\u91cf\u5c31\u597d\u4e86\u3002\u5982\u679c\u4f60\u7684\u7535\u8111\u4e0a\u8def\u5f84\u4e0d\u540c\uff0c\u4fee\u6539\u8fd9\u91cc\u7684\u5b8f\u5b9a\u4e49\u5c31\u884c\u3002</p> <p>\u5982\u679c\u5bf9 CMake \u7684\u64cd\u4f5c\u4e0d\u719f\u6089\u7684\u8bdd\uff0c\u5efa\u8bae\u9605\u8bfb\u4e4b\u524d\u5199\u8fc7\u7684\u6587\u7ae0\uff0c\u6db5\u76d6\u4e86\u5f88\u591a\u57fa\u7840\u64cd\u4f5c\u3002 Android NDK \u5f00\u53d1\u4e4b CMake \u5fc5\u77e5\u5fc5\u4f1a</p> <p>\u5f53\u4e0b\u8f7d\u4e86 SDL_Image \u4e4b\u540e\uff0c\u627e\u5230\u5b83\u7684\u8def\u5f84\uff0c\u628a\u5b83\u7684\u5e93\u52a0\u8f7d\u5230 CMake \u94fe\u63a5\u76ee\u5f55\u4e2d\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u8c03\u7528 <code>link_directories</code> \u65b9\u6cd5\uff0c\u8fd9\u91cc\u540c\u6837\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u5b8f\uff1a</p> <pre><code>macro(link_sdl_image)\n    message(\"link sdl image library and path is ${sdl_image_dir}\")\n    include_directories(${sdl_image_dir}/include/SDL2)\n    link_directories(${sdl_image_dir}/lib)\nendmacro()\n</code></pre> <p>\u4e4b\u540e\u5c31\u9700\u8981\u628a\u76ee\u6807\u6267\u884c\u6587\u4ef6\u6216\u8005\u76ee\u6807\u5e93\u4e0e SDL_Image \u5f00\u6e90\u5e93\u5173\u8054\u8d77\u6765\uff0c\u4e5f\u5c31\u662f <code>target_link_libraries</code> \u65b9\u6cd5\uff0c\u540c\u6837\u5b9a\u4e49\u4e00\u4e2a\u5b8f\uff1a</p> <pre><code>macro(target_link_sdl_image name)\n    message(\"${name} link sdl image\")\n    target_link_libraries(${name}\n            SDL2_image\n            )\nendmacro()\n</code></pre> <p>\u8fd9\u4e2a\u5b8f\u6709\u4e2a\u53c2\u6570 <code>name</code> \uff0c\u5b83\u5c31\u662f\u8981\u94fe\u63a5\u7684\u76ee\u6807\u6587\u4ef6 target \u3002</p> <p>\u5bf9\u4e8e SDL \u5e93\u6216\u8005\u5176\u4ed6\u5e93\uff0c\u4e5f\u53ef\u4ee5\u521b\u5efa\u7c7b\u4f3c\u7684\u5b8f\uff0c\u5177\u4f53\u5728\u6e90\u7801\u4e2d\u80fd\u770b\u5230\u3002</p> <p>\u5728\u5b8c\u6210\u4e86 SDL_Image \u7684 CMake \u914d\u7f6e\u4e4b\u540e\uff0c\u5c31\u9700\u8981\u5728\u5de5\u7a0b\u7684\u4e3b <code>CMakeLists.txt</code> \u6587\u4ef6\u4e2d\u628a\u5b83\u5305\u542b\u8fdb\u53bb\uff0c\u73b0\u5728\u8fd8\u53ea\u662f\u5728 <code>cmake_utils</code> \u76ee\u5f55\u4e2d\uff0c\u8fd9\u6837\u662f\u5f15\u7528\u4e0d\u5230\u5b8f\u7684\u3002</p> <p>\u901a\u8fc7 <code>add_subdirectory</code> \u65b9\u6cd5\u5c06\u5b9a\u4e49\u7684\u529f\u80fd\u6dfb\u52a0\u8fdb\u6765\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002</p> <p></p> <p>\u540c\u65f6\uff0c\u5bf9\u4e8e SDL \u9879\u76ee\u4ee3\u7801\uff0c\u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\u53bb\u5b58\u653e\uff0c\u518d\u6839\u636e\u6bcf\u4e2a\u5c0f\u9879\u53c8\u5212\u5206\u6587\u4ef6\u5939\uff1a</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u9488\u5bf9\u6bcf\u4e2a\u5c0f\u9879\u53c8\u6709\u5355\u72ec\u7684 <code>CMakeLists.txt</code> \u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u91cc\u9762\u6309\u9700\u6267\u884c\u52a8\u6001\u5e93\u7684\u5173\u8054\u5c31\u597d\u4e86\u3002</p> <p>\u7ecf\u8fc7\u4ee5\u4e0a\u7684\u5de5\u7a0b\u914d\u7f6e\u6574\u6539\uff0c\u5bf9\u4e8e\u540e\u7eed\u7684\u5f00\u53d1\u6a21\u5757\u5212\u5206\u662f\u5f88\u6709\u5e2e\u52a9\u7684\uff0c\u4e0d\u4ec5\u4fbf\u4e8e\u6dfb\u52a0\u5404\u79cd\u5f00\u6e90\u5e93\uff0c\u66f4\u5229\u4e8e\u53bb\u5355\u4e2a\u7f16\u8bd1\u9879\u76ee\u3002</p> <p>\u540e\u7eed\u6dfb\u52a0\u7684\u5e93\u90fd\u4f1a\u6309\u7167\u8fd9\u4e2a\u6a21\u5f0f\u8fdb\u884c\u6dfb\u52a0\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-004/#sdl_image","title":"SDL_Image \u52a0\u8f7d \u56fe\u7247\u5e76\u663e\u793a","text":"<p>\u5b8c\u6210\u4e86\u914d\u7f6e\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c SDL_Image \u7684\u5f00\u53d1\u4e86\uff0c\u6574\u4e2a\u5f00\u53d1\u6d41\u7a0b\u6bd4\u8f83\u7b80\u5355\u3002</p> <p>\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u6211\u4eec\u521b\u5efa\u5e76\u5c55\u793a\u4e86 <code>SDL_Window</code>\uff0cSDL_Window \u5185\u6709\u4e00\u4e2a\u53eb\u505a <code>SDL_Surface</code> \u7684\u7ed3\u6784\uff0c\u5b9e\u9645\u4e0a\u5b83\u624d\u662f\u6700\u7ec8\u6e32\u67d3\u5c55\u793a\u7684\u3002</p> <p>\u6211\u4eec\u52a0\u8f7d\u4e00\u5f20\u56fe\u7247\uff0c\u5e76\u5c06\u56fe\u7247\u8f6c\u6362\u6210 <code>SDL_Surface</code> \uff0c\u7136\u540e\u628a\u56fe\u7247\u5bf9\u5e94\u7684 SDL_Surface \u8f6c\u6362\u5230 SDL_Window \u5bf9\u5e94\u7684 SDL_Surface \uff0c\u518d\u66f4\u65b0\u4e00\u4e0b SDL_Window \u7684 SDL_Surface \u5185\u5bb9\uff0c\u6e32\u67d3\u5230\u5c4f\u5e55\u5c31\u597d\u4e86\u3002</p> <p>\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>    // \u5f97\u5230 SDL_Window \u7684 SDL_Surface\n    SDL_Surface *pWindowSurface = SDL_GetWindowSurface(pWindow);\n    // \u6839\u636e\u56fe\u7247\u521b\u5efa\u4e00\u4e2a SDL_Surface\n    SDL_Surface *pImageSurface = IMG_Load(image_path.c_str());\n    bool bQuit = false;\n    SDL_Event windowEvent;\n    while (!bQuit){\n        while (SDL_PollEvent(&amp;windowEvent)){\n            switch (windowEvent.type){\n                case SDL_QUIT:\n                    bQuit = true;\n                    break;\n                default:\n                    break;\n            }\n        }\n        // \u5c06 pImageSurface \u7684\u5185\u5bb9\u4f20\u8f93\u5230 \u4e0a\n        SDL_BlitSurface(pImageSurface, nullptr,pWindowSurface,nullptr);\n        // \u4e0a\u5c4f\u64cd\u4f5c\uff0c\u5c06 Surface \u5185\u5bb9\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\n        SDL_UpdateWindowSurface(pWindow);\n    }\n</code></pre> <p>\u6700\u7ec8\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p>","tags":["SDL"]},{"location":"sdl/av-beginner-004/#_1","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u8fde\u8f7d\u7684 <code>004</code> \u7bc7\u3002</p> <p>\u5b8c\u6210\u4e86 SDL \u52a0\u8f7d\u56fe\u7247\u5e76\u663e\u793a\u7684\u6d41\u7a0b\uff0c\u6574\u4f53\u4ee3\u7801\u6bd4\u8f83\u7b80\u5355\uff0c\u5f88\u591a\u4e1c\u897f\u90fd\u662f\u4e4b\u524d\u6587\u7ae0\u63d0\u5230\u8fc7\u7684\uff0c\u53cd\u800c\u91cd\u70b9\u66f4\u4fa7\u91cd\u4e8e\u5de5\u7a0b\u7684 CMake \u914d\u7f6e\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u770b\u770b\u4ee3\u7801\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u672c\u7bc7\u6587\u7ae0\u5bf9\u5e94\u7684\u63d0\u4ea4 <code>tag</code> \u4e3a <code>av-beginner-004</code>\uff0c\u53ef\u5207\u6362\u81f3\u5bf9\u5e94\u6e90\u7801\u67e5\u770b\u3002</p> <p>\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4e0d\u5bf9\u4e4b\u5904\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u8fdb\u884c\u4ea4\u6d41~~</p>","tags":["SDL"]},{"location":"sdl/av-beginner-005/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-005\u3011\u57fa\u7840\u5b66\u4e60\u7bc7-SDL \u52a0\u8f7d YUV \u6587\u4ef6\u5e76\u663e\u793a","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u5df2\u7ecf\u5b8c\u6210\u4e86\u56fe\u7247\u7684\u52a0\u8f7d\u548c\u663e\u793a\uff0c\u63a5\u4e0b\u6765\u8981\u505a\u7684\u5c31\u662f\u52a0\u8f7d YUV \u6587\u4ef6\u5e76\u663e\u793a\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-005/#yuv","title":"YUV \u6587\u4ef6\u7d20\u6750\u51c6\u5907","text":"<p>\u505a\u8fd9\u4e2a\u529f\u80fd\u70b9\u6bd4\u8f83\u9ebb\u70e6\u7684\u662f\u7d20\u6750\u95ee\u9898\uff0c\u4e0a\u54ea\u53bb\u627e\u4e00\u4e2a YUV \u6587\u4ef6\u51fa\u6765\uff0c\u8c37\u6b4c\u548c\u767e\u5ea6\u641c\u7d22\u90fd\u4e0d\u597d\u4f7f\uff0c\u5176\u5b9e\u76f4\u63a5\u4f7f\u7528 FFmpeg \u751f\u6210\u6587\u4ef6\u5c31\u597d\u4e86\u3002</p> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5c06\u56fe\u7247\u6587\u4ef6\u8f6c\u6210 YUV \u6587\u4ef6\uff1a</p> <pre><code>// \u628a filename \u6539\u4e3a\u56fe\u7247\u5bf9\u5e94\u7684\u6587\u4ef6\u540d\nffmpeg -i image_filename.png -pix_fmt yuv420p yuv_filename.yuv\n</code></pre> <p>\u5728\u8fd9\u91cc\u5c06 YUV \u6587\u4ef6\u683c\u5f0f\u56fa\u5b9a\u4e3a <code>YUV420P</code> \u4e86\uff0c\u5982\u679c\u4f60\u5bf9 YUV \u683c\u5f0f\u4e0d\u61c2\u7684\u8bdd\uff0c\u5f3a\u70c8\u5efa\u8bae\u770b\u770b\u6211\u4e4b\u524d\u5199\u8fc7\u7684\u6587\u7ae0\uff0c\u56fe\u6587\u5e76\u8302\uff0c\u6e05\u6670\u6613\u61c2\uff0c\u4f7f\u7528\u8c37\u6b4c\u641c\u7d22 YUV \u5173\u952e\u5b57\uff0c\u641c\u7d22\u7ed3\u679c\u6392\u540d\u524d\u4e94\u7684\u5fc5\u6709\u6211\u8fd9\u7bc7\u6587\u7ae0\u3002</p> <p>\u4e00\u6587\u8bfb\u61c2 YUV \u7684\u91c7\u6837\u4e0e\u683c\u5f0f</p> <p>\u987a\u4fbf\u53ef\u4ee5\u4f7f\u7528 FFplay \u9a8c\u8bc1\u751f\u6210\u7684 YUV \u6587\u4ef6\u662f\u5426\u6709\u6548\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>// 100x100 \u4ee3\u8868\u56fe\u7247\u7684\u5bbd\u9ad8\uff0c\u8fd9\u91cc\u53ea\u662f\u4e3e\u4f8b\uff0c\u6362\u6210\u5b9e\u9645\u7684\u5bbd\u9ad8\n// \u628a filename \u6539\u4e3a YUV \u5bf9\u5e94\u7684\u6587\u4ef6\u540d\nffplay -f rawvideo -video_size  100x100 yuv_filename.yuv\n</code></pre> <p>\u4ee5\u4e0a\u547d\u4ee4\u4f1a\u6253\u5f00\u4e00\u4e2a\u7a97\u53e3\u53bb\u5c55\u793a\u56fe\u7247\uff0c\u5982\u679c\u8be5\u56fe\u7247\u548c\u672a\u8f6c\u6362\u6210 YUV \u7684\u56fe\u7247\u5185\u5bb9\u4e00\u81f4\uff0c\u90a3\u8bf4\u660e\u628a\u56fe\u7247\u8f6c\u6362\u6210 YUV \u683c\u5f0f\u6587\u4ef6\u662f\u6210\u529f\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u4e86\u5b9e\u9a8c\u7d20\u6750\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-005/#_1","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u6709\u4e86\u7d20\u6750\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4ee3\u7801\u5b9e\u8df5\u73af\u8282\uff1a</p>","tags":["SDL"]},{"location":"sdl/av-beginner-005/#sdl_texture","title":"\u521b\u5efa\u7eb9\u7406 SDL_Texture","text":"<p>\u4e0e SDL \u663e\u793a\u56fe\u7247\u7684\u65b9\u5f0f\u6709\u4e9b\u4e0d\u540c\uff0c\u663e\u793a\u56fe\u7247\u662f\u5c06\u56fe\u7247\u8f6c\u6362\u6210\u4e86 SDL_Surface\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a SDL_Surface \u7684\u5185\u5bb9\u8f6c\u6362\u5230 SDL_Window \u5bf9\u5e94\u7684 SDL_Surface \u4e0a\uff0c\u6700\u540e\u4e0a\u5c4f\u5c31\u663e\u793a\u56fe\u7247\u4e86\u3002</p> <p>\u663e\u793a YUV \u6587\u4ef6\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u7eb9\u7406\uff0c\u7136\u540e\u5c06\u7eb9\u7406\u5185\u5bb9\u6e32\u67d3\u4e0a\u5c4f\uff0c\u8fd9\u7c7b\u4f3c\u4e8e OpenGL \u7684\u64cd\u4f5c\u4e86\u3002</p> <p>\u9996\u5148\u901a\u8fc7 <code>SDL_CreateTexture</code> \u65b9\u6cd5\u521b\u5efa <code>SDL_Texture</code>\uff1a</p> <pre><code>SDL_CreateTexture(SDL_Renderer * renderer,\n                Uint32 format,\n                int access, int w,\n                int h);\n</code></pre> <p>\u53c2\u6570 <code>renderer</code> \u662f\u4e4b\u524d\u6587\u7ae0\u63d0\u5230\u7684\u521b\u5efa\u6e32\u67d3\u5668\uff0c<code>w</code> \u548c <code>h</code> \u662f\u7eb9\u7406\u7684\u5bbd\u9ad8\uff0c\u91cd\u70b9\u662f <code>format</code> \u53c2\u6570\u3002</p> <p>\u6839\u636e\u6587\u4ef6\u683c\u5f0f\u7684\u4e0d\u540c\uff0c<code>format</code> \u53c2\u6570\u4e5f\u4e0d\u540c\uff0c\u6bd4\u5982\u8fd9\u91cc\u6587\u4ef6\u662f <code>YUV420P</code>\uff0c\u90a3\u4e48\u5bf9\u5e94\u7684\u5c31\u662f <code>IYUV</code>.</p> <p>\u66f4\u591a\u683c\u5f0f\u53ef\u4ee5\u53c2\u8003 <code>SDL_pixels.h</code> \u6587\u4ef6\u4e2d\u5b9a\u4e49\uff0c\u6458\u5f55\u90e8\u5206\u5982\u4e0b\uff1a</p> <pre><code>    SDL_PIXELFORMAT_UYVY =      /**&lt; Packed mode: U0+Y0+V0+Y1 (1 plane) */\n        SDL_DEFINE_PIXELFOURCC('U', 'Y', 'V', 'Y'),\n    SDL_PIXELFORMAT_YVYU =      /**&lt; Packed mode: Y0+V0+Y1+U0 (1 plane) */\n        SDL_DEFINE_PIXELFOURCC('Y', 'V', 'Y', 'U'),\n    SDL_PIXELFORMAT_NV12 =      /**&lt; Planar mode: Y + U/V interleaved  (2 planes) */\n        SDL_DEFINE_PIXELFOURCC('N', 'V', '1', '2'),\n    SDL_PIXELFORMAT_NV21 =      /**&lt; Planar mode: Y + V/U interleaved  (2 planes) */\n        SDL_DEFINE_PIXELFOURCC('N', 'V', '2', '1'),\n    SDL_PIXELFORMAT_EXTERNAL_OES =      /**&lt; Android video texture format */\n        SDL_DEFINE_PIXELFOURCC('O', 'E', 'S', ' ')\n</code></pre>","tags":["SDL"]},{"location":"sdl/av-beginner-005/#_2","title":"\u6253\u5f00\u6587\u4ef6\u5e76\u8bfb\u53d6\u5185\u5bb9","text":"<p>\u63a5\u4e0b\u6765\u5c31\u662f\u6253\u5f00\u6587\u4ef6\u64cd\u4f5c\u4e86\uff0c\u76f4\u63a5\u6839\u636e C \u8bed\u8a00\u91cc\u9762\u76f8\u5173\u65b9\u6cd5\u8c03\u7528\u5c31\u884c\u3002</p> <pre><code>    // \u6253\u5f00\u6587\u4ef6\n    FILE *pFile = fopen(path.c_str(), \"rb\");\n    // \u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u5230 buffer \u4e2d\n    unsigned char *yuv_data;\n    // yuv420p \u683c\u5f0f\u7684\u6587\u4ef6\u5927\u5c0f\n    int frameSize = width * height * 3 / 2;\n    yuv_data = static_cast&lt;unsigned char *&gt;(malloc(frameSize * sizeof(unsigned char)));\n    fread(yuv_data,1,frameSize,pFile);\n    // \u5173\u95ed\u6587\u4ef6\n    fclose(pFile);\n</code></pre> <p>\u6253\u5f00\u6587\u4ef6\uff0c\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u6ce8\u610f <code>YUV420P</code> \u683c\u5f0f\u6587\u4ef6\u5927\u5c0f\u7684\u8ba1\u7b97\u65b9\u5f0f\u662f <code>width * height * 3 / 2</code> \uff0c\u5b83\u6bd4\u6b63\u5e38\u7684 <code>RGBA</code> \u683c\u5f0f\u6587\u4ef6\u8981\u5c0f\u4e00\u70b9\u7684\u3002</p> <p>\u56e0\u4e3a\u8bfb\u53d6\u4e86\u6587\u4ef6\u5185\u5bb9\u4e4b\u540e\uff0c\u540e\u7eed\u4e5f\u5c31\u7528\u4e0d\u5230\u4e86\uff0c\u76f4\u63a5 fclose \u5173\u95ed\u6389\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-005/#_3","title":"\u6e32\u67d3\u7eb9\u7406\u4e0a\u5c4f","text":"<p>\u6709\u4e86\u7eb9\u7406\uff0c\u4e5f\u6709\u4e86 YUV \u6587\u4ef6\u5185\u5bb9\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u628a YUV \u6587\u4ef6\u5185\u5bb9\u8f6c\u6362\u5230\u7eb9\u7406\u4e0a\uff0c\u5728\u628a\u7eb9\u7406\u6e32\u67d3\u4e0a\u5c4f\u3002</p> <pre><code>    if (texture != nullptr){\n        SDL_Event windowEvent;\n        while (true){\n            if (SDL_PollEvent(&amp;windowEvent)){\n                if (SDL_QUIT == windowEvent.type){\n                    break;\n                }\n            }\n            // \u66f4\u65b0\u7eb9\u7406\u5185\u5bb9\uff0c\u5c31\u662f\u628a\u8bfb\u53d6\u7684 YUV \u6570\u636e\u8f6c\u6362\u6210\u7eb9\u7406\n            SDL_UpdateTexture(texture, nullptr,yuv_data,width);\n            // \u6e05\u5c4f\u64cd\u4f5c\n            SDL_RenderClear(renderer);\n            // \u5c06\u6307\u5b9a\u7eb9\u7406\u590d\u5236\u5230\u8981\u6e32\u67d3\u7684\u5730\u65b9\n            SDL_RenderCopy(renderer,texture, nullptr, nullptr);\n            // \u4e0a\u5c4f\u64cd\u4f5c\n            SDL_RenderPresent(renderer);\n        }\n        SDL_DestroyWindow(window);\n        SDL_Quit();\n    }\n</code></pre> <p>\u9996\u5148\u8c03\u7528 <code>SDL_UpdateTexture</code> \u65b9\u6cd5\u5c06 YUV \u5185\u5bb9\u8f6c\u6362\u6210\u7eb9\u7406\uff0c\u7136\u540e <code>SDL_RenderClear</code> \u6e05\u5c4f\u64cd\u4f5c\uff0cOpenGL \u76f8\u5173\u7684\u6e32\u67d3\u4e5f\u662f\u8981\u6e05\u5c4f\u64cd\u4f5c\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\u5c06 <code>SDL_Texture</code> \u62f7\u8d1d\u5230\u8981\u6e32\u67d3\u7684\u5730\u65b9\uff0c\u7136\u540e <code>SDL_RenderPresent</code> \u6267\u884c\u4e0a\u5c4f\u64cd\u4f5c\u5c31\u884c\u4e86\u3002</p> <p>\u6e32\u67d3\u7eb9\u7406\u4e0a\u5c4f\u7684\u64cd\u4f5c\u6d41\u7a0b\u57fa\u672c\u90fd\u662f\u8fd9\u6837\u4e86\uff0c\u6839\u636e\u6587\u4ef6\u683c\u5f0f\u7684\u4e0d\u540c\uff0c\u8f6c\u6362\u6210\u7eb9\u7406\u7684\u65b9\u5f0f\u4e5f\u6709\u4e0d\u540c\uff0c\u9664\u4e86 <code>SDL_UpdateTexture</code> \u65b9\u6cd5\u4e4b\u5916\uff0c\u8fd8\u6709 <code>SDL_UpdateYUVTexture</code> \u65b9\u6cd5\uff0c\u540e\u9762\u4f1a\u9047\u5230\u7684\u3002</p> <p>\u6700\u540e\u522b\u5fd8\u4e86\u91ca\u653e\u548c\u9500\u6bc1\u76f8\u5e94\u7684\u6307\u9488\u548c\u53d8\u91cf\u3002</p> <p>\u8fd0\u884c\u7a0b\u5e8f\u5c31\u4f1a\u770b\u5230\u6253\u5f00\u4e00\u4e2a\u7a97\u53e3\uff0c\u663e\u793a\u4e00\u5f20\u56fe\u7247\uff0c\u548c\u4e4b\u524d\u7528 FFmpeg \u663e\u793a\u7684\u56fe\u7247\u5185\u5bb9\u4e00\u81f4\u3002</p> <p></p>","tags":["SDL"]},{"location":"sdl/av-beginner-005/#_4","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u8fde\u8f7d\u7684 <code>005</code> \u7bc7\u3002</p> <p>\u5185\u5bb9\u76f8\u5bf9\u6bd4\u8f83\u7b80\u5355\uff0c\u5bf9\u4e8e SDL \u63a5\u53e3\u7684\u4e00\u4e9b\u8c03\u7528\u4e5f\u4e0d\u7b97\u96be\u3002\u5b9e\u9645\u4e0a\u5e76\u4e0d\u7528\u592a\u6df1\u7a76 SDL \u7684\u63a5\u53e3\u673a\u5236\u548c\u5b9e\u73b0\u539f\u7406\uff0c\u505a\u4e00\u4e9b\u5b9e\u9a8c\u6027\u5165\u95e8\u57fa\u7840\u529f\u80fd\u4f1a\u7528\u597d\u4e86\uff0c\u6bd5\u7adf\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\u4e0d\u592a\u4f1a\u7528\u5230\u3002</p> <p>\u53e6\u5916\uff0c\u65e2\u7136\u5df2\u7ecf\u53ef\u4ee5\u663e\u793a\u4e00\u5f20 YUV \u5e27\u5185\u5bb9\u4e86\uff0c\u90a3\u4e48\u5047\u5982\u662f\u4e00\u4e2a YUV \u89c6\u9891\u6587\u4ef6\u53c8\u8be5\u5982\u4f55\u663e\u793a\u4e86\uff1f\u60f3\u77e5\u540e\u4e8b\u5982\u4f55\uff0c\u8bf7\u770b\u4e0b\u56de\u5206\u89e3\u3002</p> <p>\u672c\u6587\u5177\u4f53\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u672c\u7bc7\u6587\u7ae0\u5bf9\u5e94\u7684\u63d0\u4ea4 <code>tag</code> \u4e3a <code>av-beginner-004</code>\uff0c\u53ef\u5207\u6362\u81f3\u5bf9\u5e94\u6e90\u7801\u67e5\u770b\u3002</p> <p>\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4e0d\u5bf9\u4e4b\u5904\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u8fdb\u884c\u4ea4\u6d41~~</p>","tags":["SDL"]},{"location":"sdl/av-beginner-006/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-006\u3011\u57fa\u7840\u5b66\u4e60\u7bc7-SDL \u64ad\u653e YUV \u89c6\u9891\u6587\u4ef6","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u52a0\u8f7d YUV \u5e27\u5e76\u663e\u793a\u4e86\uff0c\u90a3\u662f\u628a\u4e00\u5f20\u56fe\u7247\u8f6c\u6362\u6210 YUV \u5e27\u5f97\u5230\u7684\u7d20\u6750\u3002</p> <p>\u5982\u679c\u662f\u4e00\u4e2a YUV \u89c6\u9891\u6587\u4ef6\u7684\u8bdd\uff0c\u90a3\u5c31\u662f\u5f88\u591a YUV \u5e27\u8fde\u7eed\u5728\u4e00\u8d77\uff0c\u65e2\u7136\u80fd\u5c55\u793a\u4e00\u5e27\uff0c\u90a3\u80af\u5b9a\u53ef\u4ee5\u8fde\u7eed\u5c55\u793a\u591a\u5e27\u3002</p> <p>\u63a5\u4e0b\u6765\u5c31\u8981\u8fd9\u6837\u7684\u64cd\u4f5c\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-006/#yuv","title":"YUV \u89c6\u9891\u6587\u4ef6\u7d20\u6750","text":"<p>\u8fd8\u662f\u8981\u51c6\u5907\u4e00\u4e0b YUV \u89c6\u9891\u7d20\u6750\uff0c\u4e0d\u7528\u7f51\u4e0a\u5230\u5904\u53bb\u4e0b\u8f7d\uff0c\u7528 FFmpeg \u547d\u4ee4\u5c06 <code>mp4</code> \u6587\u4ef6\u8f6c\u6362\u6210 <code>yuv</code> \u6587\u4ef6\u5c31\u597d\u4e86\u3002</p> <pre><code>ffmpeg -i file_name.mp4 filename.yuv\n</code></pre> <p>\u547d\u4ee4\u5f88\u7b80\u5355\uff0c\u5176\u4e2d <code>file_name</code> \u662f\u6587\u4ef6\u7684\u540d\u79f0\uff0c\u4f7f\u7528\u65f6\u8bb0\u5f97\u66ff\u6362\u3002</p> <p>\u7531\u4e8e\u751f\u6210\u7684 yuv \u6587\u4ef6\u662f\u672a\u7ecf\u8fc7\u538b\u7f29\u7684\uff0c\u6587\u4ef6\u8fc7\u5927\u4e0d\u65b9\u4fbf\u4f20 Github \uff0c\u6240\u4ee5\u5728\u7a0b\u5e8f\u8fd0\u884c\u524d\u8981\u81ea\u5df1\u53bb\u751f\u6210\u4e00\u4e0b\u6587\u4ef6\u3002</p> <p>\u540c\u6837\uff0c\u4e5f\u53ef\u4ee5\u7528 <code>ffplay</code> \u9a8c\u8bc1\u4e00\u4e0b yuv \u6587\u4ef6\u8f6c\u6362\u662f\u5426\u6b63\u786e\u3002</p> <pre><code>ffplay -f rawvideo -video_size  100x100 yuv_filename.yuv\n</code></pre> <p>\u4ee5\u4e0a\u547d\u4ee4\u4f1a\u6253\u5f00\u4e00\u4e2a\u7a97\u53e3\u53bb\u64ad\u653e\u89c6\u9891\u5185\u5bb9\uff0c\u5982\u679c\u64ad\u653e\u7684\u548c\u539f\u6765 mp4 \u6587\u4ef6\u5185\u5bb9\u4e00\u81f4\uff0c\u8bf4\u660e\u8f6c\u6362\u662f\u6210\u529f\u7684\uff0cYUV \u6587\u4ef6\u53ef\u7528\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-006/#_1","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u63a5\u4e0b\u6765\u5c31\u662f\u4ee3\u7801\u5b9e\u8df5\u73af\u8282\uff0c\u5f88\u591a\u5730\u65b9\u548c\u524d\u4e00\u7bc7\u6587\u7ae0\u52a0\u8f7d YUV \u6587\u4ef6\u5e76\u663e\u793a \u662f\u7c7b\u4f3c\u7684\u3002</p> <pre><code>    // \u6253\u5f00\u6587\u4ef6 \u548c \u521b\u5efa\u7eb9\u7406 \u7684\u4ee3\u7801\u548c\u524d\u4e00\u7bc7\u4e00\u6837\uff0c\u4e0d\u5728\u653e\u4e0a\u6765\u4e86\n    if (texture != nullptr){\n        SDL_Event windowEvent;\n        while (true){\n            if (SDL_PollEvent(&amp;windowEvent)){\n                if (SDL_QUIT == windowEvent.type){\n                    break;\n                }\n            }\n            // \u8bfb\u53d6\u5185\u5bb9\n            if (fread(yuv_data,1,frameSize,pFile) != frameSize){\n                // \u8bfb\u53d6\u5185\u5bb9\u5c0f\u4e8e frameSize \uff0cseek \u5230 0 \uff0c\u91cd\u65b0\u8bfb\u53d6\uff0c\u7c7b\u4f3c\u4e8e\u91cd\u64ad\n                fseek(pFile,0,SEEK_SET);\n                fread(yuv_data,1,frameSize,pFile);\n            }\n            //\n            SDL_UpdateTexture(texture, nullptr,yuv_data,width);\n            SDL_RenderClear(renderer);\n            SDL_RenderCopy(renderer,texture, nullptr, nullptr);\n            SDL_RenderPresent(renderer);\n        }\n        SDL_DestroyWindow(window);\n        SDL_Quit();\n    }\n</code></pre> <p>\u6253\u5f00\u6587\u4ef6\u548c\u521b\u5efa\u7eb9\u7406\u4ee3\u7801\u5185\u5bb9\u548c\u524d\u9762\u7684\u4e00\u81f4\uff0c\u5c31\u4e0d\u91cd\u65b0\u8d34\u51fa\u6765\u4e86\u3002</p> <p>YUV \u5185\u5bb9\u8f6c\u7eb9\u7406\u4ee5\u53ca\u6e32\u67d3\u7eb9\u7406\u4e0a\u5c4f\u7684\u64cd\u4f5c\u4e5f\u662f\u4e00\u6837\u7684\u3002</p> <p>\u4e0d\u540c\u7684\u662f\uff0c\u8bfb\u53d6 buffer \u7684\u64cd\u4f5c\u653e\u5728\u4e86 while \u91cc\u9762\u3002</p> <p>\u5982\u679c\u5bf9 SDL \u7684\u6d88\u606f\u5faa\u73af\u548c\u4e8b\u4ef6\u54cd\u5e94\u8fd8\u8bb0\u5f97\u7684\u8bdd\uff0c\u5c31\u80fd\u660e\u767d\u6bcf\u5f53 SDL_PollEvent \u4ece\u6d88\u606f\u961f\u5217\u4e2d\u53d6\u51fa\u4e00\u4e2a\u6d88\u606f\uff0c\u53ea\u8981\u4e0d\u662f\u9000\u51fa\u4e8b\u4ef6\uff0c\u5c31\u4f1a\u4ece YUV \u6587\u4ef6\u4e2d\u8bfb\u53d6 Buffer \u5e76\u628a\u5b83\u8f6c\u6210\u7eb9\u7406\u6e32\u67d3\u4e0a\u5c4f\u3002</p> <p>\u5982\u679c\u8bfb\u53d6\u7684 Buffer \u5185\u5bb9\u5c0f\u4e8e\u4e00\u5e27 YUV \u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u5c31\u4f1a  Seek \u5230\u6587\u4ef6\u5f00\u5934\u7684\u4f4d\u7f6e\uff0c\u91cd\u65b0\u8bfb\u53d6\uff0c\u7c7b\u4f3c\u4e8e\u91cd\u64ad\u4e86\u3002\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u4e0d\u91cd\u64ad\uff0c\u76f4\u63a5\u9000\u51fa\u3002</p> <p>\u4ee5\u4e0b\u5c31\u662f\u5b9e\u9645\u7684\u8fd0\u884c\u6548\u679c\uff1a</p> <p>\u4ee5\u4e0a\u7684\u4ee3\u7801\u8fd8\u662f\u5b58\u5728\u95ee\u9898\u7684\uff0c\u6bd4\u5982 YUV \u89c6\u9891\u64ad\u653e\u7684\u5f88\u5feb\uff0c\u6bd4\u539f\u6765\u7684 mp4 \u64ad\u653e\u5feb\u591a\u4e86\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u64ad\u653e\u7684\u901f\u7387\u63a7\u5236\u5b8c\u5168\u662f\u6839\u636e SDL_PollEvent \u4e8b\u4ef6\u54cd\u5e94\u7684\u901f\u5ea6\u6765\u7684\uff0c\u800c\u4e0d\u662f\u6839\u636e mp4 \u7684\u5e27\u7387\u6765\u64ad\u653e\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49 SDL \u4e8b\u4ef6\uff0c\u7136\u540e\u6839\u636e\u5e27\u7387\u63a7\u5236\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u7684\u53d1\u9001\u901f\u7387\uff0c\u5b9e\u73b0\u63a7\u5236\u64ad\u653e\u901f\u5ea6\u7684\u76ee\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u8fd9\u91cc\u6709\u5f88\u591a\u53c2\u6570\u90fd\u662f\u4e8b\u5148\u77e5\u9053\u7684\uff0c\u6bd4\u5982\u89c6\u9891\u5bbd\u9ad8\u6570\u636e\uff0c\u5728\u540e\u9762\u6211\u4eec\u5c06\u901a\u8fc7 FFmpeg \u6765\u5f97\u5230\u8fd9\u4e9b\u6570\u636e\uff0c\u5b9e\u5728\u771f\u6b63\u7684\u89e3\u7801\u64ad\u653e\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-006/#_2","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u8fde\u8f7d\u7684 <code>006</code> \u7bc7\u3002</p> <p>\u5728\u5b9e\u73b0\u52a0\u8f7d YUV \u5e27\u5e76\u663e\u793a\u7684\u57fa\u7840\u4e0a\uff0c\u5f88\u5bb9\u6613\u5c31\u5b9e\u73b0\u64ad\u653e YUV \u89c6\u9891\u6587\u4ef6\u4e86\u3002</p> <p>\u672c\u6587\u5177\u4f53\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u672c\u7bc7\u6587\u7ae0\u5bf9\u5e94\u7684\u63d0\u4ea4 <code>tag</code> \u4e3a <code>av-beginner-004</code>\uff0c\u53ef\u5207\u6362\u81f3\u5bf9\u5e94\u6e90\u7801\u67e5\u770b\u3002</p> <p>\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4e0d\u5bf9\u4e4b\u5904\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u8fdb\u884c\u4ea4\u6d41~~</p>","tags":["SDL"]},{"location":"sdl/av-beginner-007/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-007\u3011\u57fa\u7840\u5b66\u4e60\u7bc7-SDL \u64ad\u653e PCM \u97f3\u9891\u6587\u4ef6\uff08\u4e0a\uff09","text":"<p>\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u5df2\u7ecf\u80fd\u591f\u5229\u7528 SDL \u53bb\u64ad\u653e YUV \u89c6\u9891\u6587\u4ef6\u4e86\uff0c\u63a5\u4e0b\u6765\u8981\u901a\u8fc7 SDL \u53bb\u64ad\u653e PCM \u97f3\u9891\u6587\u4ef6\u3002</p> <p>SDL \u64ad\u653e\u97f3\u9891\u6587\u4ef6\u6709\u4e24\u79cd\u65b9\u6cd5\uff0c\u53ef\u4ee5\u7406\u89e3\u6210 <code>\u63a8(push)</code>\u548c<code>\u62c9(pull)</code>\u4e24\u79cd\u6a21\u5f0f\u3002</p> <p><code>\u63a8</code> \u5c31\u662f\u6211\u4eec\u4e3b\u52a8\u5411\u8bbe\u5907\u7f13\u51b2\u533a\u586b\u5145 Buffer \uff0c\u800c <code>\u62c9</code> \u5c31\u662f\u7531\u8bbe\u5907\u62c9\u53d6 Buffer \u586b\u5145\u5230\u7f13\u51b2\u533a\u3002</p> <p>\u5728\u4e00\u4e9b\u5f00\u53d1\u6a21\u578b\u4e2d\uff0c\u5982\u679c\u6570\u636e\u4f20\u9012\u80fd\u591f\u62bd\u8c61\u6210<code>\u6d41</code>\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u80af\u5b9a\u5c31\u4f1a\u6709<code>\u63a8</code>\u548c<code>\u62c9</code>\u4e24\u79cd\u6a21\u5f0f\u3002</p> <p>\u672c\u7bc7\u6587\u7ae0\u4e3b\u8981\u662f\u8bb2\u89e3 SDL \u4ee5\u63a8\u7684\u5f62\u5f0f\u64ad\u653e\u97f3\u9891\u6587\u4ef6\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-007/#pcm","title":"PCM \u6587\u4ef6\u7d20\u6750\u51c6\u5907","text":"<p>\u9996\u5148\u8fd8\u662f\u5f97\u51c6\u5907\u7d20\u6750\uff0c\u505a\u97f3\u89c6\u9891\u76f8\u5173\u5b9e\u9a8c\u5c31\u662f\u8fd9\u4e48\u9ebb\u70e6~~</p> <p>\u627e\u4e00\u4e2a mp3 \u6587\u4ef6\uff0c\u4f7f\u7528 FFmpeg \u547d\u4ee4\u5c06\u5b83\u8f6c\u6362\u6210 pcm \u6587\u4ef6\uff0c\u65b9\u4fbf\u7684\u8bdd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4ee3\u7801\u4ed3\u5e93\u63d0\u4f9b\u7684 mp3 \u6587\u4ef6\u3002</p> <p>\u4e0d\u50cf\u5728\u89c6\u9891\u64ad\u653e\u4e2d\u51c6\u5907\u7d20\u6750\u90a3\u6837\u7b80\u5355\uff0c\u97f3\u9891\u6587\u4ef6\u5bf9\u4e8e\u53c2\u6570\u7684\u4fe1\u606f\u8981\u6c42\u591a\u4e00\u70b9\u3002\u9996\u5148\u8981\u4f7f\u7528 ffmpeg \u67e5\u770b mp3 \u6587\u4ef6\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u6bd4\u5982\u91c7\u6837\u7387\u3001\u58f0\u9053\u6570\u7b49\u3002</p> <pre><code>ffmpeg -i file_name.mp3\n</code></pre> <p></p> <p>\u5f97\u5230\u5982\u56fe\u6240\u793a\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230 mp3 \u6587\u4ef6\u91c7\u6837\u7387\u662f 44100 Hz\uff0c\u53cc\u58f0\u9053\uff0c\u518d\u4f7f\u7528 FFmpeg \u8f6c\u6362\u65f6\u8981\u7528\u5230\u4e0a\u9762\u7684\u4fe1\u606f\u3002</p> <pre><code>ffmpeg -i file_name.mp3 -acodec pcm_s16le -f s16le -ac 2 -ar 44100 file_name.pcm\n</code></pre> <p>\u5176\u4e2d\uff1a</p> <ul> <li> <p>-acodec pcm_s16le</p> <ul> <li>\u6307\u5b9a\u7f16\u7801\u5668</li> </ul> </li> <li> <p>-f s16le</p> <ul> <li>\u6307\u5b9a\u6587\u4ef6\u683c\u5f0f\uff0c\u662f\u5927\u7aef\u6a21\u5f0f\u8fd8\u662f\u5c0f\u7aef\u6a21\u5f0f</li> </ul> </li> <li> <p>-ac 2 </p> <ul> <li>\u6307\u5b9a\u901a\u9053\u6570\uff0c2 \u4ee3\u8868\u53cc\u901a\u9053</li> </ul> </li> <li> <p>-ar 44100</p> <ul> <li>\u6307\u5b9a\u91c7\u6837\u7387\uff0c\u8fd9\u91cc\u662f 44100 Hz</li> </ul> </li> </ul> <p>\u5728\u8f6c\u6362\u65f6\u8981\u6839\u636e\u539f\u6587\u4ef6\u7684\u91c7\u6837\u7387\u548c\u58f0\u9053\u6570\u8fdb\u884c\u8f6c\u6362\uff0c\u5426\u5219\u8f6c\u6362\u540e\u7684 pcm \u6587\u4ef6\u64ad\u653e\u58f0\u97f3\u4e0d\u5bf9\u4e86\u3002</p> <pre><code>ffplay -ar 44100 -channels 2 -f s16le -i file_name.pcm\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u9a8c\u8bc1\u8f6c\u6362\u662f\u5426\u6b63\u786e\uff0c\u8fd8\u662f\u8981\u6ce8\u610f\u58f0\u9053\u6570\u548c\u91c7\u6837\u7387\u7684\u8bbe\u7f6e\uff0c\u5982\u679c\u6ca1\u95ee\u9898\u7684\u8bdd\uff0c\u8bf4\u660e PCM \u6587\u4ef6\u7d20\u6750\u5c31\u51c6\u5907\u5b8c\u6bd5\uff0c\u53ef\u4ee5\u8fdb\u884c\u4ee3\u7801\u5b9e\u8df5\u4e86\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-007/#_1","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u9996\u5148\u8981\u901a\u8fc7 <code>SDL_OpenAudioDevice</code> \u65b9\u6cd5\u6253\u5f00\u4e00\u4e2a\u97f3\u9891\u8bbe\u5907\u3002</p> <pre><code>SDL_OpenAudioDevice(const char\n                 *device,\n                 int iscapture,\n                 const SDL_AudioSpec * desired,\n                 SDL_AudioSpec *obtained,\n                 int allowed_changes);\n</code></pre> <p>\u5176\u4e2d\u7ed3\u6784\u4f53 <code>SDL_AudioSpec</code> \u6307\u5b9a\u4e86\u4e00\u7cfb\u5217\u97f3\u9891\u76f8\u5173\u7684\u53c2\u6570\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <pre><code>typedef struct SDL_AudioSpec\n{\n    int freq;                   /**&lt; DSP frequency -- samples per second */\n    SDL_AudioFormat format;     /**&lt; Audio data format */\n    Uint8 channels;             /**&lt; Number of channels: 1 mono, 2 stereo */\n    Uint8 silence;              /**&lt; Audio buffer silence value (calculated) */\n    Uint16 samples;             /**&lt; Audio buffer size in sample FRAMES (total samples divided by channel count) */\n    Uint16 padding;             /**&lt; Necessary for some compile environments */\n    Uint32 size;                /**&lt; Audio buffer size in bytes (calculated) */\n    SDL_AudioCallback callback; /**&lt; Callback that feeds the audio device (NULL to use SDL_QueueAudio()). */\n    void *userdata;             /**&lt; Userdata passed to callback (ignored for NULL callbacks). */\n} SDL_AudioSpec;\n</code></pre> <p>\u8fd9\u4e9b\u53c2\u6570\u548c\u97f3\u9891\u662f\u606f\u606f\u76f8\u5173\u7684\uff0c\u6bd4\u5982\u91c7\u6837\u7387\u3001\u58f0\u9053\u3001\u97f3\u9891\u6570\u636e\u683c\u5f0f\u3001\u91c7\u6837\u4e2a\u6570\u7b49\uff0c\u540e\u9762\u4f1a\u4e13\u95e8\u53bb\u4ecb\u7ecd\u5b83\u4eec\u3002</p> <p><code>SDL_OpenAudioDevice</code> \u65b9\u6cd5\u6709\u4e24\u4e2a\u53c2\u6570 <code>desired</code> \u548c <code>obtained</code> \u90fd\u662f <code>SDL_AudioSpec</code> \u7c7b\u578b\u7684\u3002</p> <p>\u8fd9\u91cc\u7684\u610f\u601d\u662f\u6211\u4eec\u4f20\u5165 <code>desired</code> \u6307\u5b9a\u7684\u97f3\u9891\u53c2\u6570\uff0c\u4f46\u4e0d\u4e00\u5b9a\u662f SDL \u652f\u6301\u7684\uff0c\u6240\u4ee5 SDL \u4f1a\u8fd4\u56de\u4e00\u4e2a\u5b83\u652f\u6301\u7684\u53c2\u6570\u4fe1\u606f\u653e\u5728 <code>obtained</code> \u91cc\u9762\u3002</p> <p>\u4e0d\u8fc7\u4e3a\u4e86\u7b80\u5355\u5c31\u5148\u628a\u5b83\u5199\u6b7b\u597d\u4e86\uff0c\u4f46\u5373\u4f7f\u5199\u6b7b\u4e86\u6709\u4e9b\u4fe1\u606f\u8fd8\u662f\u8981\u548c\u4f60\u7684 PCM \u6587\u4ef6\u5bf9\u5e94\u4e0a\u624d\u884c\uff0c\u6bd4\u5982 <code>freg</code> \u91c7\u6837\u7387\u548c <code>channels</code> \u901a\u9053\u6570\u7b49\u3002</p> <pre><code>    SDL_AudioSpec audioSpec;\n    audioSpec.freq = 44100;\n    audioSpec.format = AUDIO_S16SYS;\n    audioSpec.channels = 2;\n    audioSpec.silence = 0;\n    audioSpec.samples = 1024;\n    // \u56e0\u4e3a\u662f\u63a8\u6a21\u5f0f\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e3a nullptr\n    audioSpec.callback = nullptr;\n\n    SDL_AudioDeviceID deviceId;\n    if ((deviceId = SDL_OpenAudioDevice(nullptr,0,&amp;audioSpec, nullptr,SDL_AUDIO_ALLOW_ANY_CHANGE)) &lt; 2){\n        cout &lt;&lt; \"open audio device failed \" &lt;&lt; endl;\n        return -1;\n    }\n</code></pre> <p>\u6ce8\u610f\u5230 <code>SDL_AudioSpec</code> \u6709\u4e2a\u53c2\u6570 <code>callback</code> \u8bbe\u7f6e\u4e3a\u4e86 nullptr \u3002\u8fd9\u4e2a\u56de\u8c03\u662f\u4e3a\u4e86\u5728 <code>\u62c9</code> \u6a21\u5f0f\u4e2d\u4ece\u56de\u8c03\u53d6\u6570\u636e\u7684\uff0c\u56e0\u4e3a\u8fd9\u91cc\u6682\u65f6\u7528\u4e0d\u5230\u5c31\u5199\u6210\u4e86 nullptr \uff0c\u4e0b\u4e00\u7bc7\u6587\u7ae0\u5c31\u4f1a\u7528\u5230\u4e86\u3002</p> <p>\u8fd9\u6837\u5c31\u6253\u5f00\u4e86\u97f3\u9891\u8bbe\u5907\uff0c\u8fd4\u56de\u4e00\u4e2a\u6587\u4ef6 Id\uff0c\u5982\u679c\u7ed3\u679c\u5c0f\u4e8e 2 \u8bf4\u660e\u6253\u5f00\u5931\u8d25\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\u901a\u8fc7 <code>SDL_PauseAudioDevice</code> \u65b9\u6cd5\u53bb\u64ad\u653e\u6216\u8005\u6682\u505c\u97f3\u4e50\u3002</p> <pre><code>SDL_PauseAudioDevice(SDL_AudioDeviceID dev,\n                   int pause_on);\n</code></pre> <p><code>SDL_AudioDeviceID</code> \u53c2\u6570\u5c31\u662f\u4e0a\u9762\u8fd4\u56de\u7684\u6587\u4ef6 Id\uff0c<code>pause_on</code> \u4e3a 0 \u7684\u8bdd\u4ee3\u8868\u64ad\u653e\uff0c1 \u4ee3\u8868\u6682\u505c\u3002</p> <p>\u6700\u540e\u5c31\u8981\u5f00\u59cb\u4e3b\u52a8\u5411\u8bbe\u5907\u7f13\u51b2\u533a\u586b\u5145 Buffer \u4e86\u3002</p> <p>\u5c31\u5411 SDL \u64ad\u653e YUV \u89c6\u9891\u90a3\u6837\uff0c\u8981\u4ece PCM \u6587\u4ef6\u4e2d\u8bfb\u53d6\u4e00\u5757 Buffer \uff0c\u7136\u540e\u901a\u8fc7 <code>SDL_QueueAudio</code> \u65b9\u6cd5\u8fdb\u884c\u586b\u5145\u3002</p> <pre><code>    int bufferSize = 4096;\n    char* buffer = (char *)malloc(bufferSize);\n    // \u7701\u7565\u4e2d\u95f4\u4ee3\u7801\n    num =  fread(buffer,1,bufferSize,pFile);\n    if (num){\n        // \u586b\u5145\n        SDL_QueueAudio(deviceId,buffer,bufferSize);\n    }\n</code></pre> <p>\u5982\u4e0a\u4ee3\u7801\uff0c\u9996\u5148\u5b9a\u4e49\u4e86\u7f13\u51b2\u533a\u7684\u5927\u5c0f 4096\uff0c\u7136\u540e fread \u65b9\u6cd5\u8bfb\u53d6\u8fd9\u4e48\u5927\u7684\u5185\u5bb9\uff0c\u6700\u540e\u628a\u5b83\u586b\u5145\u8fdb\u53bb\u3002</p> <p>\u6b64\u65f6\u8fd0\u884c\u7a0b\u5e8f\uff0c\u5c31\u4f1a\u542c\u5230\u548c\u539f\u6765 mp3 \u6587\u4ef6\u4e00\u6837\u7684\u58f0\u97f3\u4e86\u3002</p> <p>\u4e0d\u8fc7\u8fd9\u91cc\u6709\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff0c\u5e76\u4e0d\u662f\u586b\u5145\u4e86\u4e00\u4e0b Buffer \u5c31\u9a6c\u4e0a\u4f1a\u6709\u58f0\u97f3\u64ad\u653e\u51fa\u6765\u7684\uff0c\u8981\u591a\u586b\u5145\u4e00\u4e9b\u624d\u4f1a\u6709\u58f0\u97f3\u64ad\u653e\u3002</p> <p>\u53e6\u5916\uff0c\u5f53\u64ad\u653e\u58f0\u97f3\u65f6\uff0c\u5fc5\u987b\u8981\u8ba9\u7a0b\u5e8f\u4e0d\u80fd\u9000\u51fa\uff0c\u56e0\u4e3a\u97f3\u9891\u64ad\u653e\u5e76\u4e0d\u662f\u4e00\u4e2a\u963b\u585e\u5f53\u524d\u4e3b\u7ebf\u7a0b\u7684\u65b9\u6cd5\uff0c\u586b\u5145\u5b8c\u6570\u636e\u5c31\u4e0d\u7ba1\u4e86\u7684\u8bdd\uff0c\u662f\u542c\u4e0d\u5230\u58f0\u97f3\u7684\u3002\u8981\u4e48\u52a0\u4e2a SDL_Delay \u65b9\u6cd5\u8981\u4e48\u5c31\u628a <code>SDL_QueueAudio</code> \u65b9\u6cd5\u653e\u5728\u63a5\u53d7\u6d88\u606f\u961f\u5217\u4fe1\u606f\u7684\u5faa\u73af\u4e2d\uff0c\u6211\u91c7\u7528\u7684\u5c31\u662f\u540e\u8005\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-007/#_2","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u8fde\u8f7d\u7684 <code>007</code> \u7bc7\u3002</p> <p>\u672c\u6587\u5177\u4f53\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u672c\u7bc7\u6587\u7ae0\u5bf9\u5e94\u7684\u63d0\u4ea4 <code>tag</code> \u4e3a <code>av-beginner-004</code>\uff0c\u53ef\u5207\u6362\u81f3\u5bf9\u5e94\u6e90\u7801\u67e5\u770b\u3002</p> <p>\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4e0d\u5bf9\u4e4b\u5904\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u8fdb\u884c\u4ea4\u6d41~~</p>","tags":["SDL"]},{"location":"sdl/av-beginner-008/","title":"\u3010\u97f3\u89c6\u9891\u8fde\u8f7d-008\u3011\u57fa\u7840\u5b66\u4e60\u7bc7-SDL \u64ad\u653e PCM \u97f3\u9891\u6587\u4ef6\uff08\u4e0b\uff09","text":"<p>\u63a5\u4e0a\u7bc7 SDL \u64ad\u653e PCM \u97f3\u9891\u6587\u4ef6\uff0c\u5df2\u7ecf\u5b9e\u73b0\u4e86 <code>\u63a8</code> \u7684\u6a21\u5f0f\u53bb\u64ad\u653e\uff0c\u63a5\u4e0b\u6765\u770b\u770b <code>\u62c9</code> \u7684\u6a21\u5f0f\u5982\u4f55\u5b9e\u73b0\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-008/#pcm","title":"PCM \u6587\u4ef6\u7d20\u6750\u51c6\u5907","text":"<p>\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u5df2\u7ecf\u51c6\u5907\u597d\u4e86\u76f8\u5173\u7d20\u6750\uff0c\u8fd9\u91cc\u5c31\u4e0d\u91cd\u590d\u4e86\uff0c\u8fd8\u662f\u7528\u540c\u6837\u7684 PCM \u6587\u4ef6\u4f5c\u4e3a\u8fd9\u6b21\u5b9e\u9a8c\u7d20\u6750\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-008/#_1","title":"\u4ee3\u7801\u5b9e\u8df5","text":"<p>\u9996\u5148\u8fd8\u662f\u8981\u901a\u8fc7 <code>SDL_OpenAudioDevice</code> \u65b9\u6cd5\u6253\u5f00\u4e00\u4e2a\u97f3\u9891\u8bbe\u5907\u3002</p> <pre><code>    SDL_AudioSpec audioSpec;\n    audioSpec.freq = 44100;\n    audioSpec.format = AUDIO_S16SYS;\n    audioSpec.channels = 2;\n    audioSpec.silence = 0;\n    audioSpec.samples = 1024;\n    // \u62c9\u7684\u6a21\u5f0f\uff0c\u8fd9\u91cc\u8981\u4f20\u4e00\u4e2a\u51fd\u6570\n    audioSpec.callback = fill_audio;\n\n    SDL_AudioDeviceID deviceId;\n    if ((deviceId = SDL_OpenAudioDevice(nullptr, 0, &amp;audioSpec, nullptr, SDL_AUDIO_ALLOW_ANY_CHANGE)) &lt; 2) {\n        cout &lt;&lt; \"open audio device failed \" &lt;&lt; endl;\n        return -1;\n    }\n</code></pre> <p>\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u91cc <code>callback</code> \u53c2\u6570\u4e0d\u80fd\u662f nullptr \u4e86\uff0c\u8981\u4f20\u4e00\u4e2a\u51fd\u6570\u6307\u9488\u3002\u8fd9\u4e2a\u51fd\u6570\u5728 <code>\u62c9</code> \u6a21\u5f0f\u4e0b\u4f1a\u4e0d\u65ad\u56de\u8c03\uff0c\u4ece\u800c\u5c06\u97f3\u9891\u6570\u636e\u586b\u5145\u7ed9\u8bbe\u5907\u7f13\u51b2\u533a\u3002</p> <p>\u51fd\u6570\u58f0\u660e\u5982\u4e0b\uff1a</p> <pre><code>typedef void (SDLCALL * SDL_AudioCallback) (\n    // \u4f20\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u6570\u636e\n    void *userdata, \n    // \u6307\u5411\u8981\u586b\u5145\u7ed9\u8bbe\u5907\u7f13\u51b2\u533a\u7684\u97f3\u9891\u6570\u636eBuffer\u7684\u6307\u9488\n    Uint8 * stream,\n    // \u97f3\u9891\u6570\u636eBuffer\u7684\u957f\u5ea6\n    int len);\n</code></pre> <p>\u53c2\u6570 <code>stream</code> \u662f\u4e2a\u6307\u9488\u7c7b\u578b\uff0c\u5b83\u6307\u5411\u8981\u586b\u5145\u7ed9\u8bbe\u5907\u7f13\u51b2\u533a\u7684\u97f3\u9891\u6570\u636e Buffer \uff0c\u800c len \u5c31\u662f Buffer \u7684\u957f\u5ea6\u3002<code>userdata</code> \u662f\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u6570\u636e\uff0c\u9700\u8981\u7684\u65f6\u5019\u53ef\u4ee5\u7528\u5230\u3002</p> <p>\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5c06\u8bfb\u53d6\u7684 PCM \u97f3\u9891\u6570\u636e\u4f20\u7ed9 <code>stream</code> \u6307\u5411\u7684 Buffer \uff0c\u800c\u4e14\u8fd8\u4e0d\u80fd\u8d85\u51fa len \u7684\u957f\u5ea6\uff0c\u5982\u679c\u8d85\u51fa\u4e86\u622a\u65ad\u4e00\u4e0b\uff0c\u4e0b\u6b21\u56de\u8c03\u65f6\u4f20\u5269\u4e0b\u7684\u90e8\u5206\u3002</p> <p>\u56e0\u6b64\u5c31\u6709\u4e86\u5982\u4e0b\u7684\u5b9e\u73b0\uff1a</p> <pre><code>// \u8bfb\u53d6\u51fa pcm \u6570\u636e\u957f\u5ea6\nstatic Uint32 audio_len;\n// \u8bfb\u53d6\u51fa\u7684\u97f3\u9891\u6570\u636e Buffer\nstatic Uint8 *audio_pos;\n\n// \u51fd\u6570\u5b9e\u73b0\nvoid fill_audio(void *udata, Uint8 *stream, int len) {\n    SDL_memset(stream, 0, len);\n    if (audio_len == 0) {\n        return;\n    }\n    // \u6570\u636e\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 len\n    len = len &gt; audio_len ? audio_len : len;\n\n    // \u5c06 stream \u548c audio_pos \u8fdb\u884c\u6df7\u5408\u64ad\u653e\n//    SDL_MixAudio(stream, audio_pos, len, SDL_MIX_MAXVOLUME);\n\n    // \u5355\u72ec\u64ad\u653e audio_pos,\u4e5f\u5c31\u662f\u89e3\u7801\u51fa\u6765\u7684\u97f3\u9891\u6570\u636e\n    memcpy(stream, audio_pos, len);\n\n    audio_pos += len;\n    audio_len -= len;\n\n    if (audio_len &lt;= 0){\n        // \u8bfb\u53d6\u5b8c\u4e86\uff0c\u901a\u77e5\u7ee7\u7eed\u8bfb\u53d6\u6570\u636e\n        notifyGetAudioFrame();\n    }\n}\n</code></pre> <p>\u9996\u5148\u5c06 <code>stream</code> \u6570\u636e\u6e05\u7a7a\u3002\u7136\u540e\u6bd4\u8f83\u8bfb\u51fa\u7684 pcm \u6570\u636e\u957f\u5ea6 <code>audio_len</code> \u548c <code>len</code> \u7684\u5927\u5c0f\uff0c\u4fdd\u8bc1\u6570\u636e\u5927\u5c0f\u4e0d\u8d85\u8fc7 <code>len</code> \u7684\u8981\u6c42\u3002</p> <p>\u5728\u64ad\u653e\u65f6\uff0c\u4e5f\u5c31\u662f\u7ed9 <code>stream</code> \u5199\u6570\u636e\u65f6\u6709\u4e24\u79cd\u65b9\u5f0f\u3002\u4e00\u79cd\u662f\u76f4\u63a5 <code>memcpy</code> \u5c06\u97f3\u9891\u6570\u636e <code>audio_pos</code> \u62f7\u8d1d\u5230 Buffer \u4e0a\u5c31\u597d\u4e86\u3002\u53e6\u4e00\u79cd\u662f\u901a\u8fc7 <code>SDL_MixAudio</code> \u65b9\u6cd5\u3002</p> <p><code>SDL_MixAudio</code> \u65b9\u6cd5\u987e\u540d\u601d\u4e49\u5c31\u662f\u6df7\u97f3\u4e86\uff0c\u5c06 <code>stream</code> \u548c\u97f3\u9891\u6570\u636e <code>audio_pos</code> \u6df7\u5408\u64ad\u653e\uff0c\u7531\u4e8e\u4e00\u5f00\u59cb\u5c31\u5c06 <code>stream</code> \u6570\u636e\u6e05\u7a7a\u4e3a 0 \u4e86\uff0c\u6240\u4ee5\u770b\u4f3c\u6df7\u97f3\uff0c\u5b9e\u9645\u4e0a\u548c\u76f4\u63a5\u64ad\u653e\u97f3\u9891\u6570\u636e\u6548\u679c\u4e00\u81f4\u7684\u3002</p> <p>\u6700\u540e\uff0c\u5982\u679c\u8bfb\u51fa\u7684 pcm \u6570\u636e\u957f\u5ea6\u5927\u4e8e <code>len</code>\uff0c\u90a3\u8bf4\u660e\u6570\u636e\u8fd8\u6ca1\u6709\u5168\u90e8\u586b\u5145\u5b8c\uff0c\u4e0b\u4e00\u6b21\u56de\u8c03\u628a\u5269\u4e0b\u7684\u586b\u5145\u5230\u7f13\u51b2\u533a\uff0c\u540c\u65f6\u79fb\u52a8\u76f8\u5e94\u7684\u6307\u9488\u4f4d\u7f6e\u3002</p> <p>\u5982\u679c\u5c0f\u4e8e\uff0c\u5c31\u5f97\u901a\u77e5\u7ee7\u7eed\u8bfb\u53d6\u6570\u636e\u4e86\uff0c\u8fd9\u91cc\u81ea\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4e8b\u4ef6\u53bb\u901a\u77e5\u5e94\u7528\u8bfb\u53d6\u97f3\u9891\u6570\u636e\u3002</p> <pre><code>// \u81ea\u5b9a\u4e49\u4e8b\u4ef6\uff0c\u901a\u77e5\u8bfb\u53d6\u97f3\u9891\u6570\u636e\nvoid notifyGetAudioFrame(){\n    SDL_Event sdlEvent;\n    sdlEvent.type = SDL_EVENT_BUFFER_END;\n    SDL_PushEvent(&amp;sdlEvent);\n}\n\n// \u5728\u7a0b\u5e8f\u4e8b\u4ef6\u5faa\u73af\u4e2d\u53bb\u54cd\u5e94\u4e8b\u4ef6\uff0c\u8bfb\u53d6\u97f3\u9891 Buffer\n while (!bQuit) {\n        while (SDL_PollEvent(&amp;windowEvent)) {\n            switch (windowEvent.type) {\n                case SDL_EVENT_BUFFER_END:\n                    // \u8bfb\u53d6\u97f3\u9891\u6570\u636e\n                    if (fread(buffer, 1, bufferSize, pFile)) {\n                        data_count += bufferSize;\n                        audio_chunk = reinterpret_cast&lt;Uint8 *&gt;(buffer);\n                        audio_len = bufferSize;\n                        audio_pos = audio_chunk;\n                    }\n                default:\n                    break;\n            }\n        }\n    }\n</code></pre> <p>\u5728\u4e8b\u4ef6\u7684\u6d88\u606f\u5faa\u73af\u4e2d\u8fdb\u884c\u54cd\u5e94\uff0c\u8bfb\u53d6\u97f3\u9891 Buffer \u3002\u5982\u679c\u8bfb\u53d6\u7684\u5230\u7684\u957f\u5ea6\u7b49\u4e8e 0 \u4e86\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>fseek</code> \u65b9\u6cd5\u5c06\u6307\u9488 seek \u5230 0\uff0c\u5faa\u73af\u8bfb\u53d6\u3002</p> <p>\u6700\u540e\u8fd0\u884c\u4e00\u4e0b\u7a0b\u5e8f\uff0c\u5c31\u4f1a\u64ad\u653e\u51fa\u548c\u539f\u6765 mp3 \u4e00\u6837\u7684\u97f3\u4e50\u4e86\u3002</p>","tags":["SDL"]},{"location":"sdl/av-beginner-008/#_2","title":"\u603b\u7ed3","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u97f3\u89c6\u9891\u57fa\u7840\u5b66\u4e60\u8fde\u8f7d\u7684 <code>008</code> \u7bc7\u3002</p> <p>\u901a\u8fc7\u4e24\u7bc7\u6587\u7ae0\u8bb2\u89e3\u4e86 SDL \u64ad\u653e\u97f3\u9891\u7684\u4e24\u79cd\u65b9\u5f0f\uff0c\u540e\u7eed\u4f1a\u4e3b\u8981\u4ee5 <code>\u62c9</code> \u7684\u6a21\u5f0f\u8fdb\u884c\u5f00\u53d1\u3002</p> <p>\u672c\u6587\u5177\u4f53\u4ee3\u7801\u89c1\u4ed3\u5e93\uff1a</p> <p>https://github.com/glumes/av-beginner</p> <p>\u672c\u7bc7\u6587\u7ae0\u5bf9\u5e94\u7684\u63d0\u4ea4 <code>tag</code> \u4e3a <code>av-beginner-004</code>\uff0c\u53ef\u5207\u6362\u81f3\u5bf9\u5e94\u6e90\u7801\u67e5\u770b\u3002</p> <p>\u80fd\u529b\u6709\u9650\uff0c\u6587\u4e2d\u6709\u4e0d\u5bf9\u4e4b\u5904\uff0c\u6b22\u8fce\u52a0\u6211\u5fae\u4fe1 ezglumes \u8fdb\u884c\u4ea4\u6d41~~</p>","tags":["SDL"]}]}